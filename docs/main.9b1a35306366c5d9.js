(self.webpackChunkmapLibre=self.webpackChunkmapLibre||[]).push([[461,792],{44:function(Tp){Tp.exports=function(){"use strict";var zc={},Gl={};function jc(H,y,st){if(Gl[H]=st,"index"===H){var Gs="var sharedModule = {}; ("+Gl.shared+")(sharedModule); ("+Gl.worker+")(sharedModule);",Fr={};return Gl.shared(Fr),Gl.index(zc,Fr),typeof window<"u"&&zc.setWorkerUrl(window.URL.createObjectURL(new Blob([Gs],{type:"text/javascript"}))),zc}}return jc("shared",0,function(H){function y(c,s,l,f){return new(l||(l=Promise))(function(g,w){function x(P){try{C(f.next(P))}catch(N){w(N)}}function M(P){try{C(f.throw(P))}catch(N){w(N)}}function C(P){var N;P.done?g(P.value):(N=P.value,N instanceof l?N:new l(function(L){L(N)})).then(x,M)}C((f=f.apply(c,s||[])).next())})}function st(c,s){this.x=c,this.y=s}function Gs(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Fr,$s;"function"==typeof SuppressedError&&SuppressedError,st.prototype={clone(){return new st(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,s){return this.clone()._rotateAround(c,s)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const s=c.x-this.x,l=c.y-this.y;return s*s+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult(c){const s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const s=Math.cos(c),l=Math.sin(c),f=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=f,this},_rotateAround(c,s){const l=Math.cos(c),f=Math.sin(c),g=s.y+f*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-f*(this.y-s.y),this.y=g,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:st},st.convert=function(c){if(c instanceof st)return c;if(Array.isArray(c))return new st(+c[0],+c[1]);if(void 0!==c.x&&void 0!==c.y)return new st(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};var Pe=Gs(function(){if($s)return Fr;function c(s,l,f,g){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=f,this.p2y=g}return $s=1,Fr=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(void 0===l&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var f=s,g=0;g<8;g++){var w=this.sampleCurveX(f)-s;if(Math.abs(w)<l)return f;var x=this.sampleCurveDerivativeX(f);if(Math.abs(x)<1e-6)break;f-=w/x}var M=0,C=1;for(f=s,g=0;g<20&&(w=this.sampleCurveX(f),!(Math.abs(w-s)<l));g++)s>w?M=f:C=f,f=.5*(C-M)+M;return f},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},Fr}());let No,bo;function zn(){return null==No&&(No=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),No}function Mt(){if(null==bo&&(bo=!1,zn())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let f=0;f<25;f++){const g=4*f;s.fillStyle=`rgb(${g},${g+1},${g+2})`,s.fillRect(f%5,Math.floor(f/5),1,1)}const l=s.getImageData(0,0,5,5).data;for(let f=0;f<100;f++)if(f%4!=3&&l[f]!==f){bo=!0;break}}}return bo||!1}var gi=1e-6,Oi=typeof Float32Array<"u"?Float32Array:Array;function nt(){var c=new Oi(9);return Oi!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function yt(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ht(){var c=new Oi(3);return Oi!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function tn(c){return Math.hypot(c[0],c[1],c[2])}function jn(c,s,l){var f=new Oi(3);return f[0]=c,f[1]=s,f[2]=l,f}function Dn(c,s,l){return c[0]=s[0]+l[0],c[1]=s[1]+l[1],c[2]=s[2]+l[2],c}function dr(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c[2]=s[2]*l,c}function ri(c,s,l){var f=s[0],g=s[1],w=s[2],x=l[0],M=l[1],C=l[2];return c[0]=g*C-w*M,c[1]=w*x-f*C,c[2]=f*M-g*x,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var An,Fi=tn;function rs(c,s,l){var f=s[0],g=s[1],w=s[2],x=s[3];return c[0]=l[0]*f+l[4]*g+l[8]*w+l[12]*x,c[1]=l[1]*f+l[5]*g+l[9]*w+l[13]*x,c[2]=l[2]*f+l[6]*g+l[10]*w+l[14]*x,c[3]=l[3]*f+l[7]*g+l[11]*w+l[15]*x,c}function wo(){var c=new Oi(4);return Oi!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function xo(c,s,l,f){var g=.5*Math.PI/180;s*=g,l*=g,f*=g;var w=Math.sin(s),x=Math.cos(s),M=Math.sin(l),C=Math.cos(l),P=Math.sin(f),N=Math.cos(f);return c[0]=w*C*N-x*M*P,c[1]=x*M*N+w*C*P,c[2]=x*C*P-w*M*N,c[3]=x*C*N+w*M*P,c}function Hs(){var c=new Oi(2);return Oi!=Float32Array&&(c[0]=0,c[1]=0),c}function qr(c,s){var l=new Oi(2);return l[0]=c,l[1]=s,l}ht(),An=new Oi(4),Oi!=Float32Array&&(An[0]=0,An[1]=0,An[2]=0,An[3]=0),ht(),jn(1,0,0),jn(0,1,0),wo(),wo(),nt(),Hs();const pn=8192;function lo(c,s,l){return s*(pn/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}function Mr(c,s){return(c%s+s)%s}function $l(c,s,l){return c*(1-l)+s*l}function qs(c){if(c<=0)return 0;if(c>=1)return 1;const s=c*c,l=s*c;return 4*(c<.5?l:3*(c-s)+l-.75)}function So(c,s,l,f){const g=new Pe(c,s,l,f);return w=>g.solve(w)}const os=So(.25,.1,.25,1);function Hi(c,s,l){return Math.min(l,Math.max(s,c))}function Vc(c,s,l){const f=l-s,g=((c-s)%f+f)%f+s;return g===s?l:g}function ss(c,...s){for(const l of s)for(const f in l)c[f]=l[f];return c}let as=1;function Hl(c,s,l){const f={};for(const g in c)f[g]=s.call(this,c[g],g,c);return f}function Uc(c,s,l){const f={};for(const g in c)s.call(this,c[g],g,c)&&(f[g]=c[g]);return f}function Wr(c){return Array.isArray(c)?c.map(Wr):"object"==typeof c&&c?Hl(c,Wr):c}const Li={};function nr(c){Li[c]||(typeof console<"u"&&console.warn(c),Li[c]=!0)}function Es(c,s,l){return(l.y-c.y)*(s.x-c.x)>(s.y-c.y)*(l.x-c.x)}function ko(c){return typeof WorkerGlobalScope<"u"&&void 0!==c&&c instanceof WorkerGlobalScope}let hl=null;function Ca(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ls="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Gc(c,s,l,f,g){return y(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(c,{timestamp:0});try{const x=w?.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const M=x.startsWith("BGR"),C=new Uint8ClampedArray(f*g*4);if(yield w.copyTo(C,function(P,N,L,j,U){const $=4*Math.max(-N,0),Z=(Math.max(0,L)-L)*j*4+$,J=4*j,ie=Math.max(0,N),be=Math.max(0,L);return{rect:{x:ie,y:be,width:Math.min(P.width,N+j)-ie,height:Math.min(P.height,L+U)-be},layout:[{offset:Z,stride:J}]}}(c,s,l,f,g)),M)for(let P=0;P<C.length;P+=4){const N=C[P];C[P]=C[P+2],C[P+2]=N}return C}finally{w.close()}})}let cn,Ws;function Zs(c,s,l,f){return c.addEventListener(s,l,f),{unsubscribe:()=>{c.removeEventListener(s,l,f)}}}function Ks(c){return c*Math.PI/180}function Si(c){return c/Math.PI*180}const Ta={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ia={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ql="AbortError";function _e(){return new Error(ql)}const W={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function K(c){return W.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const X="global-dispatcher";class ae extends Error{constructor(s,l,f,g){super(`AJAXError: ${l} (${s}): ${f}`),this.status=s,this.statusText=l,this.url=f,this.body=g}}const pe=()=>ko(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,we=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const f=K(c.url);if(f)return f(c,s);if(ko(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:X},s)}if(!(/^file:/.test(l=c.url)||/^file:/.test(pe())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return y(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:pe(),signal:g.signal});let x,M;"json"!==f.type||w.headers.has("Accept")||w.headers.set("Accept","application/json");try{x=yield fetch(w)}catch(P){throw new ae(0,P.message,f.url,new Blob)}if(!x.ok){const P=yield x.blob();throw new ae(x.status,x.statusText,f.url,P)}M="arrayBuffer"===f.type||"image"===f.type?x.arrayBuffer():"json"===f.type?x.json():x.text();const C=yield M;if(g.signal.aborted)throw _e();return{data:C,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(c,s);if(ko(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:X},s)}var l,f,g;return f=c,g=s,new Promise((w,x)=>{var M;const C=new XMLHttpRequest;C.open(f.method||"GET",f.url,!0),"arrayBuffer"!==f.type&&"image"!==f.type||(C.responseType="arraybuffer");for(const P in f.headers)C.setRequestHeader(P,f.headers[P]);"json"===f.type&&(C.responseType="text",!(null===(M=f.headers)||void 0===M)&&M.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials="include"===f.credentials,C.onerror=()=>{x(new Error(C.statusText))},C.onload=()=>{if(!g.signal.aborted)if((C.status>=200&&C.status<300||0===C.status)&&null!==C.response){let P=C.response;if("json"===f.type)try{P=JSON.parse(C.response)}catch(N){return void x(N)}w({data:P,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const P=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});x(new ae(C.status,C.statusText,f.url,P))}},g.signal.addEventListener("abort",()=>{C.abort(),x(_e())}),C.send(f.body)})};function Ce(c){if(!c||c.indexOf("://")<=0||0===c.indexOf("data:image/")||0===c.indexOf("blob:"))return!0;const s=new URL(c),l=window.location;return s.protocol===l.protocol&&s.host===l.host}function ye(c,s,l){l[c]&&-1!==l[c].indexOf(s)||(l[c]=l[c]||[],l[c].push(s))}function Ne(c,s,l){if(l&&l[c]){const f=l[c].indexOf(s);-1!==f&&l[c].splice(f,1)}}class Ve{constructor(s,l={}){ss(this,l),this.type=s}}class Fe extends Ve{constructor(s,l={}){super("error",ss({error:s},l))}}class pt{on(s,l){return this._listeners=this._listeners||{},ye(s,l,this._listeners),{unsubscribe:()=>{this.off(s,l)}}}off(s,l){return Ne(s,l,this._listeners),Ne(s,l,this._oneTimeListeners),this}once(s,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},ye(s,l,this._oneTimeListeners),this):new Promise(f=>this.once(s,f))}fire(s,l){"string"==typeof s&&(s=new Ve(s,l||{}));const f=s.type;if(this.listens(f)){s.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const M of g)M.call(this,s);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const M of w)Ne(f,M,this._oneTimeListeners),M.call(this,s);const x=this._eventedParent;x&&(ss(s,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(s))}else s instanceof Fe&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,l){return this._eventedParent=s,this._eventedParentData=l,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Nt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Yt(c,s){const l={};for(const f in c)"ref"!==f&&(l[f]=c[f]);return Nt.forEach(f=>{f in s&&(l[f]=s[f])}),l}function _t(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let l=0;l<c.length;l++)if(!_t(c[l],s[l]))return!1;return!0}if("object"==typeof c&&null!==c&&null!==s){if("object"!=typeof s||Object.keys(c).length!==Object.keys(s).length)return!1;for(const l in c)if(!_t(c[l],s[l]))return!1;return!0}return c===s}function Ut(c,s){c.push(s)}function Vn(c,s,l){Ut(l,{command:"addSource",args:[c,s[c]]})}function fr(c,s,l){Ut(s,{command:"removeSource",args:[c]}),l[c]=!0}function qi(c,s,l,f){fr(c,l,f),Vn(c,s,l)}function Un(c,s,l){let f;for(f in c[l])if(Object.prototype.hasOwnProperty.call(c[l],f)&&"data"!==f&&!_t(c[l][f],s[l][f]))return!1;for(f in s[l])if(Object.prototype.hasOwnProperty.call(s[l],f)&&"data"!==f&&!_t(c[l][f],s[l][f]))return!1;return!0}function rn(c,s,l,f,g,w){c=c||{},s=s||{};for(const x in c)Object.prototype.hasOwnProperty.call(c,x)&&(_t(c[x],s[x])||l.push({command:w,args:[f,x,s[x],g]}));for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&!Object.prototype.hasOwnProperty.call(c,x)&&(_t(c[x],s[x])||l.push({command:w,args:[f,x,s[x],g]}))}function hn(c){return c.id}function qt(c,s){return c[s.id]=s,c}class qe{constructor(s,l,f,g){this.message=(s?`${s}: `:"")+f,g&&(this.identifier=g),null!=l&&l.__line__&&(this.line=l.__line__)}}function Zr(c,...s){for(const l of s)for(const f in l)c[f]=l[f];return c}class Ei extends Error{constructor(s,l){super(l),this.message=l,this.key=s}}class dl{constructor(s,l=[]){this.parent=s,this.bindings={};for(const[f,g]of l)this.bindings[f]=g}concat(s){return new dl(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Cn={kind:"null"},it={kind:"number"},Pt={kind:"string"},Xt={kind:"boolean"},Dr={kind:"color"},Te={kind:"projectionDefinition"},fl={kind:"object"},At={kind:"value"},oi={kind:"collator"},Wl={kind:"formatted"},Qd={kind:"padding"},on={kind:"colorArray"},$c={kind:"numberArray"},Sn={kind:"resolvedImage"},Hc={kind:"variableAnchorOffsetCollection"};function Oo(c,s){return{kind:"array",itemType:c,N:s}}function $n(c){if("array"===c.kind){const s=$n(c.itemType);return"number"==typeof c.N?`array<${s}, ${c.N}>`:"value"===c.itemType.kind?"array":`array<${s}>`}return c.kind}const Pn=[Cn,it,Pt,Xt,Dr,Te,Wl,fl,Oo(At),Qd,$c,on,Sn,Hc];function Vt(c,s){if("error"===s.kind)return null;if("array"===c.kind){if("array"===s.kind&&(0===s.N&&"value"===s.itemType.kind||!Vt(c.itemType,s.itemType))&&("number"!=typeof c.N||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if("value"===c.kind)for(const l of Pn)if(!Vt(l,s))return null}return`Expected ${$n(c)} but found ${$n(s)} instead.`}function qc(c,s){return s.some(l=>l.kind===c.kind)}function ir(c,s){return s.some(l=>"null"===l?null===c:"array"===l?Array.isArray(c):"object"===l?c&&!Array.isArray(c)&&"object"==typeof c:l===typeof c)}function Zl(c,s){return"array"===c.kind&&"array"===s.kind?c.itemType.kind===s.itemType.kind&&"number"==typeof c.N:c.kind===s.kind}const Aa=4/29,Zu=6/29,Tm=3*Zu*Zu,F0=Zu*Zu*Zu,Im=Math.PI/180,Am=180/Math.PI;function Ip(c){return(c%=360)<0&&(c+=360),c}function Wc([c,s,l,f]){let g,w;const x=Cr((.2225045*(c=Ap(c))+.7168786*(s=Ap(s))+.0606169*(l=Ap(l)))/1);c===s&&s===l?g=w=x:(g=Cr((.4360747*c+.3850649*s+.1430804*l)/.96422),w=Cr((.0139322*c+.0971045*s+.7141733*l)/.82521));const M=116*x-16;return[M<0?0:M,500*(g-x),200*(x-w),f]}function Ap(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Cr(c){return c>F0?Math.pow(c,1/3):c/Tm+Aa}function xt([c,s,l,f]){let g=(c+16)/116,w=isNaN(s)?g:g+s/500,x=isNaN(l)?g:g-l/200;return g=1*Rp(g),w=.96422*Rp(w),x=.82521*Rp(x),[Pp(3.1338561*w-1.6168667*g-.4906146*x),Pp(-.9787684*w+1.9161415*g+.033454*x),Pp(.0719453*w-.2289914*g+1.4052427*x),f]}function Pp(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Rp(c){return c>Zu?c*c*c:Tm*(c-Aa)}const Pm=Object.hasOwn||function(c,s){return Object.prototype.hasOwnProperty.call(c,s)};function Ku(c,s){return Pm(c,s)?c[s]:void 0}function Uh(c){return parseInt(c.padEnd(2,c),16)/255}function Xe(c,s){return sn(s?c/100:c,0,1)}function sn(c,s,l){return Math.min(Math.max(s,c),l)}function Hn(c){return!c.some(Number.isNaN)}const Ms={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Pa(c,s,l){return c+l*(s-c)}function Kl(c,s,l){return c.map((f,g)=>Pa(f,s[g],l))}class nn{constructor(s,l,f,g=1,w=!0){this.r=s,this.g=l,this.b=f,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[s,l,f,g]))}static parse(s){if(s instanceof nn)return s;if("string"!=typeof s)return;const l=function(f){if("transparent"===(f=f.toLowerCase().trim()))return[0,0,0,0];const g=Ku(Ms,f);if(g){const[x,M,C]=g;return[x/255,M/255,C/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let M=1;return[Uh(f.slice(M,M+=x)),Uh(f.slice(M,M+=x)),Uh(f.slice(M,M+=x)),Uh(f.slice(M,M+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[M,C,P,N,L,j,U,$,Z,J,ie,be]=x,ce=[N||" ",U||" ",J].join("");if("  "===ce||"  /"===ce||",,"===ce||",,,"===ce){const he=[P,j,Z].join(""),De="%%%"===he?100:""===he?255:0;if(De){const Re=[sn(+C/De,0,1),sn(+L/De,0,1),sn(+$/De,0,1),ie?Xe(+ie,be):1];if(Hn(Re))return Re}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,M,C,P,N,L,j,U,$]=w,Z=[C||" ",N||" ",j].join("");if("  "===Z||"  /"===Z||",,"===Z||",,,"===Z){const J=[+M,sn(+P,0,100),sn(+L,0,100),U?Xe(+U,$):1];if(Hn(J))return function([ie,be,ce,he]){function De(Re){const ze=(Re+ie/30)%12,tt=be*Math.min(ce,1-ce);return ce-tt*Math.max(-1,Math.min(ze-3,9-ze,1))}return ie=Ip(ie),be/=100,ce/=100,[De(0),De(8),De(4),he]}(J)}}}(s);return l?new nn(...l,!1):void 0}get rgb(){const{r:s,g:l,b:f,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[s/w,l/w,f/w,g])}get hcl(){return this.overwriteGetter("hcl",function(s){const[l,f,g,w]=Wc(s),x=Math.sqrt(f*f+g*g);return[Math.round(1e4*x)?Ip(Math.atan2(g,f)*Am):NaN,x,l,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Wc(this.rgb))}overwriteGetter(s,l){return Object.defineProperty(this,s,{value:l}),l}toString(){const[s,l,f,g]=this.rgb;return`rgba(${[s,l,f].map(w=>Math.round(255*w)).join(",")},${g})`}static interpolate(s,l,f,g="rgb"){switch(g){case"rgb":{const[w,x,M,C]=Kl(s.rgb,l.rgb,f);return new nn(w,x,M,C,!1)}case"hcl":{const[w,x,M,C]=s.hcl,[P,N,L,j]=l.hcl;let U,$;if(isNaN(w)||isNaN(P))isNaN(w)?isNaN(P)?U=NaN:(U=P,1!==M&&0!==M||($=N)):(U=w,1!==L&&0!==L||($=x));else{let ce=P-w;P>w&&ce>180?ce-=360:P<w&&w-P>180&&(ce+=360),U=w+f*ce}const[Z,J,ie,be]=function([ce,he,De,Re]){return ce=isNaN(ce)?0:ce*Im,xt([De,Math.cos(ce)*he,Math.sin(ce)*he,Re])}([U,$??Pa(x,N,f),Pa(M,L,f),Pa(C,j,f)]);return new nn(Z,J,ie,be,!1)}case"lab":{const[w,x,M,C]=xt(Kl(s.lab,l.lab,f));return new nn(w,x,M,C,!1)}}}}nn.black=new nn(0,0,0,1),nn.white=new nn(1,1,1,1),nn.transparent=new nn(0,0,0,0),nn.red=new nn(1,0,0,1);class Ys{constructor(s,l,f){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,l){return this.collator.compare(s,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Yl=["bottom","center","top"];class Zc{constructor(s,l,f,g,w,x){this.text=s,this.image=l,this.scale=f,this.fontStack=g,this.textColor=w,this.verticalAlign=x}}class $e{constructor(s){this.sections=s}static fromString(s){return new $e([new Zc(s,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(s=>0!==s.text.length||s.image&&0!==s.image.name.length)}static factory(s){return s instanceof $e?s:$e.fromString(s)}toString(){return 0===this.sections.length?"":this.sections.map(s=>s.text).join("")}}class rr{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof rr)return s;if("number"==typeof s)return new rr([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const l of s)if("number"!=typeof l)return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new rr(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f){return new rr(Kl(s.values,l.values,f))}}class pr{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof pr)return s;if("number"==typeof s)return new pr([s]);if(Array.isArray(s)){for(const l of s)if("number"!=typeof l)return;return new pr(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f){return new pr(Kl(s.values,l.values,f))}}class Mi{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Mi)return s;if("string"==typeof s){const f=nn.parse(s);return f?new Mi([f]):void 0}if(!Array.isArray(s))return;const l=[];for(const f of s){if("string"!=typeof f)return;const g=nn.parse(f);if(!g)return;l.push(g)}return new Mi(l)}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f,g="rgb"){const w=[];if(s.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${s.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let x=0;x<s.values.length;x++)w.push(nn.interpolate(s.values[x],l.values[x],f,g));return new Mi(w)}}class En extends Error{constructor(s){super(s),this.name="RuntimeError"}toJSON(){return this.message}}const Np=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class co{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof co)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let l=0;l<s.length;l+=2){const f=s[l],g=s[l+1];if("string"!=typeof f||!Np.has(f)||!Array.isArray(g)||2!==g.length||"number"!=typeof g[0]||"number"!=typeof g[1])return}return new co(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f){const g=s.values,w=l.values;if(g.length!==w.length)throw new En(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${l.toString()}`);const x=[];for(let M=0;M<g.length;M+=2){if(g[M]!==w[M])throw new En(`Cannot interpolate values containing mismatched anchors. from[${M}]: ${g[M]}, to[${M}]: ${w[M]}`);x.push(g[M]);const[C,P]=g[M+1],[N,L]=w[M+1];x.push([Pa(C,N,f),Pa(P,L,f)])}return new co(x)}}class Fo{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new Fo({name:s,available:!1}):null}}class or{constructor(s,l,f){this.from=s,this.to=l,this.transition=f}static interpolate(s,l,f){return new or(s,l,f)}static parse(s){return s instanceof or?s:Array.isArray(s)&&3===s.length&&"string"==typeof s[0]&&"string"==typeof s[1]&&"number"==typeof s[2]?new or(s[0],s[1],s[2]):"object"==typeof s&&"string"==typeof s.from&&"string"==typeof s.to&&"number"==typeof s.transition?new or(s.from,s.to,s.transition):"string"==typeof s?new or(s,s,1):void 0}}function si(c,s,l,f){return"number"==typeof c&&c>=0&&c<=255&&"number"==typeof s&&s>=0&&s<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[c,s,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[c,s,l,f]:[c,s,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kc(c){if(null===c||"string"==typeof c||"boolean"==typeof c||"number"==typeof c||c instanceof or||c instanceof nn||c instanceof Ys||c instanceof $e||c instanceof rr||c instanceof pr||c instanceof Mi||c instanceof co||c instanceof Fo)return!0;if(Array.isArray(c)){for(const s of c)if(!Kc(s))return!1;return!0}if("object"==typeof c){for(const s in c)if(!Kc(c[s]))return!1;return!0}return!1}function It(c){if(null===c)return Cn;if("string"==typeof c)return Pt;if("boolean"==typeof c)return Xt;if("number"==typeof c)return it;if(c instanceof nn)return Dr;if(c instanceof or)return Te;if(c instanceof Ys)return oi;if(c instanceof $e)return Wl;if(c instanceof rr)return Qd;if(c instanceof pr)return $c;if(c instanceof Mi)return on;if(c instanceof co)return Hc;if(c instanceof Fo)return Sn;if(Array.isArray(c)){const s=c.length;let l;for(const f of c){const g=It(f);if(l){if(l===g)continue;l=At;break}l=g}return Oo(l||At,s)}return fl}function Gt(c){const s=typeof c;return null===c?"":"string"===s||"number"===s||"boolean"===s?String(c):c instanceof nn||c instanceof or||c instanceof $e||c instanceof rr||c instanceof pr||c instanceof Mi||c instanceof co||c instanceof Fo?c.toString():JSON.stringify(c)}class Ra{constructor(s,l){this.type=s,this.value=l}static parse(s,l){if(2!==s.length)return l.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Kc(s[1]))return l.error("invalid value");const f=s[1];let g=It(f);const w=l.expectedType;return"array"!==g.kind||0!==g.N||!w||"array"!==w.kind||"number"==typeof w.N&&0!==w.N||(g=w),new Ra(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const _n={string:Pt,number:it,boolean:Xt,object:fl};class uo{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let f,g=1;const w=s[0];if("array"===w){let M,C;if(s.length>2){const P=s[1];if("string"!=typeof P||!(P in _n)||"object"===P)return l.error('The item type argument of "array" must be one of string, number, boolean',1);M=_n[P],g++}else M=At;if(s.length>3){if(null!==s[2]&&("number"!=typeof s[2]||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);C=s[2],g++}f=Oo(M,C)}else{if(!_n[w])throw new Error(`Types doesn't contain name = ${w}`);f=_n[w]}const x=[];for(;g<s.length;g++){const M=l.parse(s[g],g,At);if(!M)return null;x.push(M)}return new uo(f,x)}evaluate(s){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(s);if(!Vt(this.type,It(f)))return f;if(l===this.args.length-1)throw new En(`Expected value to be of type ${$n(this.type)}, but found ${$n(It(f))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const cs={"to-boolean":Xt,"to-color":Dr,"to-number":it,"to-string":Pt};class Xs{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const f=s[0];if(!cs[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if(("to-boolean"===f||"to-string"===f)&&2!==s.length)return l.error("Expected one argument.");const g=cs[f],w=[];for(let x=1;x<s.length;x++){const M=l.parse(s[x],x,At);if(!M)return null;w.push(M)}return new Xs(g,w)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let l,f;for(const g of this.args){if(l=g.evaluate(s),f=null,l instanceof nn)return l;if("string"==typeof l){const w=s.parseColor(l);if(w)return w}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:si(l[0],l[1],l[2],l[3]),!f))return new nn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new En(f||`Could not parse color from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const f of this.args){l=f.evaluate(s);const g=rr.parse(l);if(g)return g}throw new En(`Could not parse padding from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(const f of this.args){l=f.evaluate(s);const g=pr.parse(l);if(g)return g}throw new En(`Could not parse numberArray from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(const f of this.args){l=f.evaluate(s);const g=Mi.parse(l);if(g)return g}throw new En(`Could not parse colorArray from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const f of this.args){l=f.evaluate(s);const g=co.parse(l);if(g)return g}throw new En(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const f of this.args){if(l=f.evaluate(s),null===l)return 0;const g=Number(l);if(!isNaN(g))return g}throw new En(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return $e.fromString(Gt(this.args[0].evaluate(s)));case"resolvedImage":return Fo.fromString(Gt(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return Gt(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Gh=["Unknown","Point","LineString","Polygon"];class $h{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Gh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let l=this._parseColorCache.get(s);return l||(l=nn.parse(s),this._parseColorCache.set(s,l)),l}}class us{constructor(s,l,f=[],g,w=new dl,x=[]){this.registry=s,this.path=f,this.key=f.map(M=>`[${M}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=l}parse(s,l,f,g,w={}){return l?this.concat(l,f,g)._parse(s,w):this._parse(s,w)}_parse(s,l){function f(g,w,x){return"assert"===x?new uo(w,[g]):"coerce"===x?new Xs(w,[g]):g}if(null!==s&&"string"!=typeof s&&"boolean"!=typeof s&&"number"!=typeof s||(s=["literal",s]),Array.isArray(s)){if(0===s.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=s[0];if("string"!=typeof g)return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(s,this);if(!x)return null;if(this.expectedType){const M=this.expectedType,C=x.type;if("string"!==M.kind&&"number"!==M.kind&&"boolean"!==M.kind&&"object"!==M.kind&&"array"!==M.kind||"value"!==C.kind){if("projectionDefinition"===M.kind&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(M.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(M.kind)&&["value","number","array"].includes(C.kind)||"colorArray"===M.kind&&["value","string","array"].includes(C.kind)||"variableAnchorOffsetCollection"===M.kind&&["value","array"].includes(C.kind))x=f(x,M,l.typeAnnotation||"coerce");else if(this.checkSubtype(M,C))return null}else x=f(x,M,l.typeAnnotation||"assert")}if(!(x instanceof Ra)&&"resolvedImage"!==x.type.kind&&this._isConstant(x)){const M=new $h;try{x=new Ra(x.type,x.evaluate(M))}catch(C){return this.error(C.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===s?"'undefined' value invalid. Use null instead.":"object"==typeof s?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,l,f){const g="number"==typeof s?this.path.concat(s):this.path,w=f?this.scope.concat(f):this.scope;return new us(this.registry,this._isConstant,g,l||null,w,this.errors)}error(s,...l){const f=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ei(f,s))}checkSubtype(s,l){const f=Vt(s,l);return f&&this.error(f),f}}class Na{constructor(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const l of this.bindings)s(l[1]);s(this.result)}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let w=1;w<s.length-1;w+=2){const x=s[w];if("string"!=typeof x)return l.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",w);const M=l.parse(s[w+1],w+1);if(!M)return null;f.push([x,M])}const g=l.parse(s[s.length-1],s.length-1,l.expectedType,f);return g?new Na(f,g):null}outputDefined(){return this.result.outputDefined()}}class Yu{constructor(s,l){this.type=l.type,this.name=s,this.boundExpression=l}static parse(s,l){if(2!==s.length||"string"!=typeof s[1])return l.error("'var' expression requires exactly one string literal argument.");const f=s[1];return l.scope.has(f)?new Yu(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Bt{constructor(s,l,f){this.type=s,this.index=l,this.input=f}static parse(s,l){if(3!==s.length)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,it),g=l.parse(s[2],2,Oo(l.expectedType||At));return f&&g?new Bt(g.type.itemType,f,g):null}evaluate(s){const l=this.index.evaluate(s),f=this.input.evaluate(s);if(l<0)throw new En(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new En(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new En(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class dn{constructor(s,l){this.type=Xt,this.needle=s,this.haystack=l}static parse(s,l){if(3!==s.length)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,At),g=l.parse(s[2],2,At);return f&&g?qc(f.type,[Xt,Pt,it,Cn,At])?new dn(f,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(f.type)} instead`):null}evaluate(s){const l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!ir(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${$n(It(l))} instead.`);if(!ir(f,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${$n(It(f))} instead.`);return f.indexOf(l)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Qs{constructor(s,l,f){this.type=it,this.needle=s,this.haystack=l,this.fromIndex=f}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,At),g=l.parse(s[2],2,At);if(!f||!g)return null;if(!qc(f.type,[Xt,Pt,it,Cn,At]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(f.type)} instead`);if(4===s.length){const w=l.parse(s[3],3,it);return w?new Qs(f,g,w):null}return new Qs(f,g)}evaluate(s){const l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!ir(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${$n(It(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(s)),ir(f,["string"])){const w=f.indexOf(l,g);return-1===w?-1:[...f.slice(0,w)].length}if(ir(f,["array"]))return f.indexOf(l,g);throw new En(`Expected second argument to be of type array or string, but found ${$n(It(f))} instead.`)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Tr{constructor(s,l,f,g,w,x){this.inputType=s,this.type=l,this.input=f,this.cases=g,this.outputs=w,this.otherwise=x}static parse(s,l){if(s.length<5)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return l.error("Expected an even number of arguments.");let f,g;l.expectedType&&"value"!==l.expectedType.kind&&(g=l.expectedType);const w={},x=[];for(let P=2;P<s.length-1;P+=2){let N=s[P];const L=s[P+1];Array.isArray(N)||(N=[N]);const j=l.concat(P);if(0===N.length)return j.error("Expected at least one branch label.");for(const $ of N){if("number"!=typeof $&&"string"!=typeof $)return j.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return j.error("Numeric branch labels must be integer values.");if(f){if(j.checkSubtype(f,It($)))return null}else f=It($);if(void 0!==w[String($)])return j.error("Branch labels must be unique.");w[String($)]=x.length}const U=l.parse(L,P,g);if(!U)return null;g=g||U.type,x.push(U)}const M=l.parse(s[1],1,At);if(!M)return null;const C=l.parse(s[s.length-1],s.length-1,g);return C?"value"!==M.type.kind&&l.concat(1).checkSubtype(f,M.type)?null:new Tr(f,g,M,w,x,C):null}evaluate(s){const l=this.input.evaluate(s);return(It(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class pl{constructor(s,l,f){this.type=s,this.branches=l,this.otherwise=f}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const g=[];for(let x=1;x<s.length-1;x+=2){const M=l.parse(s[x],x,Xt);if(!M)return null;const C=l.parse(s[x+1],x+1,f);if(!C)return null;g.push([M,C]),f=f||C.type}const w=l.parse(s[s.length-1],s.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new pl(f,g,w)}evaluate(s){for(const[l,f]of this.branches)if(l.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[l,f]of this.branches)s(l),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Yc{constructor(s,l,f,g){this.type=s,this.input=l,this.beginIndex=f,this.endIndex=g}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,At),g=l.parse(s[2],2,it);if(!f||!g)return null;if(!qc(f.type,[Oo(At),Pt,At]))return l.error(`Expected first argument to be of type array or string, but found ${$n(f.type)} instead`);if(4===s.length){const w=l.parse(s[3],3,it);return w?new Yc(f.type,f,g,w):null}return new Yc(f.type,f,g)}evaluate(s){const l=this.input.evaluate(s),f=this.beginIndex.evaluate(s);let g;if(this.endIndex&&(g=this.endIndex.evaluate(s)),ir(l,["string"]))return[...l].slice(f,g).join("");if(ir(l,["array"]))return l.slice(f,g);throw new En(`Expected first argument to be of type array or string, but found ${$n(It(l))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Ds(c,s){const l=c.length-1;let f,g,w=0,x=l,M=0;for(;w<=x;)if(M=Math.floor((w+x)/2),f=c[M],g=c[M+1],f<=s){if(M===l||s<g)return M;w=M+1}else{if(!(f>s))throw new En("Input is not a number.");x=M-1}return 0}class mi{constructor(s,l,f){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(const[g,w]of f)this.labels.push(g),this.outputs.push(w)}static parse(s,l){if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(s[1],1,it);if(!f)return null;const g=[];let w=null;l.expectedType&&"value"!==l.expectedType.kind&&(w=l.expectedType);for(let x=1;x<s.length;x+=2){const M=1===x?-1/0:s[x],C=s[x+1],P=x,N=x+1;if("number"!=typeof M)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=M)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const L=l.parse(C,N,w);if(!L)return null;w=w||L.type,g.push([M,L])}return new mi(w,f,g)}evaluate(s){const l=this.labels,f=this.outputs;if(1===l.length)return f[0].evaluate(s);const g=this.input.evaluate(s);if(g<=l[0])return f[0].evaluate(s);const w=l.length;return g>=l[w-1]?f[w-1].evaluate(s):f[Ds(l,g)].evaluate(s)}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}var Hh,ef,Xc=function Rm(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}(function(){if(ef)return Hh;function c(s,l,f,g){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=f,this.p2y=g}return ef=1,Hh=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(void 0===l&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var f=s,g=0;g<8;g++){var w=this.sampleCurveX(f)-s;if(Math.abs(w)<l)return f;var x=this.sampleCurveDerivativeX(f);if(Math.abs(x)<1e-6)break;f-=w/x}var M=0,C=1;for(f=s,g=0;g<20&&(w=this.sampleCurveX(f),!(Math.abs(w-s)<l));g++)s>w?M=f:C=f,f=.5*(C-M)+M;return f},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},Hh}());class Ir{constructor(s,l,f,g,w){this.type=s,this.operator=l,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[x,M]of w)this.labels.push(x),this.outputs.push(M)}static interpolationFactor(s,l,f,g){let w=0;if("exponential"===s.name)w=Qc(l,s.base,f,g);else if("linear"===s.name)w=Qc(l,1,f,g);else if("cubic-bezier"===s.name){const x=s.controlPoints;w=new Xc(x[0],x[1],x[2],x[3]).solve(Qc(l,1,f,g))}return w}static parse(s,l){let[f,g,w,...x]=s;if(!Array.isArray(g)||0===g.length)return l.error("Expected an interpolation type expression.",1);if("linear"===g[0])g={name:"linear"};else if("exponential"===g[0]){const P=g[1];if("number"!=typeof P)return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:P}}else{if("cubic-bezier"!==g[0])return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const P=g.slice(1);if(4!==P.length||P.some(N=>"number"!=typeof N||N<0||N>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:P}}}if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(w=l.parse(w,2,it),!w)return null;const M=[];let C=null;"interpolate-hcl"!==f&&"interpolate-lab"!==f||l.expectedType==on?l.expectedType&&"value"!==l.expectedType.kind&&(C=l.expectedType):C=Dr;for(let P=0;P<x.length;P+=2){const N=x[P],L=x[P+1],j=P+3,U=P+4;if("number"!=typeof N)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(M.length&&M[M.length-1][0]>=N)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const $=l.parse(L,U,C);if(!$)return null;C=C||$.type,M.push([N,$])}return Zl(C,it)||Zl(C,Te)||Zl(C,Dr)||Zl(C,Qd)||Zl(C,$c)||Zl(C,on)||Zl(C,Hc)||Zl(C,Oo(it))?new Ir(C,f,g,w,M):l.error(`Type ${$n(C)} is not interpolatable.`)}evaluate(s){const l=this.labels,f=this.outputs;if(1===l.length)return f[0].evaluate(s);const g=this.input.evaluate(s);if(g<=l[0])return f[0].evaluate(s);const w=l.length;if(g>=l[w-1])return f[w-1].evaluate(s);const x=Ds(l,g),M=Ir.interpolationFactor(this.interpolation,g,l[x],l[x+1]),C=f[x].evaluate(s),P=f[x+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Pa(C,P,M);case"color":return nn.interpolate(C,P,M);case"padding":return rr.interpolate(C,P,M);case"colorArray":return Mi.interpolate(C,P,M);case"numberArray":return pr.interpolate(C,P,M);case"variableAnchorOffsetCollection":return co.interpolate(C,P,M);case"array":return Kl(C,P,M);case"projectionDefinition":return or.interpolate(C,P,M)}case"interpolate-hcl":switch(this.type.kind){case"color":return nn.interpolate(C,P,M,"hcl");case"colorArray":return Mi.interpolate(C,P,M,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return nn.interpolate(C,P,M,"lab");case"colorArray":return Mi.interpolate(C,P,M,"lab")}}}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Qc(c,s,l,f){const g=f-l,w=c-l;return 0===g?0:1===s?w/g:(Math.pow(s,w)-1)/(Math.pow(s,g)-1)}const Js={color:nn.interpolate,number:Pa,padding:rr.interpolate,numberArray:pr.interpolate,colorArray:Mi.interpolate,variableAnchorOffsetCollection:co.interpolate,array:Kl};class Xu{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let f=null;const g=l.expectedType;g&&"value"!==g.kind&&(f=g);const w=[];for(const M of s.slice(1)){const C=l.parse(M,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,w.push(C)}if(!f)throw new Error("No output type");const x=g&&w.some(M=>Vt(g,M.type));return new Xu(x?At:f,w)}evaluate(s){let l,f=null,g=0;for(const w of this.args)if(g++,f=w.evaluate(s),f&&f instanceof Fo&&!f.available&&(l||(l=f.name),f=null,g===this.args.length&&(f=l)),null!==f)break;return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}function Xl(c,s){return"=="===c||"!="===c?"boolean"===s.kind||"string"===s.kind||"number"===s.kind||"null"===s.kind||"value"===s.kind:"string"===s.kind||"number"===s.kind||"value"===s.kind}function Jc(c,s,l,f){return 0===f.compare(s,l)}function Gn(c,s,l){const f="=="!==c&&"!="!==c;return class h4{constructor(w,x,M){this.type=Xt,this.lhs=w,this.rhs=x,this.collator=M,this.hasUntypedArgument="value"===w.type.kind||"value"===x.type.kind}static parse(w,x){if(3!==w.length&&4!==w.length)return x.error("Expected two or three arguments.");const M=w[0];let C=x.parse(w[1],1,At);if(!C)return null;if(!Xl(M,C.type))return x.concat(1).error(`"${M}" comparisons are not supported for type '${$n(C.type)}'.`);let P=x.parse(w[2],2,At);if(!P)return null;if(!Xl(M,P.type))return x.concat(2).error(`"${M}" comparisons are not supported for type '${$n(P.type)}'.`);if(C.type.kind!==P.type.kind&&"value"!==C.type.kind&&"value"!==P.type.kind)return x.error(`Cannot compare types '${$n(C.type)}' and '${$n(P.type)}'.`);f&&("value"===C.type.kind&&"value"!==P.type.kind?C=new uo(P.type,[C]):"value"!==C.type.kind&&"value"===P.type.kind&&(P=new uo(C.type,[P])));let N=null;if(4===w.length){if("string"!==C.type.kind&&"string"!==P.type.kind&&"value"!==C.type.kind&&"value"!==P.type.kind)return x.error("Cannot use collator to compare non-string types.");if(N=x.parse(w[3],3,oi),!N)return null}return new h4(C,P,N)}evaluate(w){const x=this.lhs.evaluate(w),M=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const C=It(x),P=It(M);if(C.kind!==P.kind||"string"!==C.kind&&"number"!==C.kind)throw new En(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${C.kind}, ${P.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=It(x),P=It(M);if("string"!==C.kind||"string"!==P.kind)return s(w,x,M)}return this.collator?l(w,x,M,this.collator.evaluate(w)):s(w,x,M)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const nf=Gn("==",function(c,s,l){return s===l},Jc),rf=Gn("!=",function(c,s,l){return s!==l},function(c,s,l,f){return!Jc(0,s,l,f)}),L0=Gn("<",function(c,s,l){return s<l},function(c,s,l,f){return f.compare(s,l)<0}),ka=Gn(">",function(c,s,l){return s>l},function(c,s,l,f){return f.compare(s,l)>0}),sf=Gn("<=",function(c,s,l){return s<=l},function(c,s,l,f){return f.compare(s,l)<=0}),Nm=Gn(">=",function(c,s,l){return s>=l},function(c,s,l,f){return f.compare(s,l)>=0});class qh{constructor(s,l,f){this.type=oi,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=l}static parse(s,l){if(2!==s.length)return l.error("Expected one argument.");const f=s[1];if("object"!=typeof f||Array.isArray(f))return l.error("Collator options argument must be an object.");const g=l.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,Xt);if(!g)return null;const w=l.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,Xt);if(!w)return null;let x=null;return f.locale&&(x=l.parse(f.locale,1,Pt),!x)?null:new qh(g,w,x)}evaluate(s){return new Ys(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}class Ft{constructor(s,l,f,g,w){this.type=Pt,this.number=s,this.locale=l,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(s,l){if(3!==s.length)return l.error("Expected two arguments.");const f=l.parse(s[1],1,it);if(!f)return null;const g=s[2];if("object"!=typeof g||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=l.parse(g.locale,1,Pt),!w))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,Pt),!x))return null;let M=null;if(g["min-fraction-digits"]&&(M=l.parse(g["min-fraction-digits"],1,it),!M))return null;let C=null;return g["max-fraction-digits"]&&(C=l.parse(g["max-fraction-digits"],1,it),!C)?null:new Ft(f,w,x,M,C)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class gl{constructor(s){this.type=Wl,this.sections=s}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&"object"==typeof f)return l.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=s.length-1;++x){const M=s[x];if(w&&"object"==typeof M&&!Array.isArray(M)){w=!1;let C=null;if(M["font-scale"]&&(C=l.parse(M["font-scale"],1,it),!C))return null;let P=null;if(M["text-font"]&&(P=l.parse(M["text-font"],1,Oo(Pt)),!P))return null;let N=null;if(M["text-color"]&&(N=l.parse(M["text-color"],1,Dr),!N))return null;let L=null;if(M["vertical-align"]){if("string"==typeof M["vertical-align"]&&!Yl.includes(M["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${M["vertical-align"]}' instead.`);if(L=l.parse(M["vertical-align"],1,Pt),!L)return null}const j=g[g.length-1];j.scale=C,j.font=P,j.textColor=N,j.verticalAlign=L}else{const C=l.parse(s[x],1,At);if(!C)return null;const P=C.type.kind;if("string"!==P&&"value"!==P&&"null"!==P&&"resolvedImage"!==P)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new gl(g)}evaluate(s){return new $e(this.sections.map(l=>{const f=l.content.evaluate(s);return It(f)===Sn?new Zc("",f,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(s):null):new Zc(Gt(f),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null,l.verticalAlign?l.verticalAlign.evaluate(s):null)}))}eachChild(s){for(const l of this.sections)s(l.content),l.scale&&s(l.scale),l.font&&s(l.font),l.textColor&&s(l.textColor),l.verticalAlign&&s(l.verticalAlign)}outputDefined(){return!1}}class me{constructor(s){this.type=Sn,this.input=s}static parse(s,l){if(2!==s.length)return l.error("Expected two arguments.");const f=l.parse(s[1],1,Pt);return f?new me(f):l.error("No image name provided.")}evaluate(s){const l=this.input.evaluate(s),f=Fo.fromString(l);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(l)>-1),f}eachChild(s){s(this.input)}outputDefined(){return!1}}class ml{constructor(s){this.type=it,this.input=s}static parse(s,l){if(2!==s.length)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=l.parse(s[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?l.error(`Expected argument of type string or array, but found ${$n(f.type)} instead.`):new ml(f):null}evaluate(s){const l=this.input.evaluate(s);if("string"==typeof l)return[...l].length;if(Array.isArray(l))return l.length;throw new En(`Expected value to be of type string or array, but found ${$n(It(l))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Cs=8192;function af(c,s){const l=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,g=Math.pow(2,s.z);return[Math.round(l*g*Cs),Math.round(f*g*Cs)]}function _l(c,s){const l=Math.pow(2,s.z);return[(g=(c[0]/Cs+s.x)/l,360*g-180),(f=(c[1]/Cs+s.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,g}function Qu(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function Ts(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function km(c,s,l){const f=c[0]-s[0],g=c[1]-s[1],w=c[0]-l[0],x=c[1]-l[1];return f*x-w*g==0&&f*w<=0&&g*x<=0}function ho(c,s,l,f){return(g=[f[0]-l[0],f[1]-l[1]])[0]*(w=[s[0]-c[0],s[1]-c[1]])[1]-g[1]*w[0]!=0&&!(!lf(c,s,l,f)||!lf(l,f,c,s));var g,w}function eu(c,s,l){for(const f of l)for(let g=0;g<f.length-1;++g)if(ho(c,s,f[g],f[g+1]))return!0;return!1}function yl(c,s,l=!1){let f=!1;for(const M of s)for(let C=0;C<M.length-1;C++){if(km(c,M[C],M[C+1]))return l;(w=M[C])[1]>(g=c)[1]!=(x=M[C+1])[1]>g[1]&&g[0]<(x[0]-w[0])*(g[1]-w[1])/(x[1]-w[1])+w[0]&&(f=!f)}var g,w,x;return f}function Ju(c,s){for(const l of s)if(yl(c,l))return!0;return!1}function tu(c,s){for(const l of c)if(!yl(l,s))return!1;for(let l=0;l<c.length-1;++l)if(eu(c[l],c[l+1],s))return!1;return!0}function kp(c,s){for(const l of s)if(tu(c,l))return!0;return!1}function lf(c,s,l,f){const g=f[0]-l[0],w=f[1]-l[1],x=(c[0]-l[0])*w-g*(c[1]-l[1]),M=(s[0]-l[0])*w-g*(s[1]-l[1]);return x>0&&M<0||x<0&&M>0}function nu(c,s,l){const f=[];for(let g=0;g<c.length;g++){const w=[];for(let x=0;x<c[g].length;x++){const M=af(c[g][x],l);Qu(s,M),w.push(M)}f.push(w)}return f}function Wh(c,s,l){const f=[];for(let g=0;g<c.length;g++){const w=nu(c[g],s,l);f.push(w)}return f}function vl(c,s,l,f){if(c[0]<l[0]||c[0]>l[2]){const g=.5*f;let w=c[0]-l[0]>g?-f:l[0]-c[0]>g?f:0;0===w&&(w=c[0]-l[2]>g?-f:l[2]-c[0]>g?f:0),c[0]+=w}Qu(s,c)}function Op(c,s,l,f){const g=Math.pow(2,f.z)*Cs,w=[f.x*Cs,f.y*Cs],x=[];for(const M of c)for(const C of M){const P=[C.x+w[0],C.y+w[1]];vl(P,s,l,g),x.push(P)}return x}function Is(c,s,l,f){const g=Math.pow(2,f.z)*Cs,w=[f.x*Cs,f.y*Cs],x=[];for(const C of c){const P=[];for(const N of C){const L=[N.x+w[0],N.y+w[1]];Qu(s,L),P.push(L)}x.push(P)}if(s[2]-s[0]<=g/2){(M=s)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const C of x)for(const P of C)vl(P,s,l,g)}var M;return x}class In{constructor(s,l){this.type=Xt,this.geojson=s,this.geometries=l}static parse(s,l){if(2!==s.length)return l.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Kc(s[1])){const f=s[1];if("FeatureCollection"===f.type){const g=[];for(const w of f.features){const{type:x,coordinates:M}=w.geometry;"Polygon"===x&&g.push(M),"MultiPolygon"===x&&g.push(...M)}if(g.length)return new In(f,{type:"MultiPolygon",coordinates:g})}else if("Feature"===f.type){const g=f.geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new In(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new In(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(null!=s.geometry()&&null!=s.canonicalID()){if("Point"===s.geometryType())return function(l,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===f.type){const M=nu(f.coordinates,w,x),C=Op(l.geometry(),g,w,x);if(!Ts(g,w))return!1;for(const P of C)if(!yl(P,M))return!1}if("MultiPolygon"===f.type){const M=Wh(f.coordinates,w,x),C=Op(l.geometry(),g,w,x);if(!Ts(g,w))return!1;for(const P of C)if(!Ju(P,M))return!1}return!0}(s,this.geometries);if("LineString"===s.geometryType())return function(l,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===f.type){const M=nu(f.coordinates,w,x),C=Is(l.geometry(),g,w,x);if(!Ts(g,w))return!1;for(const P of C)if(!tu(P,M))return!1}if("MultiPolygon"===f.type){const M=Wh(f.coordinates,w,x),C=Is(l.geometry(),g,w,x);if(!Ts(g,w))return!1;for(const P of C)if(!kp(P,M))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ea=class{constructor(c=[],s=(l,f)=>l<f?-1:l>f?1:0){if(this.data=c,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(0===this.length)return;const c=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:s,compare:l}=this,f=s[c];for(;c>0;){const g=c-1>>1,w=s[g];if(l(f,w)>=0)break;s[c]=w,c=g}s[c]=f}_down(c){const{data:s,compare:l}=this,f=this.length>>1,g=s[c];for(;c<f;){let w=1+(c<<1);const x=w+1;if(x<this.length&&l(s[x],s[w])<0&&(w=x),l(s[w],g)>=0)break;s[c]=s[w],c=w}s[c]=g}};function Zh(c,s,l=0,f=c.length-1,g=Kh){for(;f>l;){if(f-l>600){const C=f-l+1,P=s-l+1,N=Math.log(C),L=.5*Math.exp(2*N/3),j=.5*Math.sqrt(N*L*(C-L)/C)*(P-C/2<0?-1:1);Zh(c,s,Math.max(l,Math.floor(s-P*L/C+j)),Math.min(f,Math.floor(s+(C-P)*L/C+j)),g)}const w=c[s];let x=l,M=f;for(Ql(c,l,s),g(c[f],w)>0&&Ql(c,l,f);x<M;){for(Ql(c,x,M),x++,M--;g(c[x],w)<0;)x++;for(;g(c[M],w)>0;)M--}0===g(c[l],w)?Ql(c,l,M):(M++,Ql(c,M,f)),M<=s&&(l=M+1),s<=M&&(f=M-1)}}function Ql(c,s,l){const f=c[s];c[s]=c[l],c[l]=f}function Kh(c,s){return c<s?-1:c>s?1:0}function Eo(c,s){if(c.length<=1)return[c];const l=[];let f,g;for(const w of c){const x=Rn(w);0!==x&&(w.area=Math.abs(x),void 0===g&&(g=x<0),g===x<0?(f&&l.push(f),f=[w]):f.push(w))}if(f&&l.push(f),s>1)for(let w=0;w<l.length;w++)l[w].length<=s||(Zh(l[w],s,1,l[w].length-1,Yh),l[w]=l[w].slice(0,s));return l}function Yh(c,s){return s.area-c.area}function Rn(c){let s=0;for(let l,f,g=0,w=c.length,x=w-1;g<w;x=g++)l=c[g],f=c[x],s+=(f.x-l.x)*(l.y+f.y);return s}const Om=1/298.257223563,Kr=Om*(2-Om),Lo=Math.PI/180;class bl{constructor(s){const l=6378.137*Lo*1e3,f=Math.cos(s*Lo),g=1/(1-Kr*(1-f*f)),w=Math.sqrt(g);this.kx=l*w*f,this.ky=l*w*g*(1-Kr)}distance(s,l){const f=this.wrap(s[0]-l[0])*this.kx,g=(s[1]-l[1])*this.ky;return Math.sqrt(f*f+g*g)}pointOnLine(s,l){let f,g,w,x,M=1/0;for(let C=0;C<s.length-1;C++){let P=s[C][0],N=s[C][1],L=this.wrap(s[C+1][0]-P)*this.kx,j=(s[C+1][1]-N)*this.ky,U=0;0===L&&0===j||(U=(this.wrap(l[0]-P)*this.kx*L+(l[1]-N)*this.ky*j)/(L*L+j*j),U>1?(P=s[C+1][0],N=s[C+1][1]):U>0&&(P+=L/this.kx*U,N+=j/this.ky*U)),L=this.wrap(l[0]-P)*this.kx,j=(l[1]-N)*this.ky;const $=L*L+j*j;$<M&&(M=$,f=P,g=N,w=C,x=U)}return{point:[f,g],index:w,t:Math.max(0,Math.min(1,x))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}}function eh(c,s){return s[0]-c[0]}function Xh(c){return c[1]-c[0]+1}function Oa(c,s){return c[1]>=c[0]&&c[1]<s}function yn(c,s){if(c[0]>c[1])return[null,null];const l=Xh(c);if(s){if(2===l)return[c,null];const g=Math.floor(l/2);return[[c[0],c[0]+g],[c[0]+g,c[1]]]}if(1===l)return[c,null];const f=Math.floor(l/2)-1;return[[c[0],c[0]+f],[c[0]+f+1,c[1]]]}function Qh(c,s){if(!Oa(s,c.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let f=s[0];f<=s[1];++f)Qu(l,c[f]);return l}function iu(c){const s=[1/0,1/0,-1/0,-1/0];for(const l of c)for(const f of l)Qu(s,f);return s}function Fm(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function th(c,s,l){if(!Fm(c)||!Fm(s))return NaN;let f=0,g=0;return c[2]<s[0]&&(f=s[0]-c[2]),c[0]>s[2]&&(f=c[0]-s[2]),c[1]>s[3]&&(g=c[1]-s[3]),c[3]<s[1]&&(g=s[1]-c[3]),l.distance([0,0],[f,g])}function Jl(c,s,l){const f=l.pointOnLine(s,c);return l.distance(c,f.point)}function nh(c,s,l,f,g){const w=Math.min(Jl(c,[l,f],g),Jl(s,[l,f],g)),x=Math.min(Jl(l,[c,s],g),Jl(f,[c,s],g));return Math.min(w,x)}function Fp(c,s,l,f,g){if(!Oa(s,c.length)||!Oa(f,l.length))return 1/0;let w=1/0;for(let x=s[0];x<s[1];++x){const M=c[x],C=c[x+1];for(let P=f[0];P<f[1];++P){const N=l[P],L=l[P+1];if(ho(M,C,N,L))return 0;w=Math.min(w,nh(M,C,N,L,g))}}return w}function Lp(c,s,l,f,g){if(!Oa(s,c.length)||!Oa(f,l.length))return NaN;let w=1/0;for(let x=s[0];x<=s[1];++x)for(let M=f[0];M<=f[1];++M)if(w=Math.min(w,g.distance(c[x],l[M])),0===w)return w;return w}function Fa(c,s,l){if(yl(c,s,!0))return 0;let f=1/0;for(const g of s){const w=g[0],x=g[g.length-1];if(w!==x&&(f=Math.min(f,Jl(c,[x,w],l)),0===f))return f;const M=l.pointOnLine(g,c);if(f=Math.min(f,l.distance(c,M.point)),0===f)return f}return f}function Bp(c,s,l,f){if(!Oa(s,c.length))return NaN;for(let w=s[0];w<=s[1];++w)if(yl(c[w],l,!0))return 0;let g=1/0;for(let w=s[0];w<s[1];++w){const x=c[w],M=c[w+1];for(const C of l)for(let P=0,N=C.length,L=N-1;P<N;L=P++){const j=C[L],U=C[P];if(ho(x,M,j,U))return 0;g=Math.min(g,nh(x,M,j,U,f))}}return g}function Jh(c,s){for(const l of c)for(const f of l)if(yl(f,s,!0))return!0;return!1}function ed(c,s,l,f=1/0){const g=iu(c),w=iu(s);if(f!==1/0&&th(g,w,l)>=f)return f;if(Ts(g,w)){if(Jh(c,s))return 0}else if(Jh(s,c))return 0;let x=1/0;for(const M of c)for(let C=0,P=M.length,N=P-1;C<P;N=C++){const L=M[N],j=M[C];for(const U of s)for(let $=0,Z=U.length,J=Z-1;$<Z;J=$++){const ie=U[J],be=U[$];if(ho(L,j,ie,be))return 0;x=Math.min(x,nh(L,j,ie,be,l))}}return x}function cf(c,s,l,f,g,w){if(!w)return;const x=th(Qh(f,w),g,l);x<s&&c.push([x,w,[0,0]])}function ru(c,s,l,f,g,w,x){if(!w||!x)return;const M=th(Qh(f,w),Qh(g,x),l);M<s&&c.push([M,w,x])}function ec(c,s,l,f,g=1/0){let w=Math.min(f.distance(c[0],l[0][0]),g);if(0===w)return w;const x=new ea([[0,[0,c.length-1],[0,0]]],eh),M=iu(l);for(;x.length>0;){const C=x.pop();if(C[0]>=w)continue;const P=C[1],N=s?50:100;if(Xh(P)<=N){if(!Oa(P,c.length))return NaN;if(s){const L=Bp(c,P,l,f);if(isNaN(L)||0===L)return L;w=Math.min(w,L)}else for(let L=P[0];L<=P[1];++L){const j=Fa(c[L],l,f);if(w=Math.min(w,j),0===w)return 0}}else{const L=yn(P,s);cf(x,w,f,c,M,L[0]),cf(x,w,f,c,M,L[1])}}return w}function sr(c,s,l,f,g,w=1/0){let x=Math.min(w,g.distance(c[0],l[0]));if(0===x)return x;const M=new ea([[0,[0,c.length-1],[0,l.length-1]]],eh);for(;M.length>0;){const C=M.pop();if(C[0]>=x)continue;const P=C[1],N=C[2],L=s?50:100,j=f?50:100;if(Xh(P)<=L&&Xh(N)<=j){if(!Oa(P,c.length)&&Oa(N,l.length))return NaN;let U;if(s&&f)U=Fp(c,P,l,N,g),x=Math.min(x,U);else if(s&&!f){const $=c.slice(P[0],P[1]+1);for(let Z=N[0];Z<=N[1];++Z)if(U=Jl(l[Z],$,g),x=Math.min(x,U),0===x)return x}else if(!s&&f){const $=l.slice(N[0],N[1]+1);for(let Z=P[0];Z<=P[1];++Z)if(U=Jl(c[Z],$,g),x=Math.min(x,U),0===x)return x}else U=Lp(c,P,l,N,g),x=Math.min(x,U)}else{const U=yn(P,s),$=yn(N,f);ru(M,x,g,c,l,U[0],$[0]),ru(M,x,g,c,l,U[0],$[1]),ru(M,x,g,c,l,U[1],$[0]),ru(M,x,g,c,l,U[1],$[1])}}return x}function La(c){return"MultiPolygon"===c.type?c.coordinates.map(s=>({type:"Polygon",coordinates:s})):"MultiLineString"===c.type?c.coordinates.map(s=>({type:"LineString",coordinates:s})):"MultiPoint"===c.type?c.coordinates.map(s=>({type:"Point",coordinates:s})):[c]}class Ba{constructor(s,l){this.type=it,this.geojson=s,this.geometries=l}static parse(s,l){if(2!==s.length)return l.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Kc(s[1])){const f=s[1];if("FeatureCollection"===f.type)return new Ba(f,f.features.map(g=>La(g.geometry)).flat());if("Feature"===f.type)return new Ba(f,La(f.geometry));if("type"in f&&"coordinates"in f)return new Ba(f,La(f))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(null!=s.geometry()&&null!=s.canonicalID()){if("Point"===s.geometryType())return function(l,f){const g=l.geometry(),w=g.flat().map(C=>_l([C.x,C.y],l.canonical));if(0===g.length)return NaN;const x=new bl(w[0][1]);let M=1/0;for(const C of f){switch(C.type){case"Point":M=Math.min(M,sr(w,!1,[C.coordinates],!1,x,M));break;case"LineString":M=Math.min(M,sr(w,!1,C.coordinates,!0,x,M));break;case"Polygon":M=Math.min(M,ec(w,!1,C.coordinates,x,M))}if(0===M)return M}return M}(s,this.geometries);if("LineString"===s.geometryType())return function(l,f){const g=l.geometry(),w=g.flat().map(C=>_l([C.x,C.y],l.canonical));if(0===g.length)return NaN;const x=new bl(w[0][1]);let M=1/0;for(const C of f){switch(C.type){case"Point":M=Math.min(M,sr(w,!0,[C.coordinates],!1,x,M));break;case"LineString":M=Math.min(M,sr(w,!0,C.coordinates,!0,x,M));break;case"Polygon":M=Math.min(M,ec(w,!0,C.coordinates,x,M))}if(0===M)return M}return M}(s,this.geometries);if("Polygon"===s.geometryType())return function(l,f){const g=l.geometry();if(0===g.length||0===g[0].length)return NaN;const w=Eo(g,0).map(C=>C.map(P=>P.map(N=>_l([N.x,N.y],l.canonical)))),x=new bl(w[0][0][0][1]);let M=1/0;for(const C of f)for(const P of w){switch(C.type){case"Point":M=Math.min(M,ec([C.coordinates],!1,P,x,M));break;case"LineString":M=Math.min(M,ec(C.coordinates,!0,P,x,M));break;case"Polygon":M=Math.min(M,ed(P,C.coordinates,x,M))}if(0===M)return M}return M}(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ih{constructor(s){this.type=At,this.key=s}static parse(s,l){if(2!==s.length)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=s[1];return null==f?l.error("Global state property must be defined."):"string"!=typeof f?l.error(`Global state property must be string, but found ${typeof s[1]} instead.`):new ih(f)}evaluate(s){var l;const f=null===(l=s.globals)||void 0===l?void 0:l.globalState;return f&&0!==Object.keys(f).length?Ku(f,this.key):null}eachChild(){}outputDefined(){return!1}}const ou={"==":nf,"!=":rf,">":ka,"<":L0,">=":Nm,"<=":sf,array:uo,at:Bt,boolean:uo,case:pl,coalesce:Xu,collator:qh,format:gl,image:me,in:dn,"index-of":Qs,interpolate:Ir,"interpolate-hcl":Ir,"interpolate-lab":Ir,length:ml,let:Na,literal:Ra,match:Tr,number:uo,"number-format":Ft,object:uo,slice:Yc,step:mi,string:uo,"to-boolean":Xs,"to-color":Xs,"to-number":Xs,"to-string":Xs,var:Yu,within:In,distance:Ba,"global-state":ih};class Bo{constructor(s,l,f,g){this.name=s,this.type=l,this._evaluate=f,this.args=g}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,l){const f=s[0],g=Bo.definitions[f];if(!g)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,M=x.filter(([P])=>!Array.isArray(P)||P.length===s.length-1);let C=null;for(const[P,N]of M){C=new us(l.registry,td,l.path,null,l.scope);const L=[];let j=!1;for(let U=1;U<s.length;U++){const $=s[U],Z=Array.isArray(P)?P[U-1]:P.type,J=C.parse($,1+L.length,Z);if(!J){j=!0;break}L.push(J)}if(!j)if(Array.isArray(P)&&P.length!==L.length)C.error(`Expected ${P.length} arguments, but found ${L.length} instead.`);else{for(let U=0;U<L.length;U++){const $=Array.isArray(P)?P[U]:P.type,Z=L[U];C.concat(U+1).checkSubtype($,Z.type)}if(0===C.errors.length)return new Bo(f,w,N,L)}}if(1===M.length)l.errors.push(...C.errors);else{const P=(M.length?M:x).map(([L])=>{return j=L,Array.isArray(j)?`(${j.map($n).join(", ")})`:`(${$n(j.type)}...)`;var j}).join(" | "),N=[];for(let L=1;L<s.length;L++){const j=l.parse(s[L],1+N.length);if(!j)return null;N.push($n(j.type))}l.error(`Expected arguments of type ${P}, but found (${N.join(", ")}) instead.`)}return null}static register(s,l){Bo.definitions=l;for(const f in l)s[f]=Bo}}function su(c,[s,l,f,g]){s=s.evaluate(c),l=l.evaluate(c),f=f.evaluate(c);const w=g?g.evaluate(c):1,x=si(s,l,f,w);if(x)throw new En(x);return new nn(s/255,l/255,f/255,w,!1)}function tc(c,s){return c in s}function uf(c,s){const l=s[c];return void 0===l?null:l}function nc(c){return{type:c}}function td(c){if(c instanceof Yu)return td(c.boundExpression);if(c instanceof Bo&&"error"===c.name||c instanceof qh||c instanceof In||c instanceof Ba||c instanceof ih)return!1;const s=c instanceof Xs||c instanceof uo;let l=!0;return c.eachChild(f=>{l=s?l&&td(f):l&&f instanceof Ra}),!!l&&au(c)&&lu(c,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function au(c){if(c instanceof Bo&&("get"===c.name&&1===c.args.length||"feature-state"===c.name||"has"===c.name&&1===c.args.length||"properties"===c.name||"geometry-type"===c.name||"id"===c.name||/^filter-/.test(c.name))||c instanceof In||c instanceof Ba)return!1;let s=!0;return c.eachChild(l=>{s&&!au(l)&&(s=!1)}),s}function Yr(c){if(c instanceof Bo&&"feature-state"===c.name)return!1;let s=!0;return c.eachChild(l=>{s&&!Yr(l)&&(s=!1)}),s}function lu(c,s){if(c instanceof Bo&&s.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(f=>{l&&!lu(f,s)&&(l=!1)}),l}function Lm(c){return{result:"success",value:c}}function ai(c){return{result:"error",value:c}}function Ue(c){return"data-driven"===c["property-type"]||"cross-faded-data-driven"===c["property-type"]}function Rt(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function _i(c){return!!c.expression&&c.expression.interpolated}function Dt(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":null===c?"null":typeof c}function Bi(c){return"object"==typeof c&&null!==c&&!Array.isArray(c)&&It(c)===fl}function ic(c){return c}function cu(c,s){const l=c.stops&&"object"==typeof c.stops[0][0],f=l||!(l||void 0!==c.property),g=c.type||(_i(s)?"exponential":"interval"),w=function(N){switch(N.type){case"color":return nn.parse;case"padding":return rr.parse;case"numberArray":return pr.parse;case"colorArray":return Mi.parse;default:return null}}(s);if(w&&((c=Zr({},c)).stops&&(c.stops=c.stops.map(N=>[N[0],w(N[1])])),c.default=w(c.default?c.default:s.default)),c.colorSpace&&"rgb"!==(x=c.colorSpace)&&"hcl"!==x&&"lab"!==x)throw new Error(`Unknown color space: "${c.colorSpace}"`);var x;const M=function(N){switch(N){case"exponential":return Wt;case"interval":return hs;case"categorical":return Yn;case"identity":return rc;default:throw new Error(`Unknown function type "${N}"`)}}(g);let C,P;if("categorical"===g){C=Object.create(null);for(const N of c.stops)C[N[0]]=N[1];P=typeof c.stops[0][0]}if(l){const N={},L=[];for(let $=0;$<c.stops.length;$++){const Z=c.stops[$],J=Z[0].zoom;void 0===N[J]&&(N[J]={zoom:J,type:c.type,property:c.property,default:c.default,stops:[]},L.push(J)),N[J].stops.push([Z[0].value,Z[1]])}const j=[];for(const $ of L)j.push([N[$].zoom,cu(N[$],s)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Ir.interpolationFactor.bind(void 0,U),zoomStops:j.map($=>$[0]),evaluate:({zoom:$},Z)=>Wt({stops:j,base:c.base},s,$).evaluate($,Z)}}if(f){const N="exponential"===g?{name:"exponential",base:void 0!==c.base?c.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Ir.interpolationFactor.bind(void 0,N),zoomStops:c.stops.map(L=>L[0]),evaluate:({zoom:L})=>M(c,s,L,C,P)}}return{kind:"source",evaluate(N,L){const j=L&&L.properties?L.properties[c.property]:void 0;return void 0===j?un(c.default,s.default):M(c,s,j,C,P)}}}function un(c,s,l){return void 0!==c?c:void 0!==s?s:void 0!==l?l:void 0}function Yn(c,s,l,f,g){return un(typeof l===g?f[l]:void 0,c.default,s.default)}function hs(c,s,l){if("number"!==Dt(l))return un(c.default,s.default);const f=c.stops.length;if(1===f||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[f-1][0])return c.stops[f-1][1];const g=Ds(c.stops.map(w=>w[0]),l);return c.stops[g][1]}function Wt(c,s,l){const f=void 0!==c.base?c.base:1;if("number"!==Dt(l))return un(c.default,s.default);const g=c.stops.length;if(1===g||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[g-1][0])return c.stops[g-1][1];const w=Ds(c.stops.map(N=>N[0]),l),x=function(N,L,j,U){const $=U-j,Z=N-j;return 0===$?0:1===L?Z/$:(Math.pow(L,Z)-1)/(Math.pow(L,$)-1)}(l,f,c.stops[w][0],c.stops[w+1][0]),M=c.stops[w][1],C=c.stops[w+1][1],P=Js[s.type]||ic;return"function"==typeof M.evaluate?{evaluate(...N){const L=M.evaluate.apply(void 0,N),j=C.evaluate.apply(void 0,N);if(void 0!==L&&void 0!==j)return P(L,j,x,c.colorSpace)}}:P(M,C,x,c.colorSpace)}function rc(c,s,l){switch(s.type){case"color":l=nn.parse(l);break;case"formatted":l=$e.fromString(l.toString());break;case"resolvedImage":l=Fo.fromString(l.toString());break;case"padding":l=rr.parse(l);break;case"colorArray":l=Mi.parse(l);break;case"numberArray":l=pr.parse(l);break;default:Dt(l)===s.type||"enum"===s.type&&s.values[l]||(l=void 0)}return un(l,c.default,s.default)}Bo.register(ou,{error:[{kind:"error"},[Pt],(c,[s])=>{throw new En(s.evaluate(c))}],typeof:[Pt,[At],(c,[s])=>$n(It(s.evaluate(c)))],"to-rgba":[Oo(it,4),[Dr],(c,[s])=>{const[l,f,g,w]=s.evaluate(c).rgb;return[255*l,255*f,255*g,w]}],rgb:[Dr,[it,it,it],su],rgba:[Dr,[it,it,it,it],su],has:{type:Xt,overloads:[[[Pt],(c,[s])=>tc(s.evaluate(c),c.properties())],[[Pt,fl],(c,[s,l])=>tc(s.evaluate(c),l.evaluate(c))]]},get:{type:At,overloads:[[[Pt],(c,[s])=>uf(s.evaluate(c),c.properties())],[[Pt,fl],(c,[s,l])=>uf(s.evaluate(c),l.evaluate(c))]]},"feature-state":[At,[Pt],(c,[s])=>uf(s.evaluate(c),c.featureState||{})],properties:[fl,[],c=>c.properties()],"geometry-type":[Pt,[],c=>c.geometryType()],id:[At,[],c=>c.id()],zoom:[it,[],c=>c.globals.zoom],"heatmap-density":[it,[],c=>c.globals.heatmapDensity||0],elevation:[it,[],c=>c.globals.elevation||0],"line-progress":[it,[],c=>c.globals.lineProgress||0],accumulated:[At,[],c=>void 0===c.globals.accumulated?null:c.globals.accumulated],"+":[it,nc(it),(c,s)=>{let l=0;for(const f of s)l+=f.evaluate(c);return l}],"*":[it,nc(it),(c,s)=>{let l=1;for(const f of s)l*=f.evaluate(c);return l}],"-":{type:it,overloads:[[[it,it],(c,[s,l])=>s.evaluate(c)-l.evaluate(c)],[[it],(c,[s])=>-s.evaluate(c)]]},"/":[it,[it,it],(c,[s,l])=>s.evaluate(c)/l.evaluate(c)],"%":[it,[it,it],(c,[s,l])=>s.evaluate(c)%l.evaluate(c)],ln2:[it,[],()=>Math.LN2],pi:[it,[],()=>Math.PI],e:[it,[],()=>Math.E],"^":[it,[it,it],(c,[s,l])=>Math.pow(s.evaluate(c),l.evaluate(c))],sqrt:[it,[it],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[it,[it],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[it,[it],(c,[s])=>Math.log(s.evaluate(c))],log2:[it,[it],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[it,[it],(c,[s])=>Math.sin(s.evaluate(c))],cos:[it,[it],(c,[s])=>Math.cos(s.evaluate(c))],tan:[it,[it],(c,[s])=>Math.tan(s.evaluate(c))],asin:[it,[it],(c,[s])=>Math.asin(s.evaluate(c))],acos:[it,[it],(c,[s])=>Math.acos(s.evaluate(c))],atan:[it,[it],(c,[s])=>Math.atan(s.evaluate(c))],min:[it,nc(it),(c,s)=>Math.min(...s.map(l=>l.evaluate(c)))],max:[it,nc(it),(c,s)=>Math.max(...s.map(l=>l.evaluate(c)))],abs:[it,[it],(c,[s])=>Math.abs(s.evaluate(c))],round:[it,[it],(c,[s])=>{const l=s.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[it,[it],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[it,[it],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[Xt,[Pt,At],(c,[s,l])=>c.properties()[s.value]===l.value],"filter-id-==":[Xt,[At],(c,[s])=>c.id()===s.value],"filter-type-==":[Xt,[Pt],(c,[s])=>c.geometryType()===s.value],"filter-<":[Xt,[Pt,At],(c,[s,l])=>{const f=c.properties()[s.value],g=l.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Xt,[At],(c,[s])=>{const l=c.id(),f=s.value;return typeof l==typeof f&&l<f}],"filter->":[Xt,[Pt,At],(c,[s,l])=>{const f=c.properties()[s.value],g=l.value;return typeof f==typeof g&&f>g}],"filter-id->":[Xt,[At],(c,[s])=>{const l=c.id(),f=s.value;return typeof l==typeof f&&l>f}],"filter-<=":[Xt,[Pt,At],(c,[s,l])=>{const f=c.properties()[s.value],g=l.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Xt,[At],(c,[s])=>{const l=c.id(),f=s.value;return typeof l==typeof f&&l<=f}],"filter->=":[Xt,[Pt,At],(c,[s,l])=>{const f=c.properties()[s.value],g=l.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Xt,[At],(c,[s])=>{const l=c.id(),f=s.value;return typeof l==typeof f&&l>=f}],"filter-has":[Xt,[At],(c,[s])=>s.value in c.properties()],"filter-has-id":[Xt,[],c=>null!==c.id()&&void 0!==c.id()],"filter-type-in":[Xt,[Oo(Pt)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[Xt,[Oo(At)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[Xt,[Pt,Oo(At)],(c,[s,l])=>l.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[Xt,[Pt,Oo(At)],(c,[s,l])=>function(f,g,w,x){for(;w<=x;){const M=w+x>>1;if(g[M]===f)return!0;g[M]>f?x=M-1:w=M+1}return!1}(c.properties()[s.value],l.value,0,l.value.length-1)],all:{type:Xt,overloads:[[[Xt,Xt],(c,[s,l])=>s.evaluate(c)&&l.evaluate(c)],[nc(Xt),(c,s)=>{for(const l of s)if(!l.evaluate(c))return!1;return!0}]]},any:{type:Xt,overloads:[[[Xt,Xt],(c,[s,l])=>s.evaluate(c)||l.evaluate(c)],[nc(Xt),(c,s)=>{for(const l of s)if(l.evaluate(c))return!0;return!1}]]},"!":[Xt,[Xt],(c,[s])=>!s.evaluate(c)],"is-supported-script":[Xt,[Pt],(c,[s])=>{const l=c.globals&&c.globals.isSupportedScript;return!l||l(s.evaluate(c))}],upcase:[Pt,[Pt],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[Pt,[Pt],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[Pt,nc(At),(c,s)=>s.map(l=>Gt(l.evaluate(c))).join("")],"resolved-locale":[Pt,[oi],(c,[s])=>s.evaluate(c).resolvedLocale()]});class uu{constructor(s,l){this.expression=s,this._warningHistory={},this._evaluator=new $h,this._defaultValue=l?function(f){if("color"===f.type&&Bi(f.default))return new nn(0,0,0,0);switch(f.type){case"color":return nn.parse(f.default)||null;case"padding":return rr.parse(f.default)||null;case"numberArray":return pr.parse(f.default)||null;case"colorArray":return Mi.parse(f.default)||null;case"variableAnchorOffsetCollection":return co.parse(f.default)||null;case"projectionDefinition":return or.parse(f.default)||null;default:return void 0===f.default?null:f.default}}(l):null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(s,l,f,g,w,x){return this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(s,l,f,g,w,x){this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new En(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function za(c){return Array.isArray(c)&&c.length>0&&"string"==typeof c[0]&&c[0]in ou}function li(c,s){const l=new us(ou,td,[],s?function(g){const w={color:Dr,string:Pt,number:it,enum:Pt,boolean:Xt,formatted:Wl,padding:Qd,numberArray:$c,colorArray:on,projectionDefinition:Te,resolvedImage:Sn,variableAnchorOffsetCollection:Hc};return"array"===g.type?Oo(w[g.value]||At,g.length):w[g.type]}(s):void 0),f=l.parse(c,void 0,void 0,void 0,s&&"string"===s.type?{typeAnnotation:"coerce"}:void 0);return f?Lm(new uu(f,s)):ai(l.errors)}class As{constructor(s,l){this.kind=s,this._styleExpression=l,this.isStateDependent="constant"!==s&&!Yr(l.expression),this.globalStateRefs=ds(l.expression)}evaluateWithoutErrorHandling(s,l,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,g,w,x)}evaluate(s,l,f,g,w,x){return this._styleExpression.evaluate(s,l,f,g,w,x)}}class wl{constructor(s,l,f,g){this.kind=s,this.zoomStops=f,this._styleExpression=l,this.isStateDependent="camera"!==s&&!Yr(l.expression),this.globalStateRefs=ds(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(s,l,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,g,w,x)}evaluate(s,l,f,g,w,x){return this._styleExpression.evaluate(s,l,f,g,w,x)}interpolationFactor(s,l,f){return this.interpolationType?Ir.interpolationFactor(this.interpolationType,s,l,f):0}}function ta(c,s){const l=li(c,s);if("error"===l.result)return l;const f=l.value.expression,g=au(f);if(!g&&!Ue(s))return ai([new Ei("","data expressions not supported")]);const w=lu(f,["zoom"]);if(!w&&!Rt(s))return ai([new Ei("","zoom expressions not supported")]);const x=hu(f);return x||w?x instanceof Ei?ai([x]):x instanceof Ir&&!_i(s)?ai([new Ei("",'"interpolate" expressions cannot be used with this property')]):Lm(x?new wl(g?"camera":"composite",l.value,x.labels,x instanceof Ir?x.interpolation:void 0):new As(g?"constant":"source",l.value)):ai([new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ja{constructor(s,l){this._parameters=s,this._specification=l,Zr(this,cu(this._parameters,this._specification))}static deserialize(s){return new ja(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function hu(c){let s=null;if(c instanceof Na)s=hu(c.result);else if(c instanceof Xu){for(const l of c.args)if(s=hu(l),s)break}else(c instanceof mi||c instanceof Ir)&&c.input instanceof Bo&&"zoom"===c.input.name&&(s=c);return s instanceof Ei||c.eachChild(l=>{const f=hu(l);f instanceof Ei?s=f:!s&&f?s=new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&f&&s!==f&&(s=new Ei("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function ds(c,s=new Set){return c instanceof ih&&s.add(c.key),c.eachChild(l=>{ds(l,s)}),s}function du(c){if(!0===c||!1===c)return!0;if(!Array.isArray(c)||0===c.length)return!1;switch(c[0]){case"has":return c.length>=2&&"$id"!==c[1]&&"$type"!==c[1];case"in":return c.length>=3&&("string"!=typeof c[1]||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==c.length||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!du(s)&&"boolean"!=typeof s)return!1;return!0;default:return!0}}const Va={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function gr(c){if(null==c)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};du(c)||(c=Ua(c));const s=li(c,Va);if("error"===s.result)throw new Error(s.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,f,g)=>s.value.evaluate(l,f,{},g),needGeometry:Ct(c),getGlobalStateRefs:()=>ds(s.value.expression)}}function xl(c,s){return c<s?-1:c>s?1:0}function Ct(c){if(!Array.isArray(c))return!1;if("within"===c[0]||"distance"===c[0])return!0;for(let s=1;s<c.length;s++)if(Ct(c[s]))return!0;return!1}function Ua(c){if(!c)return!0;const s=c[0];return c.length<=1?"any"!==s:"=="===s?na(c[1],c[2],"=="):"!="===s?Ga(na(c[1],c[2],"==")):"<"===s||">"===s||"<="===s||">="===s?na(c[1],c[2],s):"any"===s?(l=c.slice(1),["any"].concat(l.map(Ua))):"all"===s?["all"].concat(c.slice(1).map(Ua)):"none"===s?["all"].concat(c.slice(1).map(Ua).map(Ga)):"in"===s?ia(c[1],c.slice(2)):"!in"===s?Ga(ia(c[1],c.slice(2))):"has"===s?rh(c[1]):"!has"!==s||Ga(rh(c[1]));var l}function na(c,s,l){switch(c){case"$type":return[`filter-type-${l}`,s];case"$id":return[`filter-id-${l}`,s];default:return[`filter-${l}`,c,s]}}function ia(c,s){if(0===s.length)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(l=>typeof l!=typeof s[0])?["filter-in-large",c,["literal",s.sort(xl)]]:["filter-in-small",c,["literal",s]]}}function rh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ga(c){return["!",c]}function ci(c){const s=typeof c;if("number"===s||"boolean"===s||"string"===s||null==c)return JSON.stringify(c);if(Array.isArray(c)){let g="[";for(const w of c)g+=`${ci(w)},`;return`${g}]`}const l=Object.keys(c).sort();let f="{";for(let g=0;g<l.length;g++)f+=`${JSON.stringify(l[g])}:${ci(c[l[g]])},`;return`${f}}`}function Di(c){let s="";for(const l of Nt)s+=`/${ci(c[l])}`;return s}function Lr(c){const s=c.value;return s?[new qe(c.key,s,"constants have been deprecated as of v8")]:[]}function yi(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Ar(c){if(Array.isArray(c))return c.map(Ar);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const l in c)s[l]=Ar(c[l]);return s}return yi(c)}function Br(c){const s=c.key,l=c.value,f=c.valueSpec||{},g=c.objectElementValidators||{},w=c.style,x=c.styleSpec,M=c.validateSpec;let C=[];const P=Dt(l);if("object"!==P)return[new qe(s,l,`object expected, ${P} found`)];for(const N in l){const L=N.split(".")[0],j=Ku(f,L)||f["*"];let U;if(Ku(g,L))U=g[L];else if(Ku(f,L))U=M;else if(g["*"])U=g["*"];else{if(!f["*"]){C.push(new qe(s,l[N],`unknown property "${N}"`));continue}U=M}C=C.concat(U({key:(s&&`${s}.`)+N,value:l[N],valueSpec:j,style:w,styleSpec:x,object:l,objectKey:N,validateSpec:M},l))}for(const N in f)g[N]||f[N].required&&void 0===f[N].default&&void 0===l[N]&&C.push(new qe(s,l,`missing required property "${N}"`));return C}function Xr(c){const s=c.value,l=c.valueSpec,f=c.style,g=c.styleSpec,w=c.key,x=c.arrayElementValidator||c.validateSpec;if("array"!==Dt(s))return[new qe(w,s,`array expected, ${Dt(s)} found`)];if(l.length&&s.length!==l.length)return[new qe(w,s,`array length ${l.length} expected, length ${s.length} found`)];if(l["min-length"]&&s.length<l["min-length"])return[new qe(w,s,`array length at least ${l["min-length"]} expected, length ${s.length} found`)];let M={type:l.value,values:l.values};g.$version<7&&(M.function=l.function),"object"===Dt(l.value)&&(M=l.value);let C=[];for(let P=0;P<s.length;P++)C=C.concat(x({array:s,arrayIndex:P,value:s[P],valueSpec:M,validateSpec:c.validateSpec,style:f,styleSpec:g,key:`${w}[${P}]`}));return C}function fs(c){const s=c.key,l=c.value,f=c.valueSpec;let g=Dt(l);return"number"===g&&l!=l&&(g="NaN"),"number"!==g?[new qe(s,l,`number expected, ${g} found`)]:"minimum"in f&&l<f.minimum?[new qe(s,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new qe(s,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function Bm(c){const s=c.valueSpec,l=yi(c.value.type);let f,g,w,x={};const M="categorical"!==l&&void 0===c.value.property,C=!M,P="array"===Dt(c.value.stops)&&"array"===Dt(c.value.stops[0])&&"object"===Dt(c.value.stops[0][0]),N=Br({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(U){if("identity"===l)return[new qe(U.key,U.value,'identity function may not have a "stops" property')];let $=[];const Z=U.value;return $=$.concat(Xr({key:U.key,value:Z,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:L})),"array"===Dt(Z)&&0===Z.length&&$.push(new qe(U.key,Z,"array must have at least one stop")),$},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:s,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return"identity"===l&&M&&N.push(new qe(c.key,c.value,'missing required property "property"')),"identity"===l||c.value.stops||N.push(new qe(c.key,c.value,'missing required property "stops"')),"exponential"===l&&c.valueSpec.expression&&!_i(c.valueSpec)&&N.push(new qe(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!Ue(c.valueSpec)?N.push(new qe(c.key,c.value,"property functions not supported")):M&&!Rt(c.valueSpec)&&N.push(new qe(c.key,c.value,"zoom functions not supported"))),"categorical"!==l&&!P||void 0!==c.value.property||N.push(new qe(c.key,c.value,'"property" property is required')),N;function L(U){let $=[];const Z=U.value,J=U.key;if("array"!==Dt(Z))return[new qe(J,Z,`array expected, ${Dt(Z)} found`)];if(2!==Z.length)return[new qe(J,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if("object"!==Dt(Z[0]))return[new qe(J,Z,`object expected, ${Dt(Z[0])} found`)];if(void 0===Z[0].zoom)return[new qe(J,Z,"object stop key must have zoom")];if(void 0===Z[0].value)return[new qe(J,Z,"object stop key must have value")];if(w&&w>yi(Z[0].zoom))return[new qe(J,Z[0].zoom,"stop zoom values must appear in ascending order")];yi(Z[0].zoom)!==w&&(w=yi(Z[0].zoom),g=void 0,x={}),$=$.concat(Br({key:`${J}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:fs,value:j}}))}else $=$.concat(j({key:`${J}[0]`,value:Z[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},Z));return za(Ar(Z[1]))?$.concat([new qe(`${J}[1]`,Z[1],"expressions are not allowed in function stops.")]):$.concat(U.validateSpec({key:`${J}[1]`,value:Z[1],valueSpec:s,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function j(U,$){const Z=Dt(U.value),J=yi(U.value),ie=null!==U.value?U.value:$;if(f){if(Z!==f)return[new qe(U.key,ie,`${Z} stop domain type must match previous stop domain type ${f}`)]}else f=Z;if("number"!==Z&&"string"!==Z&&"boolean"!==Z)return[new qe(U.key,ie,"stop domain value must be a number, string, or boolean")];if("number"!==Z&&"categorical"!==l){let be=`number expected, ${Z} found`;return Ue(s)&&void 0===l&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(U.key,ie,be)]}return"categorical"!==l||"number"!==Z||isFinite(J)&&Math.floor(J)===J?"categorical"!==l&&"number"===Z&&void 0!==g&&J<g?[new qe(U.key,ie,"stop domain values must appear in ascending order")]:(g=J,"categorical"===l&&J in x?[new qe(U.key,ie,"stop domain values must be unique")]:(x[J]=!0,[])):[new qe(U.key,ie,`integer expected, found ${J}`)]}}function fu(c){const s=("property"===c.expressionContext?ta:li)(Ar(c.value),c.valueSpec);if("error"===s.result)return s.value.map(f=>new qe(`${c.key}${f.key}`,c.value,f.message));const l=s.value.expression||s.value._styleExpression.expression;if("property"===c.expressionContext&&"text-font"===c.propertyKey&&!l.outputDefined())return[new qe(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===c.expressionContext&&"layout"===c.propertyType&&!Yr(l))return[new qe(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===c.expressionContext&&!Yr(l))return[new qe(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&0===c.expressionContext.indexOf("cluster")){if(!lu(l,["zoom","feature-state"]))return[new qe(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===c.expressionContext&&!au(l))return[new qe(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ps(c){const s=c.key,l=c.value,f=Dt(l);return"string"!==f?[new qe(s,l,`color expected, ${f} found`)]:nn.parse(String(l))?[]:[new qe(s,l,`color expected, "${l}" found`)]}function ra(c){const s=c.key,l=c.value,f=c.valueSpec,g=[];return Array.isArray(f.values)?-1===f.values.indexOf(yi(l))&&g.push(new qe(s,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(f.values).indexOf(yi(l))&&g.push(new qe(s,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function zp(c){return du(Ar(c.value))?fu(Zr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):jp(c)}function jp(c){const s=c.value,l=c.key;if("array"!==Dt(s))return[new qe(l,s,`array expected, ${Dt(s)} found`)];const f=c.styleSpec;let g,w=[];if(s.length<1)return[new qe(l,s,"filter array must have at least 1 element")];switch(w=w.concat(ra({key:`${l}[0]`,value:s[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),yi(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"===yi(s[1])&&w.push(new qe(l,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":3!==s.length&&w.push(new qe(l,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(g=Dt(s[1]),"string"!==g&&w.push(new qe(`${l}[1]`,s[1],`string expected, ${g} found`)));for(let x=2;x<s.length;x++)g=Dt(s[x]),"$type"===yi(s[1])?w=w.concat(ra({key:`${l}[${x}]`,value:s[x],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):"string"!==g&&"number"!==g&&"boolean"!==g&&w.push(new qe(`${l}[${x}]`,s[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<s.length;x++)w=w.concat(jp({key:`${l}[${x}]`,value:s[x],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":g=Dt(s[1]),2!==s.length?w.push(new qe(l,s,`filter array for "${s[0]}" operator must have 2 elements`)):"string"!==g&&w.push(new qe(`${l}[1]`,s[1],`string expected, ${g} found`))}return w}function oh(c,s){const l=c.key,f=c.validateSpec,g=c.style,w=c.styleSpec,x=c.value,M=c.objectKey,C=w[`${s}_${c.layerType}`];if(!C)return[];const P=M.match(/^(.*)-transition$/);if("paint"===s&&P&&C[P[1]]&&C[P[1]].transition)return f({key:l,value:x,valueSpec:w.transition,style:g,styleSpec:w});const N=c.valueSpec||C[M];if(!N)return[new qe(l,x,`unknown property "${M}"`)];let L;if("string"===Dt(x)&&Ue(N)&&!N.tokens&&(L=/^{([^}]+)}$/.exec(x)))return[new qe(l,x,`"${M}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const j=[];return"symbol"===c.layerType&&("text-field"===M&&g&&!g.glyphs&&j.push(new qe(l,x,'use of "text-field" requires a style "glyphs" property')),"text-font"===M&&Bi(Ar(x))&&"identity"===yi(x.type)&&j.push(new qe(l,x,'"text-font" does not support identity functions'))),j.concat(f({key:c.key,value:x,valueSpec:N,style:g,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:M}))}function zm(c){return oh(c,"paint")}function jm(c){return oh(c,"layout")}function Vm(c){let s=[];const l=c.value,f=c.key,g=c.style,w=c.styleSpec;if("object"!==Dt(l))return[new qe(f,l,`object expected, ${Dt(l)} found`)];l.type||l.ref||s.push(new qe(f,l,'either "type" or "ref" is required'));let x=yi(l.type);const M=yi(l.ref);if(l.id){const C=yi(l.id);for(let P=0;P<c.arrayIndex;P++){const N=g.layers[P];yi(N.id)===C&&s.push(new qe(f,l.id,`duplicate layer id "${l.id}", previously used at line ${N.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach(P=>{P in l&&s.push(new qe(f,l[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{yi(P.id)===M&&(C=P)}),C?C.ref?s.push(new qe(f,l.ref,"ref cannot reference another ref layer")):x=yi(C.type):s.push(new qe(f,l.ref,`ref layer "${M}" not found`))}else if("background"!==x)if(l.source){const C=g.sources&&g.sources[l.source],P=C&&yi(C.type);C?"vector"===P&&"raster"===x?s.push(new qe(f,l.source,`layer "${l.id}" requires a raster source`)):"raster-dem"!==P&&"hillshade"===x||"raster-dem"!==P&&"color-relief"===x?s.push(new qe(f,l.source,`layer "${l.id}" requires a raster-dem source`)):"raster"===P&&"raster"!==x?s.push(new qe(f,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==P||l["source-layer"]?"raster-dem"===P&&"hillshade"!==x&&"color-relief"!==x?s.push(new qe(f,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==x||!l.paint||!l.paint["line-gradient"]||"geojson"===P&&C.lineMetrics||s.push(new qe(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new qe(f,l,`layer "${l.id}" must specify a "source-layer"`)):s.push(new qe(f,l.source,`source "${l.source}" not found`))}else s.push(new qe(f,l,'missing required property "source"'));return s=s.concat(Br({key:f,value:l,valueSpec:w.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:l.type,valueSpec:w.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:l,objectKey:"type"}),filter:zp,layout:C=>Br({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>jm(Zr({layerType:x},P))}}),paint:C=>Br({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>zm(Zr({layerType:x},P))}})}})),s}function oa(c){const s=c.value,l=c.key,f=Dt(s);return"string"!==f?[new qe(l,s,`string expected, ${f} found`)]:[]}const sh={promoteId:function({key:c,value:s}){if("string"===Dt(s))return oa({key:c,value:s});{const l=[];for(const f in s)l.push(...oa({key:`${c}.${f}`,value:s[f]}));return l}}};function zo(c){const s=c.value,l=c.key,f=c.styleSpec,g=c.style,w=c.validateSpec;if(!s.type)return[new qe(l,s,'"type" is required')];const x=yi(s.type);let M;switch(x){case"vector":case"raster":return M=Br({key:l,value:s,valueSpec:f[`source_${x.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:sh,validateSpec:w}),M;case"raster-dem":return M=function(C){var P;const N=null!==(P=C.sourceName)&&void 0!==P?P:"",L=C.value,j=C.styleSpec,U=j.source_raster_dem,$=C.style;let Z=[];const J=Dt(L);if(void 0===L)return Z;if("object"!==J)return Z.push(new qe("source_raster_dem",L,`object expected, ${J} found`)),Z;const ie="custom"===yi(L.encoding),be=["redFactor","greenFactor","blueFactor","baseShift"],ce=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const he in L)!ie&&be.includes(he)?Z.push(new qe(he,L[he],`In "${N}": "${he}" is only valid when "encoding" is set to "custom". ${ce} encoding found`)):U[he]?Z=Z.concat(C.validateSpec({key:he,value:L[he],valueSpec:U[he],validateSpec:C.validateSpec,style:$,styleSpec:j})):Z.push(new qe(he,L[he],`unknown property "${he}"`));return Z}({sourceName:l,value:s,style:c.style,styleSpec:f,validateSpec:w}),M;case"geojson":if(M=Br({key:l,value:s,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:w,objectElementValidators:sh}),s.cluster)for(const C in s.clusterProperties){const[P,N]=s.clusterProperties[C],L="string"==typeof P?[P,["accumulated"],["get",C]]:P;M.push(...fu({key:`${l}.${C}.map`,value:N,expressionContext:"cluster-map"})),M.push(...fu({key:`${l}.${C}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return M;case"video":return Br({key:l,value:s,valueSpec:f.source_video,style:g,validateSpec:w,styleSpec:f});case"image":return Br({key:l,value:s,valueSpec:f.source_image,style:g,validateSpec:w,styleSpec:f});case"canvas":return[new qe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ra({key:`${l}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function pu(c){const s=c.value,l=c.styleSpec,f=l.light,g=c.style;let w=[];const x=Dt(s);if(void 0===s)return w;if("object"!==x)return w=w.concat([new qe("light",s,`object expected, ${x} found`)]),w;for(const M in s){const C=M.match(/^(.*)-transition$/);w=w.concat(C&&f[C[1]]&&f[C[1]].transition?c.validateSpec({key:M,value:s[M],valueSpec:l.transition,validateSpec:c.validateSpec,style:g,styleSpec:l}):f[M]?c.validateSpec({key:M,value:s[M],valueSpec:f[M],validateSpec:c.validateSpec,style:g,styleSpec:l}):[new qe(M,s[M],`unknown property "${M}"`)])}return w}function Vp(c){const s=c.value,l=c.styleSpec,f=l.sky,g=c.style,w=Dt(s);if(void 0===s)return[];if("object"!==w)return[new qe("sky",s,`object expected, ${w} found`)];let x=[];for(const M in s)x=x.concat(f[M]?c.validateSpec({key:M,value:s[M],valueSpec:f[M],style:g,styleSpec:l}):[new qe(M,s[M],`unknown property "${M}"`)]);return x}function Um(c){const s=c.value,l=c.styleSpec,f=l.terrain,g=c.style;let w=[];const x=Dt(s);if(void 0===s)return w;if("object"!==x)return w=w.concat([new qe("terrain",s,`object expected, ${x} found`)]),w;for(const M in s)w=w.concat(f[M]?c.validateSpec({key:M,value:s[M],valueSpec:f[M],validateSpec:c.validateSpec,style:g,styleSpec:l}):[new qe(M,s[M],`unknown property "${M}"`)]);return w}function Gm(c){let s=[];const l=c.value,f=c.key;if(Array.isArray(l)){const g=[],w=[];for(const x in l)l[x].id&&g.includes(l[x].id)&&s.push(new qe(f,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),g.push(l[x].id),l[x].url&&w.includes(l[x].url)&&s.push(new qe(f,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),w.push(l[x].url),s=s.concat(Br({key:`${f}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return oa({key:f,value:l})}function ah(c){return(s=c.value)&&s.constructor===Object?[]:[new qe(c.key,c.value,`object expected, ${Dt(c.value)} found`)];var s}const nd={"*":()=>[],array:Xr,boolean:function(c){const s=c.value,l=c.key,f=Dt(s);return"boolean"!==f?[new qe(l,s,`boolean expected, ${f} found`)]:[]},number:fs,color:ps,constants:Lr,enum:ra,filter:zp,function:Bm,layer:Vm,object:Br,source:zo,light:pu,sky:Vp,terrain:Um,projection:function(c){const s=c.value,l=c.styleSpec,f=l.projection,g=c.style,w=Dt(s);if(void 0===s)return[];if("object"!==w)return[new qe("projection",s,`object expected, ${w} found`)];let x=[];for(const M in s)x=x.concat(f[M]?c.validateSpec({key:M,value:s[M],valueSpec:f[M],style:g,styleSpec:l}):[new qe(M,s[M],`unknown property "${M}"`)]);return x},projectionDefinition:function(c){const s=c.key;let l=c.value;l=l instanceof String?l.valueOf():l;const f=Dt(l);return"array"!==f||(g=l,Array.isArray(g)&&3===g.length&&"string"==typeof g[0]&&"string"==typeof g[1]&&"number"==typeof g[2])||function(g){return!!["interpolate","step","literal"].includes(g[0])}(l)?["array","string"].includes(f)?[]:[new qe(s,l,`projection expected, invalid type "${f}" found`)]:[new qe(s,l,`projection expected, invalid array ${JSON.stringify(l)} found`)];var g},string:oa,formatted:function(c){return 0===oa(c).length?[]:fu(c)},resolvedImage:function(c){return 0===oa(c).length?[]:fu(c)},padding:function(c){const s=c.key,l=c.value;if("array"===Dt(l)){if(l.length<1||l.length>4)return[new qe(s,l,`padding requires 1 to 4 values; ${l.length} values found`)];const f={type:"number"};let g=[];for(let w=0;w<l.length;w++)g=g.concat(c.validateSpec({key:`${s}[${w}]`,value:l[w],validateSpec:c.validateSpec,valueSpec:f}));return g}return fs({key:s,value:l,valueSpec:{}})},numberArray:function(c){const s=c.key,l=c.value;if("array"===Dt(l)){const f={type:"number"};if(l.length<1)return[new qe(s,l,"array length at least 1 expected, length 0 found")];let g=[];for(let w=0;w<l.length;w++)g=g.concat(c.validateSpec({key:`${s}[${w}]`,value:l[w],validateSpec:c.validateSpec,valueSpec:f}));return g}return fs({key:s,value:l,valueSpec:{}})},colorArray:function(c){const s=c.key,l=c.value;if("array"===Dt(l)){if(l.length<1)return[new qe(s,l,"array length at least 1 expected, length 0 found")];let f=[];for(let g=0;g<l.length;g++)f=f.concat(ps({key:`${s}[${g}]`,value:l[g]}));return f}return ps({key:s,value:l})},variableAnchorOffsetCollection:function(c){const s=c.key,l=c.value,f=Dt(l),g=c.styleSpec;if("array"!==f||l.length<1||l.length%2!=0)return[new qe(s,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<l.length;x+=2)w=w.concat(ra({key:`${s}[${x}]`,value:l[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Xr({key:`${s}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:g}));return w},sprite:Gm,state:ah};function oc(c){const s=c.value,l=c.valueSpec,f=c.styleSpec;return c.validateSpec=oc,l.expression&&Bi(yi(s))?Bm(c):l.expression&&za(Ar(s))?fu(c):l.type&&nd[l.type]?nd[l.type](c):Br(Zr({},c,{valueSpec:l.type?f[l.type]:l}))}function $m(c){const s=c.value,l=c.key,f=oa(c);return f.length||(-1===s.indexOf("{fontstack}")&&f.push(new qe(l,s,'"glyphs" url must include a "{fontstack}" token')),-1===s.indexOf("{range}")&&f.push(new qe(l,s,'"glyphs" url must include a "{range}" token'))),f}function jo(c,s=xe){let l=[];return l=l.concat(oc({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:oc,objectElementValidators:{glyphs:$m,"*":()=>[]}})),c.constants&&(l=l.concat(Lr({key:"constants",value:c.constants}))),sc(l)}function sa(c){return function(s){return c({...s,validateSpec:oc})}}function sc(c){return[].concat(c).sort((s,l)=>s.line-l.line)}function gs(c){return function(...s){return sc(c.apply(this,s))}}jo.source=gs(sa(zo)),jo.sprite=gs(sa(Gm)),jo.glyphs=gs(sa($m)),jo.light=gs(sa(pu)),jo.sky=gs(sa(Vp)),jo.terrain=gs(sa(Um)),jo.state=gs(sa(ah)),jo.layer=gs(sa(Vm)),jo.filter=gs(sa(zp)),jo.paintProperty=gs(sa(zm)),jo.layoutProperty=gs(sa(jm));const Ci=jo,Hm=Ci.light,aa=Ci.sky,ar=Ci.paintProperty,qm=Ci.layoutProperty;function la(c,s){let l=!1;if(s&&s.length)for(const f of s)c.fire(new Fe(new Error(f.message))),l=!0;return l}class Ps{constructor(s,l,f){const g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const x=new Int32Array(this.arrayBuffer);s=x[0],this.d=(l=x[1])+2*(f=x[2]);for(let C=0;C<this.d*this.d;C++){const P=x[3+C],N=x[3+C+1];g.push(P===N?null:x.subarray(P,N))}const M=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],M),this.bboxes=x.subarray(M),this.insert=this._insertReadonly}else{this.d=l+2*f;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=s,this.padding=f,this.scale=l/s,this.uid=0;const w=f/l*s;this.min=-w,this.max=s+w}insert(s,l,f,g,w){this._forEachCell(l,f,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,l,f,g,w,x){this.cells[w].push(x)}query(s,l,f,g,w){const x=this.min,M=this.max;if(s<=x&&l<=x&&M<=f&&M<=g&&!w)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(s,l,f,g,this._queryCell,C,{},w),C}}_queryCell(s,l,f,g,w,x,M,C){const P=this.cells[w];if(null!==P){const N=this.keys,L=this.bboxes;for(let j=0;j<P.length;j++){const U=P[j];if(void 0===M[U]){const $=4*U;(C?C(L[$+0],L[$+1],L[$+2],L[$+3]):s<=L[$+2]&&l<=L[$+3]&&f>=L[$+0]&&g>=L[$+1])?(M[U]=!0,x.push(N[U])):M[U]=!1}}}}_forEachCell(s,l,f,g,w,x,M,C){const P=this._convertToCellCoord(s),N=this._convertToCellCoord(l),L=this._convertToCellCoord(f),j=this._convertToCellCoord(g);for(let U=P;U<=L;U++)for(let $=N;$<=j;$++){const Z=this.d*$+U;if((!C||C(this._convertFromCellCoord(U),this._convertFromCellCoord($),this._convertFromCellCoord(U+1),this._convertFromCellCoord($+1)))&&w.call(this,s,l,f,g,Z,x,M,C))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,l=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const g=new Int32Array(l+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=l;for(let x=0;x<s.length;x++){const M=s[x];g[3+x]=w,g.set(M,w),w+=M.length}return g[3+s.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+s.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(s,l){const f=s.toArrayBuffer();return l&&l.push(f),{buffer:f}}static deserialize(s){return new Ps(s.buffer)}}const Vo={};function Ze(c,s,l={}){if(Vo[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),Vo[c]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}Ze("Object",Object),Ze("Set",Set),Ze("TransferableGridIndex",Ps),Ze("Color",nn),Ze("Error",Error),Ze("AJAXError",ae),Ze("ResolvedImage",Fo),Ze("StylePropertyFunction",ja),Ze("StyleExpression",uu,{omit:["_evaluator"]}),Ze("ZoomDependentExpression",wl),Ze("ZoomConstantExpression",As),Ze("CompoundExpression",Bo,{omit:["_evaluate"]});for(const c in ou)ou[c]._classRegistryKey||Ze(`Expression_${c}`,ou[c]);function hf(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&"ArrayBuffer"===c.constructor.name)}function gu(c){return c.$name||c.constructor._classRegistryKey}function df(c){return!function(s){if(null===s||"object"!=typeof s)return!1;const l=gu(s);return!(!l||"Object"===l)}(c)&&(null==c||"boolean"==typeof c||"number"==typeof c||"string"==typeof c||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||hf(c)||Ca(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function Wi(c,s){if(df(c))return(hf(c)||Ca(c))&&s&&s.push(c),ArrayBuffer.isView(c)&&s&&s.push(c.buffer),c instanceof ImageData&&s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const w=[];for(const x of c)w.push(Wi(x,s));return w}if("object"!=typeof c)throw new Error("can't serialize object of type "+typeof c);const l=gu(c);if(!l)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!Vo[l])throw new Error(`${l} is not registered.`);const{klass:f}=Vo[l],g=f.serialize?f.serialize(c,s):{};if(f.serialize){if(s&&g===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in c){if(!c.hasOwnProperty(w)||Vo[l].omit.indexOf(w)>=0)continue;const x=c[w];g[w]=Vo[l].shallow.indexOf(w)>=0?x:Wi(x,s)}c instanceof Error&&(g.message=c.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(g.$name=l),g}function Sl(c){if(df(c))return c;if(Array.isArray(c))return c.map(Sl);if("object"!=typeof c)throw new Error("can't deserialize object of type "+typeof c);const s=gu(c)||"Object";if(!Vo[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:l}=Vo[s];if(!l)throw new Error(`can't deserialize unregistered class ${s}`);if(l.deserialize)return l.deserialize(c);const f=Object.create(l.prototype);for(const g of Object.keys(c)){if("$name"===g)continue;const w=c[g];f[g]=Vo[s].shallow.indexOf(g)>=0?w:Sl(w)}return f}class lh{constructor(){this.first=!0}update(s,l){const f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))}}const an={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Hangul Syllables":c=>c>=44032&&c<=55215,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function ac(c){for(const s of c)if(od(s.charCodeAt(0)))return!0;return!1}function ff(c){for(const s of c)if(!rd(s.charCodeAt(0)))return!1;return!0}function $a(c){const s=c.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(s.join("|"),"u")}const id=$a(["Arab","Dupl","Mong","Ougr","Syrc"]);function rd(c){return!id.test(String.fromCodePoint(c))}const Rs=$a(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function od(c){return!(746!==c&&747!==c&&(c<4352||!(an["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||an["CJK Compatibility"](c)||an["CJK Strokes"](c)||!(!an["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||12336===c)||an["Enclosed CJK Letters and Months"](c)||an["Ideographic Description Characters"](c)||an.Kanbun(c)||an.Katakana(c)&&12540!==c||!(!an["Halfwidth and Fullwidth Forms"](c)||65288===c||65289===c||65293===c||c>=65306&&c<=65310||65339===c||65341===c||65343===c||c>=65371&&c<=65503||65507===c||c>=65512&&c<=65519)||!(!an["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||an["Vertical Forms"](c)||an["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||Rs.test(String.fromCodePoint(c)))))}function pf(c){return!(od(c)||(s=c,an["Latin-1 Supplement"](s)&&(167===s||169===s||174===s||177===s||188===s||189===s||190===s||215===s||247===s)||an["General Punctuation"](s)&&(8214===s||8224===s||8225===s||8240===s||8241===s||8251===s||8252===s||8258===s||8263===s||8264===s||8265===s||8273===s)||an["Letterlike Symbols"](s)||an["Number Forms"](s)||an["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||9003===s||s>=9085&&s<=9114||s>=9150&&s<=9165||9167===s||s>=9169&&s<=9179||s>=9186&&s<=9215)||an["Control Pictures"](s)&&9251!==s||an["Optical Character Recognition"](s)||an["Enclosed Alphanumerics"](s)||an["Geometric Shapes"](s)||an["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||an["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||an["CJK Symbols and Punctuation"](s)||an.Katakana(s)||an["Private Use Area"](s)||an["CJK Compatibility Forms"](s)||an["Small Form Variants"](s)||an["Halfwidth and Fullwidth Forms"](s)||8734===s||8756===s||8757===s||s>=9984&&s<=10087||s>=10102&&s<=10131||65532===s||65533===s));var s}const gf=$a(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Lt(c){return gf.test(String.fromCodePoint(c))}function lc(c,s){return!(!s&&Lt(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||an.Khmer(c))}function sd(c){for(const s of c)if(Lt(s.charCodeAt(0)))return!0;return!1}const Uo=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){if(Uo.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(c,s){return y(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if("loading"!==c.pluginStatus)return this.setState(c),c;const l=c.pluginURL,f=new Promise(w=>{this.loadScriptResolve=w});s(l);const g=new Promise(w=>setTimeout(()=>w(),this.TIMEOUT));if(yield Promise.race([f,g]),this.isParsed()){const w={pluginStatus:"loaded",pluginURL:l};return this.setState(w),w}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)})}};class ui{constructor(s,l){this.zoom=s,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new lh,this.transition=l.transition||{},this.globalState=l.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lh,this.transition={},this.globalState={})}isSupportedScript(s){return function(l,f){for(const g of l)if(!lc(g.charCodeAt(0),f))return!1;return!0}(s,"loaded"===Uo.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,l=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}}}class mu{constructor(s,l){this.property=s,this.value=l,this.expression=function(f,g){if(Bi(f))return new ja(f,g);if(za(f)){const w=ta(f,g);if("error"===w.result)throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return"color"===g.type&&"string"==typeof f?w=nn.parse(f):"padding"!==g.type||"number"!=typeof f&&!Array.isArray(f)?"numberArray"!==g.type||"number"!=typeof f&&!Array.isArray(f)?"colorArray"!==g.type||"string"!=typeof f&&!Array.isArray(f)?"variableAnchorOffsetCollection"===g.type&&Array.isArray(f)?w=co.parse(f):"projectionDefinition"===g.type&&"string"==typeof f&&(w=or.parse(f)):w=Mi.parse(f):w=pr.parse(f):w=rr.parse(f),{globalStateRefs:new Set,kind:"constant",evaluate:()=>w}}}(void 0===l?s.specification.default:l,s.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(s,l,f){return this.property.possiblyEvaluate(this,s,l,f)}}class ad{constructor(s){this.property=s,this.value=new mu(s,void 0)}transitioned(s,l){return new cd(this.property,this.value,l,ss({},s.transition,this.transition),s.now)}untransitioned(){return new cd(this.property,this.value,null,{},0)}}class ld{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Wr(this._values[s].value.value)}setValue(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new ad(this._values[s].property)),this._values[s].value=new mu(this._values[s].property,null===l?void 0:Wr(l))}getTransition(s){return Wr(this._values[s].transition)}setTransition(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new ad(this._values[s].property)),this._values[s].transition=Wr(l)||void 0}serialize(){const s={};for(const l of Object.keys(this._values)){const f=this.getValue(l);void 0!==f&&(s[l]=f);const g=this.getTransition(l);void 0!==g&&(s[`${l}-transition`]=g)}return s}transitioned(s,l){const f=new ud(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(s,l._values[g]);return f}untransitioned(){const s=new ud(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].untransitioned();return s}}class cd{constructor(s,l,f,g,w){this.property=s,this.value=l,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,s.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(s,l,f){const g=s.now||0,w=this.value.possiblyEvaluate(s,l,f),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(s,l,f);{const M=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(s,l,f),w,qs(M))}}return w}}class ud{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,l,f){const g=new hd(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(s,l,f);return g}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Up{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return void 0!==this._values[s].value}getValue(s){return Wr(this._values[s].value)}setValue(s,l){this._values[s]=new mu(this._values[s].property,null===l?void 0:Wr(l))}serialize(){const s={};for(const l of Object.keys(this._values)){const f=this.getValue(l);void 0!==f&&(s[l]=f)}return s}possiblyEvaluate(s,l,f){const g=new hd(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(s,l,f);return g}}class Ha{constructor(s,l,f){this.property=s,this.value=l,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(s){return"constant"===this.value.kind?this.value.value:s}evaluate(s,l,f,g){return this.property.evaluate(this.value,this.parameters,s,l,f,g)}}class hd{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class dt{constructor(s){this.specification=s}possiblyEvaluate(s,l){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(l)}interpolate(s,l,f){const g=Js[this.specification.type];return g?g(s,l,f):s}}class Se{constructor(s,l){this.specification=s,this.overrides=l}possiblyEvaluate(s,l,f,g){return new Ha(this,"constant"===s.expression.kind||"camera"===s.expression.kind?{kind:"constant",value:s.expression.evaluate(l,null,{},f,g)}:s.expression,l)}interpolate(s,l,f){if("constant"!==s.value.kind||"constant"!==l.value.kind)return s;if(void 0===s.value.value||void 0===l.value.value)return new Ha(this,{kind:"constant",value:void 0},s.parameters);const g=Js[this.specification.type];if(g){const w=g(s.value.value,l.value.value,f);return new Ha(this,{kind:"constant",value:w},s.parameters)}return s}evaluate(s,l,f,g,w,x){return"constant"===s.kind?s.value:s.evaluate(l,f,g,w,x)}}class zt extends Se{possiblyEvaluate(s,l,f,g){if(void 0===s.value)return new Ha(this,{kind:"constant",value:void 0},l);if("constant"===s.expression.kind){const w=s.expression.evaluate(l,null,{},f,g),x="resolvedImage"===s.property.specification.type&&"string"!=typeof w?w.name:w,M=this._calculate(x,x,x,l);return new Ha(this,{kind:"constant",value:M},l)}if("camera"===s.expression.kind){const w=this._calculate(s.expression.evaluate({zoom:l.zoom-1}),s.expression.evaluate({zoom:l.zoom}),s.expression.evaluate({zoom:l.zoom+1}),l);return new Ha(this,{kind:"constant",value:w},l)}return new Ha(this,s.expression,l)}evaluate(s,l,f,g,w,x){if("source"===s.kind){const M=s.evaluate(l,f,g,w,x);return this._calculate(M,M,M,l)}return"composite"===s.kind?this._calculate(s.evaluate({zoom:Math.floor(l.zoom)-1},f,g),s.evaluate({zoom:Math.floor(l.zoom)},f,g),s.evaluate({zoom:Math.floor(l.zoom)+1},f,g),l):s.value}_calculate(s,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:f,to:l}}interpolate(s){return s}}class Zi{constructor(s){this.specification=s}possiblyEvaluate(s,l,f,g){if(void 0!==s.value){if("constant"===s.expression.kind){const w=s.expression.evaluate(l,null,{},f,g);return this._calculate(w,w,w,l)}return this._calculate(s.expression.evaluate(new ui(Math.floor(l.zoom-1),l)),s.expression.evaluate(new ui(Math.floor(l.zoom),l)),s.expression.evaluate(new ui(Math.floor(l.zoom+1),l)),l)}}_calculate(s,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:f,to:l}}interpolate(s){return s}}class zr{constructor(s){this.specification=s}possiblyEvaluate(s,l,f,g){return!!s.expression.evaluate(l,null,{},f,g)}interpolate(){return!1}}class St{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in s){const f=s[l];f.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new mu(f,void 0),w=this.defaultTransitionablePropertyValues[l]=new ad(f);this.defaultTransitioningPropertyValues[l]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Ze("DataDrivenProperty",Se),Ze("DataConstantProperty",dt),Ze("CrossFadedDataDrivenProperty",zt),Ze("CrossFadedProperty",Zi),Ze("ColorRampProperty",zr);const mf="-transition";class Qr extends pt{constructor(s,l){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},"custom"!==s.type&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,"background"!==s.type&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter,this._featureFilter=gr(s.filter)),l.layout&&(this._unevaluatedLayout=new Up(l.layout)),l.paint)){this._transitionablePaint=new ld(l.paint);for(const f in s.paint)this.setPaintProperty(f,s.paint[f],{validate:!1});for(const f in s.layout)this.setLayoutProperty(f,s.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hd(l.paint)}}setFilter(s){this.filter=s,this._featureFilter=gr(s)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return"visibility"===s?this.visibility:this._unevaluatedLayout.getValue(s)}getLayoutAffectingGlobalStateRefs(){const s=new Set;if(this._unevaluatedLayout)for(const l in this._unevaluatedLayout._values){const f=this._unevaluatedLayout._values[l];for(const g of f.getGlobalStateRefs())s.add(g)}for(const l of this._featureFilter.getGlobalStateRefs())s.add(l);return s}setLayoutProperty(s,l,f={}){null!=l&&this._validate(qm,`layers.${this.id}.layout.${s}`,s,l,f)||("visibility"!==s?this._unevaluatedLayout.setValue(s,l):this.visibility=l)}getPaintProperty(s){return s.endsWith(mf)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,l,f={}){if(null!=l&&this._validate(ar,`layers.${this.id}.paint.${s}`,s,l,f))return!1;if(s.endsWith(mf))return this._transitionablePaint.setTransition(s.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[s],w="cross-faded-data-driven"===g.property.specification["property-type"],x=g.value.isDataDriven(),M=g.value;this._transitionablePaint.setValue(s,l),this._handleSpecialPaintPropertyUpdate(s);const C=this._transitionablePaint._values[s].value;return C.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(s,M,C)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,l,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||"none"===this.visibility}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,l){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,l)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Uc(s,(l,f)=>!(void 0===l||"layout"===f&&!Object.keys(l).length||"paint"===f&&!Object.keys(l).length))}_validate(s,l,f,g,w={}){return(!w||!1!==w.validate)&&la(this,s.call(Ci,{key:l,layerType:this.type,objectKey:f,value:g,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const l=this.paint.get(s);if(l instanceof Ha&&Ue(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const qa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _u{constructor(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,l){return s._trim(),l&&(s.isTransferred=!0,l.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ti(c,s=1){let l=0,f=0;return{members:c.map(g=>{const w=qa[g.type].BYTES_PER_ELEMENT,x=l=_f(l,Math.max(s,w)),M=g.components||1;return f=Math.max(f,w),l+=w*M,{name:g.name,type:g.type,components:M,offset:x}}),size:_f(l,Math.max(f,s)),alignment:s}}function _f(c,s){return Math.ceil(c/s)*s}class ch extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const g=2*s;return this.int16[g+0]=l,this.int16[g+1]=f,s}}ch.prototype.bytesPerElement=4,Ze("StructArrayLayout2i4",ch);class cc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const w=3*s;return this.int16[w+0]=l,this.int16[w+1]=f,this.int16[w+2]=g,s}}cc.prototype.bytesPerElement=6,Ze("StructArrayLayout3i6",cc);class dd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,s,l,f,g)}emplace(s,l,f,g,w){const x=4*s;return this.int16[x+0]=l,this.int16[x+1]=f,this.int16[x+2]=g,this.int16[x+3]=w,s}}dd.prototype.bytesPerElement=8,Ze("StructArrayLayout4i8",dd);class Wa extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x){const M=this.length;return this.resize(M+1),this.emplace(M,s,l,f,g,w,x)}emplace(s,l,f,g,w,x,M){const C=6*s;return this.int16[C+0]=l,this.int16[C+1]=f,this.int16[C+2]=g,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=M,s}}Wa.prototype.bytesPerElement=12,Ze("StructArrayLayout2i4i12",Wa);class Ki extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x){const M=this.length;return this.resize(M+1),this.emplace(M,s,l,f,g,w,x)}emplace(s,l,f,g,w,x,M){const C=4*s,P=8*s;return this.int16[C+0]=l,this.int16[C+1]=f,this.uint8[P+4]=g,this.uint8[P+5]=w,this.uint8[P+6]=x,this.uint8[P+7]=M,s}}Ki.prototype.bytesPerElement=8,Ze("StructArrayLayout2i4ub8",Ki);class Go extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const g=2*s;return this.float32[g+0]=l,this.float32[g+1]=f,s}}Go.prototype.bytesPerElement=8,Ze("StructArrayLayout2f8",Go);class uh extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x,M,C,P,N){const L=this.length;return this.resize(L+1),this.emplace(L,s,l,f,g,w,x,M,C,P,N)}emplace(s,l,f,g,w,x,M,C,P,N,L){const j=10*s;return this.uint16[j+0]=l,this.uint16[j+1]=f,this.uint16[j+2]=g,this.uint16[j+3]=w,this.uint16[j+4]=x,this.uint16[j+5]=M,this.uint16[j+6]=C,this.uint16[j+7]=P,this.uint16[j+8]=N,this.uint16[j+9]=L,s}}uh.prototype.bytesPerElement=20,Ze("StructArrayLayout10ui20",uh);class lr extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x,M,C,P,N,L,j){const U=this.length;return this.resize(U+1),this.emplace(U,s,l,f,g,w,x,M,C,P,N,L,j)}emplace(s,l,f,g,w,x,M,C,P,N,L,j,U){const $=12*s;return this.int16[$+0]=l,this.int16[$+1]=f,this.int16[$+2]=g,this.int16[$+3]=w,this.uint16[$+4]=x,this.uint16[$+5]=M,this.uint16[$+6]=C,this.uint16[$+7]=P,this.int16[$+8]=N,this.int16[$+9]=L,this.int16[$+10]=j,this.int16[$+11]=U,s}}lr.prototype.bytesPerElement=24,Ze("StructArrayLayout4i4ui4i24",lr);class Ns extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const w=3*s;return this.float32[w+0]=l,this.float32[w+1]=f,this.float32[w+2]=g,s}}Ns.prototype.bytesPerElement=12,Ze("StructArrayLayout3f12",Ns);class yf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint32[1*s+0]=l,s}}yf.prototype.bytesPerElement=4,Ze("StructArrayLayout1ul4",yf);class hh extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x,M,C,P){const N=this.length;return this.resize(N+1),this.emplace(N,s,l,f,g,w,x,M,C,P)}emplace(s,l,f,g,w,x,M,C,P,N){const L=10*s,j=5*s;return this.int16[L+0]=l,this.int16[L+1]=f,this.int16[L+2]=g,this.int16[L+3]=w,this.int16[L+4]=x,this.int16[L+5]=M,this.uint32[j+3]=C,this.uint16[L+8]=P,this.uint16[L+9]=N,s}}hh.prototype.bytesPerElement=20,Ze("StructArrayLayout6i1ul2ui20",hh);class vf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x){const M=this.length;return this.resize(M+1),this.emplace(M,s,l,f,g,w,x)}emplace(s,l,f,g,w,x,M){const C=6*s;return this.int16[C+0]=l,this.int16[C+1]=f,this.int16[C+2]=g,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=M,s}}vf.prototype.bytesPerElement=12,Ze("StructArrayLayout2i2i2i12",vf);class v extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,f,g,w)}emplace(s,l,f,g,w,x){const M=4*s,C=8*s;return this.float32[M+0]=l,this.float32[M+1]=f,this.float32[M+2]=g,this.int16[C+6]=w,this.int16[C+7]=x,s}}v.prototype.bytesPerElement=16,Ze("StructArrayLayout2f1f2i16",v);class o extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x){const M=this.length;return this.resize(M+1),this.emplace(M,s,l,f,g,w,x)}emplace(s,l,f,g,w,x,M){const C=16*s,P=4*s,N=8*s;return this.uint8[C+0]=l,this.uint8[C+1]=f,this.float32[P+1]=g,this.float32[P+2]=w,this.int16[N+6]=x,this.int16[N+7]=M,s}}o.prototype.bytesPerElement=16,Ze("StructArrayLayout2ub2f2i16",o);class u extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const w=3*s;return this.uint16[w+0]=l,this.uint16[w+1]=f,this.uint16[w+2]=g,s}}u.prototype.bytesPerElement=6,Ze("StructArrayLayout3ui6",u);class p extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x,M,C,P,N,L,j,U,$,Z,J,ie){const be=this.length;return this.resize(be+1),this.emplace(be,s,l,f,g,w,x,M,C,P,N,L,j,U,$,Z,J,ie)}emplace(s,l,f,g,w,x,M,C,P,N,L,j,U,$,Z,J,ie,be){const ce=24*s,he=12*s,De=48*s;return this.int16[ce+0]=l,this.int16[ce+1]=f,this.uint16[ce+2]=g,this.uint16[ce+3]=w,this.uint32[he+2]=x,this.uint32[he+3]=M,this.uint32[he+4]=C,this.uint16[ce+10]=P,this.uint16[ce+11]=N,this.uint16[ce+12]=L,this.float32[he+7]=j,this.float32[he+8]=U,this.uint8[De+36]=$,this.uint8[De+37]=Z,this.uint8[De+38]=J,this.uint32[he+10]=ie,this.int16[ce+22]=be,s}}p.prototype.bytesPerElement=48,Ze("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",p);class m extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,g,w,x,M,C,P,N,L,j,U,$,Z,J,ie,be,ce,he,De,Re,ze,tt,We,Je,mt,Qe){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,s,l,f,g,w,x,M,C,P,N,L,j,U,$,Z,J,ie,be,ce,he,De,Re,ze,tt,We,Je,mt,Qe)}emplace(s,l,f,g,w,x,M,C,P,N,L,j,U,$,Z,J,ie,be,ce,he,De,Re,ze,tt,We,Je,mt,Qe,Ye){const Oe=32*s,Tt=16*s;return this.int16[Oe+0]=l,this.int16[Oe+1]=f,this.int16[Oe+2]=g,this.int16[Oe+3]=w,this.int16[Oe+4]=x,this.int16[Oe+5]=M,this.int16[Oe+6]=C,this.int16[Oe+7]=P,this.uint16[Oe+8]=N,this.uint16[Oe+9]=L,this.uint16[Oe+10]=j,this.uint16[Oe+11]=U,this.uint16[Oe+12]=$,this.uint16[Oe+13]=Z,this.uint16[Oe+14]=J,this.uint16[Oe+15]=ie,this.uint16[Oe+16]=be,this.uint16[Oe+17]=ce,this.uint16[Oe+18]=he,this.uint16[Oe+19]=De,this.uint16[Oe+20]=Re,this.uint16[Oe+21]=ze,this.uint16[Oe+22]=tt,this.uint32[Tt+12]=We,this.float32[Tt+13]=Je,this.float32[Tt+14]=mt,this.uint16[Oe+30]=Qe,this.uint16[Oe+31]=Ye,s}}m.prototype.bytesPerElement=64,Ze("StructArrayLayout8i15ui1ul2f2ui64",m);class b extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.float32[1*s+0]=l,s}}b.prototype.bytesPerElement=4,Ze("StructArrayLayout1f4",b);class E extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const w=3*s;return this.uint16[6*s+0]=l,this.float32[w+1]=f,this.float32[w+2]=g,s}}E.prototype.bytesPerElement=12,Ze("StructArrayLayout1ui2f12",E);class T extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const w=4*s;return this.uint32[2*s+0]=l,this.uint16[w+2]=f,this.uint16[w+3]=g,s}}T.prototype.bytesPerElement=8,Ze("StructArrayLayout1ul2ui8",T);class I extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const g=2*s;return this.uint16[g+0]=l,this.uint16[g+1]=f,s}}I.prototype.bytesPerElement=4,Ze("StructArrayLayout2ui4",I);class R extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint16[1*s+0]=l,s}}R.prototype.bytesPerElement=2,Ze("StructArrayLayout1ui2",R);class O extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,s,l,f,g)}emplace(s,l,f,g,w){const x=4*s;return this.float32[x+0]=l,this.float32[x+1]=f,this.float32[x+2]=g,this.float32[x+3]=w,s}}O.prototype.bytesPerElement=16,Ze("StructArrayLayout4f16",O);class z extends _u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new st(this.anchorPointX,this.anchorPointY)}}z.prototype.size=20;class B extends hh{get(s){return new z(this,s)}}Ze("CollisionBoxArray",B);class V extends _u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}V.prototype.size=48;class q extends p{get(s){return new V(this,s)}}Ze("PlacedSymbolArray",q);class ee extends _u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ee.prototype.size=64;class Q extends m{get(s){return new ee(this,s)}}Ze("SymbolInstanceArray",Q);class te extends b{getoffsetX(s){return this.float32[1*s+0]}}Ze("GlyphOffsetArray",te);class re extends cc{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Ze("SymbolLineVertexArray",re);class le extends _u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}le.prototype.size=12;class oe extends E{get(s){return new le(this,s)}}Ze("TextAnchorOffsetArray",oe);class ue extends _u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ue.prototype.size=8;class de extends T{get(s){return new ue(this,s)}}Ze("FeatureIndexArray",de);class se extends ch{}class ve extends ch{}class Ie extends ch{}class Ee extends Wa{}class Me extends Ki{}class Ae extends Go{}class He extends uh{}class Be extends lr{}class ke extends Ns{}class rt extends yf{}class $t extends vf{}class Tn extends o{}class Mn extends u{}class ln extends I{}const hi=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ii}=hi;class Ht{constructor(s=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=s}prepareSegment(s,l,f,g){const w=this.segments[this.segments.length-1];return s>Ht.MAX_VERTEX_ARRAY_LENGTH&&nr(`Max vertices per segment is ${Ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ht.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!w||w.vertexLength+s>Ht.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g?this.createNewSegment(l,f,g):w}createNewSegment(s,l,f){const g={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==f&&(g.sortKey=f),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(s,l,f){return this.prepareSegment(0,s,l,f)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const s of this.segments)for(const l in s.vaos)s.vaos[l].destroy()}static simpleSegment(s,l,f,g){return new Ht([{vertexOffset:s,primitiveOffset:l,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function Bn(c,s){return 256*(c=Hi(Math.floor(c),0,255))+Hi(Math.floor(s),0,255)}Ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze("SegmentVector",Ht);const mr=Ti([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xn,cr,Jr,Pr={exports:{}},ca={exports:{}},uc={exports:{}},El=Gs(function(){if(Jr)return Pr.exports;Jr=1;var c=(Xn||(Xn=1,ca.exports=function(l,f){var g,w,x,M,C,P,N,L;for(w=l.length-(g=3&l.length),x=f,C=3432918353,P=461845907,L=0;L<w;)N=255&l.charCodeAt(L)|(255&l.charCodeAt(++L))<<8|(255&l.charCodeAt(++L))<<16|(255&l.charCodeAt(++L))<<24,++L,x=27492+(65535&(M=5*(65535&(x=(x^=N=(65535&(N=(N=(65535&N)*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*P+(((N>>>16)*P&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(N=0,g){case 3:N^=(255&l.charCodeAt(L+2))<<16;case 2:N^=(255&l.charCodeAt(L+1))<<8;case 1:x^=N=(65535&(N=(N=(65535&(N^=255&l.charCodeAt(L)))*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*P+(((N>>>16)*P&65535)<<16)&4294967295}return x^=l.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),ca.exports),s=(cr||(cr=1,uc.exports=function(l,f){for(var g,w=l.length,x=f^w,M=0;w>=4;)g=1540483477*(65535&(g=255&l.charCodeAt(M)|(255&l.charCodeAt(++M))<<8|(255&l.charCodeAt(++M))<<16|(255&l.charCodeAt(++M))<<24))+((1540483477*(g>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),w-=4,++M;switch(w){case 3:x^=(255&l.charCodeAt(M+2))<<16;case 2:x^=(255&l.charCodeAt(M+1))<<8;case 1:x=1540483477*(65535&(x^=255&l.charCodeAt(M)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),uc.exports);return Pr.exports=c,Pr.exports.murmur3=c,Pr.exports.murmur2=s,Pr.exports}());class yu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,l,f,g){this.ids.push(Za(s)),this.positions.push(l,f,g)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Za(s);let f=0,g=this.ids.length-1;for(;f<g;){const x=f+g>>1;this.ids[x]>=l?g=x:f=x+1}const w=[];for(;this.ids[f]===l;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(s,l){const f=new Float64Array(s.ids),g=new Uint32Array(s.positions);return Mo(f,g,0,f.length-1),l&&l.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(s){const l=new yu;return l.ids=s.ids,l.positions=s.positions,l.indexed=!0,l}}function Za(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:El(String(c))}function Mo(c,s,l,f){for(;l<f;){const g=c[l+f>>1];let w=l-1,x=f+1;for(;;){do{w++}while(c[w]<g);do{x--}while(c[x]>g);if(w>=x)break;Rr(c,w,x),Rr(s,3*w,3*x),Rr(s,3*w+1,3*x+1),Rr(s,3*w+2,3*x+2)}x-l<f-x?(Mo(c,s,l,x),l=x+1):(Mo(c,s,x+1,f),f=x)}}function Rr(c,s,l){const f=c[s];c[s]=c[l],c[l]=f}Ze("FeaturePositionMap",yu);class eo{constructor(s,l){this.gl=s.gl,this.location=l}}class ms extends eo{constructor(s,l){super(s,l),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Yi extends eo{constructor(s,l){super(s,l),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class _r extends eo{constructor(s,l){super(s,l),this.current=nn.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const $o=new Float32Array(16);function Qn(c){return[Bn(255*c.r,255*c.g),Bn(255*c.b,255*c.a)]}class dh{constructor(s,l,f){this.value=s,this.uniformNames=l.map(g=>`u_${g}`),this.type=f}setUniform(s,l,f){s.set(f.constantOr(this.value))}getBinding(s,l,f){return"color"===this.type?new _r(s,l):new ms(s,l)}}class vu{constructor(s,l){this.uniformNames=l.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=s.tlbr}setUniform(s,l,f,g){const w="u_pattern_to"===g?this.patternTo:"u_pattern_from"===g?this.patternFrom:"u_pixel_ratio_to"===g?this.pixelRatioTo:"u_pixel_ratio_from"===g?this.pixelRatioFrom:null;w&&s.set(w)}getBinding(s,l,f){return"u_pattern"===f.substr(0,9)?new Yi(s,l):new ms(s,l)}}class ua{constructor(s,l,f,g){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(s,l,f,g,w){const x=this.paintVertexArray.length,M=this.expression.evaluate(new ui(0),l,{},g,[],w);this.paintVertexArray.resize(s),this._setPaintValue(x,s,M)}updatePaintArray(s,l,f,g){const w=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(s,l,w)}_setPaintValue(s,l,f){if("color"===this.type){const g=Qn(f);for(let w=s;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=s;g<l;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ha{constructor(s,l,f,g,w,x){this.expression=s,this.uniformNames=l.map(M=>`u_${M}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=l.map(M=>({name:`a_${M}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(s,l,f,g,w){const x=this.expression.evaluate(new ui(this.zoom),l,{},g,[],w),M=this.expression.evaluate(new ui(this.zoom+1),l,{},g,[],w),C=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(C,s,x,M)}updatePaintArray(s,l,f,g){const w=this.expression.evaluate({zoom:this.zoom},f,g),x=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(s,l,w,x)}_setPaintValue(s,l,f,g){if("color"===this.type){const w=Qn(f),x=Qn(g);for(let M=s;M<l;M++)this.paintVertexArray.emplace(M,w[0],w[1],x[0],x[1])}else{for(let w=s;w<l;w++)this.paintVertexArray.emplace(w,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,l){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=Hi(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(g)}getBinding(s,l,f){return new ms(s,l)}}class Ml{constructor(s,l,f,g,w,x){this.expression=s,this.type=l,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(s,l,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(g,s,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(s,l,f,g,w){this._setPaintValues(s,l,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(s,l,f,g){if(!g||!f)return;const{min:w,mid:x,max:M}=f,C=g[w],P=g[x],N=g[M];if(C&&P&&N)for(let L=s;L<l;L++)this.zoomInPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],P.pixelRatio,N.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,mr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,mr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class bf{constructor(s,l,f){this.binders={},this._buffers=[];const g=[];for(const w in s.paint._values){if(!f(w))continue;const x=s.paint.get(w);if(!(x instanceof Ha&&Ue(x.property.specification)))continue;const M=Dl(w,s.type),C=x.value,P=x.property.specification.type,N=x.property.useIntegerZoom,L=x.property.specification["property-type"],j="cross-faded"===L||"cross-faded-data-driven"===L;if("constant"===C.kind)this.binders[w]=j?new vu(C.value,M):new dh(C.value,M,P),g.push(`/u_${w}`);else if("source"===C.kind||j){const U=bu(w,P,"source");this.binders[w]=j?new Ml(C,P,N,l,U,s.id):new ua(C,M,P,U),g.push(`/a_${w}`)}else{const U=bu(w,P,"composite");this.binders[w]=new ha(C,M,P,N,l,U),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(s){const l=this.binders[s];return l instanceof ua||l instanceof ha?l.maxValue:0}populatePaintArrays(s,l,f,g,w){for(const x in this.binders){const M=this.binders[x];(M instanceof ua||M instanceof ha||M instanceof Ml)&&M.populatePaintArray(s,l,f,g,w)}}setConstantPatternPositions(s,l){for(const f in this.binders){const g=this.binders[f];g instanceof vu&&g.setConstantPatternPositions(s,l)}}updatePaintArrays(s,l,f,g,w){let x=!1;for(const M in s){const C=l.getPositions(M);for(const P of C){const N=f.feature(P.index);for(const L in this.binders){const j=this.binders[L];if((j instanceof ua||j instanceof ha||j instanceof Ml)&&!0===j.expression.isStateDependent){const U=g.paint.get(L);j.expression=U.value,j.updatePaintArray(P.start,P.end,N,s[M],w),x=!0}}}}return x}defines(){const s=[];for(const l in this.binders){const f=this.binders[l];(f instanceof dh||f instanceof vu)&&s.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return s}getBinderAttributes(){const s=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof ua||f instanceof ha)for(let g=0;g<f.paintVertexAttributes.length;g++)s.push(f.paintVertexAttributes[g].name);else if(f instanceof Ml)for(let g=0;g<mr.members.length;g++)s.push(mr.members[g].name)}return s}getBinderUniforms(){const s=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof dh||f instanceof vu||f instanceof ha)for(const g of f.uniformNames)s.push(g)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,l){const f=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof dh||w instanceof vu||w instanceof ha)for(const x of w.uniformNames)if(l[x]){const M=w.getBinding(s,l[x],x);f.push({name:x,property:g,binding:M})}}return f}setUniforms(s,l,f,g){for(const{name:w,property:x,binding:M}of l)this.binders[x].setUniform(M,g,f.get(x),w)}updatePaintBuffers(s){this._buffers=[];for(const l in this.binders){const f=this.binders[l];if(s&&f instanceof Ml){const g=2===s.fromScale?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof ua||f instanceof ha)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(s){for(const l in this.binders){const f=this.binders[l];(f instanceof ua||f instanceof ha||f instanceof Ml)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const l=this.binders[s];(l instanceof ua||l instanceof ha||l instanceof Ml)&&l.destroy()}}}class Do{constructor(s,l,f=()=>!0){this.programConfigurations={};for(const g of s)this.programConfigurations[g.id]=new bf(g,l,f);this.needsUpload=!1,this._featureMap=new yu,this._bufferOffset=0}populatePaintArrays(s,l,f,g,w,x){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(s,l,g,w,x);void 0!==l.id&&this._featureMap.add(l.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,l,f,g){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(s,this._featureMap,l,w,g)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function Dl(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function bu(c,s,l){const g={"line-pattern":{source:He,composite:He},"fill-pattern":{source:He,composite:He},"fill-extrusion-pattern":{source:He,composite:He}}[c];return g&&g[l]||{color:{source:Go,composite:O},number:{source:b,composite:Go}}[s][l]}Ze("ConstantBinder",dh),Ze("CrossFadedConstantBinder",vu),Ze("SourceExpressionBinder",ua),Ze("CrossFadedCompositeBinder",Ml),Ze("CompositeExpressionBinder",ha),Ze("ProgramConfiguration",bf,{omit:["_buffers"]}),Ze("ProgramConfigurationSet",Do);const fd=Math.pow(2,14)-1,pd=-fd-1;function _s(c){const s=pn/c.extent,l=c.loadGeometry();for(let f=0;f<l.length;f++){const g=l[f];for(let w=0;w<g.length;w++){const x=g[w],M=Math.round(x.x*s),C=Math.round(x.y*s);x.x=Hi(M,pd,fd),x.y=Hi(C,pd,fd),(M<x.x||M>x.x+1||C<x.y||C>x.y+1)&&nr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Ka(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?_s(c):[]}}function z0(c,s,l,f,g){c.emplaceBack(8*s-32768+f,8*l-32768+g)}class Wm{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ve,this.indexArray=new Mn,this.segments=new Ht,this.programConfigurations=new Do(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){const g=this.layers[0],w=[];let x=null,M=!1,C="heatmap"===g.type;if("circle"===g.type){const N=g;x=N.layout.get("circle-sort-key"),M=!x.isConstant(),C=C||"map"===N.paint.get("circle-pitch-alignment")}const P=C?l.subdivisionGranularity.circle:1;for(const{feature:N,id:L,index:j,sourceLayerIndex:U}of s){const $=this.layers[0]._featureFilter.needGeometry,Z=Ka(N,$);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom,{globalState:this.globalState}),Z,f))continue;const J=M?x.evaluate(Z,{},f):void 0,ie={id:L,properties:N.properties,type:N.type,sourceLayerIndex:U,index:j,geometry:$?Z.geometry:_s(N),patterns:{},sortKey:J};w.push(ie)}M&&w.sort((N,L)=>N.sortKey-L.sortKey);for(const N of w){const{geometry:L,index:j,sourceLayerIndex:U}=N,$=s[j].feature;this.addFeature(N,L,j,f,P),l.featureIndex.insert($,L,j,U,this.index)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ii),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,l,f,g,w=1){let x;switch(w){case 1:x=[0,7];break;case 3:x=[0,2,5,7];break;case 5:x=[0,1,3,4,6,7];break;case 7:x=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${w}; valid values are 1, 3, 5, 7.`)}const M=x.length;for(const C of l)for(const P of C){const N=P.x,L=P.y;if(N<0||N>=pn||L<0||L>=pn)continue;const j=this.segments.prepareSegment(M*M,this.layoutVertexArray,this.indexArray,s.sortKey),U=j.vertexLength;for(let $=0;$<M;$++)for(let Z=0;Z<M;Z++)z0(this.layoutVertexArray,N,L,x[Z],x[$]);for(let $=0;$<M-1;$++)for(let Z=0;Z<M-1;Z++){const J=U+$*M+Z,ie=U+($+1)*M+Z;this.indexArray.emplaceBack(J,ie+1,J+1),this.indexArray.emplaceBack(J,ie,ie+1)}j.vertexLength+=M*M,j.primitiveLength+=(M-1)*(M-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},g)}}function j0(c,s){for(let l=0;l<c.length;l++)if(ys(s,c[l]))return!0;for(let l=0;l<s.length;l++)if(ys(c,s[l]))return!0;return!!Gp(c,s)}function Ww(c,s,l){return!!ys(c,s)||!!di(s,c,l)}function Zm(c,s){if(1===c.length)return wn(s,c[0]);for(let l=0;l<s.length;l++){const f=s[l];for(let g=0;g<f.length;g++)if(ys(c,f[g]))return!0}for(let l=0;l<c.length;l++)if(wn(s,c[l]))return!0;for(let l=0;l<s.length;l++)if(Gp(c,s[l]))return!0;return!1}function wu(c,s,l){if(c.length>1){if(Gp(c,s))return!0;for(let f=0;f<s.length;f++)if(di(s[f],c,l))return!0}for(let f=0;f<c.length;f++)if(di(c[f],s,l))return!0;return!1}function Gp(c,s){if(0===c.length||0===s.length)return!1;for(let l=0;l<c.length-1;l++){const f=c[l],g=c[l+1];for(let w=0;w<s.length-1;w++)if(Nr(f,g,s[w],s[w+1]))return!0}return!1}function Nr(c,s,l,f){return Es(c,l,f)!==Es(s,l,f)&&Es(c,s,l)!==Es(c,s,f)}function di(c,s,l){const f=l*l;if(1===s.length)return c.distSqr(s[0])<f;for(let g=1;g<s.length;g++)if(V0(c,s[g-1],s[g])<f)return!0;return!1}function V0(c,s,l){const f=s.distSqr(l);if(0===f)return c.distSqr(s);const g=((c.x-s.x)*(l.x-s.x)+(c.y-s.y)*(l.y-s.y))/f;return c.distSqr(g<0?s:g>1?l:l.sub(s)._mult(g)._add(s))}function wn(c,s){let l,f,g,w=!1;for(let x=0;x<c.length;x++){l=c[x];for(let M=0,C=l.length-1;M<l.length;C=M++)f=l[M],g=l[C],f.y>s.y!=g.y>s.y&&s.x<(g.x-f.x)*(s.y-f.y)/(g.y-f.y)+f.x&&(w=!w)}return w}function ys(c,s){let l=!1;for(let f=0,g=c.length-1;f<c.length;g=f++){const w=c[f],x=c[g];w.y>s.y!=x.y>s.y&&s.x<(x.x-w.x)*(s.y-w.y)/(x.y-w.y)+w.x&&(l=!l)}return l}function gd(c,s,l){const f=l[0],g=l[2];if(c.x<f.x&&s.x<f.x||c.x>g.x&&s.x>g.x||c.y<f.y&&s.y<f.y||c.y>g.y&&s.y>g.y)return!1;const w=Es(c,s,l[0]);return w!==Es(c,s,l[1])||w!==Es(c,s,l[2])||w!==Es(c,s,l[3])}function Cl(c,s,l){const f=s.paint.get(c).value;return"constant"===f.kind?f.value:l.programConfigurations.get(s.id).getMaxValue(c)}function dc(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function wf(c,s,l,f,g){if(!s[0]&&!s[1])return c;const w=st.convert(s)._mult(g);"viewport"===l&&w._rotate(-f);const x=[];for(let M=0;M<c.length;M++)x.push(c[M].sub(w));return x}let $p,fh;Ze("CircleBucket",Wm,{omit:["layers"]});var rT={get paint(){return fh=fh||new St({"circle-radius":new Se(xe.paint_circle["circle-radius"]),"circle-color":new Se(xe.paint_circle["circle-color"]),"circle-blur":new Se(xe.paint_circle["circle-blur"]),"circle-opacity":new Se(xe.paint_circle["circle-opacity"]),"circle-translate":new dt(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Se(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Se(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Se(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return $p=$p||new St({"circle-sort-key":new Se(xe.layout_circle["circle-sort-key"])})}};class Zw extends Qr{constructor(s){super(s,rT)}createBucket(s){return new Wm(s)}queryRadius(s){const l=s;return Cl("circle-radius",this,l)+Cl("circle-stroke-width",this,l)+dc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:f,geometry:g,transform:w,pixelsToTileUnits:x,unwrappedTileID:M,getElevation:C}){const P=wf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-w.bearingInRadians,x),N=this.paint.get("circle-radius").evaluate(l,f)+this.paint.get("circle-stroke-width").evaluate(l,f),L="map"===this.paint.get("circle-pitch-alignment"),j=L?P:(Z=w,J=M,ie=C,P.map(be=>Hp(be,Z,J,ie))),U=L?N*x:N;var Z,J,ie;for(const $ of g)for(const Z of $){const J=L?Z:Hp(Z,w,M,C);let ie=U;const be=w.projectTileCoordinates(Z.x,Z.y,M,C).signedDistanceFromCamera;if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?ie*=be/w.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(ie*=w.cameraToCenterDistance/be),Ww(j,J,ie))return!0}return!1}}function Hp(c,s,l,f){const g=s.projectTileCoordinates(c.x,c.y,l,f).point;return new st((.5*g.x+.5)*s.width,(.5*-g.y+.5)*s.height)}class U0 extends Wm{}let qp;Ze("HeatmapBucket",U0,{omit:["layers"]});var Kw={get paint(){return qp=qp||new St({"heatmap-radius":new Se(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Se(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zr(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(xe.paint_heatmap["heatmap-opacity"])})}};function vs(c,{width:s,height:l},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==s*l*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${s*l*f}`)}else g=new Uint8Array(s*l*f);return c.width=s,c.height=l,c.data=g,c}function Km(c,{width:s,height:l},f){if(s===c.width&&l===c.height)return;const g=vs({},{width:s,height:l},f);Ym(c,g,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,l)},f),c.width=s,c.height=l,c.data=g.data}function Ym(c,s,l,f,g,w){if(0===g.width||0===g.height)return s;if(g.width>c.width||g.height>c.height||l.x>c.width-g.width||l.y>c.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>s.width||g.height>s.height||f.x>s.width-g.width||f.y>s.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=c.data,M=s.data;if(x===M)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<g.height;C++){const P=((l.y+C)*c.width+l.x)*w,N=((f.y+C)*s.width+f.x)*w;for(let L=0;L<g.width*w;L++)M[N+L]=x[P+L]}return s}class fc{constructor(s,l){vs(this,s,1,l)}resize(s){Km(this,s,1)}clone(){return new fc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,f,g,w){Ym(s,l,f,g,w,1)}}class Ho{constructor(s,l){vs(this,s,4,l)}resize(s){Km(this,s,4)}replace(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,f,g,w){Ym(s,l,f,g,w,4)}setPixel(s,l,f){const g=4*(s*this.width+l);this.data[g+0]=Math.round(255*f.r/f.a),this.data[g+1]=Math.round(255*f.g/f.a),this.data[g+2]=Math.round(255*f.b/f.a),this.data[g+3]=Math.round(255*f.a)}}function G0(c){const s={},l=c.resolution||256,f=c.clips?c.clips.length:1,g=c.image||new Ho({width:l,height:f});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const w=(x,M,C)=>{s[c.evaluationKey]=C;const P=c.expression.evaluate(s);g.setPixel(x/4/l,M/4,P)};if(c.clips)for(let x=0,M=0;x<f;++x,M+=4*l)for(let C=0,P=0;C<l;C++,P+=4){const N=C/(l-1),{start:L,end:j}=c.clips[x];w(M,P,L*(1-N)+j*N)}else for(let x=0,M=0;x<l;x++,M+=4)w(0,M,x/(l-1));return g}Ze("AlphaImage",fc),Ze("RGBAImage",Ho);const Xm="big-fb";class Yw extends Qr{createBucket(s){return new U0(s)}constructor(s){super(s,Kw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=G0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Xm)&&this.heatmapFbos.delete(Xm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let $0;var Xw={get paint(){return $0=$0||new St({"hillshade-illumination-direction":new dt(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new dt(xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new dt(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new dt(xe.paint_hillshade["hillshade-method"])})}};class Qm extends Qr{constructor(s){super(s,Xw),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let s=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,f=this.paint.get("hillshade-highlight-color").values,g=this.paint.get("hillshade-shadow-color").values;const w=Math.max(s.length,l.length,f.length,g.length);s=s.concat(Array(w-s.length).fill(s.at(-1))),l=l.concat(Array(w-l.length).fill(l.at(-1))),f=f.concat(Array(w-f.length).fill(f.at(-1))),g=g.concat(Array(w-g.length).fill(g.at(-1)));const x=l.map(Ks);return{directionRadians:s.map(Ks),altitudeRadians:x,shadowColor:g,highlightColor:f}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}let xf;var Qw={get paint(){return xf=xf||new St({"color-relief-opacity":new dt(xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new zr(xe["paint_color-relief"]["color-relief-color"])})}};class Wp{constructor(s,l,f,g){this.context=s,this.format=f,this.texture=s.gl.createTexture(),this.update(l,g)}update(s,l,f){const{width:g,height:w}=s,x=!(this.size&&this.size[0]===g&&this.size[1]===w||f),{context:M}=this,{gl:C}=M;if(this.useMipmap=!(!l||!l.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!l||!1!==l.premultiply)),x)this.size=[g,w],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Ca(s)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,s):C.texImage2D(C.TEXTURE_2D,0,this.format,g,w,0,this.format,C.UNSIGNED_BYTE,s.data);else{const{x:P,y:N}=f||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Ca(s)?C.texSubImage2D(C.TEXTURE_2D,0,P,N,C.RGBA,C.UNSIGNED_BYTE,s):C.texSubImage2D(C.TEXTURE_2D,0,P,N,g,w,C.RGBA,C.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D),M.pixelStoreUnpackFlipY.setDefault(),M.pixelStoreUnpack.setDefault(),M.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(s,l,f){const{context:g}=this,{gl:w}=g;w.bindTexture(w.TEXTURE_2D,this.texture),f!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=w.LINEAR),s!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,s),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,f||s),this.filter=s),l!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,l),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class fo{constructor(s,l,f,g=1,w=1,x=1,M=0){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void nr(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const C=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<C;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(C,P)]=this.data[this._idx(C-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,C)]=this.data[this._idx(P,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<C;P++)for(let N=0;N<C;N++){const L=this.get(P,N);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(s,l){const f=new Uint8Array(this.data.buffer),g=4*this._idx(s,l);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(s+1)}unpack(s,l,f){return s*this.redFactor+l*this.greenFactor+f*this.blueFactor-this.baseShift}pack(s){return Jm(s,this.getUnpackVector())}getPixels(){return new Ho({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,l,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,w=l*this.dim+this.dim,x=f*this.dim,M=f*this.dim+this.dim;switch(l){case-1:g=w-1;break;case 1:w=g+1}switch(f){case-1:x=M-1;break;case 1:M=x+1}const C=-l*this.dim,P=-f*this.dim;for(let N=x;N<M;N++)for(let L=g;L<w;L++)this.data[this._idx(L,N)]=s.data[this._idx(L+C,N+P)]}}function Jm(c,s){const l=s[0],f=s[1],g=s[2],w=s[3],x=Math.min(l,f,g),M=Math.round((c+w)/x);return{r:Math.floor(M*x/l)%256,g:Math.floor(M*x/f)%256,b:Math.floor(M*x/g)%256}}Ze("DEMData",fo);class Jw extends Qr{constructor(s){super(s,Qw)}_createColorRamp(s){const l={elevationStops:[],colorStops:[]},f=this._transitionablePaint._values["color-relief-color"].value.expression;if(f instanceof As&&f._styleExpression.expression instanceof Ir){this.colorRampExpression=f;const x=f._styleExpression.expression;l.elevationStops=x.labels,l.colorStops=[];for(const M of l.elevationStops)l.colorStops.push(x.evaluate({globals:{elevation:M}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[nn.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=s)return l;const g={elevationStops:[],colorStops:[]},w=(l.elevationStops.length-1)/(s-1);for(let x=0;x<l.elevationStops.length-.5;x+=w)g.elevationStops.push(l.elevationStops[Math.round(x)]),g.colorStops.push(l.colorStops[Math.round(x)]);return nr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),g}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(s,l,f){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const g=this._createColorRamp(l),w=new Ho({width:g.colorStops.length,height:1}),x=new Ho({width:g.colorStops.length,height:1});for(let M=0;M<g.elevationStops.length;M++){const C=Jm(g.elevationStops[M],f);x.setPixel(0,M,new nn(C.r/255,C.g/255,C.b/255,1)),w.setPixel(0,M,g.colorStops[M])}return this.colorRampTextures={elevationTexture:new Wp(s,x,s.gl.RGBA),colorTexture:new Wp(s,w,s.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return"none"!==this.visibility&&!!this.colorRampTextures}}const ex=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:H0}=ex;function Zp(c,s,l){const f=l.patternDependencies;let g=!1;for(const w of s){const x=w.paint.get(`${c}-pattern`);x.isConstant()||(g=!0);const M=x.constantOr(null);M&&(g=!0,f[M.to]=!0,f[M.from]=!0)}return g}function e_(c,s,l,f,g){const w=g.patternDependencies;for(const x of s){const M=x.paint.get(`${c}-pattern`).value;if("constant"!==M.kind){let C=M.evaluate({zoom:f-1},l,{},g.availableImages),P=M.evaluate({zoom:f},l,{},g.availableImages),N=M.evaluate({zoom:f+1},l,{},g.availableImages);C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,N=N&&N.name?N.name:N,w[C]=!0,w[P]=!0,w[N]=!0,l.patterns[x.id]={min:C,mid:P,max:N}}}return l}function xu(c,s,l,f,g){let w;if(g===function(x,M,C,P){let N=0;for(let L=M,j=C-P;L<C;L+=P)N+=(x[j]-x[L])*(x[L+1]+x[j+1]),j=L;return N}(c,s,l,f)>0)for(let x=s;x<l;x+=f)w=K0(x/f|0,c[x],c[x+1],w);else for(let x=l-f;x>=s;x-=f)w=K0(x/f|0,c[x],c[x+1],w);return w&&gh(w,w.next)&&(md(w),w=w.next),w}function ph(c,s){if(!c)return c;s||(s=c);let l,f=c;do{if(l=!1,f.steiner||!gh(f,f.next)&&0!==Ai(f.prev,f,f.next))f=f.next;else{if(md(f),f=s=f.prev,f===f.next)break;l=!0}}while(l||f!==s);return s}function Sf(c,s,l,f,g,w,x){if(!c)return;!x&&w&&function(C,P,N,L){let j=C;do{0===j.z&&(j.z=Xp(j.x,j.y,P,N,L)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==C);j.prevZ.nextZ=null,j.prevZ=null,function(U){let $,Z=1;do{let J,ie=U;U=null;let be=null;for($=0;ie;){$++;let ce=ie,he=0;for(let Re=0;Re<Z&&(he++,ce=ce.nextZ,ce);Re++);let De=Z;for(;he>0||De>0&&ce;)0!==he&&(0===De||!ce||ie.z<=ce.z)?(J=ie,ie=ie.nextZ,he--):(J=ce,ce=ce.nextZ,De--),be?be.nextZ=J:U=J,J.prevZ=be,be=J;ie=ce}be.nextZ=null,Z*=2}while($>1)}(j)}(c,f,g,w);let M=c;for(;c.prev!==c.next;){const C=c.prev,P=c.next;if(w?qn(c,f,g,w):tx(c))s.push(C.i,c.i,P.i),md(c),c=P.next,M=P.next;else if((c=P)===M){x?1===x?Sf(c=nx(ph(c),s),s,l,f,g,w,2):2===x&&q0(c,s,l,f,g,w):Sf(ph(c),s,l,f,g,w,1);break}}}function tx(c){const s=c.prev,l=c,f=c.next;if(Ai(s,l,f)>=0)return!1;const g=s.x,w=l.x,x=f.x,M=s.y,C=l.y,P=f.y,N=Math.min(g,w,x),L=Math.min(M,C,P),j=Math.max(g,w,x),U=Math.max(M,C,P);let $=f.next;for(;$!==s;){if($.x>=N&&$.x<=j&&$.y>=L&&$.y<=U&&Tl(g,M,w,C,x,P,$.x,$.y)&&Ai($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function qn(c,s,l,f){const g=c.prev,w=c,x=c.next;if(Ai(g,w,x)>=0)return!1;const M=g.x,C=w.x,P=x.x,N=g.y,L=w.y,j=x.y,U=Math.min(M,C,P),$=Math.min(N,L,j),Z=Math.max(M,C,P),J=Math.max(N,L,j),ie=Xp(U,$,s,l,f),be=Xp(Z,J,s,l,f);let ce=c.prevZ,he=c.nextZ;for(;ce&&ce.z>=ie&&he&&he.z<=be;){if(ce.x>=U&&ce.x<=Z&&ce.y>=$&&ce.y<=J&&ce!==g&&ce!==x&&Tl(M,N,C,L,P,j,ce.x,ce.y)&&Ai(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,he.x>=U&&he.x<=Z&&he.y>=$&&he.y<=J&&he!==g&&he!==x&&Tl(M,N,C,L,P,j,he.x,he.y)&&Ai(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ce&&ce.z>=ie;){if(ce.x>=U&&ce.x<=Z&&ce.y>=$&&ce.y<=J&&ce!==g&&ce!==x&&Tl(M,N,C,L,P,j,ce.x,ce.y)&&Ai(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;he&&he.z<=be;){if(he.x>=U&&he.x<=Z&&he.y>=$&&he.y<=J&&he!==g&&he!==x&&Tl(M,N,C,L,P,j,he.x,he.y)&&Ai(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function nx(c,s){let l=c;do{const f=l.prev,g=l.next.next;!gh(f,g)&&ix(f,l,l.next,g)&&eg(f,g)&&eg(g,f)&&(s.push(f.i,l.i,g.i),md(l),md(l.next),l=c=g),l=l.next}while(l!==c);return ph(l)}function q0(c,s,l,f,g,w){let x=c;do{let M=x.next.next;for(;M!==x.prev;){if(x.i!==M.i&&Ef(x,M)){let C=rx(x,M);return x=ph(x,x.next),C=ph(C,C.next),Sf(x,s,l,f,g,w,0),void Sf(C,s,l,f,g,w,0)}M=M.next}x=x.next}while(x!==c)}function Kp(c,s){let l=c.x-s.x;return 0===l&&(l=c.y-s.y,0===l)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(s.next.y-s.y)/(s.next.x-s.x)),l}function Yp(c,s){const l=function(g,w){let x=w;const M=g.x,C=g.y;let P,N=-1/0;if(gh(g,x))return x;do{if(gh(g,x.next))return x.next;if(C<=x.y&&C>=x.next.y&&x.next.y!==x.y){const Z=x.x+(C-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(Z<=M&&Z>N&&(N=Z,P=x.x<x.next.x?x:x.next,Z===M))return P}x=x.next}while(x!==w);if(!P)return null;const L=P,j=P.x,U=P.y;let $=1/0;x=P;do{if(M>=x.x&&x.x>=j&&M!==x.x&&Z0(C<U?M:N,C,j,U,C<U?N:M,C,x.x,x.y)){const Z=Math.abs(C-x.y)/(M-x.x);eg(x,g)&&(Z<$||Z===$&&(x.x>P.x||x.x===P.x&&t_(P,x)))&&(P=x,$=Z)}x=x.next}while(x!==L);return P}(c,s);if(!l)return s;const f=rx(l,c);return ph(f,f.next),ph(l,l.next)}function t_(c,s){return Ai(c.prev,c,s.prev)<0&&Ai(s.next,c,c.next)<0}function Xp(c,s,l,f,g){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*g|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function W0(c){let s=c,l=c;do{(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next}while(s!==c);return l}function Z0(c,s,l,f,g,w,x,M){return(g-x)*(s-M)>=(c-x)*(w-M)&&(c-x)*(f-M)>=(l-x)*(s-M)&&(l-x)*(w-M)>=(g-x)*(f-M)}function Tl(c,s,l,f,g,w,x,M){return!(c===x&&s===M)&&Z0(c,s,l,f,g,w,x,M)}function Ef(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(l,f){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==f.i&&g.next.i!==f.i&&ix(g,g.next,l,f))return!0;g=g.next}while(g!==l);return!1}(c,s)&&(eg(c,s)&&eg(s,c)&&function(l,f){let g=l,w=!1;const x=(l.x+f.x)/2,M=(l.y+f.y)/2;do{g.y>M!=g.next.y>M&&g.next.y!==g.y&&x<(g.next.x-g.x)*(M-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next}while(g!==l);return w}(c,s)&&(Ai(c.prev,c,s.prev)||Ai(c,s.prev,s))||gh(c,s)&&Ai(c.prev,c,c.next)>0&&Ai(s.prev,s,s.next)>0)}function Ai(c,s,l){return(s.y-c.y)*(l.x-s.x)-(s.x-c.x)*(l.y-s.y)}function gh(c,s){return c.x===s.x&&c.y===s.y}function ix(c,s,l,f){const g=Jp(Ai(c,s,l)),w=Jp(Ai(c,s,f)),x=Jp(Ai(l,f,c)),M=Jp(Ai(l,f,s));return g!==w&&x!==M||!(0!==g||!Qp(c,l,s))||!(0!==w||!Qp(c,f,s))||!(0!==x||!Qp(l,c,f))||!(0!==M||!Qp(l,s,f))}function Qp(c,s,l){return s.x<=Math.max(c.x,l.x)&&s.x>=Math.min(c.x,l.x)&&s.y<=Math.max(c.y,l.y)&&s.y>=Math.min(c.y,l.y)}function Jp(c){return c>0?1:c<0?-1:0}function eg(c,s){return Ai(c.prev,c,c.next)<0?Ai(c,s,c.next)>=0&&Ai(c,c.prev,s)>=0:Ai(c,s,c.prev)<0||Ai(c,c.next,s)<0}function rx(c,s){const l=tg(c.i,c.x,c.y),f=tg(s.i,s.x,s.y),g=c.next,w=s.prev;return c.next=s,s.prev=c,l.next=g,g.prev=l,f.next=l,l.prev=f,w.next=f,f.prev=w,f}function K0(c,s,l,f){const g=tg(c,s,l);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function md(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function tg(c,s,l){return{i:c,x:s,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ya{constructor(s,l){if(l>s)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=s,this._minGranularity=l}getGranularityForZoomLevel(s){return Math.max(Math.floor(this._baseZoomGranularity/(1<<s)),this._minGranularity,1)}}class Mf{constructor(s){this.fill=s.fill,this.line=s.line,this.tile=s.tile,this.stencil=s.stencil,this.circle=s.circle}}Mf.noSubdivision=new Mf({fill:new Ya(0,0),line:new Ya(0,0),tile:new Ya(0,0),stencil:new Ya(0,0),circle:1}),Ze("SubdivisionGranularityExpression",Ya),Ze("SubdivisionGranularitySetting",Mf);const Su=-32768,pc=32767;class ox{constructor(s,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=s,this._granularityCellSize=pn/s,this._canonical=l}_getKey(s,l){return(s+=32768)<<16|l+32768}_vertexToIndex(s,l){if(s<-32768||l<-32768||s>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const f=0|Math.round(s),g=0|Math.round(l),w=this._getKey(f,g);if(this._vertexDictionary.has(w))return this._vertexDictionary.get(w);const x=this._vertexBuffer.length/2;return this._vertexDictionary.set(w,x),this._vertexBuffer.push(f,g),x}_subdivideTrianglesScanline(s){if(this._granularity<2)return function(g,w){const x=[];for(let M=0;M<w.length;M+=3){const C=w[M],P=w[M+1],N=w[M+2],L=g[2*C],j=g[2*C+1];(g[2*P]-L)*(g[2*N+1]-j)-(g[2*P+1]-j)*(g[2*N]-L)>0?(x.push(C),x.push(N),x.push(P)):(x.push(C),x.push(P),x.push(N))}return x}(this._vertexBuffer,s);const l=[],f=s.length;for(let g=0;g<f;g+=3){const w=[s[g+0],s[g+1],s[g+2]],x=[this._vertexBuffer[2*s[g+0]+0],this._vertexBuffer[2*s[g+0]+1],this._vertexBuffer[2*s[g+1]+0],this._vertexBuffer[2*s[g+1]+1],this._vertexBuffer[2*s[g+2]+0],this._vertexBuffer[2*s[g+2]+1]];let M=1/0,C=1/0,P=-1/0,N=-1/0;for(let Z=0;Z<3;Z++){const J=x[2*Z],ie=x[2*Z+1];M=Math.min(M,J),P=Math.max(P,J),C=Math.min(C,ie),N=Math.max(N,ie)}if(M===P||C===N)continue;const L=Math.floor(M/this._granularityCellSize),j=Math.ceil(P/this._granularityCellSize),U=Math.floor(C/this._granularityCellSize),$=Math.ceil(N/this._granularityCellSize);if(L!==j||U!==$)for(let Z=U;Z<$;Z++){const J=this._scanlineGenerateVertexRingForCellRow(Z,x,w);ng(this._vertexBuffer,J,l)}else l.push(...w)}return l}_scanlineGenerateVertexRingForCellRow(s,l,f){const g=s*this._granularityCellSize,w=g+this._granularityCellSize,x=[];for(let M=0;M<3;M++){const C=l[2*M],P=l[2*M+1],N=l[2*(M+1)%6],L=l[(2*(M+1)+1)%6],j=l[2*(M+2)%6],U=l[(2*(M+2)+1)%6],$=N-C,Z=L-P,J=0===$,ie=0===Z,be=(g-P)/Z,ce=(w-P)/Z,he=Math.min(be,ce),De=Math.max(be,ce);if(!ie&&(he>=1||De<=0)||ie&&(P<g||P>w)){L>=g&&L<=w&&x.push(f[(M+1)%3]);continue}!ie&&he>0&&x.push(this._vertexToIndex(C+$*he,P+Z*he));const Re=C+$*Math.max(he,0),ze=C+$*Math.min(De,1);J||this._generateIntraEdgeVertices(x,C,P,N,L,Re,ze),!ie&&De<1&&x.push(this._vertexToIndex(C+$*De,P+Z*De)),(ie||L>=g&&L<=w)&&x.push(f[(M+1)%3]),!ie&&(L<=g||L>=w)&&this._generateInterEdgeVertices(x,C,P,N,L,j,U,ze,g,w)}return x}_generateIntraEdgeVertices(s,l,f,g,w,x,M){const C=g-l,P=w-f,N=0===P,L=N?Math.min(l,g):Math.min(x,M),j=N?Math.max(l,g):Math.max(x,M),U=Math.floor(L/this._granularityCellSize)+1,$=Math.ceil(j/this._granularityCellSize)-1;if(N?l<g:x<M)for(let Z=U;Z<=$;Z++){const J=Z*this._granularityCellSize;s.push(this._vertexToIndex(J,f+P*(J-l)/C))}else for(let Z=$;Z>=U;Z--){const J=Z*this._granularityCellSize;s.push(this._vertexToIndex(J,f+P*(J-l)/C))}}_generateInterEdgeVertices(s,l,f,g,w,x,M,C,P,N){const L=w-f,j=x-g,U=M-w,$=(P-w)/U,Z=(N-w)/U,J=Math.min($,Z),ie=Math.max($,Z),be=g+j*J;let ce=Math.floor(Math.min(be,C)/this._granularityCellSize)+1,he=Math.ceil(Math.max(be,C)/this._granularityCellSize)-1,De=C<be;const Re=0===U;if(Re&&(M===P||M===N))return;if(Re||J>=1||ie<=0){const tt=f-M,We=x+(l-x)*Math.min((P-M)/tt,(N-M)/tt);ce=Math.floor(Math.min(We,C)/this._granularityCellSize)+1,he=Math.ceil(Math.max(We,C)/this._granularityCellSize)-1,De=C<We}const ze=L>0?N:P;if(De)for(let tt=ce;tt<=he;tt++)s.push(this._vertexToIndex(tt*this._granularityCellSize,ze));else for(let tt=he;tt>=ce;tt--)s.push(this._vertexToIndex(tt*this._granularityCellSize,ze))}_generateOutline(s){const l=[];for(const f of s){const g=gc(f,this._granularity,!0),w=this._pointArrayToIndices(g),x=[];for(let M=1;M<w.length;M++)x.push(w[M-1]),x.push(w[M]);l.push(x)}return l}_handlePoles(s){let l=!1,f=!1;this._canonical&&(0===this._canonical.y&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(f=!0)),(l||f)&&this._fillPoles(s,l,f)}_ensureNoPoleVertices(){const s=this._vertexBuffer;for(let l=0;l<s.length;l+=2){const f=s[l+1];f===Su&&(s[l+1]=-32767),f===pc&&(s[l+1]=32766)}}_generatePoleQuad(s,l,f,g,w,x){g>w!=(x===Su)?(s.push(l),s.push(f),s.push(this._vertexToIndex(g,x)),s.push(f),s.push(this._vertexToIndex(w,x)),s.push(this._vertexToIndex(g,x))):(s.push(f),s.push(l),s.push(this._vertexToIndex(g,x)),s.push(this._vertexToIndex(w,x)),s.push(f),s.push(this._vertexToIndex(g,x)))}_fillPoles(s,l,f){const g=this._vertexBuffer,w=pn,x=s.length;for(let M=2;M<x;M+=3){const C=s[M-2],P=s[M-1],N=s[M],L=g[2*C],j=g[2*C+1],U=g[2*P],$=g[2*P+1],Z=g[2*N],J=g[2*N+1];l&&(0===j&&0===$&&this._generatePoleQuad(s,C,P,L,U,Su),0===$&&0===J&&this._generatePoleQuad(s,P,N,U,Z,Su),0===J&&0===j&&this._generatePoleQuad(s,N,C,Z,L,Su)),f&&(j===w&&$===w&&this._generatePoleQuad(s,C,P,L,U,pc),$===w&&J===w&&this._generatePoleQuad(s,P,N,U,Z,pc),J===w&&j===w&&this._generatePoleQuad(s,N,C,Z,L,pc))}}_initializeVertices(s){for(let l=0;l<s.length;l+=2)this._vertexToIndex(s[l],s[l+1])}subdividePolygonInternal(s,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:f,holeIndices:g}=function(M){const C=[],P=[];for(const N of M)if(0!==N.length){N!==M[0]&&C.push(P.length/2);for(let L=0;L<N.length;L++)P.push(N[L].x),P.push(N[L].y)}return{flattened:P,holeIndices:C}}(s);let w;this._initializeVertices(f);try{const M=function(P,N,L=2){const j=N&&N.length,U=j?N[0]*L:P.length;let $=xu(P,0,U,L,!0);const Z=[];if(!$||$.next===$.prev)return Z;let J,ie,be;if(j&&($=function(ce,he,De,Re){const ze=[];for(let tt=0,We=he.length;tt<We;tt++){const Je=xu(ce,he[tt]*Re,tt<We-1?he[tt+1]*Re:ce.length,Re,!1);Je===Je.next&&(Je.steiner=!0),ze.push(W0(Je))}ze.sort(Kp);for(let tt=0;tt<ze.length;tt++)De=Yp(ze[tt],De);return De}(P,N,$,L)),P.length>80*L){J=P[0],ie=P[1];let ce=J,he=ie;for(let De=L;De<U;De+=L){const Re=P[De],ze=P[De+1];Re<J&&(J=Re),ze<ie&&(ie=ze),Re>ce&&(ce=Re),ze>he&&(he=ze)}be=Math.max(ce-J,he-ie),be=0!==be?32767/be:0}return Sf($,Z,L,J,ie,be,0),Z}(f,g),C=this._convertIndices(f,M);w=this._subdivideTrianglesScanline(C)}catch(M){console.error(M)}let x=[];return l&&(x=this._generateOutline(s)),this._ensureNoPoleVertices(),this._handlePoles(w),{verticesFlattened:this._vertexBuffer,indicesTriangles:w,indicesLineList:x}}_convertIndices(s,l){const f=[];for(let g=0;g<l.length;g++)f.push(this._vertexToIndex(s[2*l[g]],s[2*l[g]+1]));return f}_pointArrayToIndices(s){const l=[];for(let f=0;f<s.length;f++){const g=s[f];l.push(this._vertexToIndex(g.x,g.y))}return l}}function _d(c,s,l,f=!0){return new ox(l,s).subdividePolygonInternal(c,f)}function gc(c,s,l=!1){if(!c||c.length<1)return[];if(c.length<2)return[];const f=c[0],g=c[c.length-1],w=l&&(f.x!==g.x||f.y!==g.y);if(s<2)return w?[...c,c[0]]:[...c];const x=Math.floor(pn/s),M=[];M.push(new st(c[0].x,c[0].y));const C=c.length,P=w?C:C-1;for(let N=0;N<P;N++){const L=c[N],j=N<C-1?c[N+1]:c[0],U=L.x,$=L.y,Z=j.x,J=j.y,ie=U!==Z,be=$!==J;if(!ie&&!be)continue;const ce=Z-U,he=J-$,De=Math.abs(ce),Re=Math.abs(he);let ze=U,tt=$;for(;;){const Je=ce>0?(Math.floor(ze/x)+1)*x:(Math.ceil(ze/x)-1)*x,mt=he>0?(Math.floor(tt/x)+1)*x:(Math.ceil(tt/x)-1)*x,Qe=Math.abs(ze-Je),Ye=Math.abs(tt-mt),Oe=Math.abs(ze-Z),Tt=Math.abs(tt-J),kt=ie?Qe/De:Number.POSITIVE_INFINITY,vt=be?Ye/Re:Number.POSITIVE_INFINITY;if((Oe<=Qe||!ie)&&(Tt<=Ye||!be))break;if(kt<vt&&ie||!be){ze=Je,tt+=he*kt;const ft=new st(ze,Math.round(tt));M[M.length-1].x===ft.x&&M[M.length-1].y===ft.y||M.push(ft)}else{ze+=ce*vt,tt=mt;const ft=new st(Math.round(ze),tt);M[M.length-1].x===ft.x&&M[M.length-1].y===ft.y||M.push(ft)}}const We=new st(Z,J);M[M.length-1].x===We.x&&M[M.length-1].y===We.y||M.push(We)}return M}function ng(c,s,l){if(0===s.length)throw new Error("Subdivision vertex ring is empty.");let f=0,g=c[2*s[0]];for(let C=1;C<s.length;C++){const P=c[2*s[C]];P<g&&(g=P,f=C)}const w=s.length;let x=f,M=(x+1)%w;for(;;){const C=x-1>=0?x-1:w-1,P=(M+1)%w,N=c[2*s[C]],L=c[2*s[P]],j=c[2*s[x]],U=c[2*s[x]+1],$=c[2*s[M]+1];let Z=!1;if(N<L)Z=!0;else if(N>L)Z=!1;else{const J=$-U,ie=-(c[2*s[M]]-j),be=U<$?1:-1;((N-j)*J+(c[2*s[C]+1]-U)*ie)*be>((L-j)*J+(c[2*s[P]+1]-U)*ie)*be&&(Z=!0)}if(Z){const J=s[C],ie=s[x],be=s[M];J!==ie&&J!==be&&ie!==be&&l.push(be,ie,J),x--,x<0&&(x=w-1)}else{const J=s[P],ie=s[x],be=s[M];J!==ie&&J!==be&&ie!==be&&l.push(be,ie,J),M++,M>=w&&(M=0)}if(C===P)break}}function sx(c,s,l,f,g,w,x,M,C){const P=g.length/2,N=x&&M&&C;if(P<Ht.MAX_VERTEX_ARRAY_LENGTH){const L=s.prepareSegment(P,l,f),j=L.vertexLength;for(let Z=0;Z<w.length;Z+=3)f.emplaceBack(j+w[Z],j+w[Z+1],j+w[Z+2]);let U,$;L.vertexLength+=P,L.primitiveLength+=w.length/3,N&&($=x.prepareSegment(P,l,M),U=$.vertexLength,$.vertexLength+=P);for(let Z=0;Z<g.length;Z+=2)c(g[Z],g[Z+1]);if(N)for(let Z=0;Z<C.length;Z++){const J=C[Z];for(let ie=1;ie<J.length;ie+=2)M.emplaceBack(U+J[ie-1],U+J[ie]);$.primitiveLength+=J.length/2}}else(function(L,j,U,$,Z,J){const ie=[];for(let Re=0;Re<$.length/2;Re++)ie.push(-1);const be={count:0};let ce=0,he=L.getOrCreateLatestSegment(j,U),De=he.vertexLength;for(let Re=2;Re<Z.length;Re+=3){const ze=Z[Re-2],tt=Z[Re-1],We=Z[Re];let Je=ie[ze]<ce,mt=ie[tt]<ce,Qe=ie[We]<ce;he.vertexLength+((Je?1:0)+(mt?1:0)+(Qe?1:0))>Ht.MAX_VERTEX_ARRAY_LENGTH&&(he=L.createNewSegment(j,U),ce=be.count,Je=!0,mt=!0,Qe=!0,De=0);const Ye=yd(ie,$,J,be,ze,Je,he),Oe=yd(ie,$,J,be,tt,mt,he),Tt=yd(ie,$,J,be,We,Qe,he);U.emplaceBack(De+Ye-ce,De+Oe-ce,De+Tt-ce),he.primitiveLength++}})(s,l,f,g,w,c),N&&function(L,j,U,$,Z,J){const ie=[];for(let Re=0;Re<$.length/2;Re++)ie.push(-1);const be={count:0};let ce=0,he=L.getOrCreateLatestSegment(j,U),De=he.vertexLength;for(let Re=0;Re<Z.length;Re++){const ze=Z[Re];for(let tt=1;tt<Z[Re].length;tt+=2){const We=ze[tt-1],Je=ze[tt];let mt=ie[We]<ce,Qe=ie[Je]<ce;he.vertexLength+((mt?1:0)+(Qe?1:0))>Ht.MAX_VERTEX_ARRAY_LENGTH&&(he=L.createNewSegment(j,U),ce=be.count,mt=!0,Qe=!0,De=0);const Ye=yd(ie,$,J,be,We,mt,he),Oe=yd(ie,$,J,be,Je,Qe,he);U.emplaceBack(De+Ye-ce,De+Oe-ce),he.primitiveLength++}}}(x,l,M,g,C,c),s.forceNewSegmentOnNextPrepare(),x?.forceNewSegmentOnNextPrepare()}function yd(c,s,l,f,g,w,x){if(w){const M=f.count;return l(s[2*g],s[2*g+1]),c[g]=f.count,f.count++,x.vertexLength++,M}return c[g]}class ig{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ie,this.indexArray=new Mn,this.indexArray2=new ln,this.programConfigurations=new Do(s.layers,s.zoom),this.segments=new Ht,this.segments2=new Ht,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){this.hasPattern=Zp("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:M,id:C,index:P,sourceLayerIndex:N}of s){const L=this.layers[0]._featureFilter.needGeometry,j=Ka(M,L);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom,{globalState:this.globalState}),j,f))continue;const U=w?g.evaluate(j,{},f,l.availableImages):void 0,$={id:C,properties:M.properties,type:M.type,sourceLayerIndex:N,index:P,geometry:L?j.geometry:_s(M),patterns:{},sortKey:U};x.push($)}w&&x.sort((M,C)=>M.sortKey-C.sortKey);for(const M of x){const{geometry:C,index:P,sourceLayerIndex:N}=M;if(this.hasPattern){const L=e_("fill",this.layers,M,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(M,C,P,f,{},l.subdivisionGranularity);l.featureIndex.insert(s[P].feature,C,P,N,this.index)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)}addFeatures(s,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f,s.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,H0),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,l,f,g,w,x){for(const M of Eo(l,500)){const C=_d(M,g,x.fill.getGranularityForZoomLevel(g.z)),P=this.layoutVertexArray;sx((N,L)=>{P.emplaceBack(N,L)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles,this.segments2,this.indexArray2,C.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,w,g)}}let Y0,Xa;Ze("FillBucket",ig,{omit:["layers","patternFeatures"]});var ax={get paint(){return Xa=Xa||new St({"fill-antialias":new dt(xe.paint_fill["fill-antialias"]),"fill-opacity":new Se(xe.paint_fill["fill-opacity"]),"fill-color":new Se(xe.paint_fill["fill-color"]),"fill-outline-color":new Se(xe.paint_fill["fill-outline-color"]),"fill-translate":new dt(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new zt(xe.paint_fill["fill-pattern"])})},get layout(){return Y0=Y0||new St({"fill-sort-key":new Se(xe.layout_fill["fill-sort-key"])})}};class rg extends Qr{constructor(s){super(s,ax)}recalculate(s,l){super.recalculate(s,l);const f=this.paint._values["fill-outline-color"];"constant"===f.value.kind&&void 0===f.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new ig(s)}queryRadius(){return dc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:s,geometry:l,transform:f,pixelsToTileUnits:g}){return Zm(wf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-f.bearingInRadians,g),l)}isTileClipped(){return!0}}const n_=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),X0=Ti([{name:"a_centroid",components:2,type:"Int16"}],4),{members:og}=n_;class Eu{constructor(s,l,f,g,w){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=g,this._values=w,s.readFields(lx,this,l)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos,f=[];let g,w=1,x=0,M=0,C=0;for(;s.pos<l;){if(x<=0){const P=s.readVarint();w=7&P,x=P>>3}if(x--,1===w||2===w)M+=s.readSVarint(),C+=s.readSVarint(),1===w&&(g&&f.push(g),g=[]),g&&g.push(new st(M,C));else{if(7!==w)throw new Error(`unknown command ${w}`);g&&g.push(g[0].clone())}}return g&&f.push(g),f}bbox(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos;let f=1,g=0,w=0,x=0,M=1/0,C=-1/0,P=1/0,N=-1/0;for(;s.pos<l;){if(g<=0){const L=s.readVarint();f=7&L,g=L>>3}if(g--,1===f||2===f)w+=s.readSVarint(),x+=s.readSVarint(),w<M&&(M=w),w>C&&(C=w),x<P&&(P=x),x>N&&(N=x);else if(7!==f)throw new Error(`unknown command ${f}`)}return[M,P,C,N]}toGeoJSON(s,l,f){const g=this.extent*Math.pow(2,f),w=this.extent*s,x=this.extent*l,M=this.loadGeometry();function C(j){return[360*(j.x+w)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(j.y+x)/g)*Math.PI))-90]}function P(j){return j.map(C)}let N;if(1===this.type){const j=[];for(const $ of M)j.push($[0]);const U=P(j);N=1===j.length?{type:"Point",coordinates:U[0]}:{type:"MultiPoint",coordinates:U}}else if(2===this.type){const j=M.map(P);N=1===j.length?{type:"LineString",coordinates:j[0]}:{type:"MultiLineString",coordinates:j}}else{if(3!==this.type)throw new Error("unknown feature type");{const j=function($){const Z=$.length;if(Z<=1)return[$];const J=[];let ie,be;for(let ce=0;ce<Z;ce++){const he=Q0($[ce]);0!==he&&(void 0===be&&(be=he<0),be===he<0?(ie&&J.push(ie),ie=[$[ce]]):ie&&ie.push($[ce]))}return ie&&J.push(ie),J}(M),U=[];for(const $ of j)U.push($.map(P));N=1===U.length?{type:"Polygon",coordinates:U[0]}:{type:"MultiPolygon",coordinates:U}}}const L={type:"Feature",geometry:N,properties:this.properties};return null!=this.id&&(L.id=this.id),L}}function lx(c,s,l){1===c?s.id=l.readVarint():2===c?function(f,g){const w=f.readVarint()+f.pos;for(;f.pos<w;){const x=g._keys[f.readVarint()],M=g._values[f.readVarint()];g.properties[x]=M}}(l,s):3===c?s.type=l.readVarint():4===c&&(s._geometry=l.pos)}function Q0(c){let s=0;for(let l,f,g=0,w=c.length,x=w-1;g<w;x=g++)l=c[g],f=c[x],s+=(f.x-l.x)*(l.y+f.y);return s}Eu.types=["Unknown","Point","LineString","Polygon"];class i_{constructor(s,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(J0,this,l),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const l=this._pbf.readVarint()+this._pbf.pos;return new Eu(this._pbf,l,this.extent,this._keys,this._values)}}function J0(c,s,l){15===c?s.version=l.readVarint():1===c?s.name=l.readString():5===c?s.extent=l.readVarint():2===c?s._features.push(l.pos):3===c?s._keys.push(l.readString()):4===c&&s._values.push(function(f){let g=null;const w=f.readVarint()+f.pos;for(;f.pos<w;){const x=f.readVarint()>>3;g=1===x?f.readString():2===x?f.readFloat():3===x?f.readDouble():4===x?f.readVarint64():5===x?f.readVarint():6===x?f.readSVarint():7===x?f.readBoolean():null}if(null==g)throw new Error("unknown feature value");return g}(l))}class r_{constructor(s,l){this.layers=s.readFields(cx,{},l)}}function cx(c,s,l){if(3===c){const f=new i_(l,l.readVarint()+l.pos);f.length&&(s[f.name]=f)}}const vd=Math.pow(2,13);function sg(c,s,l,f,g,w,x,M){c.emplaceBack(s,l,2*Math.floor(f*vd)+x,g*vd*2,w*vd*2,Math.round(M))}class mh{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Ee,this.centroidVertexArray=new se,this.indexArray=new Mn,this.programConfigurations=new Do(s.layers,s.zoom),this.segments=new Ht,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){this.features=[],this.hasPattern=Zp("fill-extrusion",this.layers,l);for(const{feature:g,id:w,index:x,sourceLayerIndex:M}of s){const C=this.layers[0]._featureFilter.needGeometry,P=Ka(g,C);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom,{globalState:this.globalState}),P,f))continue;const N={id:w,sourceLayerIndex:M,index:x,geometry:C?P.geometry:_s(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(e_("fill-extrusion",this.layers,N,this.zoom,l)):this.addFeature(N,N.geometry,x,f,{},l.subdivisionGranularity),l.featureIndex.insert(g,N.geometry,x,M,this.index,!0)}}addFeatures(s,l,f){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,l,f,s.subdivisionGranularity)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,og),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,X0.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,l,f,g,w,x){for(const M of Eo(l,500)){const C={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(C,g,s,M,x);const N=this.layoutVertexArray.length-P,L=Math.floor(C.x/C.sampleCount),j=Math.floor(C.y/C.sampleCount);for(let U=0;U<N;U++)this.centroidVertexArray.emplaceBack(L,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,w,g)}processPolygon(s,l,f,g,w){if(g.length<1||o_(g[0]))return;for(const L of g)0!==L.length&&ux(s,L);const x={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},M=w.fill.getGranularityForZoomLevel(l.z),C="Polygon"===Eu.types[f.type];for(const L of g){if(0===L.length||o_(L))continue;const j=gc(L,M,C);this._generateSideFaces(j,x)}if(!C)return;const P=_d(g,l,M,!1),N=this.layoutVertexArray;sx((L,j)=>{sg(N,L,j,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(s,l){let f=0;for(let g=1;g<s.length;g++){const w=s[g],x=s[g-1];if(ev(w,x))continue;l.segment.vertexLength+4>Ht.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const M=w.sub(x)._perp()._unit(),C=x.dist(w);f+C>32768&&(f=0),sg(this.layoutVertexArray,w.x,w.y,M.x,M.y,0,0,f),sg(this.layoutVertexArray,w.x,w.y,M.x,M.y,0,1,f),f+=C,sg(this.layoutVertexArray,x.x,x.y,M.x,M.y,0,0,f),sg(this.layoutVertexArray,x.x,x.y,M.x,M.y,0,1,f);const P=l.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function ux(c,s){for(let l=0;l<s.length;l++){const f=s[l];l===s.length-1&&s[0].x===f.x&&s[0].y===f.y||(c.x+=f.x,c.y+=f.y,c.sampleCount++)}}function ev(c,s){return c.x===s.x&&(c.x<0||c.x>pn)||c.y===s.y&&(c.y<0||c.y>pn)}function o_(c){return c.every(s=>s.x<0)||c.every(s=>s.x>pn)||c.every(s=>s.y<0)||c.every(s=>s.y>pn)}let mc;Ze("FillExtrusionBucket",mh,{omit:["layers","features"]});var _h={get paint(){return mc=mc||new St({"fill-extrusion-opacity":new dt(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Se(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zt(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Se(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Se(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ur extends Qr{constructor(s){super(s,_h)}createBucket(s){return new mh(s)}queryRadius(){return dc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:f,geometry:g,transform:w,pixelsToTileUnits:x,pixelPosMatrix:M}){const C=wf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-w.bearingInRadians,x),P=this.paint.get("fill-extrusion-height").evaluate(l,f),N=this.paint.get("fill-extrusion-base").evaluate(l,f),L=function(U,$){const Z=[];for(const J of U){const ie=[J.x,J.y,0,1];rs(ie,ie,$),Z.push(new st(ie[0]/ie[3],ie[1]/ie[3]))}return Z}(C,M),j=function(U,$,Z,J){const ie=[],be=[],ce=J[8]*$,he=J[9]*$,De=J[10]*$,Re=J[11]*$,ze=J[8]*Z,tt=J[9]*Z,We=J[10]*Z,Je=J[11]*Z;for(const mt of U){const Qe=[],Ye=[];for(const Oe of mt){const Tt=Oe.x,kt=Oe.y,vt=J[0]*Tt+J[4]*kt+J[12],ft=J[1]*Tt+J[5]*kt+J[13],fn=J[2]*Tt+J[6]*kt+J[14],vi=J[3]*Tt+J[7]*kt+J[15],vr=fn+De,po=vi+Re,Os=vt+ze,Wo=ft+tt,jr=fn+We,Jn=vi+Je,kr=new st((vt+ce)/po,(ft+he)/po);kr.z=vr/po,Qe.push(kr);const io=new st(Os/Jn,Wo/Jn);io.z=jr/Jn,Ye.push(io)}ie.push(Qe),be.push(Ye)}return[ie,be]}(g,N,P,M);return function(U,$,Z){let J=1/0;Zm(Z,$)&&(J=fi(Z,$[0]));for(let ie=0;ie<$.length;ie++){const be=$[ie],ce=U[ie];for(let he=0;he<be.length-1;he++){const De=be[he],Re=[De,be[he+1],ce[he+1],ce[he],De];j0(Z,Re)&&(J=Math.min(J,fi(Z,Re)))}}return J!==1/0&&J}(j[0],j[1],L)}}function Df(c,s){return c.x*s.x+c.y*s.y}function fi(c,s){if(1===c.length){let l=0;const f=s[l++];let g;for(;!g||f.equals(g);)if(g=s[l++],!g)return 1/0;for(;l<s.length;l++){const w=s[l],x=c[0],M=g.sub(f),C=w.sub(f),P=x.sub(f),N=Df(M,M),L=Df(M,C),j=Df(C,C),U=Df(P,M),$=Df(P,C),Z=N*j-L*L,J=(j*U-L*$)/Z,ie=(N*$-L*U)/Z,be=f.z*(1-J-ie)+g.z*J+w.z*ie;if(isFinite(be))return be}return 1/0}{let l=1/0;for(const f of s)l=Math.min(l,f.z);return l}}const s_=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:hx}=s_,tv=Ti([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Mu}=tv,dx=Math.cos(Math.PI/180*37.5),a_=Math.pow(2,14)/.5;class Cf{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new Ae,this.indexArray=new Mn,this.programConfigurations=new Do(s.layers,s.zoom),this.segments=new Ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){this.hasPattern=Zp("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:M,id:C,index:P,sourceLayerIndex:N}of s){const L=this.layers[0]._featureFilter.needGeometry,j=Ka(M,L);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom,{globalState:this.globalState}),j,f))continue;const U=w?g.evaluate(j,{},f):void 0,$={id:C,properties:M.properties,type:M.type,sourceLayerIndex:N,index:P,geometry:L?j.geometry:_s(M),patterns:{},sortKey:U};x.push($)}w&&x.sort((M,C)=>M.sortKey-C.sortKey);for(const M of x){const{geometry:C,index:P,sourceLayerIndex:N}=M;if(this.hasPattern){const L=e_("line",this.layers,M,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(M,C,P,f,{},l.subdivisionGranularity);l.featureIndex.insert(s[P].feature,C,P,N,this.index)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)}addFeatures(s,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f,s.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Mu)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,hx),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,l,f,g,w,x){const M=this.layers[0].layout,C=M.get("line-join").evaluate(s,{}),P=M.get("line-cap"),N=M.get("line-miter-limit"),L=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const j of l)this.addLine(j,s,C,P,N,L,g,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,w,g)}addLine(s,l,f,g,w,x,M,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s=gc(s,M?C.line.getGranularityForZoomLevel(M.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<s.length-1;ce++)this.totalDistance+=s[ce].dist(s[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P="Polygon"===Eu.types[l.type];let N=s.length;for(;N>=2&&s[N-1].equals(s[N-2]);)N--;let L=0;for(;L<N-1&&s[L].equals(s[L+1]);)L++;if(N<(P?3:2))return;"bevel"===f&&(w=1.05);const j=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let $,Z,J,ie,be;this.e1=this.e2=-1,P&&($=s[N-2],be=s[L].sub($)._unit()._perp());for(let ce=L;ce<N;ce++){if(J=ce===N-1?P?s[L+1]:void 0:s[ce+1],J&&s[ce].equals(J))continue;be&&(ie=be),$&&(Z=$),$=s[ce],be=J?J.sub($)._unit()._perp():ie,ie=ie||be;let he=ie.add(be);0===he.x&&0===he.y||he._unit();const De=ie.x*be.x+ie.y*be.y,Re=he.x*be.x+he.y*be.y,ze=0!==Re?1/Re:1/0,tt=2*Math.sqrt(2-2*Re),We=Re<dx&&Z&&J,Je=ie.x*be.y-ie.y*be.x>0;if(We&&ce>L){const Ye=$.dist(Z);if(Ye>2*j){const Oe=$.sub($.sub(Z)._mult(j/Ye)._round());this.updateDistance(Z,Oe),this.addCurrentVertex(Oe,ie,0,0,U),Z=Oe}}const mt=Z&&J;let Qe=mt?f:P?"butt":g;if(mt&&"round"===Qe&&(ze<x?Qe="miter":ze<=2&&(Qe="fakeround")),"miter"===Qe&&ze>w&&(Qe="bevel"),"bevel"===Qe&&(ze>2&&(Qe="flipbevel"),ze<w&&(Qe="miter")),Z&&this.updateDistance(Z,$),"miter"===Qe)he._mult(ze),this.addCurrentVertex($,he,0,0,U);else if("flipbevel"===Qe){if(ze>100)he=be.mult(-1);else{const Ye=ze*ie.add(be).mag()/ie.sub(be).mag();he._perp()._mult(Ye*(Je?-1:1))}this.addCurrentVertex($,he,0,0,U),this.addCurrentVertex($,he.mult(-1),0,0,U)}else if("bevel"===Qe||"fakeround"===Qe){const Ye=-Math.sqrt(ze*ze-1),Oe=Je?Ye:0,Tt=Je?0:Ye;if(Z&&this.addCurrentVertex($,ie,Oe,Tt,U),"fakeround"===Qe){const kt=Math.round(180*tt/Math.PI/20);for(let vt=1;vt<kt;vt++){let ft=vt/kt;if(.5!==ft){const vi=ft-.5;ft+=ft*vi*(ft-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*vi*vi+(.848013+De*(.215638*De-1.06021)))}const fn=be.sub(ie)._mult(ft)._add(ie)._unit()._mult(Je?-1:1);this.addHalfVertex($,fn.x,fn.y,!1,Je,0,U)}}J&&this.addCurrentVertex($,be,-Oe,-Tt,U)}else if("butt"===Qe)this.addCurrentVertex($,he,0,0,U);else if("square"===Qe){const Ye=Z?1:-1;this.addCurrentVertex($,he,Ye,Ye,U)}else"round"===Qe&&(Z&&(this.addCurrentVertex($,ie,0,0,U),this.addCurrentVertex($,ie,1,1,U,!0)),J&&(this.addCurrentVertex($,be,-1,-1,U,!0),this.addCurrentVertex($,be,0,0,U)));if(We&&ce<N-1){const Ye=$.dist(J);if(Ye>2*j){const Oe=$.add(J.sub($)._mult(j/Ye)._round());this.updateDistance($,Oe),this.addCurrentVertex(Oe,be,0,0,U),$=Oe}}}}addCurrentVertex(s,l,f,g,w,x=!1){const M=l.y*g-l.x,C=-l.y-l.x*g;this.addHalfVertex(s,l.x+l.y*f,l.y-l.x*f,x,!1,f,w),this.addHalfVertex(s,M,C,x,!0,-g,w),this.distance>a_/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,l,f,g,w,x))}addHalfVertex({x:s,y:l},f,g,w,x,M,C){const P=.5*(this.lineClips?this.scaledDistance*(a_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(w?1:0),(l<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(0===M?0:M<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),C.primitiveLength++),x?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,l){this.distance+=s.dist(l),this.updateScaledDistance()}}let Tf,l_;Ze("LineBucket",Cf,{omit:["layers","patternFeatures"]});var nv={get paint(){return l_=l_||new St({"line-opacity":new Se(xe.paint_line["line-opacity"]),"line-color":new Se(xe.paint_line["line-color"]),"line-translate":new dt(xe.paint_line["line-translate"]),"line-translate-anchor":new dt(xe.paint_line["line-translate-anchor"]),"line-width":new Se(xe.paint_line["line-width"]),"line-gap-width":new Se(xe.paint_line["line-gap-width"]),"line-offset":new Se(xe.paint_line["line-offset"]),"line-blur":new Se(xe.paint_line["line-blur"]),"line-dasharray":new Zi(xe.paint_line["line-dasharray"]),"line-pattern":new zt(xe.paint_line["line-pattern"]),"line-gradient":new zr(xe.paint_line["line-gradient"])})},get layout(){return Tf=Tf||new St({"line-cap":new dt(xe.layout_line["line-cap"]),"line-join":new Se(xe.layout_line["line-join"]),"line-miter-limit":new dt(xe.layout_line["line-miter-limit"]),"line-round-limit":new dt(xe.layout_line["line-round-limit"]),"line-sort-key":new Se(xe.layout_line["line-sort-key"])})}};class fx extends Se{possiblyEvaluate(s,l){return l=new ui(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(s,l)}evaluate(s,l,f,g){return l=ss({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(s,l,f,g)}}let ag;class iv extends Qr{constructor(s){super(s,nv),this.gradientVersion=0,ag||(ag=new fx(nv.paint.properties["line-width"].specification),ag.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const l=this.gradientExpression();this.stepInterpolant=!(void 0===l._styleExpression)&&l._styleExpression.expression instanceof mi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,l){super.recalculate(s,l),this.paint._values["line-floorwidth"]=ag.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Cf(s)}queryRadius(s){const l=s,f=rv(Cl("line-width",this,l),Cl("line-gap-width",this,l)),g=Cl("line-offset",this,l);return f/2+Math.abs(g)+dc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:f,geometry:g,transform:w,pixelsToTileUnits:x}){const M=wf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-w.bearingInRadians,x),C=x/2*rv(this.paint.get("line-width").evaluate(l,f),this.paint.get("line-gap-width").evaluate(l,f)),P=this.paint.get("line-offset").evaluate(l,f);return P&&(g=function(N,L){const j=[];for(let U=0;U<N.length;U++){const $=N[U],Z=[];for(let J=0;J<$.length;J++){const ie=$[J-1],be=$[J],ce=$[J+1],he=0===J?new st(0,0):be.sub(ie)._unit()._perp(),De=J===$.length-1?new st(0,0):ce.sub(be)._unit()._perp(),Re=he._add(De)._unit(),ze=Re.x*De.x+Re.y*De.y;0!==ze&&Re._mult(1/ze),Z.push(Re._mult(L)._add(be))}j.push(Z)}return j}(g,P*x)),function(N,L,j){for(let U=0;U<L.length;U++){const $=L[U];if(N.length>=3)for(let Z=0;Z<$.length;Z++)if(ys(N,$[Z]))return!0;if(wu(N,$,j))return!0}return!1}(M,g,C)}isTileClipped(){return!0}}function rv(c,s){return s>0?s+2*c:c}const ov=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),px=Ti([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gx=Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ti([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const mx=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_x=Ti([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function bd(c,s,l){return c.sections.forEach(f=>{f.text=function(g,w,x){const M=w.layout.get("text-transform").evaluate(x,{});return"uppercase"===M?g=g.toLocaleUpperCase():"lowercase"===M&&(g=g.toLocaleLowerCase()),Uo.applyArabicShaping&&(g=Uo.applyArabicShaping(g)),g}(f.text,s,l)}),c}Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ti([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Nn={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};const c_=4294967296,sv=1/c_,av=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class u_{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,l,f=this.length){for(;this.pos<f;){const g=this.readVarint(),w=g>>3,x=this.pos;this.type=7&g,s(w,l,this),this.pos===x&&this.skip(g)}return l}readMessage(s,l){return this.readFields(s,l,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*c_;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*c_;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const l=this.buf;let f,g;return g=l[this.pos++],f=127&g,g<128?f:(g=l[this.pos++],f|=(127&g)<<7,g<128?f:(g=l[this.pos++],f|=(127&g)<<14,g<128?f:(g=l[this.pos++],f|=(127&g)<<21,g<128?f:(g=l[this.pos],f|=(15&g)<<28,function(w,x,M){const C=M.buf;let P,N;if(N=C[M.pos++],P=(112&N)>>4,N<128||(N=C[M.pos++],P|=(127&N)<<3,N<128)||(N=C[M.pos++],P|=(127&N)<<10,N<128)||(N=C[M.pos++],P|=(127&N)<<17,N<128)||(N=C[M.pos++],P|=(127&N)<<24,N<128)||(N=C[M.pos++],P|=(1&N)<<31,N<128))return function Du(c,s,l){return l?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}(w,P,x);throw new Error("Expected varint not more than 10 bytes")}(f,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,l=this.pos;return this.pos=s,s-l>=12&&av?av.decode(this.buf.subarray(l,s)):function(f,g,w){let x="",M=g;for(;M<w;){const C=f[M];let P,N,L,j=null,U=C>239?4:C>223?3:C>191?2:1;if(M+U>w)break;1===U?C<128&&(j=C):2===U?(P=f[M+1],128==(192&P)&&(j=(31&C)<<6|63&P,j<=127&&(j=null))):3===U?(P=f[M+1],N=f[M+2],128==(192&P)&&128==(192&N)&&(j=(15&C)<<12|(63&P)<<6|63&N,(j<=2047||j>=55296&&j<=57343)&&(j=null))):4===U&&(P=f[M+1],N=f[M+2],L=f[M+3],128==(192&P)&&128==(192&N)&&128==(192&L)&&(j=(15&C)<<18|(63&P)<<12|(63&N)<<6|63&L,(j<=65535||j>=1114112)&&(j=null))),null===j?(j=65533,U=1):j>65535&&(j-=65536,x+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),x+=String.fromCharCode(j),M+=U}return x}(this.buf,l,s)}readBytes(){const s=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,s);return this.pos=s,l}readPackedVarint(s=[],l){const f=this.readPackedEnd();for(;this.pos<f;)s.push(this.readVarint(l));return s}readPackedSVarint(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed64());return s}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(s){const l=7&s;if(0===l)for(;this.buf[this.pos++]>127;);else if(2===l)this.pos=this.readVarint()+this.pos;else if(5===l)this.pos+=4;else{if(1!==l)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(s,l){this.writeVarint(s<<3|l)}realloc(s){let l=this.length||16;for(;l<this.pos+s;)l*=2;if(l!==this.length){const f=new Uint8Array(l);f.set(this.buf),this.buf=f,this.dataView=new DataView(f.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*sv),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*sv),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?function(l,f){let g,w;if(l>=0?(g=l%4294967296|0,w=l/4294967296|0):(g=~(-l%4294967296),w=~(-l/4294967296),4294967295^g?g=g+1|0:(g=0,w=w+1|0)),l>=0x10000000000000000||l<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");var x,C;f.realloc(10),x=g,(C=f).buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,C.buf[C.pos]=127&(x>>>=7),function(x,M){const C=(7&x)<<4;M.buf[M.pos++]|=C|((x>>>=3)?128:0),x&&(M.buf[M.pos++]=127&x|((x>>>=7)?128:0),x&&(M.buf[M.pos++]=127&x|((x>>>=7)?128:0),x&&(M.buf[M.pos++]=127&x|((x>>>=7)?128:0),x&&(M.buf[M.pos++]=127&x|((x>>>=7)?128:0),x&&(M.buf[M.pos++]=127&x)))))}(w,f)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const l=this.pos;this.pos=function(g,w,x){for(let M,C,P=0;P<w.length;P++){if(M=w.charCodeAt(P),M>55295&&M<57344){if(!C){M>56319||P+1===w.length?(g[x++]=239,g[x++]=191,g[x++]=189):C=M;continue}if(M<56320){g[x++]=239,g[x++]=191,g[x++]=189,C=M;continue}M=C-55296<<10|M-56320|65536,C=null}else C&&(g[x++]=239,g[x++]=191,g[x++]=189,C=null);M<128?g[x++]=M:(M<2048?g[x++]=M>>6|192:(M<65536?g[x++]=M>>12|224:(g[x++]=M>>18|240,g[x++]=M>>12&63|128),g[x++]=M>>6&63|128),g[x++]=63&M|128)}return x}(this.buf,s,this.pos);const f=this.pos-l;f>=128&&h_(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const l=s.length;this.writeVarint(l),this.realloc(l);for(let f=0;f<l;f++)this.buf[this.pos++]=s[f]}writeRawMessage(s,l){this.pos++;const f=this.pos;s(l,this);const g=this.pos-f;g>=128&&h_(f,g,this),this.pos=f-1,this.writeVarint(g),this.pos+=g}writeMessage(s,l,f){this.writeTag(s,2),this.writeRawMessage(l,f)}writePackedVarint(s,l){l.length&&this.writeMessage(s,If,l)}writePackedSVarint(s,l){l.length&&this.writeMessage(s,lv,l)}writePackedBoolean(s,l){l.length&&this.writeMessage(s,cg,l)}writePackedFloat(s,l){l.length&&this.writeMessage(s,cv,l)}writePackedDouble(s,l){l.length&&this.writeMessage(s,lg,l)}writePackedFixed32(s,l){l.length&&this.writeMessage(s,yx,l)}writePackedSFixed32(s,l){l.length&&this.writeMessage(s,vx,l)}writePackedFixed64(s,l){l.length&&this.writeMessage(s,bx,l)}writePackedSFixed64(s,l){l.length&&this.writeMessage(s,uv,l)}writeBytesField(s,l){this.writeTag(s,2),this.writeBytes(l)}writeFixed32Field(s,l){this.writeTag(s,5),this.writeFixed32(l)}writeSFixed32Field(s,l){this.writeTag(s,5),this.writeSFixed32(l)}writeFixed64Field(s,l){this.writeTag(s,1),this.writeFixed64(l)}writeSFixed64Field(s,l){this.writeTag(s,1),this.writeSFixed64(l)}writeVarintField(s,l){this.writeTag(s,0),this.writeVarint(l)}writeSVarintField(s,l){this.writeTag(s,0),this.writeSVarint(l)}writeStringField(s,l){this.writeTag(s,2),this.writeString(l)}writeFloatField(s,l){this.writeTag(s,5),this.writeFloat(l)}writeDoubleField(s,l){this.writeTag(s,1),this.writeDouble(l)}writeBooleanField(s,l){this.writeVarintField(s,+l)}}function h_(c,s,l){const f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(f);for(let g=l.pos-1;g>=c;g--)l.buf[g+f]=l.buf[g]}function If(c,s){for(let l=0;l<c.length;l++)s.writeVarint(c[l])}function lv(c,s){for(let l=0;l<c.length;l++)s.writeSVarint(c[l])}function cv(c,s){for(let l=0;l<c.length;l++)s.writeFloat(c[l])}function lg(c,s){for(let l=0;l<c.length;l++)s.writeDouble(c[l])}function cg(c,s){for(let l=0;l<c.length;l++)s.writeBoolean(c[l])}function yx(c,s){for(let l=0;l<c.length;l++)s.writeFixed32(c[l])}function vx(c,s){for(let l=0;l<c.length;l++)s.writeSFixed32(c[l])}function bx(c,s){for(let l=0;l<c.length;l++)s.writeFixed64(c[l])}function uv(c,s){for(let l=0;l<c.length;l++)s.writeSFixed64(c[l])}function d_(c,s,l){1===c&&l.readMessage(wx,s)}function wx(c,s,l){if(3===c){const{id:f,bitmap:g,width:w,height:x,left:M,top:C,advance:P}=l.readMessage(xx,{});s.push({id:f,bitmap:new fc({width:w+6,height:x+6},g),metrics:{width:w,height:x,left:M,top:C,advance:P}})}}function xx(c,s,l){1===c?s.id=l.readVarint():2===c?s.bitmap=l.readBytes():3===c?s.width=l.readVarint():4===c?s.height=l.readVarint():5===c?s.left=l.readSVarint():6===c?s.top=l.readSVarint():7===c&&(s.advance=l.readVarint())}function qo(c){let s=0,l=0;for(const x of c)s+=x.w*x.h,l=Math.max(l,x.w);c.sort((x,M)=>M.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}];let g=0,w=0;for(const x of c)for(let M=f.length-1;M>=0;M--){const C=f[M];if(!(x.w>C.w||x.h>C.h)){if(x.x=C.x,x.y=C.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===C.w&&x.h===C.h){const P=f.pop();P&&M<f.length&&(f[M]=P)}else x.h===C.h?(C.x+=x.w,C.w-=x.w):x.w===C.w?(C.y+=x.h,C.h-=x.h):(f.push({x:C.x+x.w,y:C.y,w:C.w-x.w,h:x.h}),C.y+=x.h,C.h-=x.h);break}}return{w:g,h:w,fill:s/(g*w)||0}}class Af{constructor(s,{pixelRatio:l,version:f,stretchX:g,stretchY:w,content:x,textFitWidth:M,textFitHeight:C}){this.paddedRect=s,this.pixelRatio=l,this.stretchX=g,this.stretchY=w,this.content=x,this.version=f,this.textFitWidth=M,this.textFitHeight=C}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class f_{constructor(s,l){const f={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(s,f,w),this.addImages(l,g,w);const{w:x,h:M}=qo(w),C=new Ho({width:x||1,height:M||1});for(const P in s){const N=s[P],L=f[P].paddedRect;Ho.copy(N.data,C,{x:0,y:0},{x:L.x+1,y:L.y+1},N.data)}for(const P in l){const N=l[P],L=g[P].paddedRect,j=L.x+1,U=L.y+1,$=N.data.width,Z=N.data.height;Ho.copy(N.data,C,{x:0,y:0},{x:j,y:U},N.data),Ho.copy(N.data,C,{x:0,y:Z-1},{x:j,y:U-1},{width:$,height:1}),Ho.copy(N.data,C,{x:0,y:0},{x:j,y:U+Z},{width:$,height:1}),Ho.copy(N.data,C,{x:$-1,y:0},{x:j-1,y:U},{width:1,height:Z}),Ho.copy(N.data,C,{x:0,y:0},{x:j+$,y:U},{width:1,height:Z})}this.image=C,this.iconPositions=f,this.patternPositions=g}addImages(s,l,f){for(const g in s){const w=s[g],x={x:0,y:0,w:w.data.width+2,h:w.data.height+2};f.push(x),l[g]=new Af(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(s,l){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),l)}patchUpdatedImage(s,l,f){if(!s||!l||s.version===l.version)return;s.version=l.version;const[g,w]=s.tl;f.update(l.data,void 0,{x:g,y:w})}}var Il;Ze("ImagePosition",Af),Ze("ImageAtlas",f_),H.ao=void 0,(Il=H.ao||(H.ao={}))[Il.none=0]="none",Il[Il.horizontal=1]="horizontal",Il[Il.vertical=2]="vertical",Il[Il.horizontalOnly=3]="horizontalOnly";class to{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(s,l,f){const g=new to;return g.scale=s||1,g.fontStack=l,g.verticalAlign=f||"bottom",g}static forImage(s,l){const f=new to;return f.imageName=s,f.verticalAlign=l||"bottom",f}}class Al{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,l){const f=new Al;for(let g=0;g<s.sections.length;g++){const w=s.sections[g];w.image?f.addImageSection(w):f.addTextSection(w,l)}return f}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let l="";for(let f=0;f<s.length;f++){const g=s.charCodeAt(f+1)||null,w=s.charCodeAt(f-1)||null;l+=g&&pf(g)&&!Nn[s[f+1]]||w&&pf(w)&&!Nn[s[f-1]]||!Nn[s[f]]?s[f]:Nn[s[f]]}return l}(this.text)}trim(){let s=0;for(let f=0;f<this.text.length&&Rf[this.text.charCodeAt(f)];f++)s++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&Rf[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(s,l),this.sectionIndex=this.sectionIndex.slice(s,l)}substring(s,l){const f=new Al;return f.text=this.text.substring(s,l),f.sectionIndex=this.sectionIndex.slice(s,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,l)=>Math.max(s,this.sections[l].scale),0)}getMaxImageSize(s){let l=0,f=0;for(let g=0;g<this.length();g++){const w=this.getSection(g);if(w.imageName){const x=s[w.imageName];if(!x)continue;const M=x.displaySize;l=Math.max(l,M[0]),f=Math.max(f,M[1])}}return{maxImageWidth:l,maxImageHeight:f}}addTextSection(s,l){this.text+=s.text,this.sections.push(to.forText(s.scale,s.fontStack||l,s.verticalAlign));const f=this.sections.length-1;for(let g=0;g<s.text.length;++g)this.sectionIndex.push(f)}addImageSection(s){const l=s.image?s.image.name:"";if(0===l.length)return void nr("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(to.forImage(l,s.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):nr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pf(c,s,l,f,g,w,x,M,C,P,N,L,j,U,$){const Z=Al.fromFeature(c,g);let J;L===H.ao.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:ie,processStyledBidirectionalText:be}=Uo;if(ie&&1===Z.sections.length){J=[];const De=ie(Z.toString(),m_(Z,P,w,s,f,U));for(const Re of De){const ze=new Al;ze.text=Re,ze.sections=Z.sections;for(let tt=0;tt<Re.length;tt++)ze.sectionIndex.push(0);J.push(ze)}}else if(be){J=[];const De=be(Z.text,Z.sectionIndex,m_(Z,P,w,s,f,U));for(const Re of De){const ze=new Al;ze.text=Re[0],ze.sectionIndex=Re[1],ze.sections=Z.sections,J.push(ze)}}else J=function(De,Re){const ze=[],tt=De.text;let We=0;for(const Je of Re)ze.push(De.substring(We,Je)),We=Je;return We<tt.length&&ze.push(De.substring(We,tt.length)),ze}(Z,m_(Z,P,w,s,f,U));const ce=[],he={positionedLines:ce,text:Z.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(De,Re,ze,tt,We,Je,mt,Qe,Ye,Oe,Tt,kt){let vt=0,ft=0,fn=0,vi=0;const vr="right"===Qe?1:"left"===Qe?0:.5,po=24/kt;let Os=0;for(const Jn of We){Jn.trim();const kr=Jn.getMaxScale(),io={positionedGlyphs:[],lineOffset:0};De.positionedLines[Os]=io;const br=io.positionedGlyphs;let go=0;if(!Jn.length()){ft+=Je,++Os;continue}const da=Mx(tt,Jn,po);for(let mo=0;mo<Jn.length();mo++){const Xi=Jn.getSection(mo),ei=Jn.getSectionIndex(mo),Qi=Jn.getCharCode(mo),Ji=pv(Ye,Tt,Qi);let kn;if(Xi.imageName){if(De.iconsInText=!0,Xi.scale=Xi.scale*po,kn=ug(Xi,Ji,kr,da,tt),!kn)continue;go=Math.max(go,kn.imageOffset)}else if(kn=gv(Xi,Qi,Ji,da,Re,ze),!kn)continue;const{rect:Ja,metrics:vc,baselineOffset:Fs}=kn;br.push({glyph:Qi,imageName:Xi.imageName,x:vt,y:ft+Fs+-17,vertical:Ji,scale:Xi.scale,fontStack:Xi.fontStack,sectionIndex:ei,metrics:vc,rect:Ja}),Ji?(De.verticalizable=!0,vt+=(Xi.imageName?vc.advance:24)*Xi.scale+Oe):vt+=vc.advance*Xi.scale+Oe}0!==br.length&&(fn=Math.max(vt-Oe,fn),mv(br,0,br.length-1,vr)),vt=0,io.lineOffset=Math.max(go,24*(kr-1));const wr=Je*kr+go;ft+=wr,vi=Math.max(wr,vi),++Os}const{horizontalAlign:Wo,verticalAlign:jr}=__(mt);(function(Jn,kr,io,br,go,da,wr,mo,Xi){const ei=(kr-io)*go;let Qi=0;Qi=da!==wr?-mo*br- -17:-br*Xi*wr+.5*wr;for(const Ji of Jn)for(const kn of Ji.positionedGlyphs)kn.x+=ei,kn.y+=Qi})(De.positionedLines,vr,Wo,jr,fn,vi,Je,ft,We.length),De.top+=-jr*ft,De.bottom=De.top+ft,De.left+=-Wo*fn,De.right=De.left+fn}(he,s,l,f,J,x,M,C,L,P,j,$),!function(De){for(const Re of De)if(0!==Re.positionedGlyphs.length)return!1;return!0}(ce)&&he}const Rf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sx={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hv={40:!0};function dv(c,s,l,f,g,w){if(s.imageName){const x=f[s.imageName];return x?x.displaySize[0]*s.scale*24/w+g:0}{const x=l[s.fontStack],M=x&&x[c];return M?M.metrics.advance*s.scale+g:0}}function p_(c,s,l,f){const g=Math.pow(c-s,2);return f?c<s?g/2:2*g:g+Math.abs(l)*l}function Ex(c,s,l){let f=0;return 10===c&&(f-=1e4),l&&(f+=150),40!==c&&65288!==c||(f+=50),41!==s&&65289!==s||(f+=50),f}function g_(c,s,l,f,g,w){let x=null,M=p_(s,l,g,w);for(const C of f){const P=p_(s-C.x,l,g,w)+C.badness;P<=M&&(x=C,M=P)}return{index:c,x:s,priorBreak:x,badness:M}}function fv(c){return c?fv(c.priorBreak).concat(c.index):[]}function m_(c,s,l,f,g,w){if(!c)return[];const x=[],M=function(L,j,U,$,Z,J){let ie=0;for(let be=0;be<L.length();be++){const ce=L.getSection(be);ie+=dv(L.getCharCode(be),ce,$,Z,j,J)}return ie/Math.max(1,Math.ceil(ie/U))}(c,s,l,f,g,w),C=c.text.indexOf("\u200b")>=0;let P=0;for(let L=0;L<c.length();L++){const j=c.getSection(L),U=c.getCharCode(L);if(Rf[U]||(P+=dv(U,j,f,g,s,w)),L<c.length()-1){const $=!((N=U)<11904)&&(!!an["CJK Compatibility Forms"](N)||!!an["CJK Compatibility"](N)||!!an["CJK Strokes"](N)||!!an["CJK Symbols and Punctuation"](N)||!!an["Enclosed CJK Letters and Months"](N)||!!an["Halfwidth and Fullwidth Forms"](N)||!!an["Ideographic Description Characters"](N)||!!an["Vertical Forms"](N)||Rs.test(String.fromCodePoint(N)));(Sx[U]||$||j.imageName||L!==c.length()-2&&hv[c.getCharCode(L+1)])&&x.push(g_(L+1,P,M,x,Ex(U,c.getCharCode(L+1),$&&C),!1))}}var N;return fv(g_(c.length(),P,M,x,0,!0))}function __(c){let s=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function Mx(c,s,l){const f=24*s.getMaxScale(),{maxImageWidth:g,maxImageHeight:w}=s.getMaxImageSize(c),x=Math.max(f,w*l);return{verticalLineContentWidth:Math.max(f,g*l),horizontalLineContentHeight:x}}function y_(c){switch(c){case"top":return 0;case"center":return.5;default:return 1}}function pv(c,s,l){return!(c===H.ao.horizontal||!s&&!od(l)||s&&(Rf[l]||(f=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(f)))));var f}function gv(c,s,l,f,g,w){const x=w[c.fontStack],M=function(P,N,L,j){if(P&&P.rect)return P;const U=N[L.fontStack],$=U&&U[j];return $?{rect:null,metrics:$.metrics}:null}(x&&x[s],g,c,s);if(null===M)return null;let C;if(l)C=f.verticalLineContentWidth-24*c.scale;else{const P=y_(c.verticalAlign);C=(f.horizontalLineContentHeight-24*c.scale)*P}return{rect:M.rect,metrics:M.metrics,baselineOffset:C}}function ug(c,s,l,f,g){const w=g[c.imageName];if(!w)return null;const x=w.paddedRect,M=w.displaySize,C={width:M[0],height:M[1],left:1,top:-3,advance:s?M[1]:M[0]};let P;if(s)P=f.verticalLineContentWidth-M[1]*c.scale;else{const N=y_(c.verticalAlign);P=(f.horizontalLineContentHeight-M[1]*c.scale)*N}return{rect:x,metrics:C,baselineOffset:P,imageOffset:(s?M[0]:M[1])*c.scale-24*l}}function mv(c,s,l,f){if(0===f)return;const g=c[l],w=(c[l].x+g.metrics.advance*g.scale)*f;for(let x=s;x<=l;x++)c[x].x-=w}function _v(c,s,l){const{horizontalAlign:f,verticalAlign:g}=__(l),w=s[0]-c.displaySize[0]*f,x=s[1]-c.displaySize[1]*g;return{image:c,top:x,bottom:x+c.displaySize[1],left:w,right:w+c.displaySize[0]}}function v_(c){var s,l;let f=c.left,g=c.top,w=c.right-f,x=c.bottom-g;const M=null!==(s=c.image.textFitWidth)&&void 0!==s?s:"stretchOrShrink",C=null!==(l=c.image.textFitHeight)&&void 0!==l?l:"stretchOrShrink",P=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if("proportional"===C){if("stretchOnly"===M&&w/x<P||"proportional"===M){const N=Math.ceil(x*P);f*=N/w,w=N}}else if("proportional"===M&&"stretchOnly"===C&&0!==P&&w/x>P){const N=Math.ceil(w/P);g*=N/x,x=N}return{x1:f,y1:g,x2:f+w,y2:g+x}}function b_(c,s,l,f,g,w){const x=c.image;let M;if(x.content){const J=x.content,ie=x.pixelRatio||1;M=[J[0]/ie,J[1]/ie,x.displaySize[0]-J[2]/ie,x.displaySize[1]-J[3]/ie]}const C=s.left*w,P=s.right*w;let N,L,j,U;"width"===l||"both"===l?(U=g[0]+C-f[3],L=g[0]+P+f[1]):(U=g[0]+(C+P-x.displaySize[0])/2,L=U+x.displaySize[0]);const $=s.top*w,Z=s.bottom*w;return"height"===l||"both"===l?(N=g[1]+$-f[0],j=g[1]+Z+f[2]):(N=g[1]+($+Z-x.displaySize[1])/2,j=N+x.displaySize[1]),{image:x,top:N,right:L,bottom:j,left:U,collisionPadding:M}}const _c=128,Cu=32640;function yv(c,s){const{expression:l}=s;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new ui(c+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:g}=l;let w=0;for(;w<f.length&&f[w]<=c;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<c+1;)x++;x=Math.min(f.length-1,x);const M=f[w],C=f[x];return"composite"===l.kind?{kind:"composite",minZoom:M,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:M,maxZoom:C,minSize:l.evaluate(new ui(M)),maxSize:l.evaluate(new ui(C)),interpolationType:g}}}function w_(c,s,l){let f="never";const g=c.get(s);return g?f=g:c.get(l)&&(f="always"),f}const Dx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hg(c,s,l,f,g,w,x,M,C,P,N,L,j){const U=M?Math.min(Cu,Math.round(M[0])):0,$=M?Math.min(Cu,Math.round(M[1])):0;c.emplaceBack(s,l,Math.round(32*f),Math.round(32*g),w,x,(U<<1)+(C?1:0),$,16*P,16*N,256*L,256*j)}function x_(c,s,l){c.emplaceBack(s.x,s.y,l),c.emplaceBack(s.x,s.y,l),c.emplaceBack(s.x,s.y,l),c.emplaceBack(s.x,s.y,l)}function Cx(c){for(const s of c.sections)if(sd(s.text))return!0;return!1}class dg{constructor(s){this.layoutVertexArray=new Be,this.indexArray=new Mn,this.programConfigurations=s,this.segments=new Ht,this.dynamicLayoutVertexArray=new ke,this.opacityVertexArray=new rt,this.hasVisibleVertices=!1,this.placedSymbolArray=new q}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(s,l,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ov.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,px.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Dx,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ze("SymbolBuffers",dg);class S_{constructor(s,l,f){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new f,this.segments=new Ht,this.collisionVertexArray=new Tn}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,gx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ze("CollisionBuffers",S_);class wd{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(x=>x.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yv(this.zoom,l["text-size"]),this.iconSizeData=yv(this.zoom,l["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap="never"!==w_(f,"text-overlap","text-allow-overlap")||"never"!==w_(f,"icon-overlap","icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==w&&!g.isConstant(),this.sortFeaturesByY=("viewport-y"===w||"auto"===w&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===f.get("symbol-placement")&&(this.writingModes=f.get("text-writing-mode").map(x=>H.ao[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=s.sourceID}createArrays(){this.text=new dg(new Do(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new dg(new Do(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new te,this.lineVertexArray=new re,this.symbolInstances=new Q,this.textAnchorOffsets=new oe}calculateGlyphDependencies(s,l,f,g,w){for(let x=0;x<s.length;x++)if(l[s.charCodeAt(x)]=!0,(f||g)&&w){const M=Nn[s.charAt(x)];M&&(l[M.charCodeAt(0)]=!0)}}populate(s,l,f){const g=this.layers[0],w=g.layout,x=w.get("text-font"),M=w.get("text-field"),C=w.get("icon-image"),P=("constant"!==M.value.kind||M.value.value instanceof $e&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),N="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,L=w.get("symbol-sort-key");if(this.features=[],!P&&!N)return;const j=l.iconDependencies,U=l.glyphDependencies,$=l.availableImages,Z=new ui(this.zoom,{globalState:this.globalState});for(const{feature:J,id:ie,index:be,sourceLayerIndex:ce}of s){const he=g._featureFilter.needGeometry,De=Ka(J,he);if(!g._featureFilter.filter(Z,De,f))continue;let Re,ze;if(he||(De.geometry=_s(J)),P){const We=g.getValueAndResolveTokens("text-field",De,f,$),Je=$e.factory(We),mt=this.hasRTLText=this.hasRTLText||Cx(Je);(!mt||"unavailable"===Uo.getRTLTextPluginStatus()||mt&&Uo.isParsed())&&(Re=bd(Je,g,De))}if(N){const We=g.getValueAndResolveTokens("icon-image",De,f,$);ze=We instanceof Fo?We:Fo.fromString(We)}if(!Re&&!ze)continue;const tt=this.sortFeaturesByKey?L.evaluate(De,{},f):void 0;if(this.features.push({id:ie,text:Re,icon:ze,index:be,sourceLayerIndex:ce,geometry:De.geometry,properties:J.properties,type:Eu.types[J.type],sortKey:tt}),ze&&(j[ze.name]=!0),Re){const We=x.evaluate(De,{},f).join(","),Je="viewport"!==w.get("text-rotation-alignment")&&"point"!==w.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(H.ao.vertical)>=0;for(const mt of Re.sections)if(mt.image)j[mt.image.name]=!0;else{const Qe=ac(Re.toString()),Ye=mt.fontStack||We,Oe=U[Ye]=U[Ye]||{};this.calculateGlyphDependencies(mt.text,Oe,Je,this.allowVerticalPlacement,Qe)}}}"line"===w.get("symbol-placement")&&(this.features=function(J){const ie={},be={},ce=[];let he=0;function De(We){ce.push(J[We]),he++}function Re(We,Je,mt){const Qe=be[We];return delete be[We],be[Je]=Qe,ce[Qe].geometry[0].pop(),ce[Qe].geometry[0]=ce[Qe].geometry[0].concat(mt[0]),Qe}function ze(We,Je,mt){const Qe=ie[Je];return delete ie[Je],ie[We]=Qe,ce[Qe].geometry[0].shift(),ce[Qe].geometry[0]=mt[0].concat(ce[Qe].geometry[0]),Qe}function tt(We,Je,mt){const Qe=mt?Je[0][Je[0].length-1]:Je[0][0];return`${We}:${Qe.x}:${Qe.y}`}for(let We=0;We<J.length;We++){const Je=J[We],mt=Je.geometry,Qe=Je.text?Je.text.toString():null;if(!Qe){De(We);continue}const Ye=tt(Qe,mt),Oe=tt(Qe,mt,!0);if(Ye in be&&Oe in ie&&be[Ye]!==ie[Oe]){const Tt=ze(Ye,Oe,mt),kt=Re(Ye,Oe,ce[Tt].geometry);delete ie[Ye],delete be[Oe],be[tt(Qe,ce[kt].geometry,!0)]=kt,ce[Tt].geometry=null}else Ye in be?Re(Ye,Oe,mt):Oe in ie?ze(Ye,Oe,mt):(De(We),ie[Ye]=he-1,be[Oe]=he-1)}return ce.filter(We=>We.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(s,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,l,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,l,this.layers,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,l){const f=this.lineVertexArray.length;if(void 0!==s.segment){let g=s.dist(l[s.segment+1]),w=s.dist(l[s.segment]);const x={};for(let M=s.segment+1;M<l.length;M++)x[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:g},M<l.length-1&&(g+=l[M+1].dist(l[M]));for(let M=s.segment||0;M>=0;M--)x[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:w},M>0&&(w+=l[M-1].dist(l[M]));for(let M=0;M<l.length;M++){const C=x[M];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,l,f,g,w,x,M,C,P,N,L,j){const U=s.indexArray,$=s.layoutVertexArray,Z=s.segments.prepareSegment(4*l.length,$,U,this.canOverlap?x.sortKey:void 0),J=this.glyphOffsetArray.length,ie=Z.vertexLength,be=this.allowVerticalPlacement&&M===H.ao.vertical?Math.PI/2:0,ce=x.text&&x.text.sections;for(let he=0;he<l.length;he++){const{tl:De,tr:Re,bl:ze,br:tt,tex:We,pixelOffsetTL:Je,pixelOffsetBR:mt,minFontScaleX:Qe,minFontScaleY:Ye,glyphOffset:Oe,isSDF:Tt,sectionIndex:kt}=l[he],vt=Z.vertexLength,ft=Oe[1];hg($,C.x,C.y,De.x,ft+De.y,We.x,We.y,f,Tt,Je.x,Je.y,Qe,Ye),hg($,C.x,C.y,Re.x,ft+Re.y,We.x+We.w,We.y,f,Tt,mt.x,Je.y,Qe,Ye),hg($,C.x,C.y,ze.x,ft+ze.y,We.x,We.y+We.h,f,Tt,Je.x,mt.y,Qe,Ye),hg($,C.x,C.y,tt.x,ft+tt.y,We.x+We.w,We.y+We.h,f,Tt,mt.x,mt.y,Qe,Ye),x_(s.dynamicLayoutVertexArray,C,be),U.emplaceBack(vt,vt+2,vt+1),U.emplaceBack(vt+1,vt+2,vt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oe[0]),he!==l.length-1&&kt===l[he+1].sectionIndex||s.programConfigurations.populatePaintArrays($.length,x,x.index,{},j,ce&&ce[kt])}s.placedSymbolArray.emplaceBack(C.x,C.y,J,this.glyphOffsetArray.length-J,ie,P,N,C.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],M,0,!1,0,L)}_addCollisionDebugVertex(s,l,f,g,w,x){return l.emplaceBack(0,0),s.emplaceBack(f.x,f.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(s,l,f,g,w,x,M){const C=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),P=C.vertexLength,N=w.layoutVertexArray,L=w.collisionVertexArray,j=M.anchorX,U=M.anchorY;this._addCollisionDebugVertex(N,L,x,j,U,new st(s,l)),this._addCollisionDebugVertex(N,L,x,j,U,new st(f,l)),this._addCollisionDebugVertex(N,L,x,j,U,new st(f,g)),this._addCollisionDebugVertex(N,L,x,j,U,new st(s,g)),C.vertexLength+=4;const $=w.indexArray;$.emplaceBack(P,P+1),$.emplaceBack(P+1,P+2),$.emplaceBack(P+2,P+3),$.emplaceBack(P+3,P),C.primitiveLength+=4}addDebugCollisionBoxes(s,l,f,g){for(let w=s;w<l;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new S_($t,mx.members,ln),this.iconCollisionBox=new S_($t,mx.members,ln);for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(s,l,f,g,w,x,M,C,P){const N={};for(let L=l;L<f;L++){const j=s.get(L);N.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},N.textFeatureIndex=j.featureIndex;break}for(let L=g;L<w;L++){const j=s.get(L);N.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},N.verticalTextFeatureIndex=j.featureIndex;break}for(let L=x;L<M;L++){const j=s.get(L);N.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},N.iconFeatureIndex=j.featureIndex;break}for(let L=C;L<P;L++){const j=s.get(L);N.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},N.verticalIconFeatureIndex=j.featureIndex;break}return N}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,l){const f=s.placedSymbolArray.get(l),g=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<g;w+=4)s.indexArray.emplaceBack(w,w+2,w+1),s.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(s),f=Math.cos(s),g=[],w=[],x=[];for(let M=0;M<this.symbolInstances.length;++M){x.push(M);const C=this.symbolInstances.get(M);g.push(0|Math.round(l*C.anchorX+f*C.anchorY)),w.push(C.featureIndex)}return x.sort((M,C)=>g[M]-g[C]||w[C]-w[M]),x}addToSortKeyRanges(s,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vv,E_;Ze("SymbolBucket",wd,{omit:["layers","collisionBoxArray","features","compareText"]}),wd.MAX_GLYPHS=65535,wd.addDynamicAttributes=x_;var Nf={get paint(){return E_=E_||new St({"icon-opacity":new Se(xe.paint_symbol["icon-opacity"]),"icon-color":new Se(xe.paint_symbol["icon-color"]),"icon-halo-color":new Se(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Se(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Se(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Se(xe.paint_symbol["text-opacity"]),"text-color":new Se(xe.paint_symbol["text-color"],{runtimeType:Dr,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Se(xe.paint_symbol["text-halo-color"]),"text-halo-width":new Se(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Se(xe.paint_symbol["text-halo-blur"]),"text-translate":new dt(xe.paint_symbol["text-translate"]),"text-translate-anchor":new dt(xe.paint_symbol["text-translate-anchor"])})},get layout(){return vv=vv||new St({"symbol-placement":new dt(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Se(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dt(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dt(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dt(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Se(xe.layout_symbol["icon-size"]),"icon-text-fit":new dt(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dt(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Se(xe.layout_symbol["icon-image"]),"icon-rotate":new Se(xe.layout_symbol["icon-rotate"]),"icon-padding":new Se(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Se(xe.layout_symbol["icon-offset"]),"icon-anchor":new Se(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(xe.layout_symbol["text-rotation-alignment"]),"text-field":new Se(xe.layout_symbol["text-field"]),"text-font":new Se(xe.layout_symbol["text-font"]),"text-size":new Se(xe.layout_symbol["text-size"]),"text-max-width":new Se(xe.layout_symbol["text-max-width"]),"text-line-height":new dt(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Se(xe.layout_symbol["text-letter-spacing"]),"text-justify":new Se(xe.layout_symbol["text-justify"]),"text-radial-offset":new Se(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Se(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Se(xe.layout_symbol["text-anchor"]),"text-max-angle":new dt(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(xe.layout_symbol["text-writing-mode"]),"text-rotate":new Se(xe.layout_symbol["text-rotate"]),"text-padding":new dt(xe.layout_symbol["text-padding"]),"text-keep-upright":new dt(xe.layout_symbol["text-keep-upright"]),"text-transform":new Se(xe.layout_symbol["text-transform"]),"text-offset":new Se(xe.layout_symbol["text-offset"]),"text-allow-overlap":new dt(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new dt(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new dt(xe.layout_symbol["text-ignore-placement"]),"text-optional":new dt(xe.layout_symbol["text-optional"])})}};class bv{constructor(s){if(void 0===s.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:Cn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze("FormatSectionOverride",bv,{omit:["defaultValue"]});class Qa extends Qr{constructor(s){super(s,Nf)}recalculate(s,l){if(super.recalculate(s,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const w of f)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,l,f,g){const w=this.layout.get(s).evaluate(l,{},f,g),x=this._unevaluatedLayout._values[s];return x.isDataDriven()||za(x.value)||!w?w:(M=l.properties,w.replace(/{([^{}]+)}/g,(P,N)=>M&&N in M?String(M[N]):""));var M}createBucket(s){return new wd(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Nf.paint.overridableProperties){if(!Qa.hasPaintOverride(this.layout,s))continue;const l=this.paint.get(s),f=new bv(l),g=new uu(f,l.property.specification);let w=null;w="constant"===l.value.kind||"source"===l.value.kind?new As("source",g):new wl("composite",g,l.value.zoomStops),this.paint._values[s]=new Ha(l.property,w,l.parameters)}}_handleOverridablePaintPropertyUpdate(s,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&Qa.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,l){const f=s.get("text-field"),g=Nf.paint.properties[l];let w=!1;const x=M=>{for(const C of M)if(g.overrides&&g.overrides.hasOverride(C))return void(w=!0)};if("constant"===f.value.kind&&f.value.value instanceof $e)x(f.value.value.sections);else if("source"===f.value.kind){const M=P=>{w||(P instanceof Ra&&It(P.value)===Wl?x(P.value.sections):P instanceof gl?x(P.sections):P.eachChild(M))},C=f.value;C._styleExpression&&M(C._styleExpression.expression)}return w}}let xd;var Tx={get paint(){return xd=xd||new St({"background-color":new dt(xe.paint_background["background-color"]),"background-pattern":new Zi(xe.paint_background["background-pattern"]),"background-opacity":new dt(xe.paint_background["background-opacity"])})}};class wv extends Qr{constructor(s){super(s,Tx)}}let fg;var oT={get paint(){return fg=fg||new St({"raster-opacity":new dt(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new dt(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(xe.paint_raster["raster-saturation"]),"raster-contrast":new dt(xe.paint_raster["raster-contrast"]),"raster-resampling":new dt(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(xe.paint_raster["raster-fade-duration"])})}};class xv extends Qr{constructor(s){super(s,oT)}}class Sv extends Qr{constructor(s){super(s,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=s}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ix{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Ax={once:!0},Ev=6371008.8;class Tu{constructor(s,l){if(isNaN(s)||isNaN(l))throw new Error(`Invalid LngLat object: (${s}, ${l})`);if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tu(Vc(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const l=Math.PI/180,f=this.lat*l,g=s.lat*l,w=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((s.lng-this.lng)*l);return Ev*Math.acos(Math.min(w,1))}static convert(s){if(s instanceof Tu)return s;if(Array.isArray(s)&&(2===s.length||3===s.length))return new Tu(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&"object"==typeof s&&null!==s)return new Tu(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const yh=2*Math.PI*Ev;function M_(c){return yh*Math.cos(c*Math.PI/180)}function pg(c){return(180+c)/360}function gg(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function mg(c,s){return c/M_(s)}function _g(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function D_(c,s){return c*M_(_g(s))}class kf{constructor(s,l,f=0){this.x=+s,this.y=+l,this.z=+f}static fromLngLat(s,l=0){const f=Tu.convert(s);return new kf(pg(f.lng),gg(f.lat),mg(l,f.lat))}toLngLat(){return new Tu(360*this.x-180,_g(this.y))}toAltitude(){return D_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/yh*(s=_g(this.y),1/Math.cos(s*Math.PI/180));var s}}function yg(c,s,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[c*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}class vg{constructor(s,l,f){if(w=l,x=f,(g=s)<0||g>25||x<0||x>=Math.pow(2,g)||w<0||w>=Math.pow(2,g))throw new Error(`x=${l}, y=${f}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);var g,w,x;this.z=s,this.x=l,this.y=f,this.key=bh(0,s,s,l,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,l,f){const g=(x=this.y,M=this.z,C=yg(256*(w=this.x),256*(x=Math.pow(2,M)-x-1),M),P=yg(256*(w+1),256*(x+1),M),C[0]+","+C[1]+","+P[0]+","+P[1]);var w,x,M,C,P;const N=function(L,j,U){let $,Z="";for(let J=L;J>0;J--)$=1<<J-1,Z+=(j&$?1:0)+(U&$?2:0);return Z}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===f?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,g)}isChildOf(s){const l=this.z-s.z;return l>0&&s.x===this.x>>l&&s.y===this.y>>l}getTilePoint(s){const l=Math.pow(2,this.z);return new st((s.x*l-this.x)*pn,(s.y*l-this.y)*pn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vh{constructor(s,l){this.wrap=s,this.canonical=l,this.key=bh(s,l.z,l.z,l.x,l.y)}}class ks{constructor(s,l,f,g,w){if(this.terrainRttPosMatrix32f=null,s<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${f}`);this.overscaledZ=s,this.wrap=l,this.canonical=new vg(f,+g,+w),this.key=bh(l,s,f,g,w)}clone(){return new ks(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-s;return s>this.canonical.z?new ks(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ks(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(s,l){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?bh(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y):bh(this.wrap*+l,s,s,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const l=this.canonical.z-s.canonical.z;return 0===s.overscaledZ||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l}children(s){if(this.overscaledZ>=s)return[new ks(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new ks(l,this.wrap,l,f,g),new ks(l,this.wrap,l,f+1,g),new ks(l,this.wrap,l,f,g+1),new ks(l,this.wrap,l,f+1,g+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new ks(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new ks(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new kf(s.x-this.wrap,s.y))}}function bh(c,s,l,f,g){(c*=2)<0&&(c=-1*c-1);const w=1<<l;return(w*w*c+w*g+f).toString(36)+l.toString(36)+s.toString(36)}function Sd(c,s){return s?c.properties[s]:c.id}Ze("CanonicalTileID",vg),Ze("OverscaledTileID",ks,{omit:["terrainRttPosMatrix32f"]});class wh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(s){return this.minX=Math.min(this.minX,s.x),this.minY=Math.min(this.minY,s.y),this.maxX=Math.max(this.maxX,s.x),this.maxY=Math.max(this.maxY,s.y),this}expandBy(s){return this.minX-=s,this.minY-=s,this.maxX+=s,this.maxY+=s,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(s){return this.expandBy(-s)}map(s){const l=new wh;return l.extend(s(new st(this.minX,this.minY))),l.extend(s(new st(this.maxX,this.minY))),l.extend(s(new st(this.minX,this.maxY))),l.extend(s(new st(this.maxX,this.maxY))),l}static fromPoints(s){const l=new wh;for(const f of s)l.extend(f);return l}contains(s){return s.x>=this.minX&&s.x<=this.maxX&&s.y>=this.minY&&s.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(s){return!this.empty()&&!s.empty()&&s.minX>=this.minX&&s.maxX<=this.maxX&&s.minY>=this.minY&&s.maxY<=this.maxY}intersects(s){return!this.empty()&&!s.empty()&&s.minX<=this.maxX&&s.maxX>=this.minX&&s.minY<=this.maxY&&s.maxY>=this.minY}}class C_{constructor(s){this._stringToNumber={},this._numberToString=[];for(let l=0;l<s.length;l++){const f=s[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class T_{constructor(s,l,f,g,w){this.type="Feature",this._vectorTileFeature=s,s._z=l,s._x=f,s._y=g,this.properties=s.properties,this.id=w}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(s[l]=this[l]);return s}}class Mv{constructor(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Ps(pn,16,0),this.grid3D=new Ps(pn,16,0),this.featureIndexArray=new de,this.promoteId=l}insert(s,l,f,g,w,x){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,w);const C=x?this.grid3D:this.grid;for(let P=0;P<l.length;P++){const N=l[P],L=[1/0,1/0,-1/0,-1/0];for(let j=0;j<N.length;j++){const U=N[j];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}L[0]<pn&&L[1]<pn&&L[2]>=0&&L[3]>=0&&C.insert(M,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new r_(new u_(this.rawTileData)).layers,this.sourceLayerCoder=new C_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,l,f,g){this.loadVTLayers();const w=s.params,x=pn/s.tileSize/s.scale,M=gr(w.filter),C=s.queryGeometry,P=s.queryPadding*x,N=wh.fromPoints(C),L=this.grid.query(N.minX-P,N.minY-P,N.maxX+P,N.maxY+P),j=wh.fromPoints(s.cameraQueryGeometry).expandBy(P),U=this.grid3D.query(j.minX,j.minY,j.maxX,j.maxY,(J,ie,be,ce)=>function(he,De,Re,ze,tt){for(const Je of he)if(De<=Je.x&&Re<=Je.y&&ze>=Je.x&&tt>=Je.y)return!0;const We=[new st(De,Re),new st(De,tt),new st(ze,tt),new st(ze,Re)];if(he.length>2)for(const Je of We)if(ys(he,Je))return!0;for(let Je=0;Je<he.length-1;Je++)if(gd(he[Je],he[Je+1],We))return!0;return!1}(s.cameraQueryGeometry,J-P,ie-P,be+P,ce+P));for(const J of U)L.push(J);L.sort(sT);const $={};let Z;for(let J=0;J<L.length;J++){const ie=L[J];if(ie===Z)continue;Z=ie;const be=this.featureIndexArray.get(ie);let ce=null;this.loadMatchingFeature($,be.bucketIndex,be.sourceLayerIndex,be.featureIndex,M,w.layers,w.availableImages,l,f,g,(he,De,Re)=>(ce||(ce=_s(he)),De.queryIntersectsFeature({queryGeometry:C,feature:he,featureState:Re,geometry:ce,zoom:this.z,transform:s.transform,pixelsToTileUnits:x,pixelPosMatrix:s.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:s.getElevation})))}return $}loadMatchingFeature(s,l,f,g,w,x,M,C,P,N,L){const j=this.bucketLayerIDs[l];if(x&&!j.some(J=>x.has(J)))return;const U=this.sourceLayerCoder.decode(f),$=this.vtLayers[U].feature(g);if(w.needGeometry){const J=Ka($,!0);if(!w.filter(new ui(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!w.filter(new ui(this.tileID.overscaledZ),$))return;const Z=this.getId($,U);for(let J=0;J<j.length;J++){const ie=j[J];if(x&&!x.has(ie))continue;const be=C[ie];if(!be)continue;let ce={};Z&&N&&(ce=N.getState(be.sourceLayer||"_geojsonTileLayer",Z));const he=ss({},P[ie]);he.paint=I_(he.paint,be.paint,$,ce,M),he.layout=I_(he.layout,be.layout,$,ce,M);const De=!L||L($,be,ce);if(!De)continue;const Re=new T_($,this.z,this.x,this.y,Z);Re.layer=he;let ze=s[ie];void 0===ze&&(ze=s[ie]=[]),ze.push({featureIndex:g,feature:Re,intersectionZ:De})}}lookupSymbolFeatures(s,l,f,g,w,x,M,C){const P={};this.loadVTLayers();const N=gr(w);for(const L of s)this.loadMatchingFeature(P,f,g,L,N,x,M,C,l);return P}hasLayer(s){for(const l of this.bucketLayerIDs)for(const f of l)if(s===f)return!0;return!1}getId(s,l){var f;let g=s.id;return this.promoteId&&(g=s.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof g&&(g=Number(g)),void 0===g&&!(null===(f=s.properties)||void 0===f)&&f.cluster&&this.promoteId&&(g=Number(s.properties.cluster_id))),g}}function I_(c,s,l,f,g){return Hl(c,(w,x)=>{const M=s instanceof hd?s.get(x):null;return M&&M.evaluate?M.evaluate(l,f,g):M})}function sT(c,s){return s-c}function A_(c,s,l,f,g){const w=[];for(let x=0;x<c.length;x++){const M=c[x];let C;for(let P=0;P<M.length-1;P++){let N=M[P],L=M[P+1];N.x<s&&L.x<s||(N.x<s?N=new st(s,N.y+(s-N.x)/(L.x-N.x)*(L.y-N.y))._round():L.x<s&&(L=new st(s,N.y+(s-N.x)/(L.x-N.x)*(L.y-N.y))._round()),N.y<l&&L.y<l||(N.y<l?N=new st(N.x+(l-N.y)/(L.y-N.y)*(L.x-N.x),l)._round():L.y<l&&(L=new st(N.x+(l-N.y)/(L.y-N.y)*(L.x-N.x),l)._round()),N.x>=f&&L.x>=f||(N.x>=f?N=new st(f,N.y+(f-N.x)/(L.x-N.x)*(L.y-N.y))._round():L.x>=f&&(L=new st(f,N.y+(f-N.x)/(L.x-N.x)*(L.y-N.y))._round()),N.y>=g&&L.y>=g||(N.y>=g?N=new st(N.x+(g-N.y)/(L.y-N.y)*(L.x-N.x),g)._round():L.y>=g&&(L=new st(N.x+(g-N.y)/(L.y-N.y)*(L.x-N.x),g)._round()),C&&N.equals(C[C.length-1])||(C=[N],w.push(C)),C.push(L)))))}}return w}Ze("FeatureIndex",Mv,{omit:["rawTileData","sourceLayerCoder"]});class Iu extends st{constructor(s,l,f,g){super(s,l),this.angle=f,void 0!==g&&(this.segment=g)}clone(){return new Iu(this.x,this.y,this.angle,this.segment)}}function Dv(c,s,l,f,g){if(void 0===s.segment||0===l)return!0;let w=s,x=s.segment+1,M=0;for(;M>-l/2;){if(x--,x<0)return!1;M-=c[x].dist(w),w=c[x]}M+=c[x].dist(c[x+1]),x++;const C=[];let P=0;for(;M<l/2;){const N=c[x],L=c[x+1];if(!L)return!1;let j=c[x-1].angleTo(N)-N.angleTo(L);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:M,angleDelta:j}),P+=j;M-C[0].distance>f;)P-=C.shift().angleDelta;if(P>g)return!1;x++,M+=N.dist(L)}return!0}function Px(c){let s=0;for(let l=0;l<c.length-1;l++)s+=c[l].dist(c[l+1]);return s}function Rx(c,s,l){return c?.6*s*l:0}function Cv(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function Nx(c,s,l,f,g,w){const x=Rx(l,g,w),M=Cv(l,f)*w;let C=0;const P=Px(c)/2;for(let N=0;N<c.length-1;N++){const L=c[N],j=c[N+1],U=L.dist(j);if(C+U>P){const $=(P-C)/U,Z=Js.number(L.x,j.x,$),J=Js.number(L.y,j.y,$),ie=new Iu(Z,J,j.angleTo(L),N);return ie._round(),!x||Dv(c,ie,M,x,s)?ie:void 0}C+=U}}function aT(c,s,l,f,g,w,x,M,C){const P=Rx(f,w,x),N=Cv(f,g),L=N*x,j=0===c[0].x||c[0].x===C||0===c[0].y||c[0].y===C;return s-L<s/4&&(s=L+s/4),Of(c,j?s/2*M%s:(N/2+2*w)*x*M%s,s,P,l,L,j,!1,C)}function Of(c,s,l,f,g,w,x,M,C){const P=w/2,N=Px(c);let L=0,j=s-l,U=[];for(let $=0;$<c.length-1;$++){const Z=c[$],J=c[$+1],ie=Z.dist(J),be=J.angleTo(Z);for(;j+l<L+ie;){j+=l;const ce=(j-L)/ie,he=Js.number(Z.x,J.x,ce),De=Js.number(Z.y,J.y,ce);if(he>=0&&he<C&&De>=0&&De<C&&j-P>=0&&j+P<=N){const Re=new Iu(he,De,be,$);Re._round(),f&&!Dv(c,Re,w,f,g)||U.push(Re)}}L+=ie}return M||U.length||x||(U=Of(c,L/2,l,f,g,w,x,!0,C)),U}function bg(c,s,l,f){const g=[],w=c.image,x=w.pixelRatio,M=w.paddedRect.w-2,C=w.paddedRect.h-2;let P={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const N=w.stretchX||[[0,M]],L=w.stretchY||[[0,C]],j=(Oe,Tt)=>Oe+Tt[1]-Tt[0],U=N.reduce(j,0),$=L.reduce(j,0),Z=M-U,J=C-$;let ie=0,be=U,ce=0,he=$,De=0,Re=Z,ze=0,tt=J;if(w.content&&f){const Oe=w.content,Tt=Oe[2]-Oe[0],kt=Oe[3]-Oe[1];(w.textFitWidth||w.textFitHeight)&&(P=v_(c)),ie=Ed(N,0,Oe[0]),ce=Ed(L,0,Oe[1]),be=Ed(N,Oe[0],Oe[2]),he=Ed(L,Oe[1],Oe[3]),De=Oe[0]-ie,ze=Oe[1]-ce,Re=Tt-be,tt=kt-he}const We=P.x1,Je=P.y1,mt=P.x2-We,Qe=P.y2-Je,Ye=(Oe,Tt,kt,vt)=>{const ft=Sh(Oe.stretch-ie,be,mt,We),fn=Eh(Oe.fixed-De,Re,Oe.stretch,U),vi=Sh(Tt.stretch-ce,he,Qe,Je),vr=Eh(Tt.fixed-ze,tt,Tt.stretch,$),po=Sh(kt.stretch-ie,be,mt,We),Os=Eh(kt.fixed-De,Re,kt.stretch,U),Wo=Sh(vt.stretch-ce,he,Qe,Je),jr=Eh(vt.fixed-ze,tt,vt.stretch,$),Jn=new st(ft,vi),kr=new st(po,vi),io=new st(po,Wo),br=new st(ft,Wo),go=new st(fn/x,vr/x),da=new st(Os/x,jr/x),wr=s*Math.PI/180;if(wr){const ei=Math.sin(wr),Qi=Math.cos(wr),Ji=[Qi,-ei,ei,Qi];Jn._matMult(Ji),kr._matMult(Ji),br._matMult(Ji),io._matMult(Ji)}const mo=Oe.stretch+Oe.fixed,Xi=Tt.stretch+Tt.fixed;return{tl:Jn,tr:kr,bl:br,br:io,tex:{x:w.paddedRect.x+1+mo,y:w.paddedRect.y+1+Xi,w:kt.stretch+kt.fixed-mo,h:vt.stretch+vt.fixed-Xi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:go,pixelOffsetBR:da,minFontScaleX:Re/x/mt,minFontScaleY:tt/x/Qe,isSDF:l}};if(f&&(w.stretchX||w.stretchY)){const Oe=xh(N,Z,U),Tt=xh(L,J,$);for(let kt=0;kt<Oe.length-1;kt++){const vt=Oe[kt],ft=Oe[kt+1];for(let fn=0;fn<Tt.length-1;fn++)g.push(Ye(vt,Tt[fn],ft,Tt[fn+1]))}}else g.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:C+1}));return g}function Ed(c,s,l){let f=0;for(const g of c)f+=Math.max(s,Math.min(l,g[1]))-Math.max(s,Math.min(l,g[0]));return f}function xh(c,s,l){const f=[{fixed:-1,stretch:0}];for(const[g,w]of c){const x=f[f.length-1];f.push({fixed:g-x.stretch,stretch:x.stretch}),f.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return f.push({fixed:s+1,stretch:l}),f}function Sh(c,s,l,f){return c/s*l+f}function Eh(c,s,l,f){return c-s*l/f}Ze("Anchor",Iu);class yc{constructor(s,l,f,g,w,x,M,C,P,N){var L;if(this.boxStartIndex=s.length,P){let j=x.top,U=x.bottom;const $=x.collisionPadding;$&&(j-=$[1],U+=$[3]);let Z=U-j;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const j=null!==(L=x.image)&&void 0!==L&&L.content&&(x.image.textFitWidth||x.image.textFitHeight)?v_(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};j.y1=j.y1*M-C[0],j.y2=j.y2*M+C[2],j.x1=j.x1*M-C[3],j.x2=j.x2*M+C[1];const U=x.collisionPadding;if(U&&(j.x1-=U[0]*M,j.y1-=U[1]*M,j.x2+=U[2]*M,j.y2+=U[3]*M),N){const $=new st(j.x1,j.y1),Z=new st(j.x2,j.y1),J=new st(j.x1,j.y2),ie=new st(j.x2,j.y2),be=N*Math.PI/180;$._rotate(be),Z._rotate(be),J._rotate(be),ie._rotate(be),j.x1=Math.min($.x,Z.x,J.x,ie.x),j.x2=Math.max($.x,Z.x,J.x,ie.x),j.y1=Math.min($.y,Z.y,J.y,ie.y),j.y2=Math.max($.y,Z.y,J.y,ie.y)}s.emplaceBack(l.x,l.y,j.x1,j.y1,j.x2,j.y2,f,g,w)}this.boxEndIndex=s.length}}class P_{constructor(s=[],l=(f,g)=>f<g?-1:f>g?1:0){if(this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(0===this.length)return;const s=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:l,compare:f}=this,g=l[s];for(;s>0;){const w=s-1>>1,x=l[w];if(f(g,x)>=0)break;l[s]=x,s=w}l[s]=g}_down(s){const{data:l,compare:f}=this,g=this.length>>1,w=l[s];for(;s<g;){let x=1+(s<<1);const M=x+1;if(M<this.length&&f(l[M],l[x])<0&&(x=M),f(l[x],w)>=0)break;l[s]=l[x],s=x}l[s]=w}}function R_(c,s=1,l=!1){const f=wh.fromPoints(c[0]),g=Math.min(f.width(),f.height());let w=g/2;const x=new P_([],Tv),{minX:M,minY:C,maxX:P,maxY:N}=f;if(0===g)return new st(M,C);for(let U=M;U<P;U+=g)for(let $=C;$<N;$+=g)x.push(new Mh(U+w,$+w,w,c));let L=function(U){let $=0,Z=0,J=0;const ie=U[0];for(let be=0,ce=ie.length,he=ce-1;be<ce;he=be++){const De=ie[be],Re=ie[he],ze=De.x*Re.y-Re.x*De.y;Z+=(De.x+Re.x)*ze,J+=(De.y+Re.y)*ze,$+=3*ze}return new Mh(Z/$,J/$,0,U)}(c),j=x.length;for(;x.length;){const U=x.pop();(U.d>L.d||!L.d)&&(L=U,l&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,j)),U.max-L.d<=s||(w=U.h/2,x.push(new Mh(U.p.x-w,U.p.y-w,w,c)),x.push(new Mh(U.p.x+w,U.p.y-w,w,c)),x.push(new Mh(U.p.x-w,U.p.y+w,w,c)),x.push(new Mh(U.p.x+w,U.p.y+w,w,c)),j+=4)}return l&&(console.log(`num probes: ${j}`),console.log(`best distance: ${L.d}`)),L.p}function Tv(c,s){return s.max-c.max}function Mh(c,s,l,f){this.p=new st(c,s),this.h=l,this.d=function(g,w){let x=!1,M=1/0;for(let C=0;C<w.length;C++){const P=w[C];for(let N=0,L=P.length,j=L-1;N<L;j=N++){const U=P[N],$=P[j];U.y>g.y!=$.y>g.y&&g.x<($.x-U.x)*(g.y-U.y)/($.y-U.y)+U.x&&(x=!x),M=Math.min(M,V0(g,U,$))}}return(x?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var no;H.aE=void 0,(no=H.aE||(H.aE={}))[no.center=1]="center",no[no.left=2]="left",no[no.right=3]="right",no[no.top=4]="top",no[no.bottom=5]="bottom",no[no["top-left"]=6]="top-left",no[no["top-right"]=7]="top-right",no[no["bottom-left"]=8]="bottom-left",no[no["bottom-right"]=9]="bottom-right";const N_=Number.POSITIVE_INFINITY;function wg(c,s){return s[1]!==N_?function(l,f,g){let w=0,x=0;switch(f=Math.abs(f),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-g}switch(l){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(c,s[0],s[1]):function(l,f){let g=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(l){case"top-right":case"top-left":w=x-7;break;case"bottom-right":case"bottom-left":w=7-x;break;case"bottom":w=7-f;break;case"top":w=f-7}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=f;break;case"right":g=-f}return[g,w]}(c,s[0])}function kx(c,s,l){var f;const g=c.layout,w=null===(f=g.get("text-variable-anchor-offset"))||void 0===f?void 0:f.evaluate(s,{},l);if(w){const M=w.values,C=[];for(let P=0;P<M.length;P+=2){const N=C[P]=M[P],L=M[P+1].map(j=>24*j);N.startsWith("top")?L[1]-=7:N.startsWith("bottom")&&(L[1]+=7),C[P+1]=L}return new co(C)}const x=g.get("text-variable-anchor");if(x){let M;M=void 0!==c._unevaluatedLayout.getValue("text-radial-offset")?[24*g.get("text-radial-offset").evaluate(s,{},l),N_]:g.get("text-offset").evaluate(s,{},l).map(P=>24*P);const C=[];for(const P of x)C.push(P,wg(P,M));return new co(C)}return null}function Iv(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ox(c,s,l,f,g,w,x,M,C,P,N,L){let j=w.textMaxSize.evaluate(s,{});void 0===j&&(j=x);const U=c.layers[0].layout,$=U.get("icon-offset").evaluate(s,{},N),Z=Av(l.horizontal),J=x/24,ie=c.tilePixelRatio*J,be=c.tilePixelRatio*j/24,ce=c.tilePixelRatio*M,he=c.tilePixelRatio*U.get("symbol-spacing"),De=U.get("text-padding")*c.tilePixelRatio,Re=function(kt,vt,ft,fn=1){const vi=kt.get("icon-padding").evaluate(vt,{},ft),vr=vi&&vi.values;return[vr[0]*fn,vr[1]*fn,vr[2]*fn,vr[3]*fn]}(U,s,N,c.tilePixelRatio),ze=U.get("text-max-angle")/180*Math.PI,tt="viewport"!==U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),We="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),Je=U.get("symbol-placement"),mt=he/2,Qe=U.get("icon-text-fit");let Ye;f&&"none"!==Qe&&(c.allowVerticalPlacement&&l.vertical&&(Ye=b_(f,l.vertical,Qe,U.get("icon-text-fit-padding"),$,J)),Z&&(f=b_(f,Z,Qe,U.get("icon-text-fit-padding"),$,J)));const Oe=N?L.line.getGranularityForZoomLevel(N.z):1,Tt=(kt,vt)=>{vt.x<0||vt.x>=pn||vt.y<0||vt.y>=pn||function(ft,fn,vi,vr,po,Os,Wo,jr,Jn,kr,io,br,go,da,wr,mo,Xi,ei,Qi,Ji,kn,Ja,vc,Fs,Rv){const Dh=ft.addToLineVertexArray(fn,vi);let Pu,Ch,Dd,Cd,Nv=0,kv=0,Ov=0,bc=0,Th=-1,z_=-1;const Ru={};let zx=El("");if(ft.allowVerticalPlacement&&vr.vertical){const Co=jr.layout.get("text-rotate").evaluate(kn,{},Fs)+90;Dd=new yc(Jn,fn,kr,io,br,vr.vertical,go,da,wr,Co),Wo&&(Cd=new yc(Jn,fn,kr,io,br,Wo,Xi,ei,wr,Co))}if(po){const Co=jr.layout.get("icon-rotate").evaluate(kn,{}),fa="none"!==jr.layout.get("icon-text-fit"),wc=bg(po,Co,vc,fa),Ls=Wo?bg(Wo,Co,vc,fa):void 0;Ch=new yc(Jn,fn,kr,io,br,po,Xi,ei,!1,Co),Nv=4*wc.length;const Td=ft.iconSizeData;let xc=null;"source"===Td.kind?(xc=[_c*jr.layout.get("icon-size").evaluate(kn,{})],xc[0]>Cu&&nr(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Td.kind&&(xc=[_c*Ja.compositeIconSizes[0].evaluate(kn,{},Fs),_c*Ja.compositeIconSizes[1].evaluate(kn,{},Fs)],(xc[0]>Cu||xc[1]>Cu)&&nr(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,wc,xc,Ji,Qi,kn,H.ao.none,fn,Dh.lineStartIndex,Dh.lineLength,-1,Fs),Th=ft.icon.placedSymbolArray.length-1,Ls&&(kv=4*Ls.length,ft.addSymbols(ft.icon,Ls,xc,Ji,Qi,kn,H.ao.vertical,fn,Dh.lineStartIndex,Dh.lineLength,-1,Fs),z_=ft.icon.placedSymbolArray.length-1)}const jx=Object.keys(vr.horizontal);for(const Co of jx){const fa=vr.horizontal[Co];if(!Pu){zx=El(fa.text);const Ls=jr.layout.get("text-rotate").evaluate(kn,{},Fs);Pu=new yc(Jn,fn,kr,io,br,fa,go,da,wr,Ls)}const wc=1===fa.positionedLines.length;if(Ov+=Fx(ft,fn,fa,Os,jr,wr,kn,mo,Dh,vr.vertical?H.ao.horizontal:H.ao.horizontalOnly,wc?jx:[Co],Ru,Th,Ja,Fs),wc)break}vr.vertical&&(bc+=Fx(ft,fn,vr.vertical,Os,jr,wr,kn,mo,Dh,H.ao.vertical,["vertical"],Ru,z_,Ja,Fs));const cT=Pu?Pu.boxStartIndex:ft.collisionBoxArray.length,uT=Pu?Pu.boxEndIndex:ft.collisionBoxArray.length,Fv=Dd?Dd.boxStartIndex:ft.collisionBoxArray.length,Vx=Dd?Dd.boxEndIndex:ft.collisionBoxArray.length,Ux=Ch?Ch.boxStartIndex:ft.collisionBoxArray.length,Gx=Ch?Ch.boxEndIndex:ft.collisionBoxArray.length,$x=Cd?Cd.boxStartIndex:ft.collisionBoxArray.length,j_=Cd?Cd.boxEndIndex:ft.collisionBoxArray.length;let Vr=-1;const Nu=(Co,fa)=>Co&&Co.circleDiameter?Math.max(Co.circleDiameter,fa):fa;Vr=Nu(Pu,Vr),Vr=Nu(Dd,Vr),Vr=Nu(Ch,Vr),Vr=Nu(Cd,Vr);const V_=Vr>-1?1:0;V_&&(Vr*=Rv/24),ft.glyphOffsetArray.length>=wd.MAX_GLYPHS&&nr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==kn.sortKey&&ft.addToSortKeyRanges(ft.symbolInstances.length,kn.sortKey);const Lv=kx(jr,kn,Fs),[Bv,hT]=function(Co,fa){const wc=Co.length,Ls=fa?.values;if(Ls?.length>0)for(let Td=0;Td<Ls.length;Td+=2){const xc=Ls[Td+1];Co.emplaceBack(H.aE[Ls[Td]],xc[0],xc[1])}return[wc,Co.length]}(ft.textAnchorOffsets,Lv);ft.symbolInstances.emplaceBack(fn.x,fn.y,Ru.right>=0?Ru.right:-1,Ru.center>=0?Ru.center:-1,Ru.left>=0?Ru.left:-1,Ru.vertical||-1,Th,z_,zx,cT,uT,Fv,Vx,Ux,Gx,$x,j_,kr,Ov,bc,Nv,kv,V_,0,go,Vr,Bv,hT)}(c,vt,kt,l,f,g,Ye,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,ie,[De,De,De,De],tt,C,ce,Re,We,$,s,w,P,N,x)};if("line"===Je)for(const kt of A_(s.geometry,0,0,pn,pn)){const vt=gc(kt,Oe),ft=aT(vt,he,ze,l.vertical||Z,f,24,be,c.overscaling,pn);for(const fn of ft)Z&&lT(c,Z.text,mt,fn)||Tt(vt,fn)}else if("line-center"===Je){for(const kt of s.geometry)if(kt.length>1){const vt=gc(kt,Oe),ft=Nx(vt,ze,l.vertical||Z,f,24,be);ft&&Tt(vt,ft)}}else if("Polygon"===s.type)for(const kt of Eo(s.geometry,0)){const vt=R_(kt,16);Tt(gc(kt[0],Oe,!0),new Iu(vt.x,vt.y,0))}else if("LineString"===s.type)for(const kt of s.geometry){const vt=gc(kt,Oe);Tt(vt,new Iu(vt[0].x,vt[0].y,0))}else if("Point"===s.type)for(const kt of s.geometry)for(const vt of kt)Tt([vt],new Iu(vt.x,vt.y,0))}function Fx(c,s,l,f,g,w,x,M,C,P,N,L,j,U,$){const Z=function(be,ce,he,De,Re,ze,tt,We){const Je=De.layout.get("text-rotate").evaluate(ze,{})*Math.PI/180,mt=[];for(const Qe of ce.positionedLines)for(const Ye of Qe.positionedGlyphs){if(!Ye.rect)continue;const Oe=Ye.rect||{};let Tt=4,kt=!0,vt=1,ft=0;const fn=(Re||We)&&Ye.vertical,vi=Ye.metrics.advance*Ye.scale/2;if(We&&ce.verticalizable&&(ft=Qe.lineOffset/2-(Ye.imageName?-(24-Ye.metrics.width*Ye.scale)/2:24*(Ye.scale-1))),Ye.imageName){const ei=tt[Ye.imageName];kt=ei.sdf,vt=ei.pixelRatio,Tt=1/vt}const vr=Re?[Ye.x+vi,Ye.y]:[0,0];let po=Re?[0,0]:[Ye.x+vi+he[0],Ye.y+he[1]-ft],Os=[0,0];fn&&(Os=po,po=[0,0]);const Wo=Ye.metrics.isDoubleResolution?2:1,jr=(Ye.metrics.left-Tt)*Ye.scale-vi+po[0],Jn=(-Ye.metrics.top-Tt)*Ye.scale+po[1],kr=jr+Oe.w/Wo*Ye.scale/vt,io=Jn+Oe.h/Wo*Ye.scale/vt,br=new st(jr,Jn),go=new st(kr,Jn),da=new st(jr,io),wr=new st(kr,io);if(fn){const ei=new st(-vi,vi- -17),Qi=-Math.PI/2,Ji=12-vi,kn=new st(22-Ji,-(Ye.imageName?Ji:0)),Ja=new st(...Os);br._rotateAround(Qi,ei)._add(kn)._add(Ja),go._rotateAround(Qi,ei)._add(kn)._add(Ja),da._rotateAround(Qi,ei)._add(kn)._add(Ja),wr._rotateAround(Qi,ei)._add(kn)._add(Ja)}if(Je){const ei=Math.sin(Je),Qi=Math.cos(Je),Ji=[Qi,-ei,ei,Qi];br._matMult(Ji),go._matMult(Ji),da._matMult(Ji),wr._matMult(Ji)}const mo=new st(0,0),Xi=new st(0,0);mt.push({tl:br,tr:go,bl:da,br:wr,tex:Oe,writingMode:ce.writingMode,glyphOffset:vr,sectionIndex:Ye.sectionIndex,isSDF:kt,pixelOffsetTL:mo,pixelOffsetBR:Xi,minFontScaleX:0,minFontScaleY:0})}return mt}(0,l,M,g,w,x,f,c.allowVerticalPlacement),J=c.textSizeData;let ie=null;"source"===J.kind?(ie=[_c*g.layout.get("text-size").evaluate(x,{})],ie[0]>Cu&&nr(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===J.kind&&(ie=[_c*U.compositeTextSizes[0].evaluate(x,{},$),_c*U.compositeTextSizes[1].evaluate(x,{},$)],(ie[0]>Cu||ie[1]>Cu)&&nr(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,Z,ie,M,w,x,P,s,C.lineStartIndex,C.lineLength,j,$);for(const be of N)L[be]=c.text.placedSymbolArray.length-1;return 4*Z.length}function Av(c){for(const s in c)return c[s];return null}function lT(c,s,l,f){const g=c.compareText;if(s in g){const w=g[s];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<l)return!0}else g[s]=[];return g[s].push(f),!1}const Lx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ff{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(s,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(1!==g)throw new Error(`Got v${g} data when expected v1.`);const w=Lx[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(s,2,1),[M]=new Uint32Array(s,4,1);return new Ff(M,x,w,s)}constructor(s,l=64,f=Float64Array,g){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const w=Lx.indexOf(this.ArrayType),x=2*s*this.ArrayType.BYTES_PER_ELEMENT,M=s*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-M%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+M+C,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+x+M+C),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+M+C,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=s)}add(s,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=s,this.coords[this._pos++]=l,f}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Pv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,l,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:M}=this,C=[0,w.length-1,0],P=[];for(;C.length;){const N=C.pop()||0,L=C.pop()||0,j=C.pop()||0;if(L-j<=M){for(let J=j;J<=L;J++){const ie=x[2*J],be=x[2*J+1];ie>=s&&ie<=f&&be>=l&&be<=g&&P.push(w[J])}continue}const U=j+L>>1,$=x[2*U],Z=x[2*U+1];$>=s&&$<=f&&Z>=l&&Z<=g&&P.push(w[U]),(0===N?s<=$:l<=Z)&&(C.push(j),C.push(U-1),C.push(1-N)),(0===N?f>=$:g>=Z)&&(C.push(U+1),C.push(L),C.push(1-N))}return P}within(s,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,M=[0,g.length-1,0],C=[],P=f*f;for(;M.length;){const N=M.pop()||0,L=M.pop()||0,j=M.pop()||0;if(L-j<=x){for(let J=j;J<=L;J++)Bx(w[2*J],w[2*J+1],s,l)<=P&&C.push(g[J]);continue}const U=j+L>>1,$=w[2*U],Z=w[2*U+1];Bx($,Z,s,l)<=P&&C.push(g[U]),(0===N?s-f<=$:l-f<=Z)&&(M.push(j),M.push(U-1),M.push(1-N)),(0===N?s+f>=$:l+f>=Z)&&(M.push(U+1),M.push(L),M.push(1-N))}return C}}function Pv(c,s,l,f,g,w){if(g-f<=l)return;const x=f+g>>1;k_(c,s,x,f,g,w),Pv(c,s,l,f,x-1,1-w),Pv(c,s,l,x+1,g,1-w)}function k_(c,s,l,f,g,w){for(;g>f;){if(g-f>600){const P=g-f+1,N=l-f+1,L=Math.log(P),j=.5*Math.exp(2*L/3),U=.5*Math.sqrt(L*j*(P-j)/P)*(N-P/2<0?-1:1);k_(c,s,l,Math.max(f,Math.floor(l-N*j/P+U)),Math.min(g,Math.floor(l+(P-N)*j/P+U)),w)}const x=s[2*l+w];let M=f,C=g;for(Md(c,s,f,l),s[2*g+w]>x&&Md(c,s,f,g);M<C;){for(Md(c,s,M,C),M++,C--;s[2*M+w]<x;)M++;for(;s[2*C+w]>x;)C--}s[2*f+w]===x?Md(c,s,f,C):(C++,Md(c,s,C,g)),C<=l&&(f=C+1),l<=C&&(g=C-1)}}function Md(c,s,l,f){O_(c,l,f),O_(s,2*l,2*f),O_(s,2*l+1,2*f+1)}function O_(c,s,l){const f=c[s];c[s]=c[l],c[l]=f}function Bx(c,s,l,f){const g=c-l,w=s-f;return g*g+w*w}var Pl;H.cx=void 0,(Pl=H.cx||(H.cx={})).create="create",Pl.load="load",Pl.fullLoad="fullLoad";let F_=null,Au=[];const L_=1e3/60,B_="loadTime",xg="fullLoadTime",Sg={mark(c){performance.mark(c)},frame(c){const s=c;null!=F_&&Au.push(s-F_),F_=s},clearMetrics(){F_=null,Au=[],performance.clearMeasures(B_),performance.clearMeasures(xg);for(const c in H.cx)performance.clearMarks(H.cx[c])},getPerformanceMetrics(){performance.measure(B_,H.cx.create,H.cx.load),performance.measure(xg,H.cx.create,H.cx.fullLoad);const c=performance.getEntriesByName(B_)[0].duration,s=performance.getEntriesByName(xg)[0].duration,l=Au.length,f=1/(Au.reduce((w,x)=>w+x,0)/l/1e3),g=Au.filter(w=>w>L_).reduce((w,x)=>w+(x-L_)/L_,0);return{loadTime:c,fullLoadTime:s,fps:f,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};H.$=pn,H.A=Oi,H.B=function([c,s,l]){return s+=90,s*=Math.PI/180,l*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(l),y:c*Math.sin(s)*Math.sin(l),z:c*Math.cos(l)}},H.C=Js,H.D=dt,H.E=pt,H.F=ui,H.G=aa,H.H=function(c){if(null==hl){const s=c.navigator?c.navigator.userAgent:null;hl=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return hl},H.I=Af,H.J=class{constructor(c,s){this.target=c,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ix(()=>this.process()),this.subscription=Zs(this.target,"message",l=>this.receive(l),!1),this.globalScope=ko(self)?c:window}registerMessageHandler(c,s){this.messageHandlers[c]=s}sendAsync(c,s){return new Promise((l,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10),w=s?Zs(s.signal,"abort",()=>{w?.unsubscribe(),delete this.resolveRejects[g];const C={id:g,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)},Ax):null;this.resolveRejects[g]={resolve:C=>{w?.unsubscribe(),l(C)},reject:C=>{w?.unsubscribe(),f(C)}};const x=[],M=Object.assign(Object.assign({},c),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Wi(c.data,x)});this.target.postMessage(M,{transfer:x})})}receive(c){const s=c.data,l=s.id;if(!("file://"!==s.origin&&"file://"!==location.origin&&"resource://android"!==s.origin&&"resource://android"!==location.origin&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if("<cancel>"===s.type){delete this.tasks[l];const f=this.abortControllers[l];return delete this.abortControllers[l],void(f&&f.abort())}if(ko(self)||s.mustQueue)return this.tasks[l]=s,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,s)}}process(){if(0===this.taskQueue.length)return;const c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){return y(this,void 0,void 0,function*(){if("<response>"===s.type){const g=this.resolveRejects[c];return delete this.resolveRejects[c],g?void(s.error?g.reject(Sl(s.error)):g.resolve(Sl(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Sl(s.data),f=new AbortController;this.abortControllers[c]=f;try{const g=yield this.messageHandlers[s.type](s.sourceMapId,l,f);this.completeTask(c,null,g)}catch(g){this.completeTask(c,g)}})}completeTask(c,s,l){const f=[];delete this.abortControllers[c];const g={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Wi(s):null,data:Wi(l,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},H.K=X,H.L=function(){var c=new Oi(16);return Oi!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},H.M=function(c,s,l){var f,g,w,x,M,C,P,N,L,j,U,$,Z=l[0],J=l[1],ie=l[2];return s===c?(c[12]=s[0]*Z+s[4]*J+s[8]*ie+s[12],c[13]=s[1]*Z+s[5]*J+s[9]*ie+s[13],c[14]=s[2]*Z+s[6]*J+s[10]*ie+s[14],c[15]=s[3]*Z+s[7]*J+s[11]*ie+s[15]):(g=s[1],w=s[2],x=s[3],M=s[4],C=s[5],P=s[6],N=s[7],L=s[8],j=s[9],U=s[10],$=s[11],c[0]=f=s[0],c[1]=g,c[2]=w,c[3]=x,c[4]=M,c[5]=C,c[6]=P,c[7]=N,c[8]=L,c[9]=j,c[10]=U,c[11]=$,c[12]=f*Z+M*J+L*ie+s[12],c[13]=g*Z+C*J+j*ie+s[13],c[14]=w*Z+P*J+U*ie+s[14],c[15]=x*Z+N*J+$*ie+s[15]),c},H.N=function(c,s,l){var f=l[0],g=l[1],w=l[2];return c[0]=s[0]*f,c[1]=s[1]*f,c[2]=s[2]*f,c[3]=s[3]*f,c[4]=s[4]*g,c[5]=s[5]*g,c[6]=s[6]*g,c[7]=s[7]*g,c[8]=s[8]*w,c[9]=s[9]*w,c[10]=s[10]*w,c[11]=s[11]*w,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},H.O=function(c,s,l){var f=s[0],g=s[1],w=s[2],x=s[3],M=s[4],C=s[5],P=s[6],N=s[7],L=s[8],j=s[9],U=s[10],$=s[11],Z=s[12],J=s[13],ie=s[14],be=s[15],ce=l[0],he=l[1],De=l[2],Re=l[3];return c[0]=ce*f+he*M+De*L+Re*Z,c[1]=ce*g+he*C+De*j+Re*J,c[2]=ce*w+he*P+De*U+Re*ie,c[3]=ce*x+he*N+De*$+Re*be,c[4]=(ce=l[4])*f+(he=l[5])*M+(De=l[6])*L+(Re=l[7])*Z,c[5]=ce*g+he*C+De*j+Re*J,c[6]=ce*w+he*P+De*U+Re*ie,c[7]=ce*x+he*N+De*$+Re*be,c[8]=(ce=l[8])*f+(he=l[9])*M+(De=l[10])*L+(Re=l[11])*Z,c[9]=ce*g+he*C+De*j+Re*J,c[10]=ce*w+he*P+De*U+Re*ie,c[11]=ce*x+he*N+De*$+Re*be,c[12]=(ce=l[12])*f+(he=l[13])*M+(De=l[14])*L+(Re=l[15])*Z,c[13]=ce*g+he*C+De*j+Re*J,c[14]=ce*w+he*P+De*U+Re*ie,c[15]=ce*x+he*N+De*$+Re*be,c},H.P=st,H.Q=function(c,s){const l={};for(let f=0;f<s.length;f++){const g=s[f];g in c&&(l[g]=c[g])}return l},H.R=Ho,H.S=Tu,H.T=Wp,H.U=gg,H.V=pg,H.W=zn,H.X=Mt,H.Y=Gc,H.Z=ks,H._=y,H.a=W,H.a$=Fi,H.a0=function(c,s){var l,f,g,w;if(!c)return s??{};if(!s)return c;const x=Object.assign({},c);if(s.removeAll&&(x.removeAll=!0),s.remove){const M=new Set(x.remove?x.remove.concat(s.remove):s.remove);x.remove=Array.from(M.values())}if(s.add){const M=x.add?x.add.concat(s.add):s.add,C=new Map(M.map(P=>[P.id,P]));x.add=Array.from(C.values())}if(s.update){const M=new Map(null===(l=x.update)||void 0===l?void 0:l.map(C=>[C.id,C]));for(const C of s.update){const P=null!==(f=M.get(C.id))&&void 0!==f?f:{id:C.id};C.newGeometry&&(P.newGeometry=C.newGeometry),C.addOrUpdateProperties&&(P.addOrUpdateProperties=(null!==(g=P.addOrUpdateProperties)&&void 0!==g?g:[]).concat(C.addOrUpdateProperties)),C.removeProperties&&(P.removeProperties=(null!==(w=P.removeProperties)&&void 0!==w?w:[]).concat(C.removeProperties)),C.removeAllProperties&&(P.removeAllProperties=!0),M.set(C.id,P)}x.update=Array.from(M.values())}return x},H.a1=kf,H.a2=wh,H.a3=25,H.a4=vg,H.a5=c=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(l=>{s.onloadstart=()=>{l(s)};for(const f of c){const g=window.document.createElement("source");Ce(f)||(s.crossOrigin="Anonymous"),g.src=f,s.appendChild(g)}})},H.a6=qe,H.a7=function(){return as++},H.a8=B,H.a9=wd,H.aA=function(c){let s=1/0,l=1/0,f=-1/0,g=-1/0;for(const w of c)s=Math.min(s,w.x),l=Math.min(l,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return[s,l,f,g]},H.aB=24,H.aC=lo,H.aD=function(c,s,l,f,g=!1){if(!l[0]&&!l[1])return[0,0];const w=g?"map"===f?-c.bearingInRadians:0:"viewport"===f?c.bearingInRadians:0;if(w){const x=Math.sin(w),M=Math.cos(w);l=[l[0]*M-l[1]*x,l[0]*x+l[1]*M]}return[g?l[0]:lo(s,l[0],c.zoom),g?l[1]:lo(s,l[1],c.zoom)]},H.aF=w_,H.aG=Iv,H.aH=__,H.aI=Ff,H.aJ=Ti,H.aK=Mf,H.aL=se,H.aM=Ht,H.aN=Mn,H.aO=Vc,H.aP=Si,H.aQ=D_,H.aR=dr,H.aS=Dn,H.aT=function(c){var s=new Oi(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s},H.aU=function(c,s,l){return c[0]=s[0]-l[0],c[1]=s[1]-l[1],c[2]=s[2]-l[2],c},H.aV=function(c,s){var l=s[0],f=s[1],g=s[2],w=l*l+f*f+g*g;return w>0&&(w=1/Math.sqrt(w)),c[0]=s[0]*w,c[1]=s[1]*w,c[2]=s[2]*w,c},H.aW=ri,H.aX=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]},H.aY=function(c,s,l){return c[0]=s[0]*l[0],c[1]=s[1]*l[1],c[2]=s[2]*l[2],c[3]=s[3]*l[3],c},H.aZ=tn,H.a_=function(c,s,l){const f=s[0]*l[0]+s[1]*l[1]+s[2]*l[2];return 0===f?null:(-(c[0]*l[0]+c[1]*l[1]+c[2]*l[2])-l[3])/f},H.aa=gr,H.ab=Ka,H.ac=T_,H.ad=function(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,g,w)=>{const x=g||w;return s[f]=!x||x.toLowerCase(),""}),s["max-age"]){const l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s},H.ae=Ks,H.af=function(c){return Math.pow(2,c)},H.ag=yt,H.ah=Hi,H.ai=85.051129,H.aj=mg,H.ak=function(c){return Math.log(c)/Math.LN2},H.al=function(c){var s=c[0],l=c[1];return s*s+l*l},H.am=function(c,s){const l=[];for(const f in c)f in s||l.push(f);return l},H.an=function(c,s){let l=0,f=0;if("constant"===c.kind)f=c.layoutSize;else if("source"!==c.kind){const{interpolationType:g,minZoom:w,maxZoom:x}=c,M=g?Hi(Ir.interpolationFactor(g,s,w,x),0,1):0;"camera"===c.kind?f=Js.number(c.minSize,c.maxSize,M):l=M}return{uSizeT:l,uSize:f}},H.ap=function(c,{uSize:s,uSizeT:l},{lowerSize:f,upperSize:g}){return"source"===c.kind?f/_c:"composite"===c.kind?Js.number(f/_c,g/_c,l):s},H.aq=function(c,s){var l=s[0],f=s[1],g=s[2],w=s[3],x=s[4],M=s[5],C=s[6],P=s[7],N=s[8],L=s[9],j=s[10],U=s[11],$=s[12],Z=s[13],J=s[14],ie=s[15],be=l*M-f*x,ce=l*C-g*x,he=l*P-w*x,De=f*C-g*M,Re=f*P-w*M,ze=g*P-w*C,tt=N*Z-L*$,We=N*J-j*$,Je=N*ie-U*$,mt=L*J-j*Z,Qe=L*ie-U*Z,Ye=j*ie-U*J,Oe=be*Ye-ce*Qe+he*mt+De*Je-Re*We+ze*tt;return Oe?(c[0]=(M*Ye-C*Qe+P*mt)*(Oe=1/Oe),c[1]=(g*Qe-f*Ye-w*mt)*Oe,c[2]=(Z*ze-J*Re+ie*De)*Oe,c[3]=(j*Re-L*ze-U*De)*Oe,c[4]=(C*Je-x*Ye-P*We)*Oe,c[5]=(l*Ye-g*Je+w*We)*Oe,c[6]=(J*he-$*ze-ie*ce)*Oe,c[7]=(N*ze-j*he+U*ce)*Oe,c[8]=(x*Qe-M*Je+P*tt)*Oe,c[9]=(f*Je-l*Qe-w*tt)*Oe,c[10]=($*Re-Z*he+ie*be)*Oe,c[11]=(L*he-N*Re-U*be)*Oe,c[12]=(M*We-x*mt-C*tt)*Oe,c[13]=(l*mt-f*We+g*tt)*Oe,c[14]=(Z*ce-$*De-J*be)*Oe,c[15]=(N*De-L*ce+j*be)*Oe,c):null},H.ar=Hs,H.as=function(c){return Math.hypot(c[0],c[1])},H.at=function(c){return c[0]=0,c[1]=0,c},H.au=function(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c},H.av=x_,H.aw=rs,H.ax=function(c,s,l,f){const g=s.y-c.y,w=s.x-c.x,x=f.y-l.y,M=f.x-l.x,C=x*w-M*g;if(0===C)return null;const P=(M*(c.y-l.y)-x*(c.x-l.x))/C;return new st(c.x+P*w,c.y+P*g)},H.ay=A_,H.az=j0,H.b=Ca,H.b$=class extends v{},H.b0=function(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c[2]=s[2]*l,c[3]=s[3]*l,c},H.b1=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]},H.b2=vh,H.b3=bh,H.b4=function(c,s,l,f,g){var w,x=1/Math.tan(s/2);return c[0]=x/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=x,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,null!=g&&g!==1/0?(c[10]=(g+f)*(w=1/(f-g)),c[14]=2*g*f*w):(c[10]=-1,c[14]=-2*f),c},H.b5=function(c){var s=new Oi(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},H.b6=function(c,s,l){var f=Math.sin(l),g=Math.cos(l),w=s[0],x=s[1],M=s[2],C=s[3],P=s[4],N=s[5],L=s[6],j=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=w*g+P*f,c[1]=x*g+N*f,c[2]=M*g+L*f,c[3]=C*g+j*f,c[4]=P*g-w*f,c[5]=N*g-x*f,c[6]=L*g-M*f,c[7]=j*g-C*f,c},H.b7=function(c,s,l){var f=Math.sin(l),g=Math.cos(l),w=s[4],x=s[5],M=s[6],C=s[7],P=s[8],N=s[9],L=s[10],j=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=w*g+P*f,c[5]=x*g+N*f,c[6]=M*g+L*f,c[7]=C*g+j*f,c[8]=P*g-w*f,c[9]=N*g-x*f,c[10]=L*g-M*f,c[11]=j*g-C*f,c},H.b8=function(){const c=new Float32Array(16);return yt(c),c},H.b9=function(){const c=new Float64Array(16);return yt(c),c},H.bA=function(c,s){const l=Mr(c,360),f=Mr(s,360),g=f-l,w=f>l?g-360:g+360;return Math.abs(g)<Math.abs(w)?g:w},H.bB=function(c){return c[0]=0,c[1]=0,c[2]=0,c},H.bC=function(c,s,l,f){const g=Math.sqrt(c*c+s*s),w=Math.sqrt(l*l+f*f);c/=g,s/=g,l/=w,f/=w;const x=Math.acos(c*l+s*f);return-s*l+c*f>0?x:-x},H.bD=function(c,s){const l=Mr(c,2*Math.PI),f=Mr(s,2*Math.PI);return Math.min(Math.abs(l-f),Math.abs(l-f+2*Math.PI),Math.abs(l-f-2*Math.PI))},H.bE=function(){const c={},s=xe.$version;for(const l in xe.$root){const f=xe.$root[l];if(f.required){let g=null;g="version"===l?s:"array"===f.type?[]:{},null!=g&&(c[l]=g)}}return c},H.bF=lh,H.bG=pe,H.bH=function c(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(let f=0;f<s.length;f++)if(!c(s[f],l[f]))return!1;return!0}if("object"==typeof s&&null!==s&&null!==l){if("object"!=typeof l||Object.keys(s).length!==Object.keys(l).length)return!1;for(const f in s)if(!c(s[f],l[f]))return!1;return!0}return s===l},H.bI=function(c){c=c.slice();const s=Object.create(null);for(let l=0;l<c.length;l++)s[c[l].id]=c[l];for(let l=0;l<c.length;l++)"ref"in c[l]&&(c[l]=Yt(c[l],s[c[l].ref]));return c},H.bJ=function(c){if("custom"===c.type)return new Sv(c);switch(c.type){case"background":return new wv(c);case"circle":return new Zw(c);case"color-relief":return new Jw(c);case"fill":return new rg(c);case"fill-extrusion":return new ur(c);case"heatmap":return new Yw(c);case"hillshade":return new Qm(c);case"line":return new iv(c);case"raster":return new xv(c);case"symbol":return new Qa(c)}},H.bK=Wr,H.bL=function(c,s){if(!c)return[{command:"setStyle",args:[s]}];let l=[];try{if(!_t(c.version,s.version))return[{command:"setStyle",args:[s]}];_t(c.center,s.center)||l.push({command:"setCenter",args:[s.center]}),_t(c.state,s.state)||l.push({command:"setGlobalState",args:[s.state]}),_t(c.centerAltitude,s.centerAltitude)||l.push({command:"setCenterAltitude",args:[s.centerAltitude]}),_t(c.zoom,s.zoom)||l.push({command:"setZoom",args:[s.zoom]}),_t(c.bearing,s.bearing)||l.push({command:"setBearing",args:[s.bearing]}),_t(c.pitch,s.pitch)||l.push({command:"setPitch",args:[s.pitch]}),_t(c.roll,s.roll)||l.push({command:"setRoll",args:[s.roll]}),_t(c.sprite,s.sprite)||l.push({command:"setSprite",args:[s.sprite]}),_t(c.glyphs,s.glyphs)||l.push({command:"setGlyphs",args:[s.glyphs]}),_t(c.transition,s.transition)||l.push({command:"setTransition",args:[s.transition]}),_t(c.light,s.light)||l.push({command:"setLight",args:[s.light]}),_t(c.terrain,s.terrain)||l.push({command:"setTerrain",args:[s.terrain]}),_t(c.sky,s.sky)||l.push({command:"setSky",args:[s.sky]}),_t(c.projection,s.projection)||l.push({command:"setProjection",args:[s.projection]});const f={},g=[];!function(x,M,C,P){let N;for(N in M=M||{},x=x||{})Object.prototype.hasOwnProperty.call(x,N)&&(Object.prototype.hasOwnProperty.call(M,N)||fr(N,C,P));for(N in M)Object.prototype.hasOwnProperty.call(M,N)&&(Object.prototype.hasOwnProperty.call(x,N)?_t(x[N],M[N])||("geojson"===x[N].type&&"geojson"===M[N].type&&Un(x,M,N)?Ut(C,{command:"setGeoJSONSourceData",args:[N,M[N].data]}):qi(N,M,C,P)):Vn(N,M,C))}(c.sources,s.sources,g,f);const w=[];c.layers&&c.layers.forEach(x=>{"source"in x&&f[x.source]?l.push({command:"removeLayer",args:[x.id]}):w.push(x)}),l=l.concat(g),function(x,M,C){M=M||[];const P=(x=x||[]).map(hn),N=M.map(hn),L=x.reduce(qt,{}),j=M.reduce(qt,{}),U=P.slice(),$=Object.create(null);let Z,J,ie,be,ce;for(let he=0,De=0;he<P.length;he++)Z=P[he],Object.prototype.hasOwnProperty.call(j,Z)?De++:(Ut(C,{command:"removeLayer",args:[Z]}),U.splice(U.indexOf(Z,De),1));for(let he=0,De=0;he<N.length;he++)Z=N[N.length-1-he],U[U.length-1-he]!==Z&&(Object.prototype.hasOwnProperty.call(L,Z)?(Ut(C,{command:"removeLayer",args:[Z]}),U.splice(U.lastIndexOf(Z,U.length-De),1)):De++,be=U[U.length-he],Ut(C,{command:"addLayer",args:[j[Z],be]}),U.splice(U.length-he,0,Z),$[Z]=!0);for(let he=0;he<N.length;he++)if(Z=N[he],J=L[Z],ie=j[Z],!$[Z]&&!_t(J,ie))if(_t(J.source,ie.source)&&_t(J["source-layer"],ie["source-layer"])&&_t(J.type,ie.type)){for(ce in rn(J.layout,ie.layout,C,Z,null,"setLayoutProperty"),rn(J.paint,ie.paint,C,Z,null,"setPaintProperty"),_t(J.filter,ie.filter)||Ut(C,{command:"setFilter",args:[Z,ie.filter]}),_t(J.minzoom,ie.minzoom)&&_t(J.maxzoom,ie.maxzoom)||Ut(C,{command:"setLayerZoomRange",args:[Z,ie.minzoom,ie.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,ce)&&"layout"!==ce&&"paint"!==ce&&"filter"!==ce&&"metadata"!==ce&&"minzoom"!==ce&&"maxzoom"!==ce&&(0===ce.indexOf("paint.")?rn(J[ce],ie[ce],C,Z,ce.slice(6),"setPaintProperty"):_t(J[ce],ie[ce])||Ut(C,{command:"setLayerProperty",args:[Z,ce,ie[ce]]}));for(ce in ie)Object.prototype.hasOwnProperty.call(ie,ce)&&!Object.prototype.hasOwnProperty.call(J,ce)&&"layout"!==ce&&"paint"!==ce&&"filter"!==ce&&"metadata"!==ce&&"minzoom"!==ce&&"maxzoom"!==ce&&(0===ce.indexOf("paint.")?rn(J[ce],ie[ce],C,Z,ce.slice(6),"setPaintProperty"):_t(J[ce],ie[ce])||Ut(C,{command:"setLayerProperty",args:[Z,ce,ie[ce]]}))}else Ut(C,{command:"removeLayer",args:[Z]}),be=U[U.lastIndexOf(Z)+1],Ut(C,{command:"addLayer",args:[ie,be]})}(w,s.layers,l)}catch(f){console.warn("Unable to compute style diff:",f),l=[{command:"setStyle",args:[s]}]}return l},H.bM=function(c){const s=[],l=c.id;return void 0===l&&s.push({message:`layers.${l}: missing required property "id"`}),void 0===c.render&&s.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&"2d"!==c.renderingMode&&"3d"!==c.renderingMode&&s.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),s},H.bN=Hl,H.bO=Uc,H.bP=class extends eo{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},H.bQ=_r,H.bR=class extends eo{constructor(c,s){super(c,s),this.current=$o}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},H.bS=Yi,H.bT=class extends eo{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},H.bU=class extends eo{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},H.bV=nt,H.bW=function(c,s){var l=Math.sin(s),f=Math.cos(s);return c[0]=f,c[1]=l,c[2]=0,c[3]=-l,c[4]=f,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},H.bX=function(c,s,l){var f=s[0],g=s[1],w=s[2];return c[0]=f*l[0]+g*l[3]+w*l[6],c[1]=f*l[1]+g*l[4]+w*l[7],c[2]=f*l[2]+g*l[5]+w*l[8],c},H.bY=function(c,s,l,f,g,w,x){var M=1/(s-l),C=1/(f-g),P=1/(w-x);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*P,c[11]=0,c[12]=(s+l)*M,c[13]=(g+f)*C,c[14]=(x+w)*P,c[15]=1,c},H.bZ=class extends eo{constructor(c,s){super(c,s),this.current=new Array}set(c){if(c!=this.current){this.current=c;const s=new Float32Array(4*c.length);for(let l=0;l<c.length;l++)s[4*l]=c[l].r,s[4*l+1]=c[l].g,s[4*l+2]=c[l].b,s[4*l+3]=c[l].a;this.gl.uniform4fv(this.location,s)}}},H.b_=class extends eo{constructor(c,s){super(c,s),this.current=new Array}set(c){if(c!=this.current){this.current=c;const s=new Float32Array(c);this.gl.uniform1fv(this.location,s)}}},H.ba=function(){return new Float64Array(16)},H.bb=function(c,s,l){const f=new Float64Array(4);return xo(f,c,s-90,l),f},H.bc=function(c,s,l,f){var g,w,x,M,C,P=s[0],N=s[1],L=s[2],j=s[3],U=l[0],$=l[1],Z=l[2],J=l[3];return(w=P*U+N*$+L*Z+j*J)<0&&(w=-w,U=-U,$=-$,Z=-Z,J=-J),1-w>gi?(g=Math.acos(w),x=Math.sin(g),M=Math.sin((1-f)*g)/x,C=Math.sin(f*g)/x):(M=1-f,C=f),c[0]=M*P+C*U,c[1]=M*N+C*$,c[2]=M*L+C*Z,c[3]=M*j+C*J,c},H.bd=function(c){const s=new Float64Array(9);var l,f,g,w,x,M,C,P,N,L,j,U,$,Z,J,ie,be,ce;L=(g=(f=c)[0])*(C=g+g),j=(w=f[1])*C,$=(x=f[2])*C,Z=x*(P=w+w),ie=(M=f[3])*C,be=M*P,ce=M*(N=x+x),(l=s)[0]=1-(U=w*P)-(J=x*N),l[3]=j-ce,l[6]=$+be,l[1]=j+ce,l[4]=1-L-J,l[7]=Z-ie,l[2]=$-be,l[5]=Z+ie,l[8]=1-L-U;const he=Si(-Math.asin(Hi(s[2],-1,1)));let De,Re;return Math.hypot(s[5],s[8])<.001?(De=0,Re=-Si(Math.atan2(s[3],s[4]))):(De=Si(0===s[5]&&0===s[8]?0:Math.atan2(s[5],s[8])),Re=Si(0===s[1]&&0===s[0]?0:Math.atan2(s[1],s[0]))),{roll:De,pitch:he+90,bearing:Re}},H.be=function(c,s){return c.roll==s.roll&&c.pitch==s.pitch&&c.bearing==s.bearing},H.bf=nn,H.bg=ms,H.bh=Su,H.bi=pc,H.bj=Ya,H.bk=$l,H.bl=qs,H.bm=or,H.bn=function(c,s,l,f,g){return $l(f,g,Hi((c-s)/(l-s),0,1))},H.bo=Mr,H.bp=function(){return new Float64Array(3)},H.bq=function(c,s,l,f){return c[0]=s[0]+l[0]*f,c[1]=s[1]+l[1]*f,c[2]=s[2]+l[2]*f,c},H.br=xo,H.bs=function(c,s,l){var f=l[0],g=l[1],w=l[2],x=s[0],M=s[1],C=s[2],P=g*C-w*M,N=w*x-f*C,L=f*M-g*x,j=g*L-w*N,U=w*P-f*L,$=f*N-g*P,Z=2*l[3];return N*=Z,L*=Z,U*=2,$*=2,c[0]=x+(P*=Z)+(j*=2),c[1]=M+N+U,c[2]=C+L+$,c},H.bt=function(c,s,l){const f=(g=[c[0],c[1],c[2],s[0],s[1],s[2],l[0],l[1],l[2]])[0]*((N=g[8])*(x=g[4])-(M=g[5])*(P=g[7]))+g[1]*(-N*(w=g[3])+M*(C=g[6]))+g[2]*(P*w-x*C);var g,w,x,M,C,P,N;if(0===f)return null;const L=ri([],[s[0],s[1],s[2]],[l[0],l[1],l[2]]),j=ri([],[l[0],l[1],l[2]],[c[0],c[1],c[2]]),U=ri([],[c[0],c[1],c[2]],[s[0],s[1],s[2]]),$=dr([],L,-c[3]);return Dn($,$,dr([],j,-s[3])),Dn($,$,dr([],U,-l[3])),dr($,$,1/f),$},H.bu=Ev,H.bv=function(){return new Float64Array(4)},H.bw=function(c,s,l,f){var g=[],w=[];return g[0]=s[0]-l[0],g[1]=s[1]-l[1],g[2]=s[2]-l[2],w[0]=g[0]*Math.cos(f)-g[1]*Math.sin(f),w[1]=g[0]*Math.sin(f)+g[1]*Math.cos(f),w[2]=g[2],c[0]=w[0]+l[0],c[1]=w[1]+l[1],c[2]=w[2]+l[2],c},H.bx=function(c,s,l,f){var g=[],w=[];return g[0]=s[0]-l[0],g[1]=s[1]-l[1],g[2]=s[2]-l[2],w[0]=g[0],w[1]=g[1]*Math.cos(f)-g[2]*Math.sin(f),w[2]=g[1]*Math.sin(f)+g[2]*Math.cos(f),c[0]=w[0]+l[0],c[1]=w[1]+l[1],c[2]=w[2]+l[2],c},H.by=function(c,s,l,f){var g=[],w=[];return g[0]=s[0]-l[0],g[1]=s[1]-l[1],g[2]=s[2]-l[2],w[0]=g[2]*Math.sin(f)+g[0]*Math.cos(f),w[1]=g[1],w[2]=g[2]*Math.cos(f)-g[0]*Math.sin(f),c[0]=w[0]+l[0],c[1]=w[1]+l[1],c[2]=w[2]+l[2],c},H.bz=function(c,s,l){var f=Math.sin(l),g=Math.cos(l),w=s[0],x=s[1],M=s[2],C=s[3],P=s[8],N=s[9],L=s[10],j=s[11];return s!==c&&(c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=w*g-P*f,c[1]=x*g-N*f,c[2]=M*g-L*f,c[3]=C*g-j*f,c[8]=w*f+P*g,c[9]=x*f+N*g,c[10]=M*f+L*g,c[11]=C*f+j*g,c},H.c=_e,H.c0=_x,H.c1=class extends u{},H.c2=Xm,H.c3=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},H.c4=G0,H.c5=function(c,s,l){var f=s[0],g=s[1],w=s[2],x=l[3]*f+l[7]*g+l[11]*w+l[15];return c[0]=(l[0]*f+l[4]*g+l[8]*w+l[12])/(x=x||1),c[1]=(l[1]*f+l[5]*g+l[9]*w+l[13])/x,c[2]=(l[2]*f+l[6]*g+l[10]*w+l[14])/x,c},H.c6=class extends dd{},H.c7=class extends R{},H.c8=function(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]&&c[3]===s[3]&&c[4]===s[4]&&c[5]===s[5]&&c[6]===s[6]&&c[7]===s[7]&&c[8]===s[8]&&c[9]===s[9]&&c[10]===s[10]&&c[11]===s[11]&&c[12]===s[12]&&c[13]===s[13]&&c[14]===s[14]&&c[15]===s[15]},H.c9=function(c,s){var l=c[0],f=c[1],g=c[2],w=c[3],x=c[4],M=c[5],C=c[6],P=c[7],N=c[8],L=c[9],j=c[10],U=c[11],$=c[12],Z=c[13],J=c[14],ie=c[15],be=s[0],ce=s[1],he=s[2],De=s[3],Re=s[4],ze=s[5],tt=s[6],We=s[7],Je=s[8],mt=s[9],Qe=s[10],Ye=s[11],Oe=s[12],Tt=s[13],kt=s[14],vt=s[15];return Math.abs(l-be)<=gi*Math.max(1,Math.abs(l),Math.abs(be))&&Math.abs(f-ce)<=gi*Math.max(1,Math.abs(f),Math.abs(ce))&&Math.abs(g-he)<=gi*Math.max(1,Math.abs(g),Math.abs(he))&&Math.abs(w-De)<=gi*Math.max(1,Math.abs(w),Math.abs(De))&&Math.abs(x-Re)<=gi*Math.max(1,Math.abs(x),Math.abs(Re))&&Math.abs(M-ze)<=gi*Math.max(1,Math.abs(M),Math.abs(ze))&&Math.abs(C-tt)<=gi*Math.max(1,Math.abs(C),Math.abs(tt))&&Math.abs(P-We)<=gi*Math.max(1,Math.abs(P),Math.abs(We))&&Math.abs(N-Je)<=gi*Math.max(1,Math.abs(N),Math.abs(Je))&&Math.abs(L-mt)<=gi*Math.max(1,Math.abs(L),Math.abs(mt))&&Math.abs(j-Qe)<=gi*Math.max(1,Math.abs(j),Math.abs(Qe))&&Math.abs(U-Ye)<=gi*Math.max(1,Math.abs(U),Math.abs(Ye))&&Math.abs($-Oe)<=gi*Math.max(1,Math.abs($),Math.abs(Oe))&&Math.abs(Z-Tt)<=gi*Math.max(1,Math.abs(Z),Math.abs(Tt))&&Math.abs(J-kt)<=gi*Math.max(1,Math.abs(J),Math.abs(kt))&&Math.abs(ie-vt)<=gi*Math.max(1,Math.abs(ie),Math.abs(vt))},H.cA=function(c,s){W.REGISTERED_PROTOCOLS[c]=s},H.cB=function(c){delete W.REGISTERED_PROTOCOLS[c]},H.cC=function(c,s){const l={};for(let g=0;g<c.length;g++){const w=s&&s[c[g].id]||Di(c[g]);s&&(s[c[g].id]=w);let x=l[w];x||(x=l[w]=[]),x.push(c[g])}const f=[];for(const g in l)f.push(l[g]);return f},H.cD=Ze,H.cE=C_,H.cF=Mv,H.cG=f_,H.cH=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=pn/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0],l=s.layout,f=s._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new ui(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new ui(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new ui(18))};if("composite"===c.bucket.textSizeData.kind){const{minZoom:P,maxZoom:N}=c.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new ui(P),c.canonical),f["text-size"].possiblyEvaluate(new ui(N),c.canonical)]}if("composite"===c.bucket.iconSizeData.kind){const{minZoom:P,maxZoom:N}=c.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new ui(P),c.canonical),f["icon-size"].possiblyEvaluate(new ui(N),c.canonical)]}const w=24*l.get("text-line-height"),x="viewport"!==l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),M=l.get("text-keep-upright"),C=l.get("text-size");for(const P of c.bucket.features){const N=l.get("text-font").evaluate(P,{},c.canonical).join(","),L=C.evaluate(P,{},c.canonical),j=g.layoutTextSize.evaluate(P,{},c.canonical),U=g.layoutIconSize.evaluate(P,{},c.canonical),$={horizontal:{},vertical:void 0},Z=P.text;let J,ie=[0,0];if(Z){const he=Z.toString(),De=24*l.get("text-letter-spacing").evaluate(P,{},c.canonical),Re=ff(he)?De:0,ze=l.get("text-anchor").evaluate(P,{},c.canonical),tt=kx(s,P,c.canonical);if(!tt){const Qe=l.get("text-radial-offset").evaluate(P,{},c.canonical);ie=Qe?wg(ze,[24*Qe,N_]):l.get("text-offset").evaluate(P,{},c.canonical).map(Ye=>24*Ye)}let We=x?"center":l.get("text-justify").evaluate(P,{},c.canonical);const Je="point"===l.get("symbol-placement")?24*l.get("text-max-width").evaluate(P,{},c.canonical):1/0,mt=()=>{c.bucket.allowVerticalPlacement&&ac(he)&&($.vertical=Pf(Z,c.glyphMap,c.glyphPositions,c.imagePositions,N,Je,w,ze,"left",Re,ie,H.ao.vertical,!0,j,L))};if(!x&&tt){const Qe=new Set;if("auto"===We)for(let Oe=0;Oe<tt.values.length;Oe+=2)Qe.add(Iv(tt.values[Oe]));else Qe.add(We);let Ye=!1;for(const Oe of Qe)if(!$.horizontal[Oe])if(Ye)$.horizontal[Oe]=$.horizontal[0];else{const Tt=Pf(Z,c.glyphMap,c.glyphPositions,c.imagePositions,N,Je,w,"center",Oe,Re,ie,H.ao.horizontal,!1,j,L);Tt&&($.horizontal[Oe]=Tt,Ye=1===Tt.positionedLines.length)}mt()}else{"auto"===We&&(We=Iv(ze));const Qe=Pf(Z,c.glyphMap,c.glyphPositions,c.imagePositions,N,Je,w,ze,We,Re,ie,H.ao.horizontal,!1,j,L);Qe&&($.horizontal[We]=Qe),mt(),ac(he)&&x&&M&&($.vertical=Pf(Z,c.glyphMap,c.glyphPositions,c.imagePositions,N,Je,w,ze,We,Re,ie,H.ao.vertical,!1,j,L))}}let be=!1;if(P.icon&&P.icon.name){const he=c.imageMap[P.icon.name];he&&(J=_v(c.imagePositions[P.icon.name],l.get("icon-offset").evaluate(P,{},c.canonical),l.get("icon-anchor").evaluate(P,{},c.canonical)),be=!!he.sdf,void 0===c.bucket.sdfIcons?c.bucket.sdfIcons=be:c.bucket.sdfIcons!==be&&nr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(he.pixelRatio!==c.bucket.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(c.bucket.iconsNeedLinear=!0))}const ce=Av($.horizontal)||$.vertical;c.bucket.iconsInText=!!ce&&ce.iconsInText,(ce||J)&&Ox(c.bucket,P,$,J,c.imageMap,g,j,U,ie,be,c.canonical,c.subdivisionGranularity)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},H.cI=Cf,H.cJ=ig,H.cK=mh,H.cL=r_,H.cM=u_,H.cN=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return 0===c.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},H.cO=function(c,s,l,f,g){return y(this,void 0,void 0,function*(){if(Mt())try{return yield Gc(c,s,l,f,g)}catch{}return function(w,x,M,C,P){const N=w.width,L=w.height;cn&&Ws||(cn=new OffscreenCanvas(N,L),Ws=cn.getContext("2d",{willReadFrequently:!0})),cn.width=N,cn.height=L,Ws.drawImage(w,0,0,N,L);const j=Ws.getImageData(x,M,C,P);return Ws.clearRect(0,0,N,L),j.data}(c,s,l,f,g)})},H.cP=fo,H.cQ=Gs,H.cR=i_,H.cS=Eu,H.cT=li,H.cU=function(c,s){const l=new Map;if(null!=c)if("Feature"===c.type)l.set(Sd(c,s),c);else for(const f of c.features)l.set(Sd(f,s),f);return l},H.cV=function(c,s){if(null==c)return!0;if("Feature"===c.type)return null!=Sd(c,s);if("FeatureCollection"===c.type){const l=new Set;for(const f of c.features){const g=Sd(f,s);if(null==g||l.has(g))return!1;l.add(g)}return!0}return!1},H.cW=function(c,s,l){var f,g,w,x;if(s.removeAll&&c.clear(),s.remove)for(const M of s.remove)c.delete(M);if(s.add)for(const M of s.add){const C=Sd(M,l);null!=C&&c.set(C,M)}if(s.update)for(const M of s.update){let C=c.get(M.id);if(null==C)continue;const P=!M.removeAllProperties&&((null===(f=M.removeProperties)||void 0===f?void 0:f.length)>0||(null===(g=M.addOrUpdateProperties)||void 0===g?void 0:g.length)>0);if((M.newGeometry||M.removeAllProperties||P)&&(C=Object.assign({},C),c.set(M.id,C),P&&(C.properties=Object.assign({},C.properties))),M.newGeometry&&(C.geometry=M.newGeometry),M.removeAllProperties)C.properties={};else if((null===(w=M.removeProperties)||void 0===w?void 0:w.length)>0)for(const N of M.removeProperties)Object.prototype.hasOwnProperty.call(C.properties,N)&&delete C.properties[N];if((null===(x=M.addOrUpdateProperties)||void 0===x?void 0:x.length)>0)for(const{key:N,value:L}of M.addOrUpdateProperties)C.properties[N]=L}},H.cX=Uo,H.ca=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},H.cb=c=>"symbol"===c.type,H.cc=c=>"circle"===c.type,H.cd=c=>"heatmap"===c.type,H.ce=c=>"line"===c.type,H.cf=c=>"fill"===c.type,H.cg=c=>"fill-extrusion"===c.type,H.ch=c=>"hillshade"===c.type,H.ci=c=>"color-relief"===c.type,H.cj=c=>"raster"===c.type,H.ck=c=>"background"===c.type,H.cl=c=>"custom"===c.type,H.cm=So,H.cn=function(c,s,l){const f=qr(s.x-l.x,s.y-l.y),g=qr(c.x-l.x,c.y-l.y);var w,x;return Si(Math.atan2(f[0]*g[1]-f[1]*g[0],(w=f)[0]*(x=g)[0]+w[1]*x[1]))},H.co=os,H.cp=function(c,s){return Ia[s]&&(c instanceof MouseEvent||c instanceof WheelEvent)},H.cq=function(c,s){return Ta[s]&&"touches"in c},H.cr=function(c){return Ta[c]||Ia[c]},H.cs=function(c,s,l){var f=s[0],g=s[1];return c[0]=l[0]*f+l[4]*g+l[12],c[1]=l[1]*f+l[5]*g+l[13],c},H.ct=function(c,s){const{x:l,y:f}=kf.fromLngLat(s);return!(c<0||c>25||f<0||f>=1||l<0||l>=1)},H.cu=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},H.cv=class extends cc{},H.cw=Sg,H.cy=function(c){return c.message===ql},H.cz=ae,H.d=Ce,H.e=ss,H.f=c=>y(void 0,void 0,void 0,function*(){if(0===c.byteLength)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(s)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),H.g=K,H.h=c=>new Promise((s,l)=>{const f=new Image;f.onload=()=>{s(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=ls})},f.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(c)],{type:"image/png"});f.src=c.byteLength?URL.createObjectURL(g):ls}),H.i=ko,H.j=(c,s)=>we(ss(c,{type:"json"}),s),H.k=Fe,H.l=Ve,H.m=we,H.n=(c,s)=>we(ss(c,{type:"arrayBuffer"}),s),H.o=function(c){return new u_(c).readFields(d_,[])},H.p=qo,H.q=fc,H.r=St,H.s=Zs,H.t=ld,H.u=an,H.v=xe,H.w=nr,H.x=Hm,H.y=la,H.z=Ci}),jc("worker",0,function(H){class y{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,K){for(const ae of W){this._layerConfigs[ae.id]=ae;const pe=this._layers[ae.id]=H.bJ(ae);pe._featureFilter=H.aa(pe.filter),this.keyCache[ae.id]&&delete this.keyCache[ae.id]}for(const ae of K)delete this.keyCache[ae],delete this._layerConfigs[ae],delete this._layers[ae];this.familiesBySource={};const X=H.cC(Object.values(this._layerConfigs),this.keyCache);for(const ae of X){const pe=ae.map(Fe=>this._layers[Fe.id]),we=pe[0];if("none"===we.visibility)continue;const Ce=we.source||"";let ye=this.familiesBySource[Ce];ye||(ye=this.familiesBySource[Ce]={});const Ne=we.sourceLayer||"_geojsonTileLayer";let Ve=ye[Ne];Ve||(Ve=ye[Ne]=[]),Ve.push(pe)}}}class st{constructor(W){const K={},X=[];for(const Ce in W){const ye=W[Ce],Ne=K[Ce]={};for(const Ve in ye){const Fe=ye[+Ve];if(!Fe||0===Fe.bitmap.width||0===Fe.bitmap.height)continue;const pt={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};X.push(pt),Ne[Ve]={rect:pt,metrics:Fe.metrics}}}const{w:ae,h:pe}=H.p(X),we=new H.q({width:ae||1,height:pe||1});for(const Ce in W){const ye=W[Ce];for(const Ne in ye){const Ve=ye[+Ne];if(!Ve||0===Ve.bitmap.width||0===Ve.bitmap.height)continue;const Fe=K[Ce][Ne].rect;H.q.copy(Ve.bitmap,we,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},Ve.bitmap)}}this.image=we,this.positions=K}}H.cD("GlyphAtlas",st);class Gs{constructor(W){this.tileID=new H.Z(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[],this.globalState=W.globalState}parse(W,K,X,ae,pe){return H._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new H.a8;const we=new H.cE(Object.keys(W.layers).sort()),Ce=new H.cF(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];const ye={},Ne={featureIndex:Ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:X,subdivisionGranularity:pe},Ve=K.familiesBySource[this.source];for(const rn in Ve){const hn=W.layers[rn];if(!hn)continue;1===hn.version&&H.w(`Vector tile source "${this.source}" layer "${rn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qt=we.encode(rn),qe=[];for(let Zr=0;Zr<hn.length;Zr++){const Ei=hn.feature(Zr),dl=Ce.getId(Ei,rn);qe.push({feature:Ei,id:dl,index:Zr,sourceLayerIndex:qt})}for(const Zr of Ve[rn]){const Ei=Zr[0];Ei.source!==this.source&&H.w(`layer.source = ${Ei.source} does not equal this.source = ${this.source}`),Ei.minzoom&&this.zoom<Math.floor(Ei.minzoom)||Ei.maxzoom&&this.zoom>=Ei.maxzoom||"none"!==Ei.visibility&&(Fr(Zr,this.zoom,X),(ye[Ei.id]=Ei.createBucket({index:Ce.bucketLayerIDs.length,layers:Zr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qt,sourceID:this.source,globalState:this.globalState})).populate(qe,Ne,this.tileID.canonical),Ce.bucketLayerIDs.push(Zr.map(dl=>dl.id)))}}const Fe=H.bN(Ne.glyphDependencies,rn=>Object.keys(rn).map(Number));this.inFlightDependencies.forEach(rn=>rn?.abort()),this.inFlightDependencies=[];let pt=Promise.resolve({});if(Object.keys(Fe).length){const rn=new AbortController;this.inFlightDependencies.push(rn),pt=ae.sendAsync({type:"GG",data:{stacks:Fe,source:this.source,tileID:this.tileID,type:"glyphs"}},rn)}const xe=Object.keys(Ne.iconDependencies);let Nt=Promise.resolve({});if(xe.length){const rn=new AbortController;this.inFlightDependencies.push(rn),Nt=ae.sendAsync({type:"GI",data:{icons:xe,source:this.source,tileID:this.tileID,type:"icons"}},rn)}const Yt=Object.keys(Ne.patternDependencies);let _t=Promise.resolve({});if(Yt.length){const rn=new AbortController;this.inFlightDependencies.push(rn),_t=ae.sendAsync({type:"GI",data:{icons:Yt,source:this.source,tileID:this.tileID,type:"patterns"}},rn)}const[Ut,Vn,fr]=yield Promise.all([pt,Nt,_t]),qi=new st(Ut),Un=new H.cG(Vn,fr);for(const rn in ye){const hn=ye[rn];hn instanceof H.a9?(Fr(hn.layers,this.zoom,X),H.cH({bucket:hn,glyphMap:Ut,glyphPositions:qi.positions,imageMap:Vn,imagePositions:Un.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ne.subdivisionGranularity})):hn.hasPattern&&(hn instanceof H.cI||hn instanceof H.cJ||hn instanceof H.cK)&&(Fr(hn.layers,this.zoom,X),hn.addFeatures(Ne,this.tileID.canonical,Un.patternPositions))}return this.status="done",{buckets:Object.values(ye).filter(rn=>!rn.isEmpty()),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qi.image,imageAtlas:Un,glyphMap:this.returnDependencies?Ut:null,iconMap:this.returnDependencies?Vn:null,glyphPositions:this.returnDependencies?qi.positions:null}})}}function Fr(_e,W,K){const X=new H.F(W);for(const ae of _e)ae.recalculate(X,K)}class $s{constructor(W,K,X){this.actor=W,this.layerIndex=K,this.availableImages=X,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,K){return H._(this,void 0,void 0,function*(){const X=yield H.n(W.request,K);try{return{vectorTile:new H.cL(new H.cM(X.data)),rawData:X.data,cacheControl:X.cacheControl,expires:X.expires}}catch(ae){const pe=new Uint8Array(X.data);let we=`Unable to parse the tile at ${W.request.url}, `;throw we+=31===pe[0]&&139===pe[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.message}`,new Error(we)}})}loadTile(W){return H._(this,void 0,void 0,function*(){const K=W.uid,X=!!(W&&W.request&&W.request.collectResourceTiming)&&new H.cN(W.request),ae=new Gs(W);this.loading[K]=ae;const pe=new AbortController;ae.abort=pe;try{const we=yield this.loadVectorTile(W,pe);if(delete this.loading[K],!we)return null;const Ce=we.rawData,ye={};we.expires&&(ye.expires=we.expires),we.cacheControl&&(ye.cacheControl=we.cacheControl);const Ne={};if(X){const Fe=X.finish();Fe&&(Ne.resourceTiming=JSON.parse(JSON.stringify(Fe)))}ae.vectorTile=we.vectorTile;const Ve=ae.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[K]=ae,this.fetching[K]={rawTileData:Ce,cacheControl:ye,resourceTiming:Ne};try{const Fe=yield Ve;return H.e({rawTileData:Ce.slice(0)},Fe,ye,Ne)}finally{delete this.fetching[K]}}catch(we){throw delete this.loading[K],ae.status="done",this.loaded[K]=ae,we}})}reloadTile(W){return H._(this,void 0,void 0,function*(){const K=W.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const X=this.loaded[K];if(X.showCollisionBoxes=W.showCollisionBoxes,X.globalState=W.globalState,"parsing"===X.status){const ae=yield X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let pe;if(this.fetching[K]){const{rawTileData:we,cacheControl:Ce,resourceTiming:ye}=this.fetching[K];delete this.fetching[K],pe=H.e({rawTileData:we.slice(0)},ae,Ce,ye)}else pe=ae;return pe}if("done"===X.status&&X.vectorTile)return X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)})}abortTile(W){return H._(this,void 0,void 0,function*(){const K=this.loading,X=W.uid;K&&K[X]&&K[X].abort&&(K[X].abort.abort(),delete K[X])})}removeTile(W){return H._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class wt{constructor(){this.loaded={}}loadTile(W){return H._(this,void 0,void 0,function*(){const{uid:K,encoding:X,rawImageData:ae,redFactor:pe,greenFactor:we,blueFactor:Ce,baseShift:ye}=W,Ne=ae.width+2,Ve=ae.height+2,Fe=H.b(ae)?new H.R({width:Ne,height:Ve},yield H.cO(ae,-1,-1,Ne,Ve)):ae,pt=new H.cP(K,Fe,X,pe,we,Ce,ye);return this.loaded=this.loaded||{},this.loaded[K]=pt,pt})}removeTile(W){const K=this.loaded,X=W.uid;K&&K[X]&&delete K[X]}}var Pe,No,bo=function(){if(No)return Pe;function _e(K,X){if(0!==K.length){W(K[0],X);for(var ae=1;ae<K.length;ae++)W(K[ae],!X)}}function W(K,X){for(var ae=0,pe=0,we=0,Ce=K.length,ye=Ce-1;we<Ce;ye=we++){var Ne=(K[we][0]-K[ye][0])*(K[ye][1]+K[we][1]),Ve=ae+Ne;pe+=Math.abs(ae)>=Math.abs(Ne)?ae-Ve+Ne:Ne-Ve+ae,ae=Ve}ae+pe>=0!=!!X&&K.reverse()}return No=1,Pe=function K(X,ae){var pe,we=X&&X.type;if("FeatureCollection"===we)for(pe=0;pe<X.features.length;pe++)K(X.features[pe],ae);else if("GeometryCollection"===we)for(pe=0;pe<X.geometries.length;pe++)K(X.geometries[pe],ae);else if("Feature"===we)K(X.geometry,ae);else if("Polygon"===we)_e(X.coordinates,ae);else if("MultiPolygon"===we)for(pe=0;pe<X.coordinates.length;pe++)_e(X.coordinates[pe],ae);return X}}(),zn=H.cQ(bo);class Mt extends H.cS{constructor(W,K){super(new H.cM,0,K,[],[]),this.feature=W,this.type=W.type,this.properties=W.tags?W.tags:{},"id"in W&&("string"==typeof W.id?this.id=parseInt(W.id,10):"number"!=typeof W.id||isNaN(W.id)||(this.id=W.id))}loadGeometry(){const W=[],K=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const X of K){const ae=[];for(const pe of X)ae.push(new H.P(pe[0],pe[1]));W.push(ae)}return W}}class gi extends H.cR{constructor(W,K){super(new H.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=K?K.version:1,this.extent=K?K.extent:4096,this.length=W.length,this.features=W}feature(W){return new Mt(this.features[W],this.extent)}}function Oi(_e,W){W.writeVarintField(15,_e.version||1),W.writeStringField(1,_e.name||""),W.writeVarintField(5,_e.extent||4096);const K={keys:[],values:[],keycache:{},valuecache:{}};for(let pe=0;pe<_e.length;pe++)K.feature=_e.feature(pe),W.writeMessage(2,nt,K);const X=K.keys;for(const pe of X)W.writeStringField(3,pe);const ae=K.values;for(const pe of ae)W.writeMessage(4,Dn,pe)}function nt(_e,W){if(!_e.feature)return;const K=_e.feature;void 0!==K.id&&W.writeVarintField(1,K.id),W.writeMessage(2,yt,_e),W.writeVarintField(3,K.type),W.writeMessage(4,jn,K)}function yt(_e,W){for(const K in _e.feature?.properties){let X=_e.feature.properties[K],ae=_e.keycache[K];if(null===X)continue;void 0===ae&&(_e.keys.push(K),ae=_e.keys.length-1,_e.keycache[K]=ae),W.writeVarint(ae),"string"!=typeof X&&"boolean"!=typeof X&&"number"!=typeof X&&(X=JSON.stringify(X));const pe=typeof X+":"+X;let we=_e.valuecache[pe];void 0===we&&(_e.values.push(X),we=_e.values.length-1,_e.valuecache[pe]=we),W.writeVarint(we)}}function ht(_e,W){return(W<<3)+(7&_e)}function tn(_e){return _e<<1^_e>>31}function jn(_e,W){const K=_e.loadGeometry(),X=_e.type;let ae=0,pe=0;for(const we of K){let Ce=1;1===X&&(Ce=we.length),W.writeVarint(ht(1,Ce));const ye=3===X?we.length-1:we.length;for(let Ne=0;Ne<ye;Ne++){1===Ne&&1!==X&&W.writeVarint(ht(2,ye-1));const Ve=we[Ne].x-ae,Fe=we[Ne].y-pe;W.writeVarint(tn(Ve)),W.writeVarint(tn(Fe)),ae+=Ve,pe+=Fe}3===_e.type&&W.writeVarint(ht(7,1))}}function Dn(_e,W){const K=typeof _e;"string"===K?W.writeStringField(1,_e):"boolean"===K?W.writeBooleanField(7,_e):"number"===K&&(_e%1!=0?W.writeDoubleField(3,_e):_e<0?W.writeSVarintField(6,_e):W.writeVarintField(5,_e))}const dr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},ri=Math.fround||(An=new Float32Array(1),_e=>(An[0]=+_e,An[0]));var An;class Fi{constructor(W){this.options=Object.assign(Object.create(dr),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:K,minZoom:X,maxZoom:ae}=this.options;K&&console.time("total time");const pe=`prepare ${W.length} points`;K&&console.time(pe),this.points=W;const we=[];for(let ye=0;ye<W.length;ye++){const Ne=W[ye];if(!Ne.geometry)continue;const[Ve,Fe]=Ne.geometry.coordinates,pt=ri(xo(Ve)),xe=ri(Hs(Fe));we.push(pt,xe,1/0,ye,-1,1),this.options.reduce&&we.push(0)}let Ce=this.trees[ae+1]=this._createTree(we);K&&console.timeEnd(pe);for(let ye=ae;ye>=X;ye--){const Ne=+Date.now();Ce=this.trees[ye]=this._createTree(this._cluster(Ce,ye)),K&&console.log("z%d: %d clusters in %dms",ye,Ce.numItems,+Date.now()-Ne)}return K&&console.timeEnd("total time"),this}getClusters(W,K){let X=((W[0]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,W[1]));let pe=180===W[2]?180:((W[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)X=-180,pe=180;else if(X>pe){const Fe=this.getClusters([X,ae,180,we],K),pt=this.getClusters([-180,ae,pe,we],K);return Fe.concat(pt)}const Ce=this.trees[this._limitZoom(K)],ye=Ce.range(xo(X),Hs(we),xo(pe),Hs(ae)),Ne=Ce.data,Ve=[];for(const Fe of ye){const pt=this.stride*Fe;Ve.push(Ne[pt+5]>1?rs(Ne,pt,this.clusterProps):this.points[Ne[pt+3]])}return Ve}getChildren(W){const K=this._getOriginId(W),X=this._getOriginZoom(W),ae="No cluster with the specified id.",pe=this.trees[X];if(!pe)throw new Error(ae);const we=pe.data;if(K*this.stride>=we.length)throw new Error(ae);const Ce=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ye=pe.within(we[K*this.stride],we[K*this.stride+1],Ce),Ne=[];for(const Ve of ye){const Fe=Ve*this.stride;we[Fe+4]===W&&Ne.push(we[Fe+5]>1?rs(we,Fe,this.clusterProps):this.points[we[Fe+3]])}if(0===Ne.length)throw new Error(ae);return Ne}getLeaves(W,K,X){const ae=[];return this._appendLeaves(ae,W,K=K||10,X=X||0,0),ae}getTile(W,K,X){const ae=this.trees[this._limitZoom(W)],pe=Math.pow(2,W),{extent:we,radius:Ce}=this.options,ye=Ce/we,Ne=(X-ye)/pe,Ve=(X+1+ye)/pe,Fe={features:[]};return this._addTileFeatures(ae.range((K-ye)/pe,Ne,(K+1+ye)/pe,Ve),ae.data,K,X,pe,Fe),0===K&&this._addTileFeatures(ae.range(1-ye/pe,Ne,1,Ve),ae.data,pe,X,pe,Fe),K===pe-1&&this._addTileFeatures(ae.range(0,Ne,ye/pe,Ve),ae.data,-1,X,pe,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(W){let K=this._getOriginZoom(W)-1;for(;K<=this.options.maxZoom;){const X=this.getChildren(W);if(K++,1!==X.length)break;W=X[0].properties.cluster_id}return K}_appendLeaves(W,K,X,ae,pe){const we=this.getChildren(K);for(const Ce of we){const ye=Ce.properties;if(ye&&ye.cluster?pe+ye.point_count<=ae?pe+=ye.point_count:pe=this._appendLeaves(W,ye.cluster_id,X,ae,pe):pe<ae?pe++:W.push(Ce),W.length===X)break}return pe}_createTree(W){const K=new H.aI(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<W.length;X+=this.stride)K.add(W[X],W[X+1]);return K.finish(),K.data=W,K}_addTileFeatures(W,K,X,ae,pe,we){for(const Ce of W){const ye=Ce*this.stride,Ne=K[ye+5]>1;let Ve,Fe,pt;if(Ne)Ve=wo(K,ye,this.clusterProps),Fe=K[ye],pt=K[ye+1];else{const Yt=this.points[K[ye+3]];Ve=Yt.properties;const[_t,Ut]=Yt.geometry.coordinates;Fe=xo(_t),pt=Hs(Ut)}const xe={type:1,geometry:[[Math.round(this.options.extent*(Fe*pe-X)),Math.round(this.options.extent*(pt*pe-ae))]],tags:Ve};let Nt;Nt=Ne||this.options.generateId?K[ye+3]:this.points[K[ye+3]].id,void 0!==Nt&&(xe.id=Nt),we.features.push(xe)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,K){const{radius:X,extent:ae,reduce:pe,minPoints:we}=this.options,Ce=X/(ae*Math.pow(2,K)),ye=W.data,Ne=[],Ve=this.stride;for(let Fe=0;Fe<ye.length;Fe+=Ve){if(ye[Fe+2]<=K)continue;ye[Fe+2]=K;const pt=ye[Fe],xe=ye[Fe+1],Nt=W.within(ye[Fe],ye[Fe+1],Ce),Yt=ye[Fe+5];let _t=Yt;for(const Ut of Nt){const Vn=Ut*Ve;ye[Vn+2]>K&&(_t+=ye[Vn+5])}if(_t>Yt&&_t>=we){let Ut,Vn=pt*Yt,fr=xe*Yt,qi=-1;const Un=(Fe/Ve<<5)+(K+1)+this.points.length;for(const rn of Nt){const hn=rn*Ve;if(ye[hn+2]<=K)continue;ye[hn+2]=K;const qt=ye[hn+5];Vn+=ye[hn]*qt,fr+=ye[hn+1]*qt,ye[hn+4]=Un,pe&&(Ut||(Ut=this._map(ye,Fe,!0),qi=this.clusterProps.length,this.clusterProps.push(Ut)),pe(Ut,this._map(ye,hn)))}ye[Fe+4]=Un,Ne.push(Vn/_t,fr/_t,1/0,Un,-1,_t),pe&&Ne.push(qi)}else{for(let Ut=0;Ut<Ve;Ut++)Ne.push(ye[Fe+Ut]);if(_t>1)for(const Ut of Nt){const Vn=Ut*Ve;if(!(ye[Vn+2]<=K)){ye[Vn+2]=K;for(let fr=0;fr<Ve;fr++)Ne.push(ye[Vn+fr])}}}}return Ne}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,K,X){if(W[K+5]>1){const we=this.clusterProps[W[K+6]];return X?Object.assign({},we):we}const ae=this.points[W[K+3]].properties,pe=this.options.map(ae);return X&&pe===ae?Object.assign({},pe):pe}}function rs(_e,W,K){return{type:"Feature",id:_e[W+3],properties:wo(_e,W,K),geometry:{type:"Point",coordinates:[(X=_e[W],360*(X-.5)),qr(_e[W+1])]}};var X}function wo(_e,W,K){const X=_e[W+5],ae=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,pe=_e[W+6],we=-1===pe?{}:Object.assign({},K[pe]);return Object.assign(we,{cluster:!0,cluster_id:_e[W+3],point_count:X,point_count_abbreviated:ae})}function xo(_e){return _e/360+.5}function Hs(_e){const W=Math.sin(_e*Math.PI/180),K=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return K<0?0:K>1?1:K}function qr(_e){const W=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function pn(_e,W,K,X){let ae=X;const pe=W+(K-W>>1);let we,Ce=K-W;const ye=_e[W],Ne=_e[W+1],Ve=_e[K],Fe=_e[K+1];for(let pt=W+3;pt<K;pt+=3){const xe=lo(_e[pt],_e[pt+1],ye,Ne,Ve,Fe);if(xe>ae)we=pt,ae=xe;else if(xe===ae){const Nt=Math.abs(pt-pe);Nt<Ce&&(we=pt,Ce=Nt)}}ae>X&&(we-W>3&&pn(_e,W,we,X),_e[we+2]=ae,K-we>3&&pn(_e,we,K,X))}function lo(_e,W,K,X,ae,pe){let we=ae-K,Ce=pe-X;if(0!==we||0!==Ce){const ye=((_e-K)*we+(W-X)*Ce)/(we*we+Ce*Ce);ye>1?(K=ae,X=pe):ye>0&&(K+=we*ye,X+=Ce*ye)}return we=_e-K,Ce=W-X,we*we+Ce*Ce}function Mr(_e,W,K,X){const ae={id:_e??null,type:W,geometry:K,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===W||"MultiPoint"===W||"LineString"===W)$l(ae,K);else if("Polygon"===W)$l(ae,K[0]);else if("MultiLineString"===W)for(const pe of K)$l(ae,pe);else if("MultiPolygon"===W)for(const pe of K)$l(ae,pe[0]);return ae}function $l(_e,W){for(let K=0;K<W.length;K+=3)_e.minX=Math.min(_e.minX,W[K]),_e.minY=Math.min(_e.minY,W[K+1]),_e.maxX=Math.max(_e.maxX,W[K]),_e.maxY=Math.max(_e.maxY,W[K+1])}function qs(_e,W,K,X){if(!W.geometry)return;const ae=W.geometry.coordinates;if(ae&&0===ae.length)return;const pe=W.geometry.type,we=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Ce=[],ye=W.id;if(K.promoteId?ye=W.properties[K.promoteId]:K.generateId&&(ye=X||0),"Point"===pe)So(ae,Ce);else if("MultiPoint"===pe)for(const Ne of ae)So(Ne,Ce);else if("LineString"===pe)os(ae,Ce,we,!1);else if("MultiLineString"===pe){if(K.lineMetrics){for(const Ne of ae)Ce=[],os(Ne,Ce,we,!1),_e.push(Mr(ye,"LineString",Ce,W.properties));return}Hi(ae,Ce,we,!1)}else if("Polygon"===pe)Hi(ae,Ce,we,!0);else{if("MultiPolygon"!==pe){if("GeometryCollection"===pe){for(const Ne of W.geometry.geometries)qs(_e,{id:ye,geometry:Ne,properties:W.properties},K,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ne of ae){const Ve=[];Hi(Ne,Ve,we,!0),Ce.push(Ve)}}_e.push(Mr(ye,pe,Ce,W.properties))}function So(_e,W){W.push(Vc(_e[0]),ss(_e[1]),0)}function os(_e,W,K,X){let ae,pe,we=0;for(let ye=0;ye<_e.length;ye++){const Ne=Vc(_e[ye][0]),Ve=ss(_e[ye][1]);W.push(Ne,Ve,0),ye>0&&(we+=X?(ae*Ve-Ne*pe)/2:Math.sqrt(Math.pow(Ne-ae,2)+Math.pow(Ve-pe,2))),ae=Ne,pe=Ve}const Ce=W.length-3;W[2]=1,pn(W,0,Ce,K),W[Ce+2]=1,W.size=Math.abs(we),W.start=0,W.end=W.size}function Hi(_e,W,K,X){for(let ae=0;ae<_e.length;ae++){const pe=[];os(_e[ae],pe,K,X),W.push(pe)}}function Vc(_e){return _e/360+.5}function ss(_e){const W=Math.sin(_e*Math.PI/180),K=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return K<0?0:K>1?1:K}function as(_e,W,K,X,ae,pe,we,Ce){if(X/=W,pe>=(K/=W)&&we<X)return _e;if(we<K||pe>=X)return null;const ye=[];for(const Ne of _e){const Ve=Ne.geometry;let Fe=Ne.type;const pt=0===ae?Ne.minX:Ne.minY,xe=0===ae?Ne.maxX:Ne.maxY;if(pt>=K&&xe<X){ye.push(Ne);continue}if(xe<K||pt>=X)continue;let Nt=[];if("Point"===Fe||"MultiPoint"===Fe)Hl(Ve,Nt,K,X,ae);else if("LineString"===Fe)Uc(Ve,Nt,K,X,ae,!1,Ce.lineMetrics);else if("MultiLineString"===Fe)Li(Ve,Nt,K,X,ae,!1);else if("Polygon"===Fe)Li(Ve,Nt,K,X,ae,!0);else if("MultiPolygon"===Fe)for(const Yt of Ve){const _t=[];Li(Yt,_t,K,X,ae,!0),_t.length&&Nt.push(_t)}if(Nt.length){if(Ce.lineMetrics&&"LineString"===Fe){for(const Yt of Nt)ye.push(Mr(Ne.id,Fe,Yt,Ne.tags));continue}"LineString"!==Fe&&"MultiLineString"!==Fe||(1===Nt.length?(Fe="LineString",Nt=Nt[0]):Fe="MultiLineString"),"Point"!==Fe&&"MultiPoint"!==Fe||(Fe=3===Nt.length?"Point":"MultiPoint"),ye.push(Mr(Ne.id,Fe,Nt,Ne.tags))}}return ye.length?ye:null}function Hl(_e,W,K,X,ae){for(let pe=0;pe<_e.length;pe+=3){const we=_e[pe+ae];we>=K&&we<=X&&nr(W,_e[pe],_e[pe+1],_e[pe+2])}}function Uc(_e,W,K,X,ae,pe,we){let Ce=Wr(_e);const ye=0===ae?Es:ko;let Ne,Ve,Fe=_e.start;for(let _t=0;_t<_e.length-3;_t+=3){const Ut=_e[_t],Vn=_e[_t+1],fr=_e[_t+2],qi=_e[_t+3],Un=_e[_t+4],rn=0===ae?Ut:Vn,hn=0===ae?qi:Un;let qt=!1;we&&(Ne=Math.sqrt(Math.pow(Ut-qi,2)+Math.pow(Vn-Un,2))),rn<K?hn>K&&(Ve=ye(Ce,Ut,Vn,qi,Un,K),we&&(Ce.start=Fe+Ne*Ve)):rn>X?hn<X&&(Ve=ye(Ce,Ut,Vn,qi,Un,X),we&&(Ce.start=Fe+Ne*Ve)):nr(Ce,Ut,Vn,fr),hn<K&&rn>=K&&(Ve=ye(Ce,Ut,Vn,qi,Un,K),qt=!0),hn>X&&rn<=X&&(Ve=ye(Ce,Ut,Vn,qi,Un,X),qt=!0),!pe&&qt&&(we&&(Ce.end=Fe+Ne*Ve),W.push(Ce),Ce=Wr(_e)),we&&(Fe+=Ne)}let pt=_e.length-3;const xe=_e[pt],Nt=_e[pt+1],Yt=0===ae?xe:Nt;Yt>=K&&Yt<=X&&nr(Ce,xe,Nt,_e[pt+2]),pt=Ce.length-3,pe&&pt>=3&&(Ce[pt]!==Ce[0]||Ce[pt+1]!==Ce[1])&&nr(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&W.push(Ce)}function Wr(_e){const W=[];return W.size=_e.size,W.start=_e.start,W.end=_e.end,W}function Li(_e,W,K,X,ae,pe){for(const we of _e)Uc(we,W,K,X,ae,pe,!1)}function nr(_e,W,K,X){_e.push(W,K,X)}function Es(_e,W,K,X,ae,pe){const we=(pe-W)/(X-W);return nr(_e,pe,K+(ae-K)*we,1),we}function ko(_e,W,K,X,ae,pe){const we=(pe-K)/(ae-K);return nr(_e,W+(X-W)*we,pe,1),we}function hl(_e,W){const K=[];for(let X=0;X<_e.length;X++){const ae=_e[X],pe=ae.type;let we;if("Point"===pe||"MultiPoint"===pe||"LineString"===pe)we=Ca(ae.geometry,W);else if("MultiLineString"===pe||"Polygon"===pe){we=[];for(const Ce of ae.geometry)we.push(Ca(Ce,W))}else if("MultiPolygon"===pe){we=[];for(const Ce of ae.geometry){const ye=[];for(const Ne of Ce)ye.push(Ca(Ne,W));we.push(ye)}}K.push(Mr(ae.id,pe,we,ae.tags))}return K}function Ca(_e,W){const K=[];K.size=_e.size,void 0!==_e.start&&(K.start=_e.start,K.end=_e.end);for(let X=0;X<_e.length;X+=3)K.push(_e[X]+W,_e[X+1],_e[X+2]);return K}function ls(_e,W){if(_e.transformed)return _e;const K=1<<_e.z,X=_e.x,ae=_e.y;for(const pe of _e.features){const we=pe.geometry,Ce=pe.type;if(pe.geometry=[],1===Ce)for(let ye=0;ye<we.length;ye+=2)pe.geometry.push(Gc(we[ye],we[ye+1],W,K,X,ae));else for(let ye=0;ye<we.length;ye++){const Ne=[];for(let Ve=0;Ve<we[ye].length;Ve+=2)Ne.push(Gc(we[ye][Ve],we[ye][Ve+1],W,K,X,ae));pe.geometry.push(Ne)}}return _e.transformed=!0,_e}function Gc(_e,W,K,X,ae,pe){return[Math.round(K*(_e*X-ae)),Math.round(K*(W*X-pe))]}function cn(_e,W,K,X,ae){const pe=W===ae.maxZoom?0:ae.tolerance/((1<<W)*ae.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:_e.length,source:null,x:K,y:X,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ce of _e)Ws(we,Ce,pe,ae);return we}function Ws(_e,W,K,X){const ae=W.geometry,pe=W.type,we=[];if(_e.minX=Math.min(_e.minX,W.minX),_e.minY=Math.min(_e.minY,W.minY),_e.maxX=Math.max(_e.maxX,W.maxX),_e.maxY=Math.max(_e.maxY,W.maxY),"Point"===pe||"MultiPoint"===pe)for(let Ce=0;Ce<ae.length;Ce+=3)we.push(ae[Ce],ae[Ce+1]),_e.numPoints++,_e.numSimplified++;else if("LineString"===pe)Zs(we,ae,_e,K,!1,!1);else if("MultiLineString"===pe||"Polygon"===pe)for(let Ce=0;Ce<ae.length;Ce++)Zs(we,ae[Ce],_e,K,"Polygon"===pe,0===Ce);else if("MultiPolygon"===pe)for(let Ce=0;Ce<ae.length;Ce++){const ye=ae[Ce];for(let Ne=0;Ne<ye.length;Ne++)Zs(we,ye[Ne],_e,K,!0,0===Ne)}if(we.length){let Ce=W.tags||null;if("LineString"===pe&&X.lineMetrics){Ce={};for(const Ne in W.tags)Ce[Ne]=W.tags[Ne];Ce.mapbox_clip_start=ae.start/ae.size,Ce.mapbox_clip_end=ae.end/ae.size}const ye={geometry:we,type:"Polygon"===pe||"MultiPolygon"===pe?3:"LineString"===pe||"MultiLineString"===pe?2:1,tags:Ce};null!==W.id&&(ye.id=W.id),_e.features.push(ye)}}function Zs(_e,W,K,X,ae,pe){const we=X*X;if(X>0&&W.size<(ae?we:X))return void(K.numPoints+=W.length/3);const Ce=[];for(let ye=0;ye<W.length;ye+=3)(0===X||W[ye+2]>we)&&(K.numSimplified++,Ce.push(W[ye],W[ye+1])),K.numPoints++;ae&&function(ye,Ne){let Ve=0;for(let Fe=0,pt=ye.length,xe=pt-2;Fe<pt;xe=Fe,Fe+=2)Ve+=(ye[Fe]-ye[xe])*(ye[Fe+1]+ye[xe+1]);if(Ve>0===Ne)for(let Fe=0,pt=ye.length;Fe<pt/2;Fe+=2){const xe=ye[Fe],Nt=ye[Fe+1];ye[Fe]=ye[pt-2-Fe],ye[Fe+1]=ye[pt-1-Fe],ye[pt-2-Fe]=xe,ye[pt-1-Fe]=Nt}}(Ce,pe),_e.push(Ce)}const Ks={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Si{constructor(W,K){const X=(K=this.options=function(pe,we){for(const Ce in we)pe[Ce]=we[Ce];return pe}(Object.create(Ks),K)).debug;if(X&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let ae=function(pe,we){const Ce=[];if("FeatureCollection"===pe.type)for(let ye=0;ye<pe.features.length;ye++)qs(Ce,pe.features[ye],we,ye);else qs(Ce,"Feature"===pe.type?pe:{geometry:pe},we);return Ce}(W,K);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=function(pe,we){const Ce=we.buffer/we.extent;let ye=pe;const Ne=as(pe,1,-1-Ce,Ce,0,-1,2,we),Ve=as(pe,1,1-Ce,2+Ce,0,-1,2,we);return(Ne||Ve)&&(ye=as(pe,1,-Ce,1+Ce,0,-1,2,we)||[],Ne&&(ye=hl(Ne,1).concat(ye)),Ve&&(ye=ye.concat(hl(Ve,-1)))),ye}(ae,K),ae.length&&this.splitTile(ae,0,0,0),X&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,K,X,ae,pe,we,Ce){const ye=[W,K,X,ae],Ne=this.options,Ve=Ne.debug;for(;ye.length;){ae=ye.pop(),X=ye.pop(),K=ye.pop(),W=ye.pop();const Fe=1<<K,pt=Ta(K,X,ae);let xe=this.tiles[pt];if(!xe&&(Ve>1&&console.time("creation"),xe=this.tiles[pt]=cn(W,K,X,ae,Ne),this.tileCoords.push({z:K,x:X,y:ae}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,X,ae,xe.numFeatures,xe.numPoints,xe.numSimplified),console.timeEnd("creation"));const qt=`z${K}`;this.stats[qt]=(this.stats[qt]||0)+1,this.total++}if(xe.source=W,null==pe){if(K===Ne.indexMaxZoom||xe.numPoints<=Ne.indexMaxPoints)continue}else{if(K===Ne.maxZoom||K===pe)continue;if(null!=pe){const qt=pe-K;if(X!==we>>qt||ae!==Ce>>qt)continue}}if(xe.source=null,0===W.length)continue;Ve>1&&console.time("clipping");const Nt=.5*Ne.buffer/Ne.extent,Yt=.5-Nt,_t=.5+Nt,Ut=1+Nt;let Vn=null,fr=null,qi=null,Un=null,rn=as(W,Fe,X-Nt,X+_t,0,xe.minX,xe.maxX,Ne),hn=as(W,Fe,X+Yt,X+Ut,0,xe.minX,xe.maxX,Ne);W=null,rn&&(Vn=as(rn,Fe,ae-Nt,ae+_t,1,xe.minY,xe.maxY,Ne),fr=as(rn,Fe,ae+Yt,ae+Ut,1,xe.minY,xe.maxY,Ne),rn=null),hn&&(qi=as(hn,Fe,ae-Nt,ae+_t,1,xe.minY,xe.maxY,Ne),Un=as(hn,Fe,ae+Yt,ae+Ut,1,xe.minY,xe.maxY,Ne),hn=null),Ve>1&&console.timeEnd("clipping"),ye.push(Vn||[],K+1,2*X,2*ae),ye.push(fr||[],K+1,2*X,2*ae+1),ye.push(qi||[],K+1,2*X+1,2*ae),ye.push(Un||[],K+1,2*X+1,2*ae+1)}}getTile(W,K,X){W=+W,K=+K,X=+X;const ae=this.options,{extent:pe,debug:we}=ae;if(W<0||W>24)return null;const Ce=1<<W,ye=Ta(W,K=K+Ce&Ce-1,X);if(this.tiles[ye])return ls(this.tiles[ye],pe);we>1&&console.log("drilling down to z%d-%d-%d",W,K,X);let Ne,Ve=W,Fe=K,pt=X;for(;!Ne&&Ve>0;)Ve--,Fe>>=1,pt>>=1,Ne=this.tiles[Ta(Ve,Fe,pt)];return Ne&&Ne.source?(we>1&&(console.log("found parent tile z%d-%d-%d",Ve,Fe,pt),console.time("drilling down")),this.splitTile(Ne.source,Ve,Fe,pt,W,K,X),we>1&&console.timeEnd("drilling down"),this.tiles[ye]?ls(this.tiles[ye],pe):null):null}}function Ta(_e,W,K){return 32*((1<<_e)*K+W)+_e}class Ia extends $s{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,K){return H._(this,void 0,void 0,function*(){const X=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ae=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ae)return null;const pe=new gi(ae.features,{version:2,extent:H.$});let we=function(Ce){const ye=new H.cM;return function(Ne,Ve){for(const Fe in Ne.layers)Ve.writeMessage(3,Oi,Ne.layers[Fe])}(Ce,ye),ye.finish()}(pe);return 0===we.byteOffset&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),{vectorTile:pe,rawData:we.buffer}})}loadData(W){return H._(this,void 0,void 0,function*(){var K;null===(K=this._pendingRequest)||void 0===K||K.abort();const X=!!(W&&W.request&&W.request.collectResourceTiming)&&new H.cN(W.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest);const ae=yield this._pendingData;this._geoJSONIndex=W.cluster?new Fi(function({superclusterOptions:we,clusterProperties:Ce}){if(!Ce||!we)return we;const ye={},Ne={},Ve={accumulated:null,zoom:0},Fe={properties:null},pt=Object.keys(Ce);for(const xe of pt){const[Nt,Yt]=Ce[xe],_t=H.cT(Yt),Ut=H.cT("string"==typeof Nt?[Nt,["accumulated"],["get",xe]]:Nt);ye[xe]=_t.value,Ne[xe]=Ut.value}return we.map=xe=>{Fe.properties=xe;const Nt={};for(const Yt of pt)Nt[Yt]=ye[Yt].evaluate(Ve,Fe);return Nt},we.reduce=(xe,Nt)=>{Fe.properties=Nt;for(const Yt of pt)Ve.accumulated=xe[Yt],xe[Yt]=Ne[Yt].evaluate(Ve,Fe)},we}(W)).load(ae.features):new Si(ae,W.geojsonVtOptions),this.loaded={};const pe={data:ae};if(X){const we=X.finish();we&&(pe.resourceTiming={},pe.resourceTiming[W.source]=JSON.parse(JSON.stringify(we)))}return pe}catch(ae){if(delete this._pendingRequest,H.cy(ae))return{abandoned:!0};throw ae}})}getData(){return H._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(W){const K=this.loaded;return K&&K[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,K){return H._(this,void 0,void 0,function*(){let X=yield this.loadGeoJSON(W,K);if(delete this._pendingRequest,"object"!=typeof X)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(zn(X,!0),W.filter){const ae=H.cT(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ae.result)throw new Error(ae.value.map(we=>`${we.key}: ${we.message}`).join(", "));X={type:"FeatureCollection",features:X.features.filter(we=>ae.value.evaluate({zoom:0},we))}}return X})}loadGeoJSON(W,K){return H._(this,void 0,void 0,function*(){const{promoteId:X}=W;if(W.request){const ae=yield H.j(W.request,K);return this._dataUpdateable=H.cV(ae.data,X)?H.cU(ae.data,X):void 0,ae.data}if("string"==typeof W.data)try{const ae=JSON.parse(W.data);return this._dataUpdateable=H.cV(ae,X)?H.cU(ae,X):void 0,ae}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return H.cW(this._dataUpdateable,W.dataDiff,X),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return H._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class ql{constructor(W){this.self=W,this.actor=new H.J(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(K,X)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=X},this.self.addProtocol=H.cA,this.self.removeProtocol=H.cB,this.self.registerRTLTextPlugin=K=>{H.cX.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,X)=>this._getDEMWorkerSource(K,X.source).loadTile(X)),this.actor.registerMessageHandler("RDT",(K,X)=>H._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,X.source).removeTile(X)})),this.actor.registerMessageHandler("GCEZ",(K,X)=>H._(this,void 0,void 0,function*(){return this._getWorkerSource(K,X.type,X.source).getClusterExpansionZoom(X)})),this.actor.registerMessageHandler("GCC",(K,X)=>H._(this,void 0,void 0,function*(){return this._getWorkerSource(K,X.type,X.source).getClusterChildren(X)})),this.actor.registerMessageHandler("GCL",(K,X)=>H._(this,void 0,void 0,function*(){return this._getWorkerSource(K,X.type,X.source).getClusterLeaves(X)})),this.actor.registerMessageHandler("LD",(K,X)=>this._getWorkerSource(K,X.type,X.source).loadData(X)),this.actor.registerMessageHandler("GD",(K,X)=>this._getWorkerSource(K,X.type,X.source).getData()),this.actor.registerMessageHandler("LT",(K,X)=>this._getWorkerSource(K,X.type,X.source).loadTile(X)),this.actor.registerMessageHandler("RT",(K,X)=>this._getWorkerSource(K,X.type,X.source).reloadTile(X)),this.actor.registerMessageHandler("AT",(K,X)=>this._getWorkerSource(K,X.type,X.source).abortTile(X)),this.actor.registerMessageHandler("RMT",(K,X)=>this._getWorkerSource(K,X.type,X.source).removeTile(X)),this.actor.registerMessageHandler("RS",(K,X)=>H._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][X.type]||!this.workerSources[K][X.type][X.source])return;const ae=this.workerSources[K][X.type][X.source];delete this.workerSources[K][X.type][X.source],void 0!==ae.removeSource&&ae.removeSource(X)})),this.actor.registerMessageHandler("RM",K=>H._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K]})),this.actor.registerMessageHandler("SR",(K,X)=>H._(this,void 0,void 0,function*(){this.referrer=X})),this.actor.registerMessageHandler("SRPS",(K,X)=>this._syncRTLPluginState(K,X)),this.actor.registerMessageHandler("IS",(K,X)=>H._(this,void 0,void 0,function*(){this.self.importScripts(X)})),this.actor.registerMessageHandler("SI",(K,X)=>this._setImages(K,X)),this.actor.registerMessageHandler("UL",(K,X)=>H._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(X.layers,X.removedIds)})),this.actor.registerMessageHandler("SL",(K,X)=>H._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(X)}))}_setImages(W,K){return H._(this,void 0,void 0,function*(){this.availableImages[W]=K;for(const X in this.workerSources[W]){const ae=this.workerSources[W][X];for(const pe in ae)ae[pe].availableImages=K}})}_syncRTLPluginState(W,K){return H._(this,void 0,void 0,function*(){return yield H.cX.syncState(K,this.self.importScripts)})}_getAvailableImages(W){let K=this.availableImages[W];return K||(K=[]),K}_getLayerIndex(W){let K=this.layerIndexes[W];return K||(K=this.layerIndexes[W]=new y),K}_getWorkerSource(W,K,X){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][K]||(this.workerSources[W][K]={}),!this.workerSources[W][K][X]){const ae={sendAsync:(pe,we)=>(pe.targetMapId=W,this.actor.sendAsync(pe,we))};switch(K){case"vector":this.workerSources[W][K][X]=new $s(ae,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][K][X]=new Ia(ae,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][K][X]=new this.externalWorkerSourceTypes[K](ae,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][K][X]}_getDEMWorkerSource(W,K){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][K]||(this.demWorkerSources[W][K]=new wt),this.demWorkerSources[W][K]}}return H.i(self)&&(self.worker=new ql(self)),ql}),jc("index",0,function(H,y){function Gs(){var v=new y.A(4);return y.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let Fr,$s;const wt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(v,o,u){const p=requestAnimationFrame(b=>{m(),o(b)}),{unsubscribe:m}=y.s(v.signal,"abort",()=>{m(),cancelAnimationFrame(p),u(y.c())},!1)},frameAsync(v){return new Promise((o,u)=>{this.frame(v,o,u)})},getImageData(v,o=0){return this.getImageCanvasContext(v).getImageData(-o,-o,v.width+2*o,v.height+2*o)},getImageCanvasContext(v){const o=window.document.createElement("canvas"),u=o.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return o.width=v.width,o.height=v.height,u.drawImage(v,0,0,v.width,v.height),u},resolveURL:v=>(Fr||(Fr=document.createElement("a")),Fr.href=v,Fr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==$s&&($s=matchMedia("(prefers-reduced-motion: reduce)")),$s.matches)}};class Pe{static testProp(o){if(!Pe.docStyle)return o[0];for(let u=0;u<o.length;u++)if(o[u]in Pe.docStyle)return o[u];return o[0]}static create(o,u,p){const m=window.document.createElement(o);return void 0!==u&&(m.className=u),p&&p.appendChild(m),m}static createNS(o,u){return window.document.createElementNS(o,u)}static disableDrag(){Pe.docStyle&&Pe.selectProp&&(Pe.userSelect=Pe.docStyle[Pe.selectProp],Pe.docStyle[Pe.selectProp]="none")}static enableDrag(){Pe.docStyle&&Pe.selectProp&&(Pe.docStyle[Pe.selectProp]=Pe.userSelect)}static setTransform(o,u){o.style[Pe.transformProp]=u}static addEventListener(o,u,p,m={}){o.addEventListener(u,p,"passive"in m?m:m.capture)}static removeEventListener(o,u,p,m={}){o.removeEventListener(u,p,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",Pe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Pe.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Pe.suppressClickInternal,!0)},0)}static getScale(o){const u=o.getBoundingClientRect();return{x:u.width/o.offsetWidth||1,y:u.height/o.offsetHeight||1,boundingClientRect:u}}static getPoint(o,u,p){const m=u.boundingClientRect;return new y.P((p.clientX-m.left)/u.x-o.clientLeft,(p.clientY-m.top)/u.y-o.clientTop)}static mousePos(o,u){const p=Pe.getScale(o);return Pe.getPoint(o,p,u)}static touchPos(o,u){const p=[],m=Pe.getScale(o);for(let b=0;b<u.length;b++)p.push(Pe.getPoint(o,m,u[b]));return p}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}static sanitize(o){const u=(new DOMParser).parseFromString(o,"text/html").body||document.createElement("body"),p=u.querySelectorAll("script");for(const m of p)m.remove();return Pe.clean(u),u.innerHTML}static isPossiblyDangerous(o,u){const p=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(o)||!p.includes("javascript:")&&!p.includes("data:"))||!!o.startsWith("on")||void 0}static clean(o){const u=o.children;for(const p of u)Pe.removeAttributes(p),Pe.clean(p)}static removeAttributes(o){for(const{name:u,value:p}of o.attributes)Pe.isPossiblyDangerous(u,p)&&o.removeAttribute(u)}}Pe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Pe.selectProp=Pe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Pe.transformProp=Pe.testProp(["transform","WebkitTransform"]);const No={supported:!1,testSupport:function(v){!Mt&&zn&&(gi?Oi(v):bo=v)}};let bo,zn,Mt=!1,gi=!1;function Oi(v){const o=v.createTexture();v.bindTexture(v.TEXTURE_2D,o);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,zn),v.isContextLost())return;No.supported=!0}catch{}v.deleteTexture(o),Mt=!0}var nt;typeof document<"u"&&(zn=document.createElement("img"),zn.onload=()=>{bo&&Oi(bo),bo=null,gi=!0},zn.onerror=()=>{Mt=!0,bo=null},zn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let o,u,p,m;v.resetRequestQueue=()=>{o=[],u=0,p=0,m={}},v.addThrottleControl=I=>{const R=p++;return m[R]=I,R},v.removeThrottleControl=I=>{delete m[I],E()},v.getImage=(I,R,O=!0)=>new Promise((z,B)=>{No.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),y.e(I,{type:"image"}),o.push({abortController:R,requestParameters:I,supportImageRefresh:O,state:"queued",onError:V=>{B(V)},onSuccess:V=>{z(V)}}),E()});const b=I=>y._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:R,supportImageRefresh:O,onError:z,onSuccess:B,abortController:V}=I,q=!1===O&&!y.i(self)&&!y.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((te,re)=>te&&"accept"===re,!0));u++;const ee=q?T(R,V):y.m(R,V);try{const te=yield ee;delete I.abortController,I.state="completed",te.data instanceof HTMLImageElement||y.b(te.data)?B(te):te.data&&B({data:yield(Q=te.data,"function"==typeof createImageBitmap?y.f(Q):y.h(Q)),cacheControl:te.cacheControl,expires:te.expires})}catch(te){delete I.abortController,z(te)}finally{u--,E()}var Q}),E=()=>{const I=(()=>{for(const R of Object.keys(m))if(m[R]())return!0;return!1})()?y.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:y.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=u;R<I&&o.length>0;R++){const O=o.shift();O.abortController.signal.aborted?R--:b(O)}},T=(I,R)=>new Promise((O,z)=>{const B=new Image,V=I.url,q=I.credentials;q&&"include"===q?B.crossOrigin="use-credentials":(q&&"same-origin"===q||!y.d(V))&&(B.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{B.src="",z(y.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,O({data:B})},B.onerror=()=>{B.onerror=B.onload=null,R.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=V})}(nt||(nt={})),nt.resetRequestQueue();class yt{constructor(o){this._transformRequestFn=o??null}transformRequest(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function ht(v){const o=[];if("string"==typeof v)o.push({id:"default",url:v});else if(v&&v.length>0){const u=[];for(const{id:p,url:m}of v){const b=`${p}${m}`;-1===u.indexOf(b)&&(u.push(b),o.push({id:p,url:m}))}}return o}function tn(v,o,u){try{const p=new URL(v);return p.pathname+=`${o}${u}`,p.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function jn(v){const{userImage:o}=v;return!!(o&&o.render&&o.render())&&(v.data.replace(new Uint8Array(o.data.buffer)),!0)}class Dn extends y.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,promiseResolve:p}of this.requestors)p(this._getImagesForIds(u));this.requestors=[]}}getImage(o){const u=this.images[o];if(u&&!u.data&&u.spriteData){const p=u.spriteData;u.data=new y.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),u.spriteData=null}return u}addImage(o,u){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let p=!0;const m=u.data||u.spriteData;return this._validateStretch(u.stretchX,m&&m.width)||(this.fire(new y.k(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,m&&m.height)||(this.fire(new y.k(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new y.k(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,u){if(!o)return!0;let p=0;for(const m of o){if(m[0]<p||m[1]<m[0]||u<m[1])return!1;p=m[1]}return!0}_validateContent(o,u){if(!o)return!0;if(4!==o.length)return!1;const p=u.spriteData,m=p&&p.width||u.data.width,b=p&&p.height||u.data.height;return!(o[0]<0||m<o[0]||o[1]<0||b<o[1]||o[2]<0||m<o[2]||o[3]<0||b<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,u,p=!0){const m=this.getImage(o);if(p&&(m.data.width!==u.data.width||m.data.height!==u.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=m.version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((u,p)=>{let m=!0;if(!this.isLoaded())for(const b of o)this.images[b]||(m=!1);this.isLoaded()||m?u(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:u})})}_getImagesForIds(o){const u={};for(const p of o){let m=this.getImage(p);m||(this.fire(new y.l("styleimagemissing",{id:p})),m=this.getImage(p)),m?u[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!(!m.userImage||!m.userImage.render)}:y.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],p=this.getImage(o);if(!p)return null;if(u&&u.position.version===p.version)return u.position;if(u)u.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new y.I(m,p);this.patterns[o]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.T(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:u,h:p}=y.p(o),m=this.atlasImage;m.resize({width:u||1,height:p||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],T=E.x+1,I=E.y+1,R=this.getImage(b).data,O=R.width,z=R.height;y.R.copy(R,m,{x:0,y:0},{x:T,y:I},{width:O,height:z}),y.R.copy(R,m,{x:0,y:z-1},{x:T,y:I-1},{width:O,height:1}),y.R.copy(R,m,{x:0,y:0},{x:T,y:I+z},{width:O,height:1}),y.R.copy(R,m,{x:O-1,y:0},{x:T-1,y:I},{width:1,height:z}),y.R.copy(R,m,{x:0,y:0},{x:T+O,y:I},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const p=this.getImage(u);p||y.w(`Image with ID: "${u}" was not found`),jn(p)&&this.updateImage(u,p)}}}const dr=1e20;function ri(v,o,u,p,m,b,E,T,I){for(let R=o;R<o+p;R++)An(v,u*b+R,b,m,E,T,I);for(let R=u;R<u+m;R++)An(v,R*b+o,1,p,E,T,I)}function An(v,o,u,p,m,b,E){b[0]=0,E[0]=-dr,E[1]=dr,m[0]=v[o];for(let T=1,I=0,R=0;T<p;T++){m[T]=v[o+T*u];const O=T*T;do{const z=b[I];R=(m[T]-m[z]+O-z*z)/(T-z)/2}while(R<=E[I]&&--I>-1);I++,b[I]=T,E[I]=R,E[I+1]=dr}for(let T=0,I=0;T<p;T++){for(;E[I+1]<T;)I++;const R=b[I],O=T-R;v[o+T*u]=m[R]+O*O}}class Fi{constructor(o,u){this.requestManager=o,this.localIdeographFontFamily=u,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return y._(this,void 0,void 0,function*(){const u=[];for(const b in o)for(const E of o[b])u.push(this._getAndCacheGlyphsPromise(b,E));const p=yield Promise.all(u),m={};for(const{stack:b,id:E,glyph:T}of p)m[b]||(m[b]={}),m[b][E]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return m})}_getAndCacheGlyphsPromise(o,u){return y._(this,void 0,void 0,function*(){let p=this.entries[o];p||(p=this.entries[o]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[u];if(void 0!==m)return{stack:o,id:u,glyph:m};if(m=this._tinySDF(p,o,u),m)return p.glyphs[u]=m,{stack:o,id:u,glyph:m};const b=Math.floor(u/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:o,id:u,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const T=Fi.loadGlyphRange(o,b,this.url,this.requestManager);p.requests[b]=T}const E=yield p.requests[b];for(const T in E)this._doesCharSupportLocalGlyph(+T)||(p.glyphs[+T]=E[+T]);return p.ranges[b]=!0,{stack:o,id:u,glyph:E[u]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))||y.u["CJK Unified Ideographs"](o)||y.u["Hangul Syllables"](o)||y.u.Hiragana(o)||y.u.Katakana(o)||y.u["CJK Symbols and Punctuation"](o)||y.u["Halfwidth and Fullwidth Forms"](o))}_tinySDF(o,u,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=o.tinySDF;if(!b){let T="400";/bold/i.test(u)?T="900":/medium/i.test(u)?T="500":/light/i.test(u)&&(T="200"),b=o.tinySDF=new Fi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:T})}const E=b.draw(String.fromCharCode(p));return{id:p,bitmap:new y.q({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Fi.loadGlyphRange=function(v,o,u,p){return y._(this,void 0,void 0,function*(){const m=256*o,b=m+255,E=p.transformRequest(u.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),T=yield y.n(E,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${o}, ${m}-${b}`);const I={};for(const R of y.o(T.data))I[R.id]=R;return I})},Fi.TinySDF=class{constructor({fontSize:v=24,buffer:o=3,radius:u=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:E="normal",lang:T=null}={}){this.buffer=o,this.cutoff=p,this.radius=u,this.lang=T;const I=this.size=v+4*o,R=this._createCanvas(I),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${E} ${b} ${v}px ${m}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(v){const o=document.createElement("canvas");return o.width=o.height=v,o}draw(v){const{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),E=Math.ceil(u),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),I=Math.min(this.size-this.buffer,E+Math.ceil(p)),R=T+2*this.buffer,O=I+2*this.buffer,z=Math.max(R*O,0),B=new Uint8ClampedArray(z),V={data:B,width:R,height:O,glyphWidth:T,glyphHeight:I,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(0===T||0===I)return V;const{ctx:q,buffer:ee,gridInner:Q,gridOuter:te}=this;this.lang&&(q.lang=this.lang),q.clearRect(ee,ee,T,I),q.fillText(v,ee,ee+E);const re=q.getImageData(ee,ee,T,I);te.fill(dr,0,z),Q.fill(0,0,z);for(let le=0;le<I;le++)for(let oe=0;oe<T;oe++){const ue=re.data[4*(le*T+oe)+3]/255;if(0===ue)continue;const de=(le+ee)*R+oe+ee;if(1===ue)te[de]=0,Q[de]=dr;else{const se=.5-ue;te[de]=se>0?se*se:0,Q[de]=se<0?se*se:0}}ri(te,0,0,R,O,R,this.f,this.v,this.z),ri(Q,ee,ee,T,I,R,this.f,this.v,this.z);for(let le=0;le<z;le++){const oe=Math.sqrt(te[le])-Math.sqrt(Q[le]);B[le]=Math.round(255-255*(oe/this.radius+this.cutoff))}return V}};class rs{constructor(){this.specification=y.v.light.position}possiblyEvaluate(o,u){return y.B(o.expression.evaluate(u))}interpolate(o,u,p){return{x:y.C.number(o.x,u.x,p),y:y.C.number(o.y,u.y,p),z:y.C.number(o.z,u.z,p)}}}let wo;class xo extends y.E{constructor(o){super(),wo=wo||new y.r({anchor:new y.D(y.v.light.anchor),position:new rs,color:new y.D(y.v.light.color),intensity:new y.D(y.v.light.intensity)}),this._transitionable=new y.t(wo),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(y.x,o,u))for(const p in o){const m=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,p){return(!p||!1!==p.validate)&&y.y(this,o.call(y.z,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:y.v}))}}const Hs=new y.r({"sky-color":new y.D(y.v.sky["sky-color"]),"horizon-color":new y.D(y.v.sky["horizon-color"]),"fog-color":new y.D(y.v.sky["fog-color"]),"fog-ground-blend":new y.D(y.v.sky["fog-ground-blend"]),"horizon-fog-blend":new y.D(y.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new y.D(y.v.sky["sky-horizon-blend"]),"atmosphere-blend":new y.D(y.v.sky["atmosphere-blend"])});class qr extends y.E{constructor(o){super(),this._transitionable=new y.t(Hs),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new y.F(0))}setSky(o,u={}){if(!this._validate(y.G,o,u)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in o){const m=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,p={}){return!1!==p?.validate&&y.y(this,o.call(y.z,y.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:y.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class pn{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,u){const p=o.join(",")+String(u);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,u)),this.dashEntry[p]}getDashRanges(o,u,p){const m=[];let b=o.length%2==1?-o[o.length-1]*p:0,E=o[0]*p,T=!0;m.push({left:b,right:E,isDash:T,zeroLength:0===o[0]});let I=o[0];for(let R=1;R<o.length;R++){T=!T;const O=o[R];b=I*p,I+=O,E=I*p,m.push({left:b,right:E,isDash:T,zeroLength:0===O})}return m}addRoundDash(o,u,p){const m=u/2;for(let b=-p;b<=p;b++){const E=this.width*(this.nextRow+p+b);let T=0,I=o[T];for(let R=0;R<this.width;R++){R/I.right>1&&(I=o[++T]);const O=Math.abs(R-I.left),z=Math.abs(R-I.right),B=Math.min(O,z);let V;const q=b/p*(m+1);if(I.isDash){const ee=m-Math.abs(q);V=Math.sqrt(B*B+ee*ee)}else V=m-Math.sqrt(B*B+q*q);this.data[E+R]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(o){for(let T=o.length-1;T>=0;--T){const I=o[T],R=o[T+1];I.zeroLength?o.splice(T,1):R&&R.isDash===I.isDash&&(R.left=I.left,o.splice(T,1))}const u=o[0],p=o[o.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const m=this.width*this.nextRow;let b=0,E=o[b];for(let T=0;T<this.width;T++){T/E.right>1&&(E=o[++b]);const I=Math.abs(T-E.left),R=Math.abs(T-E.right),O=Math.min(I,R);this.data[m+T]=Math.max(0,Math.min(255,(E.isDash?O:-O)+128))}}addDash(o,u){const p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return y.w("LineAtlas out of space"),null;let b=0;for(let T=0;T<o.length;T++)b+=o[T];if(0!==b){const T=this.width/b,I=this.getDashRanges(o,this.width,T);u?this.addRoundDash(I,T,p):this.addRegularDash(I)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,E}bind(o){const u=o.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const lo="maplibre_preloaded_worker_pool";class Mr{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Mr.workerCount;)this.workers.push(new Worker(y.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lo]}numActive(){return Object.keys(this.active).length}}const $l=Math.floor(wt.hardwareConcurrency/2);let qs,So;function os(){return qs||(qs=new Mr),qs}Mr.workerCount=y.H(globalThis)?Math.max(Math.min($l,3),1):1;class Hi{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=u;const p=this.workerPool.acquire(u);for(let m=0;m<p.length;m++){const b=new y.J(p[m],u);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,u){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:o,data:u}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,u){for(const p of this.actors)p.registerMessageHandler(o,u)}}function Vc(){return So||(So=new Hi(os(),y.K),So.registerMessageHandler("GR",(v,o,u)=>y.m(o,u))),So}function ss(v,o){const u=y.L();return y.M(u,u,[1,1,0]),y.N(u,u,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?y.O(u,u,v.calculatePosMatrix(o.toUnwrapped())):u}function as(v,o,u,p,m,b,E){var T;const I=function(B,V,q){if(B)for(const ee of B){const Q=V[ee];if(Q&&Q.source===q&&"fill-extrusion"===Q.type)return!0}else for(const ee in V){const Q=V[ee];if(Q.source===q&&"fill-extrusion"===Q.type)return!0}return!1}(null!==(T=m?.layers)&&void 0!==T?T:null,o,v.id),R=b.maxPitchScaleFactor(),O=v.tilesIn(p,R,I);O.sort(Hl);const z=[];for(const B of O)z.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,u,v._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,m,b,R,ss(v.transform,B.tileID),E?(V,q)=>E(B.tileID,V,q):void 0)});return function(B,V){for(const q in B)for(const ee of B[q])Uc(ee,V);return B}(function(B){const V={},q={};for(const ee of B){const Q=ee.queryResults,te=ee.wrappedTileID,re=q[te]=q[te]||{};for(const le in Q){const oe=Q[le],ue=re[le]=re[le]||{},de=V[le]=V[le]||[];for(const se of oe)ue[se.featureIndex]||(ue[se.featureIndex]=!0,de.push(se))}}return V}(z),v)}function Hl(v,o){const u=v.tileID,p=o.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function Uc(v,o){const u=v.feature,p=o.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=p}function Wr(v,o,u){return y._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield y.j(o.transformRequest(v.url,"Source"),u)).data:yield wt.frameAsync(u),!p)return null;const m=y.Q(y.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class Li{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):Array.isArray(o)&&(4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof y.S?new y.S(o.lng,o.lat):y.S.convert(o),this}setSouthWest(o){return this._sw=o instanceof y.S?new y.S(o.lng,o.lat):y.S.convert(o),this}extend(o){const u=this._sw,p=this._ne;let m,b;if(o instanceof y.S)m=o,b=o;else{if(!(o instanceof Li))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Li.convert(o)):this.extend(y.S.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(y.S.convert(o)):this;if(m=o._sw,b=o._ne,!m||!b)return this}return u||p?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new y.S(m.lng,m.lat),this._ne=new y.S(b.lng,b.lat)),this}getCenter(){return new y.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new y.S(this.getWest(),this.getNorth())}getSouthEast(){return new y.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:u,lat:p}=y.S.convert(o);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(o){return o instanceof Li?o:o&&new Li(o)}static fromLngLat(o,u=0){const p=360*u/40075017,m=p/Math.cos(Math.PI/180*o.lat);return new Li(new y.S(o.lng-m,o.lat-p),new y.S(o.lng+m,o.lat+p))}adjustAntiMeridian(){const o=new y.S(this._sw.lng,this._sw.lat),u=new y.S(this._ne.lng,this._ne.lat);return new Li(o,o.lng>u.lng?new y.S(u.lng+360,u.lat):u)}}class nr{constructor(o,u,p){this.bounds=Li.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),p=Math.floor(y.V(this.bounds.getWest())*u),m=Math.floor(y.U(this.bounds.getNorth())*u),b=Math.ceil(y.V(this.bounds.getEast())*u),E=Math.ceil(y.U(this.bounds.getSouth())*u);return o.x>=p&&o.x<b&&o.y>=m&&o.y<E}}class Es extends y.E{constructor(o,u,p,m){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.e(this,y.Q(u,["url","scheme","tileSize","promoteId"])),this._options=y.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return y._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new y.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Wr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(y.e(this,o),o.bounds&&(this.tileBounds=new nr(o.bounds,this.minzoom,this.maxzoom)),this.fire(new y.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.l("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new y.k(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return y.e({},this._options)}loadTile(o){return y._(this,void 0,void 0,function*(){const u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(o.actor&&"expired"!==o.state){if("loading"===o.state)return new Promise((b,E)=>{o.reloadPromise={resolve:b,reject:E}})}else o.actor=this.dispatcher.getActor(),m="LT";o.abortController=new AbortController;try{const b=yield o.actor.sendAsync({type:m,data:p},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,b)}catch(b){if(delete o.abortController,o.aborted)return;if(b&&404!==b.status)throw b;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,u){if(u&&u.resourceTiming&&(o.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&o.setExpiryData(u),o.loadVectorData(u,this.map.painter),o.reloadPromise){const p=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(p.resolve).catch(p.reject)}}abortTile(o){return y._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return y._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ko extends y.E{constructor(o,u,p,m){super(),this.id=o,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.e({type:"raster"},u),y.e(this,y.Q(u,["url","scheme","tileSize"]))}load(){return y._(this,arguments,void 0,function*(o=!1){this._loaded=!1,this.fire(new y.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield Wr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(y.e(this,u),u.bounds&&(this.tileBounds=new nr(u.bounds,this.minzoom,this.maxzoom)),this.fire(new y.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:o})))}catch(u){this._tileJSONRequest=null,this.fire(new y.k(u))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load(!0)}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return y.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return y._(this,void 0,void 0,function*(){const u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const p=yield nt.getImage(this.map._requestManager.transformRequest(u,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&o.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,E=p.data;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new y.T(m,E,b.RGBA,{useMipmap:!0}),o.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(p){if(delete o.abortController,o.aborted)o.state="unloaded";else if(p)throw o.state="errored",p}})}abortTile(o){return y._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return y._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class hl extends ko{constructor(o,u,p,m){super(o,u,p,m),this.type="raster-dem",this.maxzoom=22,this._options=y.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(o){return y._(this,void 0,void 0,function*(){const u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const m=yield nt.getImage(p,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=y.b(b)&&y.W()?b:yield this.readImageNow(b),T={type:this.type,uid:o.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||"expired"===o.state){o.actor=this.dispatcher.getActor();const I=yield o.actor.sendAsync({type:"LDT",data:T});o.dem=I,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}readImageNow(o){return y._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&y.X()){const u=o.width+2,p=o.height+2;try{return new y.R({width:u,height:p},yield y.Y(o,-1,-1,u,p))}catch{}}return wt.getImageData(o,1)})}_getNeighboringTiles(o){const u=o.canonical,p=Math.pow(2,u.z),m=(u.x-1+p)%p,b=0===u.x?o.wrap-1:o.wrap,E=(u.x+1+p)%p,T=u.x+1===p?o.wrap+1:o.wrap,I={};return I[new y.Z(o.overscaledZ,b,u.z,m,u.y).key]={backfilled:!1},I[new y.Z(o.overscaledZ,T,u.z,E,u.y).key]={backfilled:!1},u.y>0&&(I[new y.Z(o.overscaledZ,b,u.z,m,u.y-1).key]={backfilled:!1},I[new y.Z(o.overscaledZ,o.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},I[new y.Z(o.overscaledZ,T,u.z,E,u.y-1).key]={backfilled:!1}),u.y+1<p&&(I[new y.Z(o.overscaledZ,b,u.z,m,u.y+1).key]={backfilled:!1},I[new y.Z(o.overscaledZ,o.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},I[new y.Z(o.overscaledZ,T,u.z,E,u.y+1).key]={backfilled:!1}),I}unloadTile(o){return y._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class Ca extends y.E{constructor(o,u,p,m){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=p.getActor(),this.setEventedParent(m),this._data=u.data,this._options=y.e({},u),this._collectResourceTiming=u.collectResourceTiming,void 0!==u.maxzoom&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,void 0!==u.clusterMaxZoom&&this.maxzoom<=u.clusterMaxZoom&&y.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=y.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==u.buffer?u.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==u.tolerance?u.tolerance:.375),extent:y.$,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:y.$,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(o){return o*(y.$/this.tileSize)}_getClusterMaxZoom(o){const u=o?Math.round(o):this.maxzoom-1;return Number.isInteger(o)||void 0===o||y.w(`Integer expected for option 'clusterMaxZoom': provided value "${o}" rounded to "${u}"`),u}load(){return y._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._pendingWorkerUpdate={data:o},this._updateWorkerData(),this}updateData(o){return this._pendingWorkerUpdate.diff=y.a0(this._pendingWorkerUpdate.diff,o),this._updateWorkerData(),this}getData(){return y._(this,void 0,void 0,function*(){const o=y.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}getCoordinatesFromGeometry(o){return"GeometryCollection"===o.type?o.geometries.map(u=>u.coordinates).flat(1/0):o.coordinates.flat(1/0)}getBounds(){return y._(this,void 0,void 0,function*(){const o=new Li,u=yield this.getData();let p;switch(u.type){case"FeatureCollection":p=u.features.map(m=>this.getCoordinatesFromGeometry(m.geometry)).flat(1/0);break;case"Feature":p=this.getCoordinatesFromGeometry(u.geometry);break;default:p=this.getCoordinatesFromGeometry(u)}if(0==p.length)return o;for(let m=0;m<p.length-1;m+=2)o.extend([p[m],p[m+1]]);return o})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(void 0!==o.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(o.clusterRadius)),void 0!==o.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(o.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,u,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:u,offset:p}})}_updateWorkerData(){return y._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;const{data:o,diff:u}=this._pendingWorkerUpdate;if(!o&&!u)return void y.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const p=y.e({type:this.type},this.workerOptions);o?("string"==typeof o?(p.request=this.map._requestManager.transformRequest(wt.resolveURL(o),"Source"),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(o),this._pendingWorkerUpdate.data=void 0):u&&(p.dataDiff=u,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new y.l("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:p});if(this._isUpdatingWorker=!1,this._removed||m.abandoned)return void this.fire(new y.l("dataabort",{dataType:"source"}));this._data=m.data;let b=null;m.resourceTiming&&m.resourceTiming[this.id]&&(b=m.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&y.e(E,{resourceTiming:b}),this.fire(new y.l("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new y.l("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(m){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new y.l("dataabort",{dataType:"source"}));this.fire(new y.k(m))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&void 0===this._pendingWorkerUpdate.data&&void 0===this._pendingWorkerUpdate.diff}loadTile(o){return y._(this,void 0,void 0,function*(){const u=o.actor?"RT":"LT";o.actor=this.actor;const p={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};o.abortController=new AbortController;const m=yield this.actor.sendAsync({type:u,data:p},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(m,this.map.painter,"RT"===u)})}abortTile(o){return y._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return y._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return y.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ls extends y.E{constructor(o,u,p,m){super(),this.flippedWindingOrder=!1,this.id=o,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=u}load(o){return y._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new y.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield nt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,o&&(this.coordinates=o),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new y.k(u))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const u=o.map(y.a1.fromLngLat);var p;return this.tileID=function(m){const b=y.a2.fromPoints(m),E=b.width(),T=b.height(),I=Math.max(E,T),R=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),O=Math.pow(2,R);return new y.a4(R,Math.floor((b.minX+b.maxX)/2*O),Math.floor((b.minY+b.maxY)/2*O))}(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((p=this.tileCoords)[1].x-p[0].x)*(p[2].y-p[0].y)-(p[1].y-p[0].y)*(p[2].x-p[0].x)<0,this.fire(new y.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,u=o.gl;this.texture||(this.texture=new y.T(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new y.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return y._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(o){const{minX:u,minY:p,maxX:m,maxY:b}=y.a2.fromPoints(o),E={};for(let T=0;T<=y.a3;T++){const I=Math.pow(2,T),R=Math.floor(u*I),O=Math.floor(p*I),z=Math.floor(m*I),B=Math.floor(b*I);E[T]={minTileX:R,minTileY:O,maxTileX:z,maxTileY:B}}return E}}class Gc extends ls{constructor(o,u,p,m){super(o,u,p,m),this.roundZoom=!0,this.type="video",this.options=u}load(){return y._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const u of o.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield y.a5(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new y.k(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const u=this.video.seekable;o<u.start(0)||o>u.end(0)?this.fire(new y.k(new y.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const o=this.map.painter.context,u=o.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new y.T(o,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new y.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class cn extends ls{constructor(o,u,p,m){super(o,u,p,m),u.coordinates?Array.isArray(u.coordinates)&&4===u.coordinates.length&&!u.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(E=>"number"!=typeof E))||this.fire(new y.k(new y.a6(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.k(new y.a6(`sources.${o}`,null,'missing required property "coordinates"'))),u.animate&&"boolean"!=typeof u.animate&&this.fire(new y.k(new y.a6(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),u.canvas?"string"==typeof u.canvas||u.canvas instanceof HTMLCanvasElement||this.fire(new y.k(new y.a6(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.k(new y.a6(`sources.${o}`,null,'missing required property "canvas"'))),this.options=u,this.animate=void 0===u.animate||u.animate}load(){return y._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const u=this.map.painter.context,p=u.gl;this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.T(u,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const E=this.tiles[b];"loaded"!==E.state&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new y.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Ws={},Zs=v=>{switch(v){case"geojson":return Ca;case"image":return ls;case"raster":return ko;case"raster-dem":return hl;case"vector":return Es;case"video":return Gc;case"canvas":return cn}return Ws[v]},Ks="RTLPluginLoaded";class Si extends y.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Vc()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return y._(this,arguments,void 0,function*(u,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=wt.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if("unavailable"===this.status){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()})}_requestImport(){return y._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new y.l(Ks))})}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let Ta=null;function Ia(){return Ta||(Ta=new Si),Ta}class ql{constructor(o,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=y.a7(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const u=o+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,b){const E={};if(!b)return E;for(const T of m){const I=T.layerIds.map(R=>b.getLayer(R)).filter(Boolean);if(0!==I.length){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(R=>I.filter(O=>O.id===R)[0]));for(const R of I)E[R.id]=T}}return E}(o.buckets,u?.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof y.a9){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof y.a9&&b.hasRTLText){this.hasRTLText=!0,Ia().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new y.a8}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(o)}const u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new y.T(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new y.T(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,p,m,b,E,T,I,R,O,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:O,transform:I,params:T,queryPadding:this.queryPadding*R,getElevation:z},o,u,p):{}}querySourceFeatures(o,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=u&&u.sourceLayer?u.sourceLayer:"",E=m._geojsonTileLayer||m[b];if(!E)return;const T=y.aa(u&&u.filter),{z:I,x:R,y:O}=this.tileID.canonical,z={z:I,x:R,y:O};for(let B=0;B<E.length;B++){const V=E.feature(B);if(T.needGeometry){const Q=y.ab(V,!0);if(!T.filter(new y.F(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!T.filter(new y.F(this.tileID.overscaledZ),V))continue;const q=p.getId(V,b),ee=new y.ac(V,I,R,O,q);ee.tile=z,o.push(ee)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const p=y.ad(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const b=this.expirationTime-u;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!u.style.hasLayer(m))continue;const b=this.buckets[m],E=b.layers[0].sourceLayer||"_geojsonTileLayer",T=p[E],I=o[E];if(!T||!I||0===Object.keys(I).length)continue;b.update(I,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=u&&u.style&&u.style.getLayer(m);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<wt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=wt.now()+o}setDependencies(o,u){const p={};for(const m of u)p[m]=!0;this.dependencies[o]=p}hasDependency(o,u){for(const p of o){const m=this.dependencies[p];if(m)for(const b of u)if(m[b])return!0}return!1}}class _e{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,p){const m=o.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const b={value:u,timeout:void 0};if(void 0!==p&&(b.timeout=setTimeout(()=>{this.remove(o,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const p=o.wrapped().key,m=void 0===u?0:this.data[p].indexOf(u),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),0===this.data[p].length&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const p in this.data)for(const m of this.data[p])o(m.value)||u.push(m);for(const p of u)this.remove(p.value.tileID,p)}}class W{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,p){const m=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},y.e(this.stateChanges[o][m],p),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==m&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][m]){this.deletedStates[o][m]={};for(const b in this.state[o][m])p[b]||(this.deletedStates[o][m][b]=null)}else for(const b in p)this.deletedStates[o]&&this.deletedStates[o][m]&&null===this.deletedStates[o][m][b]&&delete this.deletedStates[o][m][b]}removeFeatureState(o,u,p){if(null===this.deletedStates[o])return;const m=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&void 0!==u)null!==this.deletedStates[o][m]&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][p]=null);else if(void 0!==u)if(this.stateChanges[o]&&this.stateChanges[o][m])for(p in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][p]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,u){const p=String(u),m=y.e({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][u];if(null===b)return{};for(const E in b)delete m[E]}return m}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),y.e(this.state[m][E],this.stateChanges[m][E]),b[E]=this.state[m][E];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(null===this.deletedStates[m])for(const E in this.state[m])b[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(null===this.deletedStates[m][E])this.state[m][E]={};else for(const T of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][T];b[E]=this.state[m][E]}p[m]=p[m]||{},y.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(p).length)for(const m in o)o[m].setFeatureState(p,u)}}const K=89.25;function X(v,o){const u=y.ah(o.lat,-y.ai,y.ai);return new y.P(y.V(o.lng)*v,y.U(u)*v)}function ae(v,o){return new y.a1(o.x/v,o.y/v).toLngLat()}function pe(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(y.ae(90-v.pitch)),Math.tan(y.ae(K-v.pitch)))}function we(v,o){const u=v.canonical,p=o/y.af(u.z),m=u.x+Math.pow(2,u.z)*v.wrap,b=y.ag(new Float64Array(16));return y.M(b,b,[m*p,u.y*p,0]),y.N(b,b,[p/y.$,p/y.$,1]),b}function Ce(v,o,u,p,m){const b=y.a1.fromLngLat(v,o),E=m*y.aj(1,v.lat),T=E*Math.cos(y.ae(u)),I=Math.sqrt(E*E-T*T),R=I*Math.sin(y.ae(-p)),O=I*Math.cos(y.ae(-p));return new y.a1(b.x+R,b.y+O,b.z+T)}function ye(v,o,u){const p=o.intersectsFrustum(v);if(!u||0===p)return p;const m=o.intersectsPlane(u);return 0===m?0:2===p&&2===m?2:1}function Ne(v,o,u){let p=0;const m=(u-o)/10;for(let b=0;b<10;b++)p+=m*Math.pow(Math.cos(o+(b+.5)/10*(u-o)),v);return p}function Ve(v,o){return function(u,p,m,b,E){const T=2*((v-1)/y.ak(Math.cos(y.ae(K-E))/Math.cos(y.ae(K)))-1),I=Math.acos(m/b),R=2*Ne(T-1,0,y.ae(E/2)),O=Math.min(y.ae(K),I+y.ae(E/2)),z=Ne(T-1,Math.min(O,I-y.ae(E/2)),O),B=Math.atan(p/m),V=Math.hypot(p,m);let q=u;return q+=y.ak(b/V/Math.max(.5,Math.cos(y.ae(E/2)))),q+=T*y.ak(Math.cos(B))/2,q-=y.ak(Math.max(1,z/R/o))/2,q}}const Fe=Ve(9.314,3);function pt(v,o){const u=(o.roundZoom?Math.round:Math.floor)(v.zoom+y.ak(v.tileSize/o.tileSize));return Math.max(0,u)}function xe(v,o){const u=v.getCameraFrustum(),p=v.getClippingPlane(),m=v.screenPointToMercatorCoordinate(v.getCameraPoint()),b=y.a1.fromLngLat(v.center,v.elevation);m.z=b.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const E=v.getCoveringTilesDetailsProvider(),T=E.allowVariableZoom(v,o),I=pt(v,o),R=o.minzoom||0,O=void 0!==o.maxzoom?o.maxzoom:v.maxZoom,z=Math.min(Math.max(0,I),O),B=Math.pow(2,z),V=[B*m.x,B*m.y,0],q=[B*b.x,B*b.y,0],ee=Math.hypot(b.x-m.x,b.y-m.y),Q=Math.abs(b.z-m.z),te=Math.hypot(ee,Q),re=ue=>({zoom:0,x:0,y:0,wrap:ue,fullyVisible:!1}),le=[],oe=[];if(v.renderWorldCopies&&E.allowWorldCopies())for(let ue=1;ue<=3;ue++)le.push(re(-ue)),le.push(re(ue));for(le.push(re(0));le.length>0;){const ue=le.pop(),de=ue.x,se=ue.y;let ve=ue.fullyVisible;const Ie={x:de,y:se,z:ue.zoom},Ee=E.getTileBoundingVolume(Ie,ue.wrap,v.elevation,o);if(!ve){const Be=ye(u,Ee,p);if(0===Be)continue;ve=2===Be}const Me=E.distanceToTile2d(m.x,m.y,Ie,Ee);let Ae=I;T&&(Ae=(o.calculateTileZoom||Fe)(v.zoom+y.ak(v.tileSize/o.tileSize),Me,Q,te,v.fov)),Ae=(o.roundZoom?Math.round:Math.floor)(Ae),Ae=Math.max(0,Ae);const He=Math.min(Ae,O);if(ue.wrap=E.getWrap(b,Ie,ue.wrap),ue.zoom>=He){if(ue.zoom<R)continue;const Be=z-ue.zoom,ke=V[0]-.5-(de<<Be),rt=V[1]-.5-(se<<Be),$t=o.reparseOverscaled?Math.max(ue.zoom,Ae):ue.zoom;oe.push({tileID:new y.Z(ue.zoom===O?$t:ue.zoom,ue.wrap,ue.zoom,de,se),distanceSq:y.al([q[0]-.5-de,q[1]-.5-se]),tileDistanceToCamera:Math.sqrt(ke*ke+rt*rt)})}else for(let Be=0;Be<4;Be++)le.push({zoom:ue.zoom+1,x:(de<<1)+Be%2,y:(se<<1)+(Be>>1),wrap:ue.wrap,fullyVisible:ve})}return oe.sort((ue,de)=>ue.distanceSq-de.distanceSq).map(ue=>ue.tileID)}const Nt=y.a2.fromPoints([new y.P(0,0),new y.P(y.$,y.$)]);class Yt extends y.E{constructor(o,u,p){super(),this.id=o,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,E,T)=>{const I=new(Zs(b.type))(m,b,E,T);if(I.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${I.id}`);return I})(o,u,p,this),this._tiles={},this._cache=new _e(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new W,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const u=this._tiles[o];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,u,p){return y._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,u,p)}catch(m){o.state="errored",404!==m.status?this._source.fire(new y.k(m,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new y.l("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(_t).map(o=>o.key)}getRenderableIds(o){const u=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&u.push(this._tiles[p]);return o?u.sort((p,m)=>{const b=p.tileID,E=m.tileID,T=new y.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians),I=new y.P(E.canonical.x,E.canonical.y)._rotate(-this.transform.bearingInRadians);return b.overscaledZ-E.overscaledZ||I.y-T.y||I.x-T.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(_t).map(p=>p.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(o){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)o?this._reloadTile(u,"expired"):"errored"!==this._tiles[u].state&&this._reloadTile(u,"reloading")}}_reloadTile(o,u){return y._(this,void 0,void 0,function*(){const p=this._tiles[o];p&&("loading"!==p.state&&(p.state=u),yield this._loadTile(p,o,u))})}_tileLoaded(o,u,p){o.timeAdded=wt.now(),"expired"===p&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),"raster-dem"===this.getSource().type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new y.l("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const b=u[m];if(o.neighboringTiles&&o.neighboringTiles[b]){const E=this.getTileByID(b);p(o,E),p(E,o)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=b.tileID.canonical.x-m.tileID.canonical.x;const T=b.tileID.canonical.y-m.tileID.canonical.y,I=Math.pow(2,m.tileID.canonical.z),R=b.tileID.key;0===E&&0===T||Math.abs(T)>1||(Math.abs(E)>1&&(1===Math.abs(E+I)?E+=I:1===Math.abs(E-I)&&(E-=I)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,E,T),m.neighboringTiles&&m.neighboringTiles[R]&&(m.neighboringTiles[R].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,p,m){for(const b in this._tiles){let E=this._tiles[b];if(m[b]||!E.hasData()||E.tileID.overscaledZ<=u||E.tileID.overscaledZ>p)continue;let T=E.tileID;for(;E&&E.tileID.overscaledZ>u+1;){const R=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[R.key],E&&E.hasData()&&(T=R)}let I=T;for(;I.overscaledZ>u;)if(I=I.scaledTo(I.overscaledZ-1),o[I.key]||o[I.canonical.key]){m[T.key]=T;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=o.overscaledZ-1;p>=u;p--){const m=o.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const u=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(u*p*(null===this._maxTileCacheZoomLevels?y.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(o){const u=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,u){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(o,u,p,m,b,E){const T={},I={},R=Object.keys(o),O=wt.now();for(const z of R){const B=o[z],V=this._tiles[z];if(!V||0!==V.fadeEndTime&&V.fadeEndTime<=O)continue;const q=this.findLoadedParent(B,u),ee=this.findLoadedSibling(B),Q=q||ee||null;Q&&(this._addTile(Q.tileID),T[Q.tileID.key]=Q.tileID),I[z]=B}this._retainLoadedChildren(I,m,p,o);for(const z in T)o[z]||(this._coveredTiles[z]=!0,o[z]=T[z]);if(E){const z={},B={};for(const V of b)this._tiles[V.key].hasData()?z[V.key]=V:B[V.key]=V;for(const V in B){const q=B[V].children(this._source.maxzoom);this._tiles[q[0].key]&&this._tiles[q[1].key]&&this._tiles[q[2].key]&&this._tiles[q[3].key]&&(z[q[0].key]=o[q[0].key]=q[0],z[q[1].key]=o[q[1].key]=q[1],z[q[2].key]=o[q[2].key]=q[2],z[q[3].key]=o[q[3].key]=q[3],delete B[V])}for(const V in B){const q=B[V],ee=this.findLoadedParent(q,this._source.minzoom),Q=this.findLoadedSibling(q),te=ee||Q||null;if(te){z[te.tileID.key]=o[te.tileID.key]=te.tileID;for(const re in z)z[re].isChildOf(te.tileID)&&delete z[re]}}for(const V in this._tiles)z[V]||(this._coveredTiles[V]=!0)}}update(o,u){if(!this._sourceLoaded||this._paused)return;let p;this.transform=o,this.terrain=u,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new y.Z(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(p=xe(o,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(p=p.filter(O=>this._source.hasTile(O)))):p=[];const m=pt(o,this._source),b=Math.max(m-Yt.maxOverzooming,this._source.minzoom),E=Math.max(m+Yt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const O={};for(const z of p)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);O[B.key]=B;const V=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));O[V.key]=V}p=p.concat(Object.values(O))}const T=0===p.length&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new y.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(p,m);Ut(this._source.type)&&this._updateCoveredAndRetainedTiles(I,b,E,m,p,u);for(const O in I)this._tiles[O].clearFadeHold();const R=y.am(this._tiles,I);for(const O of R){const z=this._tiles[O];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(O)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,u){var p;const m={},b={},E=Math.max(u-Yt.maxOverzooming,this._source.minzoom),T=Math.max(u+Yt.maxUnderzooming,this._source.minzoom),I={};for(const R of o){const O=this._addTile(R);m[R.key]=R,O.hasData()||u<this._source.maxzoom&&(I[R.key]=R)}this._retainLoadedChildren(I,u,T,m);for(const R of o){let O=this._tiles[R.key];if(O.hasData())continue;if(u+1>this._source.maxzoom){const B=R.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){m[B.key]=B;continue}}else{const B=R.children(this._source.maxzoom);if(m[B[0].key]&&m[B[1].key]&&m[B[2].key]&&m[B[3].key])continue}let z=O.wasRequested();for(let B=R.overscaledZ-1;B>=E;--B){const V=R.scaledTo(B);if(b[V.key])break;if(b[V.key]=!0,O=this.getTile(V),!O&&z&&(O=this._addTile(V)),O){const q=O.hasData();if((q||!(null!==(p=this.map)&&void 0!==p&&p.cancelPendingTileRequestsWhileZooming)||z)&&(m[V.key]=V),z=O.wasRequested(),q)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let p,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}u.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of u)this._loadedParentTiles[b]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const u=this._tiles[o].tileID,p=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=p}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const p=u;return u||(u=new ql(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(u,o.key,u.state)),u.uses++,this._tiles[o.key]=u,p||this._source.fire(new y.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=u.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}refreshTiles(o){for(const u in this._tiles)(this._isIdRenderable(u)||"errored"==this._tiles[u].state)&&o.some(p=>p.equals(this._tiles[u].tileID.canonical))&&this._reloadTile(u,"expired")}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(o){const u=o.sourceDataType;"source"===o.dataType&&"metadata"===u&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===o.dataType&&"content"===u&&(this.reload(o.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,u,p){const m=[],b=this.transform;if(!b)return m;const E=b.getCoveringTilesDetailsProvider().allowWorldCopies(),T=p?b.getCameraQueryGeometry(o):o,I=V=>b.screenPointToMercatorCoordinate(V,this.terrain),R=this.transformBbox(o,I,!E),O=this.transformBbox(T,I,!E),z=this.getIds(),B=y.a2.fromPoints(O);for(let V=0;V<z.length;V++){const q=this._tiles[z[V]];if(q.holdingForFade())continue;const ee=E?[q.tileID]:[q.tileID.unwrapTo(-1),q.tileID.unwrapTo(0)],Q=Math.pow(2,b.zoom-q.tileID.overscaledZ),te=u*q.queryPadding*y.$/q.tileSize/Q;for(const re of ee){const le=B.map(oe=>re.getTilePoint(new y.a1(oe.x,oe.y)));if(le.expandBy(te),le.intersects(Nt)){const oe=R.map(de=>re.getTilePoint(de)),ue=O.map(de=>re.getTilePoint(de));m.push({tile:q,tileID:E?re:re.unwrapTo(0),queryGeometry:oe,cameraQueryGeometry:ue,scale:Q})}}}return m}transformBbox(o,u,p){let m=o.map(u);if(p){const b=y.a2.fromPoints(o);b.shrinkBy(.001*Math.min(b.width(),b.height()));const E=b.map(u);y.a2.fromPoints(m).covers(E)||(m=m.map(T=>T.x>.5?new y.a1(T.x-1,T.y,T.z):T))}return m}getVisibleCoordinates(o){const u=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(Ut(this._source.type)){const o=wt.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=o)return!0}return!1}setFeatureState(o,u,p){this._state.updateState(o=o||"_geojsonTileLayer",u,p)}removeFeatureState(o,u,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,p)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,p){const m=this._tiles[o];m&&m.setDependencies(u,p)}reloadTilesForDependencies(o,u){for(const p in this._tiles)this._tiles[p].hasDependency(o,u)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,u))}}function _t(v,o){const u=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return v.overscaledZ-o.overscaledZ||p-u||o.canonical.y-v.canonical.y||o.canonical.x-v.canonical.x}function Ut(v){return"raster"===v||"image"===v||"video"===v}Yt.maxOverzooming=10,Yt.maxUnderzooming=3;class Vn{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=y.ah(o,0,1);let u=1,p=this._distances[u];const m=o*this.paddedLength+this.padding;for(;p<m&&u<this._distances.length;)p=this._distances[++u];const b=u-1,E=this._distances[b],T=p-E,I=T>0?(m-E)/T:0;return this.points[b].mult(1-I).add(this.points[u].mult(I))}}function fr(v,o){let u=!0;return"always"===v||"never"!==v&&"never"!==o||(u=!1),u}class qi{constructor(o,u,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(u/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,p,m,b){this._forEachCell(u,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(o,u,p,m){this._forEachCell(u-m,p-m,u+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(p),this.circles.push(m)}_insertBoxCell(o,u,p,m,b,E){this.boxCells[b].push(E)}_insertCircleCell(o,u,p,m,b,E){this.circleCells[b].push(E)}_query(o,u,p,m,b,E,T){if(p<0||o>this.width||m<0||u>this.height)return[];const I=[];if(o<=0&&u<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:o,y1:u,x2:p,y2:m}];for(let R=0;R<this.boxKeys.length;R++)I.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],z=this.circles[3*R+1],B=this.circles[3*R+2];I.push({key:this.circleKeys[R],x1:O-B,y1:z-B,x2:O+B,y2:z+B})}}else this._forEachCell(o,u,p,m,this._queryCell,I,{hitTest:b,overlapMode:E,seenUids:{box:{},circle:{}}},T);return I}query(o,u,p,m){return this._query(o,u,p,m,!1,null)}hitTest(o,u,p,m,b,E){return this._query(o,u,p,m,!0,b,E).length>0}hitTestCircle(o,u,p,m,b){const E=o-p,T=o+p,I=u-p,R=u+p;if(T<0||E>this.width||R<0||I>this.height)return!1;const O=[];return this._forEachCell(E,I,T,R,this._queryCellCircle,O,{hitTest:!0,overlapMode:m,circle:{x:o,y:u,radius:p},seenUids:{box:{},circle:{}}},b),O.length>0}_queryCell(o,u,p,m,b,E,T,I){const{seenUids:R,hitTest:O,overlapMode:z}=T,B=this.boxCells[b];if(null!==B){const q=this.bboxes;for(const ee of B)if(!R.box[ee]){R.box[ee]=!0;const Q=4*ee,te=this.boxKeys[ee];if(o<=q[Q+2]&&u<=q[Q+3]&&p>=q[Q+0]&&m>=q[Q+1]&&(!I||I(te))&&(!O||!fr(z,te.overlapMode))&&(E.push({key:te,x1:q[Q],y1:q[Q+1],x2:q[Q+2],y2:q[Q+3]}),O))return!0}}const V=this.circleCells[b];if(null!==V){const q=this.circles;for(const ee of V)if(!R.circle[ee]){R.circle[ee]=!0;const Q=3*ee,te=this.circleKeys[ee];if(this._circleAndRectCollide(q[Q],q[Q+1],q[Q+2],o,u,p,m)&&(!I||I(te))&&(!O||!fr(z,te.overlapMode))){const re=q[Q],le=q[Q+1],oe=q[Q+2];if(E.push({key:te,x1:re-oe,y1:le-oe,x2:re+oe,y2:le+oe}),O)return!0}}}return!1}_queryCellCircle(o,u,p,m,b,E,T,I){const{circle:R,seenUids:O,overlapMode:z}=T,B=this.boxCells[b];if(null!==B){const q=this.bboxes;for(const ee of B)if(!O.box[ee]){O.box[ee]=!0;const Q=4*ee,te=this.boxKeys[ee];if(this._circleAndRectCollide(R.x,R.y,R.radius,q[Q+0],q[Q+1],q[Q+2],q[Q+3])&&(!I||I(te))&&!fr(z,te.overlapMode))return E.push(!0),!0}}const V=this.circleCells[b];if(null!==V){const q=this.circles;for(const ee of V)if(!O.circle[ee]){O.circle[ee]=!0;const Q=3*ee,te=this.circleKeys[ee];if(this._circlesCollide(q[Q],q[Q+1],q[Q+2],R.x,R.y,R.radius)&&(!I||I(te))&&!fr(z,te.overlapMode))return E.push(!0),!0}}}_forEachCell(o,u,p,m,b,E,T,I){const R=this._convertToXCellCoord(o),O=this._convertToYCellCoord(u),z=this._convertToXCellCoord(p),B=this._convertToYCellCoord(m);for(let V=R;V<=z;V++)for(let q=O;q<=B;q++)if(b.call(this,o,u,p,m,this.xCellCount*q+V,E,T,I))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,p,m,b,E){const T=m-o,I=b-u,R=p+E;return R*R>T*T+I*I}_circleAndRectCollide(o,u,p,m,b,E,T){const I=(E-m)/2,R=Math.abs(o-(m+I));if(R>I+p)return!1;const O=(T-b)/2,z=Math.abs(u-(b+O));if(z>O+p)return!1;if(R<=I||z<=O)return!0;const B=R-I,V=z-O;return B*B+V*V<=p*p}}function Un(v,o,u){const p=y.L();if(!v){const{vecSouth:z,vecEast:B}=hn(o),V=Gs();V[0]=B[0],V[1]=B[1],V[2]=z[0],V[3]=z[1],m=V,(O=(E=(b=V)[0])*(R=b[3])-(I=b[2])*(T=b[1]))&&(m[0]=R*(O=1/O),m[1]=-T*O,m[2]=-I*O,m[3]=E*O),p[0]=V[0],p[1]=V[1],p[4]=V[2],p[5]=V[3]}var m,b,E,T,I,R,O;return y.N(p,p,[1/u,1/u,1]),p}function rn(v,o,u,p){if(v){const m=y.L();if(!o){const{vecSouth:b,vecEast:E}=hn(u);m[0]=E[0],m[1]=E[1],m[4]=b[0],m[5]=b[1]}return y.N(m,m,[p,p,1]),m}return u.pixelsToClipSpaceMatrix}function hn(v){const o=Math.cos(v.rollInRadians),u=Math.sin(v.rollInRadians),p=Math.cos(v.pitchInRadians),m=Math.cos(v.bearingInRadians),b=Math.sin(v.bearingInRadians),E=y.ar();E[0]=-m*p*u-b*o,E[1]=-b*p*u+m*o;const T=y.as(E);T<1e-9?y.at(E):y.au(E,E,1/T);const I=y.ar();I[0]=m*p*o-b*u,I[1]=b*p*o+m*u;const R=y.as(I);return R<1e-9?y.at(I):y.au(I,I,1/R),{vecEast:I,vecSouth:E}}function qt(v,o,u,p){let m;p?(m=[v,o,p(v,o),1],y.aw(m,m,u)):(m=[v,o,0,1],$c(m,m,u));const b=m[3];return{point:new y.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function qe(v,o){return.5+v/o*.5}function Zr(v,o){return v.x>=-o[0]&&v.x<=o[0]&&v.y>=-o[1]&&v.y<=o[1]}function Ei(v,o,u,p,m,b,E,T,I,R,O,z,B){const V=u?v.textSizeData:v.iconSizeData,q=y.an(V,o.transform.zoom),ee=[256/o.width*2+1,256/o.height*2+1],Q=u?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Q.clear();const te=v.lineVertexArray,re=u?v.text.placedSymbolArray:v.icon.placedSymbolArray,le=o.transform.width/o.transform.height;let oe=!1;for(let ue=0;ue<re.length;ue++){const de=re.get(ue);if(de.hidden||de.writingMode===y.ao.vertical&&!oe){on(de.numGlyphs,Q);continue}oe=!1;const se=new y.P(de.anchorX,de.anchorY),ve={getElevation:B,pitchedLabelPlaneMatrix:p,lineVertexArray:te,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:o.transform,tileAnchorPoint:se,unwrappedTileID:I,width:R,height:O,translation:z},Ie=fl(de.anchorX,de.anchorY,ve);if(!Zr(Ie.point,ee)){on(de.numGlyphs,Q);continue}const Ee=qe(o.transform.cameraToCenterDistance,Ie.signedDistanceFromCamera),Me=y.ap(V,q,de),Ae=b?Me*o.transform.getPitchedTextCorrection(de.anchorX,de.anchorY,I)/Ee:Me*Ee,He=it({projectionContext:ve,pitchedLabelPlaneMatrixInverse:m,symbol:de,fontSize:Ae,flip:!1,keepUpright:E,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:le,rotateToLine:T});oe=He.useVertical,(He.notEnoughRoom||oe||He.needsFlipping&&it({projectionContext:ve,pitchedLabelPlaneMatrixInverse:m,symbol:de,fontSize:Ae,flip:!0,keepUpright:E,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:le,rotateToLine:T}).notEnoughRoom)&&on(de.numGlyphs,Q)}u?v.text.dynamicLayoutVertexBuffer.updateData(Q):v.icon.dynamicLayoutVertexBuffer.updateData(Q)}function dl(v,o,u,p,m,b,E,T){const I=b.glyphStartIndex+b.numGlyphs,R=b.lineStartIndex,O=b.lineStartIndex+b.lineLength,z=o.getoffsetX(b.glyphStartIndex),B=o.getoffsetX(I-1),V=Wl(v*z,u,p,m,b.segment,R,O,T,E);if(!V)return null;const q=Wl(v*B,u,p,m,b.segment,R,O,T,E);return q?T.projectionCache.anyProjectionOccluded?null:{first:V,last:q}:null}function Cn(v,o,u,p){return v===y.ao.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*p?{useVertical:!0}:(v===y.ao.vertical?o.y<u.y:o.x>u.x)?{needsFlipping:!0}:null}function it(v){const{projectionContext:o,pitchedLabelPlaneMatrixInverse:u,symbol:p,fontSize:m,flip:b,keepUpright:E,glyphOffsetArray:T,dynamicLayoutVertexArray:I,aspectRatio:R,rotateToLine:O}=v,z=m/24,B=p.lineOffsetX*z,V=p.lineOffsetY*z;let q;if(p.numGlyphs>1){const ee=p.glyphStartIndex+p.numGlyphs,Q=p.lineStartIndex,te=p.lineStartIndex+p.lineLength,re=dl(z,T,B,V,b,p,O,o);if(!re)return{notEnoughRoom:!0};const le=Te(re.first.point.x,re.first.point.y,o,u),oe=Te(re.last.point.x,re.last.point.y,o,u);if(E&&!b){const ue=Cn(p.writingMode,le,oe,R);if(ue)return ue}q=[re.first];for(let ue=p.glyphStartIndex+1;ue<ee-1;ue++){const de=Wl(z*T.getoffsetX(ue),B,V,b,p.segment,Q,te,o,O);if(!de)return{notEnoughRoom:!0};q.push(de)}q.push(re.last)}else{if(E&&!b){const Q=Dr(o.tileAnchorPoint.x,o.tileAnchorPoint.y,o).point,te=p.lineStartIndex+p.segment+1,re=new y.P(o.lineVertexArray.getx(te),o.lineVertexArray.gety(te)),le=Dr(re.x,re.y,o),oe=le.signedDistanceFromCamera>0?le.point:Pt(o.tileAnchorPoint,re,Q,1,o),ue=Te(Q.x,Q.y,o,u),de=Te(oe.x,oe.y,o,u),se=Cn(p.writingMode,ue,de,R);if(se)return se}const ee=Wl(z*T.getoffsetX(p.glyphStartIndex),B,V,b,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,o,O);if(!ee||o.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};q=[ee]}for(const ee of q)y.av(I,ee.point,ee.angle);return{}}function Pt(v,o,u,p,m){const b=v.add(v.sub(o)._unit()),E=Dr(b.x,b.y,m).point,T=u.sub(E);return u.add(T._mult(p/T.mag()))}function Xt(v,o,u){const p=o.projectionCache;if(p.projections[v])return p.projections[v];const m=new y.P(o.lineVertexArray.getx(v),o.lineVertexArray.gety(v)),b=Dr(m.x,m.y,o);if(b.signedDistanceFromCamera>0)return p.projections[v]=b.point,p.anyProjectionOccluded=p.anyProjectionOccluded||b.isOccluded,b.point;const E=v-u.direction;return Pt(0===u.distanceFromAnchor?o.tileAnchorPoint:new y.P(o.lineVertexArray.getx(E),o.lineVertexArray.gety(E)),m,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,o)}function Dr(v,o,u){const p=v+u.translation[0],m=o+u.translation[1];let b;return u.pitchWithMap?(b=qt(p,m,u.pitchedLabelPlaneMatrix,u.getElevation),b.isOccluded=!1):(b=u.transform.projectTileCoordinates(p,m,u.unwrappedTileID,u.getElevation),b.point.x=(.5*b.point.x+.5)*u.width,b.point.y=(.5*-b.point.y+.5)*u.height),b}function Te(v,o,u,p){if(u.pitchWithMap){const m=[v,o,0,1];return y.aw(m,m,p),u.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],u.unwrappedTileID,u.getElevation).point}return{x:v/u.width*2-1,y:1-o/u.height*2}}function fl(v,o,u){return u.transform.projectTileCoordinates(v,o,u.unwrappedTileID,u.getElevation)}function At(v,o,u){return v._unit()._perp()._mult(o*u)}function oi(v,o,u,p,m,b,E,T,I){if(T.projectionCache.offsets[v])return T.projectionCache.offsets[v];const R=u.add(o);if(v+I.direction<p||v+I.direction>=m)return T.projectionCache.offsets[v]=R,R;const O=Xt(v+I.direction,T,I),z=At(O.sub(u),E,I.direction),B=u.add(z),V=O.add(z);return T.projectionCache.offsets[v]=y.ax(b,R,B,V)||R,T.projectionCache.offsets[v]}function Wl(v,o,u,p,m,b,E,T,I){const R=p?v-o:v+o;let O=R>0?1:-1,z=0;p&&(O*=-1,z=Math.PI),O<0&&(z+=Math.PI);let B,V=O>0?b+m:b+m+1;T.projectionCache.cachedAnchorPoint?B=T.projectionCache.cachedAnchorPoint:(B=Dr(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=B);let q,ee,Q=B,te=B,re=0,le=0;const oe=Math.abs(R),ue=[];let de;for(;re+le<=oe;){if(V+=O,V<b||V>=E)return null;re+=le,te=Q,ee=q;const Ie={absOffsetX:oe,direction:O,distanceFromAnchor:re,previousVertex:te};if(Q=Xt(V,T,Ie),0===u)ue.push(te),de=Q.sub(te);else{let Ee;const Me=Q.sub(te);Ee=0===Me.mag()?At(Xt(V+O,T,Ie).sub(Q),u,O):At(Me,u,O),ee||(ee=te.add(Ee)),q=oi(V,Ee,Q,b,E,ee,u,T,Ie),ue.push(ee),de=q.sub(ee)}le=de.mag()}const se=de._mult((oe-re)/le)._add(ee||te),ve=z+Math.atan2(Q.y-te.y,Q.x-te.x);return ue.push(se),{point:se,angle:I?ve:0,path:ue}}const Qd=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function on(v,o){for(let u=0;u<v;u++){const p=o.length;o.resize(p+4),o.float32.set(Qd,3*p)}}function $c(v,o,u){const p=o[0],m=o[1];return v[0]=u[0]*p+u[4]*m+u[12],v[1]=u[1]*p+u[5]*m+u[13],v[3]=u[3]*p+u[7]*m+u[15],v}const Sn=100;class Hc{constructor(o,u=new qi(o.width+200,o.height+200,25),p=new qi(o.width+200,o.height+200,25)){this.transform=o,this.grid=u,this.ignoredGrid=p,this.pitchFactor=Math.cos(o.pitch*Math.PI/180)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Sn,this.screenBottomBoundary=o.height+Sn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,u,p,m,b,E,T,I,R,O,z,B){const V=this.projectAndGetPerspectiveRatio(o.anchorPointX+I[0],o.anchorPointY+I[1],b,O,B),q=p*V.perspectiveRatio;let ee;if(E||T)ee=this._projectCollisionBox(o,q,m,b,E,T,I,V,O,z,B);else{const de=V.x+(z?z.x*q:0),se=V.y+(z?z.y*q:0);ee={allPointsOccluded:!1,box:[de+o.x1*q,se+o.y1*q,de+o.x2*q,se+o.y2*q]}}const[Q,te,re,le]=ee.box,oe=E?ee.allPointsOccluded:V.isOccluded;let ue=oe;return ue||(ue=V.perspectiveRatio<this.perspectiveRatioCutoff),ue||(ue=!this.isInsideGrid(Q,te,re,le)),ue||"always"!==u&&this.grid.hitTest(Q,te,re,le,u,R)?{box:[Q,te,re,le],placeable:!1,offscreen:!1,occluded:oe}:{box:[Q,te,re,le],placeable:!0,offscreen:this.isOffscreen(Q,te,re,le),occluded:oe}}placeCollisionCircles(o,u,p,m,b,E,T,I,R,O,z,B,V,q){const ee=[],Q=new y.P(u.anchorX,u.anchorY),te=this.getPerspectiveRatio(Q.x,Q.y,E,q),re=(R?b*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,E)/te:b*te)/y.aB,le={getElevation:q,pitchedLabelPlaneMatrix:T,lineVertexArray:p,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:V},oe=dl(re,m,u.lineOffsetX*re,u.lineOffsetY*re,!1,u,!1,le);let ue=!1,de=!1,se=!0;if(oe){const ve=.5*z*te+B,Ie=new y.P(-100,-100),Ee=new y.P(this.screenRightBoundary,this.screenBottomBoundary),Me=new Vn,Ae=oe.first,He=oe.last;let Be=[];for(let $t=Ae.path.length-1;$t>=1;$t--)Be.push(Ae.path[$t]);for(let $t=1;$t<He.path.length;$t++)Be.push(He.path[$t]);const ke=2.5*ve;if(R){const $t=this.projectPathToScreenSpace(Be,le);Be=$t.some(Tn=>Tn.signedDistanceFromCamera<=0)?[]:$t.map(Tn=>Tn.point)}let rt=[];if(Be.length>0){const $t=Be[0].clone(),Tn=Be[0].clone();for(let Mn=1;Mn<Be.length;Mn++)$t.x=Math.min($t.x,Be[Mn].x),$t.y=Math.min($t.y,Be[Mn].y),Tn.x=Math.max(Tn.x,Be[Mn].x),Tn.y=Math.max(Tn.y,Be[Mn].y);rt=$t.x>=Ie.x&&Tn.x<=Ee.x&&$t.y>=Ie.y&&Tn.y<=Ee.y?[Be]:Tn.x<Ie.x||$t.x>Ee.x||Tn.y<Ie.y||$t.y>Ee.y?[]:y.ay([Be],Ie.x,Ie.y,Ee.x,Ee.y)}for(const $t of rt){Me.reset($t,.25*ve);let Tn=0;Tn=Me.length<=.5*ve?1:Math.ceil(Me.paddedLength/ke)+1;for(let Mn=0;Mn<Tn;Mn++){const ln=Mn/Math.max(Tn-1,1),hi=Me.lerp(ln),Ii=hi.x+Sn,Ht=hi.y+Sn;ee.push(Ii,Ht,ve,0);const Bn=Ii-ve,mr=Ht-ve,Xn=Ii+ve,cr=Ht+ve;if(se=se&&this.isOffscreen(Bn,mr,Xn,cr),de=de||this.isInsideGrid(Bn,mr,Xn,cr),"always"!==o&&this.grid.hitTestCircle(Ii,Ht,ve,o,O)&&(ue=!0,!I))return{circles:[],offscreen:!1,collisionDetected:ue}}}}return{circles:!I&&ue||!de||te<this.perspectiveRatioCutoff?[]:ee,offscreen:se,collisionDetected:ue}}projectPathToScreenSpace(o,u){return function(m){let b=0,E=0,T=0,I=0;for(let R=0;R<m.length;R++)m[R].isOccluded?(T=R+1,I=0):(I++,I>E&&(E=I,b=T));return m.slice(b,b+E)}(function(m,b){const E=y.L();return y.aq(E,b.pitchedLabelPlaneMatrix),m.map(T=>{const I=qt(T.x,T.y,E,b.getElevation),R=b.transform.projectTileCoordinates(I.point.x,I.point.y,b.unwrappedTileID,b.getElevation);return R.point.x=(.5*R.point.x+.5)*b.width,R.point.y=(.5*-R.point.y+.5)*b.height,R})}(o,u))}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[],p=new y.a2;for(const z of o){const B=new y.P(z.x+Sn,z.y+Sn);p.extend(B),u.push(B)}const{minX:m,minY:b,maxX:E,maxY:T}=p,I=this.grid.query(m,b,E,T).concat(this.ignoredGrid.query(m,b,E,T)),R={},O={};for(const z of I){const B=z.key;if(void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]={}),R[B.bucketInstanceId][B.featureIndex])continue;const V=[new y.P(z.x1,z.y1),new y.P(z.x2,z.y1),new y.P(z.x2,z.y2),new y.P(z.x1,z.y2)];y.az(u,V)&&(R[B.bucketInstanceId][B.featureIndex]=!0,void 0===O[B.bucketInstanceId]&&(O[B.bucketInstanceId]=[]),O[B.bucketInstanceId].push(B.featureIndex))}return O}insertCollisionBox(o,u,p,m,b,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:u},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,p,m,b,E){const T=p?this.ignoredGrid:this.grid,I={bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:u};for(let R=0;R<o.length;R+=4)T.insertCircle(I,o[R],o[R+1],o[R+2])}projectAndGetPerspectiveRatio(o,u,p,m,b){if(b){let E;m?(E=[o,u,m(o,u),1],y.aw(E,E,b)):(E=[o,u,0,1],$c(E,E,b));const T=E[3];return{x:(E[0]/T+1)/2*this.transform.width+Sn,y:(-E[1]/T+1)/2*this.transform.height+Sn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}{const E=this.transform.projectTileCoordinates(o,u,p,m);return{x:(E.point.x+1)/2*this.transform.width+Sn,y:(1-E.point.y)/2*this.transform.height+Sn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5,isOccluded:E.isOccluded,signedDistanceFromCamera:E.signedDistanceFromCamera}}}getPerspectiveRatio(o,u,p,m){const b=this.transform.projectTileCoordinates(o,u,p,m);return.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(o,u,p,m){return p<Sn||o>=this.screenRightBoundary||m<Sn||u>this.screenBottomBoundary}isInsideGrid(o,u,p,m){return p>=0&&o<this.gridRightBoundary&&m>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=y.ag([]);return y.M(o,o,[-100,-100,0]),o}_projectCollisionBox(o,u,p,m,b,E,T,I,R,O,z){let B=1,V=0,q=0,ee=1;const Q=o.anchorPointX+T[0],te=o.anchorPointY+T[1];if(E&&!b){const Be=this.projectAndGetPerspectiveRatio(Q+1,te,m,R,z),ke=Be.x-I.x,rt=Math.atan((Be.y-I.y)/ke)+(ke<0?Math.PI:0),$t=Math.sin(rt),Tn=Math.cos(rt);B=Tn,V=$t,q=-$t,ee=Tn}else if(!E&&b){const Be=hn(this.transform);B=Be.vecEast[0],V=Be.vecEast[1],q=Be.vecSouth[0],ee=Be.vecSouth[1]}let re=I.x,le=I.y,oe=u;b&&(re=Q,le=te,oe=Math.pow(2,-(this.transform.zoom-p.overscaledZ)),oe*=this.transform.getPitchedTextCorrection(Q,te,m),O||(oe*=y.ah(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),O&&(re+=B*O.x*oe+q*O.y*oe,le+=V*O.x*oe+ee*O.y*oe);const ue=o.x1*oe,de=o.x2*oe,se=(ue+de)/2,ve=o.y1*oe,Ie=o.y2*oe,Ee=(ve+Ie)/2,Me=[{offsetX:ue,offsetY:ve},{offsetX:se,offsetY:ve},{offsetX:de,offsetY:ve},{offsetX:de,offsetY:Ee},{offsetX:de,offsetY:Ie},{offsetX:se,offsetY:Ie},{offsetX:ue,offsetY:Ie},{offsetX:ue,offsetY:Ee}];let Ae=[];for(const{offsetX:Be,offsetY:ke}of Me)Ae.push(new y.P(re+B*Be+q*ke,le+V*Be+ee*ke));let He=!1;if(b){const Be=Ae.map(ke=>this.projectAndGetPerspectiveRatio(ke.x,ke.y,m,R,z));He=Be.some(ke=>!ke.isOccluded),Ae=Be.map(ke=>new y.P(ke.x,ke.y))}else He=!0;return{box:y.aA(Ae),allPointsOccluded:!He}}}class Oo{constructor(o,u,p,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):m&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class $n{constructor(o,u,p,m,b){this.text=new Oo(o?o.text:null,u,p,b),this.icon=new Oo(o?o.icon:null,u,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pn{constructor(o,u,p){this.text=o,this.icon=u,this.skipFade=p}}class Vt{constructor(o,u,p,m,b){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class qc{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[o]}}function ir(v,o,u,p,m){const{horizontalAlign:b,verticalAlign:E}=y.aH(v);return new y.P(-(b-.5)*o+p[0]*m,-(E-.5)*u+p[1]*m)}class Zl{constructor(o,u,p,m,b){this.transform=o.clone(),this.terrain=u,this.collisionIndex=new Hc(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new qc(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const u=this.terrain;return u?(p,m)=>u.getElevation(o,p,m):null}getBucketParts(o,u,p,m){const b=p.getBucket(u),E=p.latestFeatureIndex;if(!b||!E||u.id!==b.layerIds[0])return;const T=p.collisionBoxArray,I=b.layers[0].layout,R=b.layers[0].paint,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/y.$,B=p.tileID.toUnwrapped(),V="map"===I.get("text-rotation-alignment"),q=y.aC(p,1,this.transform.zoom),ee=y.aD(this.collisionIndex.transform,p,R.get("text-translate"),R.get("text-translate-anchor")),Q=y.aD(this.collisionIndex.transform,p,R.get("icon-translate"),R.get("icon-translate-anchor")),te=Un(V,this.transform,q);this.retainedQueryData[b.bucketInstanceId]=new Vt(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,p.tileID);const re={bucket:b,layout:I,translationText:ee,translationIcon:Q,unwrappedTileID:B,pitchedLabelPlaneMatrix:te,scale:O,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:y.an(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const le of b.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:ue,symbolInstanceEnd:de}=le;o.push({sortKey:oe,symbolInstanceStart:ue,symbolInstanceEnd:de,parameters:re})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:re})}attemptAnchorPlacement(o,u,p,m,b,E,T,I,R,O,z,B,V,q,ee,Q,te,re,le,oe){const ue=y.aE[o.textAnchor],de=[o.textOffset0,o.textOffset1],se=ir(ue,p,m,de,b),ve=this.collisionIndex.placeCollisionBox(u,B,I,R,O,T,E,Q,z.predicate,le,se,oe);if((!re||this.collisionIndex.placeCollisionBox(re,B,I,R,O,T,E,te,z.predicate,le,se,oe).placeable)&&ve.placeable){let Ie;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ie=this.prevPlacement.variableOffsets[V.crossTileID].anchor),0===V.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:de,width:p,height:m,anchor:ue,textBoxScale:b,prevAnchor:Ie},this.markUsedJustification(q,ue,V,ee),q.allowVerticalPlacement&&(this.markUsedOrientation(q,ee,V),this.placedOrientations[V.crossTileID]=ee),{shift:se,placedGlyphBoxes:ve}}}placeLayerBucketPart(o,u,p){const{bucket:m,layout:b,translationText:E,translationIcon:T,unwrappedTileID:I,pitchedLabelPlaneMatrix:R,textPixelRatio:O,holdingForFade:z,collisionBoxArray:B,partiallyEvaluatedTextSize:V,collisionGroup:q}=o.parameters,ee=b.get("text-optional"),Q=b.get("icon-optional"),te=y.aF(b,"text-overlap","text-allow-overlap"),re="always"===te,le=y.aF(b,"icon-overlap","icon-allow-overlap"),oe="always"===le,ue="map"===b.get("text-rotation-alignment"),de="map"===b.get("text-pitch-alignment"),se="none"!==b.get("icon-text-fit"),ve="viewport-y"===b.get("symbol-z-order"),Ie=re&&(oe||!m.hasIconData()||Q),Ee=oe&&(re||!m.hasTextData()||ee);!m.collisionArrays&&B&&m.deserializeCollisionBoxes(B);const Me=this.retainedQueryData[m.bucketInstanceId].tileID,Ae=this._getTerrainElevationFunc(Me),He=this.transform.getFastPathSimpleProjectionMatrix(Me),Be=(ke,rt,$t)=>{var Tn,Mn;if(u[ke.crossTileID])return;if(z)return void(this.placements[ke.crossTileID]=new Pn(!1,!1,!1));let ln=!1,hi=!1,Ii=!0,Ht=null,Bn={box:null,placeable:!1,offscreen:null,occluded:!1},mr={placeable:!1},Xn=null,cr=null,Jr=null,Pr=0,ca=0,uc=0;rt.textFeatureIndex?Pr=rt.textFeatureIndex:ke.useRuntimeCollisionCircles&&(Pr=ke.featureIndex),rt.verticalTextFeatureIndex&&(ca=rt.verticalTextFeatureIndex);const hc=rt.textBox;if(hc){const Mo=Yi=>{let _r=y.ao.horizontal;if(m.allowVerticalPlacement&&!Yi&&this.prevPlacement){const $o=this.prevPlacement.placedOrientations[ke.crossTileID];$o&&(this.placedOrientations[ke.crossTileID]=$o,_r=$o,this.markUsedOrientation(m,_r,ke))}return _r},Rr=(Yi,_r)=>{if(m.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const $o of m.writingModes)if($o===y.ao.vertical?(Bn=_r(),mr=Bn):Bn=Yi(),Bn&&Bn.placeable)break}else Bn=Yi()},eo=ke.textAnchorOffsetStartIndex,ms=ke.textAnchorOffsetEndIndex;if(ms===eo){const Yi=(_r,$o)=>{const Qn=this.collisionIndex.placeCollisionBox(_r,te,O,Me,I,de,ue,E,q.predicate,Ae,void 0,He);return Qn&&Qn.placeable&&(this.markUsedOrientation(m,$o,ke),this.placedOrientations[ke.crossTileID]=$o),Qn};Rr(()=>Yi(hc,y.ao.horizontal),()=>{const _r=rt.verticalTextBox;return m.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&_r?Yi(_r,y.ao.vertical):{box:null,offscreen:null}}),Mo(Bn&&Bn.placeable)}else{let Yi=y.aE[null===(Mn=null===(Tn=this.prevPlacement)||void 0===Tn?void 0:Tn.variableOffsets[ke.crossTileID])||void 0===Mn?void 0:Mn.anchor];const _r=(Qn,dh,vu)=>{const ua=Qn.x2-Qn.x1,ha=Qn.y2-Qn.y1,Ml=ke.textBoxScale,bf=se&&"never"===le?dh:null;let Do=null,Dl="never"===te?1:2,bu="never";Yi&&Dl++;for(let fd=0;fd<Dl;fd++){for(let pd=eo;pd<ms;pd++){const _s=m.textAnchorOffsets.get(pd);if(Yi&&_s.textAnchor!==Yi)continue;const Ka=this.attemptAnchorPlacement(_s,Qn,ua,ha,Ml,ue,de,O,Me,I,q,bu,ke,m,vu,E,T,bf,Ae);if(Ka&&(Do=Ka.placedGlyphBoxes,Do&&Do.placeable))return ln=!0,Ht=Ka.shift,Do}Yi?Yi=null:bu=te}return p&&!Do&&(Do={box:this.collisionIndex.placeCollisionBox(hc,"always",O,Me,I,de,ue,E,q.predicate,Ae,void 0,He).box,offscreen:!1,placeable:!1,occluded:!1}),Do};Rr(()=>_r(hc,rt.iconBox,y.ao.horizontal),()=>{const Qn=rt.verticalTextBox;return m.allowVerticalPlacement&&(!Bn||!Bn.placeable)&&ke.numVerticalGlyphVertices>0&&Qn?_r(Qn,rt.verticalIconBox,y.ao.vertical):{box:null,occluded:!0,offscreen:null}}),Bn&&(ln=Bn.placeable,Ii=Bn.offscreen);const $o=Mo(Bn&&Bn.placeable);if(!ln&&this.prevPlacement){const Qn=this.prevPlacement.variableOffsets[ke.crossTileID];Qn&&(this.variableOffsets[ke.crossTileID]=Qn,this.markUsedJustification(m,Qn.anchor,ke,$o))}}}if(Xn=Bn,ln=Xn&&Xn.placeable,Ii=Xn&&Xn.offscreen,ke.useRuntimeCollisionCircles){const Mo=m.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex),Rr=y.ap(m.textSizeData,V,Mo),eo=b.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(te,Mo,m.lineVertexArray,m.glyphOffsetArray,Rr,I,R,p,de,q.predicate,ke.collisionCircleDiameter,eo,E,Ae),cr.circles.length&&cr.collisionDetected&&!p&&y.w("Collisions detected, but collision boxes are not shown"),ln=re||cr.circles.length>0&&!cr.collisionDetected,Ii=Ii&&cr.offscreen}if(rt.iconFeatureIndex&&(uc=rt.iconFeatureIndex),rt.iconBox){const Mo=Rr=>this.collisionIndex.placeCollisionBox(Rr,le,O,Me,I,de,ue,T,q.predicate,Ae,se&&Ht?Ht:void 0,He);mr&&mr.placeable&&rt.verticalIconBox?(Jr=Mo(rt.verticalIconBox),hi=Jr.placeable):(Jr=Mo(rt.iconBox),hi=Jr.placeable),Ii=Ii&&Jr.offscreen}const El=ee||0===ke.numHorizontalGlyphVertices&&0===ke.numVerticalGlyphVertices,yu=Q||0===ke.numIconVertices;El||yu?yu?El||(hi=hi&&ln):ln=hi&&ln:hi=ln=hi&&ln;const Za=hi&&Jr.placeable;if(ln&&Xn.placeable&&this.collisionIndex.insertCollisionBox(Xn.box,te,b.get("text-ignore-placement"),m.bucketInstanceId,mr&&mr.placeable&&ca?ca:Pr,q.ID),Za&&this.collisionIndex.insertCollisionBox(Jr.box,le,b.get("icon-ignore-placement"),m.bucketInstanceId,uc,q.ID),cr&&ln&&this.collisionIndex.insertCollisionCircles(cr.circles,te,b.get("text-ignore-placement"),m.bucketInstanceId,Pr,q.ID),p&&this.storeCollisionData(m.bucketInstanceId,$t,rt,Xn,Jr,cr),0===ke.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===m.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ke.crossTileID]=new Pn((ln||Ie)&&!Xn?.occluded,(hi||Ee)&&!Jr?.occluded,Ii||m.justReloaded),u[ke.crossTileID]=!0};if(ve){if(0!==o.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const ke=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let rt=ke.length-1;rt>=0;--rt){const $t=ke[rt];Be(m.symbolInstances.get($t),m.collisionArrays[$t],$t)}}else for(let ke=o.symbolInstanceStart;ke<o.symbolInstanceEnd;ke++)Be(m.symbolInstances.get(ke),m.collisionArrays[ke],ke);m.justReloaded=!1}storeCollisionData(o,u,p,m,b,E){if(p.textBox||p.iconBox){let T,I;this.collisionBoxArrays.has(o)?T=this.collisionBoxArrays.get(o):(T=new Map,this.collisionBoxArrays.set(o,T)),T.has(u)?I=T.get(u):(I={text:null,icon:null},T.set(u,I)),p.textBox&&(I.text=m.box),p.iconBox&&(I.icon=b.box)}if(E){let T=this.collisionCircleArrays[o];void 0===T&&(T=this.collisionCircleArrays[o]=[]);for(let I=0;I<E.circles.length;I+=4)T.push(E.circles[I+0]-Sn),T.push(E.circles[I+1]-Sn),T.push(E.circles[I+2]),T.push(E.collisionDetected?1:0)}}markUsedJustification(o,u,p,m){let b;b=m===y.ao.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[y.aG(u)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const T of E)T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=b>=0&&T!==b?0:p.crossTileID)}markUsedOrientation(o,u,p){const m=u===y.ao.horizontal||u===y.ao.horizontalOnly?u:0,b=u===y.ao.vertical?u:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const T of E)o.text.placedSymbolArray.get(T).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const m=u?u.symbolFadeChange(o):1,b=u?u.opacities:{},E=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(const I in this.placements){const R=this.placements[I],O=b[I];O?(this.opacities[I]=new $n(O,m,R.text,R.icon),p=p||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[I]=new $n(null,m,R.text,R.icon,R.skipFade),p=p||R.text||R.icon)}for(const I in b){const R=b[I];if(!this.opacities[I]){const O=new $n(R,m,!1,!1);O.isHidden()||(this.opacities[I]=O,p=p||R.text.placed||R.icon.placed)}}for(const I in E)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=E[I]);for(const I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);if(u&&void 0===u.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const p={};for(const m of u){const b=m.getBucket(o);b&&m.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(o,u,p,m){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const b=o.layers[0],E=b.layout,T=new $n(null,0,!1,!1,!0),I=E.get("text-allow-overlap"),R=E.get("icon-allow-overlap"),O=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z="map"===E.get("text-rotation-alignment"),B="map"===E.get("text-pitch-alignment"),V="none"!==E.get("icon-text-fit"),q=new $n(null,0,I&&(R||!o.hasIconData()||E.get("icon-optional")),R&&(I||!o.hasTextData()||E.get("text-optional")),!0);!o.collisionArrays&&m&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(m);const ee=(te,re,le)=>{for(let oe=0;oe<re/4;oe++)te.opacityVertexArray.emplaceBack(le);te.hasVisibleVertices=te.hasVisibleVertices||le!==Wc},Q=this.collisionBoxArrays.get(o.bucketInstanceId);for(let te=0;te<o.symbolInstances.length;te++){const re=o.symbolInstances.get(te),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:oe,crossTileID:ue}=re;let de=this.opacities[ue];p[ue]?de=T:de||(de=q,this.opacities[ue]=de),p[ue]=!0;const se=re.numIconVertices>0,ve=this.placedOrientations[re.crossTileID],Ie=ve===y.ao.vertical,Ee=ve===y.ao.horizontal||ve===y.ao.horizontalOnly;if(le>0||oe>0){const Ae=Ip(de.text);ee(o.text,le,Ie?Wc:Ae),ee(o.text,oe,Ee?Wc:Ae);const He=de.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach(rt=>{rt>=0&&(o.text.placedSymbolArray.get(rt).hidden=He||Ie?1:0)}),re.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=He||Ee?1:0);const Be=this.variableOffsets[re.crossTileID];Be&&this.markUsedJustification(o,Be.anchor,re,ve);const ke=this.placedOrientations[re.crossTileID];ke&&(this.markUsedJustification(o,"left",re,ke),this.markUsedOrientation(o,ke,re))}if(se){const Ae=Ip(de.icon),He=!(V&&re.verticalPlacedIconSymbolIndex&&Ie);re.placedIconSymbolIndex>=0&&(ee(o.icon,re.numIconVertices,He?Ae:Wc),o.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=de.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&(ee(o.icon,re.numVerticalIconVertices,He?Wc:Ae),o.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}const Me=Q&&Q.has(te)?Q.get(te):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ae=o.collisionArrays[te];if(Ae){let He=new y.P(0,0);if(Ae.textBox||Ae.verticalTextBox){let Be=!0;if(O){const ke=this.variableOffsets[ue];ke?(He=ir(ke.anchor,ke.width,ke.height,ke.textOffset,ke.textBoxScale),z&&He._rotate(B?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Be=!1}if(Ae.textBox||Ae.verticalTextBox){let ke;Ae.textBox&&(ke=Ie),Ae.verticalTextBox&&(ke=Ee),Jd(o.textCollisionBox.collisionVertexArray,de.text.placed,!Be||ke,Me.text,He.x,He.y)}}if(Ae.iconBox||Ae.verticalIconBox){const Be=!(Ee||!Ae.verticalIconBox);let ke;Ae.iconBox&&(ke=Be),Ae.verticalIconBox&&(ke=!Be),Jd(o.iconCollisionBox.collisionVertexArray,de.icon.placed,ke,Me.icon,V?He.x:0,V?He.y:0)}}}}if(o.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);o.bucketInstanceId in this.collisionCircleArrays&&(o.collisionCircleArray=this.collisionCircleArrays[o.bucketInstanceId],delete this.collisionCircleArrays[o.bucketInstanceId])}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function Jd(v,o,u,p,m,b){p&&0!==p.length||(p=[0,0,0,0]);const E=p[0]-Sn,T=p[1]-Sn,I=p[2]-Sn,R=p[3]-Sn;v.emplaceBack(o?1:0,u?1:0,m||0,b||0,E,T),v.emplaceBack(o?1:0,u?1:0,m||0,b||0,I,T),v.emplaceBack(o?1:0,u?1:0,m||0,b||0,I,R),v.emplaceBack(o?1:0,u?1:0,m||0,b||0,E,R)}const Cm=Math.pow(2,25),Aa=Math.pow(2,24),Zu=Math.pow(2,17),Tm=Math.pow(2,16),F0=Math.pow(2,9),Im=Math.pow(2,8),Am=Math.pow(2,1);function Ip(v){if(0===v.opacity&&!v.placed)return 0;if(1===v.opacity&&v.placed)return 4294967295;const o=v.placed?1:0,u=Math.floor(127*v.opacity);return u*Cm+o*Aa+u*Zu+o*Tm+u*F0+o*Im+u*Am+o}const Wc=0;class Ap{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,p,m,b){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(E,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((T,I)=>T.sortKey-I.sortKey));this._currentPartIndex<E.length;)if(u.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Cr{constructor(o,u,p,m,b,E,T,I){this.placement=new Zl(o,u,E,T,I),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,u,p){const m=wt.now(),b=()=>!this._forceFullPlacement&&wt.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=u[o[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=T)&&(!E.maxzoom||E.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Ap(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const xt=512/y.$/2;class Pp{constructor(o,u,p){this.tileID=o,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<u.length;b++){const E=u.get(b),T=E.key,I=m.get(T);I?I.push(E):m.set(T,[E])}for(const[b,E]of m){const T={positions:E.map(I=>({x:Math.floor(I.anchorX*xt),y:Math.floor(I.anchorY*xt)})),crossTileIDs:E.map(I=>I.crossTileID)};if(T.positions.length>128){const I=new y.aI(T.positions.length,16,Uint16Array);for(const{x:R,y:O}of T.positions)I.add(R,O);I.finish(),delete T.positions,T.index=I}this._symbolsByKey[b]=T}}getScaledCoordinates(o,u){const{x:p,y:m,z:b}=this.tileID.canonical,{x:E,y:T,z:I}=u.canonical,R=xt/Math.pow(2,I-b),O=(T*y.$+o.anchorY)*R,z=m*y.$*xt;return{x:Math.floor((E*y.$+o.anchorX)*R-p*y.$*xt),y:Math.floor(O-z)}}findMatches(o,u,p){const m=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<o.length;b++){const E=o.get(b);if(E.crossTileID)continue;const T=this._symbolsByKey[E.key];if(!T)continue;const I=this.getScaledCoordinates(E,u);if(T.index){const R=T.index.range(I.x-m,I.y-m,I.x+m,I.y+m).sort();for(const O of R){const z=T.crossTileIDs[O];if(!p[z]){p[z]=!0,E.crossTileID=z;break}}}else if(T.positions)for(let R=0;R<T.positions.length;R++){const O=T.positions[R],z=T.crossTileIDs[R];if(Math.abs(O.x-I.x)<=m&&Math.abs(O.y-I.y)<=m&&!p[z]){p[z]=!0,E.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Rp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(0!==u)for(const p in this.indexes){const m=this.indexes[p],b={};for(const E in m){const T=m[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),b[T.tileID.key]=T}this.indexes[p]=b}this.lng=o}addBucket(o,u,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>o.overscaledZ)for(const T in E){const I=E[T];I.tileID.isChildOf(o)&&I.findMatches(u.symbolInstances,o,m)}else{const T=E[o.scaledTo(Number(b)).key];T&&T.findMatches(u.symbolInstances,o,m)}}for(let b=0;b<u.symbolInstances.length;b++){const E=u.symbolInstances.get(b);E.crossTileID||(E.crossTileID=p.generate(),m[E.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Pp(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const p of u.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let u=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)o[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],u=!0)}return u}}class Ku{constructor(){this.layerIndexes={},this.crossTileIDs=new Rp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,p){let m=this.layerIndexes[o.id];void 0===m&&(m=this.layerIndexes[o.id]=new Pm);let b=!1;const E={};m.handleWrapJump(p);for(const T of u){const I=T.getBucket(o);I&&o.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(T.tileID,I,this.crossTileIDs)&&(b=!0),E[I.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(o){const u={};o.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}var Uh="void main() {fragColor=vec4(1.0);}";const Xe={prelude:sn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:sn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:sn("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:sn("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:sn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:sn("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:sn(Uh,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:sn("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:sn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:sn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:sn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:sn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:sn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:sn(Uh,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:sn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:sn("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:sn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:sn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:sn("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:sn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:sn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:sn("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:sn("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:sn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:sn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:sn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:sn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:sn("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:sn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:sn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:sn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:sn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:sn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:sn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:sn("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:sn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function sn(v,o){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/in ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=b?b.concat(m):m,T={};return{fragmentSource:v=v.replace(u,(I,R,O,z,B)=>(T[B]=!0,"define"===R?`\n#ifndef HAS_UNIFORM_u_${B}\nin ${O} ${z} ${B};\n#else\nuniform ${O} ${z} u_${B};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${B}\n    ${O} ${z} ${B} = u_${B};\n#endif\n`)),vertexSource:o=o.replace(u,(I,R,O,z,B)=>{const V="float"===z?"vec2":"vec4",q=B.match(/color/)?"color":V;return T[B]?"define"===R?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nin ${O} ${V} a_${B};\nout ${O} ${z} ${B};\n#else\nuniform ${O} ${z} u_${B};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = a_${B};\n#else\n    ${O} ${z} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = unpack_mix_${q}(a_${B}, u_${B}_t);\n#else\n    ${O} ${z} ${B} = u_${B};\n#endif\n`:"define"===R?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nin ${O} ${V} a_${B};\n#else\nuniform ${O} ${z} u_${B};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${O} ${z} ${B} = a_${B};\n#else\n    ${O} ${z} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${O} ${z} ${B} = unpack_mix_${q}(a_${B}, u_${B}_t);\n#else\n    ${O} ${z} ${B} = u_${B};\n#endif\n`}),staticAttributes:p,staticUniforms:E}}class Hn{constructor(o,u,p){this.vertexBuffer=o,this.indexBuffer=u,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ms=y.aJ([{name:"a_pos",type:"Int16",components:2}]);const Pa="#define PROJECTION_MERCATOR",Kl="mercator";class nn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Kl}get shaderDefine(){return Pa}get shaderPreludeCode(){return Xe.projectionMercator}get vertexShaderPreludeCode(){return Xe.projectionMercator.vertexSource}get subdivisionGranularity(){return y.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(o){}getMeshFromTileID(o,u,p,m,b){if(this._cachedMesh)return this._cachedMesh;const E=new y.aL;E.emplaceBack(0,0),E.emplaceBack(y.$,0),E.emplaceBack(0,y.$),E.emplaceBack(y.$,y.$);const T=o.createVertexBuffer(E,Ms.members),I=y.aM.simpleSegment(0,0,4,2),R=new y.aN;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const O=o.createIndexBuffer(R);return this._cachedMesh=new Hn(T,O,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(o){}}class Ys{constructor(o=0,u=0,p=0,m=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=p,this.right=m}interpolate(o,u,p){return null!=u.top&&null!=o.top&&(this.top=y.C.number(o.top,u.top,p)),null!=u.bottom&&null!=o.bottom&&(this.bottom=y.C.number(o.bottom,u.bottom,p)),null!=u.left&&null!=o.left&&(this.left=y.C.number(o.left,u.left,p)),null!=u.right&&null!=o.right&&(this.right=y.C.number(o.right,u.right,p)),this}getCenter(o,u){const p=y.ah((this.left+o-this.right)/2,0,o),m=y.ah((this.top+u-this.bottom)/2,0,u);return new y.P(p,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ys(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Yl(v,o){if(!v.renderWorldCopies||v.lngRange)return;const u=o.lng-v.center.lng;o.lng+=u>180?-360:u<-180?360:0}function Zc(v){return Math.max(0,Math.floor(v))}class $e{constructor(o,u,p,m,b,E){this._callbacks=o,this._tileSize=512,this._renderWorldCopies=void 0===E||!!E,this._minZoom=u||0,this._maxZoom=p||22,this._minPitch=m??0,this._maxPitch=b??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new y.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Zc(this._zoom),this._scale=y.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ys,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(o,u,p){this._latRange=o.latRange,this._lngRange=o.lngRange,this._width=o.width,this._height=o.height,this._center=o.center,this._elevation=o.elevation,this._minElevationForCurrentTile=o.minElevationForCurrentTile,this._zoom=o.zoom,this._tileZoom=Zc(this._zoom),this._scale=y.af(this._zoom),this._bearingInRadians=o.bearingInRadians,this._fovInRadians=o.fovInRadians,this._pitchInRadians=o.pitchInRadians,this._rollInRadians=o.rollInRadians,this._unmodified=o.unmodified,this._edgeInsets=new Ys(o.padding.top,o.padding.bottom,o.padding.left,o.padding.right),this._minZoom=o.minZoom,this._maxZoom=o.maxZoom,this._minPitch=o.minPitch,this._maxPitch=o.maxPitch,this._renderWorldCopies=o.renderWorldCopies,this._cameraToCenterDistance=o.cameraToCenterDistance,this._nearZ=o.nearZ,this._farZ=o.farZ,this._autoCalculateNearFarZ=!p&&o.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(o){this._minElevationForCurrentTile=o}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(o){this._minZoom!==o&&(this._minZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(o){this._minPitch!==o&&(this._minPitch=o,this.setPitch(Math.max(this.pitch,o)))}get maxPitch(){return this._maxPitch}setMaxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.setPitch(Math.min(this.pitch,o)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new y.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(o){const u=y.aO(o,-180,180)*Math.PI/180;var p,m,b,E,T,I,R,O,z;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=Gs(),p=this._rotationMatrix,b=-this._bearingInRadians,E=(m=this._rotationMatrix)[0],T=m[1],I=m[2],R=m[3],O=Math.sin(b),z=Math.cos(b),p[0]=E*z+I*O,p[1]=T*z+R*O,p[2]=E*-O+I*z,p[3]=T*-O+R*z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(o){const u=y.ah(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(o){const u=o/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return y.aP(this._fovInRadians)}setFov(o){o=y.ah(o,.1,150),this.fov!==o&&(this._unmodified=!1,this._fovInRadians=y.ae(o),this._calcMatrices())}get zoom(){return this._zoom}setZoom(o){const u=this.getConstrained(this._center,o).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=y.af(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(o,u){this._autoCalculateNearFarZ=!1,this._nearZ=o,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,p){this._unmodified=!1,this._edgeInsets.interpolate(o,u,p),this._constrain(),this._calcMatrices()}resize(o,u,p=!0){this._width=o,this._height=u,p&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new Li([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(o){o?(this._lngRange=[o.getWest(),o.getEast()],this._latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-y.ai,y.ai])}getConstrained(o,u){return this._callbacks.getConstrained(o,u)}getCameraQueryGeometry(o,u){if(1===u.length)return[u[0],o];{const{minX:p,minY:m,maxX:b,maxY:E}=y.a2.fromPoints(u).extend(o);return[new y.P(p,m),new y.P(b,m),new y.P(b,E),new y.P(p,E),new y.P(p,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:u,zoom:p}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(p),this._unmodified=o,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let o=y.ag(new Float64Array(16));y.N(o,o,[this._width/2,-this._height/2,1]),y.M(o,o,[1,-1,0]),this._clipSpaceToPixelsMatrix=o,o=y.ag(new Float64Array(16)),y.N(o,o,[1,-1,1]),y.M(o,o,[-1,-1,0]),y.N(o,o,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=o,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(o,u,p,m){const b=void 0!==p?p:this.bearing,E=m=void 0!==m?m:this.pitch,T=y.a1.fromLngLat(o,u),I=-Math.cos(y.ae(E)),R=Math.sin(y.ae(E)),O=R*Math.sin(y.ae(b)),z=-R*Math.cos(y.ae(b));let B=this.elevation;const V=u-B;let q;I*V>=0||Math.abs(I)<.1?(q=1e4,B=u+q*I):q=-V/I;let ee,Q,te=y.aQ(1,T.y),re=0;do{if(re+=1,re>10)break;Q=q/te,ee=new y.a1(T.x+O*Q,T.y+z*Q),te=1/ee.meterInMercatorCoordinateUnits()}while(Math.abs(q-Q*te)>1e-12);return{center:ee.toLngLat(),elevation:B,zoom:y.ak(this.height/2/Math.tan(this.fovInRadians/2)/Q/this.tileSize)}}recalculateZoomAndCenter(o){if(this.elevation-o==0)return;const u=y.aj(1,this.center.lat)*this.worldSize,p=this.cameraToCenterDistance/u,m=y.a1.fromLngLat(this.center,this.elevation),b=Ce(this.center,this.elevation,this.pitch,this.bearing,p);this._elevation=o;const E=this.calculateCenterFromCameraLngLatAlt(b.toLngLat(),y.aQ(b.z,m.y),this.bearing,this.pitch);this._elevation=E.elevation,this._center=E.center,this.setZoom(E.zoom)}getCameraPoint(){const o=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.P(o*Math.sin(this.rollInRadians),o*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const o=y.aj(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/o).toLngLat()}getMercatorTileCoordinates(o){if(!o)return[0,0,1,1];const u=o.canonical.z>=0?1<<o.canonical.z:Math.pow(2,o.canonical.z);return[o.canonical.x/u,o.canonical.y/u,1/u/y.$,1/u/y.$]}}class rr{constructor(o,u){this.min=o,this.max=u,this.center=y.aR([],y.aS([],this.min,this.max),.5)}quadrant(o){const u=[o%2==0,o<2],p=y.aT(this.min),m=y.aT(this.max);for(let b=0;b<u.length;b++)p[b]=u[b]?this.min[b]:this.center[b],m[b]=u[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new rr(p,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersectsFrustum(o){let u=!0;for(let p=0;p<o.planes.length;p++){const m=this.intersectsPlane(o.planes[p]);if(0===m)return 0;1===m&&(u=!1)}return u?2:o.aabb.min[0]>this.max[0]||o.aabb.min[1]>this.max[1]||o.aabb.min[2]>this.max[2]||o.aabb.max[0]<this.min[0]||o.aabb.max[1]<this.min[1]||o.aabb.max[2]<this.min[2]?0:1}intersectsPlane(o){let u=o[3],p=o[3];for(let m=0;m<3;m++)o[m]>0?(u+=o[m]*this.min[m],p+=o[m]*this.max[m]):(p+=o[m]*this.min[m],u+=o[m]*this.max[m]);return u>=0?2:p<0?0:1}}class pr{distanceToTile2d(o,u,p,m){const b=m.distanceX([o,u]),E=m.distanceY([o,u]);return Math.hypot(b,E)}getWrap(o,u,p){return p}getTileBoundingVolume(o,u,p,m){var b,E;let T=0,I=0;if(m?.terrain){const O=new y.Z(o.z,u,o.z,o.x,o.y),z=m.terrain.getMinMaxElevation(O);T=null!==(b=z.minElevation)&&void 0!==b?b:Math.min(0,p),I=null!==(E=z.maxElevation)&&void 0!==E?E:Math.max(0,p)}const R=1<<o.z;return new rr([u+o.x/R,o.y/R,T],[u+(o.x+1)/R,(o.y+1)/R,I])}allowVariableZoom(o,u){const p=o.fov*(Math.abs(Math.cos(o.rollInRadians))*o.height+Math.abs(Math.sin(o.rollInRadians))*o.width)/o.height,m=y.ah(78.5-p/2,0,60);return!!u.terrain||o.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class Mi{constructor(o,u,p){this.points=o,this.planes=u,this.aabb=p}static fromInvProjectionMatrix(o,u=1,p=0,m,b){const E=b?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],T=Math.pow(2,p),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>function(V,q,ee,Q){const te=y.aw([],V,q),re=1/te[3]/ee*Q;return y.aY(te,te,[re,re,1/te[3],re])}(B,o,u,T));m&&function(B,V,q,ee){const Q=ee?4:0,te=ee?0:4;let re=0;const le=[],oe=[];for(let se=0;se<4;se++){const ve=y.aU([],B[se+te],B[se+Q]),Ie=y.aZ(ve);y.aR(ve,ve,1/Ie),le.push(Ie),oe.push(ve)}for(let se=0;se<4;se++){const ve=y.a_(B[se+Q],oe[se],q);re=null!==ve&&ve>=0?Math.max(re,ve):Math.max(re,le[se])}const ue=function(se,ve){const Ie=y.aU([],se[ve[0]],se[ve[1]]),Ee=y.aU([],se[ve[2]],se[ve[1]]),Me=[0,0,0,0];return y.aV(Me,y.aW([],Ie,Ee)),Me[3]=-y.aX(Me,se[ve[0]]),Me}(B,V),de=function(se,ve){const Ie=y.a$(se),Ee=y.b0([],se,1/Ie),Me=y.aU([],ve,y.aR([],Ee,y.aX(ve,Ee))),Ae=y.a$(Me);if(Ae>0){const He=Math.sqrt(1-Ee[3]*Ee[3]),Be=y.aR([],Ee,-Ee[3]),ke=y.aS([],Be,y.aR([],Me,He/Ae));return y.b1(ve,ke)}return null}(q,ue);if(null!==de){const se=de/y.aX(oe[0],ue);re=Math.min(re,se)}for(let se=0;se<4;se++){const ve=Math.min(re,le[se]);B[se+te]=[B[se+Q][0]+oe[se][0]*ve,B[se+Q][1]+oe[se][1]*ve,B[se+Q][2]+oe[se][2]*ve,1]}}(I,E[0],m,b);const R=E.map(B=>{const V=y.aU([],I[B[0]],I[B[1]]),q=y.aU([],I[B[2]],I[B[1]]),ee=y.aV([],y.aW([],V,q)),Q=-y.aX(ee,I[B[1]]);return ee.concat(Q)}),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const B of I)for(let V=0;V<3;V++)O[V]=Math.min(O[V],B[V]),z[V]=Math.max(z[V],B[V]);return new Mi(I,R,new rr(O,z))}}class En{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,p){return this._helper.interpolatePadding(o,u,p)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,p=!0){this._helper.resize(o,u,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o,u){}constructor(o,u,p,m,b){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new $e({calcMatrices:()=>{this._calcMatrices()},getConstrained:(E,T)=>this.getConstrained(E,T)},o,u,p,m,b),this._coveringTilesDetailsProvider=new pr}clone(){const o=new En;return o.apply(this),o}apply(o,u,p){this._helper.apply(o,u,p)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(o){const u=[new y.b2(0,o)];if(this._helper._renderWorldCopies){const p=this.screenPointToMercatorCoordinate(new y.P(0,0)),m=this.screenPointToMercatorCoordinate(new y.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new y.P(this._helper._width,this._helper._height)),E=this.screenPointToMercatorCoordinate(new y.P(0,this._helper._height)),T=Math.floor(Math.min(p.x,m.x,b.x,E.x)),I=Math.floor(Math.max(p.x,m.x,b.x,E.x)),R=1;for(let O=T-R;O<=I+R;O++)0!==O&&u.push(new y.b2(O,o))}return u}getCameraFrustum(){return Mi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){const u=this.screenPointToLocation(this.centerPoint,o),p=o?o.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(p)}setLocationAtPoint(o,u){const p=y.aj(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(u,p),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,p),E=y.a1.fromLngLat(o),T=new y.a1(E.x-(m.x-b.x),E.y-(m.y-b.y));this.setCenter(T?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(o,u){return u?this.coordinatePoint(y.a1.fromLngLat(o),u.getElevationForLngLatZoom(o,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(y.a1.fromLngLat(o))}screenPointToLocation(o,u){var p;return null===(p=this.screenPointToMercatorCoordinate(o,u))||void 0===p?void 0:p.toLngLat()}screenPointToMercatorCoordinate(o,u){if(u){const p=u.pointCoordinate(o);if(null!=p)return p}return this.screenPointToMercatorCoordinateAtZ(o)}screenPointToMercatorCoordinateAtZ(o,u){const p=u||0,m=[o.x,o.y,0,1],b=[o.x,o.y,1,1];y.aw(m,m,this._pixelMatrixInverse),y.aw(b,b,this._pixelMatrixInverse);const E=m[3],T=b[3],I=m[1]/E,R=b[1]/T,O=m[2]/E,z=b[2]/T,B=O===z?0:(p-O)/(z-O);return new y.a1(y.C.number(m[0]/E,b[0]/T,B)/this.worldSize,y.C.number(I,R,B)/this.worldSize,p)}coordinatePoint(o,u=0,p=this._pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,u,1];return y.aw(m,m,p),new y.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this._helper._height/2-pe(this));return(new Li).extend(this.screenPointToLocation(new y.P(0,o))).extend(this.screenPointToLocation(new y.P(this._helper._width,o))).extend(this.screenPointToLocation(new y.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new y.P(0,this._helper._height)))}isPointOnMapSurface(o,u){return u?null!=u.pointCoordinate(o):o.y>this.height/2-pe(this)}calculatePosMatrix(o,u=!1,p){var m;const b=null!==(m=o.key)&&void 0!==m?m:y.b3(o.wrap,o.canonical.z,o.canonical.z,o.canonical.x,o.canonical.y),E=u?this._alignedPosMatrixCache:this._posMatrixCache;if(E.has(b)){const R=E.get(b);return p?R.f32:R.f64}const T=we(o,this.worldSize);y.O(T,u?this._alignedProjMatrix:this._viewProjMatrix,T);const I={f64:T,f32:new Float32Array(T)};return E.set(b,I),p?I.f32:I.f64}calculateFogMatrix(o){const u=o.key,p=this._fogMatrixCacheF32;if(p.has(u))return p.get(u);const m=we(o,this.worldSize);return y.O(m,this._fogMatrix,m),p.set(u,new Float32Array(m)),p.get(u)}getConstrained(o,u){u=y.ah(+u,this.minZoom,this.maxZoom);const p={center:new y.S(o.lng,o.lat),zoom:u};let m=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===m){const le=179.9999999999;m=[-le,le]}const b=this.tileSize*y.af(p.zoom);let E=0,T=b,I=0,R=b,O=0,z=0;const{x:B,y:V}=this.size;if(this._helper._latRange){const le=this._helper._latRange;E=y.U(le[1])*b,T=y.U(le[0])*b,T-E<V&&(O=V/(T-E))}m&&(I=y.aO(y.V(m[0])*b,0,b),R=y.aO(y.V(m[1])*b,0,b),R<I&&(R+=b),R-I<B&&(z=B/(R-I)));const{x:q,y:ee}=X(b,o);let Q,te;const re=Math.max(z||0,O||0);if(re){const le=new y.P(z?(R+I)/2:q,O?(T+E)/2:ee);return p.center=ae(b,le).wrap(),p.zoom+=y.ak(re),p}if(this._helper._latRange){const le=V/2;ee-le<E&&(te=E+le),ee+le>T&&(te=T-le)}if(m){const le=(I+R)/2;let oe=q;this._helper._renderWorldCopies&&(oe=y.aO(q,le-b/2,le+b/2));const ue=B/2;oe-ue<I&&(Q=I+ue),oe+ue>R&&(Q=R-ue)}if(void 0!==Q||void 0!==te){const le=new y.P(Q??q,te??ee);p.center=ae(b,le).wrap()}return p}calculateCenterFromCameraLngLatAlt(o,u,p,m){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,p,m)}_calculateNearFarZIfNeeded(o,u,p){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=o-m*this._helper._pixelPerMeter/Math.cos(u),E=m<0?b:o,T=Math.PI/2+this.pitchInRadians,I=y.ae(this.fov)*(Math.abs(Math.cos(y.ae(this.roll)))*this.height+Math.abs(Math.sin(y.ae(this.roll)))*this.width)/this.height*(.5+p.y/this.height),R=Math.sin(I)*E/Math.sin(y.ah(Math.PI-T-I,.01,Math.PI-.01)),O=pe(this),z=Math.atan(O/this._helper.cameraToCenterDistance),B=y.ae(.75),V=z>B?2*z*(.5+p.y/(2*O)):B,q=Math.sin(V)*E/Math.sin(y.ah(Math.PI-T-V,.01,Math.PI-.01)),ee=Math.min(R,q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*ee+E),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const o=this.centerOffset,u=X(this.worldSize,this.center),p=u.x,m=u.y;this._helper._pixelPerMeter=y.aj(1,this.center.lat)*this.worldSize;const b=y.ae(Math.min(this.pitch,K)),E=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let T;this._calculateNearFarZIfNeeded(E,b,o),T=new Float64Array(16),y.b4(T,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),y.aq(this._invProjMatrix,T),T[8]=2*-o.x/this._helper._width,T[9]=2*o.y/this._helper._height,this._projectionMatrix=y.b5(T),y.N(T,T,[1,-1,1]),y.M(T,T,[0,0,-this._helper.cameraToCenterDistance]),y.b6(T,T,-this.rollInRadians),y.b7(T,T,this.pitchInRadians),y.b6(T,T,-this.bearingInRadians),y.M(T,T,[-p,-m,0]),this._mercatorMatrix=y.N([],T,[this.worldSize,this.worldSize,this.worldSize]),y.N(T,T,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=y.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T),y.M(T,T,[0,0,-this.elevation]),this._viewProjMatrix=T,this._invViewProjMatrix=y.aq([],T);const I=[0,0,-1,1];y.aw(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),y.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,E,this._helper._farZ),this._fogMatrix[8]=2*-o.x/this.width,this._fogMatrix[9]=2*o.y/this.height,y.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),y.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),y.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),y.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),y.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),y.M(this._fogMatrix,this._fogMatrix,[-p,-m,0]),y.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),y.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=y.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T);const R=this._helper._width%2/2,O=this._helper._height%2/2,z=Math.cos(this.bearingInRadians),B=Math.sin(-this.bearingInRadians),V=p-Math.round(p)+z*R+B*O,q=m-Math.round(m)+z*O+B*R,ee=new Float64Array(T);if(y.M(ee,ee,[V>.5?V-1:V,q>.5?q-1:q,0]),this._alignedProjMatrix=ee,T=y.aq(new Float64Array(16),this._pixelMatrix),!T)throw new Error("failed to invert matrix");this._pixelMatrixInverse=T,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const o=this.screenPointToMercatorCoordinate(new y.P(0,0)),u=[o.x*this.worldSize,o.y*this.worldSize,0,1];return y.aw(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const o=y.aj(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/o).toLngLat()}lngLatToCameraDepth(o,u){const p=y.a1.fromLngLat(o),m=[p.x*this.worldSize,p.y*this.worldSize,u,1];return y.aw(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(o){const{overscaledTileID:u,aligned:p,applyTerrainMatrix:m}=o,b=this._helper.getMercatorTileCoordinates(u),E=u?this.calculatePosMatrix(u,p,!0):null;let T;return T=u&&u.terrainRttPosMatrix32f&&m?u.terrainRttPosMatrix32f:E||y.b8(),{mainMatrix:T,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:T}}isLocationOccluded(o){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(o,u,p){return 1}transformLightDirection(o){return y.aT(o)}getRayDirectionFromPixel(o){throw new Error("Not implemented.")}projectTileCoordinates(o,u,p,m){const b=this.calculatePosMatrix(p);let E;m?(E=[o,u,m(o,u),1],y.aw(E,E,b)):(E=[o,u,0,1],$c(E,E,b));const T=E[3];return{point:new y.P(E[0]/T,E[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}populateCache(o){for(const u of o)this.calculatePosMatrix(u)}getMatrixForModel(o,u){const p=y.a1.fromLngLat(o,u),m=p.meterInMercatorCoordinateUnits(),b=y.b9();return y.M(b,b,[p.x,p.y,p.z]),y.b6(b,b,Math.PI),y.b7(b,b,Math.PI/2),y.N(b,b,[-m,m,m]),b}getProjectionDataForCustomLayer(o=!0){const u=new y.Z(0,0,0,0,0),p=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:o}),m=we(u,this.worldSize);y.O(m,this._viewProjMatrix,m),p.tileMercatorCoords=[0,0,1,1];const b=[y.$,y.$,this.worldSize/this._helper.pixelsPerMeter],E=y.ba();return y.N(E,m,b),p.fallbackMatrix=E,p.mainMatrix=E,p}getFastPathSimpleProjectionMatrix(o){return this.calculatePosMatrix(o)}}function Np(){y.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function co(v){if(v.useSlerp)if(v.k<1){const o=y.bb(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),u=y.bb(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),p=new Float64Array(4);y.bc(p,o,u,v.k);const m=y.bd(p);v.tr.setRoll(m.roll),v.tr.setPitch(m.pitch),v.tr.setBearing(m.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(y.C.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(y.C.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(y.C.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function Fo(v,o,u,p,m){const b=m.padding,E=X(m.worldSize,u.getNorthWest()),T=X(m.worldSize,u.getNorthEast()),I=X(m.worldSize,u.getSouthEast()),R=X(m.worldSize,u.getSouthWest()),O=y.ae(-p),z=E.rotate(O),B=T.rotate(O),V=I.rotate(O),q=R.rotate(O),ee=new y.P(Math.max(z.x,B.x,q.x,V.x),Math.max(z.y,B.y,q.y,V.y)),Q=new y.P(Math.min(z.x,B.x,q.x,V.x),Math.min(z.y,B.y,q.y,V.y)),te=ee.sub(Q),re=(m.width-(b.left+b.right+o.left+o.right))/te.x,le=(m.height-(b.top+b.bottom+o.top+o.bottom))/te.y;if(le<0||re<0)return void Np();const oe=Math.min(y.ak(m.scale*Math.min(re,le)),v.maxZoom),ue=y.P.convert(v.offset),de=new y.P((o.left-o.right)/2,(o.top-o.bottom)/2).rotate(y.ae(p)),se=ue.add(de).mult(m.scale/y.af(oe));return{center:ae(m.worldSize,E.add(I).div(2).sub(se)),zoom:oe,bearing:p}}class or{get useGlobeControls(){return!1}handlePanInertia(o,u){return{easingOffset:o,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(o,u){o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta),o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta)}handleMapControlsPan(o,u,p){o.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(p,o.around)}cameraForBoxAndBearing(o,u,p,m,b){return Fo(o,u,p,m,b)}handleJumpToCenterZoom(o,u){o.zoom!==(void 0!==u.zoom?+u.zoom:o.zoom)&&o.setZoom(+u.zoom),void 0!==u.center&&o.setCenter(y.S.convert(u.center))}handleEaseTo(o,u){const p=o.zoom,m=o.padding,b={roll:o.roll,pitch:o.pitch,bearing:o.bearing},E={roll:void 0===u.roll?o.roll:u.roll,pitch:void 0===u.pitch?o.pitch:u.pitch,bearing:void 0===u.bearing?o.bearing:u.bearing},T=void 0!==u.zoom,I=!o.isPaddingEqual(u.padding);let R=!1;const O=T?+u.zoom:o.zoom;let z=o.centerPoint.add(u.offsetAsPoint);const B=o.screenPointToLocation(z),{center:V,zoom:q}=o.getConstrained(y.S.convert(u.center||B),O??p);Yl(o,V);const ee=X(o.worldSize,B),Q=X(o.worldSize,V).sub(ee),te=y.af(q-p);return R=q!==p,{easeFunc:re=>{if(R&&o.setZoom(y.C.number(p,q,re)),y.be(b,E)||co({startEulerAngles:b,endEulerAngles:E,tr:o,k:re,useSlerp:b.roll!=E.roll}),I&&(o.interpolatePadding(m,u.padding,re),z=o.centerPoint.add(u.offsetAsPoint)),u.around)o.setLocationAtPoint(u.around,u.aroundPoint);else{const le=y.af(o.zoom-p),oe=q>p?Math.min(2,te):Math.max(.5,te),ue=Math.pow(oe,1-re),de=ae(o.worldSize,ee.add(Q.mult(re*ue)).mult(le));o.setLocationAtPoint(o.renderWorldCopies?de.wrap():de,z)}},isZooming:R,elevationCenter:V}}handleFlyTo(o,u){const p=void 0!==u.zoom,m=o.zoom,b=o.getConstrained(y.S.convert(u.center||u.locationAtOffset),p?+u.zoom:m),E=b.center,T=b.zoom;Yl(o,E);const I=X(o.worldSize,u.locationAtOffset),R=X(o.worldSize,E).sub(I),O=R.mag(),z=y.af(T-m);let B;if(void 0!==u.minZoom){const V=Math.min(+u.minZoom,m,T),q=o.getConstrained(E,V).zoom;B=y.af(q-m)}return{easeFunc:(V,q,ee,Q)=>{o.setZoom(1===V?T:m+y.ak(q));const te=1===V?E:ae(o.worldSize,I.add(R.mult(ee)).mult(q));o.setLocationAtPoint(o.renderWorldCopies?te.wrap():te,Q)},scaleOfZoom:z,targetCenter:E,scaleOfMinZoom:B,pixelPathLength:O}}}class si{constructor(o,u,p){this.blendFunction=o,this.blendColor=u,this.mask=p}}si.Replace=[1,0],si.disabled=new si(si.Replace,y.bf.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,y.bf.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,771],y.bf.transparent,[!0,!0,!0,!0]);class It{constructor(o,u,p){this.enable=o,this.mode=u,this.frontFace=p}}It.disabled=new It(!1,1029,2305),It.backCCW=new It(!0,1029,2305),It.frontCCW=new It(!0,1028,2305);class Gt{constructor(o,u,p){this.func=o,this.mask=u,this.range=p}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);class _n{constructor(o,u,p,m,b,E){this.test=o,this.ref=u,this.mask=p,this.fail=m,this.depthFail=b,this.pass=E}}_n.disabled=new _n({func:519,mask:0},0,0,7680,7680,7680);const uo=new WeakMap;function cs(v){var o;if(uo.has(v))return uo.get(v);{const u=null===(o=v.getParameter(v.VERSION))||void 0===o?void 0:o.startsWith("WebGL 2.0");return uo.set(v,u),u}}class Xs{get awaitingQuery(){return!!this._readbackQueue}constructor(o){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=o;const u=o.context,p=u.gl;this._texFormat=p.RGBA,this._texType=p.UNSIGNED_BYTE;const m=new y.aL;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const b=new y.aN;b.emplaceBack(0,1,2),this._fullscreenTriangle=new Hn(u.createVertexBuffer(m,Ms.members),u.createIndexBuffer(b),y.aM.simpleSegment(0,0,m.length,b.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(p.TEXTURE1);const E=p.createTexture();p.bindTexture(p.TEXTURE_2D,E),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texImage2D(p.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(E),cs(p)&&(this._pbo=p.createBuffer(),p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.bufferData(p.PIXEL_PACK_BUFFER,4,p.STREAM_READ),p.bindBuffer(p.PIXEL_PACK_BUFFER,null))}destroy(){const o=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),o.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(o,u){const p=this._updateCount;return this._readbackQueue?p>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():p>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(o,u),this._updateCount++,this._measuredError}_bindFramebuffer(){const o=this._cachedRenderContext.context,u=o.gl;o.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),o.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(o,u){const p=this._cachedRenderContext.context,m=p.gl;if(this._bindFramebuffer(),p.viewport.set([0,0,this._texWidth,this._texHeight]),p.clear({color:y.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(p,m.TRIANGLES,Gt.disabled,_n.disabled,si.unblended,It.disabled,((b,E)=>({u_input:b,u_output_expected:E}))(o,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&cs(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const b=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const o=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&cs(o)){const u=o.clientWaitSync(this._readbackQueue.sync,0,0);if(u===o.WAIT_FAILED)return y.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===o.TIMEOUT_EXPIRED)return;o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),o.bindBuffer(o.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),o.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Xs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(o){let u=0;return u+=o[0]/256,u+=o[1]/65536,u+=o[2]/16777216,o[3]<127&&(u=-u),u/128}}const Gh=y.$/128;function $h(v,o){const u=void 0!==v.granularity?Math.max(v.granularity,1):1,p=u+(v.generateBorders?2:0),m=u+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),b=p+1,E=m+1,T=v.generateBorders?-1:0,I=v.generateBorders||v.extendToNorthPole?-1:0,R=u+(v.generateBorders?1:0),O=u+(v.generateBorders||v.extendToSouthPole?1:0),z=b*E,B=p*m*6,V=b*E>65536;if(V&&"16bit"===o)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const q=V||"32bit"===o,ee=new Int16Array(2*z);let Q=0;for(let le=I;le<=O;le++)for(let oe=T;oe<=R;oe++){let ue=oe/u*y.$;-1===oe&&(ue=-Gh),oe===u+1&&(ue=y.$+Gh);let de=le/u*y.$;-1===le&&(de=v.extendToNorthPole?y.bh:-Gh),le===u+1&&(de=v.extendToSouthPole?y.bi:y.$+Gh),ee[Q++]=ue,ee[Q++]=de}const te=q?new Uint32Array(B):new Uint16Array(B);let re=0;for(let le=0;le<m;le++)for(let oe=0;oe<p;oe++){const ue=oe+1+le*b,de=oe+(le+1)*b,se=oe+1+(le+1)*b;te[re++]=oe+le*b,te[re++]=de,te[re++]=ue,te[re++]=ue,te[re++]=de,te[re++]=se}return{vertices:ee.buffer.slice(0),indices:te.buffer.slice(0),uses32bitIndices:q}}const us=new y.aK({fill:new y.bj(128,2),line:new y.bj(512,0),tile:new y.bj(128,32),stencil:new y.bj(128,1),circle:3});class Na{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Xe.projectionGlobe}get vertexShaderPreludeCode(){return Xe.projectionMercator.vertexSource}get subdivisionGranularity(){return us}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(o){this._errorMeasurement||(this._errorMeasurement=new Xs(o));const u=y.U(this._errorQueryLatitudeDegrees),p=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(u,p),b=wt.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=b);const E=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=y.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,y.bl(E))}_getMeshKey(o){return`${o.granularity.toString(36)}_${o.generateBorders?"b":""}${o.extendToNorthPole?"n":""}${o.extendToSouthPole?"s":""}`}getMeshFromTileID(o,u,p,m,b){const E=("stencil"===b?us.stencil:us.tile).getGranularityForZoomLevel(u.z);return this._getMesh(o,{granularity:E,generateBorders:p,extendToNorthPole:0===u.y&&m,extendToSouthPole:u.y===(1<<u.z)-1&&m})}_getMesh(o,u){const p=this._getMeshKey(u);if(p in this._tileMeshCache)return this._tileMeshCache[p];const m=function(b,E){const T=$h(E,"16bit"),I=y.aL.deserialize({arrayBuffer:T.vertices,length:T.vertices.byteLength/2/2}),R=y.aN.deserialize({arrayBuffer:T.indices,length:T.indices.byteLength/2/3});return new Hn(b.createVertexBuffer(I,Ms.members),b.createIndexBuffer(R),y.aM.simpleSegment(0,0,I.length,R.length))}(o,u);return this._tileMeshCache[p]=m,m}recalculate(o){}hasTransition(){const o=wt.now();let u=!1;return u=u||(o-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(o){this._errorQueryLatitudeDegrees=o}}const Yu=new y.r({type:new y.D(y.v.projection.type)});class Bt extends y.E{constructor(o){super(),this._transitionable=new y.t(Yu),this.setProjection(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new y.F(0)),this._mercatorProjection=new nn,this._verticalPerspectiveProjection=new Na}get transitionState(){const o=this.properties.get("type");if("string"==typeof o&&"mercator"===o)return 0;if("string"==typeof o&&"vertical-perspective"===o)return 1;if(o instanceof y.bm){if("vertical-perspective"===o.from&&"mercator"===o.to)return 1-o.transition;if("mercator"===o.from&&"vertical-perspective"===o.to)return o.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(o){this._mercatorProjection.updateGPUdependent(o),this._verticalPerspectiveProjection.updateGPUdependent(o)}getMeshFromTileID(o,u,p,m,b){return this.currentProjection.getMeshFromTileID(o,u,p,m,b)}setProjection(o){this._transitionable.setValue("type",o?.type||"mercator")}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}setErrorQueryLatitudeDegrees(o){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(o),this._mercatorProjection.setErrorQueryLatitudeDegrees(o)}}function dn(v){const o=pl(v.worldSize,v.center.lat);return 2*Math.PI*o}function Qs(v,o,u,p,m){const b=1/(1<<m),E=o/y.$*b+p*b,T=y.bo((v/y.$*b+u*b)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI,R=Math.cos(I),O=new Float64Array(3);return O[0]=Math.sin(T)*R,O[1]=Math.sin(I),O[2]=Math.cos(T)*R,O}function Tr(v){return function(o,u){const p=Math.cos(u),m=new Float64Array(3);return m[0]=Math.sin(o)*p,m[1]=Math.sin(u),m[2]=Math.cos(o)*p,m}(v.lng*Math.PI/180,v.lat*Math.PI/180)}function pl(v,o){return v/(2*Math.PI)/Math.cos(o*Math.PI/180)}function Yc(v){const o=Math.asin(v[1])/Math.PI*180,u=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(u>1e-6){const p=v[0]/u,m=Math.acos(v[2]/u),b=(p>0?m:-m)/Math.PI*180;return new y.S(y.aO(b,-180,180),o)}return new y.S(0,o)}function Ds(v){return Math.cos(v*Math.PI/180)}function mi(v,o){const u=Ds(v),p=Ds(o);return y.ak(p/u)}function Rm(v,o){const u=v.rotate(o.bearingInRadians),p=o.zoom+mi(o.center.lat,0),m=y.bk(1/Ds(o.center.lat),1/Ds(Math.min(Math.abs(o.center.lat),60)),y.bn(p,7,3,0,1)),b=360/dn({worldSize:o.worldSize,center:{lat:o.center.lat}});return new y.S(o.center.lng-u.x*b*m,y.ah(o.center.lat+u.y*b,-y.ai,y.ai))}function Hh(v){const o=.5*v,u=Math.sin(o),p=Math.cos(o);return Math.log(u+p)-Math.log(p-u)}function ef(v,o,u,p){const m=v.lat+u*p;if(Math.abs(u)>1){const b=(Math.sign(v.lat+u)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,E=Math.abs(v.lat+u)*Math.PI/180,T=Hh(b+p*(E-b)),I=Hh(b),R=Hh(E);return new y.S(v.lng+o*((T-I)/(R-I)),m)}return new y.S(v.lng+o*p,m)}class tf{constructor(o){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=o}swapBuffers(){if(!this._hadAnyChanges)return;const o=this._cachePrevious;this._cachePrevious=this._cache,this._cache=o,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(o,u,p,m){const b=`${o.z}_${o.x}_${o.y}_${m?.terrain?"t":""}`,E=this._cache.get(b);if(E)return E;const T=this._cachePrevious.get(b);if(T)return this._cache.set(b,T),T;const I=this._boundingVolumeFactory(o,u,p,m);return this._cache.set(b,I),this._hadAnyChanges=!0,I}}class Xc{constructor(o,u,p,m){this.min=p,this.max=m,this.points=o,this.planes=u}static fromAabb(o,u){const p=[];for(let m=0;m<8;m++)p.push([1&~m?o[0]:u[0],1==(m>>1&1)?u[1]:o[1],1==(m>>2&1)?u[2]:o[2]]);return new Xc(p,[[-1,0,0,u[0]],[1,0,0,-o[0]],[0,-1,0,u[1]],[0,1,0,-o[1]],[0,0,-1,u[2]],[0,0,1,-o[2]]],o,u)}static fromCenterSizeAngles(o,u,p){const m=y.br([],p[0],p[1],p[2]),b=y.bs([],[u[0],0,0],m),E=y.bs([],[0,u[1],0],m),T=y.bs([],[0,0,u[2]],m),I=[...o],R=[...o];for(let z=0;z<8;z++)for(let B=0;B<3;B++){const V=o[B]+b[B]*(1&~z?-1:1)+E[B]*(1==(z>>1&1)?1:-1)+T[B]*(1==(z>>2&1)?1:-1);I[B]=Math.min(I[B],V),R[B]=Math.max(R[B],V)}const O=[];for(let z=0;z<8;z++){const B=[...o];y.aS(B,B,y.aR([],b,1&~z?-1:1)),y.aS(B,B,y.aR([],E,1==(z>>1&1)?1:-1)),y.aS(B,B,y.aR([],T,1==(z>>2&1)?1:-1)),O.push(B)}return new Xc(O,[[...b,-y.aX(b,O[0])],[...E,-y.aX(E,O[0])],[...T,-y.aX(T,O[0])],[-b[0],-b[1],-b[2],-y.aX(b,O[7])],[-E[0],-E[1],-E[2],-y.aX(E,O[7])],[-T[0],-T[1],-T[2],-y.aX(T,O[7])]],I,R)}intersectsFrustum(o){let u=!0;const p=this.points.length,m=this.planes.length,b=o.planes.length,E=o.points.length;for(let T=0;T<b;T++){const I=o.planes[T];let R=0;for(let O=0;O<p;O++){const z=this.points[O];I[0]*z[0]+I[1]*z[1]+I[2]*z[2]+I[3]>=0&&R++}if(0===R)return 0;R<p&&(u=!1)}if(u)return 2;for(let T=0;T<m;T++){const I=this.planes[T];let R=0;for(let O=0;O<E;O++){const z=o.points[O];I[0]*z[0]+I[1]*z[1]+I[2]*z[2]+I[3]>=0&&R++}if(0===R)return 0}return 1}intersectsPlane(o){const u=this.points.length;let p=0;for(let m=0;m<u;m++){const b=this.points[m];o[0]*b[0]+o[1]*b[1]+o[2]*b[2]+o[3]>=0&&p++}return p===u?2:0===p?0:1}}function Ir(v,o,u){const p=v-o;return p<0?-p:Math.max(0,p-u)}function Qc(v,o,u,p,m){const b=v-u;let E;return E=b<0?Math.min(-b,1+b-m):b>1?Math.min(Math.max(b-m,0),1-b):0,Math.max(E,Ir(o,p,m))}class Js{constructor(){this._boundingVolumeCache=new tf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(o,u,p,m){const b=1<<p.z,E=1/b,T=p.x/b,I=p.y/b;let R=2;return R=Math.min(R,Qc(o,u,T,I,E)),R=Math.min(R,Qc(o,u,T+.5,-I-E,E)),R=Math.min(R,Qc(o,u,T+.5,2-I-E,E)),R}getWrap(o,u,p){const m=1<<u.z,b=1/m,E=u.x/m,T=Ir(o.x,E,b),I=Ir(o.x,E-1,b),R=Ir(o.x,E+1,b),O=Math.min(T,I,R);return O===R?1:O===I?-1:0}allowVariableZoom(o,u){return pt(o,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(o,u,p,m){return this._boundingVolumeCache.getTileBoundingVolume(o,u,p,m)}_computeTileBoundingVolume(o,u,p,m){var b,E;let T=0,I=0;if(m?.terrain){const R=new y.Z(o.z,u,o.z,o.x,o.y),O=m.terrain.getMinMaxElevation(R);T=null!==(b=O.minElevation)&&void 0!==b?b:Math.min(0,p),I=null!==(E=O.maxElevation)&&void 0!==E?E:Math.max(0,p)}if(T/=y.bu,I/=y.bu,T+=1,I+=1,o.z<=0)return Xc.fromAabb([-I,-I,-I],[I,I,I]);if(1===o.z)return Xc.fromAabb([0===o.x?-I:0,0===o.y?0:-I,-I],[0===o.x?0:I,0===o.y?I:0,I]);{const R=[Qs(0,0,o.x,o.y,o.z),Qs(y.$,0,o.x,o.y,o.z),Qs(y.$,y.$,o.x,o.y,o.z),Qs(0,y.$,o.x,o.y,o.z)],O=[];for(const Me of R)O.push(y.aR([],Me,I));if(I!==T)for(const Me of R)O.push(y.aR([],Me,T));0===o.y&&O.push([0,1,0]),o.y===(1<<o.z)-1&&O.push([0,-1,0]);const z=[1,1,1],B=[-1,-1,-1];for(const Me of O)for(let Ae=0;Ae<3;Ae++)z[Ae]=Math.min(z[Ae],Me[Ae]),B[Ae]=Math.max(B[Ae],Me[Ae]);const V=Qs(y.$/2,y.$/2,o.x,o.y,o.z),q=y.aW([],[0,1,0],V);y.aV(q,q);const ee=y.aW([],V,q);y.aV(ee,ee);const Q=y.aW([],R[2],R[1]);y.aV(Q,Q);const te=y.aW([],R[0],R[3]);y.aV(te,te),O.push(y.aR([],V,I)),o.y>=(1<<o.z)/2&&O.push(y.aR([],Qs(y.$/2,0,o.x,o.y,o.z),I)),o.y<(1<<o.z)/2&&O.push(y.aR([],Qs(y.$/2,y.$,o.x,o.y,o.z),I));const re=Xu(V,O),le=Xu(ee,O),oe=[-V[0],-V[1],-V[2],re.max],ue=[V[0],V[1],V[2],-re.min],de=[-ee[0],-ee[1],-ee[2],le.max],se=[ee[0],ee[1],ee[2],-le.min],ve=[...Q,0],Ie=[...te,0],Ee=[];return 0===o.y?Ee.push(y.bt(Ie,ve,oe),y.bt(Ie,ve,ue)):Ee.push(y.bt(de,ve,oe),y.bt(de,ve,ue),y.bt(de,Ie,oe),y.bt(de,Ie,ue)),o.y===(1<<o.z)-1?Ee.push(y.bt(Ie,ve,oe),y.bt(Ie,ve,ue)):Ee.push(y.bt(se,ve,oe),y.bt(se,ve,ue),y.bt(se,Ie,oe),y.bt(se,Ie,ue)),new Xc(Ee,[oe,ue,de,se,ve,Ie],z,B)}}}function Xu(v,o){let u=1/0,p=-1/0;for(const m of o){const b=y.aX(v,m);u=Math.min(u,b),p=Math.max(p,b)}return{min:u,max:p}}class Xl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,p){return this._helper.interpolatePadding(o,u,p)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u){this._helper.resize(o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o){}constructor(){this._cachedClippingPlane=y.bv(),this._projectionMatrix=y.b9(),this._globeViewProjMatrix32f=y.b8(),this._globeViewProjMatrixNoCorrection=y.b9(),this._globeViewProjMatrixNoCorrectionInverted=y.b9(),this._globeProjMatrixInverted=y.b9(),this._cameraPosition=y.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new $e({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,u)=>this.getConstrained(o,u)}),this._coveringTilesDetailsProvider=new Js}clone(){const o=new Xl;return o.apply(this),o}apply(o,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(o)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const o=y.bp();return o[0]=this._cameraPosition[0],o[1]=this._cameraPosition[1],o[2]=this._cameraPosition[2],o}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(o){const{overscaledTileID:u,applyGlobeMatrix:p}=o,m=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:p?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(o){const u=this.pitchInRadians,p=this.cameraToCenterDistance/o,m=Math.sin(u)*p,b=Math.cos(u)*p+1,E=1/Math.sqrt(m*m+b*b)*1;let T=-m,I=b;const R=Math.sqrt(T*T+I*I);T/=R,I/=R;const O=[0,T,I];y.bw(O,O,[0,0,0],-this.bearingInRadians),y.bx(O,O,[0,0,0],-1*this.center.lat*Math.PI/180),y.by(O,O,[0,0,0],this.center.lng*Math.PI/180);const z=1/y.aZ(O);return y.aR(O,O,z),[...O,-E*z]}isLocationOccluded(o){return!this.isSurfacePointVisible(Tr(o))}transformLightDirection(o){const u=this._helper._center.lng*Math.PI/180,p=this._helper._center.lat*Math.PI/180,m=Math.cos(p),b=[Math.sin(u)*m,Math.sin(p),Math.cos(u)*m],E=[b[2],0,-b[0]],T=[0,0,0];y.aW(T,E,b),y.aV(E,E),y.aV(T,T);const I=[0,0,0];return y.aV(I,[E[0]*o[0]+T[0]*o[1]+b[0]*o[2],E[1]*o[0]+T[1]*o[1]+b[1]*o[2],E[2]*o[0]+T[2]*o[1]+b[2]*o[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(o,u,p){const m=function(T,I,R){const O=1/(1<<R.z);return new y.a1(T/y.$*O+R.x*O,I/y.$*O+R.y*O)}(o,u,p.canonical),b=(E=m.y,[y.bo(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI]);var E;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(o,u,p,m){const b=p.canonical,E=Qs(o,u,b.x,b.y,b.z),T=1+(m?m(o,u):0)/y.bu,I=[E[0]*T,E[1]*T,E[2]*T,1];y.aw(I,I,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,O=R[0]*E[0]+R[1]*E[1]+R[2]*E[2]+R[3]<0;return{point:new y.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:O}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const o=pl(this.worldSize,this.center.lat),u=y.ba(),p=y.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*o),y.b4(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;u[8]=2*-m.x/this._helper._width,u[9]=2*m.y/this._helper._height,this._projectionMatrix=y.b5(u),this._globeProjMatrixInverted=y.ba(),y.aq(this._globeProjMatrixInverted,u),y.M(u,u,[0,0,-this.cameraToCenterDistance]),y.b6(u,u,this.rollInRadians),y.b7(u,u,-this.pitchInRadians),y.b6(u,u,this.bearingInRadians),y.M(u,u,[0,0,-o]);const b=y.bp();b[0]=o,b[1]=o,b[2]=o,y.b7(p,u,this.center.lat*Math.PI/180),y.bz(p,p,-this.center.lng*Math.PI/180),y.N(p,p,b),this._globeViewProjMatrixNoCorrection=p,y.b7(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),y.bz(u,u,-this.center.lng*Math.PI/180),y.N(u,u,b),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=y.ba(),y.aq(this._globeViewProjMatrixNoCorrectionInverted,p);const E=y.bp();this._cameraPosition=y.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/o,y.bw(this._cameraPosition,this._cameraPosition,E,-this.rollInRadians),y.bx(this._cameraPosition,this._cameraPosition,E,this.pitchInRadians),y.bw(this._cameraPosition,this._cameraPosition,E,-this.bearingInRadians),y.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),y.bx(this._cameraPosition,this._cameraPosition,E,-this.center.lat*Math.PI/180),y.by(this._cameraPosition,this._cameraPosition,E,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(o);const T=y.b5(this._globeViewProjMatrixNoCorrectionInverted);y.N(T,T,[1,1,-1]),this._cachedFrustum=Mi.fromInvProjectionMatrix(T,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(o){y.w("calculateFogMatrix is not supported on globe projection.");const u=y.ba();return y.ag(u),u}getVisibleUnwrappedCoordinates(o){return[new y.b2(0,o)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){o&&y.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){if(!this._globeViewProjMatrixNoCorrection)return 1;const p=Tr(o);y.aR(p,p,1+u/y.bu);const m=y.bv();return y.aw(m,[p[0],p[1],p[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(o){}getBounds(){const o=.5*this.width,u=.5*this.height,p=[new y.P(0,0),new y.P(o,0),new y.P(this.width,0),new y.P(this.width,u),new y.P(this.width,this.height),new y.P(o,this.height),new y.P(0,this.height),new y.P(0,u)],m=[];for(const z of p)m.push(this.unprojectScreenPoint(z));let b=0,E=0,T=0,I=0;const R=this.center;for(const z of m){const B=y.bA(R.lng,z.lng),V=y.bA(R.lat,z.lat);B<E&&(E=B),B>b&&(b=B),V<I&&(I=V),V>T&&(T=V)}const O=[R.lng+E,R.lat+I,R.lng+b,R.lat+T];return this.isSurfacePointOnScreen([0,1,0])&&(O[3]=90,O[0]=-180,O[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(O[1]=-90,O[0]=-180,O[2]=180),new Li(O)}getConstrained(o,u){const p=y.ah(o.lat,-y.ai,y.ai),m=y.ah(+u,this.minZoom+mi(0,p),this.maxZoom);return{center:new y.S(o.lng,p),zoom:m}}calculateCenterFromCameraLngLatAlt(o,u,p,m){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,p,m)}setLocationAtPoint(o,u){const p=Tr(this.unprojectScreenPoint(u)),m=Tr(o),b=y.bp();y.bB(b);const E=y.bp();y.by(E,p,b,-this.center.lng*Math.PI/180),y.bx(E,E,b,this.center.lat*Math.PI/180);const T=m[0]*m[0]+m[2]*m[2],I=E[0]*E[0];if(T<I)return;const R=Math.sqrt(T-I),O=-R,z=y.bC(m[0],m[2],E[0],R),B=y.bC(m[0],m[2],E[0],O),V=y.bp();y.by(V,m,b,-z);const q=y.bC(V[1],V[2],E[1],E[2]),ee=y.bp();y.by(ee,m,b,-B);const Q=y.bC(ee[1],ee[2],E[1],E[2]),te=.5*Math.PI,re=q>=-te&&q<=te,le=Q>=-te&&Q<=te;let oe,ue;if(re&&le){const Ie=this.center.lng*Math.PI/180,Ee=this.center.lat*Math.PI/180;y.bD(z,Ie)+y.bD(q,Ee)<y.bD(B,Ie)+y.bD(Q,Ee)?(oe=z,ue=q):(oe=B,ue=Q)}else if(re)oe=z,ue=q;else{if(!le)return;oe=B,ue=Q}const de=oe/Math.PI*180,se=ue/Math.PI*180,ve=this.center.lat;this.setCenter(new y.S(de,y.ah(se,-90,90))),this.setZoom(this.zoom+mi(ve,this.center.lat))}locationToScreenPoint(o,u){const p=Tr(o);if(u){const m=u.getElevationForLngLatZoom(o,this._helper._tileZoom);y.aR(p,p,1+m/y.bu)}return this._projectSurfacePointToScreen(p)}_projectSurfacePointToScreen(o){const u=y.bv();return y.aw(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new y.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(o,u){if(u){const p=u.pointCoordinate(o);if(p)return p}return y.a1.fromLngLat(this.unprojectScreenPoint(o))}screenPointToLocation(o,u){var p;return null===(p=this.screenPointToMercatorCoordinate(o,u))||void 0===p?void 0:p.toLngLat()}isPointOnMapSurface(o,u){const p=this._cameraPosition,m=this.getRayDirectionFromPixel(o);return!!this.rayPlanetIntersection(p,m)}getRayDirectionFromPixel(o){const u=y.bv();u[0]=o.x/this.width*2-1,u[1]=-1*(o.y/this.height*2-1),u[2]=1,u[3]=1,y.aw(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];const p=y.bp();p[0]=u[0]-this._cameraPosition[0],p[1]=u[1]-this._cameraPosition[1],p[2]=u[2]-this._cameraPosition[2];const m=y.bp();return y.aV(m,p),m}isSurfacePointVisible(o){const u=this._cachedClippingPlane;return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]+u[3]>=0}isSurfacePointOnScreen(o){if(!this.isSurfacePointVisible(o))return!1;const u=y.bv();return y.aw(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(o,u){const p=y.aX(o,u),m=y.bp(),b=y.bp();y.aR(b,u,p),y.aU(m,o,b);const E=1-y.aX(m,m);if(E<0)return null;const T=y.aX(o,o)-1,I=-p+(p<0?1:-1)*Math.sqrt(E),R=T/I,O=I;return{tMin:Math.min(R,O),tMax:Math.max(R,O)}}unprojectScreenPoint(o){const u=this._cameraPosition,p=this.getRayDirectionFromPixel(o),m=this.rayPlanetIntersection(u,p);if(m){const O=y.bp();y.aS(O,u,[p[0]*m.tMin,p[1]*m.tMin,p[2]*m.tMin]);const z=y.bp();return y.aV(z,O),Yc(z)}const b=this._cachedClippingPlane,E=b[0]*p[0]+b[1]*p[1]+b[2]*p[2],T=-y.b1(b,u)/E,I=y.bp();if(T>0)y.aS(I,u,[p[0]*T,p[1]*T,p[2]*T]);else{const O=y.bp();y.aS(O,u,[2*p[0],2*p[1],2*p[2]]);const z=y.b1(this._cachedClippingPlane,O);y.aU(I,O,[this._cachedClippingPlane[0]*z,this._cachedClippingPlane[1]*z,this._cachedClippingPlane[2]*z])}const R=function(O){const z=y.bp();return z[0]=O[0]*-O[3],z[1]=O[1]*-O[3],z[2]=O[2]*-O[3],{center:z,radius:Math.sqrt(1-O[3]*O[3])}}(b);return Yc(function(O,z,B){const V=y.bp();y.aU(V,B,O);const q=y.bp();return y.bq(q,O,V,z/y.a$(V)),q}(R.center,R.radius,I))}getMatrixForModel(o,u){const p=y.S.convert(o),m=1/y.bu,b=y.b9();return y.bz(b,b,p.lng/180*Math.PI),y.b7(b,b,-p.lat/180*Math.PI),y.M(b,b,[0,0,1+u/y.bu]),y.b7(b,b,.5*Math.PI),y.N(b,b,[m,m,m]),b}getProjectionDataForCustomLayer(o=!0){const u=this.getProjectionData({overscaledTileID:new y.Z(0,0,0,0,0),applyGlobeMatrix:o});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(o){}}class Jc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,p){return this._helper.interpolatePadding(o,u,p)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,p=!0){this._helper.resize(o,u,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(o,u){this._globeness=o,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new $e({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,u)=>this.getConstrained(o,u)}),this._globeness=1,this._mercatorTransform=new En,this._verticalPerspectiveTransform=new Xl}clone(){const o=new Jc;return o._globeness=this._globeness,o._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,o.apply(this),o}apply(o){this._helper.apply(o),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(o){const u=this._mercatorTransform.getProjectionData(o),p=this._verticalPerspectiveTransform.getProjectionData(o);return{mainMatrix:this.isGlobeRendering?p.mainMatrix:u.mainMatrix,clippingPlane:p.clippingPlane,tileMercatorCoords:p.tileMercatorCoords,projectionTransition:o.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(o){return this.currentTransform.isLocationOccluded(o)}transformLightDirection(o){return this.currentTransform.transformLightDirection(o)}getPixelScale(){return y.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return y.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(o,u,p){const m=this._mercatorTransform.getPitchedTextCorrection(o,u,p),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(o,u,p);return y.bk(m,b,this._globeness)}projectTileCoordinates(o,u,p,m){return this.currentTransform.projectTileCoordinates(o,u,p,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(o){return this.currentTransform.calculateFogMatrix(o)}getVisibleUnwrappedCoordinates(o){return this.currentTransform.getVisibleUnwrappedCoordinates(o)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(o){this._mercatorTransform.recalculateZoomAndCenter(o),this._verticalPerspectiveTransform.recalculateZoomAndCenter(o)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){return this.currentTransform.lngLatToCameraDepth(o,u)}populateCache(o){this._mercatorTransform.populateCache(o),this._verticalPerspectiveTransform.populateCache(o)}getBounds(){return this.currentTransform.getBounds()}getConstrained(o,u){return this.currentTransform.getConstrained(o,u)}calculateCenterFromCameraLngLatAlt(o,u,p,m){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,p,m)}setLocationAtPoint(o,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(o,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(o,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(o,u){return this.currentTransform.locationToScreenPoint(o,u)}screenPointToMercatorCoordinate(o,u){return this.currentTransform.screenPointToMercatorCoordinate(o,u)}screenPointToLocation(o,u){return this.currentTransform.screenPointToLocation(o,u)}isPointOnMapSurface(o,u){return this.currentTransform.isPointOnMapSurface(o,u)}getRayDirectionFromPixel(o){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(o)}getMatrixForModel(o,u){return this.currentTransform.getMatrixForModel(o,u)}getProjectionDataForCustomLayer(o=!0){const u=this._mercatorTransform.getProjectionDataForCustomLayer(o);if(!this.isGlobeRendering)return u;const p=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(o);return p.fallbackMatrix=u.mainMatrix,p}getFastPathSimpleProjectionMatrix(o){return this.currentTransform.getFastPathSimpleProjectionMatrix(o)}}class Gn{get useGlobeControls(){return!0}handlePanInertia(o,u){const p=Rm(o,u);return Math.abs(p.lng-u.center.lng)>180&&(p.lng=u.center.lng+179.5*Math.sign(p.lng-u.center.lng)),{easingCenter:p,easingOffset:new y.P(0,0)}}handleMapControlsRollPitchBearingZoom(o,u){const p=o.around,m=u.screenPointToLocation(p);o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta);const b=u.zoom;o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta);const E=u.zoom-b;if(0===E)return;const T=y.bA(u.center.lng,m.lng),I=T/(Math.abs(T/180)+1),R=y.bA(u.center.lat,m.lat),O=u.getRayDirectionFromPixel(p),z=u.cameraPosition,B=-1*y.aX(z,O),V=y.bp();y.aS(V,z,[O[0]*B,O[1]*B,O[2]*B]);const q=y.aZ(V)-1,ee=Math.exp(.5*-Math.max(q-.3,0)),Q=pl(u.worldSize,u.center.lat)/Math.min(u.width,u.height),te=y.bn(Q,.9,.5,1,.25),re=(1-y.af(-E))*Math.min(ee,te),le=u.center.lat,oe=u.zoom,ue=new y.S(u.center.lng+I*re,y.ah(u.center.lat+R*re,-y.ai,y.ai));u.setLocationAtPoint(m,p);const de=u.center,se=y.bn(Math.abs(T),45,85,0,1),ve=y.bn(Q,.75,.35,0,1),Ie=Math.pow(Math.max(se,ve),.25),Ee=y.bA(de.lng,ue.lng),Me=y.bA(de.lat,ue.lat);u.setCenter(new y.S(de.lng+Ee*Ie,de.lat+Me*Ie).wrap()),u.setZoom(oe+mi(le,u.center.lat))}handleMapControlsPan(o,u,p){if(!o.panDelta)return;const m=u.center.lat,b=u.zoom;u.setCenter(Rm(o.panDelta,u).wrap()),u.setZoom(b+mi(m,u.center.lat))}cameraForBoxAndBearing(o,u,p,m,b){const E=Fo(o,u,p,m,b),T=u.left/b.width*2-1,I=(b.width-u.right)/b.width*2-1,R=u.top/b.height*-2+1,O=(b.height-u.bottom)/b.height*-2+1,z=y.bA(p.getWest(),p.getEast())<0,B=z?p.getEast():p.getWest(),V=z?p.getWest():p.getEast(),q=Math.max(p.getNorth(),p.getSouth()),ee=Math.min(p.getNorth(),p.getSouth()),Q=B+.5*y.bA(B,V),te=q+.5*y.bA(q,ee),re=b.clone();re.setCenter(E.center),re.setBearing(E.bearing),re.setPitch(0),re.setRoll(0),re.setZoom(E.zoom);const le=re.modelViewProjectionMatrix,oe=[Tr(p.getNorthWest()),Tr(p.getNorthEast()),Tr(p.getSouthWest()),Tr(p.getSouthEast()),Tr(new y.S(V,te)),Tr(new y.S(B,te)),Tr(new y.S(Q,q)),Tr(new y.S(Q,ee))],ue=Tr(E.center);let de=Number.POSITIVE_INFINITY;for(const se of oe)T<0&&(de=Gn.getLesserNonNegativeNonNull(de,Gn.solveVectorScale(se,ue,le,"x",T))),I>0&&(de=Gn.getLesserNonNegativeNonNull(de,Gn.solveVectorScale(se,ue,le,"x",I))),R>0&&(de=Gn.getLesserNonNegativeNonNull(de,Gn.solveVectorScale(se,ue,le,"y",R))),O<0&&(de=Gn.getLesserNonNegativeNonNull(de,Gn.solveVectorScale(se,ue,le,"y",O)));if(Number.isFinite(de)&&0!==de)return E.zoom=re.zoom+y.ak(de),E;Np()}handleJumpToCenterZoom(o,u){const p=o.center.lat,m=o.getConstrained(u.center?y.S.convert(u.center):o.center,o.zoom).center;o.setCenter(m.wrap());const b=void 0!==u.zoom?+u.zoom:o.zoom+mi(p,m.lat);o.zoom!==b&&o.setZoom(b)}handleEaseTo(o,u){const p=o.zoom,m=o.center,b=o.padding,E={roll:o.roll,pitch:o.pitch,bearing:o.bearing},T={roll:void 0===u.roll?o.roll:u.roll,pitch:void 0===u.pitch?o.pitch:u.pitch,bearing:void 0===u.bearing?o.bearing:u.bearing},I=void 0!==u.zoom,R=!o.isPaddingEqual(u.padding);let O=!1;const z=u.center?y.S.convert(u.center):m,B=o.getConstrained(z,p).center;Yl(o,B);const V=o.clone();V.setCenter(B),V.setZoom(I?+u.zoom:p+mi(m.lat,z.lat)),V.setBearing(u.bearing);const q=new y.P(y.ah(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),y.ah(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));V.setLocationAtPoint(B,q);const ee=(u.offset&&u.offsetAsPoint.mag())>0?V.center:B,Q=I?+u.zoom:p+mi(m.lat,ee.lat),te=p+mi(m.lat,0),re=Q+mi(ee.lat,0),le=y.bA(m.lng,ee.lng),oe=y.bA(m.lat,ee.lat),ue=y.af(re-te);return O=Q!==p,{easeFunc:de=>{if(y.be(E,T)||co({startEulerAngles:E,endEulerAngles:T,tr:o,k:de,useSlerp:E.roll!=T.roll}),R&&o.interpolatePadding(b,u.padding,de),u.around)y.w("Easing around a point is not supported under globe projection."),o.setLocationAtPoint(u.around,u.aroundPoint);else{const se=re>te?Math.min(2,ue):Math.max(.5,ue),ve=Math.pow(se,1-de),Ie=ef(m,le,oe,de*ve);o.setCenter(Ie.wrap())}if(O){const se=y.C.number(te,re,de)+mi(0,o.center.lat);o.setZoom(se)}},isZooming:O,elevationCenter:ee}}handleFlyTo(o,u){const p=void 0!==u.zoom,m=o.center,b=o.zoom,E=o.padding,T=!o.isPaddingEqual(u.padding),I=o.getConstrained(y.S.convert(u.center||u.locationAtOffset),b).center,R=p?+u.zoom:o.zoom+mi(o.center.lat,I.lat),O=o.clone();O.setCenter(I),O.setZoom(R),O.setBearing(u.bearing);const z=new y.P(y.ah(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),y.ah(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));O.setLocationAtPoint(I,z);const B=O.center;Yl(o,B);const V=function(oe,ue,de){const se=Tr(ue),ve=Tr(de),Ie=y.aX(se,ve),Ee=Math.acos(Ie),Me=dn(oe);return Ee/(2*Math.PI)*Me}(o,m,B),q=b+mi(m.lat,0),ee=R+mi(B.lat,0),Q=y.af(ee-q);let te;if("number"==typeof u.minZoom){const oe=+u.minZoom+mi(B.lat,0),ue=Math.min(oe,q,ee)+mi(0,B.lat),de=o.getConstrained(B,ue).zoom+mi(B.lat,0);te=y.af(de-q)}const re=y.bA(m.lng,B.lng),le=y.bA(m.lat,B.lat);return{easeFunc:(oe,ue,de,se)=>{const ve=ef(m,re,le,de);T&&o.interpolatePadding(E,u.padding,oe);const Ie=1===oe?B:ve;o.setCenter(Ie.wrap());const Ee=q+y.ak(ue);o.setZoom(1===oe?R:Ee+mi(0,Ie.lat))},scaleOfZoom:Q,targetCenter:B,scaleOfMinZoom:te,pixelPathLength:V}}static solveVectorScale(o,u,p,m,b){const E="x"===m?[p[0],p[4],p[8],p[12]]:[p[1],p[5],p[9],p[13]],T=[p[3],p[7],p[11],p[15]],I=o[0]*E[0]+o[1]*E[1]+o[2]*E[2],R=o[0]*T[0]+o[1]*T[1]+o[2]*T[2],O=u[0]*E[0]+u[1]*E[1]+u[2]*E[2],z=u[0]*T[0]+u[1]*T[1]+u[2]*T[2];return O+b*R===I+b*z||T[3]*(I-O)+E[3]*(z-R)+I*z==O*R?null:(O+E[3]-b*z-b*T[3])/(O-I-b*z+b*R)}static getLesserNonNegativeNonNull(o,u){return null!==u&&u>=0&&u<o?u:o}}class nf{constructor(o){this._globe=o,this._mercatorCameraHelper=new or,this._verticalPerspectiveCameraHelper=new Gn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(o,u){return this.currentHelper.handlePanInertia(o,u)}handleMapControlsRollPitchBearingZoom(o,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(o,u)}handleMapControlsPan(o,u,p){this.currentHelper.handleMapControlsPan(o,u,p)}cameraForBoxAndBearing(o,u,p,m,b){return this.currentHelper.cameraForBoxAndBearing(o,u,p,m,b)}handleJumpToCenterZoom(o,u){this.currentHelper.handleJumpToCenterZoom(o,u)}handleEaseTo(o,u){return this.currentHelper.handleEaseTo(o,u)}handleFlyTo(o,u){return this.currentHelper.handleFlyTo(o,u)}}const rf=(v,o)=>y.y(v,o&&o.filter(u=>"source.canvas"!==u.identifier)),L0=y.bE();class ka extends y.E{constructor(o,u={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;"vector"!==m&&"geojson"!==m||this.sourceCaches[p].reload()}},this.map=o,this.dispatcher=new Hi(os(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Dn,this.imageManager.setEventedParent(this),this.glyphManager=new Fi(o._requestManager,u.localIdeographFontFamily),this.lineAtlas=new pn(256,512),this.crossTileSymbolIndex=new Ku,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",y.bG()),Ia().on(Ks,this._rtlPluginLoaded),this.on("data",p=>{if("source"!==p.dataType||"metadata"!==p.sourceDataType)return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const E in this._layers){const T=this._layers[E];T.source===b.id&&this._validateLayer(T)}})}setGlobalStateProperty(o,u){var p,m,b;this._checkLoaded();const E=null===u?null!==(b=null===(m=null===(p=this.stylesheet.state)||void 0===p?void 0:p[o])||void 0===m?void 0:m.default)&&void 0!==b?b:null:u;if(y.bH(E,this._globalState[o]))return this;this._globalState[o]=E;const T=this._findGlobalStateAffectedSources([o]);for(const I in this.sourceCaches)T.has(I)&&(this._reloadSource(I),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(o){this._checkLoaded();const u=[];for(const m in o)!y.bH(this._globalState[m],o[m].default)&&(u.push(m),this._globalState[m]=o[m].default);const p=this._findGlobalStateAffectedSources(u);for(const m in this.sourceCaches)p.has(m)&&(this._reloadSource(m),this._changed=!0)}_findGlobalStateAffectedSources(o){if(0===o.length)return new Set;const u=new Set;for(const p in this._layers){const m=this._layers[p],b=m.getLayoutAffectingGlobalStateRefs();for(const E of o)b.has(E)&&u.add(m.source)}return u}loadURL(o,u={},p){this.fire(new y.l("dataloading",{dataType:"style"})),u.validate="boolean"!=typeof u.validate||u.validate;const m=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;y.j(m,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,u,p)}).catch(E=>{this._loadStyleRequest=null,E&&!b.signal.aborted&&this.fire(new y.k(E))})}loadJSON(o,u={},p){this.fire(new y.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,wt.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=!1!==u.validate,this._load(o,u,p)}).catch(()=>{})}loadEmpty(){this.fire(new y.l("dataloading",{dataType:"style"})),this._load(L0,{validate:!1})}_load(o,u,p){var m,b,E;const T=u.transformStyle?u.transformStyle(p,o):o;if(!u.validate||!rf(this,y.z(T))){this._loaded=!0,this.stylesheet=T;for(const I in T.sources)this.addSource(I,T.sources[I],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new xo(this.stylesheet.light),this._setProjectionInternal((null===(m=this.stylesheet.projection)||void 0===m?void 0:m.type)||"mercator"),this.sky=new qr(this.stylesheet.sky),this.map.setTerrain(null!==(b=this.stylesheet.terrain)&&void 0!==b?b:null),this.setGlobalState(null!==(E=this.stylesheet.state)&&void 0!==E?E:null),this.fire(new y.l("data",{dataType:"style"})),this.fire(new y.l("style.load"))}}_createLayers(){const o=y.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of o){const p=y.bJ(u);p.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=p}}_loadSprite(o,u=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,E,T,I){return y._(this,void 0,void 0,function*(){const R=ht(b),O=T>1?"@2x":"",z={},B={};for(const{id:V,url:q}of R){const ee=E.transformRequest(tn(q,O,".json"),"SpriteJSON");z[V]=y.j(ee,I);const Q=E.transformRequest(tn(q,O,".png"),"SpriteImage");B[V]=nt.getImage(Q,I)}return yield Promise.all([...Object.values(z),...Object.values(B)]),function(V,q){return y._(this,void 0,void 0,function*(){const ee={};for(const Q in V){ee[Q]={};const te=wt.getImageCanvasContext((yield q[Q]).data),re=(yield V[Q]).data;for(const le in re){const{width:oe,height:ue,x:de,y:se,sdf:ve,pixelRatio:Ie,stretchX:Ee,stretchY:Me,content:Ae,textFitWidth:He,textFitHeight:Be}=re[le];ee[Q][le]={data:null,pixelRatio:Ie,sdf:ve,stretchX:Ee,stretchY:Me,content:Ae,textFitWidth:He,textFitHeight:Be,spriteData:{width:oe,height:ue,x:de,y:se,context:te}}}}return ee})}(z,B)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const E in b){this._spritesImagesIds[E]=[];const T=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(I=>!(I in b)):[];for(const I of T)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in b[E]){const R="default"===E?I:`${E}:${I}`;this._spritesImagesIds[E].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,b[E][I],!1):this.imageManager.addImage(R,b[E][I]),u&&(this._changedImages[R]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new y.k(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"}))}_validateLayer(o){const u=this.sourceCaches[o.source];if(!u)return;const p=o.sourceLayer;if(!p)return;const m=u.getSource();("geojson"===m.type||m.vectorLayerIds&&-1===m.vectorLayerIds.indexOf(p))&&this.fire(new y.k(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,u=!1){const p=this._serializedAllLayers();if(!o||0===o.length)return Object.values(u?y.bK(p):p);const m=[];for(const b of o)if(p[b]){const E=u?y.bK(p[b]):p[b];m.push(E)}return m}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const u=Object.keys(this._layers);for(const p of u){const m=this._layers[p];"custom"!==m.type&&(o[p]=m.serialize())}return o}hasTransitions(){var o,u,p;if(null!==(o=this.light)&&void 0!==o&&o.hasTransition()||null!==(u=this.sky)&&void 0!==u&&u.hasTransition()||null!==(p=this.projection)&&void 0!==p&&p.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const u=this._changed;if(u){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const E in this._updatedSources){const T=this._updatedSources[E];if("reload"===T)this._reloadSource(E);else{if("clear"!==T)throw new Error(`Invalid action ${T}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new y.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.sky.recalculate(o),this.projection.recalculate(o),this.z=o.zoom,u&&this.fire(new y.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,u={}){var p;this._checkLoaded();const m=this.serialize();if(o=u.transformStyle?u.transformStyle(m,o):o,(null===(p=u.validate)||void 0===p||p)&&rf(this,y.z(o)))return!1;(o=y.bK(o)).layers=y.bI(o.layers);const b=y.bL(m,o),E=this._getOperationsToPerform(b);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(0===E.operations.length)return!1;for(const T of E.operations)T();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const u=[],p=[];for(const m of o)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":u.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":u.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":u.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":u.push(()=>this.setGlobalState.apply(this,m.args));break;case"setTransition":u.push(()=>{});break;default:p.push(m.command)}return{operations:u,unimplemented:p}}addImage(o,u){if(this.getImage(o))return this.fire(new y.k(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,u),this._afterImageUpdated(o)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new y.k(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,u,p={}){if(this._checkLoaded(),void 0!==this.sourceCaches[o])throw new Error(`Source "${o}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(y.z.source,`sources.${o}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const m=this.sourceCaches[o]=new Yt(o,u,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),void 0===this.sourceCaches[o])throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new y.k(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const u=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],u.fire(new y.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,u){if(this._checkLoaded(),void 0===this.sourceCaches[o])throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if("geojson"!==p.type)throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(u),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,u,p={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new y.k(new Error(`Layer "${m}" already exists on this map.`)));let b;if("custom"===o.type){if(rf(this,y.bM(o)))return;b=y.bJ(o)}else{if("source"in o&&"object"==typeof o.source&&(this.addSource(m,o.source),o=y.bK(o),o=y.e(o,{source:m})),this._validate(y.z.layer,`layers.${m}`,o,{arrayIndex:-1},p))return;b=y.bJ(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const E=u?this._order.indexOf(u):this._order.length;if(u&&-1===E)this.fire(new y.k(new Error(`Cannot add layer "${m}" before non-existing layer "${u}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&"custom"!==b.type){const T=this._removedLayers[m];delete this._removedLayers[m],T.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new y.k(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const p=this._order.indexOf(o);this._order.splice(p,1);const m=u?this._order.indexOf(u):this._order.length;u&&-1===m?this.fire(new y.k(new Error(`Cannot move layer "${o}" before non-existing layer "${u}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new y.k(new Error(`Cannot remove non-existing layer "${o}".`)));u.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,u,p){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===u&&m.maxzoom===p||(null!=u&&(m.minzoom=u),null!=p&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new y.k(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,u,p={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!y.bH(m.filter,u))return null==u?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(y.z.filter,`layers.${m.id}.filter`,u,null,p)||(m.setFilter(y.bK(u)),this._updateLayer(m)))}else this.fire(new y.k(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return y.bK(this.getLayer(o).filter)}setLayoutProperty(o,u,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?y.bH(b.getLayoutProperty(u),p)||(b.setLayoutProperty(u,p,m),this._updateLayer(b)):this.fire(new y.k(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,u){const p=this.getLayer(o);if(p)return p.getLayoutProperty(u);this.fire(new y.k(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,u,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?y.bH(b.getPaintProperty(u),p)||(b.setPaintProperty(u,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new y.k(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,u){return this.getLayer(o).getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const p=o.source,m=o.sourceLayer,b=this.sourceCaches[p];if(void 0===b)return void this.fire(new y.k(new Error(`The source '${p}' does not exist in the map's style.`)));const E=b.getSource().type;"geojson"===E&&m?this.fire(new y.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==E||m?(void 0===o.id&&this.fire(new y.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,o.id,u)):this.fire(new y.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,u){this._checkLoaded();const p=o.source,m=this.sourceCaches[p];if(void 0===m)return void this.fire(new y.k(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,E="vector"===b?o.sourceLayer:void 0;"vector"!==b||E?u&&"string"!=typeof o.id&&"number"!=typeof o.id?this.fire(new y.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,o.id,u):this.fire(new y.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const u=o.source,p=o.sourceLayer,m=this.sourceCaches[u];if(void 0!==m)return"vector"!==m.getSource().type||p?(void 0===o.id&&this.fire(new y.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,o.id)):void this.fire(new y.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new y.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return y.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=y.bN(this.sourceCaches,b=>b.serialize()),u=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return y.bO({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:o,layers:u,terrain:p},b=>void 0!==b)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&"raster"!==this.sourceCaches[o.source].getSource().type&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const u=E=>"fill-extrusion"===this._layers[E].type,p={},m=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(u(T)){p[T]=E;for(const I of o){const R=I[T];if(R)for(const O of R)m.push(O)}}}m.sort((E,T)=>T.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(u(T))for(let I=m.length-1;I>=0;I--){const R=m[I].feature;if(p[R.layer.id]<E)break;b.push(R),m.pop()}else for(const I of o){const R=I[T];if(R)for(const O of R)b.push(O.feature)}}return b}queryRenderedFeatures(o,u,p){u&&u.filter&&this._validate(y.z.filter,"queryRenderedFeatures.filter",u.filter,null,u);const m={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new y.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of u.layers){const O=this._layers[R];if(!O)return this.fire(new y.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];m[O.source]=!0}}const b=[];u.availableImages=this._availableImages;const E=this._serializedAllLayers(),T=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,I=Object.assign(Object.assign({},u),{layers:T});for(const R in this.sourceCaches)u.layers&&!m[R]||b.push(as(this.sourceCaches[R],this._layers,E,o,I,p,this.map.terrain?(O,z,B)=>this.map.terrain.getElevation(O,z,B):void 0));return this.placement&&b.push(function(R,O,z,B,V,q,ee){const Q={},te=q.queryRenderedSymbols(B),re=[];for(const le of Object.keys(te).map(Number))re.push(ee[le]);re.sort(Hl);for(const le of re){const oe=le.featureIndex.lookupSymbolFeatures(te[le.bucketInstanceId],O,le.bucketIndex,le.sourceLayerIndex,V.filter,V.layers,V.availableImages,R);for(const ue in oe){const de=Q[ue]=Q[ue]||[],se=oe[ue];se.sort((ve,Ie)=>{const Ee=le.featureSortOrder;if(Ee){const Me=Ee.indexOf(ve.featureIndex);return Ee.indexOf(Ie.featureIndex)-Me}return Ie.featureIndex-ve.featureIndex});for(const ve of se)de.push(ve)}}return function(le,oe,ue){for(const de in le)for(const se of le[de])Uc(se,ue[oe[de].source]);return le}(Q,R,z)}(this._layers,E,this.sourceCaches,o,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,u){u&&u.filter&&this._validate(y.z.filter,"querySourceFeatures.filter",u.filter,null,u);const p=this.sourceCaches[o];return p?function(m,b){const E=m.getRenderableIds().map(R=>m.getTileByID(R)),T=[],I={};for(let R=0;R<E.length;R++){const O=E[R],z=O.tileID.canonical.key;I[z]||(I[z]=!0,O.querySourceFeatures(T,b))}return T}(p,u):[]}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const E in o)if(!y.bH(o[E],p[E])){m=!0;break}if(!m)return;const b={now:wt.now(),transition:y.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(b)}getProjection(){var o;return null===(o=this.stylesheet)||void 0===o?void 0:o.projection}setProjection(o){if(this._checkLoaded(),this.projection){if(this.projection.name===o.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=o,this._setProjectionInternal(o.type)}getSky(){var o;return null===(o=this.stylesheet)||void 0===o?void 0:o.sky}setSky(o,u={}){this._checkLoaded();const p=this.getSky();let m=!1;if(!o&&!p)return;if(o&&!p)m=!0;else if(!o&&p)m=!0;else for(const E in o)if(!y.bH(o[E],p[E])){m=!0;break}if(!m)return;const b={now:wt.now(),transition:y.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,u),this.sky.updateTransitions(b)}_setProjectionInternal(o){const u=function(p){if(Array.isArray(p)){const m=new Bt({type:p});return{projection:m,transform:new Jc,cameraHelper:new nf(m)}}switch(p){case"mercator":return{projection:new nn,transform:new En,cameraHelper:new or};case"globe":{const m=new Bt({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new Jc,cameraHelper:new nf(m)}}case"vertical-perspective":return{projection:new Na,transform:new Xl,cameraHelper:new Gn};default:return y.w(`Unknown projection name: ${p}. Falling back to mercator projection.`),{projection:new nn,transform:new En,cameraHelper:new or}}}(o);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(const p in this.sourceCaches)this.sourceCaches[p].reload()}_validate(o,u,p,m,b={}){return(!b||!1!==b.validate)&&rf(this,o.call(y.z,y.e({key:u,style:this.serialize(),value:p,styleSpec:y.v},m)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ia().off(Ks,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const p=this.sourceCaches[u];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const u in this.sourceCaches)this.sourceCaches[u].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,u,p,m,b=!1){let E=!1,T=!1;const I={};for(const R of this._order){const O=this._layers[R];if("symbol"!==O.type)continue;if(!I[O.source]){const B=this.sourceCaches[O.source];I[O.source]=B.getRenderableIds(!0).map(V=>B.getTileByID(V)).sort((V,q)=>q.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(q.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(O,I[O.source],o.center.lng);E=E||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||0===p)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(wt.now(),o.zoom))&&(this.pauseablePlacement=new Cr(o,this.map.terrain,this._order,b,u,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(wt.now()),T=!0),E&&this.pauseablePlacement.placement.setStale()),T||E)for(const R of this._order){const O=this._layers[R];"symbol"===O.type&&this.placement.updateLayerOpacities(O,I[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(wt.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u){return y._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,u.icons),p})}getGlyphs(o,u){return y._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(u.stacks),m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,u={}){this._checkLoaded(),o&&this._validate(y.z.glyphs,"glyphs",o,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,u,p={},m){this._checkLoaded();const b=[{id:o,url:u}],E=[...ht(this.stylesheet.sprite),...b];this._validate(y.z.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(b,!0,m))}removeSprite(o){this._checkLoaded();const u=ht(this.stylesheet.sprite);if(u.find(p=>p.id===o)){if(this._spritesImagesIds[o])for(const p of this._spritesImagesIds[o])this.imageManager.removeImage(p),this._changedImages[p]=!0;u.splice(u.findIndex(p=>p.id===o),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"}))}else this.fire(new y.k(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ht(this.stylesheet.sprite)}setSprite(o,u={},p){this._checkLoaded(),o&&this._validate(y.z.sprite,"sprite",o,null,u)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,p):(this._unloadSprite(),p&&p(null)))}}var sf=y.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Nm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,p,m,b,E,T,I,R){this.context=o;let O=this.boundPaintVertexBuffers.length!==m.length;for(let z=0;!O&&z<m.length;z++)this.boundPaintVertexBuffers[z]!==m[z]&&(O=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||O||this.boundIndexBuffer!==b||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==R?this.freshBind(u,p,m,b,E,T,I,R):(o.bindVertexArray.set(this.vao),T&&T.bind(),b&&b.dynamicDraw&&b.bind(),I&&I.bind(),R&&R.bind())}freshBind(o,u,p,m,b,E,T,I){const R=o.numAttributes,O=this.context,z=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=I,u.enableAttributes(z,o);for(const B of p)B.enableAttributes(z,o);E&&E.enableAttributes(z,o),T&&T.enableAttributes(z,o),I&&I.enableAttributes(z,o),u.bind(),u.setVertexAttribPointers(z,o,b);for(const B of p)B.bind(),B.setVertexAttribPointers(z,o,b);E&&(E.bind(),E.setVertexAttribPointers(z,o,b)),m&&m.bind(),T&&(T.bind(),T.setVertexAttribPointers(z,o,b)),I&&(I.bind(),I.setVertexAttribPointers(z,o,b)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const qh=(v,o,u,p,m)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):y.bf.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:u?u.calculateFogBlendOpacity(p):0,u_horizon_color:u?u.properties.get("horizon-color"):y.bf.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),Ft={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function gl(v){const o=[];for(let u=0;u<v.length;u++){if(null===v[u])continue;const p=v[u].split(" ");o.push(p.pop())}return o}class me{constructor(o,u,p,m,b,E,T,I,R=[]){const O=o.gl;this.program=O.createProgram();const z=gl(u.staticAttributes),B=p?p.getBinderAttributes():[],V=z.concat(B),q=Xe.prelude.staticUniforms?gl(Xe.prelude.staticUniforms):[],ee=T.staticUniforms?gl(T.staticUniforms):[],Q=u.staticUniforms?gl(u.staticUniforms):[],te=p?p.getBinderUniforms():[],re=q.concat(ee).concat(Q).concat(te),le=[];for(const Ee of re)le.indexOf(Ee)<0&&le.push(Ee);const oe=p?p.defines():[];cs(O)&&oe.unshift("#version 300 es"),b&&oe.push("#define OVERDRAW_INSPECTOR;"),E&&oe.push("#define TERRAIN3D;"),I&&oe.push(I),R&&oe.push(...R);let ue=oe.concat(Xe.prelude.fragmentSource,T.fragmentSource,u.fragmentSource).join("\n"),de=oe.concat(Xe.prelude.vertexSource,T.vertexSource,u.vertexSource).join("\n");cs(O)||(ue=ue.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D("),de=de.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D("));const se=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(se,ue),O.compileShader(se),!O.getShaderParameter(se,O.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${O.getShaderInfoLog(se)}`);O.attachShader(this.program,se);const ve=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(ve,de),O.compileShader(ve),!O.getShaderParameter(ve,O.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${O.getShaderInfoLog(ve)}`);O.attachShader(this.program,ve),this.attributes={};const Ie={};this.numAttributes=V.length;for(let Ee=0;Ee<this.numAttributes;Ee++)V[Ee]&&(O.bindAttribLocation(this.program,Ee,V[Ee]),this.attributes[V[Ee]]=Ee);if(O.linkProgram(this.program),!O.getProgramParameter(this.program,O.LINK_STATUS))throw new Error(`Program failed to link: ${O.getProgramInfoLog(this.program)}`);O.deleteShader(ve),O.deleteShader(se);for(let Ee=0;Ee<le.length;Ee++){const Me=le[Ee];if(Me&&!Ie[Me]){const Ae=O.getUniformLocation(this.program,Me);Ae&&(Ie[Me]=Ae)}}this.fixedUniforms=m(o,Ie),this.terrainUniforms=((Ee,Me)=>({u_depth:new y.bP(Ee,Me.u_depth),u_terrain:new y.bP(Ee,Me.u_terrain),u_terrain_dim:new y.bg(Ee,Me.u_terrain_dim),u_terrain_matrix:new y.bR(Ee,Me.u_terrain_matrix),u_terrain_unpack:new y.bS(Ee,Me.u_terrain_unpack),u_terrain_exaggeration:new y.bg(Ee,Me.u_terrain_exaggeration)}))(o,Ie),this.projectionUniforms=((Ee,Me)=>({u_projection_matrix:new y.bR(Ee,Me.u_projection_matrix),u_projection_tile_mercator_coords:new y.bS(Ee,Me.u_projection_tile_mercator_coords),u_projection_clipping_plane:new y.bS(Ee,Me.u_projection_clipping_plane),u_projection_transition:new y.bg(Ee,Me.u_projection_transition),u_projection_fallback_matrix:new y.bR(Ee,Me.u_projection_fallback_matrix)}))(o,Ie),this.binderUniforms=p?p.getUniforms(o,Ie):[]}draw(o,u,p,m,b,E,T,I,R,O,z,B,V,q,ee,Q,te,re,le){const oe=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(m),o.setColorMode(b),o.setCullFace(E),I){o.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,I.depthTexture),o.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,I.texture);for(const de in this.terrainUniforms)this.terrainUniforms[de].set(I[de])}if(R)for(const de in R)this.projectionUniforms[Ft[de]].set(R[de]);if(T)for(const de in this.fixedUniforms)this.fixedUniforms[de].set(T[de]);Q&&Q.setUniforms(o,this.binderUniforms,q,{zoom:ee});let ue=0;switch(u){case oe.LINES:ue=2;break;case oe.TRIANGLES:ue=3;break;case oe.LINE_STRIP:ue=1}for(const de of V.get()){const se=de.vaos||(de.vaos={});(se[O]||(se[O]=new Nm)).bind(o,this,z,Q?Q.getPaintVertexBuffers():[],B,de.vertexOffset,te,re,le),oe.drawElements(u,de.primitiveLength*ue,oe.UNSIGNED_SHORT,de.primitiveOffset*ue*2)}}}function ml(v,o,u){const p=1/y.aC(u,1,o.transform.tileZoom),m=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,o.transform.tileZoom)/m,E=b*(u.tileID.canonical.x+u.tileID.wrap*m),T=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[E>>16,T>>16],u_pixel_coord_lower:[65535&E,65535&T]}}const Cs=(v,o,u,p)=>{const m=v.style.light,b=m.properties.get("position"),E=[b.x,b.y,b.z],T=y.bV();"viewport"===m.properties.get("anchor")&&y.bW(T,v.transform.bearingInRadians),y.bX(E,E,T);const I=v.transform.transformLightDirection(E),R=m.properties.get("color");return{u_lightpos:E,u_lightpos_globe:I,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+o,u_opacity:u,u_fill_translate:p}},af=(v,o,u,p,m,b,E)=>y.e(Cs(v,o,u,p),ml(b,v,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),_l=(v,o,u,p)=>y.e(ml(o,v,u),{u_fill_translate:p}),Qu=(v,o)=>({u_world:v,u_fill_translate:o}),Ts=(v,o,u,p,m)=>y.e(_l(v,o,u,m),{u_world:p}),km=(v,o,u,p,m)=>{const b=v.transform;let E,T,I=0;if("map"===u.paint.get("circle-pitch-alignment")){const R=y.aC(o,1,b.zoom);E=!0,T=[R,R],I=R/(y.$*Math.pow(2,o.tileID.overscaledZ))*2*Math.PI*m}else E=!1,T=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+("map"===u.paint.get("circle-pitch-scale")),u_pitch_with_map:+E,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:T,u_globe_extrude_scale:I,u_translate:p}},ho=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),eu=v=>({u_viewport_size:[v.width,v.height]}),yl=(v,o=1)=>({u_color:v,u_overlay:0,u_overlay_scale:o}),Ju=(v,o,u,p)=>{const m=y.aC(v,1,o)/(y.$*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*p;return{u_extrude_scale:y.aC(v,1,o),u_intensity:u,u_globe_extrude_scale:m}},tu=(v,o,u,p)=>{const m=y.L();y.bY(m,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:u,u_color_ramp:p,u_opacity:o.paint.get("heatmap-opacity")}},kp=(v,o,u)=>{const p=u.paint.get("hillshade-accent-color");let m;switch(u.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}const b=u.getIlluminationProperties();for(let E=0;E<b.directionRadians.length;E++)"viewport"===u.paint.get("hillshade-illumination-anchor")&&(b.directionRadians[E]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:nu(0,o.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:b.altitudeRadians,u_azimuths:b.directionRadians,u_accent:p,u_method:m,u_highlights:b.highlightColor,u_shadows:b.shadowColor}},lf=(v,o)=>{const u=o.stride,p=y.L();return y.bY(p,0,y.$,-y.$,0,0,1),y.M(p,p,[0,-y.$,0]),{u_matrix:p,u_image:1,u_dimension:[u,u],u_zoom:v.overscaledZ,u_unpack:o.getUnpackVector()}};function nu(v,o){const u=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new y.a1(0,p/u).toLngLat().lat,new y.a1(0,(p+1)/u).toLngLat().lat]}const Wh=(v,o,u=0)=>({u_image:0,u_unpack:o.getUnpackVector(),u_dimension:[o.stride,o.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:v.paint.get("color-relief-opacity")}),vl=(v,o,u,p)=>{const m=v.transform;return{u_translation:Zh(v,o,u),u_ratio:p/y.aC(o,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Op=(v,o,u,p,m)=>y.e(vl(v,o,u,p),{u_image:0,u_image_height:m}),Is=(v,o,u,p,m)=>{const b=v.transform,E=ea(o,b);return{u_translation:Zh(v,o,u),u_texsize:o.imageAtlasTexture.size,u_ratio:p/y.aC(o,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},In=(v,o,u,p,m,b)=>{const E=v.lineAtlas,T=ea(o,v.transform),I="round"===u.layout.get("line-cap"),R=E.getDash(m.from,I),O=E.getDash(m.to,I),z=R.width*b.fromScale,B=O.width*b.toScale;return y.e(vl(v,o,u,p),{u_patternscale_a:[T/z,-R.height/2],u_patternscale_b:[T/B,-O.height/2],u_sdfgamma:E.width/(256*Math.min(z,B)*v.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:O.y,u_mix:b.t})};function ea(v,o){return 1/y.aC(v,1,o.tileZoom)}function Zh(v,o,u){return y.aD(v.transform,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Ql=(v,o,u,p,m)=>{return{u_tl_parent:v,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(E=p.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=p.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Kh(p.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var b,E};function Kh(v){v*=Math.PI/180;const o=Math.sin(v),u=Math.cos(v);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Eo=(v,o,u,p,m,b,E,T,I,R,O,z,B)=>{const V=E.transform;return{u_is_size_zoom_constant:+("constant"===v||"source"===v),u_is_size_feature_constant:+("constant"===v||"camera"===v),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:V.width/V.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+O,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:z,u_texture:0,u_translation:R,u_pitched_scale:B}},Yh=(v,o,u,p,m,b,E,T,I,R,O,z,B,V)=>{const q=E.transform;return y.e(Eo(v,o,u,p,m,b,E,T,I,R,O,z,V),{u_gamma_scale:p?Math.cos(q.pitch*Math.PI/180)*q.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:1})},Rn=(v,o,u,p,m,b,E,T,I,R,O,z,B)=>y.e(Yh(v,o,u,p,m,b,E,T,I,R,!0,O,0,B),{u_texsize_icon:z,u_texture_icon:1}),Om=(v,o)=>({u_opacity:v,u_color:o}),Kr=(v,o,u,p,m)=>y.e(function(b,E,T,I){const R=T.imageManager.getPattern(b.from.toString()),O=T.imageManager.getPattern(b.to.toString()),{width:z,height:B}=T.imageManager.getPixelSize(),V=Math.pow(2,I.tileID.overscaledZ),q=I.tileSize*Math.pow(2,T.transform.tileZoom)/V,ee=q*(I.tileID.canonical.x+I.tileID.wrap*V),Q=q*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[z,B],u_mix:E.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/y.aC(I,1,T.transform.tileZoom),u_pixel_coord_upper:[ee>>16,Q>>16],u_pixel_coord_lower:[65535&ee,65535&Q]}}(u,m,o,p),{u_opacity:v}),Lo=(v,o)=>{},bl={fillExtrusion:(v,o)=>({u_lightpos:new y.bT(v,o.u_lightpos),u_lightpos_globe:new y.bT(v,o.u_lightpos_globe),u_lightintensity:new y.bg(v,o.u_lightintensity),u_lightcolor:new y.bT(v,o.u_lightcolor),u_vertical_gradient:new y.bg(v,o.u_vertical_gradient),u_opacity:new y.bg(v,o.u_opacity),u_fill_translate:new y.bU(v,o.u_fill_translate)}),fillExtrusionPattern:(v,o)=>({u_lightpos:new y.bT(v,o.u_lightpos),u_lightpos_globe:new y.bT(v,o.u_lightpos_globe),u_lightintensity:new y.bg(v,o.u_lightintensity),u_lightcolor:new y.bT(v,o.u_lightcolor),u_vertical_gradient:new y.bg(v,o.u_vertical_gradient),u_height_factor:new y.bg(v,o.u_height_factor),u_opacity:new y.bg(v,o.u_opacity),u_fill_translate:new y.bU(v,o.u_fill_translate),u_image:new y.bP(v,o.u_image),u_texsize:new y.bU(v,o.u_texsize),u_pixel_coord_upper:new y.bU(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(v,o.u_pixel_coord_lower),u_scale:new y.bT(v,o.u_scale),u_fade:new y.bg(v,o.u_fade)}),fill:(v,o)=>({u_fill_translate:new y.bU(v,o.u_fill_translate)}),fillPattern:(v,o)=>({u_image:new y.bP(v,o.u_image),u_texsize:new y.bU(v,o.u_texsize),u_pixel_coord_upper:new y.bU(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(v,o.u_pixel_coord_lower),u_scale:new y.bT(v,o.u_scale),u_fade:new y.bg(v,o.u_fade),u_fill_translate:new y.bU(v,o.u_fill_translate)}),fillOutline:(v,o)=>({u_world:new y.bU(v,o.u_world),u_fill_translate:new y.bU(v,o.u_fill_translate)}),fillOutlinePattern:(v,o)=>({u_world:new y.bU(v,o.u_world),u_image:new y.bP(v,o.u_image),u_texsize:new y.bU(v,o.u_texsize),u_pixel_coord_upper:new y.bU(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(v,o.u_pixel_coord_lower),u_scale:new y.bT(v,o.u_scale),u_fade:new y.bg(v,o.u_fade),u_fill_translate:new y.bU(v,o.u_fill_translate)}),circle:(v,o)=>({u_camera_to_center_distance:new y.bg(v,o.u_camera_to_center_distance),u_scale_with_map:new y.bP(v,o.u_scale_with_map),u_pitch_with_map:new y.bP(v,o.u_pitch_with_map),u_extrude_scale:new y.bU(v,o.u_extrude_scale),u_device_pixel_ratio:new y.bg(v,o.u_device_pixel_ratio),u_globe_extrude_scale:new y.bg(v,o.u_globe_extrude_scale),u_translate:new y.bU(v,o.u_translate)}),collisionBox:(v,o)=>({u_pixel_extrude_scale:new y.bU(v,o.u_pixel_extrude_scale)}),collisionCircle:(v,o)=>({u_viewport_size:new y.bU(v,o.u_viewport_size)}),debug:(v,o)=>({u_color:new y.bQ(v,o.u_color),u_overlay:new y.bP(v,o.u_overlay),u_overlay_scale:new y.bg(v,o.u_overlay_scale)}),depth:Lo,clippingMask:Lo,heatmap:(v,o)=>({u_extrude_scale:new y.bg(v,o.u_extrude_scale),u_intensity:new y.bg(v,o.u_intensity),u_globe_extrude_scale:new y.bg(v,o.u_globe_extrude_scale)}),heatmapTexture:(v,o)=>({u_matrix:new y.bR(v,o.u_matrix),u_world:new y.bU(v,o.u_world),u_image:new y.bP(v,o.u_image),u_color_ramp:new y.bP(v,o.u_color_ramp),u_opacity:new y.bg(v,o.u_opacity)}),hillshade:(v,o)=>({u_image:new y.bP(v,o.u_image),u_latrange:new y.bU(v,o.u_latrange),u_exaggeration:new y.bg(v,o.u_exaggeration),u_altitudes:new y.b_(v,o.u_altitudes),u_azimuths:new y.b_(v,o.u_azimuths),u_accent:new y.bQ(v,o.u_accent),u_method:new y.bP(v,o.u_method),u_shadows:new y.bZ(v,o.u_shadows),u_highlights:new y.bZ(v,o.u_highlights)}),hillshadePrepare:(v,o)=>({u_matrix:new y.bR(v,o.u_matrix),u_image:new y.bP(v,o.u_image),u_dimension:new y.bU(v,o.u_dimension),u_zoom:new y.bg(v,o.u_zoom),u_unpack:new y.bS(v,o.u_unpack)}),colorRelief:(v,o)=>({u_image:new y.bP(v,o.u_image),u_unpack:new y.bS(v,o.u_unpack),u_dimension:new y.bU(v,o.u_dimension),u_elevation_stops:new y.bP(v,o.u_elevation_stops),u_color_stops:new y.bP(v,o.u_color_stops),u_color_ramp_size:new y.bP(v,o.u_color_ramp_size),u_opacity:new y.bg(v,o.u_opacity)}),line:(v,o)=>({u_translation:new y.bU(v,o.u_translation),u_ratio:new y.bg(v,o.u_ratio),u_device_pixel_ratio:new y.bg(v,o.u_device_pixel_ratio),u_units_to_pixels:new y.bU(v,o.u_units_to_pixels)}),lineGradient:(v,o)=>({u_translation:new y.bU(v,o.u_translation),u_ratio:new y.bg(v,o.u_ratio),u_device_pixel_ratio:new y.bg(v,o.u_device_pixel_ratio),u_units_to_pixels:new y.bU(v,o.u_units_to_pixels),u_image:new y.bP(v,o.u_image),u_image_height:new y.bg(v,o.u_image_height)}),linePattern:(v,o)=>({u_translation:new y.bU(v,o.u_translation),u_texsize:new y.bU(v,o.u_texsize),u_ratio:new y.bg(v,o.u_ratio),u_device_pixel_ratio:new y.bg(v,o.u_device_pixel_ratio),u_image:new y.bP(v,o.u_image),u_units_to_pixels:new y.bU(v,o.u_units_to_pixels),u_scale:new y.bT(v,o.u_scale),u_fade:new y.bg(v,o.u_fade)}),lineSDF:(v,o)=>({u_translation:new y.bU(v,o.u_translation),u_ratio:new y.bg(v,o.u_ratio),u_device_pixel_ratio:new y.bg(v,o.u_device_pixel_ratio),u_units_to_pixels:new y.bU(v,o.u_units_to_pixels),u_patternscale_a:new y.bU(v,o.u_patternscale_a),u_patternscale_b:new y.bU(v,o.u_patternscale_b),u_sdfgamma:new y.bg(v,o.u_sdfgamma),u_image:new y.bP(v,o.u_image),u_tex_y_a:new y.bg(v,o.u_tex_y_a),u_tex_y_b:new y.bg(v,o.u_tex_y_b),u_mix:new y.bg(v,o.u_mix)}),raster:(v,o)=>({u_tl_parent:new y.bU(v,o.u_tl_parent),u_scale_parent:new y.bg(v,o.u_scale_parent),u_buffer_scale:new y.bg(v,o.u_buffer_scale),u_fade_t:new y.bg(v,o.u_fade_t),u_opacity:new y.bg(v,o.u_opacity),u_image0:new y.bP(v,o.u_image0),u_image1:new y.bP(v,o.u_image1),u_brightness_low:new y.bg(v,o.u_brightness_low),u_brightness_high:new y.bg(v,o.u_brightness_high),u_saturation_factor:new y.bg(v,o.u_saturation_factor),u_contrast_factor:new y.bg(v,o.u_contrast_factor),u_spin_weights:new y.bT(v,o.u_spin_weights),u_coords_top:new y.bS(v,o.u_coords_top),u_coords_bottom:new y.bS(v,o.u_coords_bottom)}),symbolIcon:(v,o)=>({u_is_size_zoom_constant:new y.bP(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.bP(v,o.u_is_size_feature_constant),u_size_t:new y.bg(v,o.u_size_t),u_size:new y.bg(v,o.u_size),u_camera_to_center_distance:new y.bg(v,o.u_camera_to_center_distance),u_pitch:new y.bg(v,o.u_pitch),u_rotate_symbol:new y.bP(v,o.u_rotate_symbol),u_aspect_ratio:new y.bg(v,o.u_aspect_ratio),u_fade_change:new y.bg(v,o.u_fade_change),u_label_plane_matrix:new y.bR(v,o.u_label_plane_matrix),u_coord_matrix:new y.bR(v,o.u_coord_matrix),u_is_text:new y.bP(v,o.u_is_text),u_pitch_with_map:new y.bP(v,o.u_pitch_with_map),u_is_along_line:new y.bP(v,o.u_is_along_line),u_is_variable_anchor:new y.bP(v,o.u_is_variable_anchor),u_texsize:new y.bU(v,o.u_texsize),u_texture:new y.bP(v,o.u_texture),u_translation:new y.bU(v,o.u_translation),u_pitched_scale:new y.bg(v,o.u_pitched_scale)}),symbolSDF:(v,o)=>({u_is_size_zoom_constant:new y.bP(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.bP(v,o.u_is_size_feature_constant),u_size_t:new y.bg(v,o.u_size_t),u_size:new y.bg(v,o.u_size),u_camera_to_center_distance:new y.bg(v,o.u_camera_to_center_distance),u_pitch:new y.bg(v,o.u_pitch),u_rotate_symbol:new y.bP(v,o.u_rotate_symbol),u_aspect_ratio:new y.bg(v,o.u_aspect_ratio),u_fade_change:new y.bg(v,o.u_fade_change),u_label_plane_matrix:new y.bR(v,o.u_label_plane_matrix),u_coord_matrix:new y.bR(v,o.u_coord_matrix),u_is_text:new y.bP(v,o.u_is_text),u_pitch_with_map:new y.bP(v,o.u_pitch_with_map),u_is_along_line:new y.bP(v,o.u_is_along_line),u_is_variable_anchor:new y.bP(v,o.u_is_variable_anchor),u_texsize:new y.bU(v,o.u_texsize),u_texture:new y.bP(v,o.u_texture),u_gamma_scale:new y.bg(v,o.u_gamma_scale),u_device_pixel_ratio:new y.bg(v,o.u_device_pixel_ratio),u_is_halo:new y.bP(v,o.u_is_halo),u_translation:new y.bU(v,o.u_translation),u_pitched_scale:new y.bg(v,o.u_pitched_scale)}),symbolTextAndIcon:(v,o)=>({u_is_size_zoom_constant:new y.bP(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.bP(v,o.u_is_size_feature_constant),u_size_t:new y.bg(v,o.u_size_t),u_size:new y.bg(v,o.u_size),u_camera_to_center_distance:new y.bg(v,o.u_camera_to_center_distance),u_pitch:new y.bg(v,o.u_pitch),u_rotate_symbol:new y.bP(v,o.u_rotate_symbol),u_aspect_ratio:new y.bg(v,o.u_aspect_ratio),u_fade_change:new y.bg(v,o.u_fade_change),u_label_plane_matrix:new y.bR(v,o.u_label_plane_matrix),u_coord_matrix:new y.bR(v,o.u_coord_matrix),u_is_text:new y.bP(v,o.u_is_text),u_pitch_with_map:new y.bP(v,o.u_pitch_with_map),u_is_along_line:new y.bP(v,o.u_is_along_line),u_is_variable_anchor:new y.bP(v,o.u_is_variable_anchor),u_texsize:new y.bU(v,o.u_texsize),u_texsize_icon:new y.bU(v,o.u_texsize_icon),u_texture:new y.bP(v,o.u_texture),u_texture_icon:new y.bP(v,o.u_texture_icon),u_gamma_scale:new y.bg(v,o.u_gamma_scale),u_device_pixel_ratio:new y.bg(v,o.u_device_pixel_ratio),u_is_halo:new y.bP(v,o.u_is_halo),u_translation:new y.bU(v,o.u_translation),u_pitched_scale:new y.bg(v,o.u_pitched_scale)}),background:(v,o)=>({u_opacity:new y.bg(v,o.u_opacity),u_color:new y.bQ(v,o.u_color)}),backgroundPattern:(v,o)=>({u_opacity:new y.bg(v,o.u_opacity),u_image:new y.bP(v,o.u_image),u_pattern_tl_a:new y.bU(v,o.u_pattern_tl_a),u_pattern_br_a:new y.bU(v,o.u_pattern_br_a),u_pattern_tl_b:new y.bU(v,o.u_pattern_tl_b),u_pattern_br_b:new y.bU(v,o.u_pattern_br_b),u_texsize:new y.bU(v,o.u_texsize),u_mix:new y.bg(v,o.u_mix),u_pattern_size_a:new y.bU(v,o.u_pattern_size_a),u_pattern_size_b:new y.bU(v,o.u_pattern_size_b),u_scale_a:new y.bg(v,o.u_scale_a),u_scale_b:new y.bg(v,o.u_scale_b),u_pixel_coord_upper:new y.bU(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(v,o.u_pixel_coord_lower),u_tile_units_to_pixels:new y.bg(v,o.u_tile_units_to_pixels)}),terrain:(v,o)=>({u_texture:new y.bP(v,o.u_texture),u_ele_delta:new y.bg(v,o.u_ele_delta),u_fog_matrix:new y.bR(v,o.u_fog_matrix),u_fog_color:new y.bQ(v,o.u_fog_color),u_fog_ground_blend:new y.bg(v,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new y.bg(v,o.u_fog_ground_blend_opacity),u_horizon_color:new y.bQ(v,o.u_horizon_color),u_horizon_fog_blend:new y.bg(v,o.u_horizon_fog_blend),u_is_globe_mode:new y.bg(v,o.u_is_globe_mode)}),terrainDepth:(v,o)=>({u_ele_delta:new y.bg(v,o.u_ele_delta)}),terrainCoords:(v,o)=>({u_texture:new y.bP(v,o.u_texture),u_terrain_coords_id:new y.bg(v,o.u_terrain_coords_id),u_ele_delta:new y.bg(v,o.u_ele_delta)}),projectionErrorMeasurement:(v,o)=>({u_input:new y.bg(v,o.u_input),u_output_expected:new y.bg(v,o.u_output_expected)}),atmosphere:(v,o)=>({u_sun_pos:new y.bT(v,o.u_sun_pos),u_atmosphere_blend:new y.bg(v,o.u_atmosphere_blend),u_globe_position:new y.bT(v,o.u_globe_position),u_globe_radius:new y.bg(v,o.u_globe_radius),u_inv_proj_matrix:new y.bR(v,o.u_inv_proj_matrix)}),sky:(v,o)=>({u_sky_color:new y.bQ(v,o.u_sky_color),u_horizon_color:new y.bQ(v,o.u_horizon_color),u_horizon:new y.bU(v,o.u_horizon),u_horizon_normal:new y.bU(v,o.u_horizon_normal),u_sky_horizon_blend:new y.bg(v,o.u_sky_horizon_blend),u_sky_blend:new y.bg(v,o.u_sky_blend)})};class eh{constructor(o,u,p){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Oa{constructor(o,u,p,m){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=m,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let p=0;p<this.attributes.length;p++){const m=u.attributes[this.attributes[p].name];void 0!==m&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,u,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],E=u.attributes[b.name];void 0!==E&&o.vertexAttribPointer(E,b.components,o[Xh[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qh extends yn{getDefault(){return y.bf.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class iu extends yn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Fm extends yn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class th extends yn{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Jl extends yn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class nh extends yn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Fp extends yn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Lp extends yn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Fa extends yn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Bp extends yn{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Jh extends yn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class ed extends yn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class cf extends yn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class ru extends yn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class ec extends yn{getDefault(){return y.bf.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class sr extends yn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class La extends yn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class Ba extends yn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ih extends yn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class ou extends yn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Bo extends yn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class su extends yn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class tc extends yn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class uf extends yn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class nc extends yn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class td extends yn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class au extends yn{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Yr extends yn{getDefault(){return null}set(o){var u;if(o===this.current&&!this.dirty)return;const p=this.gl;cs(p)?p.bindVertexArray(o):null===(u=p.getExtension("OES_vertex_array_object"))||void 0===u||u.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class lu extends yn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Lm extends yn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ai extends yn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ue extends yn{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class Rt extends Ue{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class _i extends Ue{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Dt extends Ue{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}const Bi="Framebuffer is not complete";class ic{constructor(o,u,p,m,b){this.context=o,this.width=u,this.height=p;const E=o.gl,T=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Rt(o,T),m)this.depthAttachment=b?new Dt(o,T):new _i(o,T);else if(b)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error(Bi)}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class cu{constructor(o){var u,p;if(this.gl=o,this.clearColor=new Qh(this),this.clearDepth=new iu(this),this.clearStencil=new Fm(this),this.colorMask=new th(this),this.depthMask=new Jl(this),this.stencilMask=new nh(this),this.stencilFunc=new Fp(this),this.stencilOp=new Lp(this),this.stencilTest=new Fa(this),this.depthRange=new Bp(this),this.depthTest=new Jh(this),this.depthFunc=new ed(this),this.blend=new cf(this),this.blendFunc=new ru(this),this.blendColor=new ec(this),this.blendEquation=new sr(this),this.cullFace=new La(this),this.cullFaceSide=new Ba(this),this.frontFace=new ih(this),this.program=new ou(this),this.activeTexture=new Bo(this),this.viewport=new su(this),this.bindFramebuffer=new tc(this),this.bindRenderbuffer=new uf(this),this.bindTexture=new nc(this),this.bindVertexBuffer=new td(this),this.bindElementBuffer=new au(this),this.bindVertexArray=new Yr(this),this.pixelStoreUnpack=new lu(this),this.pixelStoreUnpackPremultiplyAlpha=new Lm(this),this.pixelStoreUnpackFlipY=new ai(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),cs(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(u=o.RGBA16F)&&void 0!==u?u:m?.RGBA16F_EXT,this.RGB16F=null!==(p=o.RGB16F)&&void 0!==p?p:m?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new eh(this,o,u)}createVertexBuffer(o,u,p){return new Oa(this,o,u,p)}createRenderbuffer(o,u,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,o,u,p),this.bindRenderbuffer.set(null),b}createFramebuffer(o,u,p,m){return new ic(this,o,u,p,m)}clear({color:o,depth:u,stencil:p}){const m=this.gl;let b=0;o&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==p&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){y.bH(o.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return cs(this.gl)?this.gl.createVertexArray():null===(o=this.gl.getExtension("OES_vertex_array_object"))||void 0===o?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var u;return cs(this.gl)?this.gl.deleteVertexArray(o):null===(u=this.gl.getExtension("OES_vertex_array_object"))||void 0===u?void 0:u.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}let un;function Yn(v,o,u,p,m){const b=v.context,E=v.transform,T=b.gl,I=v.useProgram("collisionBox"),R=[];let O=0,z=0;for(let te=0;te<p.length;te++){const re=p[te],le=o.getTile(re).getBucket(u);if(!le)continue;const oe=m?le.textCollisionBox:le.iconCollisionBox,ue=le.collisionCircleArray;ue.length>0&&(R.push({circleArray:ue,circleOffset:z,coord:re}),O+=ue.length/4,z=O),oe&&I.draw(b,T.LINES,Gt.disabled,_n.disabled,v.colorModeForRenderPass(),It.disabled,ho(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(re),E.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,v.transform.zoom,null,null,oe.collisionVertexBuffer)}if(!m||!R.length)return;const B=v.useProgram("collisionCircle"),V=new y.b$;V.resize(4*O),V._trim();let q=0;for(const te of R)for(let re=0;re<te.circleArray.length/4;re++){const le=4*re,oe=te.circleArray[le+0],ue=te.circleArray[le+1],de=te.circleArray[le+2],se=te.circleArray[le+3];V.emplace(q++,oe,ue,de,se,0),V.emplace(q++,oe,ue,de,se,1),V.emplace(q++,oe,ue,de,se,2),V.emplace(q++,oe,ue,de,se,3)}(!un||un.length<2*O)&&(un=function(te){const re=2*te,le=new y.c1;le.resize(re),le._trim();for(let oe=0;oe<re;oe++){const ue=6*oe;le.uint16[ue+0]=4*oe+0,le.uint16[ue+1]=4*oe+1,le.uint16[ue+2]=4*oe+2,le.uint16[ue+3]=4*oe+2,le.uint16[ue+4]=4*oe+3,le.uint16[ue+5]=4*oe+0}return le}(O));const ee=b.createIndexBuffer(un,!0),Q=b.createVertexBuffer(V,y.c0.members,!0);for(const te of R){const re=eu(v.transform);B.draw(b,T.TRIANGLES,Gt.disabled,_n.disabled,v.colorModeForRenderPass(),It.disabled,re,v.style.map.terrain&&v.style.map.terrain.getTerrainData(te.coord),null,u.id,Q,ee,y.aM.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,v.transform.zoom,null,null,null)}Q.destroy(),ee.destroy()}const hs=y.ag(new Float32Array(16));function Wt(v,o,u,p,m,b){const{horizontalAlign:E,verticalAlign:T}=y.aH(v);return new y.P((-(E-.5)*o/m+p[0])*b,(-(T-.5)*u/m+p[1])*b)}function rc(v,o,u,p,m,b){const E=o.tileAnchorPoint.add(new y.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let T=p.mult(b);u||(T=T.rotate(-m));const I=E.add(T);return qt(I.x,I.y,o.pitchedLabelPlaneMatrix,o.getElevation).point}if(u){const T=Dr(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(v),I=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return v.add(p.rotate(I))}return v.add(p)}function uu(v,o,u,p,m,b,E,T,I,R,O,z){const B=v.text.placedSymbolArray,V=v.text.dynamicLayoutVertexArray,q=v.icon.dynamicLayoutVertexArray,ee={};V.clear();for(let Q=0;Q<B.length;Q++){const te=B.get(Q),re=te.hidden||!te.crossTileID||v.allowVerticalPlacement&&!te.placedOrientation?null:p[te.crossTileID];if(re){const le=new y.P(te.anchorX,te.anchorY),oe={getElevation:z,width:m.width,height:m.height,pitchedLabelPlaneMatrix:b,pitchWithMap:u,transform:m,tileAnchorPoint:le,translation:R,unwrappedTileID:O},ue=u?fl(le.x,le.y,oe):Dr(le.x,le.y,oe),de=qe(m.cameraToCenterDistance,ue.signedDistanceFromCamera);let se=y.ap(v.textSizeData,T,te)*de/y.aB;u&&(se*=v.tilePixelRatio/E);const{width:ve,height:Ie,anchor:Ee,textOffset:Me,textBoxScale:Ae}=re,He=Wt(Ee,ve,Ie,Me,Ae,se),Be=m.getPitchedTextCorrection(le.x+R[0],le.y+R[1],O),ke=rc(ue.point,oe,o,He,-m.bearingInRadians,Be),rt=v.allowVerticalPlacement&&te.placedOrientation===y.ao.vertical?Math.PI/2:0;for(let $t=0;$t<te.numGlyphs;$t++)y.av(V,ke,rt);I&&te.associatedIconIndex>=0&&(ee[te.associatedIconIndex]={shiftedAnchor:ke,angle:rt})}else on(te.numGlyphs,V)}if(I){q.clear();const Q=v.icon.placedSymbolArray;for(let te=0;te<Q.length;te++){const re=Q.get(te);if(re.hidden)on(re.numGlyphs,q);else{const le=ee[te];if(le)for(let oe=0;oe<re.numGlyphs;oe++)y.av(q,le.shiftedAnchor,le.angle);else on(re.numGlyphs,q)}}v.icon.dynamicLayoutVertexBuffer.updateData(q)}v.text.dynamicLayoutVertexBuffer.updateData(V)}function za(v,o,u){return u.iconsInText&&o?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function li(v,o,u,p,m,b,E,T,I,R,O,z,B){const V=v.context,q=V.gl,ee=v.transform,Q="map"===T,te="map"===I,re="viewport"!==T&&"point"!==u.layout.get("symbol-placement"),le=Q&&!te&&!re,oe=!u.layout.get("symbol-sort-key").isConstant();let ue=!1;const de=v.getDepthModeForSublayer(0,Gt.ReadOnly),se=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ve=[],Ie=ee.getCircleRadiusCorrection();for(const Ee of p){const Me=o.getTile(Ee),Ae=Me.getBucket(u);if(!Ae)continue;const He=m?Ae.text:Ae.icon;if(!He||!He.segments.get().length||!He.hasVisibleVertices)continue;const Be=He.programConfigurations.get(u.id),ke=m||Ae.sdfIcons,rt=m?Ae.textSizeData:Ae.iconSizeData,$t=te||0!==ee.pitch,Tn=v.useProgram(za(ke,m,Ae),Be),Mn=y.an(rt,ee.zoom),ln=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ee);let hi,Ii,Ht,Bn,mr=[0,0],Xn=null;if(m)Ii=Me.glyphAtlasTexture,Ht=q.LINEAR,hi=Me.glyphAtlasTexture.size,Ae.iconsInText&&(mr=Me.imageAtlasTexture.size,Xn=Me.imageAtlasTexture,Bn=$t||v.options.rotating||v.options.zooming||"composite"===rt.kind||"camera"===rt.kind?q.LINEAR:q.NEAREST);else{const Yi=1!==u.layout.get("icon-size").constantOr(0)||Ae.iconsNeedLinear;Ii=Me.imageAtlasTexture,Ht=ke||v.options.rotating||v.options.zooming||Yi||$t?q.LINEAR:q.NEAREST,hi=Me.imageAtlasTexture.size}const cr=y.aC(Me,1,v.transform.zoom),Jr=Un(Q,v.transform,cr),Pr=y.L();y.aq(Pr,Jr);const ca=rn(te,Q,v.transform,cr),uc=y.aD(ee,Me,b,E),hc=ee.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),El=se&&Ae.hasTextData(),yu="none"!==u.layout.get("icon-text-fit")&&El&&Ae.hasIconData();if(re){const Yi=v.style.map.terrain?($o,Qn)=>v.style.map.terrain.getElevation(Ee,$o,Qn):null,_r="map"===u.layout.get("text-rotation-alignment");Ei(Ae,v,m,Jr,Pr,te,R,_r,Ee.toUnwrapped(),ee.width,ee.height,uc,Yi)}const Za=m&&se||yu,Mo=re||Za?hs:te?Jr:v.transform.clipSpaceToPixelsMatrix,Rr=ke&&0!==u.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1);let eo;eo=ke?Ae.iconsInText?Rn(rt.kind,Mn,le,te,re,Za,v,Mo,ca,uc,hi,mr,Ie):Yh(rt.kind,Mn,le,te,re,Za,v,Mo,ca,uc,m,hi,0,Ie):Eo(rt.kind,Mn,le,te,re,Za,v,Mo,ca,uc,m,hi,Ie);const ms={program:Tn,buffers:He,uniformValues:eo,projectionData:hc,atlasTexture:Ii,atlasTextureIcon:Xn,atlasInterpolation:Ht,atlasInterpolationIcon:Bn,isSDF:ke,hasHalo:Rr};if(oe&&Ae.canOverlap){ue=!0;const Yi=He.segments.get();for(const _r of Yi)ve.push({segments:new y.aM([_r]),sortKey:_r.sortKey,state:ms,terrainData:ln})}else ve.push({segments:He.segments,sortKey:0,state:ms,terrainData:ln})}ue&&ve.sort((Ee,Me)=>Ee.sortKey-Me.sortKey);for(const Ee of ve){const Me=Ee.state;if(V.activeTexture.set(q.TEXTURE0),Me.atlasTexture.bind(Me.atlasInterpolation,q.CLAMP_TO_EDGE),Me.atlasTextureIcon&&(V.activeTexture.set(q.TEXTURE1),Me.atlasTextureIcon&&Me.atlasTextureIcon.bind(Me.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Me.isSDF){const Ae=Me.uniformValues;Me.hasHalo&&(Ae.u_is_halo=1,As(Me.buffers,Ee.segments,u,v,Me.program,de,O,z,Ae,Me.projectionData,Ee.terrainData)),Ae.u_is_halo=0}As(Me.buffers,Ee.segments,u,v,Me.program,de,O,z,Me.uniformValues,Me.projectionData,Ee.terrainData)}}function As(v,o,u,p,m,b,E,T,I,R,O){const z=p.context;m.draw(z,z.gl.TRIANGLES,b,E,T,It.backCCW,I,O,R,u.id,v.layoutVertexBuffer,v.indexBuffer,o,u.paint,p.transform.zoom,v.programConfigurations.get(u.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function wl(v,o,u,p,m){const b=v.context,E=b.gl,T=_n.disabled,I=new si([E.ONE,E.ONE],y.bf.transparent,[!0,!0,!0,!0]),R=o.getBucket(u);if(!R)return;const O=p.key;let z=u.heatmapFbos.get(O);z||(z=ja(b,o.tileSize,o.tileSize),u.heatmapFbos.set(O,z)),b.bindFramebuffer.set(z.framebuffer),b.viewport.set([0,0,o.tileSize,o.tileSize]),b.clear({color:y.bf.transparent});const B=R.programConfigurations.get(u.id),V=v.useProgram("heatmap",B,!m),q=v.transform.getProjectionData({overscaledTileID:o.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ee=v.style.map.terrain.getTerrainData(p);V.draw(b,E.TRIANGLES,Gt.disabled,T,I,It.disabled,Ju(o,v.transform.zoom,u.paint.get("heatmap-intensity"),1),ee,q,u.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,u.paint,v.transform.zoom,B)}function ta(v,o,u,p,m){const b=v.context,E=b.gl,T=v.transform;b.setColorMode(v.colorModeForRenderPass());const I=hu(b,o),R=u.key,O=o.heatmapFbos.get(R);if(!O)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,O.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1),I.bind(E.LINEAR,E.CLAMP_TO_EDGE);const z=T.getProjectionData({overscaledTileID:u,applyTerrainMatrix:m,applyGlobeMatrix:!p});v.useProgram("heatmapTexture").draw(b,E.TRIANGLES,Gt.disabled,_n.disabled,v.colorModeForRenderPass(),It.disabled,tu(v,o,0,1),null,z,o.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,o.paint,T.zoom),O.destroy(),o.heatmapFbos.delete(R)}function ja(v,o,u){var p,m;const b=v.gl,E=b.createTexture();b.bindTexture(b.TEXTURE_2D,E),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const T=null!==(p=v.HALF_FLOAT)&&void 0!==p?p:b.UNSIGNED_BYTE,I=null!==(m=v.RGBA16F)&&void 0!==m?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,I,o,u,0,b.RGBA,T,null);const R=v.createFramebuffer(o,u,!1,!1);return R.colorAttachment.set(E),R}function hu(v,o){return o.colorRampTexture||(o.colorRampTexture=new y.T(v,o.colorRamp,v.gl.RGBA)),o.colorRampTexture}function ds(v,o,u,p,m){if(!u||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let E=b[u.to.toString()],T=b[u.from.toString()];if(!E&&T&&(E=T),!T&&E&&(T=E),!E||!T){const I=m.getPaintProperty(o);E=b[I],T=b[I]}E&&T&&v.setConstantPatternPositions(E,T)}function du(v,o,u,p,m,b,E,T){const I=v.context.gl,R="fill-pattern",O=u.paint.get(R),z=O&&O.constantOr(1),B=u.getCrossfadeParameters();let V,q,ee,Q,te;const re=v.transform,le=u.paint.get("fill-translate"),oe=u.paint.get("fill-translate-anchor");E?(q=z&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=I.LINES):(q=z?"fillPattern":"fill",V=I.TRIANGLES);const ue=O.constantOr(null);for(const de of p){const se=o.getTile(de);if(z&&!se.patternsLoaded())continue;const ve=se.getBucket(u);if(!ve)continue;const Ie=ve.programConfigurations.get(u.id),Ee=v.useProgram(q,Ie),Me=v.style.map.terrain&&v.style.map.terrain.getTerrainData(de);z&&(v.context.activeTexture.set(I.TEXTURE0),se.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ie.updatePaintBuffers(B)),ds(Ie,R,ue,se,u);const Ae=re.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),He=y.aD(re,se,le,oe);if(E){Q=ve.indexBuffer2,te=ve.segments2;const ke=[I.drawingBufferWidth,I.drawingBufferHeight];ee="fillOutlinePattern"===q&&z?Ts(v,B,se,ke,He):Qu(ke,He)}else Q=ve.indexBuffer,te=ve.segments,ee=z?_l(v,B,se,He):{u_fill_translate:He};const Be=v.stencilModeForClipping(de);Ee.draw(v.context,V,m,Be,b,It.backCCW,ee,Me,Ae,u.id,ve.layoutVertexBuffer,Q,te,u.paint,v.transform.zoom,Ie)}}function Va(v,o,u,p,m,b,E,T){const I=v.context,R=I.gl,O="fill-extrusion-pattern",z=u.paint.get(O),B=z.constantOr(1),V=u.getCrossfadeParameters(),q=u.paint.get("fill-extrusion-opacity"),ee=z.constantOr(null),Q=v.transform;for(const te of p){const re=o.getTile(te),le=re.getBucket(u);if(!le)continue;const oe=v.style.map.terrain&&v.style.map.terrain.getTerrainData(te),ue=le.programConfigurations.get(u.id),de=v.useProgram(B?"fillExtrusionPattern":"fillExtrusion",ue);B&&(v.context.activeTexture.set(R.TEXTURE0),re.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ue.updatePaintBuffers(V));const se=Q.getProjectionData({overscaledTileID:te,applyGlobeMatrix:!T,applyTerrainMatrix:!0});ds(ue,O,ee,re,u);const ve=y.aD(Q,re,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ie=u.paint.get("fill-extrusion-vertical-gradient"),Ee=B?af(v,Ie,q,ve,te,V,re):Cs(v,Ie,q,ve);de.draw(I,I.gl.TRIANGLES,m,b,E,It.backCCW,Ee,oe,se,u.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,u.paint,v.transform.zoom,ue,v.style.map.terrain&&le.centroidVertexBuffer)}}function gr(v,o,u,p,m,b,E,T,I){var R;const O=v.style.projection,z=v.context,B=v.transform,V=z.gl,q=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],ee=v.useProgram("hillshade",null,!1,q),Q=!v.options.moving;for(const te of p){const re=o.getTile(te),le=re.fbo;if(!le)continue;const oe=O.getMeshFromTileID(z,te.canonical,T,!0,"raster"),ue=null===(R=v.style.map.terrain)||void 0===R?void 0:R.getTerrainData(te);z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,le.colorAttachment.get());const de=B.getProjectionData({overscaledTileID:te,aligned:Q,applyGlobeMatrix:!I,applyTerrainMatrix:!0});ee.draw(z,V.TRIANGLES,b,m[te.overscaledZ],E,It.backCCW,kp(v,re,u),ue,de,u.id,oe.vertexBuffer,oe.indexBuffer,oe.segments)}}function xl(v,o,u,p,m,b,E,T,I){var R;const O=v.style.projection,z=v.context,B=v.transform,V=z.gl,q=v.useProgram("colorRelief"),ee=!v.options.moving;let Q=!0,te=0;for(const re of p){const le=o.getTile(re),oe=le.dem;if(Q){const Ee=V.getParameter(V.MAX_TEXTURE_SIZE),{elevationTexture:Me,colorTexture:Ae}=u.getColorRampTextures(z,Ee,oe.getUnpackVector());z.activeTexture.set(V.TEXTURE1),Me.bind(V.NEAREST,V.CLAMP_TO_EDGE),z.activeTexture.set(V.TEXTURE4),Ae.bind(V.LINEAR,V.CLAMP_TO_EDGE),Q=!1,te=Me.size[0]}if(!oe||!oe.data)continue;const ue=oe.stride,de=oe.getPixels();if(z.activeTexture.set(V.TEXTURE0),z.pixelStoreUnpackPremultiplyAlpha.set(!1),le.demTexture=le.demTexture||v.getTileTexture(ue),le.demTexture){const Ee=le.demTexture;Ee.update(de,{premultiply:!1}),Ee.bind(V.LINEAR,V.CLAMP_TO_EDGE)}else le.demTexture=new y.T(z,de,V.RGBA,{premultiply:!1}),le.demTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const se=O.getMeshFromTileID(z,re.canonical,T,!0,"raster"),ve=null===(R=v.style.map.terrain)||void 0===R?void 0:R.getTerrainData(re),Ie=B.getProjectionData({overscaledTileID:re,aligned:ee,applyGlobeMatrix:!I,applyTerrainMatrix:!0});q.draw(z,V.TRIANGLES,b,m[re.overscaledZ],E,It.backCCW,Wh(u,le.dem,te),ve,Ie,u.id,se.vertexBuffer,se.indexBuffer,se.segments)}}const Ct=[new y.P(0,0),new y.P(y.$,0),new y.P(y.$,y.$),new y.P(0,y.$)];function Ua(v,o,u,p,m,b,E,T,I=!1,R=!1){const O=p[p.length-1].overscaledZ,z=v.context,B=z.gl,V=v.useProgram("raster"),q=v.transform,ee=v.style.projection,Q=v.colorModeForRenderPass(),te=!v.options.moving;for(const re of p){const le=v.getDepthModeForSublayer(re.overscaledZ-O,1===u.paint.get("raster-opacity")?Gt.ReadWrite:Gt.ReadOnly,B.LESS),oe=o.getTile(re);oe.registerFadeDuration(u.paint.get("raster-fade-duration"));const ue=o.findLoadedParent(re,0),de=o.findLoadedSibling(re),se=na(oe,ue||de||null,o,u,v.transform,v.style.map.terrain);let ve,Ie;const Ee="nearest"===u.paint.get("raster-resampling")?B.NEAREST:B.LINEAR;z.activeTexture.set(B.TEXTURE0),oe.texture.bind(Ee,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(B.TEXTURE1),ue?(ue.texture.bind(Ee,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),ve=Math.pow(2,ue.tileID.overscaledZ-oe.tileID.overscaledZ),Ie=[oe.tileID.canonical.x*ve%1,oe.tileID.canonical.y*ve%1]):oe.texture.bind(Ee,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),oe.texture.useMipmap&&z.extTextureFilterAnisotropic&&v.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Me=v.style.map.terrain&&v.style.map.terrain.getTerrainData(re),Ae=q.getProjectionData({overscaledTileID:re,aligned:te,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),He=Ql(Ie||[0,0],ve||1,se,u,T),Be=ee.getMeshFromTileID(z,re.canonical,b,E,"raster");V.draw(z,B.TRIANGLES,le,m?m[re.overscaledZ]:_n.disabled,Q,I?It.frontCCW:It.backCCW,He,Me,Ae,u.id,Be.vertexBuffer,Be.indexBuffer,Be.segments)}}function na(v,o,u,p,m,b){const E=p.paint.get("raster-fade-duration");if(!b&&E>0){const T=wt.now(),I=(T-v.timeAdded)/E,R=o?(T-o.timeAdded)/E:-1,O=u.getSource(),z=pt(m,{tileSize:O.tileSize,roundZoom:O.roundZoom}),B=!o||Math.abs(o.tileID.overscaledZ-z)>Math.abs(v.tileID.overscaledZ-z),V=B&&v.refreshedUponExpiration?1:y.ah(B?I:1-R,0,1);return v.refreshedUponExpiration&&I>=1&&(v.refreshedUponExpiration=!1),o?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const ia=new y.bf(1,0,0,1),rh=new y.bf(0,1,0,1),Ga=new y.bf(0,0,1,1),ci=new y.bf(1,0,1,1),Di=new y.bf(0,1,1,1);function Lr(v,o,u,p){Ar(v,0,o+u/2,v.transform.width,u,p)}function yi(v,o,u,p){Ar(v,o-u/2,0,u,v.transform.height,p)}function Ar(v,o,u,p,m,b){const E=v.context,T=E.gl;T.enable(T.SCISSOR_TEST),T.scissor(o*v.pixelRatio,u*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),E.clear({color:b}),T.disable(T.SCISSOR_TEST)}function Br(v,o,u){const p=v.context,m=p.gl,b=v.useProgram("debug"),E=Gt.disabled,T=_n.disabled,I=v.colorModeForRenderPass(),R="$debug",O=v.style.map.terrain&&v.style.map.terrain.getTerrainData(u);p.activeTexture.set(m.TEXTURE0);const z=o.getTileByID(u.key).latestRawTileData,B=Math.floor((z&&z.byteLength||0)/1024),V=o.getTile(u).tileSize,q=512/Math.min(V,512)*(u.overscaledZ/v.transform.zoom)*.5;let ee=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ee+=` => ${u.overscaledZ}`),function(te,re){te.initDebugOverlayCanvas();const le=te.debugOverlayCanvas,oe=te.context.gl,ue=te.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,le.width,le.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(re,5,5),ue.strokeText(re,5,5),te.debugOverlayTexture.update(le),te.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(v,`${ee} ${B}kB`);const Q=v.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(p,m.TRIANGLES,E,T,si.alphaBlended,It.disabled,yl(y.bf.transparent,q),null,Q,R,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),b.draw(p,m.LINE_STRIP,E,T,I,It.disabled,yl(y.bf.red),O,Q,R,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function Xr(v,o,u,p){const{isRenderingGlobe:m}=p,b=v.context,E=b.gl,T=v.transform,I=v.colorModeForRenderPass(),R=v.getDepthModeFor3D(),O=v.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,v.width,v.height]);for(const z of u){const B=o.getTerrainMesh(z.tileID),V=v.renderToTexture.getTexture(z),q=o.getTerrainData(z.tileID);b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,V.texture);const ee=o.getMeshFrameDelta(T.zoom),Q=T.calculateFogMatrix(z.tileID.toUnwrapped()),te=qh(ee,Q,v.style.sky,T.pitch,m),re=T.getProjectionData({overscaledTileID:z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(b,E.TRIANGLES,R,_n.disabled,I,It.backCCW,te,q,re,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}function fs(v,o){if(!o.mesh){const u=new y.aL;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const p=new y.aN;p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),o.mesh=new Hn(v.createVertexBuffer(u,Ms.members),v.createIndexBuffer(p),y.aM.simpleSegment(0,0,u.length,p.length))}return o.mesh}class Bm{constructor(o,u){this.context=new cu(o),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:y.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Yt.maxUnderzooming+Yt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ku}resize(o,u,p){if(this.width=Math.floor(o*p),this.height=Math.floor(u*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,u=new y.aL;u.emplaceBack(0,0),u.emplaceBack(y.$,0),u.emplaceBack(0,y.$),u.emplaceBack(y.$,y.$),this.tileExtentBuffer=o.createVertexBuffer(u,Ms.members),this.tileExtentSegments=y.aM.simpleSegment(0,0,4,2);const p=new y.aL;p.emplaceBack(0,0),p.emplaceBack(y.$,0),p.emplaceBack(0,y.$),p.emplaceBack(y.$,y.$),this.debugBuffer=o.createVertexBuffer(p,Ms.members),this.debugSegments=y.aM.simpleSegment(0,0,4,5);const m=new y.c6;m.emplaceBack(0,0,0,0),m.emplaceBack(y.$,0,y.$,0),m.emplaceBack(0,y.$,0,y.$),m.emplaceBack(y.$,y.$,y.$,y.$),this.rasterBoundsBuffer=o.createVertexBuffer(m,sf.members),this.rasterBoundsSegments=y.aM.simpleSegment(0,0,4,2);const b=new y.aL;b.emplaceBack(0,0),b.emplaceBack(y.$,0),b.emplaceBack(0,y.$),b.emplaceBack(y.$,y.$),this.rasterBoundsBufferPosOnly=o.createVertexBuffer(b,Ms.members),this.rasterBoundsSegmentsPosOnly=y.aM.simpleSegment(0,0,4,5);const E=new y.aL;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(E,Ms.members),this.viewportSegments=y.aM.simpleSegment(0,0,4,2);const T=new y.c7;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(T);const I=new y.aN;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I);const R=this.context.gl;this.stencilClearMode=new _n({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new Hn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=y.L();y.bY(p,0,this.width,this.height,0,0,1),y.N(p,p,[u.drawingBufferWidth,u.drawingBufferHeight,0]);const m={mainMatrix:p,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:p};this.useProgram("clippingMask",null,!0).draw(o,u.TRIANGLES,Gt.disabled,this.stencilClearMode,si.disabled,It.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,u,p){if(this.currentStencilSource===o.source||!o.isTileClipped()||!u||!u.length)return;this.currentStencilSource=o.source,this.nextStencilID+u.length>256&&this.clearStencil();const m=this.context;m.setColorMode(si.disabled),m.setDepthMode(Gt.disabled);const b={};for(const E of u)b[E.key]=this.nextStencilID++;this._renderTileMasks(b,u,p,!0),this._renderTileMasks(b,u,p,!1),this._tileClippingMaskIDs=b}_renderTileMasks(o,u,p,m){const b=this.context,E=b.gl,T=this.style.projection,I=this.transform,R=this.useProgram("clippingMask");for(const O of u){const z=o[O.key],B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),V=T.getMeshFromTileID(this.context,O.canonical,m,!0,"stencil"),q=I.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!p,applyTerrainMatrix:!0});R.draw(b,E.TRIANGLES,Gt.disabled,new _n({func:E.ALWAYS,mask:0},z,255,E.KEEP,E.KEEP,E.REPLACE),si.disabled,p?It.disabled:It.backCCW,null,B,q,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}_renderTilesDepthBuffer(){const o=this.context,u=o.gl,p=this.style.projection,m=this.transform,b=this.useProgram("depth"),E=this.getDepthModeFor3D(),T=xe(m,{tileSize:m.tileSize});for(const I of T){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),O=p.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),z=m.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(o,u.TRIANGLES,E,_n.disabled,si.disabled,It.backCCW,null,R,z,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new _n({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){const u=this.context.gl;return new _n({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(o){const u=this.context.gl,p=o.sort((E,T)=>T.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let T=0;T<b;T++)E[T+m]=new _n({func:u.GEQUAL,mask:255},T+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[E,p]}return[{[m]:_n.disabled},p]}stencilConfigForOverlapTwoPass(o){const u=this.context.gl,p=o.sort((E,T)=>T.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(this.clearStencil(),b>1){const E={},T={};for(let I=0;I<b;I++)E[I+m]=new _n({func:u.GREATER,mask:255},b+1+I,255,u.KEEP,u.KEEP,u.REPLACE),T[I+m]=new _n({func:u.GREATER,mask:255},1+I,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*b+1,[E,T,p]}return this.nextStencilID=3,[{[m]:new _n({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[m]:new _n({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new si([o.CONSTANT_COLOR,o.ONE],new y.bf(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?si.unblended:si.alphaBlended}getDepthModeForSublayer(o,u,p){if(!this.opaquePassEnabledForLayer())return Gt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Gt(p||this.context.gl.LEQUAL,u,[m,m])}getDepthModeFor3D(){return new Gt(this.context.gl.LEQUAL,Gt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){var p,m;this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(wt.now()),this.imageManager.beginFrame();const b=this.style._order,E=this.style.sourceCaches,T={},I={},R={},O={isRenderingToTexture:!1,isRenderingGlobe:(null===(p=o.projection)||void 0===p?void 0:p.transitionState)>0};for(const B in E){const V=E[B];V.used&&V.prepare(this.context),T[B]=V.getVisibleCoordinates(!1),I[B]=T[B].slice().reverse(),R[B]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<b.length;B++)if(this.style._layers[b[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of b){const V=this.style._layers[B];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const q=I[V.source];("custom"===V.type||q.length)&&this.renderLayer(this,E[V.source],V,q,O)}if(null===(m=this.style.projection)||void 0===m||m.updateGPUdependent({context:this.context,useProgram:B=>this.useProgram(B)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?y.bf.black:y.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(B,V){const q=B.context,ee=q.gl,Q=((de,se,ve)=>{const Ie=Math.cos(se.rollInRadians),Ee=Math.sin(se.rollInRadians),Me=pe(se),Ae=se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:de.properties.get("sky-color"),u_horizon_color:de.properties.get("horizon-color"),u_horizon:[(se.width/2-Me*Ee)*ve,(se.height/2+Me*Ie)*ve],u_horizon_normal:[-Ee,Ie],u_sky_horizon_blend:de.properties.get("sky-horizon-blend")*se.height/2*ve,u_sky_blend:Ae}})(V,B.style.map.transform,B.pixelRatio),te=new Gt(ee.LEQUAL,Gt.ReadWrite,[0,1]),re=_n.disabled,le=B.colorModeForRenderPass(),oe=B.useProgram("sky"),ue=fs(q,V);oe.draw(q,ee.TRIANGLES,te,re,le,It.disabled,Q,null,void 0,"sky",ue.vertexBuffer,ue.indexBuffer,ue.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[b[this.currentLayer]],V=E[B.source],q=T[B.source];this._renderTileClippingMasks(B,q,!1),this.renderLayer(this,V,B,q,O)}this.renderPass="translucent";let z=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const B=this.style._layers[b[this.currentLayer]],V=E[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B,O))continue;this.opaquePassEnabledForLayer()||z||(z=!0,O.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const q=("symbol"===B.type?R:I)[B.source];this._renderTileClippingMasks(B,T[B.source],!!this.renderToTexture),this.renderLayer(this,V,B,q,O)}if(O.isRenderingGlobe&&function(B,V,q){const ee=B.context,Q=ee.gl,te=B.useProgram("atmosphere"),re=new Gt(Q.LEQUAL,Gt.ReadOnly,[0,1]),le=B.transform,oe=function(Ae,He){const Be=Ae.properties.get("position"),ke=[-Be.x,-Be.y,-Be.z],rt=y.ag(new Float64Array(16));return"map"===Ae.properties.get("anchor")&&(y.b6(rt,rt,He.rollInRadians),y.b7(rt,rt,-He.pitchInRadians),y.b6(rt,rt,He.bearingInRadians),y.b7(rt,rt,He.center.lat*Math.PI/180),y.bz(rt,rt,-He.center.lng*Math.PI/180)),y.c5(ke,ke,rt),ke}(q,B.transform),ue=le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),de=V.properties.get("atmosphere-blend")*ue.projectionTransition;if(0===de)return;const se=pl(le.worldSize,le.center.lat),ve=le.inverseProjectionMatrix,Ie=new Float64Array(4);Ie[3]=1,y.aw(Ie,Ie,le.modelViewProjectionMatrix),Ie[0]/=Ie[3],Ie[1]/=Ie[3],Ie[2]/=Ie[3],Ie[3]=1,y.aw(Ie,Ie,ve),Ie[0]/=Ie[3],Ie[1]/=Ie[3],Ie[2]/=Ie[3],Ie[3]=1;const Ee=((Ae,He,Be,ke,rt)=>({u_sun_pos:Ae,u_atmosphere_blend:He,u_globe_position:Be,u_globe_radius:ke,u_inv_proj_matrix:rt}))(oe,de,[Ie[0],Ie[1],Ie[2]],se,ve),Me=fs(ee,V);te.draw(ee,Q.TRIANGLES,re,_n.disabled,si.alphaBlended,It.disabled,Ee,null,null,"atmosphere",Me.vertexBuffer,Me.indexBuffer,Me.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const B=function(V,q){let ee=null;const Q=Object.values(V._layers).flatMap(oe=>oe.source&&!oe.isHidden(q)?[V.sourceCaches[oe.source]]:[]),te=Q.filter(oe=>"vector"===oe.getSource().type),re=Q.filter(oe=>"vector"!==oe.getSource().type),le=oe=>{(!ee||ee.getSource().maxzoom<oe.getSource().maxzoom)&&(ee=oe)};return te.forEach(oe=>le(oe)),ee||re.forEach(oe=>le(oe)),ee}(this.style,this.transform.zoom);B&&function(V,q,ee){for(let Q=0;Q<ee.length;Q++)Br(V,q,ee[Q])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const V=B.transform.padding;Lr(B,B.transform.height-(V.top||0),3,ia),Lr(B,V.bottom||0,3,rh),yi(B,V.left||0,3,Ga),yi(B,B.transform.width-(V.right||0),3,ci);const q=B.transform.centerPoint;var ee,Q,te,re;Ar(ee=B,(Q=q.x)-1,(te=B.transform.height-q.y)-10,2,20,re=Di),Ar(ee,Q-10,te-1,20,2,re)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=o?!y.c8(u,p):!y.c9(u,p)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(y.ca(u,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,E){const T=b.context,I=T.gl,R=b.transform,O=si.unblended,z=new Gt(I.LEQUAL,Gt.ReadWrite,[0,1]),B=E.sourceCache.getRenderableTiles(),V=b.useProgram("terrainDepth");T.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),T.clear({color:y.bf.transparent,depth:1});for(const q of B){const ee=E.getTerrainMesh(q.tileID),Q=E.getTerrainData(q.tileID),te=R.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),re={u_ele_delta:E.getMeshFrameDelta(R.zoom)};V.draw(T,I.TRIANGLES,z,_n.disabled,O,It.backCCW,re,Q,te,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,E){const T=b.context,I=T.gl,R=b.transform,O=si.unblended,z=new Gt(I.LEQUAL,Gt.ReadWrite,[0,1]),B=E.getCoordsTexture(),V=E.sourceCache.getRenderableTiles(),q=b.useProgram("terrainCoords");T.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),T.clear({color:y.bf.transparent,depth:1}),E.coordsIndex=[];for(const ee of V){const Q=E.getTerrainMesh(ee.tileID),te=E.getTerrainData(ee.tileID);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,B.texture);const re={u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(R.zoom)},le=R.getProjectionData({overscaledTileID:ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(T,I.TRIANGLES,z,_n.disabled,O,It.backCCW,re,te,le,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),E.coordsIndex.push(ee.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(o,u,p,m,b){p.isHidden(this.transform.zoom)||("background"===p.type||"custom"===p.type||(m||[]).length)&&(this.id=p.id,y.cb(p)?function(E,T,I,R,O,z){if("translucent"!==E.renderPass)return;const{isRenderingToTexture:B}=z,V=_n.disabled,q=E.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ee,Q,te,re,le,oe,ue,de,se){const ve=Q.transform,Ie=Q.style.map.terrain,Ee="map"===le,Me="map"===oe;for(const Ae of ee){const He=re.getTile(Ae),Be=He.getBucket(te);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const ke=y.an(Be.textSizeData,ve.zoom),rt=y.aC(He,1,Q.transform.zoom),$t=Un(Ee,Q.transform,rt),Tn="none"!==te.layout.get("icon-text-fit")&&Be.hasIconData();if(ke){const Mn=Math.pow(2,ve.zoom-He.tileID.overscaledZ),ln=Ie?(hi,Ii)=>Ie.getElevation(Ae,hi,Ii):null;uu(Be,Ee,Me,se,ve,$t,Mn,ke,Tn,y.aD(ve,He,ue,de),Ae.toUnwrapped(),ln)}}}(R,E,I,T,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),O),0!==I.paint.get("icon-opacity").constantOr(1)&&li(E,T,I,R,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),V,q,B),0!==I.paint.get("text-opacity").constantOr(1)&&li(E,T,I,R,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),V,q,B),T.map.showCollisionBoxes&&(Yn(E,T,I,R,!0),Yn(E,T,I,R,!1))}(o,u,p,m,this.style.placement.variableOffsets,b):y.cc(p)?function(E,T,I,R,O){if("translucent"!==E.renderPass)return;const{isRenderingToTexture:z}=O,B=I.paint.get("circle-opacity"),V=I.paint.get("circle-stroke-width"),q=I.paint.get("circle-stroke-opacity"),ee=!I.layout.get("circle-sort-key").isConstant();if(0===B.constantOr(1)&&(0===V.constantOr(1)||0===q.constantOr(1)))return;const Q=E.context,te=Q.gl,re=E.transform,le=E.getDepthModeForSublayer(0,Gt.ReadOnly),oe=_n.disabled,ue=E.colorModeForRenderPass(),de=[],se=re.getCircleRadiusCorrection();for(let ve=0;ve<R.length;ve++){const Ie=R[ve],Ee=T.getTile(Ie),Me=Ee.getBucket(I);if(!Me)continue;const Ae=I.paint.get("circle-translate"),He=I.paint.get("circle-translate-anchor"),Be=y.aD(re,Ee,Ae,He),ke=Me.programConfigurations.get(I.id),rt=E.useProgram("circle",ke),$t=Me.layoutVertexBuffer,Tn=Me.indexBuffer,Mn=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ie),ln={programConfiguration:ke,program:rt,layoutVertexBuffer:$t,indexBuffer:Tn,uniformValues:km(E,Ee,I,Be,se),terrainData:Mn,projectionData:re.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!z,applyTerrainMatrix:!0})};if(ee){const hi=Me.segments.get();for(const Ii of hi)de.push({segments:new y.aM([Ii]),sortKey:Ii.sortKey,state:ln})}else de.push({segments:Me.segments,sortKey:0,state:ln})}ee&&de.sort((ve,Ie)=>ve.sortKey-Ie.sortKey);for(const ve of de){const{programConfiguration:Ie,program:Ee,layoutVertexBuffer:Me,indexBuffer:Ae,uniformValues:He,terrainData:Be,projectionData:ke}=ve.state;Ee.draw(Q,te.TRIANGLES,le,oe,ue,It.backCCW,He,Be,ke,I.id,Me,Ae,ve.segments,I.paint,E.transform.zoom,Ie)}}(o,u,p,m,b):y.cd(p)?function(E,T,I,R,O){if(0===I.paint.get("heatmap-opacity"))return;const z=E.context,{isRenderingToTexture:B,isRenderingGlobe:V}=O;if(E.style.map.terrain){for(const q of R){const ee=T.getTile(q);T.hasRenderableParent(q)||("offscreen"===E.renderPass?wl(E,ee,I,q,V):"translucent"===E.renderPass&&ta(E,I,q,B,V))}z.viewport.set([0,0,E.width,E.height])}else"offscreen"===E.renderPass?function(q,ee,Q,te){const re=q.context,le=re.gl,oe=q.transform,ue=_n.disabled,de=new si([le.ONE,le.ONE],y.bf.transparent,[!0,!0,!0,!0]);(function(se,ve,Ie){const Ee=se.gl;se.activeTexture.set(Ee.TEXTURE1),se.viewport.set([0,0,ve.width/4,ve.height/4]);let Me=Ie.heatmapFbos.get(y.c2);Me?(Ee.bindTexture(Ee.TEXTURE_2D,Me.colorAttachment.get()),se.bindFramebuffer.set(Me.framebuffer)):(Me=ja(se,ve.width/4,ve.height/4),Ie.heatmapFbos.set(y.c2,Me))})(re,q,Q),re.clear({color:y.bf.transparent});for(let se=0;se<te.length;se++){const ve=te[se];if(ee.hasRenderableParent(ve))continue;const Ie=ee.getTile(ve),Ee=Ie.getBucket(Q);if(!Ee)continue;const Me=Ee.programConfigurations.get(Q.id),Ae=q.useProgram("heatmap",Me),He=oe.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Be=oe.getCircleRadiusCorrection();Ae.draw(re,le.TRIANGLES,Gt.disabled,ue,de,It.backCCW,Ju(Ie,oe.zoom,Q.paint.get("heatmap-intensity"),Be),null,He,Q.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,Q.paint,oe.zoom,Me)}re.viewport.set([0,0,q.width,q.height])}(E,T,I,R):"translucent"===E.renderPass&&function(q,ee){const Q=q.context,te=Q.gl;Q.setColorMode(q.colorModeForRenderPass());const re=ee.heatmapFbos.get(y.c2);re&&(Q.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,re.colorAttachment.get()),Q.activeTexture.set(te.TEXTURE1),hu(Q,ee).bind(te.LINEAR,te.CLAMP_TO_EDGE),q.useProgram("heatmapTexture").draw(Q,te.TRIANGLES,Gt.disabled,_n.disabled,q.colorModeForRenderPass(),It.disabled,tu(q,ee,0,1),null,null,ee.id,q.viewportBuffer,q.quadTriangleIndexBuffer,q.viewportSegments,ee.paint,q.transform.zoom))}(E,I)}(o,u,p,m,b):y.ce(p)?function(E,T,I,R,O){if("translucent"!==E.renderPass)return;const{isRenderingToTexture:z}=O,B=I.paint.get("line-opacity"),V=I.paint.get("line-width");if(0===B.constantOr(1)||0===V.constantOr(1))return;const q=E.getDepthModeForSublayer(0,Gt.ReadOnly),ee=E.colorModeForRenderPass(),Q=I.paint.get("line-dasharray"),te=I.paint.get("line-pattern"),re=te.constantOr(1),le=I.paint.get("line-gradient"),oe=I.getCrossfadeParameters(),ue=re?"linePattern":Q?"lineSDF":le?"lineGradient":"line",de=E.context,se=de.gl,ve=E.transform;let Ie=!0;for(const Ee of R){const Me=T.getTile(Ee);if(re&&!Me.patternsLoaded())continue;const Ae=Me.getBucket(I);if(!Ae)continue;const He=Ae.programConfigurations.get(I.id),Be=E.context.program.get(),ke=E.useProgram(ue,He),rt=Ie||ke.program!==Be,$t=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ee),Tn=te.constantOr(null);if(Tn&&Me.imageAtlas){const Ht=Me.imageAtlas,Bn=Ht.patternPositions[Tn.to.toString()],mr=Ht.patternPositions[Tn.from.toString()];Bn&&mr&&He.setConstantPatternPositions(Bn,mr)}const Mn=ve.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),ln=ve.getPixelScale(),hi=re?Is(E,Me,I,ln,oe):Q?In(E,Me,I,ln,Q,oe):le?Op(E,Me,I,ln,Ae.lineClipsArray.length):vl(E,Me,I,ln);if(re)de.activeTexture.set(se.TEXTURE0),Me.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),He.updatePaintBuffers(oe);else if(Q&&(rt||E.lineAtlas.dirty))de.activeTexture.set(se.TEXTURE0),E.lineAtlas.bind(de);else if(le){const Ht=Ae.gradients[I.id];let Bn=Ht.texture;if(I.gradientVersion!==Ht.version){let mr=256;if(I.stepInterpolant){const Xn=T.getSource().maxzoom,cr=Ee.canonical.z===Xn?Math.ceil(1<<E.transform.maxZoom-Ee.canonical.z):1;mr=y.ah(y.c3(Ae.maxLineLength/y.$*1024*cr),256,de.maxTextureSize)}Ht.gradient=y.c4({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:mr,image:Ht.gradient||void 0,clips:Ae.lineClipsArray}),Ht.texture?Ht.texture.update(Ht.gradient):Ht.texture=new y.T(de,Ht.gradient,se.RGBA),Ht.version=I.gradientVersion,Bn=Ht.texture}de.activeTexture.set(se.TEXTURE0),Bn.bind(I.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}const Ii=E.stencilModeForClipping(Ee);ke.draw(de,se.TRIANGLES,q,Ii,ee,It.disabled,hi,$t,Mn,I.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,I.paint,E.transform.zoom,He,Ae.layoutVertexBuffer2),Ie=!1}}(o,u,p,m,b):y.cf(p)?function(E,T,I,R,O){const z=I.paint.get("fill-color"),B=I.paint.get("fill-opacity");if(0===B.constantOr(1))return;const{isRenderingToTexture:V}=O,q=E.colorModeForRenderPass(),ee=I.paint.get("fill-pattern"),Q=E.opaquePassEnabledForLayer()&&!ee.constantOr(1)&&1===z.constantOr(y.bf.transparent).a&&1===B.constantOr(0)?"opaque":"translucent";if(E.renderPass===Q){const te=E.getDepthModeForSublayer(1,"opaque"===E.renderPass?Gt.ReadWrite:Gt.ReadOnly);du(E,T,I,R,te,q,!1,V)}if("translucent"===E.renderPass&&I.paint.get("fill-antialias")){const te=E.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly);du(E,T,I,R,te,q,!0,V)}}(o,u,p,m,b):y.cg(p)?function(E,T,I,R,O){const z=I.paint.get("fill-extrusion-opacity");if(0===z)return;const{isRenderingToTexture:B}=O;if("translucent"===E.renderPass){const V=new Gt(E.context.gl.LEQUAL,Gt.ReadWrite,E.depthRangeFor3D);if(1!==z||I.paint.get("fill-extrusion-pattern").constantOr(1))Va(E,T,I,R,V,_n.disabled,si.disabled,B),Va(E,T,I,R,V,E.stencilModeFor3D(),E.colorModeForRenderPass(),B);else{const q=E.colorModeForRenderPass();Va(E,T,I,R,V,_n.disabled,q,B)}}}(o,u,p,m,b):y.ch(p)?function(E,T,I,R,O){if("offscreen"!==E.renderPass&&"translucent"!==E.renderPass)return;const{isRenderingToTexture:z}=O,B=E.context,V=E.style.projection.useSubdivision,q=E.getDepthModeForSublayer(0,Gt.ReadOnly),ee=E.colorModeForRenderPass();if("offscreen"===E.renderPass)(function(Q,te,re,le,oe,ue,de){const se=Q.context,ve=se.gl;for(const Ie of re){const Ee=te.getTile(Ie),Me=Ee.dem;if(!Me||!Me.data||!Ee.needsHillshadePrepare)continue;const Ae=Me.dim,He=Me.stride,Be=Me.getPixels();if(se.activeTexture.set(ve.TEXTURE1),se.pixelStoreUnpackPremultiplyAlpha.set(!1),Ee.demTexture=Ee.demTexture||Q.getTileTexture(He),Ee.demTexture){const rt=Ee.demTexture;rt.update(Be,{premultiply:!1}),rt.bind(ve.NEAREST,ve.CLAMP_TO_EDGE)}else Ee.demTexture=new y.T(se,Be,ve.RGBA,{premultiply:!1}),Ee.demTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);se.activeTexture.set(ve.TEXTURE0);let ke=Ee.fbo;if(!ke){const rt=new y.T(se,{width:Ae,height:Ae,data:null},ve.RGBA);rt.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),ke=Ee.fbo=se.createFramebuffer(Ae,Ae,!0,!1),ke.colorAttachment.set(rt.texture)}se.bindFramebuffer.set(ke.framebuffer),se.viewport.set([0,0,Ae,Ae]),Q.useProgram("hillshadePrepare").draw(se,ve.TRIANGLES,oe,ue,de,It.disabled,lf(Ee.tileID,Me),null,null,le.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),Ee.needsHillshadePrepare=!1}})(E,T,R,I,q,_n.disabled,ee),B.viewport.set([0,0,E.width,E.height]);else if("translucent"===E.renderPass)if(V){const[Q,te,re]=E.stencilConfigForOverlapTwoPass(R);gr(E,T,I,re,Q,q,ee,!1,z),gr(E,T,I,re,te,q,ee,!0,z)}else{const[Q,te]=E.getStencilConfigForOverlapAndUpdateStencilID(R);gr(E,T,I,te,Q,q,ee,!1,z)}}(o,u,p,m,b):y.ci(p)?function(E,T,I,R,O){if("translucent"!==E.renderPass||!R.length)return;const{isRenderingToTexture:z}=O,B=E.style.projection.useSubdivision,V=E.getDepthModeForSublayer(0,Gt.ReadOnly),q=E.colorModeForRenderPass();if(B){const[ee,Q,te]=E.stencilConfigForOverlapTwoPass(R);xl(E,T,I,te,ee,V,q,!1,z),xl(E,T,I,te,Q,V,q,!0,z)}else{const[ee,Q]=E.getStencilConfigForOverlapAndUpdateStencilID(R);xl(E,T,I,Q,ee,V,q,!1,z)}}(o,u,p,m,b):y.cj(p)?function(E,T,I,R,O){if("translucent"!==E.renderPass||0===I.paint.get("raster-opacity")||!R.length)return;const{isRenderingToTexture:z}=O,B=T.getSource(),V=E.style.projection.useSubdivision;if(B instanceof ls)Ua(E,T,I,R,null,!1,!1,B.tileCoords,B.flippedWindingOrder,z);else if(V){const[q,ee,Q]=E.stencilConfigForOverlapTwoPass(R);Ua(E,T,I,Q,q,!1,!0,Ct,!1,z),Ua(E,T,I,Q,ee,!0,!0,Ct,!1,z)}else{const[q,ee]=E.getStencilConfigForOverlapAndUpdateStencilID(R);Ua(E,T,I,ee,q,!1,!0,Ct,!1,z)}}(o,u,p,m,b):y.ck(p)?function(E,T,I,R,O){const z=I.paint.get("background-color"),B=I.paint.get("background-opacity");if(0===B)return;const{isRenderingToTexture:V}=O,q=E.context,ee=q.gl,Q=E.style.projection,te=E.transform,re=te.tileSize,le=I.paint.get("background-pattern");if(E.isPatternMissing(le))return;const oe=!le&&1===z.a&&1===B&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==oe)return;const ue=_n.disabled,de=E.getDepthModeForSublayer(0,"opaque"===oe?Gt.ReadWrite:Gt.ReadOnly),se=E.colorModeForRenderPass(),ve=E.useProgram(le?"backgroundPattern":"background"),Ie=R||xe(te,{tileSize:re,terrain:E.style.map.terrain});le&&(q.activeTexture.set(ee.TEXTURE0),E.imageManager.bind(E.context));const Ee=I.getCrossfadeParameters();for(const Me of Ie){const Ae=te.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),He=le?Kr(B,E,le,{tileID:Me,tileSize:re},Ee):Om(B,z),Be=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Me),ke=Q.getMeshFromTileID(q,Me.canonical,!1,!0,"raster");ve.draw(q,ee.TRIANGLES,de,ue,se,It.backCCW,He,Be,Ae,I.id,ke.vertexBuffer,ke.indexBuffer,ke.segments)}}(o,0,p,m,b):y.cl(p)&&function(E,T,I,R){const{isRenderingGlobe:O}=R,z=E.context,B=I.implementation,V=E.style.projection,q=E.transform,ee=q.getProjectionDataForCustomLayer(O),Q={farZ:q.farZ,nearZ:q.nearZ,fov:q.fov*Math.PI/180,modelViewProjectionMatrix:q.modelViewProjectionMatrix,projectionMatrix:q.projectionMatrix,shaderData:{variantName:V.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${V.shaderPreludeCode.vertexSource}`,define:V.shaderDefine},defaultProjectionData:ee},te=B.renderingMode?B.renderingMode:"2d";if("offscreen"===E.renderPass){const re=B.prerender;re&&(E.setCustomLayerDefaults(),z.setColorMode(E.colorModeForRenderPass()),re.call(B,z.gl,Q),z.setDirty(),E.setBaseState())}else if("translucent"===E.renderPass){E.setCustomLayerDefaults(),z.setColorMode(E.colorModeForRenderPass()),z.setStencilMode(_n.disabled);const re="3d"===te?E.getDepthModeFor3D():E.getDepthModeForSublayer(0,Gt.ReadOnly);z.setDepthMode(re),B.render(z.gl,Q),z.setDirty(),E.setBaseState(),z.bindFramebuffer.set(null)}}(o,0,p,b))}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const u=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!u||!p}useProgram(o,u,p=!1,m=[]){this.cache=this.cache||{};const b=!!this.style.map.terrain,E=this.style.projection,T=p?Xe.projectionMercator:E.shaderPreludeCode,I=p?Pa:E.shaderDefine,R=o+(u?u.cacheKey:"")+`/${p?Kl:E.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[R]||(this.cache[R]=new me(this.context,Xe[o],u,bl[o],this._showOverdrawInspector,b,T,I,m)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:u}=this.context.gl;return this.width!==o||this.height!==u}}function fu(v,o){let u,p=!1,m=null,b=null;const E=()=>{m=null,p&&(v.apply(b,u),m=setTimeout(E,o),p=!1)};return(...T)=>(p=!0,b=this,u=T,m||E(),m)}class ps{constructor(o){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(!this._isValidHash(u))return!1;const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(0===u.length)return;const p=u.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):"#"===b&&(b="");let E=window.location.href.replace(/(#.+)?$/,b);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=fu(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const u=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),E=Math.round(u.lng*b)/b,T=Math.round(u.lat*b)/b,I=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=o?`/${E}/${T}/${p}`:`${p}/${T}/${E}`,(I||R)&&(O+="/"+Math.round(10*I)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const z=this._hashName;let B=!1;const V=window.location.hash.slice(1).split("&").map(q=>{const ee=q.split("=")[0];return ee===z?(B=!0,`${ee}=${O}`):q}).filter(q=>q);return B||V.push(`${z}=${O}`),`#${V.join("&")}`}return`#${O}`}_isValidHash(o){if(o.length<3||o.some(isNaN))return!1;try{new y.S(+o[2],+o[1])}catch{return!1}const u=+o[0],p=+(o[3]||0),m=+(o[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&p>=-180&&p<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const ra={linearity:.3,easing:y.cm(0,0,.3,1)},zp=y.e({deceleration:2500,maxSpeed:1400},ra),jp=y.e({deceleration:20,maxSpeed:1400},ra),oh=y.e({deceleration:1e3,maxSpeed:360},ra),zm=y.e({deceleration:1e3,maxSpeed:90},ra),jm=y.e({deceleration:1e3,maxSpeed:360},ra);class Vm{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:wt.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=wt.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,roll:0,pan:new y.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,u.roll+=b.rollDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(u.pan.mag()){const b=sh(u.pan.mag(),p,y.e({},zp,o||{})),E=u.pan.mult(b.amount/u.pan.mag()),T=this._map.cameraHelper.handlePanInertia(E,this._map.transform);m.center=T.easingCenter,m.offset=T.easingOffset,oa(m,b)}if(u.zoom){const b=sh(u.zoom,p,jp);m.zoom=this._map.transform.zoom+b.amount,oa(m,b)}if(u.bearing){const b=sh(u.bearing,p,oh);m.bearing=this._map.transform.bearing+y.ah(b.amount,-179,179),oa(m,b)}if(u.pitch){const b=sh(u.pitch,p,zm);m.pitch=this._map.transform.pitch+b.amount,oa(m,b)}if(u.roll){const b=sh(u.roll,p,jm);m.roll=this._map.transform.roll+y.ah(b.amount,-179,179),oa(m,b)}if(m.zoom||m.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.e(m,{noMoveStart:!0})}}function oa(v,o){(!v.duration||v.duration<o.duration)&&(v.duration=o.duration,v.easing=o.easing)}function sh(v,o,u){const{maxSpeed:p,linearity:m,deceleration:b}=u,E=y.ah(v*m/(o/1e3),-p,p),T=Math.abs(E)/(b*m);return{easing:u.easing,duration:1e3*T,amount:E*(T/2)}}class zo extends y.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,p,m={}){p=p instanceof MouseEvent?p:new MouseEvent(o,p);const b=Pe.mousePos(u.getCanvas(),p),E=u.unproject(b);super(o,y.e({point:b,lngLat:E,originalEvent:p},m)),this._defaultPrevented=!1,this.target=u}}class pu extends y.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,p){const m="touchend"===o?p.changedTouches:p.touches,b=Pe.touchPos(u.getCanvasContainer(),m),E=b.map(I=>u.unproject(I)),T=b.reduce((I,R,O,z)=>I.add(R.div(z.length)),new y.P(0,0));super(o,{points:b,point:T,lngLats:E,lngLat:u.unproject(T),originalEvent:p}),this._defaultPrevented=!1}}class Vp extends y.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class Um{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Vp(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new zo(o.type,this._map,o))}mouseup(o){this._map.fire(new zo(o.type,this._map,o))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new zo(o.type,this._map,o))}dblclick(o){return this._firePreventable(new zo(o.type,this._map,o))}mouseover(o){this._map.fire(new zo(o.type,this._map,o))}mouseout(o){this._map.fire(new zo(o.type,this._map,o))}touchstart(o){return this._firePreventable(new pu(o.type,this._map,o))}touchmove(o){this._map.fire(new pu(o.type,this._map,o))}touchend(o){this._map.fire(new pu(o.type,this._map,o))}touchcancel(o){this._map.fire(new pu(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gm{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new zo(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new zo(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ah{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.screenPointToLocation(y.P.convert(o),this._map.terrain)}}class nd{constructor(o,u){this._map=o,this._tr=new ah(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&0===o.button&&(Pe.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const p=u;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=Pe.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(m.x,p.x),E=Math.max(m.x,p.x),T=Math.min(m.y,p.y),I=Math.max(m.y,p.y);Pe.setTransform(this._box,`translate(${b}px,${T}px)`),this._box.style.width=E-b+"px",this._box.style.height=I-T+"px"}mouseupWindow(o,u){if(!this._active||0!==o.button)return;const p=this._startPos,m=u;if(this.reset(),Pe.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new y.l("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Pe.remove(this._box),this._box=null),Pe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new y.l(o,{originalEvent:u}))}}function oc(v,o){if(v.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${o.length}`);const u={};for(let p=0;p<v.length;p++)u[v[p].identifier]=o[p];return u}class $m{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new y.P(0,0);for(const E of m)b._add(E);return b.div(m.length)}(u),this.touches=oc(p,u)))}touchmove(o,u,p){if(this.aborted||!this.centroid)return;const m=oc(p,u);for(const b in this.touches){const E=m[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(o,u,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class jo{constructor(o){this.singleTap=new $m(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,u,p){this.singleTap.touchstart(o,u,p)}touchmove(o,u,p){this.singleTap.touchmove(o,u,p)}touchend(o,u,p){const m=this.singleTap.touchend(o,u,p);if(m){const b=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(b&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class sa{constructor(o){this._tr=new ah(o),this._zoomIn=new jo({numTouches:1,numTaps:2}),this._zoomOut=new jo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,p){this._zoomIn.touchstart(o,u,p),this._zoomOut.touchstart(o,u,p)}touchmove(o,u,p){this._zoomIn.touchmove(o,u,p),this._zoomOut.touchmove(o,u,p)}touchend(o,u,p){const m=this._zoomIn.touchend(o,u,p),b=this._zoomOut.touchend(o,u,p),E=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sc{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const u=this._moveFunction(...o);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(o,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,u){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=Array.isArray(u)?u[0]:u;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&Pe.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gs=0,Ci=2,Hm={[gs]:1,[Ci]:2};class aa{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const u=Pe.mouseButton(o);this._eventButton=u}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(u,p){const m=Hm[p];return void 0===u.buttons||(u.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return Pe.mouseButton(o)===this._eventButton}}class ar{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return 1===o.targetTouches.length}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}class qm{constructor(o=new aa({checkCorrectEvent:()=>!0}),u=new ar){this.mouseMoveStateManager=o,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(o,u,p){return o instanceof MouseEvent?u(o):typeof TouchEvent<"u"&&o instanceof TouchEvent?p(o):void 0}startMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}const la=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=o=>{o.preventDefault()}};class Ps{constructor(o,u){this._clickTolerance=o.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new y.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,u,p){return this._calculateTransform(o,u,p)}touchmove(o,u,p){if(this._active){if(!this._shouldBePrevented(p.length))return o.preventDefault(),this._calculateTransform(o,u,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,u,p){this._calculateTransform(o,u,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,p){p.length>0&&(this._active=!0);const m=oc(p,u),b=new y.P(0,0),E=new y.P(0,0);let T=0;for(const R in m){const O=m[R],z=this._touches[R];z&&(b._add(O),E._add(O.sub(z)),T++,m[R]=O)}if(this._touches=m,this._shouldBePrevented(T)||!E.mag())return;const I=E.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(T),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,p){if(!this._firstTwoTouches)return;o.preventDefault();const[m,b]=this._firstTwoTouches,E=Ze(p,u,m),T=Ze(p,u,b);if(!E||!T)return;const I=this._aroundCenter?null:E.add(T).div(2);return this._move([E,T],I,o)}touchend(o,u,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,E=Ze(p,u,m),T=Ze(p,u,b);E&&T||(this._active&&Pe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ze(v,o,u){for(let p=0;p<v.length;p++)if(v[p].identifier===u)return o[p]}function hf(v,o){return Math.log(v/o)/Math.LN2}class gu extends Vo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(hf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hf(this._distance,p),pinchAround:u}}}function df(v,o){return 180*v.angleWith(o)/Math.PI}class Wi extends Vo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u,p){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:df(this._vector,m),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,p=df(o,this._startVector);return Math.abs(p)<u}}function Sl(v){return Math.abs(v.y)>Math.abs(v.x)}class lh extends Vo{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,u,p){super.touchstart(o,u,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,Sl(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(o,u,p){if(void 0!==this._valid)return this._valid;const m=o.mag()>=2,b=u.mag()>=2;if(!m&&!b)return;if(!m||!b)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=o.y>0==u.y>0;return Sl(o)&&Sl(u)&&E}}const an={panStep:100,bearingStep:15,pitchStep:10};class ac{constructor(o){this._tr=new ah(o);const u=an;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,p=0,m=0,b=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:T=>{const I=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:ff,zoom:u?Math.round(I.zoom)+u*(o.shiftKey?2:1):I.zoom,bearing:I.bearing+p*this._bearingStep,pitch:I.pitch+m*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:I.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ff(v){return v*(2-v)}const $a=4.000244140625,id=1/450;class rd{constructor(o,u){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=o,this._tr=new ah(o),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=id}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let u=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=wt.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==u&&u%$a==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Pe.mousePos(this._map.getCanvas(),o),p=this._tr;this._aroundPoint=this._aroundCenter?p.transform.locationToScreenPoint(y.S.convert(p.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const T=o.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=T),"number"==typeof this._targetZoom&&(this._targetZoom+=T)}if(0!==this._delta){const T="wheel"===this._type&&Math.abs(this._delta)>$a?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&0!==I&&(I=1/I);const R="number"!=typeof this._targetZoom?o.scale:y.af(this._targetZoom);this._targetZoom=o.getConstrained(o.getCameraLngLat(),y.ak(R*I)).zoom,"wheel"===this._type&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u="number"!=typeof this._targetZoom?o.zoom:this._targetZoom,p=this._startZoom,m=this._easing;let b,E=!1;if("wheel"===this._type&&p&&m){const T=wt.now()-this._lastWheelEventTime,I=Math.min((T+5)/200,1),R=m(I);b=y.C.number(p,u,R),I<1?this._frameId||(this._frameId=!0):E=!0}else b=u,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=y.co;if(this._prevEase){const p=this._prevEase,m=(wt.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),E=.27/Math.sqrt(b*b+1e-4)*.01,T=Math.sqrt(.0729-E*E);u=y.cm(E,T,.25,1)}return this._prevEase={start:wt.now(),duration:o,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Rs{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class od{constructor(o){this._tr=new ah(o),this.reset()}reset(){this._active=!1}dblclick(o,u){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pf{constructor(){this._tap=new jo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,u,p){if(!this._swipePoint)if(this._tapTime){const m=u[0],b=o.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;b&&E?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(o,u,p)}touchmove(o,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=u[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,u,p)}touchend(o,u,p){if(this._tapTime)this._swipePoint&&0===p.length&&this.reset();else{const m=this._tap.touchend(o,u,p);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf{constructor(o,u,p){this._el=o,this._mousePan=u,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lt{constructor(o,u,p,m){this._pitchWithRotate=o.pitchWithRotate,this._rollEnabled=o.rollEnabled,this._mouseRotate=u,this._mousePitch=p,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class lc{constructor(o,u,p,m){this._el=o,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class sd{constructor(o,u){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=o,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=Pe.create("div","maplibregl-cooperative-gesture-screen",o);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=u,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Pe.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,u){this._enabled&&(this._map.fire(new y.l("cooperativegestureprevented",{gestureType:o,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Uo=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class ui extends y.l{}function mu(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class ad{constructor(o,u){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if("blur"===m.type)return void this.stop(!0);this._updatingCamera=!0;const E="renderFrame"===m.type?void 0:m,T={needsRenderFrame:!1},I={},R={};for(const{handlerName:B,handler:V,allowed:q}of this._handlers){if(!V.isEnabled())continue;let ee;if(this._blockedByActive(R,q,B))V.reset();else if(V[b||m.type]){if(y.cp(m,b||m.type)){const Q=Pe.mousePos(this._map.getCanvas(),m);ee=V[b||m.type](m,Q)}else if(y.cq(m,b||m.type)){const Q=this._getMapTouches(m.touches),te=Pe.touchPos(this._map.getCanvas(),Q);ee=V[b||m.type](m,te,Q)}else y.cr(b||m.type)||(ee=V[b||m.type](m));this.mergeHandlerResult(T,I,ee,B,E),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()}(ee||V.isActive())&&(R[B]=V)}const O={};for(const B in this._previousActiveHandlers)R[B]||(O[B]=E);this._previousActiveHandlers=R,(Object.keys(O).length||mu(T))&&(this._changes.push([T,I,O]),this._triggerRenderFrame()),(Object.keys(R).length||mu(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=T;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vm(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,E]of this._listeners)Pe.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,u,p]of this._listeners)Pe.removeEventListener(o,u,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new Um(u,o));const m=u.boxZoom=new nd(u,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const b=u.cooperativeGestures=new sd(u,o.cooperativeGestures);this._add("cooperativeGestures",b),o.cooperativeGestures&&b.enable();const E=new sa(u),T=new od(u);u.doubleClickZoom=new Rs(T,E),this._add("tapZoom",E),this._add("clickZoom",T),o.interactive&&o.doubleClickZoom&&u.doubleClickZoom.enable();const I=new pf;this._add("tapDragZoom",I);const R=u.touchPitch=new lh(u);this._add("touchPitch",R),o.interactive&&o.touchPitch&&u.touchPitch.enable(o.touchPitch);const O=()=>u.project(u.getCenter()),z=function({enable:oe,clickTolerance:ue,aroundCenter:de=!0,minPixelCenterThreshold:se=100,rotateDegreesPerPixelMoved:ve=.8},Ie){const Ee=new aa({checkCorrectEvent:Me=>0===Pe.mouseButton(Me)&&Me.ctrlKey||2===Pe.mouseButton(Me)&&!Me.ctrlKey});return new sc({clickTolerance:ue,move:(Me,Ae)=>{const He=Ie();if(de&&Math.abs(He.y-Me.y)>se)return{bearingDelta:y.cn(new y.P(Me.x,Ae.y),Ae,He)};let Be=(Ae.x-Me.x)*ve;return de&&Ae.y<He.y&&(Be=-Be),{bearingDelta:Be}},moveStateManager:Ee,enable:oe,assignEvents:la})}(o,O),B=function({enable:oe,clickTolerance:ue,pitchDegreesPerPixelMoved:de=-.5}){const se=new aa({checkCorrectEvent:ve=>0===Pe.mouseButton(ve)&&ve.ctrlKey||2===Pe.mouseButton(ve)});return new sc({clickTolerance:ue,move:(ve,Ie)=>({pitchDelta:(Ie.y-ve.y)*de}),moveStateManager:se,enable:oe,assignEvents:la})}(o),V=function({enable:oe,clickTolerance:ue,rollDegreesPerPixelMoved:de=.3},se){const ve=new aa({checkCorrectEvent:Ie=>2===Pe.mouseButton(Ie)&&Ie.ctrlKey});return new sc({clickTolerance:ue,move:(Ie,Ee)=>{const Me=se();let Ae=(Ee.x-Ie.x)*de;return Ee.y<Me.y&&(Ae=-Ae),{rollDelta:Ae}},moveStateManager:ve,enable:oe,assignEvents:la})}(o,O);u.dragRotate=new Lt(o,z,B,V),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",B,["mouseRotate","mouseRoll"]),this._add("mouseRoll",V,["mousePitch"]),o.interactive&&o.dragRotate&&u.dragRotate.enable();const q=function({enable:oe,clickTolerance:ue}){const de=new aa({checkCorrectEvent:se=>0===Pe.mouseButton(se)&&!se.ctrlKey});return new sc({clickTolerance:ue,move:(se,ve)=>({around:ve,panDelta:ve.sub(se)}),activateOnStart:!0,moveStateManager:de,enable:oe,assignEvents:la})}(o),ee=new Ps(o,u);u.dragPan=new gf(p,q,ee),this._add("mousePan",q),this._add("touchPan",ee,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&u.dragPan.enable(o.dragPan);const Q=new Wi,te=new gu;u.touchZoomRotate=new lc(p,te,Q,I),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&u.touchZoomRotate.enable(o.touchZoomRotate);const re=u.scrollZoom=new rd(u,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),o.interactive&&o.scrollZoom&&u.scrollZoom.enable(o.scrollZoom);const le=u.keyboard=new ac(u);this._add("keyboard",le),o.interactive&&o.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new Gm(u))}_add(o,u,p){this._handlers.push({handlerName:o,handler:u,allowed:p}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Uo(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,u,p){for(const m in o)if(m!==p&&(!u||u.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const u=[];for(const p of o)this._el.contains(p.target)&&u.push(p);return u}mergeHandlerResult(o,u,p,m,b){if(!p)return;y.e(o,p);const E={handlerName:m,originalEvent:p.originalEvent||b};void 0!==p.zoomDelta&&(u.zoom=E),void 0!==p.panDelta&&(u.drag=E),void 0!==p.rollDelta&&(u.roll=E),void 0!==p.pitchDelta&&(u.pitch=E),void 0!==p.bearingDelta&&(u.rotate=E)}_applyChanges(){const o={},u={},p={};for(const[m,b,E]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new y.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(o.rollDelta=(o.rollDelta||0)+m.rollDelta),void 0!==m.around&&(o.around=m.around),void 0!==m.pinchAround&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),y.e(u,b),y.e(p,E);this._updateMapTransform(o,u,p),this._changes=[]}_updateMapTransform(o,u,p){const m=this._map,b=m._getTransformForUpdate(),E=m.terrain;if(!(mu(o)||E&&this._terrainMovement))return this._fireEvents(u,p,!0);m._stop(!0);let{panDelta:T,zoomDelta:I,bearingDelta:R,pitchDelta:O,rollDelta:z,around:B,pinchAround:V}=o;void 0!==V&&(B=V),B=B||m.transform.centerPoint,E&&!b.isPointOnMapSurface(B)&&(B=b.centerPoint);const q={panDelta:T,zoomDelta:I,rollDelta:z,pitchDelta:O,bearingDelta:R,around:B};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(B)&&(B=b.centerPoint);const ee=B.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(T?B.sub(T):B);E?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(q,b),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?b.setCenter(b.screenPointToLocation(b.centerPoint.sub(T))):this._map.cameraHelper.handleMapControlsPan(q,b,ee):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(q,b,ee))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(q,b),this._map.cameraHelper.handleMapControlsPan(q,b,ee)),m._applyUpdatedTransform(b),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,p,!0)}_fireEvents(o,u,p){const m=Uo(this._eventsInProgress),b=Uo(o),E={};for(const z in o){const{originalEvent:B}=o[z];this._eventsInProgress[z]||(E[`${z}start`]=B),this._eventsInProgress[z]=o[z]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const z in E)this._fireEvent(z,E[z]);b&&this._fireEvent("move",b.originalEvent);for(const z in o){const{originalEvent:B}=o[z];this._fireEvent(z,B)}const T={};let I;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],I=u[B]||V,T[`${z}end`]=I)}for(const z in T)this._fireEvent(z,T[z]);const R=Uo(this._eventsInProgress),O=(m||b)&&!R;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(z)}if(p&&O){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;!z||!z.essential&&wt.prefersReducedMotion?(this._map.fire(new y.l("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()):(B(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new y.l(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new ui("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class ld extends y.E{constructor(o,u,p){super(),this._renderFrameCallback=()=>{const m=Math.min((wt.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=p.bearingSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(o,u){o.apply(this.transform),this.transform=o,this.cameraHelper=u}getCenter(){return new y.S(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(o,u){return this.jumpTo({elevation:o},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(o){this._centerClampedToGround=o}panBy(o,u,p){return o=y.P.convert(o).mult(-1),this.panTo(this.transform.center,y.e({offset:o},u),p)}panTo(o,u,p){return this.easeTo(y.e({center:o},u),p)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,p){return this.easeTo(y.e({zoom:o},u),p)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(o,u){return o!=this.transform.fov&&(this.transform.setFov(o),this.fire(new y.l("movestart",u)).fire(new y.l("move",u)).fire(new y.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,p){return this.easeTo(y.e({bearing:o},u),p)}resetNorth(o,u){return this.rotateTo(0,y.e({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(y.e({bearing:0,pitch:0,roll:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}getRoll(){return this.transform.roll}setRoll(o,u){return this.jumpTo({roll:o},u),this}cameraForBounds(o,u){o=Li.convert(o).adjustAntiMeridian();const p=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,u)}_cameraForBoxAndBearing(o,u,p,m){const b={top:0,bottom:0,right:0,left:0};if("number"==typeof(m=y.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding){const R=m.padding;m.padding={top:R,bottom:R,right:R,left:R}}const E=y.e(b,m.padding);m.padding=E;const T=this.transform,I=new Li(o,u);return this.cameraHelper.cameraForBoxAndBearing(m,E,I,p,T)}fitBounds(o,u,p){return this._fitInternal(this.cameraForBounds(o,u),u,p)}fitScreenCoordinates(o,u,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(y.P.convert(o)),this.transform.screenPointToLocation(y.P.convert(u)),p,m),m,b)}_fitInternal(o,u,p){return o?(delete(u=y.e(o,u)).padding,u.linear?this.easeTo(u,p):this.flyTo(u,p)):this}jumpTo(o,u){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,E=!1;const T=p.zoom;this.cameraHelper.handleJumpToCenterZoom(p,o);const I=p.zoom!==T;return"elevation"in o&&p.elevation!==+o.elevation&&p.setElevation(+o.elevation),"bearing"in o&&p.bearing!==+o.bearing&&(m=!0,p.setBearing(+o.bearing)),"pitch"in o&&p.pitch!==+o.pitch&&(b=!0,p.setPitch(+o.pitch)),"roll"in o&&p.roll!==+o.roll&&(E=!0,p.setRoll(+o.roll)),null==o.padding||p.isPaddingEqual(o.padding)||p.setPadding(o.padding),this._applyUpdatedTransform(p),this.fire(new y.l("movestart",u)).fire(new y.l("move",u)),I&&this.fire(new y.l("zoomstart",u)).fire(new y.l("zoom",u)).fire(new y.l("zoomend",u)),m&&this.fire(new y.l("rotatestart",u)).fire(new y.l("rotate",u)).fire(new y.l("rotateend",u)),b&&this.fire(new y.l("pitchstart",u)).fire(new y.l("pitch",u)).fire(new y.l("pitchend",u)),E&&this.fire(new y.l("rollstart",u)).fire(new y.l("roll",u)).fire(new y.l("rollend",u)),this.fire(new y.l("moveend",u))}calculateCameraOptionsFromTo(o,u,p,m=0){const b=y.a1.fromLngLat(o,u),E=y.a1.fromLngLat(p,m),T=E.x-b.x,I=E.y-b.y,R=E.z-b.z,O=Math.hypot(T,I,R);if(0===O)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(T,I),B=y.ak(this.transform.cameraToCenterDistance/O/this.transform.tileSize),V=180*Math.atan2(T,-I)/Math.PI;let q=180*Math.acos(z/O)/Math.PI;return q=R<0?90-q:90+q,{center:E.toLngLat(),elevation:m,zoom:B,pitch:q,bearing:V}}calculateCameraOptionsFromCameraLngLatAltRotation(o,u,p,m,b){const E=this.transform.calculateCenterFromCameraLngLatAlt(o,u,p,m);return{center:E.center,elevation:E.elevation,zoom:E.zoom,bearing:p,pitch:m,roll:b}}easeTo(o,u){this._stop(!1,o.easeId),(!1===(o=y.e({offset:[0,0],duration:500,easing:y.co},o)).animate||!o.essential&&wt.prefersReducedMotion)&&(o.duration=0);const p=this._getTransformForUpdate(),m=this.getBearing(),b=p.pitch,E=p.roll,T="bearing"in o?this._normalizeBearing(o.bearing,m):m,I="pitch"in o?+o.pitch:b,R="roll"in o?this._normalizeBearing(o.roll,E):E,O="padding"in o?o.padding:p.padding,z=y.P.convert(o.offset);let B,V;o.around&&(B=y.S.convert(o.around),V=p.locationToScreenPoint(B));const q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ee=this.cameraHelper.handleEaseTo(p,{bearing:T,pitch:I,roll:R,padding:O,around:B,aroundPoint:V,offsetAsPoint:z,offset:o.offset,zoom:o.zoom,center:o.center});return this._rotating=this._rotating||m!==T,this._pitching=this._pitching||I!==b,this._rolling=this._rolling||R!==E,this._padding=!p.isPaddingEqual(O),this._zooming=this._zooming||ee.isZooming,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,q),this.terrain&&this._prepareElevation(ee.elevationCenter),this._ease(Q=>{ee.easeFunc(Q),this.terrain&&!o.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(p),this._fireMoveEvents(u)},Q=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u,Q)},o),this}_prepareEase(o,u,p={}){this._moving=!0,u||p.moving||this.fire(new y.l("movestart",o)),this._zooming&&!p.zooming&&this.fire(new y.l("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new y.l("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new y.l("pitchstart",o)),this._rolling&&!p.rolling&&this.fire(new y.l("rollstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&u!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(p-(u-(p*o+this._elevationStart))/(1-o)),this._elevationTarget=u}this.transform.setElevation(y.C.number(this._elevationStart,this._elevationTarget,o))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){if(!this.terrain&&o.elevation>=0&&o.pitch<=90)return{};const u=o.getCameraLngLat(),p=o.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(u,o.zoom):0;if(p<m){const b=this.calculateCameraOptionsFromTo(u,m,o.center,o.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(o){const u=[];if(u.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&u.push(m=>this.transformCameraUpdate(m)),!u.length)return;const p=o.clone();for(const m of u){const b=p.clone(),{center:E,zoom:T,roll:I,pitch:R,bearing:O,elevation:z}=m(b);E&&b.setCenter(E),void 0!==z&&b.setElevation(z),void 0!==T&&b.setZoom(T),void 0!==I&&b.setRoll(I),void 0!==R&&b.setPitch(R),void 0!==O&&b.setBearing(O),p.apply(b)}this.transform.apply(p)}_fireMoveEvents(o){this.fire(new y.l("move",o)),this._zooming&&this.fire(new y.l("zoom",o)),this._rotating&&this.fire(new y.l("rotate",o)),this._pitching&&this.fire(new y.l("pitch",o)),this._rolling&&this.fire(new y.l("roll",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching,E=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,p&&this.fire(new y.l("zoomend",o)),m&&this.fire(new y.l("rotateend",o)),b&&this.fire(new y.l("pitchend",o)),E&&this.fire(new y.l("rollend",o)),this.fire(new y.l("moveend",o))}flyTo(o,u){if(!o.essential&&wt.prefersReducedMotion){const Ae=y.Q(o,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ae,u)}this.stop(),o=y.e({offset:[0,0],speed:1.2,curve:1.42,easing:y.co},o);const p=this._getTransformForUpdate(),m=p.bearing,b=p.pitch,E=p.roll,T=p.padding,I="bearing"in o?this._normalizeBearing(o.bearing,m):m,R="pitch"in o?+o.pitch:b,O="roll"in o?this._normalizeBearing(o.roll,E):E,z="padding"in o?o.padding:p.padding,B=y.P.convert(o.offset);let V=p.centerPoint.add(B);const q=p.screenPointToLocation(V),ee=this.cameraHelper.handleFlyTo(p,{bearing:I,pitch:R,roll:O,padding:z,locationAtOffset:q,offsetAsPoint:B,center:o.center,minZoom:o.minZoom,zoom:o.zoom});let Q=o.curve;const te=Math.max(p.width,p.height),re=te/ee.scaleOfZoom,le=ee.pixelPathLength;"number"==typeof ee.scaleOfMinZoom&&(Q=Math.sqrt(te/ee.scaleOfMinZoom/le*2));const oe=Q*Q;function ue(Ae){const He=(re*re-te*te+(Ae?-1:1)*oe*oe*le*le)/(2*(Ae?re:te)*oe*le);return Math.log(Math.sqrt(He*He+1)-He)}function de(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function se(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}const ve=ue(!1);let Ie=function(Ae){return se(ve)/se(ve+Q*Ae)},Ee=function(Ae){return te*((se(ve)*(de(He=ve+Q*Ae)/se(He))-de(ve))/oe)/le;var He},Me=(ue(!0)-ve)/Q;if(Math.abs(le)<2e-6||!isFinite(Me)){if(Math.abs(te-re)<1e-6)return this.easeTo(o,u);const Ae=re<te?-1:1;Me=Math.abs(Math.log(re/te))/Q,Ee=()=>0,Ie=He=>Math.exp(Ae*Q*He)}return o.duration="duration"in o?+o.duration:1e3*Me/("screenSpeed"in o?+o.screenSpeed/Q:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=m!==I,this._pitching=R!==b,this._rolling=O!==E,this._padding=!p.isPaddingEqual(z),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(ee.targetCenter),this._ease(Ae=>{const He=Ae*Me,Be=1/Ie(He),ke=Ee(He);this._rotating&&p.setBearing(y.C.number(m,I,Ae)),this._pitching&&p.setPitch(y.C.number(b,R,Ae)),this._rolling&&p.setRoll(y.C.number(E,O,Ae)),this._padding&&(p.interpolatePadding(T,z,Ae),V=p.centerPoint.add(B)),ee.easeFunc(Ae,Be,ke,V),this.terrain&&!o.freezeElevation&&this._updateElevation(Ae),this._applyUpdatedTransform(p),this._fireMoveEvents(u)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,u)}return o||null===(p=this.handlers)||void 0===p||p.stop(!1),this}_ease(o,u,p){!1===p.animate||0===p.duration?(o(1),u()):(this._easeStart=wt.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,u){o=y.aO(o,-180,180);const p=Math.abs(o-u);return Math.abs(o-360-u)<p&&(o-=360),Math.abs(o+360-u)<p&&(o+=360),o}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(y.S.convert(o),this.transform.tileZoom):null}}const cd={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ud{constructor(o=cd){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||"metadata"!==u.sourceDataType&&"visibility"!==u.sourceDataType&&"style"!==u.dataType&&"terrain"!==u.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=Pe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Pe.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Pe.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Pe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const p=this._map._getUIString(`AttributionControl.${u}`);o.title=p,o.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>"string"!=typeof m?"":m)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const u=this._map.style.sourceCaches;for(const m in u){const b=u[m];if(b.used||b.usedForTerrain){const E=b.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,b)=>m.length-b.length),o=o.filter((m,b)=>{for(let E=b+1;E<o.length;E++)if(o[E].indexOf(m)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=Pe.sanitize(p),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Up{constructor(o={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=Pe.create("div","maplibregl-ctrl");const u=Pe.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Pe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ha{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const m of p)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var hd=y.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class dt extends y.E{constructor(o){super(),this._lastTilesetChange=wt.now(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=o._source.tileSize*2**this.deltaZoom,o.usedForTerrain=!0,o.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,u){this.sourceCache.update(o,u),this._renderableTilesKeys=[];const p={};for(const m of xe(o,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),y.bY(m.terrainRttPosMatrix32f,0,y.$,y.$,0,0,1),this._tiles[m.key]=new ql(m,this.tileSize),this._lastTilesetChange=wt.now());for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(o){for(const u in this._tiles){const p=this._tiles[u];(!o||p.tileID.equals(o)||p.tileID.isChildOf(o)||o.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o,u){return u?this._getTerrainCoordsForTileRanges(o,u):this._getTerrainCoordsForRegularTile(o)}_getTerrainCoordsForRegularTile(o){const u={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID,b=o.clone(),E=y.ba();if(m.canonical.equals(o.canonical))y.bY(E,0,y.$,y.$,0,0,1);else if(m.canonical.isChildOf(o.canonical)){const T=m.canonical.z-o.canonical.z,I=m.canonical.x-(m.canonical.x>>T<<T),R=m.canonical.y-(m.canonical.y>>T<<T),O=y.$>>T;y.bY(E,0,O,O,0,0,1),y.M(E,E,[-I*O,-R*O,0])}else{if(!o.canonical.isChildOf(m.canonical))continue;{const T=o.canonical.z-m.canonical.z,I=o.canonical.x-(o.canonical.x>>T<<T),R=o.canonical.y-(o.canonical.y>>T<<T),O=y.$>>T;y.bY(E,0,y.$,y.$,0,0,1),y.M(E,E,[I*O,R*O,0]),y.N(E,E,[1/2**T,1/2**T,0])}}b.terrainRttPosMatrix32f=new Float32Array(E),u[p]=b}return u}_getTerrainCoordsForTileRanges(o,u){const p={};for(const m of this._renderableTilesKeys){const b=this._tiles[m].tileID;if(!this._isWithinTileRanges(b,u))continue;const E=o.clone(),T=y.ba();if(b.canonical.z===o.canonical.z){const I=o.canonical.x-b.canonical.x,R=o.canonical.y-b.canonical.y;y.bY(T,0,y.$,y.$,0,0,1),y.M(T,T,[I*y.$,R*y.$,0])}else if(b.canonical.z>o.canonical.z){const I=b.canonical.z-o.canonical.z,R=b.canonical.x-(b.canonical.x>>I<<I),O=b.canonical.y-(b.canonical.y>>I<<I),z=o.canonical.x-(b.canonical.x>>I),B=o.canonical.y-(b.canonical.y>>I),V=y.$>>I;y.bY(T,0,V,V,0,0,1),y.M(T,T,[-R*V+z*y.$,-O*V+B*y.$,0])}else{const I=o.canonical.z-b.canonical.z,R=o.canonical.x-(o.canonical.x>>I<<I),O=o.canonical.y-(o.canonical.y>>I<<I),z=(o.canonical.x>>I)-b.canonical.x,B=(o.canonical.y>>I)-b.canonical.y,V=y.$<<I;y.bY(T,0,V,V,0,0,1),y.M(T,T,[R*y.$+z*V,O*y.$+B*V,0])}E.terrainRttPosMatrix32f=new Float32Array(T),p[m]=E}return p}getSourceTile(o,u){const p=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!b||!b.dem)&&u)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(o.scaledTo(m--).key);return b}anyTilesAfterTime(o=Date.now()){return this._lastTilesetChange>=o}_isWithinTileRanges(o,u){return u[o.canonical.z]&&o.canonical.x>=u[o.canonical.z].minTileX&&o.canonical.x<=u[o.canonical.z].maxTileX&&o.canonical.y>=u[o.canonical.z].minTileY&&o.canonical.y<=u[o.canonical.z].maxTileY}}class Se{constructor(o,u,p){this._meshCache={},this.painter=o,this.sourceCache=new dt(u),this.options=p,this.exaggeration="number"==typeof p.exaggeration?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,u,p,m=y.$){var b;if(!(u>=0&&u<m&&p>=0&&p<m))return 0;const E=this.getTerrainData(o),T=null===(b=E.tile)||void 0===b?void 0:b.dem;if(!T)return 0;const I=y.cs([],[u/m*y.$,p/m*y.$],E.u_terrain_matrix),R=[I[0]*T.dim,I[1]*T.dim],O=Math.floor(R[0]),z=Math.floor(R[1]),B=R[0]-O,V=R[1]-z;return T.get(O,z)*(1-B)*(1-V)+T.get(O+1,z)*B*(1-V)+T.get(O,z+1)*(1-B)*V+T.get(O+1,z+1)*B*V}getElevationForLngLatZoom(o,u){if(!y.ct(u,o.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(o,u);return this.getElevation(p,m%y.$,b%y.$,y.$)}getElevation(o,u,p,m=y.$){return this.getDEMElevation(o,u,p,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,b=new y.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new y.T(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new y.T(m,new y.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=y.ag([])}const u=this.sourceCache.getSourceTile(o,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const m=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new y.T(m,u.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),u.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const p=u&&u+u.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=o.canonical.z-u.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?b=o.canonical.z-m:y.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>b<<b),T=o.canonical.y-(o.canonical.y>>b<<b),I=y.cu(new Float64Array(16),[1/(y.$<<b),1/(y.$<<b),0]);y.M(I,I,[E*y.$,T*y.$,0]),this._demMatrixCache[o.key]={matrix:I,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(o){const u=this.painter,p=u.width/devicePixelRatio,m=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new y.T(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new y.T(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set("coords"===o?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,E=0;b<this._coordsTextureSize;b++)for(let T=0;T<this._coordsTextureSize;T++,E+=4)u[E+0]=255&T,u[E+1]=255&b,u[E+2]=T>>8<<4|b>>8,u[E+3]=0;const p=new y.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),m=new y.T(o,p,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,T-E-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null);const I=u[0]+(u[2]>>4<<8),R=u[1]+((15&u[2])<<8),O=this.coordsIndex[255-u[3]],z=O&&this.sourceCache.getTileByID(O);if(!z)return null;const B=this._coordsTextureSize,V=(1<<z.tileID.canonical.z)*B;return new y.a1((z.tileID.canonical.x*B+I)/V+z.tileID.wrap,(z.tileID.canonical.y*B+R)/V,this.getElevation(z.tileID,I,R,B))}depthAtPoint(o){const u=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(o){var u;const p=(null===(u=this.painter.style.projection)||void 0===u?void 0:u.transitionState)>0,m=p&&0===o.canonical.y,b=p&&o.canonical.y===(1<<o.canonical.z)-1,E=`m_${m?"n":""}_${b?"s":""}`;if(this._meshCache[E])return this._meshCache[E];const T=this.painter.context,I=new y.cv,R=new y.aN,O=this.meshSize,z=y.$/O,B=O*O;for(let se=0;se<=O;se++)for(let ve=0;ve<=O;ve++)I.emplaceBack(ve*z,se*z,0);for(let se=0;se<B;se+=O+1)for(let ve=0;ve<O;ve++)R.emplaceBack(ve+se,O+ve+se+1,O+ve+se+2),R.emplaceBack(ve+se,O+ve+se+2,ve+se+1);const V=I.length,q=V+(O+1),ee=(O+1)*O,Q=m?y.bh:0,te=m?0:1,re=b?y.bi:y.$,le=b?0:1;for(let se=0;se<=O;se++)I.emplaceBack(se*z,Q,te);for(let se=0;se<=O;se++)I.emplaceBack(se*z,re,le);for(let se=0;se<O;se++)R.emplaceBack(ee+se,q+se,q+se+1),R.emplaceBack(ee+se,q+se+1,ee+se+1),R.emplaceBack(0+se,V+se+1,V+se),R.emplaceBack(0+se,0+se+1,V+se+1);const oe=I.length,ue=oe+2*(O+1);for(const se of[0,1])for(let ve=0;ve<=O;ve++)for(const Ie of[0,1])I.emplaceBack(se*y.$,ve*z,Ie);for(let se=0;se<2*O;se+=2)R.emplaceBack(oe+se,oe+se+1,oe+se+3),R.emplaceBack(oe+se,oe+se+3,oe+se+2),R.emplaceBack(ue+se,ue+se+3,ue+se+1),R.emplaceBack(ue+se,ue+se+2,ue+se+3);const de=new Hn(T.createVertexBuffer(I,hd.members),T.createIndexBuffer(R),y.aM.simpleSegment(0,0,I.length,R.length));return this._meshCache[E]=de,de}getMeshFrameDelta(o){return 2*Math.PI*y.bu/Math.pow(2,Math.max(o,0))/5}getMinTileElevationForLngLatZoom(o,u){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,u);return null!==(p=this.getMinMaxElevation(m).minElevation)&&void 0!==p?p:0}getMinMaxElevation(o){const u=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return u&&u.dem&&(p.minElevation=u.dem.min*this.exaggeration,p.maxElevation=u.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(o,u){const p=y.a1.fromLngLat(o.wrap()),m=(1<<u)*y.$,b=p.x*m,E=p.y*m,T=Math.floor(b/y.$),I=Math.floor(E/y.$);return{tileID:new y.Z(u,0,u,T,I),mercatorX:b,mercatorY:E}}}class zt{constructor(o,u,p){this._context=o,this._size=u,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new y.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(p.texture),{id:o,fbo:u,texture:p,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>o.id!==u),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(o=>!o.inUse)}}const Zi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class zr{constructor(o,u){this.painter=o,this.terrain=u,this.pool=new zt(o.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(p=>!o._layers[p].isHidden(u)),this._coordsAscending={};for(const p in o.sourceCaches){this._coordsAscending[p]={};const m=o.sourceCaches[p].getVisibleCoordinates(),b=o.sourceCaches[p].getSource(),E=b instanceof ls?b.terrainTileRanges:null;for(const T of m){const I=this.terrain.sourceCache.getTerrainCoords(T,E);for(const R in I)this._coordsAscending[p][R]||(this._coordsAscending[p][R]=[]),this._coordsAscending[p][R].push(I[R])}}this._coordsAscendingStr={};for(const p of o._order){const m=o._layers[p],b=m.source;if(Zi[m.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const E in this._coordsAscending[b])this._coordsAscendingStr[b][E]=this._coordsAscending[b][E].map(T=>T.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsAscendingStr){const b=this._coordsAscendingStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(o,u){if(o.isHidden(this.painter.transform.zoom))return!1;const p=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),m=o.type,b=this.painter,E=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Zi[m]&&(this._prevType&&Zi[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(o.id),!E))return!0;if(Zi[this._prevType]||Zi[m]&&E){this._prevType=m;const T=this._stacks.length-1,I=this._stacks[T]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(Xr(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[T]){const z=this.pool.getObjectForId(R.rtt[T].id);if(z.stamp===R.rtt[T].stamp){this.pool.useObject(z);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),R.rtt[T]={id:O.id,stamp:O.stamp},b.context.bindFramebuffer.set(O.fbo.framebuffer),b.context.clear({color:y.bf.transparent,stencil:0}),b.currentStencilSource=void 0;for(let z=0;z<I.length;z++){const B=b.style._layers[I[z]],V=B.source?this._coordsAscending[B.source][R.tileID.key]:[R.tileID];b.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),b._renderTileClippingMasks(B,V,!0),b.renderLayer(b,b.style.sourceCaches[B.source],B,V,p),B.source&&(R.rttCoords[B.source]=this._coordsAscendingStr[B.source][R.tileID.key])}}return Xr(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects(),Zi[m]}return!1}}const St={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Qr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:cd,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:y.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},qa={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class _u{constructor(o,u,p=!1){this.mousedown=b=>{this.startMove(b,Pe.mousePos(this.element,b)),Pe.addEventListener(window,"mousemove",this.mousemove),Pe.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,Pe.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHandler.dragEnd(b),this.offTemp()},this.touchstart=b=>{1!==b.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pe.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),Pe.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Pe.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{1!==b.targetTouches.length?this.reset():(this._lastPos=Pe.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{0===b.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;const m=new qm;this._rotatePitchHandler=new sc({clickTolerance:3,move:(b,E)=>{const T=u.getBoundingClientRect(),I=new y.P((T.bottom-T.top)/2,(T.right-T.left)/2);return{bearingDelta:y.cn(new y.P(b.x,E.y),E,I),pitchDelta:p?-.5*(E.y-b.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=o,Pe.addEventListener(u,"mousedown",this.mousedown),Pe.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Pe.addEventListener(u,"touchcancel",this.reset)}startMove(o,u){this._rotatePitchHandler.dragStart(o,u),Pe.disableDrag()}move(o,u){const p=this.map,{bearingDelta:m,pitchDelta:b}=this._rotatePitchHandler.dragMove(o,u)||{};m&&p.setBearing(p.getBearing()+m),b&&p.setPitch(p.getPitch()+b)}off(){const o=this.element;Pe.removeEventListener(o,"mousedown",this.mousedown),Pe.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),Pe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Pe.removeEventListener(window,"touchend",this.touchend),Pe.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){Pe.enableDrag(),Pe.removeEventListener(window,"mousemove",this.mousemove),Pe.removeEventListener(window,"mouseup",this.mouseup),Pe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Pe.removeEventListener(window,"touchend",this.touchend)}}let Ln;function Ti(v,o,u,p=!1){if(p||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return v?.wrap();const m=new y.S(v.lng,v.lat);if(v=new y.S(v.lng,v.lat),o){const b=new y.S(v.lng-360,v.lat),E=new y.S(v.lng+360,v.lat),T=u.locationToScreenPoint(v).distSqr(o);u.locationToScreenPoint(b).distSqr(o)<T?v=b:u.locationToScreenPoint(E).distSqr(o)<T&&(v=E)}for(;Math.abs(v.lng-u.center.lng)>180;){const b=u.locationToScreenPoint(v);if(b.x>=0&&b.y>=0&&b.x<=u.width&&b.y<=u.height)break;v.lng>u.center.lng?v.lng-=360:v.lng+=360}return v.lng!==m.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(v))?v:m}const _f={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ch(v,o,u){const p=v.classList;for(const m in _f)p.remove(`maplibregl-${u}-anchor-${m}`);p.add(`maplibregl-${u}-anchor-${o}`)}class cc extends y.E{constructor(o){if(super(),this._onKeyPress=u=>{const p=u.code,m=u.charCode||u.keyCode;"Space"!==p&&"Enter"!==p&&32!==m&&13!==m||this.togglePopup()},this._onMapClick=u=>{const p=u.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=u=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();("terrain"===u?.type||"render"===u?.type&&!p)&&this._map.once("render",this._update),this._lngLat=Ti(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?m=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?b="rotateX(0deg)":"map"===this._pitchAlignment&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&"moveend"!==u.type||(this._pos=this._pos.round()),Pe.setTransform(this._element,`${_f[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${m}`),wt.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&"moveend"===u.type)}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new y.l("dragstart"))),this.fire(new y.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new y.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=y.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pe.create("div");const u=Pe.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${p}px`),u.setAttributeNS(null,"width",`${m}px`),u.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=Pe.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const E=Pe.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const T=Pe.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const te of I){const re=Pe.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",te.rx),re.setAttributeNS(null,"ry",te.ry),T.appendChild(re)}const R=Pe.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const O=Pe.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(O);const z=Pe.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const B=Pe.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(B);const V=Pe.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const q=Pe.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=Pe.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const Q=Pe.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),q.appendChild(ee),q.appendChild(Q),E.appendChild(T),E.appendChild(R),E.appendChild(z),E.appendChild(V),E.appendChild(q),u.appendChild(E),u.setAttributeNS(null,"height",p*this._scale+"px"),u.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(u),this._offset=y.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),ch(this._element,this._anchor,"marker"),o&&o.className)for(const u of o.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),o.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Pe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=y.S.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var u,p;const m=null===(u=this._map)||void 0===u?void 0:u.terrain,b=this._map.transform.isLocationOccluded(this._lngLat);if(!m||b){const V=b?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==V&&(this._element.style.opacity=V))}if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const E=this._map,T=E.terrain.depthAtPoint(this._pos),I=E.terrain.getElevationForLngLatZoom(this._lngLat,E.transform.tileZoom);if(E.transform.lngLatToCameraDepth(this._lngLat,I)-T<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/E.transform.pixelsPerMeter,O=Math.sin(E.getPitch()*Math.PI/180)*R,z=E.terrain.depthAtPoint(new y.P(this._pos.x,this._pos.y-this._offset.y)),B=E.transform.lngLatToCameraDepth(this._lngLat,I+O)-z>.006;!(null===(p=this._popup)||void 0===p)&&p.isOpen()&&B&&this._popup.remove(),this._element.style.opacity=B?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=y.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,u){return(void 0===this._opacity||void 0===o&&void 0===u)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==o&&(this._opacity=o),void 0!==u&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const dd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wa=0,Ki=!1;const Go={maxWidth:100,unit:"metric"};function uh(v,o,u){const p=u&&u.maxWidth||100,m=v._container.clientHeight/2,b=v._container.clientWidth/2,E=v.unproject([b-p/2,m]),T=v.unproject([b+p/2,m]),I=Math.round(v.project(T).x-v.project(E).x),R=Math.min(p,I,v._container.clientWidth),O=E.distanceTo(T);if(u&&"imperial"===u.unit){const z=3.2808*O;z>5280?lr(o,R,z/5280,v._getUIString("ScaleControl.Miles")):lr(o,R,z,v._getUIString("ScaleControl.Feet"))}else u&&"nautical"===u.unit?lr(o,R,O/1852,v._getUIString("ScaleControl.NauticalMiles")):O>=1e3?lr(o,R,O/1e3,v._getUIString("ScaleControl.Kilometers")):lr(o,R,O,v._getUIString("ScaleControl.Meters"))}function lr(v,o,u,p){const m=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let T=b/E;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){const R=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*R)/R}(T),E*T}(u);v.style.width=o*(m/u)+"px",v.innerHTML=`${m}&nbsp;${p}`}const Ns={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},yf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hh(v){if(v){if("number"==typeof v){const o=Math.round(Math.abs(v)/Math.SQRT2);return{center:new y.P(0,0),top:new y.P(0,v),"top-left":new y.P(o,o),"top-right":new y.P(-o,o),bottom:new y.P(0,-v),"bottom-left":new y.P(o,-o),"bottom-right":new y.P(-o,-o),left:new y.P(v,0),right:new y.P(-v,0)}}if(v instanceof y.P||Array.isArray(v)){const o=y.P.convert(v);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:y.P.convert(v.center||[0,0]),top:y.P.convert(v.top||[0,0]),"top-left":y.P.convert(v["top-left"]||[0,0]),"top-right":y.P.convert(v["top-right"]||[0,0]),bottom:y.P.convert(v.bottom||[0,0]),"bottom-left":y.P.convert(v["bottom-left"]||[0,0]),"bottom-right":y.P.convert(v["bottom-right"]||[0,0]),left:y.P.convert(v.left||[0,0]),right:y.P.convert(v.right||[0,0])}}return hh(new y.P(0,0))}H.AJAXError=y.cz,H.Event=y.l,H.Evented=y.E,H.LngLat=y.S,H.MercatorCoordinate=y.a1,H.Point=y.P,H.addProtocol=y.cA,H.config=y.a,H.removeProtocol=y.cB,H.AttributionControl=ud,H.BoxZoomHandler=nd,H.CanvasSource=cn,H.CooperativeGesturesHandler=sd,H.DoubleClickZoomHandler=Rs,H.DragPanHandler=gf,H.DragRotateHandler=Lt,H.EdgeInsets=Ys,H.FullscreenControl=class extends y.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var o;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null!==(o=u?.shadowRoot)&&void 0!==o&&o.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:y.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Pe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=Pe.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Pe.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new y.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new y.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},H.GeoJSONSource=Ca,H.GeolocateControl=class extends y.E{constructor(v){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new y.l("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(o),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new y.l("geolocate",o)),this._finish()}},this._updateCamera=o=>{const u=new y.S(o.coords.longitude,o.coords.latitude),p=o.coords.accuracy,m=this._map.getBearing(),b=y.e({bearing:m},this.options.fitBoundsOptions),E=Li.fromLngLat(u,p);this._map.fitBounds(E,b,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const u=new y.S(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(1===o.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===o.code&&Ki)return;this.options.trackUserLocation&&this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new y.l("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Pe.create("button","maplibregl-ctrl-geolocate",this._container),Pe.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(!1===o){y.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pe.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new cc({element:this._dotElement}),this._circleElement=Pe.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{const p=u?.[0]instanceof ResizeObserverEntry;u.geolocateSource||"ACTIVE_LOCK"!==this._watchState||p||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new y.l("trackuserlocationend")),this.fire(new y.l("userlocationlostfocus")))})}},this.options=y.e({},dd,v)}onAdd(v){return this._map=v,this._container=Pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return y._(this,arguments,void 0,function*(o=!1){if(void 0!==Ln&&!o)return Ln;if(void 0===window.navigator.permissions)return Ln=!!window.navigator.geolocation,Ln;try{Ln="denied"!==(yield window.navigator.permissions.query({name:"geolocation"})).state}catch{Ln=!!window.navigator.geolocation}return Ln})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Pe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wa=0,Ki=!1}_isOutOfMapMaxBounds(v){const o=this._map.getMaxBounds(),u=v.coords;return o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),o=v.getSouthEast(),u=v.getNorthEast(),p=o.distanceTo(u),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return y.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wa--,Ki=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new y.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.l("trackuserlocationstart")),this.fire(new y.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wa++,Wa>1?(v={maximumAge:6e5,timeout:0},Ki=!0):(v=this.options.positionOptions,Ki=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},H.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const o=null===(v=this._map.getProjection())||void 0===v?void 0:v.type;this._map.setProjection("mercator"!==o&&o?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(v=this._map.getProjection())||void 0===v?void 0:v.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=Pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Pe.create("button","maplibregl-ctrl-globe",this._container),Pe.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Pe.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},H.Hash=ps,H.ImageSource=ls,H.KeyboardHandler=ac,H.LngLatBounds=Li,H.LogoControl=Up,H.Map=class extends ld{constructor(v){var o,u;y.cw.mark(y.cx.create);const p=Object.assign(Object.assign(Object.assign({},Qr),v),{canvasContextAttributes:Object.assign(Object.assign({},Qr.canvasContextAttributes),v.canvasContextAttributes)});if(null!=p.minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new En,b=new or;if(void 0!==p.minZoom&&m.setMinZoom(p.minZoom),void 0!==p.maxZoom&&m.setMaxZoom(p.maxZoom),void 0!==p.minPitch&&m.setMinPitch(p.minPitch),void 0!==p.maxPitch&&m.setMaxPitch(p.maxPitch),void 0!==p.renderWorldCopies&&m.setRenderWorldCopies(p.renderWorldCopies),super(m,b,{bearingSnap:p.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ha,this._controls=[],this._mapId=y.a7(),this._contextLost=T=>{T.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new y.l("webglcontextlost",{originalEvent:T}))},this._contextRestored=T=>{this._setupPainter(),this.resize(),this._update(),this.fire(new y.l("webglcontextrestored",{originalEvent:T}))},this._onMapScroll=T=>{if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},p.canvasContextAttributes),this._trackResize=!0===p.trackResize,this._bearingSnap=p.bearingSnap,this._centerClampedToGround=p.centerClampedToGround,this._refreshExpiredTiles=!0===p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=!0===p.crossSourceCollisions,this._collectResourceTiming=!0===p.collectResourceTiming,this._locale=Object.assign(Object.assign({},St),p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===p.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=nt.addThrottleControl(()=>this.isMoving()),this._requestManager=new yt(p.transformRequest),"string"==typeof p.container){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let T=!1;const I=fu(R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())},50);this._resizeObserver=new ResizeObserver(R=>{T?I(R):T=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ad(this,p),this._hash=p.hash&&new ps("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,elevation:p.elevation,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,roll:p.roll}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,y.e({},p.fitBoundsOptions,{duration:0}))));const E="string"==typeof p.style||"globe"!==(null===(u=null===(o=p.style)||void 0===o?void 0:o.projection)||void 0===u?void 0:u.type);this.resize(null,E),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new ud("boolean"==typeof p.attributionControl?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new Up,p.logoPosition),this.on("style.load",()=>{if(E||this._resizeTransform(),this.transform.unmodified){const T=y.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(T)}}),this.on("data",T=>{this._update("style"===T.dataType),this.fire(new y.l(`${T.dataType}data`,T))}),this.on("dataloading",T=>{this.fire(new y.l(`${T.dataType}dataloading`,T))}),this.on("dataabort",T=>{this.fire(new y.l("sourcedataabort",T))})}_getMapId(){return this._mapId}setGlobalStateProperty(v,o){return this.style.setGlobalStateProperty(v,o),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,o){if(void 0===o&&(o=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new y.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[o];return-1!==o.indexOf("bottom")?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new y.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(v);return o>-1&&this._controls.splice(o,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,o,u,p){return null==p&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,o,u,p)}resize(v,o=!0){const[u,p]=this._containerDimensions(),m=this._getClampedPixelRatio(u,p);if(this._resizeCanvas(u,p,m),this.painter.resize(u,p,m),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const T=this._getClampedPixelRatio(u,p);this._resizeCanvas(u,p,T),this.painter.resize(u,p,T)}this._resizeTransform(o);const b=!this._moving;return b&&(this.stop(),this.fire(new y.l("movestart",v)).fire(new y.l("move",v))),this.fire(new y.l("resize",v)),b&&this.fire(new y.l("moveend",v)),this}_resizeTransform(v=!0){var o;const[u,p]=this._containerDimensions();this.transform.resize(u,p,v),null===(o=this._requestedCameraState)||void 0===o||o.resize(u,p,v)}_getClampedPixelRatio(v,o){const{0:u,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,E=o*m;return Math.min(b>u?u/b:1,E>p?p/E:1)*m}getPixelRatio(){var v;return null!==(v=this._overridePixelRatio)&&void 0!==v?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Li.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.setMinZoom(v),this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.setMaxZoom(v),this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.setMinPitch(v),this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch)return this.transform.setMaxPitch(v),this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}project(v){return this.transform.locationToScreenPoint(y.S.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(y.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||(null===(v=this.handlers)||void 0===v?void 0:v.isMoving())}isZooming(){var v;return this._zooming||(null===(v=this.handlers)||void 0===v?void 0:v.isZooming())}isRotating(){var v;return this._rotating||(null===(v=this.handlers)||void 0===v?void 0:v.isRotating())}_createDelegatedListener(v,o,u){if("mouseenter"===v||"mouseover"===v){let p=!1;return{layers:o,listener:u,delegates:{mousemove:b=>{const E=o.filter(I=>this.getLayer(I)),T=0!==E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];T.length?p||(p=!0,u.call(this,new zo(v,this,b.originalEvent,{features:T}))):p=!1},mouseout:()=>{p=!1}}}}if("mouseleave"===v||"mouseout"===v){let p=!1;return{layers:o,listener:u,delegates:{mousemove:E=>{const T=o.filter(I=>this.getLayer(I));(0!==T.length?this.queryRenderedFeatures(E.point,{layers:T}):[]).length?p=!0:p&&(p=!1,u.call(this,new zo(v,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,u.call(this,new zo(v,this,E.originalEvent)))}}}}{const p=m=>{const b=o.filter(T=>this.getLayer(T)),E=0!==b.length?this.queryRenderedFeatures(m.point,{layers:b}):[];E.length&&(m.features=E,u.call(this,m),delete m.features)};return{layers:o,listener:u,delegates:{[v]:p}}}}_saveDelegatedListener(v,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(o)}_removeDelegatedListener(v,o,u){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const b=p[m];if(b.listener===u&&b.layers.length===o.length&&b.layers.every(E=>o.includes(E))){for(const E in b.delegates)this.off(E,b.delegates[E]);return void p.splice(m,1)}}}on(v,o,u){if(void 0===u)return super.on(v,o);const p="string"==typeof o?[o]:o,m=this._createDelegatedListener(v,p,u);this._saveDelegatedListener(v,m);for(const b in m.delegates)this.on(b,m.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(v,p,u)}}}once(v,o,u){if(void 0===u)return super.once(v,o);const p="string"==typeof o?[o]:o,m=this._createDelegatedListener(v,p,u);for(const b in m.delegates){const E=m.delegates[b];m.delegates[b]=(...T)=>{this._removeDelegatedListener(v,p,u),E(...T)}}this._saveDelegatedListener(v,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(v,o,u){return void 0===u?super.off(v,o):(this._removeDelegatedListener(v,"string"==typeof o?[o]:o,u),this)}queryRenderedFeatures(v,o){if(!this.style)return[];let u;const p=v instanceof y.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(p?{}:v)||{},m instanceof y.P||"number"==typeof m[0])u=[y.P.convert(m)];else{const b=y.P.convert(m[0]),E=y.P.convert(m[1]);u=[b,new y.P(E.x,b.y),E,new y.P(b.x,E.y),b]}return this.style.queryRenderedFeatures(u,o,this.transform)}querySourceFeatures(v,o){return this.style.querySourceFeatures(v,o)}setStyle(v,o){return!1!==(o=y.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(v,o))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const o=this._locale[v];if(null==o)throw new Error(`Missing UI string '${v}'`);return o}_updateStyle(v,o){var u,p;if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,o));const m=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new ka(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof v?this.style.loadURL(v,o,m):this.style.loadJSON(v,o,m),this):(null===(p=null===(u=this.style)||void 0===u?void 0:u.projection)||void 0===p||p.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ka(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,o){if("string"==typeof v){const u=this._requestManager.transformRequest(v,"Style");y.j(u,new AbortController).then(p=>{this._updateDiff(p.data,o)}).catch(p=>{p&&this.fire(new y.k(p))})}else"object"==typeof v&&this._updateDiff(v,o)}_updateDiff(v,o){try{this.style.setState(v,o)&&this._update(!0)}catch(u){y.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(v,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():y.w("There is no style added to the map.")}addSource(v,o){return this._lazyInitEmptyStyle(),this.style.addSource(v,o),this._update(!0)}isSourceLoaded(v){const o=this.style&&this.style.sourceCaches[v];if(void 0!==o)return o.loaded();this.fire(new y.k(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const o=this.style.sourceCaches[v.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);null===this.terrain&&o.reload();for(const u in this.style._layers){const p=this.style._layers[u];"hillshade"===p.type&&p.source===v.source&&y.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===p.type&&p.source===v.source&&y.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Se(this.painter,o,v),this.painter.renderToTexture=new zr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var p;"style"===u.dataType?this.terrain.sourceCache.freeRtt():"source"===u.dataType&&u.tile&&(u.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(p=u.source)||void 0===p?void 0:p.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new y.l("terrain",{terrain:v})),this}getTerrain(){var v,o;return null!==(o=null===(v=this.terrain)||void 0===v?void 0:v.options)&&void 0!==o?o:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const o in v){const u=v[o]._tiles;for(const p in u){const m=u[p];if("loaded"!==m.state&&"errored"!==m.state)return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,o,u){if(u){const p=this.getSource(u);if(!p)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);p.calculateTileZoom=Ve(Math.max(1,v),Math.max(1,o))}else for(const p in this.style.sourceCaches)this.style.sourceCaches[p].getSource().calculateTileZoom=Ve(Math.max(1,v),Math.max(1,o));return this._update(!0),this}refreshTiles(v,o){const u=this.style.sourceCaches[v];if(!u)throw new Error(`There is no source cache with ID "${v}", cannot refresh tile`);void 0===o?u.reload(!0):u.refreshTiles(o.map(p=>new y.a4(p.z,p.x,p.y)))}addImage(v,o,u={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:E,content:T,textFitWidth:I,textFitHeight:R}=u;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||y.b(o))){if(void 0===o.width||void 0===o.height)return this.fire(new y.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:z,data:B}=o,V=o;return this.style.addImage(v,{data:new y.R({width:O,height:z},new Uint8Array(B)),pixelRatio:p,stretchX:b,stretchY:E,content:T,textFitWidth:I,textFitHeight:R,sdf:m,version:0,userImage:V}),V.onAdd&&V.onAdd(this,v),this}}{const{width:O,height:z,data:B}=wt.getImageData(o);this.style.addImage(v,{data:new y.R({width:O,height:z},B),pixelRatio:p,stretchX:b,stretchY:E,content:T,textFitWidth:I,textFitHeight:R,sdf:m,version:0})}}updateImage(v,o){const u=this.style.getImage(v);if(!u)return this.fire(new y.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||y.b(o)?wt.getImageData(o):o,{width:m,height:b,data:E}=p;if(void 0===m||void 0===b)return this.fire(new y.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==u.data.width||b!==u.data.height)return this.fire(new y.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(o instanceof HTMLImageElement||y.b(o));return u.data.replace(E,T),this.style.updateImage(v,u),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new y.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return nt.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,o){return this._lazyInitEmptyStyle(),this.style.addLayer(v,o),this._update(!0)}moveLayer(v,o){return this.style.moveLayer(v,o),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,o,u){return this.style.setLayerZoomRange(v,o,u),this._update(!0)}setFilter(v,o,u={}){return this.style.setFilter(v,o,u),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,o,u,p={}){return this.style.setPaintProperty(v,o,u,p),this._update(!0)}getPaintProperty(v,o){return this.style.getPaintProperty(v,o)}setLayoutProperty(v,o,u,p={}){return this.style.setLayoutProperty(v,o,u,p),this._update(!0)}getLayoutProperty(v,o){return this.style.getLayoutProperty(v,o)}setGlyphs(v,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,o,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,o,u,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,o,u=>{u||this._update(!0)}),this}setLight(v,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,o={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,o),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,o){return this.style.setFeatureState(v,o),this._update()}removeFeatureState(v,o){return this.style.removeFeatureState(v,o),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,o=0;return this._container&&(v=this._container.clientWidth||400,o=this._container.clientHeight||300),[v,o]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const o=this._canvasContainer=Pe.create("div","maplibregl-canvas-container",v);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=Pe.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),p=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],p);const m=this._controlContainer=Pe.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{b[E]=Pe.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,o,u){this._canvas.width=Math.floor(u*v),this._canvas.height=Math.floor(u*o),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let o=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{o={requestedAttributes:v},p&&(o.statusMessage=p.statusMessage,o.type=p.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!u){const p="Failed to initialize WebGL";throw o?(o.message=p,new Error(JSON.stringify(o))):new Error(p)}this.painter=new Bm(u,this.transform),No.testSupport(u)}migrateProjection(v,o){super.migrateProjection(v,o),this.painter.transform=v,this.fire(new y.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var o,u,p,m,b;const E=this._idleTriggered?this._fadeDuration:0,T=(null===(o=this.style.projection)||void 0===o?void 0:o.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,B=wt.now();this.style.zoomHistory.update(z,B);const V=new y.F(z,{now:B,fadeDuration:E,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),q=V.crossFadingFactor();1===q&&q===this._crossFadingFactor||(I=!0,this._crossFadingFactor=q),this.style.update(V)}const R=(null===(u=this.style.projection)||void 0===u?void 0:u.transitionState)>0!==T;null===(p=this.style.projection)||void 0===p||p.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(m=this.style.projection)||void 0===m?void 0:m.transitionState,null===(b=this.style.projection)||void 0===b?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,showPadding:this.showPadding}),this.fire(new y.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,y.cw.mark(y.cx.load),this.fire(new y.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.l("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,y.cw.mark(y.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),nt.removeThrottleControl(this._imageQueueHandle),null===(v=this._resizeObserver)||void 0===v||v.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Pe.remove(this._canvasContainer),Pe.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),y.cw.clearMetrics(),this._removed=!0,this.fire(new y.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,wt.frame(this._frameRequest,v=>{y.cw.frame(v),this._frameRequest=null;try{this._render(v)}catch(o){if(!y.cy(o)&&o.message!==Bi)throw o}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return"5.6.2"}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},H.MapMouseEvent=zo,H.MapTouchEvent=pu,H.MapWheelEvent=Vp,H.Marker=cc,H.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const o=this._map.getZoom(),u=o===this._map.getMaxZoom(),p=o===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(o,u)=>{const p=this._map._getUIString(`NavigationControl.${u}`);o.title=p,o.setAttribute("aria-label",p)},this.options=y.e({},qa,v),this._container=Pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),Pe.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),Pe.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Pe.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _u(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Pe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,o){const u=Pe.create("button",v,this._container);return u.type="button",u.addEventListener("click",o),u}},H.Popup=class extends y.E{constructor(v){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Pe.remove(this._content),this._container&&(Pe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new y.l("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Pe.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Pe.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ti(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!o)return;const u=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationToScreenPoint(this._lngLat));let p=this.options.anchor;const m=hh(this.options.offset);if(!p){const E=this._container.offsetWidth,T=this._container.offsetHeight;let I;I=u.y+m.bottom.y<T?["top"]:u.y>this._map.transform.height-T?["bottom"]:[],u.x<E/2?I.push("left"):u.x>this._map.transform.width-E/2&&I.push("right"),p=0===I.length?"bottom":I.join("-")}let b=u.add(m[p]);this.options.subpixelPositioning||(b=b.round()),Pe.setTransform(this._container,`${_f[p]} translate(${b.x}px,${b.y}px)`),ch(this._container,p,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=y.e(Object.create(Ns),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new y.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=y.S.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const o=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=v;p=u.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){var v;return null===(v=this._container)||void 0===v?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Pe.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=Pe.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(yf);v&&v.focus()}},H.RasterDEMTileSource=hl,H.RasterTileSource=ko,H.ScaleControl=class{constructor(v){this._onMove=()=>{uh(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,uh(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Go),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=Pe.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Pe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},H.ScrollZoomHandler=rd,H.Style=ka,H.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=Pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Pe.create("button","maplibregl-ctrl-terrain",this._container),Pe.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Pe.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},H.TwoFingersTouchPitchHandler=lh,H.TwoFingersTouchRotateHandler=Wi,H.TwoFingersTouchZoomHandler=gu,H.TwoFingersTouchZoomRotateHandler=lc,H.VectorTileSource=Es,H.VideoSource=Gc,H.addSourceType=(v,o)=>y._(void 0,void 0,void 0,function*(){if(Zs(v))throw new Error(`A source type called "${v}" already exists.`);Ws[v]=o}),H.clearPrewarmedResources=function(){const v=qs;v&&(v.isPreloaded()&&1===v.numActive()?(v.release(lo),qs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},H.createTileMesh=$h,H.getMaxParallelImageRequests=function(){return y.a.MAX_PARALLEL_IMAGE_REQUESTS},H.getRTLTextPluginStatus=function(){return Ia().getRTLTextPluginStatus()},H.getVersion=function(){return"5.6.2"},H.getWorkerCount=function(){return Mr.workerCount},H.getWorkerUrl=function(){return y.a.WORKER_URL},H.importScriptInWorkers=function(v){return Vc().broadcast("IS",v)},H.prewarm=function(){os().acquire(lo)},H.setMaxParallelImageRequests=function(v){y.a.MAX_PARALLEL_IMAGE_REQUESTS=v},H.setRTLTextPlugin=function(v,o){return Ia().setRTLTextPlugin(v,o)},H.setWorkerCount=function(v){Mr.workerCount=v},H.setWorkerUrl=function(v){y.a.WORKER_URL=v}}),zc}()},720:(Tp,zc,Gl)=>{"use strict";let jc;function Vh(){return jc}function H(e){const t=jc;return jc=e,t}const st=Symbol("NotFound");function Fr(e){return e===st||"\u0275NotFound"===e?.name}Error;let wt=null,Pe=!1,No=1;const zn=Symbol("SIGNAL");function Mt(e){const t=wt;return wt=e,t}const yt={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function ht(e){if(Pe)throw new Error("");if(null===wt)return;wt.consumerOnSignalRead(e);const t=wt.producersTail;if(void 0!==t&&t.producer===e)return;let n;const i=wt.recomputing;if(i&&(n=void 0!==t?t.nextProducer:wt.producers,void 0!==n&&n.producer===e))return wt.producersTail=n,void(n.lastReadVersion=e.version);const r=e.consumersTail;if(void 0!==r&&r.consumer===wt&&(!i||function $l(e,t){const n=t.producersTail;if(void 0!==n){let i=t.producers;do{if(i===e)return!0;if(i===n)break;i=i.nextProducer}while(void 0!==i)}return!1}(r,wt)))return;const a=pn(wt),h={producer:e,consumer:wt,nextProducer:n,prevConsumer:r,lastReadVersion:e.version,nextConsumer:void 0};wt.producersTail=h,void 0!==t?t.nextProducer=h:wt.producers=h,a&&Hs(e,h)}function jn(e){if((!pn(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==No)){if(!e.producerMustRecompute(e)&&!wo(e))return void An(e);e.producerRecomputeValue(e),An(e)}}function Dn(e){if(void 0===e.consumers)return;const t=Pe;Pe=!0;try{for(let n=e.consumers;void 0!==n;n=n.nextConsumer){const i=n.consumer;i.dirty||ri(i)}}finally{Pe=t}}function dr(){return!1!==wt?.consumerAllowSignalWrites}function ri(e){e.dirty=!0,Dn(e),e.consumerMarkedDirty?.(e)}function An(e){e.dirty=!1,e.lastCleanEpoch=No}function Fi(e){return e&&(e.producersTail=void 0,e.recomputing=!0),Mt(e)}function rs(e,t){if(Mt(t),!e)return;e.recomputing=!1;const n=e.producersTail;let i=void 0!==n?n.nextProducer:e.producers;if(void 0!==i){if(pn(e))do{i=qr(i)}while(void 0!==i);void 0!==n?n.nextProducer=void 0:e.producers=void 0}}function wo(e){for(let t=e.producers;void 0!==t;t=t.nextProducer){const n=t.producer,i=t.lastReadVersion;if(i!==n.version||(jn(n),i!==n.version))return!0}return!1}function xo(e){if(pn(e)){let t=e.producers;for(;void 0!==t;)t=qr(t)}e.producers=void 0,e.producersTail=void 0,e.consumers=void 0,e.consumersTail=void 0}function Hs(e,t){const n=e.consumersTail,i=pn(e);if(void 0!==n?(t.nextConsumer=n.nextConsumer,n.nextConsumer=t):(t.nextConsumer=void 0,e.consumers=t),t.prevConsumer=n,e.consumersTail=t,!i)for(let r=e.producers;void 0!==r;r=r.nextProducer)Hs(r.producer,r)}function qr(e){const t=e.producer,n=e.nextProducer,i=e.nextConsumer,r=e.prevConsumer;if(e.nextConsumer=void 0,e.prevConsumer=void 0,void 0!==i?i.prevConsumer=r:t.consumersTail=r,void 0!==r)r.nextConsumer=i;else if(t.consumers=i,!pn(t)){let a=t.producers;for(;void 0!==a;)a=qr(a)}return n}function pn(e){return e.consumerIsAlwaysLive||void 0!==e.consumers}let as=function ss(){throw new Error};function Hl(e){as(e)}function Li(e,t){const n=Object.create(ls);n.value=e,void 0!==t&&(n.equal=t);const i=()=>function Es(e){return ht(e),e.value}(n);return i[zn]=n,[i,h=>ko(n,h),h=>function hl(e,t){dr()||Hl(e),ko(e,t(e.value))}(n,h)]}function ko(e,t){dr()||Hl(e),e.equal(e.value,t)||(e.value=t,function Gc(e){e.version++,function tn(){No++}(),Dn(e)}(e))}const ls={...yt,equal:function $s(e,t){return Object.is(e,t)},value:void 0,kind:"signal"};function cn(e){return"function"==typeof e}function Ws(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Zs=Ws(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function Ks(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Si{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const a of n)a.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(cn(i))try{i()}catch(a){t=a instanceof Zs?a.errors:[a]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const a of r)try{ql(a)}catch(h){t=t??[],h instanceof Zs?t=[...t,...h.errors]:t.push(h)}}if(t)throw new Zs(t)}}add(t){var n;if(t&&t!==this)if(this.closed)ql(t);else{if(t instanceof Si){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&Ks(n,t)}remove(t){const{_finalizers:n}=this;n&&Ks(n,t),t instanceof Si&&t._removeParent(this)}}Si.EMPTY=(()=>{const e=new Si;return e.closed=!0,e})();const Ta=Si.EMPTY;function Ia(e){return e instanceof Si||e&&"closed"in e&&cn(e.remove)&&cn(e.add)&&cn(e.unsubscribe)}function ql(e){cn(e)?e():e.unsubscribe()}const _e={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},W={setTimeout(e,t,...n){const{delegate:i}=W;return i?.setTimeout?i.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=W;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function K(e){W.setTimeout(()=>{const{onUnhandledError:t}=_e;if(!t)throw e;t(e)})}function X(){}const ae=Ce("C",void 0,void 0);function Ce(e,t,n){return{kind:e,value:t,error:n}}let ye=null;function Ne(e){if(_e.useDeprecatedSynchronousErrorHandling){const t=!ye;if(t&&(ye={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=ye;if(ye=null,n)throw i}}else e()}class Fe extends Si{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Ia(t)&&t.add(this)):this.destination=fr}static create(t,n,i){return new Yt(t,n,i)}next(t){this.isStopped?Vn(function we(e){return Ce("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Vn(function pe(e){return Ce("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Vn(ae,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const pt=Function.prototype.bind;function xe(e,t){return pt.call(e,t)}class Nt{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(i){_t(i)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(i){_t(i)}else _t(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){_t(n)}}}class Yt extends Fe{constructor(t,n,i){let r;if(super(),cn(t)||!t)r={next:t??void 0,error:n??void 0,complete:i??void 0};else{let a;this&&_e.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&xe(t.next,a),error:t.error&&xe(t.error,a),complete:t.complete&&xe(t.complete,a)}):r=t}this.destination=new Nt(r)}}function _t(e){_e.useDeprecatedSynchronousErrorHandling?function Ve(e){_e.useDeprecatedSynchronousErrorHandling&&ye&&(ye.errorThrown=!0,ye.error=e)}(e):K(e)}function Vn(e,t){const{onStoppedNotification:n}=_e;n&&W.setTimeout(()=>n(e,t))}const fr={closed:!0,next:X,error:function Ut(e){throw e},complete:X},qi="function"==typeof Symbol&&Symbol.observable||"@@observable";function Un(e){return e}function hn(e){return 0===e.length?Un:1===e.length?e[0]:function(n){return e.reduce((i,r)=>r(i),n)}}let qt=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,r){const a=function Ei(e){return e&&e instanceof Fe||function Zr(e){return e&&cn(e.next)&&cn(e.error)&&cn(e.complete)}(e)&&Ia(e)}(n)?n:new Yt(n,i,r);return Ne(()=>{const{operator:h,source:d}=this;a.add(h?h.call(a,d):d?this._subscribe(a):this._trySubscribe(a))}),a}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=qe(i))((r,a)=>{const h=new Yt({next:d=>{try{n(d)}catch(_){a(_),h.unsubscribe()}},error:a,complete:r});this.subscribe(h)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[qi](){return this}pipe(...n){return hn(n)(this)}toPromise(n){return new(n=qe(n))((i,r)=>{let a;this.subscribe(h=>a=h,h=>r(h),()=>i(a))})}}return e.create=t=>new e(t),e})();function qe(e){var t;return null!==(t=e??_e.Promise)&&void 0!==t?t:Promise}const dl=Ws(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Cn=(()=>{class e extends qt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new it(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new dl}next(n){Ne(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){Ne(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){Ne(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:r,observers:a}=this;return i||r?Ta:(this.currentObservers=null,a.push(n),new Si(()=>{this.currentObservers=null,Ks(a,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:r,isStopped:a}=this;i?n.error(r):a&&n.complete()}asObservable(){const n=new qt;return n.source=this,n}}return e.create=(t,n)=>new it(t,n),e})();class it extends Cn{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:Ta}}class Pt extends Cn{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}class Te extends Error{code;constructor(t,n){super(function At(e,t){return`${function fl(e){return`NG0${Math.abs(e)}`}(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function on(e){for(let t in e)if(e[t]===on)return t;throw Error("")}function $c(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Sn(e){if("string"==typeof e)return e;if(Array.isArray(e))return`[${e.map(Sn).join(", ")}]`;if(null==e)return""+e;const t=e.overriddenName||e.name;if(t)return`${t}`;const n=e.toString();if(null==n)return""+n;const i=n.indexOf("\n");return i>=0?n.slice(0,i):n}function Hc(e,t){return e?t?`${e} ${t}`:e:t||""}globalThis;const $n=on({__forward_ref__:on});function Pn(e){return e.__forward_ref__=Pn,e.toString=function(){return Sn(this())},e}function Vt(e){return qc(e)?e():e}function qc(e){return"function"==typeof e&&e.hasOwnProperty($n)&&e.__forward_ref__===Pn}function Xe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Hn(e){return{providers:e.providers||[],imports:e.imports||[]}}function Ms(e){return function Kl(e,t){return e.hasOwnProperty(t)&&e[t]||null}(e,Yl)}function Ys(e){return e&&e.hasOwnProperty(Zc)?e[Zc]:null}const Yl=on({\u0275prov:on}),Zc=on({\u0275inj:on});class $e{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,n){this._desc=t,this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Xe({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function uo(e){return e&&!!e.\u0275providers}const cs=on({\u0275cmp:on}),Xs=on({\u0275dir:on}),Gh=on({\u0275pipe:on}),$h=on({\u0275mod:on}),us=on({\u0275fac:on}),Na=on({__NG_ELEMENT_ID__:on}),Yu=on({__NG_ENV_ID__:on});function Bt(e){return"string"==typeof e?e:null==e?"":String(e)}const pl=on({ngErrorCode:on}),Yc=on({ngErrorMessage:on}),Ds=on({ngTokenPath:on});function mi(e,t){return Qc("",-200,t)}function tf(e,t){throw new Te(-201,!1)}function Qc(e,t,n){const i=new Te(t,e);return i[pl]=t,i[Yc]=e,n&&(i[Ds]=n),i}let Xl;function Jc(){return Xl}function Gn(e){const t=Xl;return Xl=e,t}function nf(e,t,n){const i=Ms(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:8&n?null:void 0!==t?t:void tf()}const ka={},sf="__NG_DI_FLAG__";class Nm{injector;constructor(t){this.injector=t}retrieve(t,n){const i=ml(n)||0;try{return this.injector.get(t,8&i?null:ka,i)}catch(r){if(Fr(r))return r;throw r}}}function qh(e,t=0){const n=Vh();if(void 0===n)throw new Te(-203,!1);if(null===n)return nf(e,void 0,t);{const i=function Cs(e){return{optional:!!(8&e),host:!!(1&e),self:!!(2&e),skipSelf:!!(4&e)}}(t),r=n.retrieve(e,i);if(Fr(r)){if(i.optional)return null;throw r}return r}}function Ft(e,t=0){return(Jc()||qh)(Vt(e),t)}function me(e,t){return Ft(e,ml(t))}function ml(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function af(e){const t=[];for(let n=0;n<e.length;n++){const i=Vt(e[n]);if(Array.isArray(i)){if(0===i.length)throw new Te(900,!1);let r,a=0;for(let h=0;h<i.length;h++){const d=i[h],_=Qu(d);"number"==typeof _?-1===_?r=d.token:a|=_:r=d}t.push(Ft(r,a))}else t.push(Ft(i))}return t}function _l(e,t){return e[sf]=t,e.prototype[sf]=t,e}function Qu(e){return e[sf]}function Ts(e,t){return e.hasOwnProperty(us)?e[us]:null}function eu(e,t){e.forEach(n=>Array.isArray(n)?eu(n,t):t(n))}function yl(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Ju(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function nu(e,t,n){let i=vl(e,t);return i>=0?e[1|i]=n:(i=~i,function lf(e,t,n,i){let r=e.length;if(r==t)e.push(n,i);else if(1===r)e.push(i,e[0]),e[0]=n;else{for(r--,e.push(e[r-1],e[r]);r>t;)e[r]=e[r-2],r--;e[t]=n,e[t+1]=i}}(e,i,t,n)),i}function Wh(e,t){const n=vl(e,t);if(n>=0)return e[1|n]}function vl(e,t){return function Op(e,t,n){let i=0,r=e.length>>n;for(;r!==i;){const a=i+(r-i>>1),h=e[a<<n];if(t===h)return a<<n;h>t?r=a:i=a+1}return~(r<<n)}(e,t,1)}const Is={},In=[],ea=new $e(""),Zh=new $e("",-1),Ql=new $e("");class Kh{get(t,n=ka){if(n===ka){const r=Qc("",-201);throw r.name="\u0275NotFound",r}return n}}function Eo(e){return e[$h]||null}function Rn(e){return e[cs]||null}function Kr(e){return e[Xs]||null}function Lo(e){return e[Gh]||null}function eh(e){return{\u0275providers:e}}function Oa(...e){return{\u0275providers:yn(0,e),\u0275fromNgModule:!0}}function yn(e,...t){const n=[],i=new Set;let r;const a=h=>{n.push(h)};return eu(t,h=>{const d=h;iu(d,a,[],i)&&(r||=[],r.push(d))}),void 0!==r&&Qh(r,a),n}function Qh(e,t){for(let n=0;n<e.length;n++){const{ngModule:i,providers:r}=e[n];th(r,a=>{t(a,i)})}}function iu(e,t,n,i){if(!(e=Vt(e)))return!1;let r=null,a=Ys(e);const h=!a&&Rn(e);if(a||h){if(h&&!h.standalone)return!1;r=e}else{const _=e.ngModule;if(a=Ys(_),!a)return!1;r=_}const d=i.has(r);if(h){if(d)return!1;if(i.add(r),h.dependencies){const _="function"==typeof h.dependencies?h.dependencies():h.dependencies;for(const S of _)iu(S,t,n,i)}}else{if(!a)return!1;{if(null!=a.imports&&!d){let S;i.add(r);try{eu(a.imports,D=>{iu(D,t,n,i)&&(S||=[],S.push(D))})}finally{}void 0!==S&&Qh(S,t)}if(!d){const S=Ts(r)||(()=>new r);t({provide:r,useFactory:S,deps:In},r),t({provide:Ql,useValue:r,multi:!0},r),t({provide:ea,useValue:()=>Ft(r),multi:!0},r)}const _=a.providers;if(null!=_&&!d){const S=e;th(_,D=>{t(D,S)})}}}return r!==e&&void 0!==e.providers}function th(e,t){for(let n of e)uo(n)&&(n=n.\u0275providers),Array.isArray(n)?th(n,t):t(n)}const Jl=on({provide:String,useValue:on});function nh(e){return null!==e&&"object"==typeof e&&Jl in e}function Fa(e){return"function"==typeof e}const Jh=new $e(""),ed={},cf={};let ru;function ec(){return void 0===ru&&(ru=new Kh),ru}class sr{}class La extends sr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,n,i,r){super(),this.parent=n,this.source=i,this.scopes=r,au(t,h=>this.processProvider(h)),this.records.set(Zh,tc(void 0,this)),r.has("environment")&&this.records.set(sr,tc(void 0,this));const a=this.records.get(Jh);null!=a&&"string"==typeof a.value&&this.scopes.add(a.value),this.injectorDefTypes=new Set(this.get(Ql,In,{self:!0}))}retrieve(t,n){const i=ml(n)||0;try{return this.get(t,ka,i)}catch(r){if(Fr(r))return r;throw r}}destroy(){su(this),this._destroyed=!0;const t=Mt(null);try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of n)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Mt(t)}}onDestroy(t){return su(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){su(this);const n=H(this),i=Gn(void 0);try{return t()}finally{H(n),Gn(i)}}get(t,n=ka,i){if(su(this),t.hasOwnProperty(Yu))return t[Yu](this);const r=ml(i),h=H(this),d=Gn(void 0);try{if(!(4&r)){let S=this.records.get(t);if(void 0===S){const D=function td(e){return"function"==typeof e||"object"==typeof e&&"InjectionToken"===e.ngMetadataName}(t)&&Ms(t);S=D&&this.injectableDefInScope(D)?tc(Ba(t),ed):null,this.records.set(t,S)}if(null!=S)return this.hydrate(t,S,r)}return(2&r?ec():this.parent).get(t,n=8&r&&n===ka?null:n)}catch(_){const S=function Js(e){return e[pl]}(_);throw-200===S||-201===S?new Te(S,null):_}finally{Gn(d),H(h)}}resolveInjectorInitializers(){const t=Mt(null),n=H(this),i=Gn(void 0);try{const a=this.get(ea,In,{self:!0});for(const h of a)h()}finally{H(n),Gn(i),Mt(t)}}toString(){const t=[],n=this.records;for(const i of n.keys())t.push(Sn(i));return`R3Injector[${t.join(", ")}]`}processProvider(t){let n=Fa(t=Vt(t))?t:Vt(t&&t.provide);const i=function ou(e){return nh(e)?tc(void 0,e.useValue):tc(Bo(e),ed)}(t);if(!Fa(t)&&!0===t.multi){let r=this.records.get(n);r||(r=tc(void 0,ed,!0),r.factory=()=>af(r.multi),this.records.set(n,r)),n=t,r.multi.push(t)}this.records.set(n,i)}hydrate(t,n,i){const r=Mt(null);try{if(n.value===cf)throw mi(Sn(t));return n.value===ed&&(n.value=cf,n.value=n.factory(void 0,i)),"object"==typeof n.value&&n.value&&function nc(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{Mt(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Vt(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function Ba(e){const t=Ms(e),n=null!==t?t.factory:Ts(e);if(null!==n)return n;if(e instanceof $e)throw new Te(204,!1);if(e instanceof Function)return function ih(e){if(e.length>0)throw new Te(204,!1);const n=function nn(e){return(e?.[Yl]??null)||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Te(204,!1)}function Bo(e,t,n){let i;if(Fa(e)){const r=Vt(e);return Ts(r)||Ba(r)}if(nh(e))i=()=>Vt(e.useValue);else if(function Lp(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...af(e.deps||[]));else if(function Fp(e){return!(!e||!e.useExisting)}(e))i=(r,a)=>Ft(Vt(e.useExisting),void 0!==a&&8&a?8:void 0);else{const r=Vt(e&&(e.useClass||e.provide));if(!function uf(e){return!!e.deps}(e))return Ts(r)||Ba(r);i=()=>new r(...af(e.deps))}return i}function su(e){if(e.destroyed)throw new Te(205,!1)}function tc(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function au(e,t){for(const n of e)Array.isArray(n)?au(n,t):n&&uo(n)?au(n.\u0275providers,t):t(n)}function Yr(e,t){let n;e instanceof La?(su(e),n=e):n=new Nm(e);const r=H(n),a=Gn(void 0);try{return t()}finally{H(r),Gn(a)}}function Di(e){return Array.isArray(e)&&"object"==typeof e[1]}function Lr(e){return Array.isArray(e)&&!0===e[1]}function yi(e){return!!(4&e.flags)}function Ar(e){return e.componentOffset>-1}function Br(e){return!(1&~e.flags)}function Xr(e){return!!e.template}function fs(e){return!!(512&e[2])}function ps(e){return!(256&~e[2])}function Ci(e){for(;Array.isArray(e);)e=e[0];return e}function aa(e,t){return Ci(t[e])}function ar(e,t){return Ci(t[e.index])}function la(e,t){return e.data[t]}function Ze(e,t){const n=t[e];return Di(n)?n:n[0]}function gu(e){return!(128&~e[2])}function Wi(e,t){return null==t?null:e[t]}function Sl(e){e[17]=0}function lh(e){1024&e[2]||(e[2]|=1024,gu(e)&&$a(e))}function ac(e){return!!(9216&e[2]||e[24]?.dirty)}function ff(e){e[10].changeDetectionScheduler?.notify(8),64&e[2]&&(e[2]|=1024),ac(e)&&$a(e)}function $a(e){e[10].changeDetectionScheduler?.notify(0);let t=Rs(e);for(;null!==t&&!(8192&t[2])&&(t[2]|=8192,gu(t));)t=Rs(t)}function id(e,t){if(ps(e))throw new Te(911,!1);null===e[21]&&(e[21]=[]),e[21].push(t)}function Rs(e){const t=e[3];return Lr(t)?t[3]:t}function od(e){return e[7]??=[]}function pf(e){return e.cleanup??=[]}const Lt={lFrame:R(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let Uo=!1;function ld(){return Lt.bindingsEnabled}function Se(){return Lt.lFrame.lView}function zt(){return Lt.lFrame.tView}function Zi(e){return Lt.lFrame.contextLView=e,e[8]}function zr(e){return Lt.lFrame.contextLView=null,e}function St(){let e=mf();for(;null!==e&&64===e.type;)e=e.parent;return e}function mf(){return Lt.lFrame.currentTNode}function qa(e,t){const n=Lt.lFrame;n.currentTNode=e,n.isParent=t}function _u(){return Lt.lFrame.isParent}function dd(){return Uo}function Wa(e){const t=Uo;return Uo=e,t}function lr(){return Lt.lFrame.bindingIndex++}function vf(e,t){const n=Lt.lFrame;n.bindingIndex=n.bindingRootIndex=e,o(t)}function o(e){Lt.lFrame.currentDirectiveIndex=e}function p(){return Lt.lFrame.currentQueryIndex}function m(e){Lt.lFrame.currentQueryIndex=e}function b(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[5]:null}function E(e,t,n){if(4&n){let r=t,a=e;for(;!(r=r.parent,null!==r||1&n||(r=b(a),null===r||(a=a[14],10&r.type))););if(null===r)return!1;t=r,e=a}const i=Lt.lFrame=I();return i.currentTNode=t,i.lView=e,!0}function T(e){const t=I(),n=e[1];Lt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function I(){const e=Lt.lFrame,t=null===e?null:e.child;return null===t?R(e):t}function R(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function O(){const e=Lt.lFrame;return Lt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const z=O;function B(){const e=O();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function q(){return Lt.lFrame.selectedIndex}function ee(e){Lt.lFrame.selectedIndex=e}function Q(){const e=Lt.lFrame;return la(e.tView,e.selectedIndex)}let de=!0;function se(){return de}function ve(e){de=e}let Ie={elements:void 0};function Ae(e,t=null,n=null,i){const r=He(e,t,n,i);return r.resolveInjectorInitializers(),r}function He(e,t=null,n=null,i,r=new Set){const a=[n||In,Oa(e)];return i=i||("object"==typeof e?void 0:Sn(e)),new La(a,t||ec(),i||null,r)}class Be{static THROW_IF_NOT_FOUND=ka;static NULL=new Kh;static create(t,n){if(Array.isArray(t))return Ae({name:""},n,t,"");{const i=t.name??"";return Ae({name:i},t.parent,t.providers,i)}}static \u0275prov=Xe({token:Be,providedIn:"any",factory:()=>Ft(Zh)});static __NG_ELEMENT_ID__=-1}const ke=new $e("");let rt=(()=>class e{static __NG_ELEMENT_ID__=Tn;static __NG_ENV_ID__=n=>n})();class $t extends rt{_lView;constructor(t){super(),this._lView=t}get destroyed(){return ps(this._lView)}onDestroy(t){const n=this._lView;return id(n,t),()=>function rd(e,t){if(null===e[21])return;const n=e[21].indexOf(t);-1!==n&&e[21].splice(n,1)}(n,t)}}function Tn(){return new $t(Se())}class Mn{_console=console;handleError(t){this._console.error("ERROR",t)}}const ln=new $e("",{providedIn:"root",factory:()=>{const e=me(sr);let t;return n=>{e.destroyed&&!t?setTimeout(()=>{throw n}):(t??=e.get(Mn),t.handleError(n))}}}),hi={provide:ea,useValue:()=>{me(Mn)},multi:!0},Ii=new $e("",{providedIn:"root",factory:()=>{const e=me(ke).defaultView;if(!e)return;const t=me(ln),n=a=>{t(a.reason),a.preventDefault()},i=a=>{t(a.error?a.error:new Error(a.message,{cause:a})),a.preventDefault()},r=()=>{e.addEventListener("unhandledrejection",n),e.addEventListener("error",i)};typeof Zone<"u"?Zone.root.run(r):r(),me(rt).onDestroy(()=>{e.removeEventListener("error",i),e.removeEventListener("unhandledrejection",n)})}});function Xn(e,t){const[n,i,r]=Li(e,t?.equal),a=n;return a.set=i,a.update=r,a.asReadonly=cr.bind(a),a}function cr(){const e=this[zn];if(void 0===e.readonlyFn){const t=()=>this();t[zn]=e,e.readonlyFn=t}return e.readonlyFn}class Pr{}const ca=new $e("",{providedIn:"root",factory:()=>!1}),hc=new $e(""),El=new $e("");let Za=(()=>class e{view;node;constructor(n,i){this.view=n,this.node=i}static __NG_ELEMENT_ID__=Mo})();function Mo(){return new Za(Se(),St())}let Rr=(()=>{class e{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Pt(!1);get hasPendingTasks(){return!this.destroyed&&this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new qt(n=>{n.next(!1),n.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}has(n){return this.pendingTasks.has(n)}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Xe({token:e,providedIn:"root",factory:()=>new e})}return e})();function ms(...e){}let Yi=(()=>{class e{static \u0275prov=Xe({token:e,providedIn:"root",factory:()=>new _r})}return e})();class _r{dirtyEffectCount=0;queues=new Map;add(t){this.enqueue(t),this.schedule(t)}schedule(t){t.dirty&&this.dirtyEffectCount++}remove(t){const i=this.queues.get(t.zone);i.has(t)&&(i.delete(t),t.dirty&&this.dirtyEffectCount--)}enqueue(t){const n=t.zone;this.queues.has(n)||this.queues.set(n,new Set);const i=this.queues.get(n);i.has(t)||i.add(t)}flush(){for(;this.dirtyEffectCount>0;){let t=!1;for(const[n,i]of this.queues)t||=null===n?this.flushQueue(i):n.run(()=>this.flushQueue(i));t||(this.dirtyEffectCount=0)}}flushQueue(t){let n=!1;for(const i of t)i.dirty&&(this.dirtyEffectCount--,n=!0,i.run());return n}}let $o=null;function Qn(){return $o}class vu{}let ua=(()=>{class e{historyGo(n){throw new Error("")}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>me(Ml),providedIn:"platform"})}return e})(),Ml=(()=>{class e extends ua{_location;_history;_doc=me(ke);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Qn().getBaseHref(this._doc)}onPopState(n){const i=Qn().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=Qn().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,i,r){this._history.pushState(n,i,r)}replaceState(n,i,r){this._history.replaceState(n,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function bf(e,t){return e?t?e.endsWith("/")?t.startsWith("/")?e+t.slice(1):e+t:t.startsWith("/")?e+t:`${e}/${t}`:e:t}function Do(e){const t=e.search(/#|\?|$/);return"/"===e[t-1]?e.slice(0,t-1)+e.slice(t):e}function Dl(e){return e&&"?"!==e[0]?`?${e}`:e}let bu=(()=>{class e{historyGo(n){throw new Error("")}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>me(pd),providedIn:"root"})}return e})();const fd=new $e("");let pd=(()=>{class e extends bu{_platformLocation;_baseHref;_removeListenerFns=[];constructor(n,i){super(),this._platformLocation=n,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??me(ke).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return bf(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Dl(this._platformLocation.search),r=this._platformLocation.hash;return r&&n?`${i}${r}`:i}pushState(n,i,r,a){const h=this.prepareExternalUrl(r+Dl(a));this._platformLocation.pushState(n,i,h)}replaceState(n,i,r,a){const h=this.prepareExternalUrl(r+Dl(a));this._platformLocation.replaceState(n,i,h)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static \u0275fac=function(i){return new(i||e)(Ft(ua),Ft(fd,8))};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_s=(()=>{class e{_subject=new Cn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(n){this._locationStrategy=n;const i=this._locationStrategy.getBaseHref();this._basePath=function Wm(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(Do(z0(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Dl(i))}normalize(n){return e.stripTrailingSlash(function B0(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,z0(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",r=null){this._locationStrategy.pushState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Dl(i)),r)}replaceState(n,i="",r=null){this._locationStrategy.replaceState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Dl(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{const i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(r=>r(n,i))}subscribe(n,i,r){return this._subject.subscribe({next:n,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=Dl;static joinWithSlash=bf;static stripTrailingSlash=Do;static \u0275fac=function(i){return new(i||e)(Ft(bu))};static \u0275prov=Xe({token:e,factory:()=>function Ka(){return new _s(Ft(bu))}(),providedIn:"root"})}return e})();function z0(e){return e.replace(/\/index.html$/,"")}function Zm(e,t,n,i,r,a,h){try{var d=e[a](h),_=d.value}catch(S){return void n(S)}d.done?t(_):Promise.resolve(_).then(i,r)}function wu(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var a=e.apply(t,n);function h(_){Zm(a,i,r,h,d,"next",_)}function d(_){Zm(a,i,r,h,d,"throw",_)}h(void 0)})}}function Gp(e){return cn(e?.lift)}function Nr(e){return t=>{if(Gp(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function di(e,t,n,i,r){return new V0(e,t,n,i,r)}class V0 extends Fe{constructor(t,n,i,r,a,h){super(t),this.onFinalize=a,this.shouldUnsubscribe=h,this._next=n?function(d){try{n(d)}catch(_){t.error(_)}}:super._next,this._error=r?function(d){try{r(d)}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(d){t.error(d)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function wn(e,t){return Nr((n,i)=>{let r=0;n.subscribe(di(i,a=>{i.next(e.call(t,a,r++))}))})}function ys(e){return{toString:e}.toString()}const Cl="__parameters__";function fh(e,t,n){return ys(()=>{const i=function $p(e){return function(...n){if(e){const i=e(...n);for(const r in i)this[r]=i[r]}}}(t);function r(...a){if(this instanceof r)return i.apply(this,a),this;const h=new r(...a);return d.annotation=h,d;function d(_,S,D){const A=_.hasOwnProperty(Cl)?_[Cl]:Object.defineProperty(_,Cl,{value:[]})[Cl];for(;A.length<=D;)A.push(null);return(A[D]=A[D]||[]).push(h),_}}return r.prototype.ngMetadataName=e,r.annotationCls=r,r})}const Hp=_l(fh("Optional"),8),qp=_l(fh("SkipSelf"),4);class Qw{previousValue;currentValue;firstChange;constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function Wp(e,t,n,i){null!==t?t.applyValueToInputSignal(t,i):e[n]=i}const fo=(()=>{const e=()=>Jm;return e.ngInherit=!0,e})();function Jm(e){return e.type.prototype.ngOnChanges&&(e.setInput=ex),Jw}function Jw(){const e=Zp(this),t=e?.current;if(t){const n=e.previous;if(n===Is)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function ex(e,t,n,i,r){const a=this.declaredInputs[i],h=Zp(e)||function e_(e,t){return e[H0]=t}(e,{previous:Is,current:null}),d=h.current||(h.current={}),_=h.previous,S=_[a];d[a]=new Qw(S&&S.currentValue,n,_===Is),Wp(e,t,r,n)}const H0="__ngSimpleChanges__";function Zp(e){return e[H0]||null}const xu=[],qn=function(e,t=null,n){for(let i=0;i<xu.length;i++)(0,xu[i])(e,t,n)};function q0(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const a=e.data[n].type.prototype,{ngAfterContentInit:h,ngAfterContentChecked:d,ngAfterViewInit:_,ngAfterViewChecked:S,ngOnDestroy:D}=a;h&&(e.contentHooks??=[]).push(-n,h),d&&((e.contentHooks??=[]).push(n,d),(e.contentCheckHooks??=[]).push(n,d)),_&&(e.viewHooks??=[]).push(-n,_),S&&((e.viewHooks??=[]).push(n,S),(e.viewCheckHooks??=[]).push(n,S)),null!=D&&(e.destroyHooks??=[]).push(n,D)}}function Kp(e,t,n){Xp(e,t,3,n)}function Yp(e,t,n,i){(3&e[2])===n&&Xp(e,t,n,i)}function t_(e,t){let n=e[2];(3&n)===t&&(n&=16383,n+=1,e[2]=n)}function Xp(e,t,n,i){const a=i??-1,h=t.length-1;let d=0;for(let _=void 0!==i?65535&e[17]:0;_<h;_++)if("number"==typeof t[_+1]){if(d=t[_],null!=i&&d>=i)break}else t[_]<0&&(e[17]+=65536),(d<a||-1==a)&&(Z0(e,n,t,_),e[17]=(4294901760&e[17])+_+2),_++}function W0(e,t){qn(4,e,t);const n=Mt(null);try{t.call(e)}finally{Mt(n),qn(5,e,t)}}function Z0(e,t,n,i){const r=n[i]<0,a=n[i+1],d=e[r?-n[i]:n[i]];r?e[2]>>14<e[17]>>16&&(3&e[2])===t&&(e[2]+=16384,W0(d,a)):W0(d,a)}class Ef{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,n,i,r){this.factory=t,this.name=r,this.canSeeViewProviders=n,this.injectImpl=i}}function md(e){return 3===e||4===e||6===e}function tg(e){return 64===e.charCodeAt(0)}function Ya(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?n=r:0===n||Mf(e,n,r,0,-1===n||2===n?t[++i]:null)}}return e}function Mf(e,t,n,i,r){let a=0,h=e.length;if(-1===t)h=-1;else for(;a<e.length;){const d=e[a++];if("number"==typeof d){if(d===t){h=-1;break}if(d>t){h=a-1;break}}}for(;a<e.length;){const d=e[a];if("number"==typeof d)break;if(d===n)return void(null!==r&&(e[a+1]=r));a++,null!==r&&a++}-1!==h&&(e.splice(h,0,t),a=h+1),e.splice(a++,0,n),null!==r&&e.splice(a++,0,r)}function Su(e){return-1!==e}function pc(e){return 32767&e}function _d(e,t){let n=function ox(e){return e>>16}(e),i=t;for(;n>0;)i=i[14],n--;return i}let gc=!0;function ng(e){const t=gc;return gc=e,t}let Y0=0;const Xa={};function rg(e,t){const n=X0(e,t);if(-1!==n)return n;const i=t[1];i.firstCreatePass&&(e.injectorIndex=t.length,n_(i.data,e),n_(t,null),n_(i.blueprint,null));const r=og(e,t),a=e.injectorIndex;if(Su(r)){const h=pc(r),d=_d(r,t),_=d[1].data;for(let S=0;S<8;S++)t[a+S]=d[h+S]|_[h+S]}return t[a+8]=r,a}function n_(e,t){e.push(0,0,0,0,0,0,0,0,t)}function X0(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function og(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,r=t;for(;null!==r;){if(i=tv(r),null===i)return-1;if(n++,r=r[14],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function Eu(e,t,n){!function ax(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(Na)&&(i=n[Na]),null==i&&(i=n[Na]=Y0++);const r=255&i;t.data[e+(r>>5)]|=1<<r}(e,t,n)}function Q0(e,t,n){if(8&n||void 0!==e)return e;tf()}function i_(e,t,n,i){if(8&n&&void 0===i&&(i=null),!(3&n)){const r=e[9],a=Gn(void 0);try{return r?r.get(t,i,8&n):nf(t,i,8&n)}finally{Gn(a)}}return Q0(i,0,n)}function J0(e,t,n,i=0,r){if(null!==e){if(2048&t[2]&&!(2&i)){const h=function hx(e,t,n,i,r){let a=e,h=t;for(;null!==a&&null!==h&&2048&h[2]&&!fs(h);){const d=r_(a,h,n,2|i,Xa);if(d!==Xa)return d;let _=a.parent;if(!_){const S=h[20];if(S){const D=S.get(n,Xa,i);if(D!==Xa)return D}_=tv(h),h=h[14]}a=_}return r}(e,t,n,i,Xa);if(h!==Xa)return h}const a=r_(e,t,n,i,Xa);if(a!==Xa)return a}return i_(t,n,i,r)}function r_(e,t,n,i,r){const a=function ux(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Na)?e[Na]:void 0;return"number"==typeof t?t>=0?255&t:Df:t}(n);if("function"==typeof a){if(!E(t,e,i))return 1&i?Q0(r,0,i):i_(t,n,i,r);try{let h;if(h=a(i),null!=h||8&i)return h;tf()}finally{z()}}else if("number"==typeof a){let h=null,d=X0(e,t),_=-1,S=1&i?t[15][5]:null;for((-1===d||4&i)&&(_=-1===d?og(e,t):t[d+8],-1!==_&&o_(i,!1)?(h=t[1],d=pc(_),t=_d(_,t)):d=-1);-1!==d;){const D=t[1];if(ev(a,d,D.data)){const A=cx(d,t,n,h,i,S);if(A!==Xa)return A}_=t[d+8],-1!==_&&o_(i,t[1].data[d+8]===S)&&ev(a,d,t)?(h=D,d=pc(_),t=_d(_,t)):d=-1}}return r}function cx(e,t,n,i,r,a){const h=t[1],d=h.data[e+8],D=vd(d,h,n,null==i?Ar(d)&&gc:i!=h&&!!(3&d.type),1&r&&a===d);return null!==D?mh(t,h,D,d,r):Xa}function vd(e,t,n,i,r){const a=e.providerIndexes,h=t.data,d=1048575&a,_=e.directiveStart,D=a>>20,F=r?d+D:e.directiveEnd;for(let k=i?d:d+D;k<F;k++){const G=h[k];if(k<_&&n===G||k>=_&&G.type===n)return k}if(r){const k=h[_];if(k&&Xr(k)&&k.type===n)return _}return null}function mh(e,t,n,i,r){let a=e[n];const h=t.data;if(a instanceof Ef){const d=a;if(d.resolving)throw function dn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Bt(e)}(h[n]),mi();const _=ng(d.canSeeViewProviders);d.resolving=!0;const A=d.injectImpl?Gn(d.injectImpl):null;E(e,i,0);try{a=e[n]=d.factory(void 0,r,h,e,i),t.firstCreatePass&&n>=i.directiveStart&&function nx(e,t,n){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:a}=t.type.prototype;if(i){const h=Jm(t);(n.preOrderHooks??=[]).push(e,h),(n.preOrderCheckHooks??=[]).push(e,h)}r&&(n.preOrderHooks??=[]).push(0-e,r),a&&((n.preOrderHooks??=[]).push(e,a),(n.preOrderCheckHooks??=[]).push(e,a))}(n,h[n],t)}finally{null!==A&&Gn(A),ng(_),d.resolving=!1,z()}}return a}function ev(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function o_(e,t){return!(2&e||1&e&&t)}class ur{_tNode;_lView;constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return J0(this._tNode,this._lView,t,ml(i),n)}}function Df(){return new ur(St(),Se())}function fi(e){return ys(()=>{const t=e.prototype.constructor,n=t[us]||s_(t),i=Object.prototype;let r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==i;){const a=r[us]||s_(r);if(a&&a!==n)return a;r=Object.getPrototypeOf(r)}return a=>new a})}function s_(e){return qc(e)?()=>{const t=s_(Vt(e));return t&&t()}:Ts(e)}function tv(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[5]:null}function _x(){return bd(St(),Se())}function bd(e,t){return new Nn(ar(e,t))}let Nn=(()=>class e{nativeElement;constructor(n){this.nativeElement=n}static __NG_ELEMENT_ID__=_x})();function yr(e){return e instanceof Nn?e.nativeElement:e}function c_(){return this._results[Symbol.iterator]()}class sv{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Cn}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){this.dirty=!1;const i=function ho(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function km(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],a=t[i];if(n&&(r=n(r),a=n(a)),a!==r)return!1}return!0}(this._results,i,n))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=c_}function If(e){return!(128&~e.flags)}var lg=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(lg||{});const cg=new Map;let yx=0;function d_(e){cg.delete(e[19])}const Il="__ngContext__";function to(e,t){Di(t)?(e[Il]=t[19],function bx(e){cg.set(e[19],e)}(t)):e[Il]=t}function y_(e){return gv(e[12])}function pv(e){return gv(e[4])}function gv(e){for(;null!==e&&!Lr(e);)e=e[4];return e}let Nf;const xd=new $e("",{providedIn:"root",factory:()=>Tx}),Tx="ng",wv=new $e(""),fg=new $e("",{providedIn:"platform",factory:()=>"unknown"}),xv=new $e(""),Sv=new $e("",{providedIn:"root",factory:()=>function Qa(){if(void 0!==Nf)return Nf;if(typeof document<"u")return document;throw new Te(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),Iu=new $e("",{providedIn:"root",factory:()=>!1});function Au(e){return!(32&~e.flags)}function wr(e,t){const n=e.contentQueries;if(null!==n){const i=Mt(null);try{for(let r=0;r<n.length;r+=2){const h=n[r+1];if(-1!==h){const d=e.data[h];m(n[r]),d.contentQueries(2,t[h],h)}}}finally{Mt(i)}}}function mo(e,t,n){m(0);const i=Mt(null);try{t(e,n)}finally{Mt(i)}}function Xi(e,t,n){if(yi(t)){const i=Mt(null);try{const a=t.directiveEnd;for(let h=t.directiveStart;h<a;h++){const d=e.data[h];d.contentQueries&&d.contentQueries(1,n[h],h)}}finally{Mt(i)}}}var ei=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(ei||{});class Ch{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss)`}}function ku(e){return e instanceof Function?e():e}function V4(e,t,n){let i=e.length;for(;;){const r=e.indexOf(t,n);if(-1===r)return r;if(0===r||e.charCodeAt(r-1)<=32){const a=t.length;if(r+a===i||e.charCodeAt(r+a)<=32)return r}n=r+1}}const CT="ng-template";function U4(e,t,n,i){let r=0;if(i){for(;r<t.length&&"string"==typeof t[r];r+=2)if("class"===t[r]&&-1!==V4(t[r+1].toLowerCase(),n,0))return!0}else if(Zx(e))return!1;if(r=t.indexOf(1,r),r>-1){let a;for(;++r<t.length&&"string"==typeof(a=t[r]);)if(a.toLowerCase()===n)return!0}return!1}function Zx(e){return 4===e.type&&e.value!==CT}function G4(e,t,n){return t===(4!==e.type||n?e.value:CT)}function $4(e,t,n){let i=4;const r=e.attrs,a=null!==r?function W4(e){for(let t=0;t<e.length;t++)if(md(e[t]))return t;return e.length}(r):0;let h=!1;for(let d=0;d<t.length;d++){const _=t[d];if("number"!=typeof _){if(!h)if(4&i){if(i=2|1&i,""!==_&&!G4(e,_,n)||""===_&&1===t.length){if(Sc(i))return!1;h=!0}}else if(8&i){if(null===r||!U4(e,r,_,n)){if(Sc(i))return!1;h=!0}}else{const S=t[++d],D=H4(_,r,Zx(e),n);if(-1===D){if(Sc(i))return!1;h=!0;continue}if(""!==S){let A;if(A=D>a?"":r[D+1].toLowerCase(),2&i&&S!==A){if(Sc(i))return!1;h=!0}}}}else{if(!h&&!Sc(i)&&!Sc(_))return!1;if(h&&Sc(_))continue;h=!1,i=_|1&i}}return Sc(i)||h}function Sc(e){return!(1&e)}function H4(e,t,n,i){if(null===t)return-1;let r=0;if(i||!n){let a=!1;for(;r<t.length;){const h=t[r];if(h===e)return r;if(3===h||6===h)a=!0;else{if(1===h||2===h){let d=t[++r];for(;"string"==typeof d;)d=t[++r];continue}if(4===h)break;if(0===h){r+=4;continue}}r+=a?1:2}return-1}return function Z4(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function TT(e,t,n=!1){for(let i=0;i<t.length;i++)if($4(e,t[i],n))return!0;return!1}function IT(e,t){return e?":not("+t.trim()+")":t}function Y4(e){let t=e[0],n=1,i=2,r="",a=!1;for(;n<e.length;){let h=e[n];if("string"==typeof h)if(2&i){const d=e[++n];r+="["+h+(d.length>0?'="'+d+'"':"")+"]"}else 8&i?r+="."+h:4&i&&(r+=" "+h);else""!==r&&!Sc(h)&&(t+=IT(a,r),r=""),i=h,a=a||!Sc(i);n++}return""!==r&&(t+=IT(a,r)),t}const pi={};function Uv(e,t,n){return e.createElement(t,n)}function Lf(e,t,n,i,r){e.insertBefore(t,n,i,r)}function PT(e,t,n){e.appendChild(t,n)}function RT(e,t,n,i,r){null!==i?Lf(e,t,n,i,r):PT(e,t,n)}function kT(e,t,n){const{mergedAttrs:i,classes:r,styles:a}=n;null!==i&&function K0(e,t,n){let i=0;for(;i<n.length;){const r=n[i];if("number"==typeof r){if(0!==r)break;i++;const a=n[i++],h=n[i++],d=n[i++];e.setAttribute(t,h,d,a)}else{const a=r,h=n[++i];tg(a)?e.setProperty(t,a,h):e.setAttribute(t,a,h),i++}}}(e,t,i),null!==r&&function eB(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}(e,t,r),null!==a&&function J4(e,t,n){e.setAttribute(t,"style",n)}(e,t,a)}function Xx(e,t,n,i,r,a,h,d,_,S,D){const A=26+i,F=A+r,k=function tB(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:pi);return n}(A,F),G="function"==typeof S?S():S;return k[1]={type:e,blueprint:k,template:n,queries:null,viewQuery:d,declTNode:t,data:k.slice().fill(null,A),bindingStartIndex:A,expandoStartIndex:F,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof h?h():h,firstChild:null,schemas:_,consts:G,incompleteFirstPass:!1,ssrId:D}}function Gv(e,t,n,i,r,a,h,d,_,S,D){const A=t.blueprint.slice();return A[0]=r,A[2]=1228|i,(null!==S||e&&2048&e[2])&&(A[2]|=2048),Sl(A),A[3]=A[14]=e,A[8]=n,A[10]=h||e&&e[10],A[11]=d||e&&e[11],A[9]=_||e&&e[9]||null,A[5]=a,A[19]=function vx(){return yx++}(),A[6]=D,A[20]=S,A[15]=2==t.type?e[15]:A,A}function Qx(e){let t=16;return e.signals?t=4096:e.onPush&&(t=64),t}function $_(e,t,n,i){if(0===n)return-1;const r=t.length;for(let a=0;a<n;a++)t.push(i),e.blueprint.push(i),e.data.push(null);return r}function Jx(e,t){return e[12]?e[13][4]=t:e[12]=t,e[13]=t,t}function jt(e=1){FT(zt(),Se(),q()+e,!1)}function FT(e,t,n,i){if(!i)if(3&~t[2]){const a=e.preOrderHooks;null!==a&&Yp(t,a,0,n)}else{const a=e.preOrderCheckHooks;null!==a&&Kp(t,a,n)}ee(n)}var $v=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}($v||{});function H_(e,t,n,i){const r=Mt(null);try{const[a,h,d]=e.inputs[n];let _=null;0!==(h&$v.SignalBased)&&(_=t[a][zn]),null!==_&&void 0!==_.transformFn?i=_.transformFn(i):null!==d&&(i=d.call(t,i)),null!==e.setInput?e.setInput(t,_,i,n,a):Wp(t,_,a,i)}finally{Mt(r)}}var Id=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Id||{});function tS(e,t){return undefined(e,t)}function Dg(e,t,n,i,r){if(null!=i){let a,h=!1;Lr(i)?a=i:Di(i)&&(h=!0,i=i[0]);const d=Ci(i);0===e&&null!==n?null==r?PT(t,n,d):Lf(t,n,d,r||null,!0):1===e&&null!==n?Lf(t,n,d,r||null,!0):2===e?function G_(e,t,n){e.removeChild(null,t,n)}(t,d,h):3===e&&t.destroyNode(d),null!=a&&function cB(e,t,n,i,r){const a=n[7];a!==Ci(n)&&Dg(t,e,i,a,r);for(let d=10;d<n.length;d++){const _=n[d];Hv(_[1],_,e,t,i,a)}}(t,e,a,n,r)}}function BT(e,t){t[10].changeDetectionScheduler?.notify(9),Hv(e,t,t[11],2,null,null)}function nS(e,t){const n=e[9],i=n.indexOf(t);n.splice(i,1)}function q_(e,t){if(ps(t))return;const n=t[11];n.destroyNode&&Hv(e,t,n,3,null,null),function oB(e){let t=e[12];if(!t)return iS(e[1],e);for(;t;){let n=null;if(Di(t))n=t[12];else{const i=t[10];i&&(n=i)}if(!n){for(;t&&!t[4]&&t!==e;)Di(t)&&iS(t[1],t),t=t[3];null===t&&(t=e),Di(t)&&iS(t[1],t),n=t&&t[4]}t=n}}(t)}function iS(e,t){if(ps(t))return;const n=Mt(null);try{t[2]&=-129,t[2]|=256,t[24]&&xo(t[24]),function aB(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const r=t[n[i]];if(!(r instanceof Ef)){const a=n[i+1];if(Array.isArray(a))for(let h=0;h<a.length;h+=2){const d=r[a[h]],_=a[h+1];qn(4,d,_);try{_.call(d)}finally{qn(5,d,_)}}else{qn(4,r,a);try{a.call(r)}finally{qn(5,r,a)}}}}}(e,t),function sB(e,t){const n=e.cleanup,i=t[7];if(null!==n)for(let h=0;h<n.length-1;h+=2)if("string"==typeof n[h]){const d=n[h+3];d>=0?i[d]():i[-d].unsubscribe(),h+=2}else n[h].call(i[n[h+1]]);null!==i&&(t[7]=null);const r=t[21];if(null!==r){t[21]=null;for(let h=0;h<r.length;h++)(0,r[h])()}const a=t[23];if(null!==a){t[23]=null;for(const h of a)h.destroy()}}(e,t),1===t[1].type&&t[11].destroy();const i=t[16];if(null!==i&&Lr(t[3])){i!==t[3]&&nS(i,t);const r=t[18];null!==r&&r.detachView(e)}d_(t)}finally{Mt(n)}}function rS(e,t,n){return function zT(e,t,n){let i=t;for(;null!==i&&168&i.type;)i=(t=i).parent;if(null===i)return n[0];if(Ar(i)){const{encapsulation:r}=e.data[i.directiveStart+i.componentOffset];if(r===ei.None||r===ei.Emulated)return null}return ar(i,n)}(e,t.parent,n)}let UT=function VT(e,t,n){return 40&e.type?ar(e,n):null};function sS(e,t,n,i){const r=rS(e,i,t),a=t[11],d=function jT(e,t,n){return UT(e,t,n)}(i.parent||t[5],i,t);if(null!=r)if(Array.isArray(n))for(let _=0;_<n.length;_++)RT(a,r,n[_],d,!1);else RT(a,r,n,d,!1)}function Bf(e,t){if(null!==t){const n=t.type;if(3&n)return ar(t,e);if(4&n)return aS(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return Bf(e,i);{const r=e[t.index];return Lr(r)?aS(-1,r):Ci(r)}}if(128&n)return Bf(e,t.next);if(32&n)return tS(t,e)()||Ci(e[t.index]);{const i=$T(e,t);return null!==i?Array.isArray(i)?i[0]:Bf(Rs(e[15]),i):Bf(e,t.next)}}return null}function $T(e,t){return null!==t?e[15][5].projection[t.projection]:null}function aS(e,t){const n=10+e+1;if(n<t.length){const i=t[n],r=i[1].firstChild;if(null!==r)return Bf(i,r)}return t[7]}function lS(e,t,n,i,r,a,h){for(;null!=n;){if(128===n.type){n=n.next;continue}const d=i[n.index],_=n.type;if(h&&0===t&&(d&&to(Ci(d),i),n.flags|=2),!Au(n))if(8&_)lS(e,t,n.child,i,r,a,!1),Dg(t,e,r,d,a);else if(32&_){const S=tS(n,i);let D;for(;D=S();)Dg(t,e,r,D,a);Dg(t,e,r,d,a)}else 16&_?HT(e,t,i,n,r,a):Dg(t,e,r,d,a);n=h?n.projectionNext:n.next}}function Hv(e,t,n,i,r,a){lS(n,i,e.firstChild,t,r,a,!1)}function HT(e,t,n,i,r,a){const h=n[15],_=h[5].projection[i.projection];if(Array.isArray(_))for(let S=0;S<_.length;S++)Dg(t,e,r,_[S],a);else{let S=_;const D=h[3];If(i)&&(S.flags|=128),lS(e,t,S,D,r,a,!0)}}function qT(e,t,n,i,r){const a=q(),h=2&i;try{ee(-1),h&&t.length>26&&FT(e,t,26,!1),qn(h?2:0,r,n),n(i,r)}finally{ee(a),qn(h?3:1,r,n)}}function qv(e,t,n){(function gB(e,t,n){const i=n.directiveStart,r=n.directiveEnd;Ar(n)&&function nB(e,t,n){const i=ar(t,e),r=function OT(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Xx(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}(n),a=e[10].rendererFactory,h=Jx(e,Gv(e,r,null,Qx(n),i,t,null,a.createRenderer(i,n),null,null,null));e[t.index]=h}(t,n,e.data[i+n.componentOffset]),e.firstCreatePass||rg(n,t);const a=n.initialInputs;for(let h=i;h<r;h++){const d=e.data[h],_=mh(t,e,h,n);to(_,t),null!==a&&vB(0,h-i,_,d,0,a),Xr(d)&&(Ze(n.index,t)[8]=mh(t,e,h,n))}})(e,t,n),!(64&~n.flags)&&function mB(e,t,n){const i=n.directiveStart,r=n.directiveEnd,a=n.index,h=function v(){return Lt.lFrame.currentDirectiveIndex}();try{ee(a);for(let d=i;d<r;d++){const _=e.data[d],S=t[d];o(d),(null!==_.hostBindings||0!==_.hostVars||null!==_.hostAttrs)&&_B(_,S)}}finally{ee(-1),o(h)}}(e,t,n)}function Cg(e,t,n=ar){const i=t.localNames;if(null!==i){let r=t.index+1;for(let a=0;a<i.length;a+=2){const h=i[a+1],d=-1===h?n(t,e):e[h];e[r++]=d}}}let WT=()=>null;function cS(e,t,n,i,r,a){Yv(e,t[1],t,n,i)?Ar(e)&&function ZT(e,t){const n=Ze(t,e);16&n[2]||(n[2]|=64)}(t,e.index):(3&e.type&&(n=function pB(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n)),uS(e,t,n,i,r,a))}function uS(e,t,n,i,r,a){if(3&e.type){const h=ar(e,t);i=null!=a?a(i,e.value||"",n):i,r.setProperty(h,n,i)}}function _B(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function hS(e,t){const n=e.directiveRegistry;let i=null;if(n)for(let r=0;r<n.length;r++){const a=n[r];TT(t,a.selectors,!1)&&(i??=[],Xr(a)?i.unshift(a):i.push(a))}return i}function vB(e,t,n,i,r,a){const h=a[t];if(null!==h)for(let d=0;d<h.length;d+=2)H_(i,n,h[d],h[d+1])}function Kv(e){let t=e;return _u()?function Ln(){Lt.lFrame.isParent=!1}():(t=t.parent,qa(t,!1)),t}function Yv(e,t,n,i,r){const a=e.inputs?.[i],h=e.hostDirectiveInputs?.[i];let d=!1;if(h)for(let _=0;_<h.length;_+=2){const S=h[_];H_(t.data[S],n[S],h[_+1],r),d=!0}if(a)for(const _ of a)H_(t.data[_],n[_],i,r),d=!0;return d}function wB(e,t){const n=Ze(t,e),i=n[1];!function xB(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(i,n);const r=n[0];null!==r&&null===n[6]&&(n[6]=null),qn(18),Xv(i,n,n[8]),qn(19,n[8])}function Xv(e,t,n){T(t);try{const i=e.viewQuery;null!==i&&mo(1,i,n);const r=e.template;null!==r&&qT(e,t,r,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),t[18]?.finishViewCreation(e),e.staticContentQueries&&wr(e,t),e.staticViewQueries&&mo(2,e.viewQuery,n);const a=e.components;null!==a&&function SB(e,t){for(let n=0;n<t.length;n++)wB(e,t[n])}(t,a)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[2]&=-5,B()}}function zf(e,t){return!t||null===t.firstChild||If(e)}function W_(e,t,n,i,r=!1){for(;null!==n;){if(128===n.type){n=r?n.projectionNext:n.next;continue}const a=t[n.index];null!==a&&i.push(Ci(a)),Lr(a)&&MB(a,i);const h=n.type;if(8&h)W_(e,t,n.child,i);else if(32&h){const d=tS(n,t);let _;for(;_=d();)i.push(_)}else if(16&h){const d=$T(t,n);if(Array.isArray(d))i.push(...d);else{const _=Rs(t[15]);W_(_[1],_,d,i,!0)}}n=r?n.projectionNext:n.next}return i}function MB(e,t){for(let n=10;n<e.length;n++){const i=e[n],r=i[1].firstChild;null!==r&&W_(i[1],i,r,t)}e[7]!==e[0]&&t.push(e[7])}function QT(e){if(null!==e[25]){for(const t of e[25])t.impl.addSequence(t);e[25].length=0}}let JT=[];const IB={...yt,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:e=>{$a(e.lView)},consumerOnSignalRead(){this.lView[24]=this}},PB={...yt,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:e=>{let t=Rs(e.lView);for(;t&&!eI(t[1]);)t=Rs(t);t&&lh(t)},consumerOnSignalRead(){this.lView[24]=this}};function eI(e){return 2!==e.type}function tI(e){if(null===e[23])return;let t=!0;for(;t;){let n=!1;for(const i of e[23])i.dirty&&(n=!0,null===i.zone||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));t=n&&!!(8192&e[2])}}function Qv(e,t=0){const i=e[10].rendererFactory;i.begin?.();try{!function NB(e,t){const n=dd();try{Wa(!0),fS(e,t);let i=0;for(;ac(e);){if(100===i)throw new Te(103,!1);i++,fS(e,1)}}finally{Wa(n)}}(e,t)}finally{i.end?.()}}function nI(e,t,n,i){if(ps(t))return;const r=t[2];T(t);let d=!0,_=null,S=null;eI(e)?(S=function DB(e){return e[24]??function CB(e){const t=JT.pop()??Object.create(IB);return t.lView=e,t}(e)}(t),_=Fi(S)):null===function gi(){return wt}()?(d=!1,S=function AB(e){const t=e[24]??Object.create(PB);return t.lView=e,t}(t),_=Fi(S)):t[24]&&(xo(t[24]),t[24]=null);try{Sl(t),function uh(e){return Lt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&qT(e,t,n,2,i);const D=!(3&~r);if(D){const k=e.preOrderCheckHooks;null!==k&&Kp(t,k,null)}else{const k=e.preOrderHooks;null!==k&&Yp(t,k,0,null),t_(t,0)}if(function OB(e){for(let t=y_(e);null!==t;t=pv(t)){if(!(2&t[2]))continue;const n=t[9];for(let i=0;i<n.length;i++)lh(n[i])}}(t),tI(t),iI(t,0),null!==e.contentQueries&&wr(e,t),D){const k=e.contentCheckHooks;null!==k&&Kp(t,k)}else{const k=e.contentHooks;null!==k&&Yp(t,k,1),t_(t,1)}!function LB(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const r=n[i];if(r<0)ee(~r);else{const a=r,h=n[++i],d=n[++i];vf(h,a);const _=t[a];qn(24,_),d(2,_),qn(25,_)}}}finally{ee(-1)}}(e,t);const A=e.components;null!==A&&oI(t,A,0);const F=e.viewQuery;if(null!==F&&mo(2,F,i),D){const k=e.viewCheckHooks;null!==k&&Kp(t,k)}else{const k=e.viewHooks;null!==k&&Yp(t,k,2),t_(t,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[22]){for(const k of t[22])k();t[22]=null}QT(t),t[2]&=-73}catch(D){throw $a(t),D}finally{null!==S&&(rs(S,_),d&&function TB(e){e.lView[24]!==e&&(e.lView=null,JT.push(e))}(S)),B()}}function iI(e,t){for(let n=y_(e);null!==n;n=pv(n))for(let i=10;i<n.length;i++)rI(n[i],t)}function FB(e,t,n){qn(18);const i=Ze(t,e);rI(i,n),qn(19,i[8])}function rI(e,t){gu(e)&&fS(e,t)}function fS(e,t){const i=e[1],r=e[2],a=e[24];let h=!!(0===t&&16&r);if(h||=!!(64&r&&0===t),h||=!!(1024&r),h||=!(!a?.dirty||!wo(a)),h||=!1,a&&(a.dirty=!1),e[2]&=-9217,h)nI(i,e,i.template,e[8]);else if(8192&r){const d=Mt(null);try{tI(e),iI(e,1);const _=i.components;null!==_&&oI(e,_,1),QT(e)}finally{Mt(d)}}}function oI(e,t,n){for(let i=0;i<t.length;i++)FB(e,t[i],n)}function Ig(e,t){const n=dd()?64:1088;for(e[10].changeDetectionScheduler?.notify(t);e;){e[2]|=n;const i=Rs(e);if(fs(e)&&!i)return e;e=i}return null}function sI(e,t,n,i){return[e,!0,0,t,null,i,null,n,null,null]}function Z_(e,t){if(e.length<=10)return;const n=10+t,i=e[n];if(i){const r=i[16];null!==r&&r!==e&&nS(r,i),t>0&&(e[n-1][4]=i[4]);const a=Ju(e,10+t);!function LT(e,t){BT(e,t),t[0]=null,t[5]=null}(i[1],i);const h=a[18];null!==h&&h.detachView(a[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function lI(e,t){const n=e[9],i=t[3];(Di(i)||t[15]!==i[3][15])&&(e[2]|=2),null===n?e[9]=[t]:n.push(t)}class K_{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){const t=this._lView,n=t[1];return W_(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return ps(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Lr(t)){const n=t[8],i=n?n.indexOf(this):-1;i>-1&&(Z_(t,i),Ju(n,i))}this._attachedToViewContainer=!1}q_(this._lView[1],this._lView)}onDestroy(t){id(this._lView,t)}markForCheck(){Ig(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[2]&=-129}reattach(){ff(this._lView),this._lView[2]|=128}detectChanges(){this._lView[2]|=1024,Qv(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Te(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const t=fs(this._lView),n=this._lView[16];null!==n&&!t&&nS(n,this._lView),BT(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Te(902,!1);this._appRef=t;const n=fs(this._lView),i=this._lView[16];null!==i&&!n&&lI(i,this._lView),ff(this._lView)}}let ro=(()=>class e{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=zB;constructor(n,i,r){this._declarationLView=n,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,i){return this.createEmbeddedViewImpl(n,i)}createEmbeddedViewImpl(n,i,r){const a=function Tg(e,t,n,i){const r=Mt(null);try{const a=t.tView,_=Gv(e,a,n,4096&e[2]?4096:16,null,t,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null);_[16]=e[t.index];const D=e[18];return null!==D&&(_[18]=D.createEmbeddedView(a)),Xv(a,_,n),_}finally{Mt(r)}}(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:i,dehydratedView:r});return new K_(a)}})();function zB(){return Jv(St(),Se())}function Jv(e,t){return 4&e.type?new ro(t,e,bd(e,t)):null}function jf(e,t,n,i,r){let a=e.data[t];if(null===a)a=function yS(e,t,n,i,r){const a=mf(),h=_u(),_=e.data[t]=function ZB(e,t,n,i,r,a){let h=t?t.injectorIndex:-1,d=0;return function cd(){return null!==Lt.skipHydrationRootTNode}()&&(d|=128),{type:n,index:i,insertBeforeIndex:null,injectorIndex:h,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:d,providerIndexes:0,value:r,attrs:a,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,h?a:a&&a.parent,n,t,i,r);return function WB(e,t,n,i){null===e.firstChild&&(e.firstChild=t),null!==n&&(i?null==n.child&&null!==t.parent&&(n.child=t):null===n.next&&(n.next=t,t.prev=n))}(e,_,a,h),_}(e,t,n,i,r),function yf(){return Lt.lFrame.inI18n}()&&(a.flags|=32);else if(64&a.type){a.type=n,a.value=i,a.attrs=r;const h=function Qr(){const e=Lt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();a.injectorIndex=null===h?-1:h.injectorIndex}return qa(a,!0),a}let A5=class{},NI=class{};class P5{resolveComponentFactory(t){throw new Te(917,!1)}}let a1=class{static NULL=new P5};class l1{}let N5=(()=>{class e{static \u0275prov=Xe({token:e,providedIn:"root",factory:()=>null})}return e})();const DS={};class Rg{injector;parentInjector;constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,i){const r=this.injector.get(t,DS,i);return r!==DS||n===DS?r:this.parentInjector.get(t,n,i)}}function u1(e,t,n){let i=n?e.styles:null,r=n?e.classes:null,a=0;if(null!==t)for(let h=0;h<t.length;h++){const d=t[h];"number"==typeof d?a=d:1==a?r=Hc(r,d):2==a&&(i=Hc(i,d+": "+t[++h]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=r:e.classesWithoutHost=r}function et(e,t=0){const n=Se();return null===n?Ft(e,t):J0(St(),n,Vt(e),t)}function OI(e,t,n,i,r){const a=null===i?null:{"":-1},h=r(e,n);if(null!==h){let d=h,_=null,S=null;for(const D of h)if(null!==D.resolveHostDirectives){[d,_,S]=D.resolveHostDirectives(h);break}!function j5(e,t,n,i,r,a,h){const d=i.length;let _=!1;for(let F=0;F<d;F++){const k=i[F];!_&&Xr(k)&&(_=!0,z5(e,n,F)),Eu(rg(n,t),e,k.type)}!function q5(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,d);for(let F=0;F<d;F++){const k=i[F];k.providersResolver&&k.providersResolver(k)}let S=!1,D=!1,A=$_(e,t,d,null);d>0&&(n.directiveToIndex=new Map);for(let F=0;F<d;F++){const k=i[F];if(n.mergedAttrs=Ya(n.mergedAttrs,k.hostAttrs),U5(e,n,t,A,k),H5(A,k,r),null!==h&&h.has(k)){const[Y,ne]=h.get(k);n.directiveToIndex.set(k.type,[A,Y+n.directiveStart,ne+n.directiveStart])}else(null===a||!a.has(k))&&n.directiveToIndex.set(k.type,A);null!==k.contentQueries&&(n.flags|=4),(null!==k.hostBindings||null!==k.hostAttrs||0!==k.hostVars)&&(n.flags|=64);const G=k.type.prototype;!S&&(G.ngOnChanges||G.ngOnInit||G.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),S=!0),!D&&(G.ngOnChanges||G.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),D=!0),A++}!function V5(e,t,n){for(let i=t.directiveStart;i<t.directiveEnd;i++){const r=e.data[i];if(null!==n&&n.has(r)){const a=n.get(r);LI(0,t,a,i),LI(1,t,a,i),zI(t,i,!0)}else FI(0,t,r,i),FI(1,t,r,i),zI(t,i,!1)}}(e,n,a)}(e,t,n,d,a,_,S)}null!==a&&null!==i&&function B5(e,t,n){const i=e.localNames=[];for(let r=0;r<t.length;r+=2){const a=n[t[r+1]];if(null==a)throw new Te(-301,!1);i.push(t[r],a)}}(n,i,a)}function z5(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function FI(e,t,n,i){const r=0===e?n.inputs:n.outputs;for(const a in r)if(r.hasOwnProperty(a)){let h;h=0===e?t.inputs??={}:t.outputs??={},h[a]??=[],h[a].push(i),BI(t,a)}}function LI(e,t,n,i){const r=0===e?n.inputs:n.outputs;for(const a in r)if(r.hasOwnProperty(a)){const h=r[a];let d;d=0===e?t.hostDirectiveInputs??={}:t.hostDirectiveOutputs??={},d[h]??=[],d[h].push(i,a),BI(t,h)}}function BI(e,t){"class"===t?e.flags|=8:"style"===t&&(e.flags|=16)}function zI(e,t,n){const{attrs:i,inputs:r,hostDirectiveInputs:a}=e;if(null===i||!n&&null===r||n&&null===a||Zx(e))return e.initialInputs??=[],void e.initialInputs.push(null);let h=null,d=0;for(;d<i.length;){const _=i[d];if(0!==_)if(5!==_){if("number"==typeof _)break;if(!n&&r.hasOwnProperty(_)){const S=r[_];for(const D of S)if(D===t){h??=[],h.push(_,i[d+1]);break}}else if(n&&a.hasOwnProperty(_)){const S=a[_];for(let D=0;D<S.length;D+=2)if(S[D]===t){h??=[],h.push(S[D+1],i[d+1]);break}}d+=2}else d+=2;else d+=4}e.initialInputs??=[],e.initialInputs.push(h)}function U5(e,t,n,i,r){e.data[i]=r;const a=r.factory||(r.factory=Ts(r.type)),h=new Ef(a,Xr(r),et,null);e.blueprint[i]=h,n[i]=h,function G5(e,t,n,i,r){const a=r.hostBindings;if(a){let h=e.hostBindingOpCodes;null===h&&(h=e.hostBindingOpCodes=[]);const d=~t.index;(function $5(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(h)!=d&&h.push(d),h.push(n,i,a)}}(e,t,i,$_(e,n,r.hostVars,pi),r)}function H5(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;Xr(t)&&(n[""]=e)}}function CS(e,t,n,i,r,a,h,d){const _=t[1],S=_.consts,A=jf(_,e,n,i,Wi(S,h));return a&&OI(_,t,A,Wi(S,d),r),A.mergedAttrs=Ya(A.mergedAttrs,A.attrs),null!==A.attrs&&u1(A,A.attrs,!1),null!==A.mergedAttrs&&u1(A,A.mergedAttrs,!0),null!==_.queries&&_.queries.elementStart(_,A),A}function TS(e,t){q0(e,t),yi(t)&&e.queries.elementEnd(t)}function h1(e){return!!function IS(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function er(e,t,n){return n!==pi&&(!Object.is(e[t],n)&&(e[t]=n,!0))}function sy(e,t,n){return function i(r){Ig(Ar(e)?Ze(e.index,t):t,5);const h=t[8];let d=VI(t,h,n,r),_=i.__ngNextListenerFn__;for(;_;)d=VI(t,h,_,r)&&d,_=_.__ngNextListenerFn__;return d}}function VI(e,t,n,i){const r=Mt(null);try{return qn(6,t,n),!1!==n(i)}catch(a){return function dS(e,t){const n=e[9];n&&n.get(ln,null)?.(t)}(e,a),!1}finally{qn(7,t,n),Mt(r)}}function GI(e,t,n,i,r,a,h){const d=t.firstCreatePass?pf(t):null,_=od(n),S=_.length;_.push(r,a),d&&d.push(i,e,S,(S+1)*(h?-1:1))}function f1(e,t,n,i,r,a){const d=t[1],A=t[n][d.data[n].outputs[i]].subscribe(a);GI(e.index,d,t,r,a,A,!0)}const Pd=Symbol("BINDING");class $I extends a1{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Rn(t);return new p1(n,this.ngModule)}}class p1 extends NI{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=function r8(e){return Object.keys(e).map(t=>{const[n,i,r]=e[t],a={propName:n,templateName:t,isSignal:0!==(i&$v.SignalBased)};return r&&(a.transform=r),a})}(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=function o8(e){return Object.keys(e).map(t=>({propName:e[t],templateName:t}))}(this.componentDef.outputs),this.cachedOutputs}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function X4(e){return e.map(Y4).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!n}create(t,n,i,r,a,h){qn(22);const d=Mt(null);try{const _=this.componentDef,S=function u8(e,t,n,i){const r=e?["ng-version","20.2.1"]:function Q4(e){const t=[],n=[];let i=1,r=2;for(;i<e.length;){let a=e[i];if("string"==typeof a)2===r?""!==a&&t.push(a,e[++i]):8===r&&n.push(a);else{if(!Sc(r))break;r=a}i++}return n.length&&t.push(1,...n),t}(t.selectors[0]);let a=null,h=null,d=0;if(n)for(const D of n)d+=D[Pd].requiredVars,D.create&&(D.targetIdx=0,(a??=[]).push(D)),D.update&&(D.targetIdx=0,(h??=[]).push(D));if(i)for(let D=0;D<i.length;D++){const A=i[D];if("function"!=typeof A)for(const F of A.bindings){d+=F[Pd].requiredVars;const k=D+1;F.create&&(F.targetIdx=k,(a??=[]).push(F)),F.update&&(F.targetIdx=k,(h??=[]).push(F))}}const _=[t];if(i)for(const D of i){const F=Kr("function"==typeof D?D:D.type);_.push(F)}return Xx(0,null,function h8(e,t){return e||t?n=>{if(1&n&&e)for(const i of e)i.create();if(2&n&&t)for(const i of t)i.update()}:null}(a,h),1,d,_,null,null,null,[r],null)}(i,_,h,a),D=function s8(e,t,n){let i=t instanceof sr?t:t?.injector;return i&&null!==e.getStandaloneInjector&&(i=e.getStandaloneInjector(i)||i),i?new Rg(n,i):n}(_,r||this.ngModule,t),A=function a8(e){const t=e.get(l1,null);if(null===t)throw new Te(407,!1);return{rendererFactory:t,sanitizer:e.get(N5,null),changeDetectionScheduler:e.get(Pr,null),ngReflect:!1}}(D),F=A.rendererFactory.createRenderer(null,_),k=i?function hB(e,t,n,i){const a=i.get(Iu,!1)||n===ei.ShadowDom,h=e.selectRootElement(t,a);return function dB(e){WT(e)}(h),h}(F,i,_.encapsulation,D):function l8(e,t){const n=function c8(e){return(e.selectors[0][0]||"div").toLowerCase()}(e);return Uv(t,n,"svg"===n?"svg":"math"===n?"math":null)}(_,F),G=h?.some(HI)||a?.some(fe=>"function"!=typeof fe&&fe.bindings.some(HI)),Y=Gv(null,S,null,512|Qx(_),null,null,A,F,D,null,null);Y[26]=k,T(Y);let ne=null;try{const fe=CS(26,Y,2,"#host",()=>S.directiveRegistry,!0,0);k&&(kT(F,k,fe),to(k,Y)),qv(S,Y,fe),Xi(S,fe,Y),TS(S,fe),void 0!==n&&function f8(e,t,n){const i=e.projection=[];for(let r=0;r<t.length;r++){const a=n[r];i.push(null!=a&&a.length?Array.from(a):null)}}(fe,this.ngContentSelectors,n),ne=Ze(fe.index,Y),Y[8]=ne[8],Xv(S,Y,null)}catch(fe){throw null!==ne&&d_(ne),d_(Y),fe}finally{qn(23),B()}return new d8(this.componentType,Y,!!G)}finally{Mt(d)}}}function HI(e){const t=e[Pd].kind;return"input"===t||"twoWay"===t}class d8 extends A5{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,n,i){super(),this._rootLView=n,this._hasInputBindings=i,this._tNode=la(n[1],26),this.location=bd(this._tNode,n),this.instance=Ze(this._tNode.index,n)[8],this.hostView=this.changeDetectorRef=new K_(n,void 0),this.componentType=t}setInput(t,n){const i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const r=this._rootLView;Yv(i,r[1],r,t,n),this.previousInputValues.set(t,n),Ig(Ze(i.index,r),1)}get injector(){return new ur(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}let el=(()=>class e{static __NG_ELEMENT_ID__=p8})();function p8(){return ZI(St(),Se())}const g8=el,qI=class extends g8{_lContainer;_hostTNode;_hostLView;constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return bd(this._hostTNode,this._hostLView)}get injector(){return new ur(this._hostTNode,this._hostLView)}get parentInjector(){const t=og(this._hostTNode,this._hostLView);if(Su(t)){const n=_d(t,this._hostLView),i=pc(t);return new ur(n[1].data[i+8],n)}return new ur(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=WI(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,i){let r,a;"number"==typeof i?r=i:null!=i&&(r=i.index,a=i.injector);const d=t.createEmbeddedViewImpl(n||{},a,null);return this.insertImpl(d,r,zf(this._hostTNode,null)),d}createComponent(t,n,i,r,a,h,d){const _=t&&!function fc(e){return"function"==typeof e}(t);let S;if(_)S=n;else{const ne=n||{};S=ne.index,i=ne.injector,r=ne.projectableNodes,a=ne.environmentInjector||ne.ngModuleRef,h=ne.directives,d=ne.bindings}const D=_?t:new p1(Rn(t)),A=i||this.parentInjector;if(!a&&null==D.ngModule){const fe=(_?A:this.parentInjector).get(sr,null);fe&&(a=fe)}Rn(D.componentType??{});const Y=D.create(A,r,null,a,h,d);return this.insertImpl(Y.hostView,S,zf(this._hostTNode,null)),Y}insert(t,n){return this.insertImpl(t,n,!0)}insertImpl(t,n,i){const r=t._lView;if(function df(e){return Lr(e[3])}(r)){const d=this.indexOf(t);if(-1!==d)this.detach(d);else{const _=r[3],S=new qI(_,_[5],_[3]);S.detach(S.indexOf(t))}}const a=this._adjustIndex(n),h=this._lContainer;return function Ag(e,t,n,i=!0){const r=t[1];if(function BB(e,t,n,i){const r=10+i,a=n.length;i>0&&(n[r-1][4]=t),i<a-10?(t[4]=n[r],yl(n,10+i,t)):(n.push(t),t[4]=null),t[3]=n;const h=t[16];null!==h&&n!==h&&lI(h,t);const d=t[18];null!==d&&d.insertView(e),ff(t),t[2]|=128}(r,t,e,n),i){const h=aS(n,e),d=t[11],_=d.parentNode(e[7]);null!==_&&function rB(e,t,n,i,r,a){i[0]=r,i[5]=t,Hv(e,i,n,1,r,a)}(r,e[5],d,t,_,h)}const a=t[6];null!==a&&null!==a.firstChild&&(a.firstChild=null)}(h,r,a,i),t.attachToViewContainerRef(),yl(AS(h),a,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=WI(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=Z_(this._lContainer,n);i&&(Ju(AS(this._lContainer),n),q_(i[1],i))}detach(t){const n=this._adjustIndex(t,-1),i=Z_(this._lContainer,n);return i&&null!=Ju(AS(this._lContainer),n)?new K_(i):null}_adjustIndex(t,n=0){return t??this.length+n}};function WI(e){return e[8]}function AS(e){return e[8]||(e[8]=[])}function ZI(e,t){let n;const i=t[e.index];return Lr(i)?n=i:(n=sI(i,t,null,e),t[e.index]=n,Jx(t,n)),KI(n,t,e,i),new qI(n,e,t)}let KI=function XI(e,t,n,i){if(e[7])return;let r;r=8&n.type?Ci(i):function m8(e,t){const n=e[11],i=n.createComment(""),r=ar(t,e),a=n.parentNode(r);return Lf(n,a,i,n.nextSibling(r),!1),i}(t,n),e[7]=r};class RS{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new RS(this.queryList)}setDirty(){this.queryList.setDirty()}}class NS{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const i=null!==t.contentQueries?t.contentQueries[0]:n.length,r=[];for(let a=0;a<i;a++){const h=n.getByIndex(a);r.push(this.queries[h.indexInDeclarationView].clone())}return new NS(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==BS(t,n).matches&&this.queries[n].setDirty()}}class QI{flags;read;predicate;constructor(t,n,i=null){this.flags=n,this.read=i,this.predicate="string"==typeof t?function S8(e){return e.split(",").map(t=>t.trim())}(t):t}}class kS{queries;constructor(t=[]){this.queries=t}elementStart(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let i=0;i<this.length;i++){const r=null!==n?n.length:0,a=this.getByIndex(i).embeddedTView(t,r);a&&(a.indexInDeclarationView=i,null!==n?n.push(a):n=[a])}return null!==n?new kS(n):null}template(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class OS{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,n=-1){this.metadata=t,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new OS(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1&~this.metadata.flags){const n=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const a=i[r];this.matchTNodeWithReadOption(t,n,v8(n,a)),this.matchTNodeWithReadOption(t,n,vd(n,t,a,!1,!1))}else i===ro?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,vd(n,t,i,!1,!1))}matchTNodeWithReadOption(t,n,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Nn||r===el||r===ro&&4&n.type)this.addMatch(n.index,-2);else{const a=vd(n,t,r,!1,!1);null!==a&&this.addMatch(n.index,a)}else this.addMatch(n.index,i)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function v8(e,t){const n=e.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===t)return n[i+1];return null}function w8(e,t,n,i){return-1===n?function b8(e,t){return 11&e.type?bd(e,t):4&e.type?Jv(e,t):null}(t,e):-2===n?function x8(e,t,n){return n===Nn?bd(t,e):n===ro?Jv(t,e):n===el?ZI(t,e):void 0}(e,t,i):mh(e,e[1],n,t)}function JI(e,t,n,i){const r=t[18].queries[i];if(null===r.matches){const a=e.data,h=n.matches,d=[];for(let _=0;null!==h&&_<h.length;_+=2){const S=h[_];d.push(S<0?null:w8(t,a[S],h[_+1],n.metadata.read))}r.matches=d}return r.matches}function FS(e,t,n,i){const r=e.queries.getByIndex(n),a=r.matches;if(null!==a){const h=JI(e,t,r,n);for(let d=0;d<a.length;d+=2){const _=a[d];if(_>0)i.push(h[d/2]);else{const S=a[d+1],D=t[-_];for(let A=10;A<D.length;A++){const F=D[A];F[16]===F[3]&&FS(F[1],F,S,i)}if(null!==D[9]){const A=D[9];for(let F=0;F<A.length;F++){const k=A[F];FS(k[1],k,S,i)}}}}}return i}function e2(e,t,n){const i=new sv(!(4&~n));return function gf(e,t,n,i){const r=od(t);r.push(n),e.firstCreatePass&&pf(e).push(i,r.length-1)}(e,t,i,i.destroy),(t[18]??=new NS).queries.push(new RS(i))-1}function i2(e,t,n){null===e.queries&&(e.queries=new kS),e.queries.track(new OS(t,n))}function BS(e,t){return e.queries.getByIndex(t)}function r2(e,t){const n=e[1],i=BS(n,t);return i.crossesNgTemplate?FS(n,e,t,[]):JI(n,e,i,t)}const c2=new Set;function Zo(e){c2.has(e)||(c2.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}let $f=class{},u2=class{};class VS extends $f{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new $I(this);constructor(t,n,i,r=!0){super(),this.ngModuleType=t,this._parent=n;const a=Eo(t);this._bootstrapComponents=ku(a.bootstrap),this._r3Injector=He(t,n,[{provide:$f,useValue:this},{provide:a1,useValue:this.componentFactoryResolver},...i],Sn(t),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class h2 extends u2{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new VS(this.moduleType,t,[])}}class d2 extends $f{injector;componentFactoryResolver=new $I(this);instance=null;constructor(t){super();const n=new La([...t.providers,{provide:$f,useValue:this},{provide:a1,useValue:this.componentFactoryResolver}],t.parent||ec(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function US(e,t,n=null){return new d2({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let F8=(()=>{class e{_injector;cachedInjectors=new Map;constructor(n){this._injector=n}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){const i=yn(0,n.type),r=i.length>0?US([i],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,r)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Xe({token:e,providedIn:"environment",factory:()=>new e(Ft(sr))})}return e})();function pa(e){return ys(()=>{const t=p2(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===lg.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:t.standalone?r=>r.get(F8).getOrCreateStandaloneInjector(n):null,getExternalStyles:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||ei.Emulated,styles:e.styles||In,_:null,schemas:e.schemas||null,tView:null,id:""};t.standalone&&Zo("NgStandalone"),g2(n);const i=e.dependencies;return n.directiveDefs=g1(i,f2),n.pipeDefs=g1(i,Lo),n.id=function j8(e){let t=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,"function"==typeof e.consts?"":e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery];for(const a of i.join("|"))t=Math.imul(31,t)+a.charCodeAt(0)|0;return t+=2147483648,"c"+t}(n),n})}function f2(e){return Rn(e)||Kr(e)}function Ur(e){return ys(()=>({type:e.type,bootstrap:e.bootstrap||In,declarations:e.declarations||In,imports:e.imports||In,exports:e.exports||In,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function L8(e,t){if(null==e)return Is;const n={};for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];let a,h,d,_;Array.isArray(r)?(d=r[0],a=r[1],h=r[2]??a,_=r[3]||null):(a=r,h=r,d=$v.None,_=null),n[a]=[i,d,_],t[a]=h}return n}function B8(e){if(null==e)return Is;const t={};for(const n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function lt(e){return ys(()=>{const t=p2(e);return g2(t),t})}function p2(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputConfig:e.inputs||Is,exportAs:e.exportAs||null,standalone:e.standalone??!0,signals:!0===e.signals,selectors:e.selectors||In,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:L8(e.inputs,t),outputs:B8(e.outputs),debugInfo:null}}function g2(e){e.features?.forEach(t=>t(e))}function g1(e,t){return e?()=>{const n="function"==typeof e?e():e,i=[];for(const r of n){const a=t(r);null!==a&&i.push(a)}return i}:null}function Wn(e){let t=function m2(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const i=[e];for(;t;){let r;if(Xr(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Te(903,!1);r=t.\u0275dir}if(r){if(n){i.push(r);const h=e;h.inputs=GS(e.inputs),h.declaredInputs=GS(e.declaredInputs),h.outputs=GS(e.outputs);const d=r.hostBindings;d&&H8(e,d);const _=r.viewQuery,S=r.contentQueries;if(_&&G8(e,_),S&&$8(e,S),V8(e,r),$c(e.outputs,r.outputs),Xr(r)&&r.data.animation){const D=e.data;D.animation=(D.animation||[]).concat(r.data.animation)}}const a=r.features;if(a)for(let h=0;h<a.length;h++){const d=a[h];d&&d.ngInherit&&d(e),d===Wn&&(n=!1)}}t=Object.getPrototypeOf(t)}!function U8(e){let t=0,n=null;for(let i=e.length-1;i>=0;i--){const r=e[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Ya(r.hostAttrs,n=Ya(n,r.hostAttrs))}}(i)}function V8(e,t){for(const n in t.inputs){if(!t.inputs.hasOwnProperty(n)||e.inputs.hasOwnProperty(n))continue;const i=t.inputs[n];void 0!==i&&(e.inputs[n]=i,e.declaredInputs[n]=t.declaredInputs[n])}}function GS(e){return e===Is?{}:e===In?[]:e}function G8(e,t){const n=e.viewQuery;e.viewQuery=n?(i,r)=>{t(i,r),n(i,r)}:t}function $8(e,t){const n=e.contentQueries;e.contentQueries=n?(i,r,a)=>{t(i,r,a),n(i,r,a)}:t}function H8(e,t){const n=e.hostBindings;e.hostBindings=n?(i,r)=>{t(i,r),n(i,r)}:t}function Ko(e,t,n,i,r,a,h,d){const _=Se(),S=zt();return function X8(e,t,n,i,r,a,h,d,_,S,D){const A=n+26;let F;t.firstCreatePass?(F=jf(t,A,4,h||null,d||null),ld()&&OI(t,e,F,Wi(t.consts,S),hS),q0(t,F)):F=t.data[A],function w2(e,t,n,i,r,a,h,d){if(n.firstCreatePass){e.mergedAttrs=Ya(e.mergedAttrs,e.attrs);const D=e.tView=Xx(2,e,r,a,h,n.directiveRegistry,n.pipeRegistry,null,n.schemas,n.consts,null);null!==n.queries&&(n.queries.template(n,e),D.queries=n.queries.embeddedTView(e))}d&&(e.flags|=d),qa(e,!1);const _=S2(n,t,e,i);se()&&sS(n,t,_,e),to(_,t);const S=sI(_,t,_,e);t[i+26]=S,Jx(t,S)}(F,e,t,n,i,r,a,_),Br(F)&&qv(t,e,F),null!=S&&Cg(e,F,D)}(_,S,e,t,n,i,r,Wi(S.consts,a),void 0,h,d),Ko}let S2=function E2(e,t,n,i){return ve(!0),t[11].createComment("")};var qS=function(e){return e[e.CHANGE_DETECTION=0]="CHANGE_DETECTION",e[e.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",e}(qS||{});const uy=new $e(""),I2=!1,Zt=class iz extends Cn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,function lu(){return void 0!==Jc()||null!=Vh()}()&&(this.destroyRef=me(rt,{optional:!0})??void 0,this.pendingTasks=me(Rr,{optional:!0})??void 0)}emit(t){const n=Mt(null);try{super.next(t)}finally{Mt(n)}}subscribe(t,n,i){let r=t,a=n||(()=>null),h=i;if(t&&"object"==typeof t){const _=t;r=_.next?.bind(_),a=_.error?.bind(_),h=_.complete?.bind(_)}this.__isAsync&&(a=this.wrapInTimeout(a),r&&(r=this.wrapInTimeout(r)),h&&(h=this.wrapInTimeout(h)));const d=super.subscribe({next:r,error:a,complete:h});return t instanceof Si&&t.add(d),d}wrapInTimeout(t){return n=>{const i=this.pendingTasks?.add();setTimeout(()=>{try{t(n)}finally{void 0!==i&&this.pendingTasks?.remove(i)}})}}};function A2(e){let t,n;function i(){e=ms;try{void 0!==n&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(n),void 0!==t&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{e(),i()}),"function"==typeof requestAnimationFrame&&(n=requestAnimationFrame(()=>{e(),i()})),()=>i()}function P2(e){return queueMicrotask(()=>e()),()=>{e=ms}}const WS="isAngularZone",v1=WS+"_ID";let rz=0;class vn{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Zt(!1);onMicrotaskEmpty=new Zt(!1);onStable=new Zt(!1);onError=new Zt(!1);constructor(t){const{enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:a=I2}=t;if(typeof Zone>"u")throw new Te(908,!1);Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!r&&i,h.shouldCoalesceRunChangeDetection=r,h.callbackScheduled=!1,h.scheduleInRootZone=a,function az(e){const t=()=>{!function sz(e){function t(){A2(()=>{e.callbackScheduled=!1,KS(e),e.isCheckStableRunning=!0,ZS(e),e.isCheckStableRunning=!1})}e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,e.scheduleInRootZone?Zone.root.run(()=>{t()}):e._outer.run(()=>{t()}),KS(e))}(e)},n=rz++;e._inner=e._inner.fork({name:"angular",properties:{[WS]:!0,[v1]:n,[v1+n]:!0},onInvokeTask:(i,r,a,h,d,_)=>{if(function lz(e){return k2(e,"__ignore_ng_zone__")}(_))return i.invokeTask(a,h,d,_);try{return R2(e),i.invokeTask(a,h,d,_)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===h.type||e.shouldCoalesceRunChangeDetection)&&t(),N2(e)}},onInvoke:(i,r,a,h,d,_,S)=>{try{return R2(e),i.invoke(a,h,d,_,S)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!function cz(e){return k2(e,"__scheduler_tick__")}(_)&&t(),N2(e)}},onHasTask:(i,r,a,h)=>{i.hasTask(a,h),r===a&&("microTask"==h.change?(e._hasPendingMicrotasks=h.microTask,KS(e),ZS(e)):"macroTask"==h.change&&(e.hasPendingMacrotasks=h.macroTask))},onHandleError:(i,r,a,h)=>(i.handleError(a,h),e.runOutsideAngular(()=>e.onError.emit(h)),!1)})}(h)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(WS)}static assertInAngularZone(){if(!vn.isInAngularZone())throw new Te(909,!1)}static assertNotInAngularZone(){if(vn.isInAngularZone())throw new Te(909,!1)}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,r){const a=this._inner,h=a.scheduleEventTask("NgZoneEvent: "+r,t,oz,ms,ms);try{return a.runTask(h,n,i)}finally{a.cancelTask(h)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const oz={};function ZS(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function KS(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&!0===e.callbackScheduled)}function R2(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function N2(e){e._nesting--,ZS(e)}class YS{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Zt;onMicrotaskEmpty=new Zt;onStable=new Zt;onError=new Zt;run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,r){return t.apply(n,i)}}function k2(e,t){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0]?.data?.[t]}let O2=(()=>{class e{impl=null;execute(){this.impl?.execute()}static \u0275prov=Xe({token:e,providedIn:"root",factory:()=>new e})}return e})();const F2=[0,1,2,3];let hz=(()=>{class e{ngZone=me(vn);scheduler=me(Pr);errorHandler=me(Mn,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){me(uy,{optional:!0})}execute(){const n=this.sequences.size>0;n&&qn(16),this.executing=!0;for(const i of F2)for(const r of this.sequences)if(!r.erroredOrDestroyed&&r.hooks[i])try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>(0,r.hooks[i])(r.pipelinedValue),r.snapshot))}catch(a){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(a)}this.executing=!1;for(const i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(const i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),n&&qn(17)}register(n){const{view:i}=n;void 0!==i?((i[25]??=[]).push(n),$a(i),i[2]|=8192):this.executing?this.deferredRegistrations.add(n):this.addSequence(n)}addSequence(n){this.sequences.add(n),this.scheduler.notify(7)}unregister(n){this.executing&&this.sequences.has(n)?(n.erroredOrDestroyed=!0,n.pipelinedValue=void 0,n.once=!0):(this.sequences.delete(n),this.deferredRegistrations.delete(n))}maybeTrace(n,i){return i?i.run(qS.AFTER_NEXT_RENDER,n):n()}static \u0275prov=Xe({token:e,providedIn:"root",factory:()=>new e})}return e})();class L2{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,n,i,r,a,h=null){this.impl=t,this.hooks=n,this.view=i,this.once=r,this.snapshot=h,this.unregisterOnDestroy=a?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();const t=this.view?.[25];t&&(this.view[25]=t.filter(n=>n!==this))}}function B2(e,t,n,i){const r=t.get(O2);r.impl??=t.get(hz);const a=t.get(uy,null,{optional:!0}),h=!0!==n?.manualCleanup?t.get(rt):null,d=t.get(Za,null,{optional:!0}),_=new L2(r.impl,function dz(e){return e instanceof Function?[void 0,void 0,e,void 0]:[e.earlyRead,e.write,e.mixedReadWrite,e.read]}(e),d?.view,i,h,a?.snapshot(null));return r.impl.register(_),_}let W2=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const lA=new $e("");function fy(e){return!!e&&"function"==typeof e.then}function cA(e){return!!e&&"function"==typeof e.subscribe}const uA=new $e("");let hA=(()=>{class e{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i});appInits=me(uA,{optional:!0})??[];injector=me(Be);constructor(){}runInitializers(){if(this.initialized)return;const n=[];for(const r of this.appInits){const a=Yr(this.injector,r);if(fy(a))n.push(a);else if(cA(a)){const h=new Promise((d,_)=>{a.subscribe({complete:d,error:_})});n.push(h)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{i()}).catch(r=>{this.reject(r)}),0===n.length&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const dA=new $e("");let Fu=(()=>{class e{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=me(ln);afterRenderManager=me(O2);zonelessEnabled=me(ca);rootEffectScheduler=me(Yi);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new Cn;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=me(Rr);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(wn(n=>!n))}constructor(){me(uy,{optional:!0})}whenStable(){let n;return new Promise(i=>{n=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{n.unsubscribe()})}_injector=me(sr);_rendererFactory=null;get injector(){return this._injector}bootstrap(n,i){return this.bootstrapImpl(n,i)}bootstrapImpl(n,i,r=Be.NULL){return this._injector.get(vn).run(()=>{qn(10);const h=n instanceof NI;if(!this._injector.get(hA).done)throw new Te(405,"");let _;_=h?n:this._injector.get(a1).resolveComponentFactory(n),this.componentTypes.push(_.componentType);const S=function _6(e){return e.isBoundToModule}(_)?void 0:this._injector.get($f),A=_.create(r,[],i||_.selector,S),F=A.location.nativeElement,k=A.injector.get(lA,null);return k?.registerApplication(F),A.onDestroy(()=>{this.detachView(A.hostView),M1(this.components,A),k?.unregisterApplication(F)}),this._loadComponent(A),qn(11,A),A})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){qn(12),null!==this.tracingSnapshot?this.tracingSnapshot.run(qS.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new Te(101,!1);const n=Mt(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Mt(n),this.afterTick.next(),qn(13)}};synchronize(){null===this._rendererFactory&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(l1,null,{optional:!0}));let n=0;for(;0!==this.dirtyFlags&&n++<10;)qn(14),this.synchronizeOnce(),qn(15)}synchronizeOnce(){16&this.dirtyFlags&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let n=!1;if(7&this.dirtyFlags){const i=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews)(i||ac(r))&&(Qv(r,i&&!this.zonelessEnabled?0:1),n=!0);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),23&this.dirtyFlags)return}n||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:n})=>ac(n))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;M1(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(n),this._injector.get(dA,[]).forEach(r=>r(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>M1(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Te(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function M1(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function zi(e,t,n,i){const r=Se();return er(r,lr(),t)&&(zt(),function yB(e,t,n,i,r,a){const h=ar(e,t);!function Wv(e,t,n,i,r,a,h){if(null==a)e.removeAttribute(t,r,n);else{const d=null==h?Bt(a):h(a,i||"",r);e.setAttribute(t,r,d,n)}}(t[11],h,a,e.value,n,i,r)}(Q(),r,e,t,n,i)),zi}const SA=new $e("",{providedIn:"root",factory:()=>!1}),ej=new $e("",{providedIn:"root",factory:()=>tj}),tj=4e3;function xr(e,t,n){const i=Se();return er(i,lr(),t)&&(zt(),cS(Q(),i,e,t,i[11],n)),xr}function vE(e,t,n,i,r){Yv(t,e,n,r?"class":"style",i)}function bn(e,t,n,i){const r=Se(),a=r[1],h=e+26,d=a.firstCreatePass?CS(h,r,2,t,hS,ld(),n,i):a.data[h];if(function Zv(e,t,n,i,r){const a=26+n,h=t[1],d=r(h,t,e,i,n);t[a]=d,qa(e,!0);const _=2===e.type;return _?(kT(t[11],d,e),(0===function ui(){return Lt.lFrame.elementDepthCount}()||Br(e))&&to(d,t),function mu(){Lt.lFrame.elementDepthCount++}()):to(d,t),se()&&(!_||!Au(e))&&sS(h,t,d,e),e}(d,r,e,t,bE),Br(d)){const _=r[1];qv(_,r,d),Xi(_,d,r)}return null!=i&&Cg(r,d),bn}function xn(){const e=zt(),n=Kv(St());return e.firstCreatePass&&TS(e,n),function ud(e){return Lt.skipHydrationRootTNode===e}(n)&&function dt(){Lt.skipHydrationRootTNode=null}(),function ad(){Lt.lFrame.elementDepthCount--}(),null!=n.classesWithoutHost&&function Qp(e){return!!(8&e.flags)}(n)&&vE(e,n,Se(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function Jp(e){return!!(16&e.flags)}(n)&&vE(e,n,Se(),n.stylesWithoutHost,!1),xn}function tl(e,t,n,i){return bn(e,t,n,i),xn(),tl}typeof document<"u"&&document;let bE=(e,t,n,i,r)=>(ve(!0),Uv(t[11],i,function ue(){return Lt.lFrame.currentNamespace}()));function Nl(){return Se()}function bs(e,t,n){const i=Se();return er(i,lr(),t)&&(zt(),uS(Q(),i,e,t,i[11],n)),bs}const k1="en-US";let jA=k1;function Zn(e,t,n){const i=Se(),r=zt(),a=St();return function CE(e,t,n,i,r,a,h){let d=!0,_=null;if((3&i.type||h)&&(_??=sy(i,t,a),function UI(e,t,n,i,r,a,h,d){const _=Br(e);let S=!1,D=null;if(!i&&_&&(D=function Y5(e,t,n,i){const r=e.cleanup;if(null!=r)for(let a=0;a<r.length-1;a+=2){const h=r[a];if(h===n&&r[a+1]===i){const d=t[7],_=r[a+2];return d&&d.length>_?d[_]:null}"string"==typeof h&&(a+=2)}return null}(t,n,a,e.index)),null!==D)(D.__ngLastListenerFn__||D).__ngNextListenerFn__=h,D.__ngLastListenerFn__=h,S=!0;else{const A=ar(e,n),F=i?i(A):A,k=r.listen(F,a,d);GI(i?Y=>i(Ci(Y[e.index])):e.index,t,n,a,d,k,!1)}return S}(i,e,t,h,n,r,a,_)&&(d=!1)),d){const S=i.outputs?.[r],D=i.hostDirectiveOutputs?.[r];if(D&&D.length)for(let A=0;A<D.length;A+=2){const F=D[A],k=D[A+1];_??=sy(i,t,a),f1(i,t,F,k,r,_)}if(S&&S.length)for(const A of S)_??=sy(i,t,a),f1(i,t,A,r,r,_)}}(r,i,i[11],a,e,t,n),Zn}function Jt(e=1){return function V(e){return(Lt.lFrame.contextLView=function an(e,t){for(;e>0;)t=t[14],e--;return t}(e,Lt.lFrame.contextLView))[8]}(e)}function _o(e,t,n,i){!function n2(e,t,n,i){const r=zt();if(r.firstCreatePass){const a=St();i2(r,new QI(t,n,i),a.index),function E8(e,t){const n=e.contentQueries||(e.contentQueries=[]);t!==(n.length?n[n.length-1]:-1)&&n.push(e.queries.length-1,t)}(r,e),!(2&~n)&&(r.staticContentQueries=!0)}return e2(r,Se(),n)}(e,t,n,i)}function Ah(e,t,n){!function t2(e,t,n){const i=zt();return i.firstCreatePass&&(i2(i,new QI(e,t,n),-1),!(2&~t)&&(i.staticViewQueries=!0)),e2(i,Se(),t)}(e,t,n)}function Pi(e){const t=Se(),n=zt(),i=p();m(i+1);const r=BS(n,i);if(e.dirty&&function hf(e){return!(4&~e[2])}(t)===!(2&~r.metadata.flags)){if(null===r.matches)e.reset([]);else{const a=r2(t,i);e.reset(a,yr),e.notifyOnChanges()}return!0}return!1}function Ri(){return function LS(e,t){return e[18].queries[t].queryList}(Se(),p())}function z1(e,t){return e<<17|t<<2}function ep(e){return e>>17&32767}function AE(e){return 2|e}function Gg(e){return(131068&e)>>2}function PE(e,t){return-131069&e|t<<2}function RE(e){return 1|e}function oP(e,t,n,i){const r=e[n+1],a=null===t;let h=i?ep(r):Gg(r),d=!1;for(;0!==h&&(!1===d||a);){const S=e[h+1];SV(e[h],t)&&(d=!0,e[h+1]=i?RE(S):AE(S)),h=i?ep(S):Gg(S)}d&&(e[n+1]=i?AE(r):RE(r))}function SV(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&vl(e,t)>=0}function ji(e,t){return function fP(e,t,n,i){const r=Se(),a=zt(),h=function Ns(e){const t=Lt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}(2);a.firstUpdatePass&&function mP(e,t,n,i){const r=e.data;if(null===r[n+1]){const a=r[q()],h=function gP(e,t){return t>=e.expandoStartIndex}(e,n);(function bP(e,t){return!!(e.flags&(t?8:16))})(a,i)&&null===t&&!h&&(t=!1),t=function NV(e,t,n,i){const r=function u(e){const t=Lt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let a=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(n=xy(n=NE(null,e,t,n,i),t.attrs,i),a=null);else{const h=t.directiveStylingLast;if(-1===h||e[h]!==r)if(n=NE(r,e,t,n,i),null===a){let _=function kV(e,t,n){const i=n?t.classBindings:t.styleBindings;if(0!==Gg(i))return e[ep(i)]}(e,t,i);void 0!==_&&Array.isArray(_)&&(_=NE(null,e,t,_[1],i),_=xy(_,t.attrs,i),function OV(e,t,n,i){e[ep(n?t.classBindings:t.styleBindings)]=i}(e,t,i,_))}else a=function FV(e,t,n){let i;const r=t.directiveEnd;for(let a=1+t.directiveStylingLast;a<r;a++)i=xy(i,e[a].hostAttrs,n);return xy(i,t.attrs,n)}(e,t,i)}return void 0!==a&&(i?t.residualClasses=a:t.residualStyles=a),n}(r,a,t,i),function wV(e,t,n,i,r,a){let h=a?t.classBindings:t.styleBindings,d=ep(h),_=Gg(h);e[i]=n;let D,S=!1;if(Array.isArray(n)?(D=n[1],(null===D||vl(n,D)>0)&&(S=!0)):D=n,r)if(0!==_){const F=ep(e[d+1]);e[i+1]=z1(F,d),0!==F&&(e[F+1]=PE(e[F+1],i)),e[d+1]=function vV(e,t){return 131071&e|t<<17}(e[d+1],i)}else e[i+1]=z1(d,0),0!==d&&(e[d+1]=PE(e[d+1],i)),d=i;else e[i+1]=z1(_,0),0===d?d=i:e[_+1]=PE(e[_+1],i),_=i;S&&(e[i+1]=AE(e[i+1])),oP(e,D,i,!0),oP(e,D,i,!1),function xV(e,t,n,i,r){const a=r?e.residualClasses:e.residualStyles;null!=a&&"string"==typeof t&&vl(a,t)>=0&&(n[i+1]=RE(n[i+1]))}(t,D,e,i,a),h=z1(d,_),a?t.classBindings=h:t.styleBindings=h}(r,a,t,n,h,i)}}(a,e,h,i),t!==pi&&er(r,h,t)&&function yP(e,t,n,i,r,a,h,d){if(!(3&t.type))return;const _=e.data,S=_[d+1],D=function bV(e){return!(1&~e)}(S)?vP(_,t,n,r,Gg(S),h):void 0;j1(D)||(j1(a)||function yV(e){return!(2&~e)}(S)&&(a=vP(_,null,n,r,d,h)),function uB(e,t,n,i,r){if(t)r?e.addClass(n,i):e.removeClass(n,i);else{let a=-1===i.indexOf("-")?void 0:Id.DashCase;null==r?e.removeStyle(n,i,a):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),a|=Id.Important),e.setStyle(n,i,r,a))}}(i,h,aa(q(),n),r,a))}(a,a.data[q()],r,r[11],e,r[h+1]=function jV(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=Sn(function bc(e){return e instanceof Ch?e.changingThisBreaksApplicationSecurity:e}(e)))),e}(t,n),i,h)}(e,t,null,!0),ji}function NE(e,t,n,i,r){let a=null;const h=n.directiveEnd;let d=n.directiveStylingLast;for(-1===d?d=n.directiveStart:d++;d<h&&(a=t[d],i=xy(i,a.hostAttrs,r),a!==e);)d++;return null!==e&&(n.directiveStylingLast=d),i}function xy(e,t,n){const i=n?1:2;let r=-1;if(null!==t)for(let a=0;a<t.length;a++){const h=t[a];"number"==typeof h?r=h:r===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),nu(e,h,!!n||t[++a]))}return void 0===e?null:e}function vP(e,t,n,i,r,a){const h=null===t;let d;for(;r>0;){const _=e[r],S=Array.isArray(_),D=S?_[1]:_,A=null===D;let F=n[r+1];F===pi&&(F=A?In:void 0);let k=A?Wh(F,i):D===i?F:void 0;if(S&&!j1(k)&&(k=Wh(_,i)),j1(k)&&(d=k,h))return d;const G=e[r+1];r=h?ep(G):Gg(G)}if(null!==t){let _=a?t.residualClasses:t.residualStyles;null!=_&&(d=Wh(_,i))}return d}function j1(e){return void 0!==e}function ws(e,t=""){const n=Se(),i=zt(),r=e+26,a=i.firstCreatePass?jf(i,r,1,t,null):i.data[r],h=wP(i,n,a,t,e);n[r]=h,se()&&sS(i,n,h,a),qa(a,!1)}let wP=(e,t,n,i,r)=>(ve(!0),function Kx(e,t){return e.createText(t)}(t[11],i));function tp(e,t,n){const i=Se(),r=function SP(e,t,n,i=""){return er(e,lr(),n)?t+Bt(n)+i:pi}(i,e,t,n);return r!==pi&&function Rh(e,t,n){const i=aa(t,e);!function AT(e,t,n){e.setValue(t,n)}(e[11],i,n)}(i,q(),r),tp}function kE(e,t,n,i,r){if(e=Vt(e),Array.isArray(e))for(let a=0;a<e.length;a++)kE(e[a],t,n,i,r);else{const a=zt(),h=Se(),d=St();let _=Fa(e)?e:Vt(e.provide);const S=Bo(e),D=1048575&d.providerIndexes,A=d.directiveStart,F=d.providerIndexes>>20;if(Fa(e)||!e.multi){const k=new Ef(S,r,et,null),G=FE(_,t,r?D:D+F,A);-1===G?(Eu(rg(d,h),a,_),OE(a,e,t.length),t.push(_),d.directiveStart++,d.directiveEnd++,r&&(d.providerIndexes+=1048576),n.push(k),h.push(k)):(n[G]=k,h[G]=k)}else{const k=FE(_,t,D+F,A),G=FE(_,t,D,D+F),ne=G>=0&&n[G];if(r&&!ne||!r&&!(k>=0&&n[k])){Eu(rg(d,h),a,_);const fe=function oU(e,t,n,i,r){const h=new Ef(e,n,et,null);return h.multi=[],h.index=t,h.componentProviders=0,GP(h,r,i&&!n),h}(r?rU:iU,n.length,r,i,S);!r&&ne&&(n[G].providerFactory=fe),OE(a,e,t.length,0),t.push(_),d.directiveStart++,d.directiveEnd++,r&&(d.providerIndexes+=1048576),n.push(fe),h.push(fe)}else OE(a,e,k>-1?k:G,GP(n[r?G:k],S,!r&&i));!r&&i&&ne&&n[G].componentProviders++}}}function OE(e,t,n,i){const r=Fa(t),a=function Bp(e){return!!e.useClass}(t);if(r||a){const _=(a?Vt(t.useClass):t).prototype.ngOnDestroy;if(_){const S=e.destroyHooks||(e.destroyHooks=[]);if(!r&&t.multi){const D=S.indexOf(n);-1===D?S.push(n,[i,_]):S[D+1].push(i,_)}else S.push(n,_)}}}function GP(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function FE(e,t,n,i){for(let r=n;r<i;r++)if(t[r]===e)return r;return-1}function iU(e,t,n,i,r){return LE(this.multi,[])}function rU(e,t,n,i,r){const a=this.multi;let h;if(this.providerFactory){const d=this.providerFactory.componentProviders,_=mh(i,i[1],this.providerFactory.index,r);h=_.slice(0,d),LE(a,h);for(let S=d;S<_.length;S++)h.push(_[S])}else h=[],LE(a,h);return h}function LE(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function Ni(e,t=[]){return n=>{n.providersResolver=(i,r)=>function nU(e,t,n){const i=zt();if(i.firstCreatePass){const r=Xr(e);kE(n,i.data,i.blueprint,r,!0),kE(t,i.data,i.blueprint,r,!1)}}(i,r?r(e):e,t)}}class XU{ngModuleFactory;componentFactories;constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let QU=(()=>{class e{compileModuleSync(n){return new h2(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),a=ku(Eo(n).declarations).reduce((h,d)=>{const _=Rn(d);return _&&h.push(new p1(_)),h},[]);return new XU(i,a)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),eG=(()=>{class e{zone=me(vn);changeDetectionScheduler=me(Pr);applicationRef=me(Fu);applicationErrorHandler=me(ln);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(n){this.applicationErrorHandler(n)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function GE({ngZoneFactory:e,ignoreChangesOutsideZone:t,scheduleInRootZone:n}){return e??=()=>new vn({...$E(),scheduleInRootZone:n}),[{provide:vn,useFactory:e},{provide:ea,multi:!0,useFactory:()=>{const i=me(eG,{optional:!0});return()=>i.initialize()}},{provide:ea,multi:!0,useFactory:()=>{const i=me(nG);return()=>{i.initialize()}}},!0===t?{provide:hc,useValue:!0}:[],{provide:El,useValue:n??I2},{provide:ln,useFactory:()=>{const i=me(vn),r=me(sr);let a;return h=>{i.runOutsideAngular(()=>{r.destroyed&&!a?setTimeout(()=>{throw h}):(a??=r.get(Mn),a.handleError(h))})}}}]}function $E(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}let nG=(()=>{class e{subscription=new Si;initialized=!1;zone=me(vn);pendingTasks=me(Rr);initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{vn.assertNotInAngularZone(),queueMicrotask(()=>{null!==n&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{vn.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),qE=(()=>{class e{applicationErrorHandler=me(ln);appRef=me(Fu);taskService=me(Rr);ngZone=me(vn);zonelessEnabled=me(ca);tracing=me(uy,{optional:!0});disableScheduling=me(hc,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Si;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(v1):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(me(El,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof YS||!this.zoneIsDefined)}notify(n){if(!this.zonelessEnabled&&5===n)return;let i=!1;switch(n){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 6:case 13:this.appRef.dirtyFlags|=2,i=!0;break;case 12:this.appRef.dirtyFlags|=16,i=!0;break;case 11:i=!0;break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;const r=this.useMicrotaskScheduler?P2:A2;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>r(()=>this.tick())):this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(n){return!(this.disableScheduling&&!n||this.appRef.destroyed||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(v1+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(0===this.appRef.dirtyFlags)return void this.cleanup();!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const n=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){this.taskService.remove(n),this.applicationErrorHandler(i)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,P2(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(n)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const n=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(n)}}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Nh=new $e("",{providedIn:"root",factory:()=>me(Nh,{optional:!0,skipSelf:!0})||function rG(){return typeof $localize<"u"&&$localize.locale||k1}()}),W1=Symbol("InputSignalNode#UNSET"),yR={...ls,transformFn:void 0,applyValueToInputSignal(e,t){ko(e,t)}};function vR(e,t){const n=Object.create(yR);function i(){if(ht(n),n.value===W1)throw new Te(-950,null);return n.value}return n.value=e,n.transformFn=t?.transform,i[zn]=n,i}function bR(e,t){return vR(e,t)}new $e("").__NG_ELEMENT_ID__=e=>{const t=St();if(null===t)throw new Te(204,!1);if(2&t.type)return t.value;if(8&e)return null;throw new Te(204,!1)};const gG=(bR.required=function pG(e){return vR(W1,e)},bR),K1=new $e(""),bG=new $e("");function Cy(e){return!e.moduleRef}let DR,zd=null;let nl=(()=>class e{static __NG_ELEMENT_ID__=DG})();function DG(e){return function CG(e,t,n){if(Ar(e)&&!n){const i=Ze(e.index,t);return new K_(i,i)}return 175&e.type?new K_(t[15],t):null}(St(),Se(),!(16&~e))}class NR{constructor(){}supports(t){return h1(t)}create(t){return new IG(t)}}const TG=(e,t)=>t;class IG{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||TG}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,i=this._removalsHead,r=0,a=null;for(;n||i;){const h=!i||n&&n.currentIndex<OR(i,r,a)?n:i,d=OR(h,r,a),_=h.currentIndex;if(h===i)r--,i=i._nextRemoved;else if(n=n._next,null==h.previousIndex)r++;else{a||(a=[]);const S=d-r,D=_-r;if(S!=D){for(let F=0;F<S;F++){const k=F<a.length?a[F]:a[F]=0,G=k+F;D<=G&&G<S&&(a[F]=k+1)}a[h.previousIndex]=D-S}}d!==_&&t(h,d,_)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!h1(t))throw new Te(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,a,h,n=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let d=0;d<this.length;d++)a=t[d],h=this._trackByFn(d,a),null!==n&&Object.is(n.trackById,h)?(i&&(n=this._verifyReinsertion(n,a,h,d)),Object.is(n.item,a)||this._addIdentityChange(n,a)):(n=this._mismatch(n,a,h,d),i=!0),n=n._next}else r=0,function Z5(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Symbol.iterator]();let i;for(;!(i=n.next()).done;)t(i.value)}}(t,d=>{h=this._trackByFn(r,d),null!==n&&Object.is(n.trackById,h)?(i&&(n=this._verifyReinsertion(n,d,h,r)),Object.is(n.item,d)||this._addIdentityChange(n,d)):(n=this._mismatch(n,d,h,r),i=!0),n=n._next,r++}),this.length=r;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,i,r){let a;return null===t?a=this._itTail:(a=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,a,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,a,r)):t=this._addAfter(new AG(n,i),a,r),t}_verifyReinsertion(t,n,i,r){let a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==a?t=this._reinsertAfter(a,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,a=t._nextRemoved;return null===r?this._removalsHead=a:r._nextRemoved=a,null===a?this._removalsTail=r:a._prevRemoved=r,this._insertAfter(t,n,i),this._addToMoves(t,i),t}_moveAfter(t,n,i){return this._unlink(t),this._insertAfter(t,n,i),this._addToMoves(t,i),t}_addAfter(t,n,i){return this._insertAfter(t,n,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,i){const r=null===n?this._itHead:n._next;return t._next=r,t._prev=n,null===r?this._itTail=t:r._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new kR),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,i=t._next;return null===n?this._itHead=i:n._next=i,null===i?this._itTail=n:i._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new kR),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class AG{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,n){this.item=t,this.trackById=n}}class PG{_head=null;_tail=null;add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===n||n<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const n=t._prevDup,i=t._nextDup;return null===n?this._head=i:n._nextDup=i,null===i?this._tail=n:i._prevDup=n,null===this._head}}class kR{map=new Map;put(t){const n=t.trackById;let i=this.map.get(n);i||(i=new PG,this.map.set(n,i)),i.add(t)}get(t,n){const r=this.map.get(t);return r?r.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function OR(e,t,n){const i=e.previousIndex;if(null===i)return i;let r=0;return n&&i<n.length&&(r=n[i]),i+t+r}function LR(){return new XE([new NR])}let XE=(()=>{class e{factories;static \u0275prov=Xe({token:e,providedIn:"root",factory:LR});constructor(n){this.factories=n}static create(n,i){if(null!=i){const r=i.factories.slice();n=n.concat(r)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||LR()),deps:[[e,new qp,new Hp]]}}find(n){const i=this.factories.find(r=>r.supports(n));if(null!=i)return i;throw new Te(901,!1)}}return e})();function FG(e){qn(8);try{const{rootComponent:t,appProviders:n,platformProviders:i}=e,r=function MG(e=[]){if(zd)return zd;const t=function AR(e=[],t){return Be.create({name:t,providers:[{provide:Jh,useValue:"platform"},{provide:K1,useValue:new Set([()=>zd=null])},...e]})}(e);return zd=t,function m6(){!function Uc(e){as=e}(()=>{throw new Te(600,"")})}(),function PR(e){const t=e.get(wv,null);Yr(e,()=>{t?.forEach(n=>n())})}(t),t}(i),a=[GE({}),{provide:Pr,useExisting:qE},hi,...n||[]];return function MR(e){const t=Cy(e)?e.r3Injector:e.moduleRef.injector,n=t.get(vn);return n.run(()=>{Cy(e)?e.r3Injector.resolveInjectorInitializers():e.moduleRef.resolveInjectorInitializers();const i=t.get(ln);let r;if(n.runOutsideAngular(()=>{r=n.onError.subscribe({next:i})}),Cy(e)){const a=()=>t.destroy(),h=e.platformInjector.get(K1);h.add(a),t.onDestroy(()=>{r.unsubscribe(),h.delete(a)})}else{const a=()=>e.moduleRef.destroy(),h=e.platformInjector.get(K1);h.add(a),e.moduleRef.onDestroy(()=>{M1(e.allPlatformModules,e.moduleRef),r.unsubscribe(),h.delete(a)})}return function xG(e,t,n){try{const i=n();return fy(i)?i.catch(r=>{throw t.runOutsideAngular(()=>e(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>e(i)),i}}(i,n,()=>{const a=t.get(Rr),h=a.add(),d=t.get(hA);return d.runInitializers(),d.donePromise.then(()=>{if(function Pj(e){"string"==typeof e&&(jA=e.toLowerCase().replace(/_/g,"-"))}(t.get(Nh,k1)||k1),!t.get(bG,!0))return Cy(e)?t.get(Fu):(e.allPlatformModules.push(e.moduleRef),e.moduleRef);if(Cy(e)){const D=t.get(Fu);return void 0!==e.rootComponent&&D.bootstrap(e.rootComponent),D}return DR?.(e.moduleRef,e.allPlatformModules),e.moduleRef}).finally(()=>{a.remove(h)})})})}({r3Injector:new d2({providers:a,parent:r,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:r,rootComponent:t})}catch(t){return Promise.reject(t)}finally{qn(9)}}const rM=new $e("");let uN=(()=>{class e{_zone;_plugins;_eventNameToPlugin=new Map;constructor(n,i){this._zone=i,n.forEach(r=>{r.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,r,a){return this._findPluginFor(i).addEventListener(n,i,r,a)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(a=>a.supports(n)),!i)throw new Te(5101,!1);return this._eventNameToPlugin.set(n,i),i}static \u0275fac=function(i){return new(i||e)(Ft(rM),Ft(vn))};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})();class hN{_doc;constructor(t){this._doc=t}manager}const oM="ng-app-id";function dN(e){for(const t of e)t.remove()}function fN(e,t){const n=t.createElement("style");return n.textContent=e,n}function sM(e,t){const n=t.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),n}let pN=(()=>{class e{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(n,i,r,a={}){this.doc=n,this.appId=i,this.nonce=r,function B$(e,t,n,i){const r=e.head?.querySelectorAll(`style[${oM}="${t}"],link[${oM}="${t}"]`);if(r)for(const a of r)a.removeAttribute(oM),a instanceof HTMLLinkElement?i.set(a.href.slice(a.href.lastIndexOf("/")+1),{usage:0,elements:[a]}):a.textContent&&n.set(a.textContent,{usage:0,elements:[a]})}(n,i,this.inline,this.external),this.hosts.add(n.head)}addStyles(n,i){for(const r of n)this.addUsage(r,this.inline,fN);i?.forEach(r=>this.addUsage(r,this.external,sM))}removeStyles(n,i){for(const r of n)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(n,i,r){const a=i.get(n);a?a.usage++:i.set(n,{usage:1,elements:[...this.hosts].map(h=>this.addElement(h,r(n,this.doc)))})}removeUsage(n,i){const r=i.get(n);r&&(r.usage--,r.usage<=0&&(dN(r.elements),i.delete(n)))}ngOnDestroy(){for(const[,{elements:n}]of[...this.inline,...this.external])dN(n);this.hosts.clear()}addHost(n){this.hosts.add(n);for(const[i,{elements:r}]of this.inline)r.push(this.addElement(n,fN(i,this.doc)));for(const[i,{elements:r}]of this.external)r.push(this.addElement(n,sM(i,this.doc)))}removeHost(n){this.hosts.delete(n)}addElement(n,i){return this.nonce&&i.setAttribute("nonce",this.nonce),n.appendChild(i)}static \u0275fac=function(i){return new(i||e)(Ft(ke),Ft(xd),Ft(Sv,8),Ft(fg))};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})();const aM={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},lM=/%COMP%/g,$$=new $e("",{providedIn:"root",factory:()=>!0});function mN(e,t){return t.map(n=>n.replace(lM,e))}let cM=(()=>{class e{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;animationDisabled;maxAnimationTimeout;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;registry;constructor(n,i,r,a,h,d,_,S=null,D,A,F=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=a,this.doc=h,this.platformId=d,this.ngZone=_,this.nonce=S,this.animationDisabled=D,this.maxAnimationTimeout=A,this.tracingService=F,this.platformIsServer=!1,this.defaultRenderer=new uM(n,h,_,this.platformIsServer,this.tracingService,this.registry=function Me(){return Ie}(),this.maxAnimationTimeout)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;const r=this.getOrCreateRenderer(n,i);return r instanceof yN?r.applyToHost(n):r instanceof hM&&r.applyStyles(),r}getOrCreateRenderer(n,i){const r=this.rendererByCompId;let a=r.get(i.id);if(!a){const h=this.doc,d=this.ngZone,_=this.eventManager,S=this.sharedStylesHost,D=this.removeStylesOnCompDestroy,A=this.platformIsServer,F=this.tracingService;switch(i.encapsulation){case ei.Emulated:a=new yN(_,S,i,this.appId,D,h,d,A,F,this.registry,this.animationDisabled,this.maxAnimationTimeout);break;case ei.ShadowDom:return new Z$(_,S,n,i,h,d,this.nonce,A,F,this.registry,this.maxAnimationTimeout);default:a=new hM(_,S,i,D,h,d,A,F,this.registry,this.animationDisabled,this.maxAnimationTimeout)}r.set(i.id,a)}return a}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(n){this.rendererByCompId.delete(n)}static \u0275fac=function(i){return new(i||e)(Ft(uN),Ft(pN),Ft(xd),Ft($$),Ft(ke),Ft(fg),Ft(vn),Ft(Sv),Ft(SA),Ft(ej),Ft(uy,8))};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})();class uM{eventManager;doc;ngZone;platformIsServer;tracingService;registry;maxAnimationTimeout;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,n,i,r,a,h,d){this.eventManager=t,this.doc=n,this.ngZone=i,this.platformIsServer=r,this.tracingService=a,this.registry=h,this.maxAnimationTimeout=d}destroy(){}destroyNode=null;createElement(t,n){return n?this.doc.createElementNS(aM[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(_N(t)?t.content:t).appendChild(n)}insertBefore(t,n,i){t&&(_N(t)?t.content:t).insertBefore(n,i)}removeChild(t,n){const{elements:i}=this.registry;i?i.animate(n,()=>n.remove(),this.maxAnimationTimeout):n.remove()}selectRootElement(t,n){let i="string"==typeof t?this.doc.querySelector(t):t;if(!i)throw new Te(-5104,!1);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,r){if(r){n=r+":"+n;const a=aM[r];a?t.setAttributeNS(a,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const r=aM[i];r?t.removeAttributeNS(r,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,r){r&(Id.DashCase|Id.Important)?t.style.setProperty(n,i,r&Id.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&Id.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){null!=t&&(t[n]=i)}setValue(t,n){t.nodeValue=n}listen(t,n,i,r){if("string"==typeof t&&!(t=Qn().getGlobalEventTarget(this.doc,t)))throw new Te(5102,!1);let a=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(a=this.tracingService.wrapEventListener(t,n,a)),this.eventManager.addEventListener(t,n,a,r)}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&n.preventDefault()}}}function _N(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Z$ extends uM{sharedStylesHost;hostEl;shadowRoot;constructor(t,n,i,r,a,h,d,_,S,D,A){super(t,a,h,_,S,D,A),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let F=r.styles;F=mN(r.id,F);for(const G of F){const Y=document.createElement("style");d&&Y.setAttribute("nonce",d),Y.textContent=G,this.shadowRoot.appendChild(Y)}const k=r.getExternalStyles?.();if(k)for(const G of k){const Y=sM(G,a);d&&Y.setAttribute("nonce",d),this.shadowRoot.appendChild(Y)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(null,n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class hM extends uM{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;_animationDisabled;constructor(t,n,i,r,a,h,d,_,S,D,A,F){super(t,a,h,d,_,S,A),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=r,this._animationDisabled=D;let k=i.styles;this.styles=F?mN(F,k):k,this.styleUrls=i.getExternalStyles?.(F)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){if(this.removeStylesOnCompDestroy){if(!this._animationDisabled&&this.registry.elements)return void this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)},this.maxAnimationTimeout)});this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}}}class yN extends hM{contentAttr;hostAttr;constructor(t,n,i,r,a,h,d,_,S,D,A,F){const k=r+"-"+i.id;super(t,n,i,a,h,d,_,S,D,A,F,k),this.contentAttr=function H$(e){return"_ngcontent-%COMP%".replace(lM,e)}(k),this.hostAttr=function q$(e){return"_nghost-%COMP%".replace(lM,e)}(k)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}class dM extends vu{supportsDOMEvents=!0;static makeCurrent(){!function dh(e){$o??=e}(new dM)}onAndCancel(t,n,i,r){return t.addEventListener(n,i,r),()=>{t.removeEventListener(n,i,r)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.remove()}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function K$(){return Ry=Ry||document.head.querySelector("base"),Ry?Ry.getAttribute("href"):null}();return null==n?null:function Y$(e){return new URL(e,document.baseURI).pathname}(n)}resetBaseElement(){Ry=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function j0(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[r,a]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(r.trim()===t)return decodeURIComponent(a)}return null}(document.cookie,t)}}let Ry=null,Q$=(()=>{class e{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})();const vN=["alt","control","meta","shift"],e7={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},t7={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};function bN(e){return{appProviders:[...c7,...e?.providers??[]],platformProviders:a7}}const a7=[{provide:fg,useValue:"browser"},{provide:wv,useValue:function r7(){dM.makeCurrent()},multi:!0},{provide:ke,useFactory:function s7(){return function bv(e){Nf=e}(document),document}}],c7=[{provide:Jh,useValue:"root"},{provide:Mn,useFactory:function o7(){return new Mn}},{provide:rM,useClass:(()=>{class e extends hN{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,r,a){return n.addEventListener(i,r,a),()=>this.removeEventListener(n,i,r,a)}removeEventListener(n,i,r,a){return n.removeEventListener(i,r,a)}static \u0275fac=function(i){return new(i||e)(Ft(ke))};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})(),multi:!0,deps:[ke]},{provide:rM,useClass:(()=>{class e extends hN{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,r,a){const h=e.parseEventName(i),d=e.eventCallback(h.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Qn().onAndCancel(n,h.domEventName,d,a))}static parseEventName(n){const i=n.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const a=e._normalizeKey(i.pop());let h="",d=i.indexOf("code");if(d>-1&&(i.splice(d,1),h="code."),vN.forEach(S=>{const D=i.indexOf(S);D>-1&&(i.splice(D,1),h+=S+".")}),h+=a,0!=i.length||0===a.length)return null;const _={};return _.domEventName=r,_.fullKey=h,_}static matchEventFullKeyCode(n,i){let r=e7[n.key]||n.key,a="";return i.indexOf("code.")>-1&&(r=n.code,a="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),vN.forEach(h=>{h!==r&&(0,t7[h])(n)&&(a+=h+".")}),a+=r,a===i)}static eventCallback(n,i,r){return a=>{e.matchEventFullKeyCode(a,n)&&r.runGuarded(()=>i(a))}}static _normalizeKey(n){return"esc"===n?"escape":n}static \u0275fac=function(i){return new(i||e)(Ft(ke))};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})(),multi:!0,deps:[ke]},cM,pN,uN,{provide:l1,useExisting:cM},{provide:class Ww{},useClass:Q$},[]];function Vi(e){return function f7(e){const t=Mt(null);try{return e()}finally{Mt(t)}}(e)}function jd(e){return this instanceof jd?(this.v=e,this):new jd(e)}function PN(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function _M(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(a){n[a]=e[a]&&function(h){return new Promise(function(d,_){!function r(a,h,d,_){Promise.resolve(_).then(function(S){a({value:S,done:d})},h)}(d,_,(h=e[a](h)).done,h.value)})}}}Error,Error,"function"==typeof SuppressedError&&SuppressedError;const vM=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function RN(e){return cn(e?.then)}function NN(e){return cn(e[qi])}function kN(e){return Symbol.asyncIterator&&cn(e?.[Symbol.asyncIterator])}function ON(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const FN=function tH(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function LN(e){return cn(e?.[FN])}function BN(e){return function AN(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",function h(k){return function(G){return Promise.resolve(G).then(k,A)}}),r[Symbol.asyncIterator]=function(){return this},r;function d(k,G){i[k]&&(r[k]=function(Y){return new Promise(function(ne,fe){a.push([k,Y,ne,fe])>1||_(k,Y)})},G&&(r[k]=G(r[k])))}function _(k,G){try{!function S(k){k.value instanceof jd?Promise.resolve(k.value.v).then(D,A):F(a[0][2],k)}(i[k](G))}catch(Y){F(a[0][3],Y)}}function D(k){_("next",k)}function A(k){_("throw",k)}function F(k,G){k(G),a.shift(),a.length&&_(a[0][0],a[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:r}=yield jd(n.read());if(r)return yield jd(void 0);yield yield jd(i)}}finally{n.releaseLock()}})}function zN(e){return cn(e?.getReader)}function Xo(e){if(e instanceof qt)return e;if(null!=e){if(NN(e))return function nH(e){return new qt(t=>{const n=e[qi]();if(cn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(vM(e))return function iH(e){return new qt(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(RN(e))return function rH(e){return new qt(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,K)})}(e);if(kN(e))return jN(e);if(LN(e))return function oH(e){return new qt(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(zN(e))return function sH(e){return jN(BN(e))}(e)}throw ON(e)}function jN(e){return new qt(t=>{(function aH(e,t){var n,i,r,a;return function TN(e,t,n,i){return new(n||(n=Promise))(function(a,h){function d(D){try{S(i.next(D))}catch(A){h(A)}}function _(D){try{S(i.throw(D))}catch(A){h(A)}}function S(D){D.done?a(D.value):function r(a){return a instanceof n?a:new n(function(h){h(a)})}(D.value).then(d,_)}S((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=PN(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(h){r={error:h}}finally{try{i&&!i.done&&(a=n.return)&&(yield a.call(n))}finally{if(r)throw r.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function kh(e,t,n,i=0,r=!1){const a=t.schedule(function(){n(),r?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(a),!r)return a}function VN(e,t=0){return Nr((n,i)=>{n.subscribe(di(i,r=>kh(i,e,()=>i.next(r),t),()=>kh(i,e,()=>i.complete(),t),r=>kh(i,e,()=>i.error(r),t)))})}function UN(e,t=0){return Nr((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function GN(e,t){if(!e)throw new Error("Iterable cannot be null");return new qt(n=>{kh(n,t,()=>{const i=e[Symbol.asyncIterator]();kh(n,t,()=>{i.next().then(r=>{r.done?n.complete():n.next(r.value)})},0,!0)})})}function Qo(e,t){return t?function fH(e,t){if(null!=e){if(NN(e))return function lH(e,t){return Xo(e).pipe(UN(t),VN(t))}(e,t);if(vM(e))return function uH(e,t){return new qt(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(RN(e))return function cH(e,t){return Xo(e).pipe(UN(t),VN(t))}(e,t);if(kN(e))return GN(e,t);if(LN(e))return function hH(e,t){return new qt(n=>{let i;return kh(n,t,()=>{i=e[FN](),kh(n,t,()=>{let r,a;try{({value:r,done:a}=i.next())}catch(h){return void n.error(h)}a?n.complete():n.next(r)},0,!0)}),()=>cn(i?.return)&&i.return()})}(e,t);if(zN(e))return function dH(e,t){return GN(BN(e),t)}(e,t)}throw ON(e)}(e,t):Xo(e)}function $N(e){return e&&cn(e.schedule)}function bM(e){return e[e.length-1]}function rb(e){return cn(bM(e))?e.pop():void 0}function Ny(e){return $N(bM(e))?e.pop():void 0}function Qt(...e){return Qo(e,Ny(e))}const ob=Ws(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:gH}=Array,{getPrototypeOf:mH,prototype:_H,keys:yH}=Object;const{isArray:bH}=Array;function wM(e){return wn(t=>function wH(e,t){return bH(t)?e(...t):e(t)}(e,t))}function WN(...e){const t=Ny(e),n=rb(e),{args:i,keys:r}=function HN(e){if(1===e.length){const t=e[0];if(gH(t))return{args:t,keys:null};if(function vH(e){return e&&"object"==typeof e&&mH(e)===_H}(t)){const n=yH(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}(e);if(0===i.length)return Qo([],t);const a=new qt(function xH(e,t,n=Un){return i=>{ZN(t,()=>{const{length:r}=e,a=new Array(r);let h=r,d=r;for(let _=0;_<r;_++)ZN(t,()=>{const S=Qo(e[_],t);let D=!1;S.subscribe(di(i,A=>{a[_]=A,D||(D=!0,d--),d||i.next(n(a.slice()))},()=>{--h||i.complete()}))},i)},i)}}(i,t,r?h=>function qN(e,t){return e.reduce((n,i,r)=>(n[i]=t[r],n),{})}(r,h):Un));return n?a.pipe(wM(n)):a}function ZN(e,t,n){e?kh(n,e,t):t()}function Jo(e,t,n=1/0){return cn(t)?Jo((i,r)=>wn((a,h)=>t(i,a,r,h))(Xo(e(i,r))),n):("number"==typeof t&&(n=t),Nr((i,r)=>function SH(e,t,n,i,r,a,h,d){const _=[];let S=0,D=0,A=!1;const F=()=>{A&&!_.length&&!S&&t.complete()},k=Y=>S<i?G(Y):_.push(Y),G=Y=>{a&&t.next(Y),S++;let ne=!1;Xo(n(Y,D++)).subscribe(di(t,fe=>{r?.(fe),a?k(fe):t.next(fe)},()=>{ne=!0},void 0,()=>{if(ne)try{for(S--;_.length&&S<i;){const fe=_.shift();h?kh(t,h,()=>G(fe)):G(fe)}F()}catch(fe){t.error(fe)}}))};return e.subscribe(di(t,k,()=>{A=!0,F()})),()=>{d?.()}}(i,r,e,n)))}function ky(...e){return function EH(){return function sb(e=1/0){return Jo(Un,e)}(1)}()(Qo(e,Ny(e)))}function xM(e){return new qt(t=>{Xo(e()).subscribe(t)})}function ab(e,t){const n=cn(e)?e:()=>e,i=r=>r.error(n());return new qt(t?r=>t.schedule(i,0,r):i)}const va=new qt(e=>e.complete());function SM(){return Nr((e,t)=>{let n=null;e._refCount++;const i=di(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,a=n;n=null,r&&(!a||r===a)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class KN extends qt{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Gp(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Si;const n=this.getSubject();t.add(this.source.subscribe(di(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Si.EMPTY)}return t}refCount(){return SM()(this)}}function il(e,t){return Nr((n,i)=>{let r=null,a=0,h=!1;const d=()=>h&&!r&&i.complete();n.subscribe(di(i,_=>{r?.unsubscribe();let S=0;const D=a++;Xo(e(_,D)).subscribe(r=di(i,A=>i.next(t?t(_,A,D,S++):A),()=>{r=null,d()}))},()=>{h=!0,d()}))})}function kl(e){return e<=0?()=>va:Nr((t,n)=>{let i=0;t.subscribe(di(n,r=>{++i<=e&&(n.next(r),e<=i&&n.complete())}))})}function Ao(e,t){return Nr((n,i)=>{let r=0;n.subscribe(di(i,a=>e.call(t,a,r++)&&i.next(a)))})}function lb(e){return Nr((t,n)=>{let i=!1;t.subscribe(di(n,r=>{i=!0,n.next(r)},()=>{i||n.next(e),n.complete()}))})}function XN(e=DH){return Nr((t,n)=>{let i=!1;t.subscribe(di(n,r=>{i=!0,n.next(r)},()=>i?n.complete():n.error(e())))})}function DH(){return new ob}function ip(e,t){const n=arguments.length>=2;return i=>i.pipe(e?Ao((r,a)=>e(r,a,i)):Un,kl(1),n?lb(t):XN(()=>new ob))}function cb(e,t){return cn(t)?Jo(e,t,1):Jo(e,1)}function Po(e,t,n){const i=cn(e)||t||n?{next:e,error:t,complete:n}:e;return i?Nr((r,a)=>{var h;null===(h=i.subscribe)||void 0===h||h.call(i);let d=!0;r.subscribe(di(a,_=>{var S;null===(S=i.next)||void 0===S||S.call(i,_),a.next(_)},()=>{var _;d=!1,null===(_=i.complete)||void 0===_||_.call(i),a.complete()},_=>{var S;d=!1,null===(S=i.error)||void 0===S||S.call(i,_),a.error(_)},()=>{var _,S;d&&(null===(_=i.unsubscribe)||void 0===_||_.call(i)),null===(S=i.finalize)||void 0===S||S.call(i)}))}):Un}function Zg(e){return Nr((t,n)=>{let a,i=null,r=!1;i=t.subscribe(di(n,void 0,void 0,h=>{a=Xo(e(h,Zg(e)(t))),i?(i.unsubscribe(),i=null,a.subscribe(n)):r=!0})),r&&(i.unsubscribe(),i=null,a.subscribe(n))})}function EM(e){return e<=0?()=>va:Nr((t,n)=>{let i=[];t.subscribe(di(n,r=>{i.push(r),e<i.length&&i.shift()},()=>{for(const r of i)n.next(r);n.complete()},void 0,()=>{i=null}))})}function MM(e){return Nr((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}function Ro(e){return Nr((t,n)=>{Xo(e).subscribe(di(n,()=>n.complete(),X)),!n.closed&&t.subscribe(n)})}let AH=(()=>{class e{_doc;constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static \u0275fac=function(i){return new(i||e)(Ft(ke))};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const gn="primary",Fy=Symbol("RouteTitle");class kH{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Kg(e){return new kH(e)}function OH(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const r={};for(let a=0;a<i.length;a++){const h=i[a],d=e[a];if(":"===h[0])r[h.substring(1)]=d;else if(h!==d.path)return null}return{consumed:e.slice(0,i.length),posParams:r}}function zu(e,t){const n=e?DM(e):void 0,i=t?DM(t):void 0;if(!n||!i||n.length!=i.length)return!1;let r;for(let a=0;a<n.length;a++)if(r=n[a],!ek(e[r],t[r]))return!1;return!0}function DM(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function ek(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((r,a)=>i[a]===r)}return e===t}function tk(e){return e.length>0?e[e.length-1]:null}function Oh(e){return function T7(e){return!!e&&(e instanceof qt||cn(e.lift)&&cn(e.subscribe))}(e)?e:fy(e)?Qo(Promise.resolve(e)):Qt(e)}const LH={exact:function rk(e,t,n){if(!op(e.segments,t.segments)||!ub(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!rk(e.children[i],t.children[i],n))return!1;return!0},subset:ok},nk={exact:function BH(e,t){return zu(e,t)},subset:function zH(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>ek(e[n],t[n]))},ignored:()=>!0};function ik(e,t,n){return LH[n.paths](e.root,t.root,n.matrixParams)&&nk[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function ok(e,t,n){return sk(e,t,t.segments,n)}function sk(e,t,n,i){if(e.segments.length>n.length){const r=e.segments.slice(0,n.length);return!(!op(r,n)||t.hasChildren()||!ub(r,n,i))}if(e.segments.length===n.length){if(!op(e.segments,n)||!ub(e.segments,n,i))return!1;for(const r in t.children)if(!e.children[r]||!ok(e.children[r],t.children[r],i))return!1;return!0}{const r=n.slice(0,e.segments.length),a=n.slice(e.segments.length);return!!(op(e.segments,r)&&ub(e.segments,r,i)&&e.children[gn])&&sk(e.children[gn],t,a,i)}}function ub(e,t,n){return t.every((i,r)=>nk[n](e[r].parameters,i.parameters))}class rp{root;queryParams;fragment;_queryParamMap;constructor(t=new xi([],{}),n={},i=null){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap??=Kg(this.queryParams),this._queryParamMap}toString(){return UH.serialize(this)}}class xi{segments;children;parent=null;constructor(t,n){this.segments=t,this.children=n,Object.values(n).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return fb(this)}}class Ly{path;parameters;_parameterMap;constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap??=Kg(this.parameters),this._parameterMap}toString(){return ck(this)}}function op(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}let hb=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>new db,providedIn:"root"})}return e})();class db{parse(t){const n=new JH(t);return new rp(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${By(t.root,!0)}`,i=function HH(e){const t=Object.entries(e).map(([n,i])=>Array.isArray(i)?i.map(r=>`${pb(n)}=${pb(r)}`).join("&"):`${pb(n)}=${pb(i)}`).filter(n=>n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function GH(e){return encodeURI(e)}(t.fragment)}`:""}`}}const UH=new db;function fb(e){return e.segments.map(t=>ck(t)).join("/")}function By(e,t){if(!e.hasChildren())return fb(e);if(t){const n=e.children[gn]?By(e.children[gn],!1):"",i=[];return Object.entries(e.children).forEach(([r,a])=>{r!==gn&&i.push(`${r}:${By(a,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function VH(e,t){let n=[];return Object.entries(e.children).forEach(([i,r])=>{i===gn&&(n=n.concat(t(r,i)))}),Object.entries(e.children).forEach(([i,r])=>{i!==gn&&(n=n.concat(t(r,i)))}),n}(e,(i,r)=>r===gn?[By(e.children[gn],!1)]:[`${r}:${By(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[gn]?`${fb(e)}/${n[0]}`:`${fb(e)}/(${n.join("//")})`}}function ak(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function pb(e){return ak(e).replace(/%3B/gi,";")}function CM(e){return ak(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function gb(e){return decodeURIComponent(e)}function lk(e){return gb(e.replace(/\+/g,"%20"))}function ck(e){return`${CM(e.path)}${function $H(e){return Object.entries(e).map(([t,n])=>`;${CM(t)}=${CM(n)}`).join("")}(e.parameters)}`}const qH=/^[^\/()?;#]+/;function TM(e){const t=e.match(qH);return t?t[0]:""}const WH=/^[^\/()?;=#]+/,KH=/^[^=?&#]+/,XH=/^[^&#]+/;class JH{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new xi([],{}):new xi([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[gn]=new xi(t,n)),i}parseSegment(){const t=TM(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Te(4009,!1);return this.capture(t),new Ly(gb(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function ZH(e){const t=e.match(WH);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const r=TM(this.remaining);r&&(i=r,this.capture(i))}t[gb(n)]=gb(i)}parseQueryParam(t){const n=function YH(e){const t=e.match(KH);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const h=function QH(e){const t=e.match(XH);return t?t[0]:""}(this.remaining);h&&(i=h,this.capture(i))}const r=lk(n),a=lk(i);if(t.hasOwnProperty(r)){let h=t[r];Array.isArray(h)||(h=[h],t[r]=h),h.push(a)}else t[r]=a}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=TM(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Te(4010,!1);let a;i.indexOf(":")>-1?(a=i.slice(0,i.indexOf(":")),this.capture(a),this.capture(":")):t&&(a=gn);const h=this.parseChildren();n[a]=1===Object.keys(h).length?h[gn]:new xi([],h),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Te(4011,!1)}}function uk(e){return e.segments.length>0?new xi([],{[gn]:e}):e}function hk(e){const t={};for(const[i,r]of Object.entries(e.children)){const a=hk(r);if(i===gn&&0===a.segments.length&&a.hasChildren())for(const[h,d]of Object.entries(a.children))t[h]=d;else(a.segments.length>0||a.hasChildren())&&(t[i]=a)}return function e9(e){if(1===e.numberOfChildren&&e.children[gn]){const t=e.children[gn];return new xi(e.segments.concat(t.segments),t.children)}return e}(new xi(e.segments,t))}function sp(e){return e instanceof rp}function dk(e){let t;const r=uk(function n(a){const h={};for(const _ of a.children){const S=n(_);h[_.outlet]=S}const d=new xi(a.url,h);return a===e&&(t=d),d}(e.root));return t??r}function fk(e,t,n,i){let r=e;for(;r.parent;)r=r.parent;if(0===t.length)return IM(r,r,r,n,i);const a=function n9(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new gk(!0,0,e);let t=0,n=!1;const i=e.reduce((r,a,h)=>{if("object"==typeof a&&null!=a){if(a.outlets){const d={};return Object.entries(a.outlets).forEach(([_,S])=>{d[_]="string"==typeof S?S.split("/"):S}),[...r,{outlets:d}]}if(a.segmentPath)return[...r,a.segmentPath]}return"string"!=typeof a?[...r,a]:0===h?(a.split("/").forEach((d,_)=>{0==_&&"."===d||(0==_&&""===d?n=!0:".."===d?t++:""!=d&&r.push(d))}),r):[...r,a]},[]);return new gk(n,t,i)}(t);if(a.toRoot())return IM(r,r,new xi([],{}),n,i);const h=function i9(e,t,n){if(e.isAbsolute)return new _b(t,!0,0);if(!n)return new _b(t,!1,NaN);if(null===n.parent)return new _b(n,!0,0);const i=mb(e.commands[0])?0:1;return function r9(e,t,n){let i=e,r=t,a=n;for(;a>r;){if(a-=r,i=i.parent,!i)throw new Te(4005,!1);r=i.segments.length}return new _b(i,!1,r-a)}(n,n.segments.length-1+i,e.numberOfDoubleDots)}(a,r,e),d=h.processChildren?jy(h.segmentGroup,h.index,a.commands):mk(h.segmentGroup,h.index,a.commands);return IM(r,h.segmentGroup,d,n,i)}function mb(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function zy(e){return"object"==typeof e&&null!=e&&e.outlets}function IM(e,t,n,i,r){let h,a={};i&&Object.entries(i).forEach(([_,S])=>{a[_]=Array.isArray(S)?S.map(D=>`${D}`):`${S}`}),h=e===t?n:pk(e,t,n);const d=uk(hk(h));return new rp(d,a,r)}function pk(e,t,n){const i={};return Object.entries(e.children).forEach(([r,a])=>{i[r]=a===t?n:pk(a,t,n)}),new xi(e.segments,i)}class gk{isAbsolute;numberOfDoubleDots;commands;constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&mb(i[0]))throw new Te(4003,!1);const r=i.find(zy);if(r&&r!==tk(i))throw new Te(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class _b{segmentGroup;processChildren;index;constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function mk(e,t,n){if(e??=new xi([],{}),0===e.segments.length&&e.hasChildren())return jy(e,t,n);const i=function s9(e,t,n){let i=0,r=t;const a={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(i>=n.length)return a;const h=e.segments[r],d=n[i];if(zy(d))break;const _=`${d}`,S=i<n.length-1?n[i+1]:null;if(r>0&&void 0===_)break;if(_&&S&&"object"==typeof S&&void 0===S.outlets){if(!yk(_,S,h))return a;i+=2}else{if(!yk(_,{},h))return a;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(e,t,n),r=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const a=new xi(e.segments.slice(0,i.pathIndex),{});return a.children[gn]=new xi(e.segments.slice(i.pathIndex),e.children),jy(a,0,r)}return i.match&&0===r.length?new xi(e.segments,{}):i.match&&!e.hasChildren()?AM(e,t,n):i.match?jy(e,0,r):AM(e,t,n)}function jy(e,t,n){if(0===n.length)return new xi(e.segments,{});{const i=function o9(e){return zy(e[0])?e[0].outlets:{[gn]:e}}(n),r={};if(Object.keys(i).some(a=>a!==gn)&&e.children[gn]&&1===e.numberOfChildren&&0===e.children[gn].segments.length){const a=jy(e.children[gn],t,n);return new xi(e.segments,a.children)}return Object.entries(i).forEach(([a,h])=>{"string"==typeof h&&(h=[h]),null!==h&&(r[a]=mk(e.children[a],t,h))}),Object.entries(e.children).forEach(([a,h])=>{void 0===i[a]&&(r[a]=h)}),new xi(e.segments,r)}}function AM(e,t,n){const i=e.segments.slice(0,t);let r=0;for(;r<n.length;){const a=n[r];if(zy(a)){const _=a9(a.outlets);return new xi(i,_)}if(0===r&&mb(n[0])){i.push(new Ly(e.segments[t].path,_k(n[0]))),r++;continue}const h=zy(a)?a.outlets[gn]:`${a}`,d=r<n.length-1?n[r+1]:null;h&&d&&mb(d)?(i.push(new Ly(h,_k(d))),r+=2):(i.push(new Ly(h,{})),r++)}return new xi(i,{})}function a9(e){const t={};return Object.entries(e).forEach(([n,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(t[n]=AM(new xi([],{}),0,i))}),t}function _k(e){const t={};return Object.entries(e).forEach(([n,i])=>t[n]=`${i}`),t}function yk(e,t,n){return e==n.path&&zu(t,n.parameters)}const yb="imperative";var On=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(On||{});class ju{id;url;constructor(t,n){this.id=t,this.url=n}}class PM extends ju{type=On.NavigationStart;navigationTrigger;restoredState;constructor(t,n,i="imperative",r=null){super(t,n),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ap extends ju{urlAfterRedirects;type=On.NavigationEnd;constructor(t,n,i){super(t,n),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var ba=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e[e.Aborted=4]="Aborted",e}(ba||{}),RM=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(RM||{});class lp extends ju{reason;code;type=On.NavigationCancel;constructor(t,n,i,r){super(t,n),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Vy extends ju{reason;code;type=On.NavigationSkipped;constructor(t,n,i,r){super(t,n),this.reason=i,this.code=r}}class NM extends ju{error;target;type=On.NavigationError;constructor(t,n,i,r){super(t,n),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class vk extends ju{urlAfterRedirects;state;type=On.RoutesRecognized;constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class l9 extends ju{urlAfterRedirects;state;type=On.GuardsCheckStart;constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class c9 extends ju{urlAfterRedirects;state;shouldActivate;type=On.GuardsCheckEnd;constructor(t,n,i,r,a){super(t,n),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=a}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class u9 extends ju{urlAfterRedirects;state;type=On.ResolveStart;constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class h9 extends ju{urlAfterRedirects;state;type=On.ResolveEnd;constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class d9{route;type=On.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class f9{route;type=On.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class p9{snapshot;type=On.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class g9{snapshot;type=On.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class m9{snapshot;type=On.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _9{snapshot;type=On.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kM{}class vb{url;navigationBehaviorOptions;constructor(t,n){this.url=t,this.navigationBehaviorOptions=n}}function Cc(e){return e.outlet||gn}function Yg(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class E9{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Yg(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new Uy(this.rootInjector)}}let Uy=(()=>{class e{rootInjector;contexts=new Map;constructor(n){this.rootInjector=n}onChildOutletCreated(n,i){const r=this.getOrCreateContext(n);r.outlet=i,this.contexts.set(n,r)}onChildOutletDestroyed(n){const i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new E9(this.rootInjector),this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}static \u0275fac=function(i){return new(i||e)(Ft(sr))};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class bk{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=OM(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=OM(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=FM(t,this._root);return n.length<2?[]:n[n.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return FM(t,this._root).map(n=>n.value)}}function OM(e,t){if(e===t.value)return t;for(const n of t.children){const i=OM(e,n);if(i)return i}return null}function FM(e,t){if(e===t.value)return[t];for(const n of t.children){const i=FM(e,n);if(i.length)return i.unshift(t),i}return[]}class Tc{value;children;constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Xg(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class wk extends bk{snapshot;constructor(t,n){super(t),this.snapshot=n,LM(this,t)}toString(){return this.snapshot.toString()}}function xk(e){const t=function M9(e){const a=new wb([],{},{},"",{},gn,e,null,{});return new Sk("",new Tc(a,[]))}(e),n=new Pt([new Ly("",{})]),i=new Pt({}),r=new Pt({}),a=new Pt({}),h=new Pt(""),d=new Qg(n,i,a,h,r,gn,e,t.root);return d.snapshot=t.root,new wk(new Tc(d,[]),t)}class Qg{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,n,i,r,a,h,d,_){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=a,this.outlet=h,this.component=d,this._futureSnapshot=_,this.title=this.dataSubject?.pipe(wn(S=>S[Fy]))??Qt(void 0),this.url=t,this.params=n,this.queryParams=i,this.fragment=r,this.data=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(wn(t=>Kg(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(wn(t=>Kg(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function bb(e,t,n="emptyOnly"){let i;const{routeConfig:r}=e;return i=null===t||"always"!==n&&""!==r?.path&&(t.component||t.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...t.params,...e.params},data:{...t.data,...e.data},resolve:{...e.data,...t.data,...r?.data,...e._resolvedData}},r&&Mk(r)&&(i.resolve[Fy]=r.title),i}class wb{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Fy]}constructor(t,n,i,r,a,h,d,_,S){this.url=t,this.params=n,this.queryParams=i,this.fragment=r,this.data=a,this.outlet=h,this.component=d,this.routeConfig=_,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Kg(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Kg(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Sk extends bk{url;constructor(t,n){super(n),this.url=t,LM(this,n)}toString(){return Ek(this._root)}}function LM(e,t){t.value._routerState=e,t.children.forEach(n=>LM(e,n))}function Ek(e){const t=e.children.length>0?` { ${e.children.map(Ek).join(", ")} } `:"";return`${e.value}${t}`}function BM(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,zu(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),zu(t.params,n.params)||e.paramsSubject.next(n.params),function FH(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!zu(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),zu(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function zM(e,t){const n=zu(e.params,t.params)&&function jH(e,t){return op(e,t)&&e.every((n,i)=>zu(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||zM(e.parent,t.parent))}function Mk(e){return"string"==typeof e.title||null===e.title}const D9=new $e("");let Dk=(()=>{class e{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=gn;activateEvents=new Zt;deactivateEvents=new Zt;attachEvents=new Zt;detachEvents=new Zt;routerOutletData=gG(void 0);parentContexts=me(Uy);location=me(el);changeDetector=me(nl);inputBinder=me(jM,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(n){if(n.name){const{firstChange:i,previousValue:r}=n.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Te(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Te(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Te(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Te(4013,!1);this._activatedRoute=n;const r=this.location,h=n.snapshot.component,d=this.parentContexts.getOrCreateContext(this.name).children,_=new C9(n,d,r.injector,this.routerOutletData);this.activated=r.createComponent(h,{index:r.length,injector:_,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||e)};static \u0275dir=lt({type:e,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[fo]})}return e})();class C9{route;childContexts;parent;outletData;constructor(t,n,i,r){this.route=t,this.childContexts=n,this.parent=i,this.outletData=r}get(t,n){return t===Qg?this.route:t===Uy?this.childContexts:t===D9?this.outletData:this.parent.get(t,n)}}const jM=new $e("");let Ck=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275cmp=pa({type:e,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){1&i&&tl(0,"router-outlet")},dependencies:[Dk],encapsulation:2})}return e})();function VM(e){const t=e.children&&e.children.map(VM),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==gn&&(n.component=Ck),n}function Gy(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const r=function I9(e,t,n){return t.children.map(i=>{for(const r of n.children)if(e.shouldReuseRoute(i.value,r.value.snapshot))return Gy(e,i,r);return Gy(e,i)})}(e,t,n);return new Tc(i,r)}{if(e.shouldAttach(t.value)){const a=e.retrieve(t.value);if(null!==a){const h=a.route;return h.value._futureSnapshot=t.value,h.children=t.children.map(d=>Gy(e,d)),h}}const i=function A9(e){return new Qg(new Pt(e.url),new Pt(e.params),new Pt(e.queryParams),new Pt(e.fragment),new Pt(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(a=>Gy(e,a));return new Tc(i,r)}}class UM{redirectTo;navigationBehaviorOptions;constructor(t,n){this.redirectTo=t,this.navigationBehaviorOptions=n}}const Tk="ngNavigationCancelingError";function xb(e,t){const{redirectTo:n,navigationBehaviorOptions:i}=sp(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=Ik(!1,ba.Redirect);return r.url=n,r.navigationBehaviorOptions=i,r}function Ik(e,t){const n=new Error(`NavigationCancelingError: ${e||""}`);return n[Tk]=!0,n.cancellationCode=t,n}function Ak(e){return!!e&&e[Tk]}class N9{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,n,i,r,a){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=a}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),BM(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const r=Xg(n);t.children.forEach(a=>{const h=a.value.outlet;this.deactivateRoutes(a,r[h],i),delete r[h]}),Object.values(r).forEach(a=>{this.deactivateRouteAndItsChildren(a,i)})}deactivateRoutes(t,n,i){const r=t.value,a=n?n.value:null;if(r===a)if(r.component){const h=i.getContext(r.outlet);h&&this.deactivateChildRoutes(t,n,h.children)}else this.deactivateChildRoutes(t,n,i);else a&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),r=i&&t.value.component?i.children:n,a=Xg(t);for(const h of Object.values(a))this.deactivateRouteAndItsChildren(h,r);if(i&&i.outlet){const h=i.outlet.detach(),d=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:h,route:t,contexts:d})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),r=i&&t.value.component?i.children:n,a=Xg(t);for(const h of Object.values(a))this.deactivateRouteAndItsChildren(h,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,n,i){const r=Xg(n);t.children.forEach(a=>{this.activateRoutes(a,r[a.value.outlet],i),this.forwardEvent(new _9(a.value.snapshot))}),t.children.length&&this.forwardEvent(new g9(t.value.snapshot))}activateRoutes(t,n,i){const r=t.value,a=n?n.value:null;if(BM(r),r===a)if(r.component){const h=i.getOrCreateContext(r.outlet);this.activateChildRoutes(t,n,h.children)}else this.activateChildRoutes(t,n,i);else if(r.component){const h=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const d=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),h.children.onOutletReAttached(d.contexts),h.attachRef=d.componentRef,h.route=d.route.value,h.outlet&&h.outlet.attach(d.componentRef,d.route.value),BM(d.route.value),this.activateChildRoutes(t,null,h.children)}else h.attachRef=null,h.route=r,h.outlet&&h.outlet.activateWith(r,h.injector),this.activateChildRoutes(t,null,h.children)}else this.activateChildRoutes(t,null,i)}}class Pk{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Sb{component;route;constructor(t,n){this.component=t,this.route=n}}function k9(e,t,n){const i=e._root;return $y(i,t?t._root:null,n,[i.value])}function Jg(e,t){const n=Symbol(),i=t.get(e,n);return i===n?"function"!=typeof e||function Pa(e){return null!==Ms(e)}(e)?t.get(e):e:i}function $y(e,t,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const a=Xg(t);return e.children.forEach(h=>{(function F9(e,t,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const a=e.value,h=t?t.value:null,d=n?n.getContext(e.value.outlet):null;if(h&&a.routeConfig===h.routeConfig){const _=function L9(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!op(e.url,t.url);case"pathParamsOrQueryParamsChange":return!op(e.url,t.url)||!zu(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!zM(e,t)||!zu(e.queryParams,t.queryParams);default:return!zM(e,t)}}(h,a,a.routeConfig.runGuardsAndResolvers);_?r.canActivateChecks.push(new Pk(i)):(a.data=h.data,a._resolvedData=h._resolvedData),$y(e,t,a.component?d?d.children:null:n,i,r),_&&d&&d.outlet&&d.outlet.isActivated&&r.canDeactivateChecks.push(new Sb(d.outlet.component,h))}else h&&Hy(t,d,r),r.canActivateChecks.push(new Pk(i)),$y(e,null,a.component?d?d.children:null:n,i,r)})(h,a[h.value.outlet],n,i.concat([h.value]),r),delete a[h.value.outlet]}),Object.entries(a).forEach(([h,d])=>Hy(d,n.getContext(h),r)),r}function Hy(e,t,n){const i=Xg(e),r=e.value;Object.entries(i).forEach(([a,h])=>{Hy(h,r.component?t?t.children.getContext(a):null:t,n)}),n.canDeactivateChecks.push(new Sb(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function qy(e){return"function"==typeof e}function Rk(e){return e instanceof ob||"EmptyError"===e?.name}const Eb=Symbol("INITIAL_VALUE");function em(){return il(e=>WN(e.map(t=>t.pipe(kl(1),function YN(...e){const t=Ny(e);return Nr((n,i)=>{(t?ky(e,n,t):ky(e,n)).subscribe(i)})}(Eb)))).pipe(wn(t=>{for(const n of t)if(!0!==n){if(n===Eb)return Eb;if(!1===n||$9(n))return n}return!0}),Ao(t=>t!==Eb),kl(1)))}function $9(e){return sp(e)||e instanceof UM}function Nk(e){return function rn(...e){return hn(e)}(Po(t=>{if("boolean"!=typeof t)throw xb(0,t)}),wn(t=>!0===t))}class GM{segmentGroup;constructor(t){this.segmentGroup=t||null}}class $M extends Error{urlTree;constructor(t){super(),this.urlTree=t}}function tm(e){return ab(new GM(e))}function tq(e){return ab(new Te(4e3,!1))}class iq{urlSerializer;urlTree;constructor(t,n){this.urlSerializer=t,this.urlTree=n}lineralizeSegments(t,n){let i=[],r=n.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Qt(i);if(r.numberOfChildren>1||!r.children[gn])return tq();r=r.children[gn]}}applyRedirectCommands(t,n,i,r,a){return function rq(e,t,n){if("string"==typeof e)return Qt(e);const i=e,{queryParams:r,fragment:a,routeConfig:h,url:d,outlet:_,params:S,data:D,title:A}=t;return Oh(Yr(n,()=>i({params:S,data:D,queryParams:r,fragment:a,routeConfig:h,url:d,outlet:_,title:A})))}(n,r,a).pipe(wn(h=>{if(h instanceof rp)throw new $M(h);const d=this.applyRedirectCreateUrlTree(h,this.urlSerializer.parse(h),t,i);if("/"===h[0])throw new $M(d);return d}))}applyRedirectCreateUrlTree(t,n,i,r){const a=this.createSegmentGroup(t,n.root,i,r);return new rp(a,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return Object.entries(t).forEach(([r,a])=>{if("string"==typeof a&&":"===a[0]){const d=a.substring(1);i[r]=n[d]}else i[r]=a}),i}createSegmentGroup(t,n,i,r){const a=this.createSegments(t,n.segments,i,r);let h={};return Object.entries(n.children).forEach(([d,_])=>{h[d]=this.createSegmentGroup(t,_,i,r)}),new xi(a,h)}createSegments(t,n,i,r){return n.map(a=>":"===a.path[0]?this.findPosParam(t,a,r):this.findOrReturn(a,i))}findPosParam(t,n,i){const r=i[n.path.substring(1)];if(!r)throw new Te(4001,!1);return r}findOrReturn(t,n){let i=0;for(const r of n){if(r.path===t.path)return n.splice(i),r;i++}return t}}const HM={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function oq(e,t,n,i,r){const a=kk(e,t,n);return a.matched?(i=function v9(e,t){return e.providers&&!e._injector&&(e._injector=US(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,i),function eq(e,t,n,i){const r=t.canMatch;return r&&0!==r.length?Qt(r.map(h=>{const d=Jg(h,e);return Oh(function G9(e){return e&&qy(e.canMatch)}(d)?d.canMatch(t,n):Yr(e,()=>d(t,n)))})).pipe(em(),Nk()):Qt(!0)}(i,t,n).pipe(wn(h=>!0===h?a:{...HM}))):Qt(a)}function kk(e,t,n){if("**"===t.path)return function sq(e){return{matched:!0,parameters:e.length>0?tk(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(n);if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...HM}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const r=(t.matcher||OH)(n,e,t);if(!r)return{...HM};const a={};Object.entries(r.posParams??{}).forEach(([d,_])=>{a[d]=_.path});const h=r.consumed.length>0?{...a,...r.consumed[r.consumed.length-1].parameters}:a;return{matched:!0,consumedSegments:r.consumed,remainingSegments:n.slice(r.consumed.length),parameters:h,positionalParamSegments:r.posParams??{}}}function Ok(e,t,n,i){return n.length>0&&function cq(e,t,n){return n.some(i=>Mb(e,t,i)&&Cc(i)!==gn)}(e,n,i)?{segmentGroup:new xi(t,lq(i,new xi(n,e.children))),slicedSegments:[]}:0===n.length&&function uq(e,t,n){return n.some(i=>Mb(e,t,i))}(e,n,i)?{segmentGroup:new xi(e.segments,aq(e,n,i,e.children)),slicedSegments:n}:{segmentGroup:new xi(e.segments,e.children),slicedSegments:n}}function aq(e,t,n,i){const r={};for(const a of n)if(Mb(e,t,a)&&!i[Cc(a)]){const h=new xi([],{});r[Cc(a)]=h}return{...i,...r}}function lq(e,t){const n={};n[gn]=t;for(const i of e)if(""===i.path&&Cc(i)!==gn){const r=new xi([],{});n[Cc(i)]=r}return n}function Mb(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class dq{}class gq{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,n,i,r,a,h,d){this.injector=t,this.configLoader=n,this.rootComponentType=i,this.config=r,this.urlTree=a,this.paramsInheritanceStrategy=h,this.urlSerializer=d,this.applyRedirects=new iq(this.urlSerializer,this.urlTree)}noMatchError(t){return new Te(4002,`'${t.segmentGroup}'`)}recognize(){const t=Ok(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(wn(({children:n,rootSnapshot:i})=>{const r=new Tc(i,n),a=new Sk("",r),h=function t9(e,t,n=null,i=null){return fk(dk(e),t,n,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return h.queryParams=this.urlTree.queryParams,a.url=this.urlSerializer.serialize(h),{state:a,tree:h}}))}match(t){const n=new wb([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),gn,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,gn,n).pipe(wn(i=>({children:i,rootSnapshot:n})),Zg(i=>{if(i instanceof $M)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof GM?this.noMatchError(i):i}))}processSegmentGroup(t,n,i,r,a){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,n,i,a):this.processSegment(t,n,i,i.segments,r,!0,a).pipe(wn(h=>h instanceof Tc?[h]:[]))}processChildren(t,n,i,r){const a=[];for(const h of Object.keys(i.children))"primary"===h?a.unshift(h):a.push(h);return Qo(a).pipe(cb(h=>{const d=i.children[h],_=function S9(e,t){const n=e.filter(i=>Cc(i)===t);return n.push(...e.filter(i=>Cc(i)!==t)),n}(n,h);return this.processSegmentGroup(t,_,d,h,r)}),function TH(e,t){return Nr(function CH(e,t,n,i,r){return(a,h)=>{let d=n,_=t,S=0;a.subscribe(di(h,D=>{const A=S++;_=d?e(_,D,A):(d=!0,D),i&&h.next(_)},r&&(()=>{d&&h.next(_),h.complete()})))}}(e,t,arguments.length>=2,!0))}((h,d)=>(h.push(...d),h)),lb(null),function IH(e,t){const n=arguments.length>=2;return i=>i.pipe(e?Ao((r,a)=>e(r,a,i)):Un,EM(1),n?lb(t):XN(()=>new ob))}(),Jo(h=>{if(null===h)return tm(i);const d=Fk(h);return function mq(e){e.sort((t,n)=>t.value.outlet===gn?-1:n.value.outlet===gn?1:t.value.outlet.localeCompare(n.value.outlet))}(d),Qt(d)}))}processSegment(t,n,i,r,a,h,d){return Qo(n).pipe(cb(_=>this.processSegmentAgainstRoute(_._injector??t,n,_,i,r,a,h,d).pipe(Zg(S=>{if(S instanceof GM)return Qt(null);throw S}))),ip(_=>!!_),Zg(_=>{if(Rk(_))return function hq(e,t,n){return 0===t.length&&!e.children[n]}(i,r,a)?Qt(new dq):tm(i);throw _}))}processSegmentAgainstRoute(t,n,i,r,a,h,d,_){return Cc(i)===h||h!==gn&&Mb(r,a,i)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,r,i,a,h,_):this.allowRedirects&&d?this.expandSegmentAgainstRouteUsingRedirect(t,r,n,i,a,h,_):tm(r):tm(r)}expandSegmentAgainstRouteUsingRedirect(t,n,i,r,a,h,d){const{matched:_,parameters:S,consumedSegments:D,positionalParamSegments:A,remainingSegments:F}=kk(n,r,a);if(!_)return tm(n);"string"==typeof r.redirectTo&&"/"===r.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const k=new wb(a,S,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Lk(r),Cc(r),r.component??r._loadedComponent??null,r,Bk(r)),G=bb(k,d,this.paramsInheritanceStrategy);return k.params=Object.freeze(G.params),k.data=Object.freeze(G.data),this.applyRedirects.applyRedirectCommands(D,r.redirectTo,A,k,t).pipe(il(ne=>this.applyRedirects.lineralizeSegments(r,ne)),Jo(ne=>this.processSegment(t,i,n,ne.concat(F),h,!1,d)))}matchSegmentAgainstRoute(t,n,i,r,a,h){const d=oq(n,i,r,t);return"**"===i.path&&(n.children={}),d.pipe(il(_=>_.matched?this.getChildConfig(t=i._injector??t,i,r).pipe(il(({routes:S})=>{const D=i._loadedInjector??t,{parameters:A,consumedSegments:F,remainingSegments:k}=_,G=new wb(F,A,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Lk(i),Cc(i),i.component??i._loadedComponent??null,i,Bk(i)),Y=bb(G,h,this.paramsInheritanceStrategy);G.params=Object.freeze(Y.params),G.data=Object.freeze(Y.data);const{segmentGroup:ne,slicedSegments:fe}=Ok(n,F,k,S);if(0===fe.length&&ne.hasChildren())return this.processChildren(D,S,ne,G).pipe(wn(Le=>new Tc(G,Le)));if(0===S.length&&0===fe.length)return Qt(new Tc(G,[]));const ge=Cc(i)===a;return this.processSegment(D,S,ne,fe,ge?gn:a,!0,G).pipe(wn(Le=>new Tc(G,Le instanceof Tc?[Le]:[])))})):tm(n)))}getChildConfig(t,n,i){return n.children?Qt({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Qt({routes:n._loadedRoutes,injector:n._loadedInjector}):function J9(e,t,n,i){const r=t.canLoad;return void 0===r||0===r.length?Qt(!0):Qt(r.map(h=>{const d=Jg(h,e);return Oh(function z9(e){return e&&qy(e.canLoad)}(d)?d.canLoad(t,n):Yr(e,()=>d(t,n)))})).pipe(em(),Nk())}(t,n,i).pipe(Jo(r=>r?this.configLoader.loadChildren(t,n).pipe(Po(a=>{n._loadedRoutes=a.routes,n._loadedInjector=a.injector})):function nq(){return ab(Ik(!1,ba.GuardRejected))}())):Qt({routes:[],injector:t})}}function _q(e){const t=e.value.routeConfig;return t&&""===t.path}function Fk(e){const t=[],n=new Set;for(const i of e){if(!_q(i)){t.push(i);continue}const r=t.find(a=>i.value.routeConfig===a.value.routeConfig);void 0!==r?(r.children.push(...i.children),n.add(r)):t.push(i)}for(const i of n){const r=Fk(i.children);t.push(new Tc(i.value,r))}return t.filter(i=>!n.has(i))}function Lk(e){return e.data||{}}function Bk(e){return e.resolve||{}}function zk(e){const t=e.children.map(n=>zk(n)).flat();return[e,...t]}function qM(e){return il(t=>{const n=e(t);return n?Qo(n).pipe(wn(()=>t)):Qt(t)})}let jk=(()=>{class e{buildTitle(n){let i,r=n.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(a=>a.outlet===gn);return i}getResolvedTitleForRoute(n){return n.data[Fy]}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>me(Sq),providedIn:"root"})}return e})(),Sq=(()=>{class e extends jk{title;constructor(n){super(),this.title=n}updateTitle(n){const i=this.buildTitle(n);void 0!==i&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||e)(Ft(AH))};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Db=new $e("",{providedIn:"root",factory:()=>({})}),WM=new $e("");let Vk=(()=>{class e{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=me(QU);loadComponent(n,i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return Qt(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const r=Oh(Yr(n,()=>i.loadComponent())).pipe(wn(Uk),il(Gk),Po(h=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=h}),MM(()=>{this.componentLoaders.delete(i)})),a=new KN(r,()=>new Cn).pipe(SM());return this.componentLoaders.set(i,a),a}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Qt({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const a=function Eq(e,t,n,i){return Oh(Yr(n,()=>e.loadChildren())).pipe(wn(Uk),il(Gk),Jo(r=>r instanceof u2||Array.isArray(r)?Qt(r):Qo(t.compileModuleAsync(r))),wn(r=>{i&&i(e);let a,h,d=!1;return Array.isArray(r)?(h=r,!0):(a=r.create(n).injector,h=a.get(WM,[],{optional:!0,self:!0}).flat()),{routes:h.map(VM),injector:a}}))}(i,this.compiler,n,this.onLoadEndListener).pipe(MM(()=>{this.childrenLoaders.delete(i)})),h=new KN(a,()=>new Cn).pipe(SM());return this.childrenLoaders.set(i,h),h}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Uk(e){return function Mq(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}function Gk(e){return Qt(e)}let ZM=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>me(Dq),providedIn:"root"})}return e})(),Dq=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Cq=new $e(""),Aq=new $e("");let Pq=(()=>{class e{currentNavigation=Xn(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new Cn;transitionAbortWithErrorSubject=new Cn;configLoader=me(Vk);environmentInjector=me(sr);destroyRef=me(rt);urlSerializer=me(hb);rootContexts=me(Uy);location=me(_s);inputBindingEnabled=null!==me(jM,{optional:!0});titleStrategy=me(jk);options=me(Db,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=me(ZM);createViewTransition=me(Cq,{optional:!0});navigationErrorHandler=me(Aq,{optional:!0});navigationId=0;get hasRequestedNavigation(){return 0!==this.navigationId}transitions;afterPreactivation=()=>Qt(void 0);rootComponentType=null;destroyed=!1;constructor(){this.configLoader.onLoadEndListener=r=>this.events.next(new f9(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new d9(r)),this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(n){const i=++this.navigationId;Vi(()=>{this.transitions?.next({...n,extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:i})})}setupNavigations(n){return this.transitions=new Pt(null),this.transitions.pipe(Ao(i=>null!==i),il(i=>{let r=!1;return Qt(i).pipe(il(a=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",ba.SupersededByNewNavigation),va;this.currentTransition=i,this.currentNavigation.set({id:a.id,initialUrl:a.rawUrl,extractedUrl:a.extractedUrl,targetBrowserUrl:"string"==typeof a.extras.browserUrl?this.urlSerializer.parse(a.extras.browserUrl):a.extras.browserUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null,abort:()=>a.abortController.abort()});const h=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!h&&"reload"!==(a.extras.onSameUrlNavigation??n.onSameUrlNavigation))return this.events.next(new Vy(a.id,this.urlSerializer.serialize(a.rawUrl),"",RM.IgnoredSameUrlNavigation)),a.resolve(!1),va;if(this.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return Qt(a).pipe(il(_=>(this.events.next(new PM(_.id,this.urlSerializer.serialize(_.extractedUrl),_.source,_.restoredState)),_.id!==this.navigationId?va:Promise.resolve(_))),function yq(e,t,n,i,r,a){return Jo(h=>function fq(e,t,n,i,r,a,h="emptyOnly"){return new gq(e,t,n,i,r,h,a).recognize()}(e,t,n,i,h.extractedUrl,r,a).pipe(wn(({state:d,tree:_})=>({...h,targetSnapshot:d,urlAfterRedirects:_}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),Po(_=>{i.targetSnapshot=_.targetSnapshot,i.urlAfterRedirects=_.urlAfterRedirects,this.currentNavigation.update(D=>(D.finalUrl=_.urlAfterRedirects,D));const S=new vk(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(S)}));if(h&&this.urlHandlingStrategy.shouldProcessUrl(a.currentRawUrl)){const{id:_,extractedUrl:S,source:D,restoredState:A,extras:F}=a,k=new PM(_,this.urlSerializer.serialize(S),D,A);this.events.next(k);const G=xk(this.rootComponentType).snapshot;return this.currentTransition=i={...a,targetSnapshot:G,urlAfterRedirects:S,extras:{...F,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.update(Y=>(Y.finalUrl=S,Y)),Qt(i)}return this.events.next(new Vy(a.id,this.urlSerializer.serialize(a.extractedUrl),"",RM.IgnoredByUrlHandlingStrategy)),a.resolve(!1),va}),Po(a=>{const h=new l9(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(h)}),wn(a=>(this.currentTransition=i={...a,guards:k9(a.targetSnapshot,a.currentSnapshot,this.rootContexts)},i)),function H9(e,t){return Jo(n=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:a,canDeactivateChecks:h}}=n;return 0===h.length&&0===a.length?Qt({...n,guardsResult:!0}):function q9(e,t,n,i){return Qo(e).pipe(Jo(r=>function Q9(e,t,n,i,r){const a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?Qt(a.map(d=>{const _=Yg(t)??r,S=Jg(d,_);return Oh(function U9(e){return e&&qy(e.canDeactivate)}(S)?S.canDeactivate(e,t,n,i):Yr(_,()=>S(e,t,n,i))).pipe(ip())})).pipe(em()):Qt(!0)}(r.component,r.route,n,t,i)),ip(r=>!0!==r,!0))}(h,i,r,e).pipe(Jo(d=>d&&function B9(e){return"boolean"==typeof e}(d)?function W9(e,t,n,i){return Qo(t).pipe(cb(r=>ky(function K9(e,t){return null!==e&&t&&t(new p9(e)),Qt(!0)}(r.route.parent,i),function Z9(e,t){return null!==e&&t&&t(new m9(e)),Qt(!0)}(r.route,i),function X9(e,t,n){const i=t[t.length-1],a=t.slice(0,t.length-1).reverse().map(h=>function O9(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(h)).filter(h=>null!==h).map(h=>xM(()=>Qt(h.guards.map(_=>{const S=Yg(h.node)??n,D=Jg(_,S);return Oh(function V9(e){return e&&qy(e.canActivateChild)}(D)?D.canActivateChild(i,e):Yr(S,()=>D(i,e))).pipe(ip())})).pipe(em())));return Qt(a).pipe(em())}(e,r.path,n),function Y9(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Qt(!0);const r=i.map(a=>xM(()=>{const h=Yg(t)??n,d=Jg(a,h);return Oh(function j9(e){return e&&qy(e.canActivate)}(d)?d.canActivate(t,e):Yr(h,()=>d(t,e))).pipe(ip())}));return Qt(r).pipe(em())}(e,r.route,n))),ip(r=>!0!==r,!0))}(i,a,e,t):Qt(d)),wn(d=>({...n,guardsResult:d})))})}(this.environmentInjector,a=>this.events.next(a)),Po(a=>{if(i.guardsResult=a.guardsResult,a.guardsResult&&"boolean"!=typeof a.guardsResult)throw xb(0,a.guardsResult);const h=new c9(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.events.next(h)}),Ao(a=>!!a.guardsResult||(this.cancelNavigationTransition(a,"",ba.GuardRejected),!1)),qM(a=>{if(0!==a.guards.canActivateChecks.length)return Qt(a).pipe(Po(h=>{const d=new u9(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(d)}),il(h=>{let d=!1;return Qt(h).pipe(function vq(e,t){return Jo(n=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=n;if(!r.length)return Qt(n);const a=new Set(r.map(_=>_.route)),h=new Set;for(const _ of a)if(!h.has(_))for(const S of zk(_))h.add(S);let d=0;return Qo(h).pipe(cb(_=>a.has(_)?function bq(e,t,n,i){const r=e.routeConfig,a=e._resolve;return void 0!==r?.title&&!Mk(r)&&(a[Fy]=r.title),xM(()=>(e.data=bb(e,e.parent,n).resolve,function wq(e,t,n,i){const r=DM(e);if(0===r.length)return Qt({});const a={};return Qo(r).pipe(Jo(h=>function xq(e,t,n,i){const r=Yg(t)??i,a=Jg(e,r);return Oh(a.resolve?a.resolve(t,n):Yr(r,()=>a(t,n)))}(e[h],t,n,i).pipe(ip(),Po(d=>{if(d instanceof UM)throw xb(new db,d);a[h]=d}))),EM(1),wn(()=>a),Zg(h=>Rk(h)?va:ab(h)))}(a,e,t,i).pipe(wn(h=>(e._resolvedData=h,e.data={...e.data,...h},null)))))}(_,i,e,t):(_.data=bb(_,_.parent,e).resolve,Qt(void 0))),Po(()=>d++),EM(1),Jo(_=>d===h.size?Qt(n):va))})}(this.paramsInheritanceStrategy,this.environmentInjector),Po({next:()=>d=!0,complete:()=>{d||this.cancelNavigationTransition(h,"",ba.NoDataFromResolver)}}))}),Po(h=>{const d=new h9(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(d)}))}),qM(a=>{const h=d=>{const _=[];if(d.routeConfig?.loadComponent){const S=Yg(d)??this.environmentInjector;_.push(this.configLoader.loadComponent(S,d.routeConfig).pipe(Po(D=>{d.component=D}),wn(()=>{})))}for(const S of d.children)_.push(...h(S));return _};return WN(h(a.targetSnapshot.root)).pipe(lb(null),kl(1))}),qM(()=>this.afterPreactivation()),il(()=>{const{currentSnapshot:a,targetSnapshot:h}=i,d=this.createViewTransition?.(this.environmentInjector,a.root,h.root);return d?Qo(d).pipe(wn(()=>i)):Qt(i)}),wn(a=>{const h=function T9(e,t,n){const i=Gy(e,t._root,n?n._root:void 0);return new wk(i,t)}(n.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return this.currentTransition=i={...a,targetRouterState:h},this.currentNavigation.update(d=>(d.targetRouterState=h,d)),i}),Po(()=>{this.events.next(new kM)}),((e,t,n,i)=>wn(r=>(new N9(t,r.targetRouterState,r.currentRouterState,n,i).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,a=>this.events.next(a),this.inputBindingEnabled),kl(1),Ro(new qt(a=>{const h=i.abortController.signal,d=()=>a.next();return h.addEventListener("abort",d),()=>h.removeEventListener("abort",d)}).pipe(Ao(()=>!r&&!i.targetRouterState),Po(()=>{this.cancelNavigationTransition(i,i.abortController.signal.reason+"",ba.Aborted)}))),Po({next:a=>{r=!0,this.lastSuccessfulNavigation=Vi(this.currentNavigation),this.events.next(new ap(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects))),this.titleStrategy?.updateTitle(a.targetRouterState.snapshot),a.resolve(!0)},complete:()=>{r=!0}}),Ro(this.transitionAbortWithErrorSubject.pipe(Po(a=>{throw a}))),MM(()=>{r||this.cancelNavigationTransition(i,"",ba.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),Zg(a=>{if(this.destroyed)return i.resolve(!1),va;if(r=!0,Ak(a))this.events.next(new lp(i.id,this.urlSerializer.serialize(i.extractedUrl),a.message,a.cancellationCode)),function P9(e){return Ak(e)&&sp(e.url)}(a)?this.events.next(new vb(a.url,a.navigationBehaviorOptions)):i.resolve(!1);else{const h=new NM(i.id,this.urlSerializer.serialize(i.extractedUrl),a,i.targetSnapshot??void 0);try{const d=Yr(this.environmentInjector,()=>this.navigationErrorHandler?.(h));if(!(d instanceof UM))throw this.events.next(h),a;{const{message:_,cancellationCode:S}=xb(0,d);this.events.next(new lp(i.id,this.urlSerializer.serialize(i.extractedUrl),_,S)),this.events.next(new vb(d.redirectTo,d.navigationBehaviorOptions))}}catch(d){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(d)}}return va}))}))}cancelNavigationTransition(n,i,r){const a=new lp(n.id,this.urlSerializer.serialize(n.extractedUrl),i,r);this.events.next(a),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const n=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=Vi(this.currentNavigation),r=i?.targetBrowserUrl??i?.extractedUrl;return n.toString()!==r?.toString()&&!i?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Rq(e){return e!==yb}let Nq=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>me(Oq),providedIn:"root"})}return e})();class kq{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let Oq=(()=>{class e extends kq{static \u0275fac=(()=>{let n;return function(r){return(n||(n=fi(e)))(r||e)}})();static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),$k=(()=>{class e{urlSerializer=me(hb);options=me(Db,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=me(_s);urlHandlingStrategy=me(ZM);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new rp;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:n,initialUrl:i,targetBrowserUrl:r}){const a=void 0!==n?this.urlHandlingStrategy.merge(n,i):i,h=r??a;return h instanceof rp?this.urlSerializer.serialize(h):h}commitTransition({targetRouterState:n,finalUrl:i,initialUrl:r}){i&&n?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=n):this.rawUrlTree=r}routerState=xk(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:n}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n??this.rawUrlTree)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:()=>me(Fq),providedIn:"root"})}return e})(),Fq=(()=>{class e extends $k{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(i=>{"popstate"===i.type&&setTimeout(()=>{n(i.url,i.state,"popstate")})})}handleRouterEvent(n,i){n instanceof PM?this.updateStateMemento():n instanceof Vy?this.commitTransition(i):n instanceof vk?"eager"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):n instanceof kM?(this.commitTransition(i),"deferred"===this.urlUpdateStrategy&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):n instanceof lp&&n.code!==ba.SupersededByNewNavigation&&n.code!==ba.Redirect?this.restoreHistory(i):n instanceof NM?this.restoreHistory(i,!0):n instanceof ap&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,{extras:i,id:r}){const{replaceUrl:a,state:h}=i;if(this.location.isCurrentPathEqualTo(n)||a){const d=this.browserPageId,_={...h,...this.generateNgRouterState(r,d)};this.location.replaceState(n,"",_)}else{const d={...h,...this.generateNgRouterState(r,this.browserPageId+1)};this.location.go(n,"",d)}}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const a=this.currentPageId-this.browserPageId;0!==a?this.location.historyGo(a):this.getCurrentUrlTree()===n.finalUrl&&0===a&&(this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}static \u0275fac=(()=>{let n;return function(r){return(n||(n=fi(e)))(r||e)}})();static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Bq={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zq={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let nm=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=me(W2);stateManager=me($k);options=me(Db,{optional:!0})||{};pendingTasks=me(Rr);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=me(Pq);urlSerializer=me(hb);location=me(_s);urlHandlingStrategy=me(ZM);injector=me(sr);_events=new Cn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=me(Nq);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=me(WM,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!me(jM,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Si;subscribeToNavigationEvents(){const n=this.navigationTransitions.events.subscribe(i=>{try{const r=this.navigationTransitions.currentTransition,a=Vi(this.navigationTransitions.currentNavigation);if(null!==r&&null!==a)if(this.stateManager.handleRouterEvent(i,a),i instanceof lp&&i.code!==ba.Redirect&&i.code!==ba.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof ap)this.navigated=!0;else if(i instanceof vb){const h=i.navigationBehaviorOptions,d=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),_={browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||"eager"===this.urlUpdateStrategy||Rq(r.source),...h};this.scheduleNavigation(d,yb,null,_,{resolve:r.resolve,reject:r.reject,promise:r.promise})}(function y9(e){return!(e instanceof kM||e instanceof vb)})(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),yb,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,i,r)=>{this.navigateToSyncWithBrowser(n,r,i)})}navigateToSyncWithBrowser(n,i,r){const a={replaceUrl:!0},h=r?.navigationId?r:null;if(r){const _={...r};delete _.navigationId,delete _.\u0275routerPageId,0!==Object.keys(_).length&&(a.state=_)}const d=this.parseUrl(n);this.scheduleNavigation(d,i,h,a).catch(_=>{this.disposed||this.injector.get(ln)(_)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Vi(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(VM),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,i={}){const{relativeTo:r,queryParams:a,fragment:h,queryParamsHandling:d,preserveFragment:_}=i,S=_?this.currentUrlTree.fragment:h;let A,D=null;switch(d??this.options.defaultQueryParamsHandling){case"merge":D={...this.currentUrlTree.queryParams,...a};break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=a||null}null!==D&&(D=this.removeEmptyProps(D));try{A=dk(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||"/"!==n[0][0])&&(n=[]),A=this.currentUrlTree.root}return fk(A,n,D,S??null)}navigateByUrl(n,i={skipLocationChange:!1}){const r=sp(n)?n:this.parseUrl(n),a=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(a,yb,null,i)}navigate(n,i={skipLocationChange:!1}){return function jq(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new Te(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,i){let r;if(r=!0===i?{...Bq}:!1===i?{...zq}:i,sp(n))return ik(this.currentUrlTree,n,r);const a=this.parseUrl(n);return ik(this.currentUrlTree,a,r)}removeEmptyProps(n){return Object.entries(n).reduce((i,[r,a])=>(null!=a&&(i[r]=a),i),{})}scheduleNavigation(n,i,r,a,h){if(this.disposed)return Promise.resolve(!1);let d,_,S;h?(d=h.resolve,_=h.reject,S=h.promise):S=new Promise((A,F)=>{d=A,_=F});const D=this.pendingTasks.add();return function Lq(e,t){e.events.pipe(Ao(n=>n instanceof ap||n instanceof lp||n instanceof NM||n instanceof Vy),wn(n=>n instanceof ap||n instanceof Vy?0:n instanceof lp&&(n.code===ba.Redirect||n.code===ba.SupersededByNewNavigation)?2:1),Ao(n=>2!==n),kl(1)).subscribe(()=>{t()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(D))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:a,resolve:d,reject:_,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(A=>Promise.reject(A))}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const YM=new $e("");function qk(e){return e.routerState.root}function Wk(){const e=me(Be);return t=>{const n=e.get(Fu);if(t!==n.components[0])return;const i=e.get(nm),r=e.get(Zk);1===e.get(XM)&&i.initialNavigation(),e.get(Kk,null,{optional:!0})?.setUpPreloading(),e.get(YM,null,{optional:!0})?.init(),i.resetRootComponentType(n.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const Zk=new $e("",{factory:()=>new Cn}),XM=new $e("",{providedIn:"root",factory:()=>1}),Kk=new $e("");var Kt=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(Kt||{});const Fh="*";function Xk(e){return{type:Kt.Style,styles:e,offset:null}}class Wy{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(t=0,n=0){this.totalTime=t+n}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}class Qk{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(t){this.players=t;let n=0,i=0,r=0;const a=this.players.length;0==a?queueMicrotask(()=>this._onFinish()):this.players.forEach(h=>{h.onDone(()=>{++n==a&&this._onFinish()}),h.onDestroy(()=>{++i==a&&this._onDestroy()}),h.onStart(()=>{++r==a&&this._onStart()})}),this.totalTime=this.players.reduce((h,d)=>Math.max(h,d.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const n=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,n/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((n,i)=>null===n||i.totalTime>n.totalTime?i:n,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}function Jk(e){return new Te(3e3,!1)}function sW(e){return new Te(3002,!1)}function Ud(e){switch(e.length){case 0:return new Wy;case 1:return e[0];default:return new Qk(e)}}function eO(e,t,n=new Map,i=new Map){const r=[],a=[];let h=-1,d=null;if(t.forEach(_=>{const S=_.get("offset"),D=S==h,A=D&&d||new Map;_.forEach((F,k)=>{let G=k,Y=F;if("offset"!==k)switch(G=e.normalizePropertyName(G,r),Y){case"!":Y=n.get(k);break;case Fh:Y=i.get(k);break;default:Y=e.normalizeStyleValue(k,G,Y,r)}A.set(G,Y)}),D||a.push(A),d=A,h=S}),r.length)throw function _W(){return new Te(3502,!1)}();return a}function JM(e,t,n,i){switch(t){case"start":e.onStart(()=>i(n&&eD(n,"start",e)));break;case"done":e.onDone(()=>i(n&&eD(n,"done",e)));break;case"destroy":e.onDestroy(()=>i(n&&eD(n,"destroy",e)))}}function eD(e,t,n){const a=tD(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),h=e._data;return null!=h&&(a._data=h),a}function tD(e,t,n,i,r="",a=0,h){return{element:e,triggerName:t,fromState:n,toState:i,phaseName:r,totalTime:a,disabled:!!h}}function rl(e,t,n){let i=e.get(t);return i||e.set(t,i=n),i}function tO(e){const t=e.indexOf(":");return[e.substring(1,t),e.slice(t+1)]}const IW=typeof document>"u"?null:document.documentElement;function nD(e){const t=e.parentNode||e.host||null;return t===IW?null:t}let cp=null,nO=!1;function iO(e,t){for(;t;){if(t===e)return!0;t=nD(t)}return!1}function rO(e,t,n){if(n)return Array.from(e.querySelectorAll(t));const i=e.querySelector(t);return i?[i]:[]}const sO="ng-enter",iD="ng-leave",Cb="ng-trigger",Tb=".ng-trigger",aO="ng-animating",rD=".ng-animating";function Lh(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:oD(parseFloat(t[1]),t[2])}function oD(e,t){return"s"===t?1e3*e:e}function Ib(e,t,n){return e.hasOwnProperty("duration")?e:function FW(e,t,n){let i,r=0,a="";if("string"==typeof e){const h=e.match(OW);if(null===h)return t.push(Jk()),{duration:0,delay:0,easing:""};i=oD(parseFloat(h[1]),h[2]);const d=h[3];null!=d&&(r=oD(parseFloat(d),h[4]));const _=h[5];_&&(a=_)}else i=e;if(!n){let h=!1,d=t.length;i<0&&(t.push(function Xq(){return new Te(3100,!1)}()),h=!0),r<0&&(t.push(function Qq(){return new Te(3101,!1)}()),h=!0),h&&t.splice(d,0,Jk())}return{duration:i,delay:r,easing:a}}(e,t,n)}const OW=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function Uu(e,t,n){t.forEach((i,r)=>{const a=aD(r);n&&!n.has(r)&&n.set(r,e.style[a]),e.style[a]=i})}function up(e,t){t.forEach((n,i)=>{const r=aD(i);e.style[r]=""})}function Zy(e){return Array.isArray(e)?1==e.length?e[0]:function Yq(e,t=null){return{type:Kt.Sequence,steps:e,options:t}}(e):e}const sD=new RegExp("{{\\s*(.+?)\\s*}}","g");function lO(e){let t=[];if("string"==typeof e){let n;for(;n=sD.exec(e);)t.push(n[1]);sD.lastIndex=0}return t}function Ky(e,t,n){const i=`${e}`,r=i.replace(sD,(a,h)=>{let d=t[h];return null==d&&(n.push(function eW(){return new Te(3003,!1)}()),d=""),d.toString()});return r==i?e:r}const zW=/-+([a-z0-9])/g;function aD(e){return e.replace(zW,(...t)=>t[1].toUpperCase())}function ol(e,t,n){switch(t.type){case Kt.Trigger:return e.visitTrigger(t,n);case Kt.State:return e.visitState(t,n);case Kt.Transition:return e.visitTransition(t,n);case Kt.Sequence:return e.visitSequence(t,n);case Kt.Group:return e.visitGroup(t,n);case Kt.Animate:return e.visitAnimate(t,n);case Kt.Keyframes:return e.visitKeyframes(t,n);case Kt.Style:return e.visitStyle(t,n);case Kt.Reference:return e.visitReference(t,n);case Kt.AnimateChild:return e.visitAnimateChild(t,n);case Kt.AnimateRef:return e.visitAnimateRef(t,n);case Kt.Query:return e.visitQuery(t,n);case Kt.Stagger:return e.visitStagger(t,n);default:throw function tW(){return new Te(3004,!1)}()}}function lD(e,t){return window.getComputedStyle(e)[t]}let cD=(()=>{class e{validateStyleProperty(n){return function PW(e){cp||(cp=function RW(){return typeof document<"u"?document.body:null}()||{},nO=!!cp.style&&"WebkitAppearance"in cp.style);let t=!0;return cp.style&&!function AW(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in cp.style,!t&&nO&&(t="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in cp.style)),t}(n)}containsElement(n,i){return iO(n,i)}getParentElement(n){return nD(n)}query(n,i,r){return rO(n,i,r)}computeStyle(n,i,r){return r||""}animate(n,i,r,a,h,d=[],_){return new Wy(r,a)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})();class uD{static NOOP=new cD}class hD{}const GW=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class cO extends hD{normalizePropertyName(t,n){return aD(t)}normalizeStyleValue(t,n,i,r){let a="";const h=i.toString().trim();if(GW.has(n)&&0!==i&&"0"!==i)if("number"==typeof i)a="px";else{const d=i.match(/^[+-]?[\d\.]+([a-z]*)$/);d&&0==d[1].length&&r.push(function nW(){return new Te(3005,!1)}())}return h+a}}const Pb=new Set(["true","1"]),Rb=new Set(["false","0"]);function uO(e,t){const n=Pb.has(e)||Rb.has(e),i=Pb.has(t)||Rb.has(t);return(r,a)=>{let h="*"==e||e==r,d="*"==t||t==a;return!h&&n&&"boolean"==typeof r&&(h=r?Pb.has(e):Rb.has(e)),!d&&i&&"boolean"==typeof a&&(d=a?Pb.has(t):Rb.has(t)),h&&d}}const WW=new RegExp("s*:selfs*,?","g");function fD(e,t,n,i){return new ZW(e).build(t,n,i)}class ZW{_driver;constructor(t){this._driver=t}build(t,n,i){const r=new XW(n);return this._resetContextStyleTimingState(r),ol(this,Zy(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,n){let i=n.queryCount=0,r=n.depCount=0;const a=[],h=[];return"@"==t.name.charAt(0)&&n.errors.push(function iW(){return new Te(3006,!1)}()),t.definitions.forEach(d=>{if(this._resetContextStyleTimingState(n),d.type==Kt.State){const _=d,S=_.name;S.toString().split(/\s*,\s*/).forEach(D=>{_.name=D,a.push(this.visitState(_,n))}),_.name=S}else if(d.type==Kt.Transition){const _=this.visitTransition(d,n);i+=_.queryCount,r+=_.depCount,h.push(_)}else n.errors.push(function rW(){return new Te(3007,!1)}())}),{type:Kt.Trigger,name:t.name,states:a,transitions:h,queryCount:i,depCount:r,options:null}}visitState(t,n){const i=this.visitStyle(t.styles,n),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const a=new Set,h=r||{};i.styles.forEach(d=>{d instanceof Map&&d.forEach(_=>{lO(_).forEach(S=>{h.hasOwnProperty(S)||a.add(S)})})}),a.size&&n.errors.push(function oW(){return new Te(3008,!1)}(0,a.values()))}return{type:Kt.State,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,n){n.queryCount=0,n.depCount=0;const i=ol(this,Zy(t.animation),n),r=function $W(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(i=>function HW(e,t,n){if(":"==e[0]){const _=function qW(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(n,i)=>parseFloat(i)>parseFloat(n);case":decrement":return(n,i)=>parseFloat(i)<parseFloat(n);default:return t.push(function gW(){return new Te(3016,!1)}()),"* => *"}}(e,n);if("function"==typeof _)return void t.push(_);e=_}const i=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return n.push(function pW(){return new Te(3015,!1)}()),t;const r=i[1],a=i[2],h=i[3];t.push(uO(r,h)),"<"==a[0]&&("*"!=r||"*"!=h)&&t.push(uO(h,r))}(i,n,t)):n.push(e),n}(t.expr,n.errors);return{type:Kt.Transition,matchers:r,animation:i,queryCount:n.queryCount,depCount:n.depCount,options:hp(t.options)}}visitSequence(t,n){return{type:Kt.Sequence,steps:t.steps.map(i=>ol(this,i,n)),options:hp(t.options)}}visitGroup(t,n){const i=n.currentTime;let r=0;const a=t.steps.map(h=>{n.currentTime=i;const d=ol(this,h,n);return r=Math.max(r,n.currentTime),d});return n.currentTime=r,{type:Kt.Group,steps:a,options:hp(t.options)}}visitAnimate(t,n){const i=function JW(e,t){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return pD(Ib(e,t).duration,0,"");const n=e;if(n.split(/\s+/).some(a=>"{"==a.charAt(0)&&"{"==a.charAt(1))){const a=pD(0,0,"");return a.dynamic=!0,a.strValue=n,a}const r=Ib(n,t);return pD(r.duration,r.delay,r.easing)}(t.timings,n.errors);n.currentAnimateTimings=i;let r,a=t.styles?t.styles:Xk({});if(a.type==Kt.Keyframes)r=this.visitKeyframes(a,n);else{let h=t.styles,d=!1;if(!h){d=!0;const S={};i.easing&&(S.easing=i.easing),h=Xk(S)}n.currentTime+=i.duration+i.delay;const _=this.visitStyle(h,n);_.isEmptyStep=d,r=_}return n.currentAnimateTimings=null,{type:Kt.Animate,timings:i,style:r,options:null}}visitStyle(t,n){const i=this._makeStyleAst(t,n);return this._validateStyleAst(i,n),i}_makeStyleAst(t,n){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let d of r)"string"==typeof d?d===Fh?i.push(d):n.errors.push(sW()):i.push(new Map(Object.entries(d)));let a=!1,h=null;return i.forEach(d=>{if(d instanceof Map&&(d.has("easing")&&(h=d.get("easing"),d.delete("easing")),!a))for(let _ of d.values())if(_.toString().indexOf("{{")>=0){a=!0;break}}),{type:Kt.Style,styles:i,easing:h,offset:t.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(t,n){const i=n.currentAnimateTimings;let r=n.currentTime,a=n.currentTime;i&&a>0&&(a-=i.duration+i.delay),t.styles.forEach(h=>{"string"!=typeof h&&h.forEach((d,_)=>{const S=n.collectedStyles.get(n.currentQuerySelector),D=S.get(_);let A=!0;D&&(a!=r&&a>=D.startTime&&r<=D.endTime&&(n.errors.push(function aW(){return new Te(3010,!1)}()),A=!1),a=D.startTime),A&&S.set(_,{startTime:a,endTime:r}),n.options&&function BW(e,t,n){const i=t.params||{},r=lO(e);r.length&&r.forEach(a=>{i.hasOwnProperty(a)||n.push(function Jq(){return new Te(3001,!1)}())})}(d,n.options,n.errors)})})}visitKeyframes(t,n){const i={type:Kt.Keyframes,styles:[],options:null};if(!n.currentAnimateTimings)return n.errors.push(function lW(){return new Te(3011,!1)}()),i;let a=0;const h=[];let d=!1,_=!1,S=0;const D=t.steps.map(fe=>{const ge=this._makeStyleAst(fe,n);let Le=null!=ge.offset?ge.offset:function QW(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(n=>{if(n instanceof Map&&n.has("offset")){const i=n;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const n=e;t=parseFloat(n.get("offset")),n.delete("offset")}return t}(ge.styles),je=0;return null!=Le&&(a++,je=ge.offset=Le),_=_||je<0||je>1,d=d||je<S,S=je,h.push(je),ge});_&&n.errors.push(function cW(){return new Te(3012,!1)}()),d&&n.errors.push(function uW(){return new Te(3200,!1)}());const A=t.steps.length;let F=0;a>0&&a<A?n.errors.push(function hW(){return new Te(3202,!1)}()):0==a&&(F=1/(A-1));const k=A-1,G=n.currentTime,Y=n.currentAnimateTimings,ne=Y.duration;return D.forEach((fe,ge)=>{const Le=F>0?ge==k?1:F*ge:h[ge],je=Le*ne;n.currentTime=G+Y.delay+je,Y.duration=je,this._validateStyleAst(fe,n),fe.offset=Le,i.styles.push(fe)}),i}visitReference(t,n){return{type:Kt.Reference,animation:ol(this,Zy(t.animation),n),options:hp(t.options)}}visitAnimateChild(t,n){return n.depCount++,{type:Kt.AnimateChild,options:hp(t.options)}}visitAnimateRef(t,n){return{type:Kt.AnimateRef,animation:this.visitReference(t.animation,n),options:hp(t.options)}}visitQuery(t,n){const i=n.currentQuerySelector,r=t.options||{};n.queryCount++,n.currentQuery=t;const[a,h]=function KW(e){const t=!!e.split(/\s*,\s*/).find(n=>":self"==n);return t&&(e=e.replace(WW,"")),e=e.replace(/@\*/g,Tb).replace(/@\w+/g,n=>Tb+"-"+n.slice(1)).replace(/:animating/g,rD),[e,t]}(t.selector);n.currentQuerySelector=i.length?i+" "+a:a,rl(n.collectedStyles,n.currentQuerySelector,new Map);const d=ol(this,Zy(t.animation),n);return n.currentQuery=null,n.currentQuerySelector=i,{type:Kt.Query,selector:a,limit:r.limit||0,optional:!!r.optional,includeSelf:h,animation:d,originalSelector:t.selector,options:hp(t.options)}}visitStagger(t,n){n.currentQuery||n.errors.push(function dW(){return new Te(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:Ib(t.timings,n.errors,!0);return{type:Kt.Stagger,animation:ol(this,Zy(t.animation),n),timings:i,options:null}}}class XW{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(t){this.errors=t}}function hp(e){return e?(e={...e}).params&&(e.params=function YW(e){return e?{...e}:null}(e.params)):e={},e}function pD(e,t,n){return{duration:e,delay:t,easing:n}}function gD(e,t,n,i,r,a,h=null,d=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:i,duration:r,delay:a,totalTime:r+a,easing:h,subTimeline:d}}class Nb{_map=new Map;get(t){return this._map.get(t)||[]}append(t,n){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...n)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const nZ=new RegExp(":enter","g"),rZ=new RegExp(":leave","g");function mD(e,t,n,i,r,a=new Map,h=new Map,d,_,S=[]){return(new oZ).buildKeyframes(e,t,n,i,r,a,h,d,_,S)}class oZ{buildKeyframes(t,n,i,r,a,h,d,_,S,D=[]){S=S||new Nb;const A=new _D(t,n,S,r,a,D,[]);A.options=_;const F=_.delay?Lh(_.delay):0;A.currentTimeline.delayNextStep(F),A.currentTimeline.setStyles([h],null,A.errors,_),ol(this,i,A);const k=A.timelines.filter(G=>G.containsAnimation());if(k.length&&d.size){let G;for(let Y=k.length-1;Y>=0;Y--){const ne=k[Y];if(ne.element===n){G=ne;break}}G&&!G.allowOnlyTimelineStyles()&&G.setStyles([d],null,A.errors,_)}return k.length?k.map(G=>G.buildKeyframes()):[gD(n,[],[],[],0,F,"",!1)]}visitTrigger(t,n){}visitState(t,n){}visitTransition(t,n){}visitAnimateChild(t,n){const i=n.subInstructions.get(n.element);if(i){const r=n.createSubContext(t.options),a=n.currentTimeline.currentTime,h=this._visitSubInstructions(i,r,r.options);a!=h&&n.transformIntoNewTimeline(h)}n.previousNode=t}visitAnimateRef(t,n){const i=n.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],n,i),this.visitReference(t.animation,i),n.transformIntoNewTimeline(i.currentTimeline.currentTime),n.previousNode=t}_applyAnimationRefDelays(t,n,i){for(const r of t){const a=r?.delay;if(a){const h="number"==typeof a?a:Lh(Ky(a,r?.params??{},n.errors));i.delayNextStep(h)}}}_visitSubInstructions(t,n,i){let a=n.currentTimeline.currentTime;const h=null!=i.duration?Lh(i.duration):null,d=null!=i.delay?Lh(i.delay):null;return 0!==h&&t.forEach(_=>{const S=n.appendInstructionToTimeline(_,h,d);a=Math.max(a,S.duration+S.delay)}),a}visitReference(t,n){n.updateOptions(t.options,!0),ol(this,t.animation,n),n.previousNode=t}visitSequence(t,n){const i=n.subContextCount;let r=n;const a=t.options;if(a&&(a.params||a.delay)&&(r=n.createSubContext(a),r.transformIntoNewTimeline(),null!=a.delay)){r.previousNode.type==Kt.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=kb);const h=Lh(a.delay);r.delayNextStep(h)}t.steps.length&&(t.steps.forEach(h=>ol(this,h,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),n.previousNode=t}visitGroup(t,n){const i=[];let r=n.currentTimeline.currentTime;const a=t.options&&t.options.delay?Lh(t.options.delay):0;t.steps.forEach(h=>{const d=n.createSubContext(t.options);a&&d.delayNextStep(a),ol(this,h,d),r=Math.max(r,d.currentTimeline.currentTime),i.push(d.currentTimeline)}),i.forEach(h=>n.currentTimeline.mergeTimelineCollectedStyles(h)),n.transformIntoNewTimeline(r),n.previousNode=t}_visitTiming(t,n){if(t.dynamic){const i=t.strValue;return Ib(n.params?Ky(i,n.params,n.errors):i,n.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,n){const i=n.currentAnimateTimings=this._visitTiming(t.timings,n),r=n.currentTimeline;i.delay&&(n.incrementTime(i.delay),r.snapshotCurrentStyles());const a=t.style;a.type==Kt.Keyframes?this.visitKeyframes(a,n):(n.incrementTime(i.duration),this.visitStyle(a,n),r.applyStylesToKeyframe()),n.currentAnimateTimings=null,n.previousNode=t}visitStyle(t,n){const i=n.currentTimeline,r=n.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const a=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(a):i.setStyles(t.styles,a,n.errors,n.options),n.previousNode=t}visitKeyframes(t,n){const i=n.currentAnimateTimings,r=n.currentTimeline.duration,a=i.duration,d=n.createSubContext().currentTimeline;d.easing=i.easing,t.styles.forEach(_=>{d.forwardTime((_.offset||0)*a),d.setStyles(_.styles,_.easing,n.errors,n.options),d.applyStylesToKeyframe()}),n.currentTimeline.mergeTimelineCollectedStyles(d),n.transformIntoNewTimeline(r+a),n.previousNode=t}visitQuery(t,n){const i=n.currentTimeline.currentTime,r=t.options||{},a=r.delay?Lh(r.delay):0;a&&(n.previousNode.type===Kt.Style||0==i&&n.currentTimeline.hasCurrentStyleProperties())&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=kb);let h=i;const d=n.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,n.errors);n.currentQueryTotal=d.length;let _=null;d.forEach((S,D)=>{n.currentQueryIndex=D;const A=n.createSubContext(t.options,S);a&&A.delayNextStep(a),S===n.element&&(_=A.currentTimeline),ol(this,t.animation,A),A.currentTimeline.applyStylesToKeyframe(),h=Math.max(h,A.currentTimeline.currentTime)}),n.currentQueryIndex=0,n.currentQueryTotal=0,n.transformIntoNewTimeline(h),_&&(n.currentTimeline.mergeTimelineCollectedStyles(_),n.currentTimeline.snapshotCurrentStyles()),n.previousNode=t}visitStagger(t,n){const i=n.parentContext,r=n.currentTimeline,a=t.timings,h=Math.abs(a.duration),d=h*(n.currentQueryTotal-1);let _=h*n.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":_=d-_;break;case"full":_=i.currentStaggerTime}const D=n.currentTimeline;_&&D.delayNextStep(_);const A=D.currentTime;ol(this,t.animation,n),n.previousNode=t,i.currentStaggerTime=r.currentTime-A+(r.startTime-i.currentTimeline.startTime)}}const kb={};class _D{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=kb;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(t,n,i,r,a,h,d,_){this._driver=t,this.element=n,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=a,this.errors=h,this.timelines=d,this.currentTimeline=_||new Ob(this._driver,n,0),d.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,n){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=Lh(i.duration)),null!=i.delay&&(r.delay=Lh(i.delay));const a=i.params;if(a){let h=r.params;h||(h=this.options.params={}),Object.keys(a).forEach(d=>{(!n||!h.hasOwnProperty(d))&&(h[d]=Ky(a[d],h,this.errors))})}}_copyOptions(){const t={};if(this.options){const n=this.options.params;if(n){const i=t.params={};Object.keys(n).forEach(r=>{i[r]=n[r]})}}return t}createSubContext(t=null,n,i){const r=n||this.element,a=new _D(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(t),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(t){return this.previousNode=kb,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,n,i){const r={duration:n??t.duration,delay:this.currentTimeline.currentTime+(i??0)+t.delay,easing:""},a=new sZ(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(a),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,n,i,r,a,h){let d=[];if(r&&d.push(this.element),t.length>0){t=(t=t.replace(nZ,"."+this._enterClassName)).replace(rZ,"."+this._leaveClassName);let S=this._driver.query(this.element,t,1!=i);0!==i&&(S=i<0?S.slice(S.length+i,S.length):S.slice(0,i)),d.push(...S)}return!a&&0==d.length&&h.push(function fW(){return new Te(3014,!1)}()),d}}class Ob{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(t,n,i,r){this._driver=t,this.element=n,this.startTime=i,this._elementTimelineStylesLookup=r,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const n=1===this._keyframes.size&&this._pendingStyles.size;this.duration||n?(this.forwardTime(this.currentTime+t),n&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,n){return this.applyStylesToKeyframe(),new Ob(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,n){this._localTimelineStyles.set(t,n),this._globalTimelineStyles.set(t,n),this._styleSummary.set(t,{time:this.currentTime,value:n})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[n,i]of this._globalTimelineStyles)this._backFill.set(n,i||Fh),this._currentKeyframe.set(n,Fh);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,n,i,r){n&&this._previousKeyframe.set("easing",n);const a=r&&r.params||{},h=function aZ(e,t){const n=new Map;let i;return e.forEach(r=>{if("*"===r){i??=t.keys();for(let a of i)n.set(a,Fh)}else for(let[a,h]of r)n.set(a,h)}),n}(t,this._globalTimelineStyles);for(let[d,_]of h){const S=Ky(_,a,i);this._pendingStyles.set(d,S),this._localTimelineStyles.has(d)||this._backFill.set(d,this._globalTimelineStyles.get(d)??Fh),this._updateStyle(d,S)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,n)=>{this._currentKeyframe.set(n,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,n)=>{this._currentKeyframe.has(n)||this._currentKeyframe.set(n,t)}))}snapshotCurrentStyles(){for(let[t,n]of this._localTimelineStyles)this._pendingStyles.set(t,n),this._updateStyle(t,n)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let n in this._currentKeyframe)t.push(n);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((n,i)=>{const r=this._styleSummary.get(i);(!r||n.time>r.time)&&this._updateStyle(i,n.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,n=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((d,_)=>{const S=new Map([...this._backFill,...d]);S.forEach((D,A)=>{"!"===D?t.add(A):D===Fh&&n.add(A)}),i||S.set("offset",_/this.duration),r.push(S)});const a=[...t.values()],h=[...n.values()];if(i){const d=r[0],_=new Map(d);d.set("offset",0),_.set("offset",1),r=[d,_]}return gD(this.element,r,a,h,this.duration,this.startTime,this.easing,!1)}}class sZ extends Ob{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(t,n,i,r,a,h,d=!1){super(t,n,h.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=a,this._stretchStartingKeyframe=d,this.timings={duration:h.duration,delay:h.delay,easing:h.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:n,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&n){const a=[],h=i+n,d=n/h,_=new Map(t[0]);_.set("offset",0),a.push(_);const S=new Map(t[0]);S.set("offset",fO(d)),a.push(S);const D=t.length-1;for(let A=1;A<=D;A++){let F=new Map(t[A]);const k=F.get("offset");F.set("offset",fO((n+k*i)/h)),a.push(F)}i=h,n=0,r="",t=a}return gD(this.element,t,this.preStyleProps,this.postStyleProps,i,n,r,!0)}}function fO(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}function pO(e,t,n,i,r,a,h,d,_,S,D,A,F){return{type:0,element:e,triggerName:t,isRemovalTransition:r,fromState:n,fromStyles:a,toState:i,toStyles:h,timelines:d,queriedElements:_,preStyleProps:S,postStyleProps:D,totalTime:A,errors:F}}const yD={};class gO{_triggerName;ast;_stateStyles;constructor(t,n,i){this._triggerName=t,this.ast=n,this._stateStyles=i}match(t,n,i,r){return function lZ(e,t,n,i,r){return e.some(a=>a(t,n,i,r))}(this.ast.matchers,t,n,i,r)}buildStyles(t,n,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(n,i):new Map}build(t,n,i,r,a,h,d,_,S,D){const A=[],F=this.ast.options&&this.ast.options.params||yD,G=this.buildStyles(i,d&&d.params||yD,A),Y=_&&_.params||yD,ne=this.buildStyles(r,Y,A),fe=new Set,ge=new Map,Le=new Map,je="void"===r,Ge={params:mO(Y,F),delay:this.ast.options?.delay},ot=D?[]:mD(t,n,this.ast.animation,a,h,G,ne,Ge,S,A);let at=0;return ot.forEach(Et=>{at=Math.max(Et.duration+Et.delay,at)}),A.length?pO(n,this._triggerName,i,r,je,G,ne,[],[],ge,Le,at,A):(ot.forEach(Et=>{const en=Et.element,Fn=rl(ge,en,new Set);Et.preStyleProps.forEach(Gi=>Fn.add(Gi));const Kn=rl(Le,en,new Set);Et.postStyleProps.forEach(Gi=>Kn.add(Gi)),en!==n&&fe.add(en)}),pO(n,this._triggerName,i,r,je,G,ne,ot,[...fe.values()],ge,Le,at))}}function mO(e,t){const n={...t};return Object.entries(e).forEach(([i,r])=>{null!=r&&(n[i]=r)}),n}class cZ{styles;defaultParams;normalizer;constructor(t,n,i){this.styles=t,this.defaultParams=n,this.normalizer=i}buildStyles(t,n){const i=new Map,r=mO(t,this.defaultParams);return this.styles.styles.forEach(a=>{"string"!=typeof a&&a.forEach((h,d)=>{h&&(h=Ky(h,r,n));const _=this.normalizer.normalizePropertyName(d,n);h=this.normalizer.normalizeStyleValue(d,_,h,n),i.set(d,h)})}),i}}class hZ{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(t,n,i){this.name=t,this.ast=n,this._normalizer=i,n.states.forEach(r=>{this.states.set(r.name,new cZ(r.style,r.options&&r.options.params||{},i))}),_O(this.states,"true","1"),_O(this.states,"false","0"),n.transitions.forEach(r=>{this.transitionFactories.push(new gO(t,r,this.states))}),this.fallbackTransition=function dZ(e,t){return new gO(e,{type:Kt.Transition,animation:{type:Kt.Sequence,steps:[],options:null},matchers:[(h,d)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,n,i,r){return this.transitionFactories.find(h=>h.match(t,n,i,r))||null}matchStyles(t,n,i){return this.fallbackTransition.buildStyles(t,n,i)}}function _O(e,t,n){e.has(t)?e.has(n)||e.set(n,e.get(t)):e.has(n)&&e.set(t,e.get(n))}const fZ=new Nb;class pZ{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(t,n,i){this.bodyNode=t,this._driver=n,this._normalizer=i}register(t,n){const i=[],a=fD(this._driver,n,i,[]);if(i.length)throw function yW(){return new Te(3503,!1)}();this._animations.set(t,a)}_buildPlayer(t,n,i){const r=t.element,a=eO(this._normalizer,t.keyframes,n,i);return this._driver.animate(r,a,t.duration,t.delay,t.easing,[],!0)}create(t,n,i={}){const r=[],a=this._animations.get(t);let h;const d=new Map;if(a?(h=mD(this._driver,n,a,sO,iD,new Map,new Map,i,fZ,r),h.forEach(D=>{const A=rl(d,D.element,new Map);D.postStyleProps.forEach(F=>A.set(F,null))})):(r.push(function vW(){return new Te(3300,!1)}()),h=[]),r.length)throw function bW(){return new Te(3504,!1)}();d.forEach((D,A)=>{D.forEach((F,k)=>{D.set(k,this._driver.computeStyle(A,k,Fh))})});const S=Ud(h.map(D=>{const A=d.get(D.element);return this._buildPlayer(D,new Map,A)}));return this._playersById.set(t,S),S.onDestroy(()=>this.destroy(t)),this.players.push(S),S}destroy(t){const n=this._getPlayer(t);n.destroy(),this._playersById.delete(t);const i=this.players.indexOf(n);i>=0&&this.players.splice(i,1)}_getPlayer(t){const n=this._playersById.get(t);if(!n)throw function wW(){return new Te(3301,!1)}();return n}listen(t,n,i,r){const a=tD(n,"","","");return JM(this._getPlayer(t),i,a,r),()=>{}}command(t,n,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,n,r[0]||{});const a=this._getPlayer(t);switch(i){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const yO="ng-animate-queued",vD="ng-animate-disabled",vZ=[],vO={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},bZ={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ic="__ng_removed";class bD{namespaceId;value;options;get params(){return this.options.params}constructor(t,n=""){this.namespaceId=n;const i=t&&t.hasOwnProperty("value");if(this.value=function EZ(e){return e??null}(i?t.value:t),i){const{value:a,...h}=t;this.options=h}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const n=t.params;if(n){const i=this.options.params;Object.keys(n).forEach(r=>{null==i[r]&&(i[r]=n[r])})}}}const Yy="void",wD=new bD(Yy);class wZ{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(t,n,i){this.id=t,this.hostElement=n,this._engine=i,this._hostClassName="ng-tns-"+t,Ol(n,this._hostClassName)}listen(t,n,i,r){if(!this._triggers.has(n))throw function xW(){return new Te(3302,!1)}();if(null==i||0==i.length)throw function SW(){return new Te(3303,!1)}();if(!function MZ(e){return"start"==e||"done"==e}(i))throw function EW(){return new Te(3400,!1)}();const a=rl(this._elementListeners,t,[]),h={name:n,phase:i,callback:r};a.push(h);const d=rl(this._engine.statesByElement,t,new Map);return d.has(n)||(Ol(t,Cb),Ol(t,Cb+"-"+n),d.set(n,wD)),()=>{this._engine.afterFlush(()=>{const _=a.indexOf(h);_>=0&&a.splice(_,1),this._triggers.has(n)||d.delete(n)})}}register(t,n){return!this._triggers.has(t)&&(this._triggers.set(t,n),!0)}_getTrigger(t){const n=this._triggers.get(t);if(!n)throw function MW(){return new Te(3401,!1)}();return n}trigger(t,n,i,r=!0){const a=this._getTrigger(n),h=new xD(this.id,n,t);let d=this._engine.statesByElement.get(t);d||(Ol(t,Cb),Ol(t,Cb+"-"+n),this._engine.statesByElement.set(t,d=new Map));let _=d.get(n);const S=new bD(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&_&&S.absorbOptions(_.options),d.set(n,S),_||(_=wD),S.value!==Yy&&_.value===S.value){if(!function TZ(e,t){const n=Object.keys(e),i=Object.keys(t);if(n.length!=i.length)return!1;for(let r=0;r<n.length;r++){const a=n[r];if(!t.hasOwnProperty(a)||e[a]!==t[a])return!1}return!0}(_.params,S.params)){const Y=[],ne=a.matchStyles(_.value,_.params,Y),fe=a.matchStyles(S.value,S.params,Y);Y.length?this._engine.reportError(Y):this._engine.afterFlush(()=>{up(t,ne),Uu(t,fe)})}return}const F=rl(this._engine.playersByElement,t,[]);F.forEach(Y=>{Y.namespaceId==this.id&&Y.triggerName==n&&Y.queued&&Y.destroy()});let k=a.matchTransition(_.value,S.value,t,S.params),G=!1;if(!k){if(!r)return;k=a.fallbackTransition,G=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:n,transition:k,fromState:_,toState:S,player:h,isFallbackTransition:G}),G||(Ol(t,yO),h.onStart(()=>{im(t,yO)})),h.onDone(()=>{let Y=this.players.indexOf(h);Y>=0&&this.players.splice(Y,1);const ne=this._engine.playersByElement.get(t);if(ne){let fe=ne.indexOf(h);fe>=0&&ne.splice(fe,1)}}),this.players.push(h),F.push(h),h}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(n=>n.delete(t)),this._elementListeners.forEach((n,i)=>{this._elementListeners.set(i,n.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const n=this._engine.playersByElement.get(t);n&&(n.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,n){const i=this._engine.driver.query(t,Tb,!0);i.forEach(r=>{if(r[Ic])return;const a=this._engine.fetchNamespacesByElement(r);a.size?a.forEach(h=>h.triggerLeaveAnimation(r,n,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,n,i,r){const a=this._engine.statesByElement.get(t),h=new Map;if(a){const d=[];if(a.forEach((_,S)=>{if(h.set(S,_.value),this._triggers.has(S)){const D=this.trigger(t,S,Yy,r);D&&d.push(D)}}),d.length)return this._engine.markElementAsRemoved(this.id,t,!0,n,h),i&&Ud(d).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const n=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(n&&i){const r=new Set;n.forEach(a=>{const h=a.name;if(r.has(h))return;r.add(h);const _=this._triggers.get(h).fallbackTransition,S=i.get(h)||wD,D=new bD(Yy),A=new xD(this.id,h,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:h,transition:_,fromState:S,toState:D,player:A,isFallbackTransition:!0})})}}removeNode(t,n){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,n),this.triggerLeaveAnimation(t,n,!0))return;let r=!1;if(i.totalAnimations){const a=i.players.length?i.playersByQueriedElement.get(t):[];if(a&&a.length)r=!0;else{let h=t;for(;h=h.parentNode;)if(i.statesByElement.get(h)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,n);else{const a=t[Ic];(!a||a===vO)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,n))}}insertNode(t,n){Ol(t,this._hostClassName)}drainQueuedTransitions(t){const n=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const a=i.element,h=this._elementListeners.get(a);h&&h.forEach(d=>{if(d.name==i.triggerName){const _=tD(a,i.triggerName,i.fromState.value,i.toState.value);_._data=t,JM(i.player,d.phase,_,d.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):n.push(i)}),this._queue=[],n.sort((i,r)=>{const a=i.transition.ast.depCount,h=r.transition.ast.depCount;return 0==a||0==h?a-h:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(n=>n.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}}class xZ{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(t,n)=>{};_onRemovalComplete(t,n){this.onRemovalComplete(t,n)}constructor(t,n,i){this.bodyNode=t,this.driver=n,this._normalizer=i}get queuedPlayers(){const t=[];return this._namespaceList.forEach(n=>{n.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,n){const i=new wZ(t,n,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,n)?this._balanceNamespaceList(i,n):(this.newHostElements.set(n,i),this.collectEnterElement(n)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,n){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let h=!1,d=this.driver.getParentElement(n);for(;d;){const _=r.get(d);if(_){const S=i.indexOf(_);i.splice(S+1,0,t),h=!0;break}d=this.driver.getParentElement(d)}h||i.unshift(t)}else i.push(t);return r.set(n,t),t}register(t,n){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,n)),i}registerTrigger(t,n,i){let r=this._namespaceLookup[t];r&&r.register(n,i)&&this.totalAnimations++}destroy(t,n){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const i=this._fetchNamespace(t);this.namespacesByHostElement.delete(i.hostElement);const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1),i.destroy(n),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const n=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const a=this._fetchNamespace(r.namespaceId);a&&n.add(a)}return n}trigger(t,n,i,r){if(Fb(n)){const a=this._fetchNamespace(t);if(a)return a.trigger(n,i,r),!0}return!1}insertNode(t,n,i,r){if(!Fb(n))return;const a=n[Ic];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;const h=this.collectedLeaveElements.indexOf(n);h>=0&&this.collectedLeaveElements.splice(h,1)}if(t){const h=this._fetchNamespace(t);h&&h.insertNode(n,i)}r&&this.collectEnterElement(n)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,n){n?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Ol(t,vD)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),im(t,vD))}removeNode(t,n,i){if(Fb(n)){const r=t?this._fetchNamespace(t):null;r?r.removeNode(n,i):this.markElementAsRemoved(t,n,!1,i);const a=this.namespacesByHostElement.get(n);a&&a.id!==t&&a.removeNode(n,i)}else this._onRemovalComplete(n,i)}markElementAsRemoved(t,n,i,r,a){this.collectedLeaveElements.push(n),n[Ic]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:a}}listen(t,n,i,r,a){return Fb(n)?this._fetchNamespace(t).listen(n,i,r,a):()=>{}}_buildInstruction(t,n,i,r,a){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,n,a)}destroyInnerAnimations(t){let n=this.driver.query(t,Tb,!0);n.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(n=this.driver.query(t,rD,!0),n.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const n=this.playersByElement.get(t);n&&n.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const n=this.playersByQueriedElement.get(t);n&&n.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Ud(this.players).onDone(()=>t());t()})}processLeaveNode(t){const n=t[Ic];if(n&&n.setForRemoval){if(t[Ic]=vO,n.namespaceId){this.destroyInnerAnimations(t);const i=this._fetchNamespace(n.namespaceId);i&&i.clearElementCache(t)}this._onRemovalComplete(t,n.setForRemoval)}t.classList?.contains(vD)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(t=-1){let n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Ol(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{n=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],n.length?Ud(n).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function DW(){return new Te(3402,!1)}()}_flushAnimations(t,n){const i=new Nb,r=[],a=new Map,h=[],d=new Map,_=new Map,S=new Map,D=new Set;this.disabledNodes.forEach(ut=>{D.add(ut);const bt=this.driver.query(ut,".ng-animate-queued",!0);for(let Ot=0;Ot<bt.length;Ot++)D.add(bt[Ot])});const A=this.bodyNode,F=Array.from(this.statesByElement.keys()),k=xO(F,this.collectedEnterElements),G=new Map;let Y=0;k.forEach((ut,bt)=>{const Ot=sO+Y++;G.set(bt,Ot),ut.forEach(mn=>Ol(mn,Ot))});const ne=[],fe=new Set,ge=new Set;for(let ut=0;ut<this.collectedLeaveElements.length;ut++){const bt=this.collectedLeaveElements[ut],Ot=bt[Ic];Ot&&Ot.setForRemoval&&(ne.push(bt),fe.add(bt),Ot.hasAnimation?this.driver.query(bt,".ng-star-inserted",!0).forEach(mn=>fe.add(mn)):ge.add(bt))}const Le=new Map,je=xO(F,Array.from(fe));je.forEach((ut,bt)=>{const Ot=iD+Y++;Le.set(bt,Ot),ut.forEach(mn=>Ol(mn,Ot))}),t.push(()=>{k.forEach((ut,bt)=>{const Ot=G.get(bt);ut.forEach(mn=>im(mn,Ot))}),je.forEach((ut,bt)=>{const Ot=Le.get(bt);ut.forEach(mn=>im(mn,Ot))}),ne.forEach(ut=>{this.processLeaveNode(ut)})});const Ge=[],ot=[];for(let ut=this._namespaceList.length-1;ut>=0;ut--)this._namespaceList[ut].drainQueuedTransitions(n).forEach(Ot=>{const mn=Ot.player,Er=Ot.element;if(Ge.push(mn),this.collectedEnterElements.length){const Hr=Er[Ic];if(Hr&&Hr.setForMove){if(Hr.previousTriggersValues&&Hr.previousTriggersValues.has(Ot.triggerName)){const Us=Hr.previousTriggersValues.get(Ot.triggerName),Ss=this.statesByElement.get(Ot.element);if(Ss&&Ss.has(Ot.triggerName)){const Dm=Ss.get(Ot.triggerName);Dm.value=Us,Ss.set(Ot.triggerName,Dm)}}return void mn.destroy()}}const Da=!A||!this.driver.containsElement(A,Er),vo=Le.get(Er),ul=G.get(Er),ii=this._buildInstruction(Ot,i,ul,vo,Da);if(ii.errors&&ii.errors.length)return void ot.push(ii);if(Da)return mn.onStart(()=>up(Er,ii.fromStyles)),mn.onDestroy(()=>Uu(Er,ii.toStyles)),void r.push(mn);if(Ot.isFallbackTransition)return mn.onStart(()=>up(Er,ii.fromStyles)),mn.onDestroy(()=>Uu(Er,ii.toStyles)),void r.push(mn);const Bc=[];ii.timelines.forEach(Hr=>{Hr.stretchStartingKeyframe=!0,this.disabledNodes.has(Hr.element)||Bc.push(Hr)}),ii.timelines=Bc,i.append(Er,ii.timelines),h.push({instruction:ii,player:mn,element:Er}),ii.queriedElements.forEach(Hr=>rl(d,Hr,[]).push(mn)),ii.preStyleProps.forEach((Hr,Us)=>{if(Hr.size){let Ss=_.get(Us);Ss||_.set(Us,Ss=new Set),Hr.forEach((Dm,Dp)=>Ss.add(Dp))}}),ii.postStyleProps.forEach((Hr,Us)=>{let Ss=S.get(Us);Ss||S.set(Us,Ss=new Set),Hr.forEach((Dm,Dp)=>Ss.add(Dp))})});if(ot.length){const ut=[];ot.forEach(bt=>{ut.push(function CW(){return new Te(3505,!1)}())}),Ge.forEach(bt=>bt.destroy()),this.reportError(ut)}const at=new Map,Et=new Map;h.forEach(ut=>{const bt=ut.element;i.has(bt)&&(Et.set(bt,bt),this._beforeAnimationBuild(ut.player.namespaceId,ut.instruction,at))}),r.forEach(ut=>{const bt=ut.element;this._getPreviousPlayers(bt,!1,ut.namespaceId,ut.triggerName,null).forEach(mn=>{rl(at,bt,[]).push(mn),mn.destroy()})});const en=ne.filter(ut=>EO(ut,_,S)),Fn=new Map;wO(Fn,this.driver,ge,S,Fh).forEach(ut=>{EO(ut,_,S)&&en.push(ut)});const Gi=new Map;k.forEach((ut,bt)=>{wO(Gi,this.driver,new Set(ut),_,"!")}),en.forEach(ut=>{const bt=Fn.get(ut),Ot=Gi.get(ut);Fn.set(ut,new Map([...bt?.entries()??[],...Ot?.entries()??[]]))});const $i=[],Lc=[],Wu={};h.forEach(ut=>{const{element:bt,player:Ot,instruction:mn}=ut;if(i.has(bt)){if(D.has(bt))return Ot.onDestroy(()=>Uu(bt,mn.toStyles)),Ot.disabled=!0,Ot.overrideTotalTime(mn.totalTime),void r.push(Ot);let Er=Wu;if(Et.size>1){let vo=bt;const ul=[];for(;vo=vo.parentNode;){const ii=Et.get(vo);if(ii){Er=ii;break}ul.push(vo)}ul.forEach(ii=>Et.set(ii,Er))}const Da=this._buildAnimation(Ot.namespaceId,mn,at,a,Gi,Fn);if(Ot.setRealPlayer(Da),Er===Wu)$i.push(Ot);else{const vo=this.playersByElement.get(Er);vo&&vo.length&&(Ot.parentPlayer=Ud(vo)),r.push(Ot)}}else up(bt,mn.fromStyles),Ot.onDestroy(()=>Uu(bt,mn.toStyles)),Lc.push(Ot),D.has(bt)&&r.push(Ot)}),Lc.forEach(ut=>{const bt=a.get(ut.element);if(bt&&bt.length){const Ot=Ud(bt);ut.setRealPlayer(Ot)}}),r.forEach(ut=>{ut.parentPlayer?ut.syncPlayerEvents(ut.parentPlayer):ut.destroy()});for(let ut=0;ut<ne.length;ut++){const bt=ne[ut],Ot=bt[Ic];if(im(bt,iD),Ot&&Ot.hasAnimation)continue;let mn=[];if(d.size){let Da=d.get(bt);Da&&Da.length&&mn.push(...Da);let vo=this.driver.query(bt,rD,!0);for(let ul=0;ul<vo.length;ul++){let ii=d.get(vo[ul]);ii&&ii.length&&mn.push(...ii)}}const Er=mn.filter(Da=>!Da.destroyed);Er.length?DZ(this,bt,Er):this.processLeaveNode(bt)}return ne.length=0,$i.forEach(ut=>{this.players.push(ut),ut.onDone(()=>{ut.destroy();const bt=this.players.indexOf(ut);this.players.splice(bt,1)}),ut.play()}),$i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,n,i,r,a){let h=[];if(n){const d=this.playersByQueriedElement.get(t);d&&(h=d)}else{const d=this.playersByElement.get(t);if(d){const _=!a||a==Yy;d.forEach(S=>{S.queued||!_&&S.triggerName!=r||h.push(S)})}}return(i||r)&&(h=h.filter(d=>!(i&&i!=d.namespaceId||r&&r!=d.triggerName))),h}_beforeAnimationBuild(t,n,i){const a=n.element,h=n.isRemovalTransition?void 0:t,d=n.isRemovalTransition?void 0:n.triggerName;for(const _ of n.timelines){const S=_.element,D=S!==a,A=rl(i,S,[]);this._getPreviousPlayers(S,D,h,d,n.toState).forEach(k=>{const G=k.getRealPlayer();G.beforeDestroy&&G.beforeDestroy(),k.destroy(),A.push(k)})}up(a,n.fromStyles)}_buildAnimation(t,n,i,r,a,h){const d=n.triggerName,_=n.element,S=[],D=new Set,A=new Set,F=n.timelines.map(G=>{const Y=G.element;D.add(Y);const ne=Y[Ic];if(ne&&ne.removedBeforeQueried)return new Wy(G.duration,G.delay);const fe=Y!==_,ge=function CZ(e){const t=[];return SO(e,t),t}((i.get(Y)||vZ).map(at=>at.getRealPlayer())).filter(at=>!!at.element&&at.element===Y),Le=a.get(Y),je=h.get(Y),Ge=eO(this._normalizer,G.keyframes,Le,je),ot=this._buildPlayer(G,Ge,ge);if(G.subTimeline&&r&&A.add(Y),fe){const at=new xD(t,d,Y);at.setRealPlayer(ot),S.push(at)}return ot});S.forEach(G=>{rl(this.playersByQueriedElement,G.element,[]).push(G),G.onDone(()=>function SZ(e,t,n){let i=e.get(t);if(i){if(i.length){const r=i.indexOf(n);i.splice(r,1)}0==i.length&&e.delete(t)}return i}(this.playersByQueriedElement,G.element,G))}),D.forEach(G=>Ol(G,aO));const k=Ud(F);return k.onDestroy(()=>{D.forEach(G=>im(G,aO)),Uu(_,n.toStyles)}),A.forEach(G=>{rl(r,G,[]).push(k)}),k}_buildPlayer(t,n,i){return n.length>0?this.driver.animate(t.element,n,t.duration,t.delay,t.easing,i):new Wy(t.duration,t.delay)}}class xD{namespaceId;triggerName;element;_player=new Wy;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(t,n,i){this.namespaceId=t,this.triggerName=n,this.element=i}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((n,i)=>{n.forEach(r=>JM(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const n=this._player;n.triggerCallback&&t.onStart(()=>n.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,n){rl(this._queuedCallbacks,t,[]).push(n)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const n=this._player;n.triggerCallback&&n.triggerCallback(t)}}function Fb(e){return e&&1===e.nodeType}function bO(e,t){const n=e.style.display;return e.style.display=t??"none",n}function wO(e,t,n,i,r){const a=[];n.forEach(_=>a.push(bO(_)));const h=[];i.forEach((_,S)=>{const D=new Map;_.forEach(A=>{const F=t.computeStyle(S,A,r);D.set(A,F),(!F||0==F.length)&&(S[Ic]=bZ,h.push(S))}),e.set(S,D)});let d=0;return n.forEach(_=>bO(_,a[d++])),h}function xO(e,t){const n=new Map;if(e.forEach(d=>n.set(d,[])),0==t.length)return n;const r=new Set(t),a=new Map;function h(d){if(!d)return 1;let _=a.get(d);if(_)return _;const S=d.parentNode;return _=n.has(S)?S:r.has(S)?1:h(S),a.set(d,_),_}return t.forEach(d=>{const _=h(d);1!==_&&n.get(_).push(d)}),n}function Ol(e,t){e.classList?.add(t)}function im(e,t){e.classList?.remove(t)}function DZ(e,t,n){Ud(n).onDone(()=>e.processLeaveNode(t))}function SO(e,t){for(let n=0;n<e.length;n++){const i=e[n];i instanceof Qk?SO(i.players,t):t.push(i)}}function EO(e,t,n){const i=n.get(e);if(!i)return!1;let r=t.get(e);return r?i.forEach(a=>r.add(a)):t.set(e,i),n.delete(e),!0}class Xy{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(t,n)=>{};constructor(t,n,i){this._driver=n,this._normalizer=i,this._transitionEngine=new xZ(t.body,n,i),this._timelineEngine=new pZ(t.body,n,i),this._transitionEngine.onRemovalComplete=(r,a)=>this.onRemovalComplete(r,a)}registerTrigger(t,n,i,r,a){const h=t+"-"+r;let d=this._triggerCache[h];if(!d){const _=[],D=fD(this._driver,a,_,[]);if(_.length)throw function mW(){return new Te(3404,!1)}();d=function uZ(e,t,n){return new hZ(e,t,n)}(r,D,this._normalizer),this._triggerCache[h]=d}this._transitionEngine.registerTrigger(n,r,d)}register(t,n){this._transitionEngine.register(t,n)}destroy(t,n){this._transitionEngine.destroy(t,n)}onInsert(t,n,i,r){this._transitionEngine.insertNode(t,n,i,r)}onRemove(t,n,i){this._transitionEngine.removeNode(t,n,i)}disableAnimations(t,n){this._transitionEngine.markElementAsDisabled(t,n)}process(t,n,i,r){if("@"==i.charAt(0)){const[a,h]=tO(i);this._timelineEngine.command(a,n,h,r)}else this._transitionEngine.trigger(t,n,i,r)}listen(t,n,i,r,a){if("@"==i.charAt(0)){const[h,d]=tO(i);return this._timelineEngine.listen(h,n,d,a)}return this._transitionEngine.listen(t,n,i,r,a)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}}let AZ=(()=>{class e{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(n,i,r){this._element=n,this._startStyles=i,this._endStyles=r;let a=e.initialStylesByElement.get(n);a||e.initialStylesByElement.set(n,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&Uu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Uu(this._element,this._initialStyles),this._endStyles&&(Uu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(up(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(up(this._element,this._endStyles),this._endStyles=null),Uu(this._element,this._initialStyles),this._state=3)}}return e})();function SD(e){let t=null;return e.forEach((n,i)=>{(function PZ(e){return"display"===e||"position"===e})(i)&&(t=t||new Map,t.set(i,n))}),t}class MO{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(t,n,i,r){this.element=t,this.keyframes=n,this.options=i,this._specialStyles=r,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map;const n=()=>this._onFinish();this.domPlayer.addEventListener("finish",n),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",n)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const n=[];return t.forEach(i=>{n.push(Object.fromEntries(i))}),n}_triggerWebAnimation(t,n,i){return t.animate(this._convertKeyframesToObject(n),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:lD(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const n="start"===t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}class DO{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}containsElement(t,n){return iO(t,n)}getParentElement(t){return nD(t)}query(t,n,i){return rO(t,n,i)}computeStyle(t,n,i){return lD(t,n)}animate(t,n,i,r,a,h=[]){const _={duration:i,delay:r,fill:0==r?"both":"forwards"};a&&(_.easing=a);const S=new Map,D=h.filter(k=>k instanceof MO);(function jW(e,t){return 0===e||0===t})(i,r)&&D.forEach(k=>{k.currentSnapshot.forEach((G,Y)=>S.set(Y,G))});let A=function LW(e){return e.length?e[0]instanceof Map?e:e.map(t=>new Map(Object.entries(t))):[]}(n).map(k=>new Map(k));A=function VW(e,t,n){if(n.size&&t.length){let i=t[0],r=[];if(n.forEach((a,h)=>{i.has(h)||r.push(h),i.set(h,a)}),r.length)for(let a=1;a<t.length;a++){let h=t[a];r.forEach(d=>h.set(d,lD(e,d)))}}return t}(t,A,S);const F=function IZ(e,t){let n=null,i=null;return Array.isArray(t)&&t.length?(n=SD(t[0]),t.length>1&&(i=SD(t[t.length-1]))):t instanceof Map&&(n=SD(t)),n||i?new AZ(e,n,i):null}(t,A);return new MO(t,A,_,F)}}const CO="@.disabled";class TO{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(t,n,i,r){this.namespaceId=t,this.delegate=n,this.engine=i,this._onDestroy=r}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,n){return this.delegate.createElement(t,n)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,n){this.delegate.appendChild(t,n),this.engine.onInsert(this.namespaceId,n,t,!1)}insertBefore(t,n,i,r=!0){this.delegate.insertBefore(t,n,i),this.engine.onInsert(this.namespaceId,n,t,r)}removeChild(t,n,i){this.parentNode(n)&&this.engine.onRemove(this.namespaceId,n,this.delegate)}selectRootElement(t,n){return this.delegate.selectRootElement(t,n)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,n,i,r){this.delegate.setAttribute(t,n,i,r)}removeAttribute(t,n,i){this.delegate.removeAttribute(t,n,i)}addClass(t,n){this.delegate.addClass(t,n)}removeClass(t,n){this.delegate.removeClass(t,n)}setStyle(t,n,i,r){this.delegate.setStyle(t,n,i,r)}removeStyle(t,n,i){this.delegate.removeStyle(t,n,i)}setProperty(t,n,i){"@"==n.charAt(0)&&n==CO?this.disableAnimations(t,!!i):this.delegate.setProperty(t,n,i)}setValue(t,n){this.delegate.setValue(t,n)}listen(t,n,i,r){return this.delegate.listen(t,n,i,r)}disableAnimations(t,n){this.engine.disableAnimations(t,n)}}class RZ extends TO{factory;constructor(t,n,i,r,a){super(n,i,r,a),this.factory=t,this.namespaceId=n}setProperty(t,n,i){"@"==n.charAt(0)?"."==n.charAt(1)&&n==CO?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,n.slice(1),i):this.delegate.setProperty(t,n,i)}listen(t,n,i,r){if("@"==n.charAt(0)){const a=function NZ(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(t);let h=n.slice(1),d="";return"@"!=h.charAt(0)&&([h,d]=function kZ(e){const t=e.indexOf(".");return[e.substring(0,t),e.slice(t+1)]}(h)),this.engine.listen(this.namespaceId,a,h,d,_=>{this.factory.scheduleListenerCallback(_._data||-1,i,_)})}return this.delegate.listen(t,n,i,r)}}class OZ{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(t,n,i){this.delegate=t,this.engine=n,this._zone=i,n.onRemovalComplete=(r,a)=>{a?.removeChild(null,r)}}createRenderer(t,n){const r=this.delegate.createRenderer(t,n);if(!t||!n?.data?.animation){const S=this._rendererCache;let D=S.get(r);return D||(D=new TO("",r,this.engine,()=>S.delete(r)),S.set(r,D)),D}const a=n.id,h=n.id+"-"+this._currentId;this._currentId++,this.engine.register(h,t);const d=S=>{Array.isArray(S)?S.forEach(d):this.engine.registerTrigger(a,h,t,S.name,S)};return n.data.animation.forEach(d),new RZ(this,h,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,n,i){if(t>=0&&t<this._microtaskId)return void this._zone.run(()=>n(i));const r=this._animationCallbacksBuffer;0==r.length&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(a=>{const[h,d]=a;h(d)}),this._animationCallbacksBuffer=[]})}),r.push([n,i])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(t){this.engine.flush(),this.delegate.componentReplaced?.(t)}}const jZ=[{provide:uD,useFactory:()=>new DO},{provide:xv,useFactory:()=>"BrowserAnimations"},...[{provide:hD,useFactory:function LZ(){return new cO}},{provide:Xy,useClass:(()=>{class e extends Xy{constructor(n,i,r){super(n,i,r)}ngOnDestroy(){this.flush()}static \u0275fac=function(i){return new(i||e)(Ft(ke),Ft(uD),Ft(hD))};static \u0275prov=Xe({token:e,factory:e.\u0275fac})}return e})()},{provide:l1,useFactory:function BZ(e,t,n){return new OZ(e,t,n)},deps:[cM,Xy,vn]}]],UZ={providers:[function Ht(){return eh([(e=()=>{me(Ii)},eh([{provide:ea,multi:!0,useValue:e}]))]);var e}(),function iG(){return Zo("NgZoneless"),eh([{provide:Pr,useExisting:qE},{provide:vn,useClass:YS},{provide:ca,useValue:!0},{provide:El,useValue:!1},[]])}(),function Hq(e,...t){return eh([{provide:WM,multi:!0,useValue:e},[],{provide:Qg,useFactory:qk,deps:[nm]},{provide:dA,multi:!0,useFactory:Wk},t.map(n=>n.\u0275providers)])}([]),function VZ(){return Zo("NgEagerAnimations"),[...jZ]}()]};var Bb=Gl(44);const HZ=["addListener","removeListener"],qZ=["addEventListener","removeEventListener"],WZ=["on","off"];function es(e,t,n,i){if(cn(n)&&(i=n,n=void 0),i)return es(e,t,n).pipe(wM(i));const[r,a]=function YZ(e){return cn(e.addEventListener)&&cn(e.removeEventListener)}(e)?qZ.map(h=>d=>e[h](t,d,n)):function ZZ(e){return cn(e.addListener)&&cn(e.removeListener)}(e)?HZ.map(AO(e,t)):function KZ(e){return cn(e.on)&&cn(e.off)}(e)?WZ.map(AO(e,t)):[];if(!r&&vM(e))return Jo(h=>es(h,t,n))(Xo(e));if(!r)throw new TypeError("Invalid event target");return new qt(h=>{const d=(..._)=>h.next(1<_.length?_:_[0]);return r(d),()=>a(d)})}function AO(e,t){return n=>i=>e[n](t,i)}class XZ extends Si{constructor(t,n){super()}schedule(t,n=0){return this}}const zb={setInterval(e,t,...n){const{delegate:i}=zb;return i?.setInterval?i.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=zb;return(t?.clearInterval||clearInterval)(e)},delegate:void 0},PO={now:()=>(PO.delegate||Date).now(),delegate:void 0};class Qy{constructor(t,n=Qy.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,i){return new this.schedulerActionCtor(this,t).schedule(i,n)}}Qy.now=PO.now;const RO=new class JZ extends Qy{constructor(t,n=Qy.now){super(t,n),this.actions=[],this._active=!1}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}}}(class QZ extends XZ{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){var i;if(this.closed)return this;this.state=t;const r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,n)),this.pending=!0,this.delay=n,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(a,this.id,n),this}requestAsyncId(t,n,i=0){return zb.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,n,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return n;null!=n&&zb.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let r,i=!1;try{this.work(t)}catch(a){i=!0,r=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:i}=n;this.work=this.state=this.scheduler=null,this.pending=!1,Ks(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}),eK=RO;const{isArray:nK}=Array;function OO(...e){return 1===(e=function kO(e){return 1===e.length&&nK(e[0])?e[0]:e}(e)).length?Xo(e[0]):new qt(function iK(e){return t=>{let n=[];for(let i=0;n&&!t.closed&&i<e.length;i++)n.push(Xo(e[i]).subscribe(di(t,r=>{if(n){for(let a=0;a<n.length;a++)a!==i&&n[a].unsubscribe();n=null}t.next(r)})))}}(e))}function FO(e,t){return t?n=>ky(t.pipe(kl(1),function sK(){return Nr((e,t)=>{e.subscribe(di(t,X))})}()),n.pipe(FO(e))):Jo((n,i)=>Xo(e(n,i)).pipe(kl(1),function aK(e){return wn(()=>e)}(n)))}class YK{$implicit;ngForOf;index;count;constructor(t,n,i,r){this.$implicit=t,this.ngForOf=n,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let ZO=(()=>{class e{_viewContainer;_template;_differs;set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(n,i,r){this._viewContainer=n,this._template=i,this._differs=r}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const i=this._viewContainer;n.forEachOperation((r,a,h)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new YK(r.item,this._ngForOf,-1,-1),null===h?void 0:h);else if(null==h)i.remove(null===a?void 0:a);else if(null!==a){const d=i.get(a);i.move(d,h),KO(d,r)}});for(let r=0,a=i.length;r<a;r++){const d=i.get(r).context;d.index=r,d.count=a,d.ngForOf=this._ngForOf}n.forEachIdentityChange(r=>{KO(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(n,i){return!0}static \u0275fac=function(i){return new(i||e)(et(el),et(ro),et(XE))};static \u0275dir=lt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return e})();function KO(e,t){e.context.$implicit=t.item}let MY=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=Ur({type:e});static \u0275inj=Hn({})}return e})();Promise.resolve(),Promise.resolve();var IX={left:"right",right:"left",bottom:"top",top:"bottom"};function dw(e){return e.replace(/left|right|bottom|top/g,function(t){return IX[t]})}function Gu(e){return e.split("-")[0]}var AX={start:"end",end:"start"};function tL(e){return e.replace(/start|end/g,function(t){return AX[t]})}var al="top",Rc="bottom",Nc="right",ll="left",lC="auto",l0=[al,Rc,Nc,ll],am="start",c0="end",nL="viewport",u0="popper",iL=l0.reduce(function(e,t){return e.concat([t+"-"+am,t+"-"+c0])},[]),rL=[].concat(l0,[lC]).reduce(function(e,t){return e.concat([t,t+"-"+am,t+"-"+c0])},[]),UX=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function cl(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function pp(e){return e instanceof cl(e).Element||e instanceof Element}function zl(e){return e instanceof cl(e).HTMLElement||e instanceof HTMLElement}function cC(e){return!(typeof ShadowRoot>"u")&&(e instanceof cl(e).ShadowRoot||e instanceof ShadowRoot)}function qd(e){return((pp(e)?e.ownerDocument:e.document)||window.document).documentElement}var gp=Math.max,fw=Math.min,lm=Math.round;function uC(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function oL(){return!/^((?!chrome|android).)*safari/i.test(uC())}function cm(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=e.getBoundingClientRect(),r=1,a=1;t&&zl(e)&&(r=e.offsetWidth>0&&lm(i.width)/e.offsetWidth||1,a=e.offsetHeight>0&&lm(i.height)/e.offsetHeight||1);var d=(pp(e)?cl(e):window).visualViewport,_=!oL()&&n,S=(i.left+(_&&d?d.offsetLeft:0))/r,D=(i.top+(_&&d?d.offsetTop:0))/a,A=i.width/r,F=i.height/a;return{width:A,height:F,top:D,right:S+A,bottom:D+F,left:S,x:S,y:D}}function hC(e){var t=cl(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function dC(e){return cm(qd(e)).left+hC(e).scrollLeft}function zh(e){return cl(e).getComputedStyle(e)}function $u(e){return e?(e.nodeName||"").toLowerCase():null}function pw(e){return"html"===$u(e)?e:e.assignedSlot||e.parentNode||(cC(e)?e.host:null)||qd(e)}function fC(e){var t=zh(e);return/auto|scroll|overlay|hidden/.test(t.overflow+t.overflowY+t.overflowX)}function sL(e){return["html","body","#document"].indexOf($u(e))>=0?e.ownerDocument.body:zl(e)&&fC(e)?e:sL(pw(e))}function h0(e,t){var n;void 0===t&&(t=[]);var i=sL(e),r=i===(null==(n=e.ownerDocument)?void 0:n.body),a=cl(i),h=r?[a].concat(a.visualViewport||[],fC(i)?i:[]):i,d=t.concat(h);return r?d:d.concat(h0(pw(h)))}function HX(e){return["table","td","th"].indexOf($u(e))>=0}function aL(e){return zl(e)&&"fixed"!==zh(e).position?e.offsetParent:null}function d0(e){for(var t=cl(e),n=aL(e);n&&HX(n)&&"static"===zh(n).position;)n=aL(n);return n&&("html"===$u(n)||"body"===$u(n)&&"static"===zh(n).position)?t:n||function qX(e){var t=/firefox/i.test(uC());if(/Trident/i.test(uC())&&zl(e)&&"fixed"===zh(e).position)return null;var r=pw(e);for(cC(r)&&(r=r.host);zl(r)&&["html","body"].indexOf($u(r))<0;){var a=zh(r);if("none"!==a.transform||"none"!==a.perspective||"paint"===a.contain||-1!==["transform","perspective"].indexOf(a.willChange)||t&&"filter"===a.willChange||t&&a.filter&&"none"!==a.filter)return r;r=r.parentNode}return null}(e)||t}function lL(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&cC(n)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function pC(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function cL(e,t,n){return t===nL?pC(function GX(e,t){var n=cl(e),i=qd(e),r=n.visualViewport,a=i.clientWidth,h=i.clientHeight,d=0,_=0;if(r){a=r.width,h=r.height;var S=oL();(S||!S&&"fixed"===t)&&(d=r.offsetLeft,_=r.offsetTop)}return{width:a,height:h,x:d+dC(e),y:_}}(e,n)):pp(t)?function WX(e,t){var n=cm(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):pC(function $X(e){var t,n=qd(e),i=hC(e),r=null==(t=e.ownerDocument)?void 0:t.body,a=gp(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),h=gp(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),d=-i.scrollLeft+dC(e),_=-i.scrollTop;return"rtl"===zh(r||n).direction&&(d+=gp(n.clientWidth,r?r.clientWidth:0)-a),{width:a,height:h,x:d,y:_}}(qd(e)))}function um(e){return e.split("-")[1]}function gC(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function uL(e){var _,t=e.reference,n=e.element,i=e.placement,r=i?Gu(i):null,a=i?um(i):null,h=t.x+t.width/2-n.width/2,d=t.y+t.height/2-n.height/2;switch(r){case al:_={x:h,y:t.y-n.height};break;case Rc:_={x:h,y:t.y+t.height};break;case Nc:_={x:t.x+t.width,y:d};break;case ll:_={x:t.x-n.width,y:d};break;default:_={x:t.x,y:t.y}}var S=r?gC(r):null;if(null!=S){var D="y"===S?"height":"width";switch(a){case am:_[S]=_[S]-(t[D]/2-n[D]/2);break;case c0:_[S]=_[S]+(t[D]/2-n[D]/2)}}return _}function dL(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function fL(e,t){return t.reduce(function(n,i){return n[i]=e,n},{})}function mC(e,t){void 0===t&&(t={});var i=t.placement,r=void 0===i?e.placement:i,a=t.strategy,h=void 0===a?e.strategy:a,d=t.boundary,_=void 0===d?"clippingParents":d,S=t.rootBoundary,D=void 0===S?nL:S,A=t.elementContext,F=void 0===A?u0:A,k=t.altBoundary,G=void 0!==k&&k,Y=t.padding,ne=void 0===Y?0:Y,fe=dL("number"!=typeof ne?ne:fL(ne,l0)),Le=e.rects.popper,je=e.elements[G?F===u0?"reference":u0:F],Ge=function KX(e,t,n,i){var r="clippingParents"===t?function ZX(e){var t=h0(pw(e)),i=["absolute","fixed"].indexOf(zh(e).position)>=0&&zl(e)?d0(e):e;return pp(i)?t.filter(function(r){return pp(r)&&lL(r,i)&&"body"!==$u(r)}):[]}(e):[].concat(t),a=[].concat(r,[n]),d=a.reduce(function(_,S){var D=cL(e,S,i);return _.top=gp(D.top,_.top),_.right=fw(D.right,_.right),_.bottom=fw(D.bottom,_.bottom),_.left=gp(D.left,_.left),_},cL(e,a[0],i));return d.width=d.right-d.left,d.height=d.bottom-d.top,d.x=d.left,d.y=d.top,d}(pp(je)?je:je.contextElement||qd(e.elements.popper),_,D,h),ot=cm(e.elements.reference),at=uL({reference:ot,element:Le,strategy:"absolute",placement:r}),Et=pC(Object.assign({},Le,at)),en=F===u0?Et:ot,Fn={top:Ge.top-en.top+fe.top,bottom:en.bottom-Ge.bottom+fe.bottom,left:Ge.left-en.left+fe.left,right:en.right-Ge.right+fe.right},Kn=e.modifiersData.offset;if(F===u0&&Kn){var Gi=Kn[r];Object.keys(Fn).forEach(function($i){var Lc=[Nc,Rc].indexOf($i)>=0?1:-1,Wu=[al,Rc].indexOf($i)>=0?"y":"x";Fn[$i]+=Gi[Wu]*Lc})}return Fn}const JX={name:"flip",enabled:!0,phase:"main",fn:function QX(e){var t=e.state,n=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var r=n.mainAxis,a=void 0===r||r,h=n.altAxis,d=void 0===h||h,_=n.fallbackPlacements,S=n.padding,D=n.boundary,A=n.rootBoundary,F=n.altBoundary,k=n.flipVariations,G=void 0===k||k,Y=n.allowedAutoPlacements,ne=t.options.placement,fe=Gu(ne),Le=_||(fe!==ne&&G?function XX(e){if(Gu(e)===lC)return[];var t=dw(e);return[tL(e),t,tL(t)]}(ne):[dw(ne)]),je=[ne].concat(Le).reduce(function(ii,Bc){return ii.concat(Gu(Bc)===lC?function YX(e,t){void 0===t&&(t={});var r=t.boundary,a=t.rootBoundary,h=t.padding,d=t.flipVariations,_=t.allowedAutoPlacements,S=void 0===_?rL:_,D=um(t.placement),A=D?d?iL:iL.filter(function(G){return um(G)===D}):l0,F=A.filter(function(G){return S.indexOf(G)>=0});0===F.length&&(F=A);var k=F.reduce(function(G,Y){return G[Y]=mC(e,{placement:Y,boundary:r,rootBoundary:a,padding:h})[Gu(Y)],G},{});return Object.keys(k).sort(function(G,Y){return k[G]-k[Y]})}(t,{placement:Bc,boundary:D,rootBoundary:A,padding:S,flipVariations:G,allowedAutoPlacements:Y}):Bc)},[]),Ge=t.rects.reference,ot=t.rects.popper,at=new Map,Et=!0,en=je[0],Fn=0;Fn<je.length;Fn++){var Kn=je[Fn],Gi=Gu(Kn),$i=um(Kn)===am,Lc=[al,Rc].indexOf(Gi)>=0,Wu=Lc?"width":"height",ut=mC(t,{placement:Kn,boundary:D,rootBoundary:A,altBoundary:F,padding:S}),bt=Lc?$i?Nc:ll:$i?Rc:al;Ge[Wu]>ot[Wu]&&(bt=dw(bt));var Ot=dw(bt),mn=[];if(a&&mn.push(ut[Gi]<=0),d&&mn.push(ut[bt]<=0,ut[Ot]<=0),mn.every(function(ii){return ii})){en=Kn,Et=!1;break}at.set(Kn,mn)}if(Et)for(var Da=function(Bc){var Mp=je.find(function(Hr){var Us=at.get(Hr);if(Us)return Us.slice(0,Bc).every(function(Ss){return Ss})});if(Mp)return en=Mp,"break"},vo=G?3:1;vo>0&&"break"!==Da(vo);vo--);t.placement!==en&&(t.modifiersData[i]._skip=!0,t.placement=en,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function f0(e,t,n){return gp(e,fw(t,n))}function _C(e){var t=cm(e),n=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:i}}const iQ={name:"preventOverflow",enabled:!0,phase:"main",fn:function nQ(e){var t=e.state,n=e.options,i=e.name,r=n.mainAxis,a=void 0===r||r,h=n.altAxis,d=void 0!==h&&h,F=n.tether,k=void 0===F||F,G=n.tetherOffset,Y=void 0===G?0:G,ne=mC(t,{boundary:n.boundary,rootBoundary:n.rootBoundary,padding:n.padding,altBoundary:n.altBoundary}),fe=Gu(t.placement),ge=um(t.placement),Le=!ge,je=gC(fe),Ge=function eQ(e){return"x"===e?"y":"x"}(je),ot=t.modifiersData.popperOffsets,at=t.rects.reference,Et=t.rects.popper,en="function"==typeof Y?Y(Object.assign({},t.rects,{placement:t.placement})):Y,Fn="number"==typeof en?{mainAxis:en,altAxis:en}:Object.assign({mainAxis:0,altAxis:0},en),Kn=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,Gi={x:0,y:0};if(ot){if(a){var $i,Lc="y"===je?al:ll,Wu="y"===je?Rc:Nc,ut="y"===je?"height":"width",bt=ot[je],Ot=bt+ne[Lc],mn=bt-ne[Wu],Er=k?-Et[ut]/2:0,Da=ge===am?at[ut]:Et[ut],vo=ge===am?-Et[ut]:-at[ut],ul=t.elements.arrow,ii=k&&ul?_C(ul):{width:0,height:0},Bc=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Mp=Bc[Lc],Hr=Bc[Wu],Us=f0(0,at[ut],ii[ut]),Ss=Le?at[ut]/2-Er-Us-Mp-Fn.mainAxis:Da-Us-Mp-Fn.mainAxis,Dm=Le?-at[ut]/2+Er+Us+Hr+Fn.mainAxis:vo+Us+Hr+Fn.mainAxis,Dp=t.elements.arrow&&d0(t.elements.arrow),nae=Dp?"y"===je?Dp.clientTop||0:Dp.clientLeft||0:0,n4=null!=($i=Kn?.[je])?$i:0,rae=bt+Dm-n4,i4=f0(k?fw(Ot,bt+Ss-n4-nae):Ot,bt,k?gp(mn,rae):mn);ot[je]=i4,Gi[je]=i4-bt}if(d){var r4,Cp=ot[Ge],qw="y"===Ge?"height":"width",o4=Cp+ne["x"===je?al:ll],s4=Cp-ne["x"===je?Rc:Nc],iT=-1!==[al,ll].indexOf(fe),a4=null!=(r4=Kn?.[Ge])?r4:0,l4=iT?o4:Cp-at[qw]-Et[qw]-a4+Fn.altAxis,c4=iT?Cp+at[qw]+Et[qw]-a4-Fn.altAxis:s4,u4=k&&iT?function tQ(e,t,n){var i=f0(e,t,n);return i>n?n:i}(l4,Cp,c4):f0(k?l4:o4,Cp,k?c4:s4);ot[Ge]=u4,Gi[Ge]=u4-Cp}t.modifiersData[i]=Gi}},requiresIfExists:["offset"]},aQ={name:"arrow",enabled:!0,phase:"main",fn:function oQ(e){var t,n=e.state,i=e.name,r=e.options,a=n.elements.arrow,h=n.modifiersData.popperOffsets,d=Gu(n.placement),_=gC(d),D=[ll,Nc].indexOf(d)>=0?"height":"width";if(a&&h){var A=function(t,n){return dL("number"!=typeof(t="function"==typeof t?t(Object.assign({},n.rects,{placement:n.placement})):t)?t:fL(t,l0))}(r.padding,n),F=_C(a),k="y"===_?al:ll,G="y"===_?Rc:Nc,Y=n.rects.reference[D]+n.rects.reference[_]-h[_]-n.rects.popper[D],ne=h[_]-n.rects.reference[_],fe=d0(a),ge=fe?"y"===_?fe.clientHeight||0:fe.clientWidth||0:0,ot=ge/2-F[D]/2+(Y/2-ne/2),at=f0(A[k],ot,ge-F[D]-A[G]);n.modifiersData[i]=((t={})[_]=at,t.centerOffset=at-ot,t)}},effect:function sQ(e){var t=e.state,i=e.options.element,r=void 0===i?"[data-popper-arrow]":i;null!=r&&("string"==typeof r&&!(r=t.elements.popper.querySelector(r))||lL(t.elements.popper,r)&&(t.elements.arrow=r))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function hQ(e,t,n){void 0===n&&(n=!1);var i=zl(t),r=zl(t)&&function uQ(e){var t=e.getBoundingClientRect(),n=lm(t.width)/e.offsetWidth||1,i=lm(t.height)/e.offsetHeight||1;return 1!==n||1!==i}(t),a=qd(t),h=cm(e,r,n),d={scrollLeft:0,scrollTop:0},_={x:0,y:0};return(i||!i&&!n)&&(("body"!==$u(t)||fC(a))&&(d=function cQ(e){return e!==cl(e)&&zl(e)?function lQ(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}(e):hC(e)}(t)),zl(t)?((_=cm(t,!0)).x+=t.clientLeft,_.y+=t.clientTop):a&&(_.x=dC(a))),{x:h.left+d.scrollLeft-_.x,y:h.top+d.scrollTop-_.y,width:h.width,height:h.height}}function dQ(e){var t=new Map,n=new Set,i=[];function r(a){n.add(a.name),[].concat(a.requires||[],a.requiresIfExists||[]).forEach(function(d){if(!n.has(d)){var _=t.get(d);_&&r(_)}}),i.push(a)}return e.forEach(function(a){t.set(a.name,a)}),e.forEach(function(a){n.has(a.name)||r(a)}),i}function pQ(e){var t;return function(){return t||(t=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(e())})})),t}}var pL={placement:"bottom",modifiers:[],strategy:"absolute"};function gL(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(i){return!(i&&"function"==typeof i.getBoundingClientRect)})}function mQ(e){void 0===e&&(e={});var n=e.defaultModifiers,i=void 0===n?[]:n,r=e.defaultOptions,a=void 0===r?pL:r;return function(d,_,S){void 0===S&&(S=a);var D={placement:"bottom",orderedModifiers:[],options:Object.assign({},pL,a),modifiersData:{},elements:{reference:d,popper:_},attributes:{},styles:{}},A=[],F=!1,k={state:D,setOptions:function(fe){var ge="function"==typeof fe?fe(D.options):fe;Y(),D.options=Object.assign({},a,D.options,ge),D.scrollParents={reference:pp(d)?h0(d):d.contextElement?h0(d.contextElement):[],popper:h0(_)};var Le=function fQ(e){var t=dQ(e);return UX.reduce(function(n,i){return n.concat(t.filter(function(r){return r.phase===i}))},[])}(function gQ(e){var t=e.reduce(function(n,i){var r=n[i.name];return n[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,n},{});return Object.keys(t).map(function(n){return t[n]})}([].concat(i,D.options.modifiers)));return D.orderedModifiers=Le.filter(function(je){return je.enabled}),function G(){D.orderedModifiers.forEach(function(ne){var ge=ne.options,je=ne.effect;if("function"==typeof je){var Ge=je({state:D,name:ne.name,instance:k,options:void 0===ge?{}:ge});A.push(Ge||function(){})}})}(),k.update()},forceUpdate:function(){if(!F){var fe=D.elements,ge=fe.reference,Le=fe.popper;if(gL(ge,Le)){D.rects={reference:hQ(ge,d0(Le),"fixed"===D.options.strategy),popper:_C(Le)},D.reset=!1,D.placement=D.options.placement,D.orderedModifiers.forEach(function(Fn){return D.modifiersData[Fn.name]=Object.assign({},Fn.data)});for(var je=0;je<D.orderedModifiers.length;je++)if(!0!==D.reset){var Ge=D.orderedModifiers[je],ot=Ge.fn,at=Ge.options;"function"==typeof ot&&(D=ot({state:D,options:void 0===at?{}:at,name:Ge.name,instance:k})||D)}else D.reset=!1,je=-1}}},update:pQ(function(){return new Promise(function(ne){k.forceUpdate(),ne(D)})}),destroy:function(){Y(),F=!0}};if(!gL(d,_))return k;function Y(){A.forEach(function(ne){return ne()}),A=[]}return k.setOptions(S).then(function(ne){!F&&S.onFirstUpdate&&S.onFirstUpdate(ne)}),k}}var gw={passive:!0},wQ={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mL(e){var t,n=e.popper,i=e.popperRect,r=e.placement,a=e.variation,h=e.offsets,d=e.position,_=e.gpuAcceleration,S=e.adaptive,D=e.roundOffsets,A=e.isFixed,F=h.x,k=void 0===F?0:F,G=h.y,Y=void 0===G?0:G,ne="function"==typeof D?D({x:k,y:Y}):{x:k,y:Y};k=ne.x,Y=ne.y;var fe=h.hasOwnProperty("x"),ge=h.hasOwnProperty("y"),Le=ll,je=al,Ge=window;if(S){var ot=d0(n),at="clientHeight",Et="clientWidth";ot===cl(n)&&"static"!==zh(ot=qd(n)).position&&"absolute"===d&&(at="scrollHeight",Et="scrollWidth"),(r===al||(r===ll||r===Nc)&&a===c0)&&(je=Rc,Y-=(A&&ot===Ge&&Ge.visualViewport?Ge.visualViewport.height:ot[at])-i.height,Y*=_?1:-1),r!==ll&&(r!==al&&r!==Rc||a!==c0)||(Le=Nc,k-=(A&&ot===Ge&&Ge.visualViewport?Ge.visualViewport.width:ot[Et])-i.width,k*=_?1:-1)}var $i,Kn=Object.assign({position:d},S&&wQ),Gi=!0===D?function xQ(e,t){var i=e.y,r=t.devicePixelRatio||1;return{x:lm(e.x*r)/r||0,y:lm(i*r)/r||0}}({x:k,y:Y},cl(n)):{x:k,y:Y};return k=Gi.x,Y=Gi.y,Object.assign({},Kn,_?(($i={})[je]=ge?"0":"",$i[Le]=fe?"0":"",$i.transform=(Ge.devicePixelRatio||1)<=1?"translate("+k+"px, "+Y+"px)":"translate3d("+k+"px, "+Y+"px, 0)",$i):((t={})[je]=ge?Y+"px":"",t[Le]=fe?k+"px":"",t.transform="",t))}var TQ=mQ({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function _Q(e){var t=e.state,n=e.instance,i=e.options,r=i.scroll,a=void 0===r||r,h=i.resize,d=void 0===h||h,_=cl(t.elements.popper),S=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&S.forEach(function(D){D.addEventListener("scroll",n.update,gw)}),d&&_.addEventListener("resize",n.update,gw),function(){a&&S.forEach(function(D){D.removeEventListener("scroll",n.update,gw)}),d&&_.removeEventListener("resize",n.update,gw)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function vQ(e){var t=e.state;t.modifiersData[e.name]=uL({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function SQ(e){var t=e.state,n=e.options,i=n.gpuAcceleration,r=void 0===i||i,a=n.adaptive,h=void 0===a||a,d=n.roundOffsets,_=void 0===d||d,S={placement:Gu(t.placement),variation:um(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,mL(Object.assign({},S,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:h,roundOffsets:_})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,mL(Object.assign({},S,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:_})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function MQ(e){var t=e.state;Object.keys(t.elements).forEach(function(n){var i=t.styles[n]||{},r=t.attributes[n]||{},a=t.elements[n];!zl(a)||!$u(a)||(Object.assign(a.style,i),Object.keys(r).forEach(function(h){var d=r[h];!1===d?a.removeAttribute(h):a.setAttribute(h,!0===d?"":d)}))})},effect:function DQ(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(i){var r=t.elements[i],a=t.attributes[i]||{},d=Object.keys(t.styles.hasOwnProperty(i)?t.styles[i]:n[i]).reduce(function(_,S){return _[S]="",_},{});!zl(r)||!$u(r)||(Object.assign(r.style,d),Object.keys(a).forEach(function(_){r.removeAttribute(_)}))})}},requires:["computeStyles"]}]});const PQ={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function AQ(e){var t=e.state,i=e.name,r=e.options.offset,a=void 0===r?[0,0]:r,h=rL.reduce(function(D,A){return D[A]=function IQ(e,t,n){var i=Gu(e),r=[ll,al].indexOf(i)>=0?-1:1,a="function"==typeof n?n(Object.assign({},t,{placement:e})):n,h=a[0],d=a[1];return h=h||0,d=(d||0)*r,[ll,Nc].indexOf(i)>=0?{x:d,y:h}:{x:h,y:d}}(A,t.rects,a),D},{}),d=h[t.placement],S=d.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=d.x,t.modifiersData.popperOffsets.y+=S),t.modifiersData[i]=h}};function SL(e=document){const t=e?.activeElement;return t?t.shadowRoot?SL(t.shadowRoot):t:null}const xw=(e,t)=>!!t&&t.some(n=>n.contains(e)),NL=(e,t)=>!t||null!=function tee(e,t){return!t||typeof e.closest>"u"?null:e.closest(t)}(e,t),Oee=typeof navigator<"u"&&!!navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));function kL(e,t,n,i,r,a,h,d){n&&e.runOutsideAngular((e=>Oee?()=>setTimeout(()=>e(),100):e)(()=>{const S=es(t,"keydown").pipe(Ro(r),Ao(F=>"Escape"===F.key),Po(F=>F.preventDefault())),D=es(t,"mousedown").pipe(wn(F=>{const k=F.target;return 2!==F.button&&!xw(k,h)&&("inside"===n?xw(k,a)&&NL(k,d):"outside"===n?!xw(k,a):NL(k,d)||!xw(k,a))}),Ro(r)),A=es(t,"mouseup").pipe(function MD(...e){const t=rb(e);return Nr((n,i)=>{const r=e.length,a=new Array(r);let h=e.map(()=>!1),d=!1;for(let _=0;_<r;_++)Xo(e[_]).subscribe(di(i,S=>{a[_]=S,!d&&!h[_]&&(h[_]=!0,(d=h.every(Un))&&(h=null))},X));n.subscribe(di(i,_=>{if(d){const S=[_,...a];i.next(t?t(...S):S)}}))})}(D),Ao(([F,k])=>k),function lK(e,t=RO){const n=function NO(e=0,t,n=eK){let i=-1;return null!=t&&($N(t)?n=t:i=t),new qt(r=>{let a=function tK(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;a<0&&(a=0);let h=0;return n.schedule(function(){r.closed||(r.next(h++),0<=i?this.schedule(void 0,i):r.complete())},a)})}(e,t);return FO(()=>n)}(0),Ro(r));OO([S.pipe(wn(F=>0)),A.pipe(wn(F=>1))]).subscribe(F=>e.run(()=>i(F)))}))}const OL=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");let Lee=(()=>{var e;class t{constructor(){this._element=me(ke).documentElement}isRTL(){return"rtl"===(this._element.getAttribute("dir")||"").toLowerCase()}static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275prov=Xe({token:t,factory:t.\u0275fac,providedIn:"root"}))}return e(),t})();const Bee=/\s+/,zee=/  +/gi,jee={top:["top"],bottom:["bottom"],start:["left","right"],left:["left"],end:["right","left"],right:["right"],"top-start":["top-start","top-end"],"top-left":["top-start"],"top-end":["top-end","top-start"],"top-right":["top-end"],"bottom-start":["bottom-start","bottom-end"],"bottom-left":["bottom-start"],"bottom-end":["bottom-end","bottom-start"],"bottom-right":["bottom-end"],"start-top":["left-start","right-start"],"left-top":["left-start"],"start-bottom":["left-end","right-end"],"left-bottom":["left-end"],"end-top":["right-start","left-start"],"right-top":["right-start"],"end-bottom":["right-end","left-end"],"right-bottom":["right-end"]},Uee=/^left/,Gee=/^right/,$ee=/^start/,Hee=/^end/;function BL({placement:e,baseClass:t},n){let i=Array.isArray(e)?e:e.split(Bee),a=i.findIndex(S=>"auto"===S);a>=0&&["top","bottom","start","end","top-start","top-end","bottom-start","bottom-end","start-top","start-bottom","end-top","end-bottom"].forEach(function(S){null==i.find(D=>-1!==D.search("^"+S))&&i.splice(a++,1,S)});const h=i.map(S=>function Vee(e,t){const[n,i]=jee[e];return t&&i||n}(S,n.isRTL()));return{placement:h.shift(),modifiers:[{name:"bootstrapClasses",enabled:!!t,phase:"write",fn({state:S}){const D=new RegExp(t+"(-[a-z]+)*","gi"),A=S.elements.popper,F=S.placement;let k=A.className;k=k.replace(D,""),k+=` ${function qee(e,t){let[n,i]=t.split("-");const r=n.replace(Uee,"start").replace(Gee,"end");let a=[r];if(i){let h=i;("left"===n||"right"===n)&&(h=h.replace($ee,"top").replace(Hee,"bottom")),a.push(`${r}-${h}`)}return e&&(a=a.map(h=>`${e}-${h}`)),a.join(" ")}(t,F)}`,k=k.trim().replace(zee," "),A.className=k}},JX,iQ,aQ,{enabled:!0,name:"flip",options:{fallbackPlacements:h}}]}}function zL(e){return e}new Date(1882,10,12),new Date(2174,10,25);let cte=(()=>{var e;class t{constructor(){this.autoClose=!0,this.placement=["bottom-start","bottom-end","top-start","top-end"],this.popperOptions=i=>i,this.container=null}static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275prov=Xe({token:t,factory:t.\u0275fac,providedIn:"root"}))}return e(),t})(),Dw=(()=>{var e;class t{constructor(){this._disabled=!1,this.nativeElement=me(Nn).nativeElement,this.tabindex=0}set disabled(i){this._disabled=""===i||!0===i}get disabled(){return this._disabled}static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275dir=lt({type:t,selectors:[["","ngbDropdownItem",""]],hostAttrs:[1,"dropdown-item"],hostVars:3,hostBindings:function(r,a){2&r&&(bs("tabIndex",a.disabled?-1:a.tabindex),ji("disabled",a.disabled))},inputs:{tabindex:"tabindex",disabled:"disabled"}}))}return e(),t})(),QL=(()=>{var e;class t{constructor(){this.item=me(Dw)}static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275dir=lt({type:t,selectors:[["button","ngbDropdownItem",""]],hostVars:1,hostBindings:function(r,a){2&r&&bs("disabled",a.item.disabled)}}))}return e(),t})(),AC=(()=>{var e;class t{constructor(){this.dropdown=me(Tw),this.nativeElement=me(Nn).nativeElement}static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275dir=lt({type:t,selectors:[["","ngbDropdownMenu",""]],contentQueries:function(r,a,h){if(1&r&&_o(h,Dw,4),2&r){let d;Pi(d=Ri())&&(a.menuItems=d)}},hostAttrs:[1,"dropdown-menu"],hostVars:2,hostBindings:function(r,a){1&r&&Zn("keydown.ArrowUp",function(d){return a.dropdown.onKeyDown(d)})("keydown.ArrowDown",function(d){return a.dropdown.onKeyDown(d)})("keydown.Home",function(d){return a.dropdown.onKeyDown(d)})("keydown.End",function(d){return a.dropdown.onKeyDown(d)})("keydown.Enter",function(d){return a.dropdown.onKeyDown(d)})("keydown.Space",function(d){return a.dropdown.onKeyDown(d)})("keydown.Tab",function(d){return a.dropdown.onKeyDown(d)})("keydown.Shift.Tab",function(d){return a.dropdown.onKeyDown(d)}),2&r&&ji("show",a.dropdown.isOpen())}}))}return e(),t})(),Cw=(()=>{var e;class t{constructor(){this.dropdown=me(Tw),this.nativeElement=me(Nn).nativeElement}static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275dir=lt({type:t,selectors:[["","ngbDropdownAnchor",""]],hostAttrs:[1,"dropdown-toggle"],hostVars:3,hostBindings:function(r,a){2&r&&(zi("aria-expanded",a.dropdown.isOpen()),ji("show",a.dropdown.isOpen()))}}))}return e(),t})(),JL=(()=>{var e;class t extends Cw{static#e=e=()=>(this.\u0275fac=(()=>{let i;return function(a){return(i||(i=fi(t)))(a||t)}})(),this.\u0275dir=lt({type:t,selectors:[["","ngbDropdownToggle",""]],hostAttrs:[1,"dropdown-toggle"],hostVars:3,hostBindings:function(r,a){1&r&&Zn("click",function(){return a.dropdown.toggle()})("keydown.ArrowUp",function(d){return a.dropdown.onKeyDown(d)})("keydown.ArrowDown",function(d){return a.dropdown.onKeyDown(d)})("keydown.Home",function(d){return a.dropdown.onKeyDown(d)})("keydown.End",function(d){return a.dropdown.onKeyDown(d)})("keydown.Tab",function(d){return a.dropdown.onKeyDown(d)})("keydown.Shift.Tab",function(d){return a.dropdown.onKeyDown(d)}),2&r&&(zi("aria-expanded",a.dropdown.isOpen()),ji("show",a.dropdown.isOpen()))},features:[Ni([{provide:Cw,useExisting:Pn(()=>t)}]),Wn]}))}return e(),t})(),Tw=(()=>{var e;class t{constructor(){this._changeDetector=me(nl),this._config=me(cte),this._document=me(ke),this._injector=me(Be),this._ngZone=me(vn),this._nativeElement=me(Nn).nativeElement,this._destroyCloseHandlers$=new Cn,this._bodyContainer=null,this._positioning=function jL(){const e=me(Lee);let t=null;return{createPopper(n){if(!t){let r=(n.updatePopperOptions||zL)(BL(n,e));t=TQ(n.hostElement,n.targetElement,r)}},update(){t&&t.update()},setOptions(n){if(t){let r=(n.updatePopperOptions||zL)(BL(n,e));t.setOptions(r)}},destroy(){t&&(t.destroy(),t=null)}}}(),this.autoClose=this._config.autoClose,this._open=!1,this.placement=this._config.placement,this.popperOptions=this._config.popperOptions,this.container=this._config.container,this.openChange=new Zt}ngOnInit(){this.display||(this.display=this._nativeElement.closest(".navbar")?"static":"dynamic")}ngAfterContentInit(){!function Lg(e,t){const n=t?.injector??me(Be);return Zo("NgAfterNextRender"),B2(e,n,t,!0)}({write:()=>{this._applyPlacementClasses(),this._open&&this._setCloseHandlers()}},{injector:this._injector})}ngOnChanges(i){if(i.container&&this._open&&this._applyContainer(this.container),i.placement&&!i.placement.firstChange&&(this._positioning.setOptions({hostElement:this._anchor.nativeElement,targetElement:this._bodyContainer||this._menu.nativeElement,placement:this.placement}),this._applyPlacementClasses()),i.dropdownClass){const{currentValue:r,previousValue:a}=i.dropdownClass;this._applyCustomDropdownClass(r,a)}i.autoClose&&this._open&&(this.autoClose=i.autoClose.currentValue,this._setCloseHandlers())}isOpen(){return this._open}open(){this._open||(this._open=!0,this._applyContainer(this.container),this.openChange.emit(!0),this._setCloseHandlers(),this._anchor&&(this._anchor.nativeElement.focus(),"dynamic"===this.display&&this._ngZone.runOutsideAngular(()=>{this._positioning.createPopper({hostElement:this._anchor.nativeElement,targetElement:this._bodyContainer||this._menu.nativeElement,placement:this.placement,updatePopperOptions:i=>this.popperOptions(function GL(e){return t=>(t.modifiers.push(PQ,{name:"offset",options:{offset:()=>e}}),t)}([0,2])(i))}),this._applyPlacementClasses(),this._afterRenderRef=function XS(e,t){const n=t?.injector??me(Be);return Zo("NgAfterRender"),B2(e,n,t,!1)}({write:()=>{this._positionMenu()}},{injector:this._injector})})))}_setCloseHandlers(){this._destroyCloseHandlers$.next(),kL(this._ngZone,this._document,this.autoClose,i=>{this.close(),0===i&&this._anchor.nativeElement.focus()},this._destroyCloseHandlers$,this._menu?[this._menu.nativeElement]:[],this._anchor?[this._anchor.nativeElement]:[],".dropdown-item,.dropdown-divider")}close(){this._open&&(this._open=!1,this._resetContainer(),this._positioning.destroy(),this._afterRenderRef?.destroy(),this._destroyCloseHandlers$.next(),this.openChange.emit(!1),this._changeDetector.markForCheck())}toggle(){this.isOpen()?this.close():this.open()}ngOnDestroy(){this.close()}onKeyDown(i){const{key:r}=i,a=this._getMenuElements();let h=-1,d=null;const _=this._isEventFromToggle(i);if(!_&&a.length&&a.forEach((S,D)=>{S.contains(i.target)&&(d=S),S===SL(this._document)&&(h=D)})," "!==r&&"Enter"!==r){if("Tab"!==r){if(_||d){if(this.open(),a.length){switch(r){case"ArrowDown":h=Math.min(h+1,a.length-1);break;case"ArrowUp":if(this._isDropup()&&-1===h){h=a.length-1;break}h=Math.max(h-1,0);break;case"Home":h=0;break;case"End":h=a.length-1}a[h].focus()}i.preventDefault()}}else if(i.target&&this.isOpen()&&this.autoClose){if(this._anchor.nativeElement===i.target)return void("body"!==this.container||i.shiftKey?i.shiftKey&&this.close():(this._menu.nativeElement.setAttribute("tabindex","0"),this._menu.nativeElement.focus(),this._menu.nativeElement.removeAttribute("tabindex")));if("body"===this.container){const S=this._menu.nativeElement.querySelectorAll(OL);i.shiftKey&&i.target===S[0]?(this._anchor.nativeElement.focus(),i.preventDefault()):!i.shiftKey&&i.target===S[S.length-1]&&(this._anchor.nativeElement.focus(),this.close())}else es(i.target,"focusout").pipe(kl(1)).subscribe(({relatedTarget:S})=>{this._nativeElement.contains(S)||this.close()})}}else d&&(!0===this.autoClose||"inside"===this.autoClose)&&es(d,"click").pipe(kl(1)).subscribe(()=>this.close())}_isDropup(){return this._nativeElement.classList.contains("dropup")}_isEventFromToggle(i){return this._anchor.nativeElement.contains(i.target)}_getMenuElements(){return this._menu?this._menu.menuItems.filter(({disabled:i})=>!i).map(({nativeElement:i})=>i):[]}_positionMenu(){const i=this._menu;this.isOpen()&&i&&("dynamic"===this.display?(this._positioning.update(),this._applyPlacementClasses()):this._applyPlacementClasses(this._getFirstPlacement(this.placement)))}_getFirstPlacement(i){return Array.isArray(i)?i[0]:i.split(" ")[0]}_resetContainer(){this._menu&&this._nativeElement.appendChild(this._menu.nativeElement),this._bodyContainer&&(this._document.body.removeChild(this._bodyContainer),this._bodyContainer=null)}_applyContainer(i=null){if(this._resetContainer(),"body"===i){const r=this._menu.nativeElement,a=this._bodyContainer=this._bodyContainer||this._document.createElement("div");a.style.position="absolute",r.style.position="static",a.style.zIndex="1055",a.appendChild(r),this._document.body.appendChild(a)}this._applyCustomDropdownClass(this.dropdownClass)}_applyCustomDropdownClass(i,r){const a="body"===this.container?this._bodyContainer:this._nativeElement;a&&(r&&a.classList.remove(r),i&&a.classList.add(i))}_applyPlacementClasses(i){if(this._menu){i||(i=this._getFirstPlacement(this.placement)),this._nativeElement.classList.remove("dropup","dropdown"),"static"===this.display?this._menu.nativeElement.setAttribute("data-bs-popper","static"):this._menu.nativeElement.removeAttribute("data-bs-popper");const r=-1!==i.search("^top")?"dropup":"dropdown";this._nativeElement.classList.add(r),this._bodyContainer&&(this._bodyContainer.classList.remove("dropup","dropdown"),this._bodyContainer.classList.add(r))}}static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275dir=lt({type:t,selectors:[["","ngbDropdown",""]],contentQueries:function(r,a,h){if(1&r&&(_o(h,AC,5),_o(h,Cw,5)),2&r){let d;Pi(d=Ri())&&(a._menu=d.first),Pi(d=Ri())&&(a._anchor=d.first)}},hostVars:2,hostBindings:function(r,a){2&r&&ji("show",a.isOpen())},inputs:{autoClose:"autoClose",dropdownClass:"dropdownClass",_open:[0,"open","_open"],placement:"placement",popperOptions:"popperOptions",container:"container",display:"display"},outputs:{openChange:"openChange"},exportAs:["ngbDropdown"],features:[fo]}))}return e(),t})(),e3=(()=>{var e;class t{static#e=e=()=>(this.\u0275fac=function(r){return new(r||t)},this.\u0275mod=Ur({type:t}),this.\u0275inj=Hn({}))}return e(),t})();new $e("live announcer delay",{providedIn:"root",factory:()=>100});var d3=.0066943799901413165,_0=484813681109536e-20,Ke=Math.PI/2,ct=1e-10,is=.017453292519943295,Hu=57.29577951308232,ti=Math.PI/4,y0=2*Math.PI,$r=3.14159265359;const Yte={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Xte={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var f3=/[\s_\-\/\(\)]/g;function Wd(e,t){if(e[t])return e[t];for(var a,n=Object.keys(e),i=t.toLowerCase().replace(f3,""),r=-1;++r<n.length;)if((a=n[r]).toLowerCase().replace(f3,"")===i)return e[a]}function OC(e){var i,r,a,t={},n=e.split("+").map(function(d){return d.trim()}).filter(function(d){return d}).reduce(function(d,_){var S=_.split("=");return S.push(!0),d[S[0].toLowerCase()]=S[1],d},{}),h={proj:"projName",datum:"datumCode",rf:function(d){t.rf=parseFloat(d)},lat_0:function(d){t.lat0=d*is},lat_1:function(d){t.lat1=d*is},lat_2:function(d){t.lat2=d*is},lat_ts:function(d){t.lat_ts=d*is},lon_0:function(d){t.long0=d*is},lon_1:function(d){t.long1=d*is},lon_2:function(d){t.long2=d*is},alpha:function(d){t.alpha=parseFloat(d)*is},gamma:function(d){t.rectified_grid_angle=parseFloat(d)*is},lonc:function(d){t.longc=d*is},x_0:function(d){t.x0=parseFloat(d)},y_0:function(d){t.y0=parseFloat(d)},k_0:function(d){t.k0=parseFloat(d)},k:function(d){t.k0=parseFloat(d)},a:function(d){t.a=parseFloat(d)},b:function(d){t.b=parseFloat(d)},r:function(d){t.a=t.b=parseFloat(d)},r_a:function(){t.R_A=!0},zone:function(d){t.zone=parseInt(d,10)},south:function(){t.utmSouth=!0},towgs84:function(d){t.datum_params=d.split(",").map(function(_){return parseFloat(_)})},to_meter:function(d){t.to_meter=parseFloat(d)},units:function(d){t.units=d;var _=Wd(Xte,d);_&&(t.to_meter=_.to_meter)},from_greenwich:function(d){t.from_greenwich=d*is},pm:function(d){var _=Wd(Yte,d);t.from_greenwich=(_||parseFloat(d))*is},nadgrids:function(d){"@null"===d?t.datumCode="none":t.nadgrids=d},axis:function(d){var _="ewnsud";3===d.length&&-1!==_.indexOf(d.substr(0,1))&&-1!==_.indexOf(d.substr(1,1))&&-1!==_.indexOf(d.substr(2,1))&&(t.axis=d)},approx:function(){t.approx=!0}};for(i in n)r=n[i],i in h?"function"==typeof(a=h[i])?a(r):t[a]=r:t[i]=r;return"string"==typeof t.datumCode&&"WGS84"!==t.datumCode&&(t.datumCode=t.datumCode.toLowerCase()),t}const p3=class Qte{static getId(t){const n=t.find(i=>Array.isArray(i)&&"ID"===i[0]);return n&&n.length>=3?{authority:n[1],code:parseInt(n[2],10)}:null}static convertUnit(t,n="unit"){if(!t||t.length<3)return{type:n,name:"unknown",conversion_factor:null};const i=t[1],r=parseFloat(t[2])||null,a=t.find(d=>Array.isArray(d)&&"ID"===d[0]);return{type:n,name:i,conversion_factor:r,id:a?{authority:a[1],code:parseInt(a[2],10)}:null}}static convertAxis(t){const n=t[1]||"Unknown";let i;const r=n.match(/^\((.)\)$/);if(r){const S=r[1].toUpperCase();if("E"===S)i="east";else if("N"===S)i="north";else{if("U"!==S)throw new Error(`Unknown axis abbreviation: ${S}`);i="up"}}else i=t[2]?t[2].toLowerCase():"unknown";const a=t.find(S=>Array.isArray(S)&&"ORDER"===S[0]),h=a?parseInt(a[1],10):null,d=t.find(S=>Array.isArray(S)&&("LENGTHUNIT"===S[0]||"ANGLEUNIT"===S[0]||"SCALEUNIT"===S[0]));return{name:n,direction:i,unit:this.convertUnit(d),order:h}}static extractAxes(t){return t.filter(n=>Array.isArray(n)&&"AXIS"===n[0]).map(n=>this.convertAxis(n)).sort((n,i)=>(n.order||0)-(i.order||0))}static convert(t,n={}){switch(t[0]){case"PROJCRS":n.type="ProjectedCRS",n.name=t[1],n.base_crs=t.find(k=>Array.isArray(k)&&"BASEGEOGCRS"===k[0])?this.convert(t.find(k=>Array.isArray(k)&&"BASEGEOGCRS"===k[0])):null,n.conversion=t.find(k=>Array.isArray(k)&&"CONVERSION"===k[0])?this.convert(t.find(k=>Array.isArray(k)&&"CONVERSION"===k[0])):null;const i=t.find(k=>Array.isArray(k)&&"CS"===k[0]);i&&(n.coordinate_system={type:i[1],axis:this.extractAxes(t)});const r=t.find(k=>Array.isArray(k)&&"LENGTHUNIT"===k[0]);if(r){const k=this.convertUnit(r);n.coordinate_system.unit=k}n.id=this.getId(t);break;case"BASEGEOGCRS":case"GEOGCRS":n.type="GeographicCRS",n.name=t[1];const a=t.find(k=>Array.isArray(k)&&("DATUM"===k[0]||"ENSEMBLE"===k[0]));if(a){const k=this.convert(a);"ENSEMBLE"===a[0]?n.datum_ensemble=k:n.datum=k;const G=t.find(Y=>Array.isArray(Y)&&"PRIMEM"===Y[0]);G&&"Greenwich"!==G[1]&&(k.prime_meridian={name:G[1],longitude:parseFloat(G[2])})}n.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(t)},n.id=this.getId(t);break;case"DATUM":n.type="GeodeticReferenceFrame",n.name=t[1],n.ellipsoid=t.find(k=>Array.isArray(k)&&"ELLIPSOID"===k[0])?this.convert(t.find(k=>Array.isArray(k)&&"ELLIPSOID"===k[0])):null;break;case"ENSEMBLE":n.type="DatumEnsemble",n.name=t[1],n.members=t.filter(k=>Array.isArray(k)&&"MEMBER"===k[0]).map(k=>({type:"DatumEnsembleMember",name:k[1],id:this.getId(k)}));const h=t.find(k=>Array.isArray(k)&&"ENSEMBLEACCURACY"===k[0]);h&&(n.accuracy=parseFloat(h[1]));const d=t.find(k=>Array.isArray(k)&&"ELLIPSOID"===k[0]);d&&(n.ellipsoid=this.convert(d)),n.id=this.getId(t);break;case"ELLIPSOID":n.type="Ellipsoid",n.name=t[1],n.semi_major_axis=parseFloat(t[2]),n.inverse_flattening=parseFloat(t[3]),t.find(k=>Array.isArray(k)&&"LENGTHUNIT"===k[0])&&this.convert(t.find(k=>Array.isArray(k)&&"LENGTHUNIT"===k[0]),n);break;case"CONVERSION":n.type="Conversion",n.name=t[1],n.method=t.find(k=>Array.isArray(k)&&"METHOD"===k[0])?this.convert(t.find(k=>Array.isArray(k)&&"METHOD"===k[0])):null,n.parameters=t.filter(k=>Array.isArray(k)&&"PARAMETER"===k[0]).map(k=>this.convert(k));break;case"METHOD":n.type="Method",n.name=t[1],n.id=this.getId(t);break;case"PARAMETER":n.type="Parameter",n.name=t[1],n.value=parseFloat(t[2]),n.unit=this.convertUnit(t.find(k=>Array.isArray(k)&&("LENGTHUNIT"===k[0]||"ANGLEUNIT"===k[0]||"SCALEUNIT"===k[0]))),n.id=this.getId(t);break;case"BOUNDCRS":n.type="BoundCRS";const S=t.find(k=>Array.isArray(k)&&"SOURCECRS"===k[0]);if(S){const k=S.find(G=>Array.isArray(G));n.source_crs=k?this.convert(k):null}const D=t.find(k=>Array.isArray(k)&&"TARGETCRS"===k[0]);if(D){const k=D.find(G=>Array.isArray(G));n.target_crs=k?this.convert(k):null}const A=t.find(k=>Array.isArray(k)&&"ABRIDGEDTRANSFORMATION"===k[0]);n.transformation=A?this.convert(A):null;break;case"ABRIDGEDTRANSFORMATION":if(n.type="Transformation",n.name=t[1],n.method=t.find(k=>Array.isArray(k)&&"METHOD"===k[0])?this.convert(t.find(k=>Array.isArray(k)&&"METHOD"===k[0])):null,n.parameters=t.filter(k=>Array.isArray(k)&&("PARAMETER"===k[0]||"PARAMETERFILE"===k[0])).map(k=>"PARAMETER"===k[0]?this.convert(k):"PARAMETERFILE"===k[0]?{name:k[1],value:k[2],id:{authority:"EPSG",code:8656}}:void 0),7===n.parameters.length){const k=n.parameters[6];"Scale difference"===k.name&&(k.value=Math.round(1e12*(k.value-1))/1e6)}n.id=this.getId(t);break;case"AXIS":n.coordinate_system||(n.coordinate_system={type:"unspecified",axis:[]}),n.coordinate_system.axis.push(this.convertAxis(t));break;case"LENGTHUNIT":const F=this.convertUnit(t,"LinearUnit");n.coordinate_system&&n.coordinate_system.axis&&n.coordinate_system.axis.forEach(k=>{k.unit||(k.unit=F)}),F.conversion_factor&&1!==F.conversion_factor&&n.semi_major_axis&&(n.semi_major_axis={value:n.semi_major_axis,unit:F});break;default:n.keyword=t[0]}return n}},ene=class Jte extends p3{static convert(t,n={}){return super.convert(t,n),n.coordinate_system&&"Cartesian"===n.coordinate_system.subtype&&delete n.coordinate_system,n.usage&&delete n.usage,n}},nne=class tne extends p3{static convert(t,n={}){super.convert(t,n);const i=t.find(a=>Array.isArray(a)&&"CS"===a[0]);i&&(n.coordinate_system={subtype:i[1],axis:this.extractAxes(t)});const r=t.find(a=>Array.isArray(a)&&"USAGE"===a[0]);if(r){const a=r.find(_=>Array.isArray(_)&&"SCOPE"===_[0]),h=r.find(_=>Array.isArray(_)&&"AREA"===_[0]),d=r.find(_=>Array.isArray(_)&&"BBOX"===_[0]);n.usage={},a&&(n.usage.scope=a[1]),h&&(n.usage.area=h[1]),d&&(n.usage.bbox=d.slice(1))}return n}};var v0=1,ane=/\s/,lne=/[A-Za-z]/,cne=/[A-Za-z84_]/,Rw=/[,\]]/,y3=/[\d\.E\-\+]/;function jh(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=v0}function LC(e,t,n){Array.isArray(t)&&(n.unshift(t),t=null);var r=n.reduce(function(a,h){return mm(h,a),a},t?{}:e);t&&(e[t]=r)}function mm(e,t){if(Array.isArray(e)){var n=e.shift();if("PARAMETER"===n&&(n=e.shift()),1===e.length)return Array.isArray(e[0])?(t[n]={},void mm(e[0],t[n])):void(t[n]=e[0]);if(e.length)if("TOWGS84"!==n){if("AXIS"===n)return n in t||(t[n]=[]),void t[n].push(e);var i;switch(Array.isArray(n)||(t[n]={}),n){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[n]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&mm(e[2],t[n]));case"SPHEROID":case"ELLIPSOID":return t[n]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&mm(e[3],t[n]));case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":return e[0]=["name",e[0]],void LC(t,n,e);case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":return e[0]=["name",e[0]],LC(t,n,e),void(t[n].type=n);default:for(i=-1;++i<e.length;)if(!Array.isArray(e[i]))return mm(e,t[n]);return LC(t,n,e)}}else t[n]=e;else t[n]=!0}else t[e]=!0}function Oc(e){return.017453292519943295*e}function v3(e){const t=(e.projName||"").toLowerCase().replace(/_/g," ");!e.long0&&e.longc&&("albers conic equal area"===t||"lambert azimuthal equal area"===t)&&(e.long0=e.longc),e.lat_ts||!e.lat1||"stereographic south pole"!==t&&"polar stereographic (variant b)"!==t?!e.lat_ts&&e.lat0&&("polar stereographic"===t||"polar stereographic (variant a)"===t)&&(e.lat_ts=e.lat0,e.lat0=Oc(e.lat0>0?90:-90),delete e.lat1):(e.lat0=Oc(e.lat1>0?90:-90),e.lat_ts=e.lat1,delete e.lat1)}function b3(e){let t={units:null,to_meter:void 0};return"string"==typeof e?(t.units=e.toLowerCase(),"metre"===t.units&&(t.units="meter"),"meter"===t.units&&(t.to_meter=1)):e&&e.name&&(t.units=e.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.to_meter=e.conversion_factor),t}function w3(e){return"object"==typeof e?e.value*e.unit.conversion_factor:e}function x3(e,t){e.ellipsoid.radius?(t.a=e.ellipsoid.radius,t.rf=0):(t.a=w3(e.ellipsoid.semi_major_axis),void 0!==e.ellipsoid.inverse_flattening?t.rf=e.ellipsoid.inverse_flattening:void 0!==e.ellipsoid.semi_major_axis&&void 0!==e.ellipsoid.semi_minor_axis&&(t.rf=t.a/(t.a-w3(e.ellipsoid.semi_minor_axis))))}function Nw(e,t={}){return e&&"object"==typeof e?"BoundCRS"===e.type?(Nw(e.source_crs,t),e.transformation&&(e.transformation.method&&"NTv2"===e.transformation.method.name?t.nadgrids=e.transformation.parameters[0].value:t.datum_params=e.transformation.parameters.map(n=>n.value)),t):(Object.keys(e).forEach(n=>{const i=e[n];if(null!==i)switch(n){case"name":if(t.srsCode)break;t.name=i,t.srsCode=i;break;case"type":"GeographicCRS"===i?t.projName="longlat":"ProjectedCRS"===i&&e.conversion&&e.conversion.method&&(t.projName=e.conversion.method.name);break;case"datum":case"datum_ensemble":i.ellipsoid&&(t.ellps=i.ellipsoid.name,x3(i,t)),i.prime_meridian&&(t.from_greenwich=i.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":t.ellps=i.name,x3(i,t);break;case"prime_meridian":t.long0=(i.longitude||0)*Math.PI/180;break;case"coordinate_system":if(i.axis)if(t.axis=i.axis.map(r=>{const a=r.direction;if("east"===a)return"e";if("north"===a)return"n";if("west"===a)return"w";if("south"===a)return"s";throw new Error(`Unknown axis direction: ${a}`)}).join("")+"u",i.unit){const{units:r,to_meter:a}=b3(i.unit);t.units=r,t.to_meter=a}else if(i.axis[0]&&i.axis[0].unit){const{units:r,to_meter:a}=b3(i.axis[0].unit);t.units=r,t.to_meter=a}break;case"id":i.authority&&i.code&&(t.title=i.authority+":"+i.code);break;case"conversion":i.method&&i.method.name&&(t.projName=i.method.name),i.parameters&&i.parameters.forEach(r=>{const a=r.name.toLowerCase().replace(/\s+/g,"_"),h=r.value;t[a]=r.unit&&r.unit.conversion_factor?h*r.unit.conversion_factor:"degree"===r.unit?h*Math.PI/180:h});break;case"unit":i.name&&(t.units=i.name.toLowerCase(),"metre"===t.units&&(t.units="meter")),i.conversion_factor&&(t.to_meter=i.conversion_factor);break;case"base_crs":Nw(i,t),t.datumCode=i.id?i.id.authority+"_"+i.id.code:i.name}}),void 0!==t.latitude_of_false_origin&&(t.lat0=t.latitude_of_false_origin),void 0!==t.longitude_of_false_origin&&(t.long0=t.longitude_of_false_origin),void 0!==t.latitude_of_standard_parallel&&(t.lat0=t.latitude_of_standard_parallel,t.lat1=t.latitude_of_standard_parallel),void 0!==t.latitude_of_1st_standard_parallel&&(t.lat1=t.latitude_of_1st_standard_parallel),void 0!==t.latitude_of_2nd_standard_parallel&&(t.lat2=t.latitude_of_2nd_standard_parallel),void 0!==t.latitude_of_projection_centre&&(t.lat0=t.latitude_of_projection_centre),void 0!==t.longitude_of_projection_centre&&(t.longc=t.longitude_of_projection_centre),void 0!==t.easting_at_false_origin&&(t.x0=t.easting_at_false_origin),void 0!==t.northing_at_false_origin&&(t.y0=t.northing_at_false_origin),void 0!==t.latitude_of_natural_origin&&(t.lat0=t.latitude_of_natural_origin),void 0!==t.longitude_of_natural_origin&&(t.long0=t.longitude_of_natural_origin),void 0!==t.longitude_of_origin&&(t.long0=t.longitude_of_origin),void 0!==t.false_easting&&(t.x0=t.false_easting),t.easting_at_projection_centre&&(t.x0=t.easting_at_projection_centre),void 0!==t.false_northing&&(t.y0=t.false_northing),t.northing_at_projection_centre&&(t.y0=t.northing_at_projection_centre),void 0!==t.standard_parallel_1&&(t.lat1=t.standard_parallel_1),void 0!==t.standard_parallel_2&&(t.lat2=t.standard_parallel_2),void 0!==t.scale_factor_at_natural_origin&&(t.k0=t.scale_factor_at_natural_origin),void 0!==t.scale_factor_at_projection_centre&&(t.k0=t.scale_factor_at_projection_centre),void 0!==t.scale_factor_on_pseudo_standard_parallel&&(t.k0=t.scale_factor_on_pseudo_standard_parallel),void 0!==t.azimuth&&(t.alpha=t.azimuth),void 0!==t.azimuth_at_projection_centre&&(t.alpha=t.azimuth_at_projection_centre),t.angle_from_rectified_to_skew_grid&&(t.rectified_grid_angle=t.angle_from_rectified_to_skew_grid),v3(t),t):e}jh.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;ane.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case v0:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},jh.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(Rw.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},jh.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=v0)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=v0,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},jh.prototype.number=function(e){if(!y3.test(e)){if(Rw.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},jh.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},jh.prototype.keyword=function(e){if(cne.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=v0)}if(!Rw.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},jh.prototype.neutral=function(e){if(lne.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(y3.test(e))return this.word=e,void(this.state=3);if(!Rw.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},jh.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var dne=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function S3(e){for(var t=Object.keys(e),n=0,i=t.length;n<i;++n){var r=t[n];-1!==dne.indexOf(r)&&pne(e[r]),"object"==typeof e[r]&&S3(e[r])}}function pne(e){if(e.AUTHORITY){var t=Object.keys(e.AUTHORITY)[0];t&&t in e.AUTHORITY&&(e.title=t+":"+e.AUTHORITY[t])}if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):e.projName="object"==typeof e.PROJECTION?Object.keys(e.PROJECTION)[0]:e.PROJECTION,e.AXIS){for(var n="",i=0,r=e.AXIS.length;i<r;++i){var a=[e.AXIS[i][0].toLowerCase(),e.AXIS[i][1].toLowerCase()];-1!==a[0].indexOf("north")||("y"===a[0]||"lat"===a[0])&&"north"===a[1]?n+="n":-1!==a[0].indexOf("south")||("y"===a[0]||"lat"===a[0])&&"south"===a[1]?n+="s":-1!==a[0].indexOf("east")||("x"===a[0]||"lon"===a[0])&&"east"===a[1]?n+="e":(-1!==a[0].indexOf("west")||("x"===a[0]||"lon"===a[0])&&"west"===a[1])&&(n+="w")}2===n.length&&(n+="u"),3===n.length&&(e.axis=n)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var h=e.GEOGCS;function d(D){return D*(e.to_meter||1)}"GEOGCS"===e.type&&(h=e),h&&(e.datumCode=h.DATUM?h.DATUM.name.toLowerCase():h.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_1949"===e.datumCode&&(e.datumCode="nzgd49"),("wgs_1984"===e.datumCode||"world_geodetic_system_1984"===e.datumCode)&&("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"belge_1972"===e.datumCode&&(e.datumCode="rnb72"),h.DATUM&&h.DATUM.SPHEROID&&(e.ellps=h.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=h.DATUM.SPHEROID.a,e.rf=parseFloat(h.DATUM.SPHEROID.rf,10)),h.DATUM&&h.DATUM.TOWGS84&&(e.datum_params=h.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),e.rectified_grid_angle&&(e.rectified_grid_angle=Oc(e.rectified_grid_angle)),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Oc],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Oc],["x0","false_easting",d],["y0","false_northing",d],["long0","central_meridian",Oc],["lat0","latitude_of_origin",Oc],["lat0","standard_parallel_1",Oc],["lat1","standard_parallel_1",Oc],["lat2","standard_parallel_2",Oc],["azimuth","Azimuth"],["alpha","azimuth",Oc],["srsCode","name"]].forEach(function(D){return function fne(e,t){var n=t[0],i=t[1];!(n in e)&&i in e&&(e[n]=e[i],3===t.length&&(e[n]=t[2](e[n])))}(e,D)}),v3(e)}function BC(e){if("object"==typeof e)return Nw(e);const t=function one(e){const t=e.toUpperCase();return t.includes("PROJCRS")||t.includes("GEOGCRS")||t.includes("BOUNDCRS")||t.includes("VERTCRS")||t.includes("LENGTHUNIT")||t.includes("ANGLEUNIT")||t.includes("SCALEUNIT")?"WKT2":(t.includes("PROJCS")||t.includes("GEOGCS")||t.includes("LOCAL_CS")||t.includes("VERT_CS")||t.includes("UNIT"),"WKT1")}(e);var n=function une(e){return new jh(e).output()}(e);if("WKT2"===t)return Nw(function rne(e){return("2019"===function ine(e){return e.find(t=>Array.isArray(t)&&"USAGE"===t[0])?"2019":(e.find(t=>Array.isArray(t)&&"CS"===t[0]),"2015")}(e)?nne:ene).convert(e)}(n));var i=n[0],r={};return mm(n,r),S3(r),r[i]}function Vl(e){var t=this;if(2===arguments.length){var n=arguments[1];Vl[e]="string"==typeof n?"+"===n.charAt(0)?OC(arguments[1]):BC(arguments[1]):n}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(i){return Array.isArray(i)?Vl.apply(t,i):Vl(i)});if("string"==typeof e){if(e in Vl)return Vl[e]}else"EPSG"in e?Vl["EPSG:"+e.EPSG]=e:"ESRI"in e?Vl["ESRI:"+e.ESRI]=e:"IAU2000"in e?Vl["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function $te(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)e("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),e("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(Vl);const kw=Vl;var yne=["3857","900913","3785","102113"];function E3(e,t){var n,i;if(e=e||{},!t)return e;for(i in t)void 0!==(n=t[i])&&(e[i]=n);return e}function qu(e,t,n){var i=e*t;return n/Math.sqrt(1-i*i)}function b0(e){return e<0?-1:1}function gt(e){return Math.abs(e)<=$r?e:e-b0(e)*y0}function Fc(e,t,n){var i=e*n;return i=Math.pow((1-i)/(1+i),.5*e),Math.tan(.5*(Ke-t))/i}function w0(e,t){for(var i,r,n=.5*e,a=Ke-2*Math.atan(t),h=0;h<=15;h++)if(i=e*Math.sin(a),a+=r=Ke-2*Math.atan(t*Math.pow((1-i)/(1+i),n))-a,Math.abs(r)<=1e-10)return a;return-9999}function M3(e){return e}var Pne=[{init:function Ene(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.k0=this.sphere?Math.cos(this.lat_ts):qu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k0=this.k?this.k:1)},forward:function Mne(e){var i,r,t=e.x,n=e.y;if(n*Hu>90&&n*Hu<-90&&t*Hu>180&&t*Hu<-180)return null;if(Math.abs(Math.abs(n)-Ke)<=ct)return null;if(this.sphere)i=this.x0+this.a*this.k0*gt(t-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(ti+.5*n));else{var a=Math.sin(n),h=Fc(this.e,n,a);i=this.x0+this.a*this.k0*gt(t-this.long0),r=this.y0-this.a*this.k0*Math.log(h)}return e.x=i,e.y=r,e},inverse:function Dne(e){var i,r,t=e.x-this.x0,n=e.y-this.y0;if(this.sphere)r=Ke-2*Math.atan(Math.exp(-n/(this.a*this.k0)));else{var a=Math.exp(-n/(this.a*this.k0));if(-9999===(r=w0(this.e,a)))return null}return i=gt(this.long0+t/(this.a*this.k0)),e.x=i,e.y=r,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"]},{init:function Ine(){},forward:M3,inverse:M3,names:["longlat","identity"]}],Ep={},_m=[];function D3(e,t){var n=_m.length;return e.names?(_m[n]=e,e.names.forEach(function(i){Ep[i.toLowerCase()]=n}),this):(console.log(t),!0)}function C3(e){return e.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}const kne={start:function Nne(){Pne.forEach(D3)},add:D3,get:function Rne(e){if(!e)return!1;var t=e.toLowerCase();return typeof Ep[t]<"u"&&_m[Ep[t]]||(t=C3(t))in Ep&&_m[Ep[t]]?_m[Ep[t]]:void 0}},T3={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Fne=T3.WGS84;var Ow={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var zne in Ow){var zC=Ow[zne];zC.datumName&&(Ow[zC.datumName]=zC)}const jne=Ow;var jC={};function Hne(e,t){return VC.apply(this,arguments)}function VC(){return(VC=wu(function*(e,t){for(var n=[],i=yield t.getImageCount(),r=i-1;r>=0;r--){var a=yield t.getImage(r),d=yield a.readRasters(),_=[a.getWidth(),a.getHeight()],S=a.getBoundingBox().map(I3),D=[a.fileDirectory.ModelPixelScale[0],a.fileDirectory.ModelPixelScale[1]].map(I3),A=S[0]+(_[0]-1)*D[0],F=S[3]-(_[1]-1)*D[1],k=d[0],G=d[1],Y=[];for(let ge=_[1]-1;ge>=0;ge--)for(let Le=_[0]-1;Le>=0;Le--){var ne=ge*_[0]+Le;Y.push([-Zd(G[ne]),Zd(k[ne])])}n.push({del:D,lim:_,ll:[-A,F],cvs:Y})}var fe={header:{nSubgrids:i},subgrids:n};return jC[e]=fe,fe})).apply(this,arguments)}function Wne(e){if(0===e.length)return null;var t="@"===e[0];return t&&(e=e.slice(1)),"null"===e?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:jC[e]||null,isNull:!1}}function I3(e){return e*Math.PI/180}function Zd(e){return e/3600*Math.PI/180}function UC(e,t,n){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,n)))}function Xne(e){return e.map(function(t){return[Zd(t.longitudeShift),Zd(t.latitudeShift)]})}function Qne(e,t,n){return{name:UC(e,t+8,t+16).trim(),parent:UC(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,n),upperLatitude:e.getFloat64(t+88,n),lowerLongitude:e.getFloat64(t+104,n),upperLongitude:e.getFloat64(t+120,n),latitudeInterval:e.getFloat64(t+136,n),longitudeInterval:e.getFloat64(t+152,n),gridNodeCount:e.getInt32(t+168,n)}}function Jne(e,t,n,i,r){var a=t+176,h=16;!1===r&&(h=8);for(var d=[],_=0;_<n.gridNodeCount;_++){var S={latitudeShift:e.getFloat32(a+_*h,i),longitudeShift:e.getFloat32(a+_*h+4,i)};!1!==r&&(S.latitudeAccuracy=e.getFloat32(a+_*h+8,i),S.longitudeAccuracy=e.getFloat32(a+_*h+12,i)),d.push(S)}return d}function ym(e,t){if(!(this instanceof ym))return new ym(e);this.forward=null,this.inverse=null,this.init=null,this.names=null,t=t||function(S){if(S)throw S};var n=function xne(e){if(!function gne(e){return"string"==typeof e}(e))return"projName"in e?e:BC(e);if(function mne(e){return e in kw}(e))return kw[e];if(function _ne(e){return 0!==e.indexOf("+")&&-1!==e.indexOf("[")||"object"==typeof e&&!("srsCode"in e)}(e)){var t=BC(e);if(function vne(e){var t=Wd(e,"authority");if(t){var n=Wd(t,"epsg");return n&&yne.indexOf(n)>-1}}(t))return kw["EPSG:3857"];var n=function bne(e){var t=Wd(e,"extension");if(t)return Wd(t,"proj4")}(t);return n?OC(n):t}return function wne(e){return"+"===e[0]}(e)?OC(e):void 0}(e);if("object"==typeof n){var i=ym.projections.get(n.projName);if(i){if(n.datumCode&&"none"!==n.datumCode){var r=Wd(jne,n.datumCode);r&&(n.datum_params=n.datum_params||(r.towgs84?r.towgs84.split(","):null),n.ellps=r.ellipse,n.datumName=r.datumName?r.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84",n.lat1=n.lat1||n.lat0;var a=function Bne(e,t,n,i,r){if(!e){var a=Wd(T3,i);a||(a=Fne),e=a.a,t=a.b,n=a.rf}return n&&!t&&(t=(1-1/n)*e),(0===n||Math.abs(e-t)<ct)&&(r=!0,t=e),{a:e,b:t,rf:n,sphere:r}}(n.a,n.b,n.rf,n.ellps,n.sphere),h=function Lne(e,t,n,i){var r=e*e,a=t*t,h=(r-a)/r,d=0;return i?(r=(e*=1-h*(.16666666666666666+h*(.04722222222222222+.022156084656084655*h)))*e,h=0):d=Math.sqrt(h),{es:h,e:d,ep2:(r-a)/a}}(a.a,a.b,0,n.R_A),d=function qne(e){return void 0===e?null:e.split(",").map(Wne)}(n.nadgrids),_=n.datum||function Vne(e,t,n,i,r,a,h){var d={};return d.datum_type=void 0===e||"none"===e?5:4,t&&(d.datum_params=t.map(parseFloat),(0!==d.datum_params[0]||0!==d.datum_params[1]||0!==d.datum_params[2])&&(d.datum_type=1),d.datum_params.length>3&&(0!==d.datum_params[3]||0!==d.datum_params[4]||0!==d.datum_params[5]||0!==d.datum_params[6])&&(d.datum_type=2,d.datum_params[3]*=_0,d.datum_params[4]*=_0,d.datum_params[5]*=_0,d.datum_params[6]=d.datum_params[6]/1e6+1)),h&&(d.datum_type=3,d.grids=h),d.a=n,d.b=i,d.es=r,d.ep2=a,d}(n.datumCode,n.datum_params,a.a,a.b,h.es,h.ep2,d);E3(this,n),E3(this,i),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=h.es,this.e=h.e,this.ep2=h.ep2,this.datum=_,"init"in this&&"function"==typeof this.init&&this.init(),t(null,this)}else t("Could not get projection name from: "+e)}else t("Could not parse to valid json: "+e)}(ym.projections=kne).start();const vm=ym;function A3(e,t,n){var h,d,S,i=e.x,r=e.y,a=e.z?e.z:0;if(r<-Ke&&r>-1.001*Ke)r=-Ke;else if(r>Ke&&r<1.001*Ke)r=Ke;else{if(r<-Ke)return{x:-1/0,y:-1/0,z:e.z};if(r>Ke)return{x:1/0,y:1/0,z:e.z}}return i>Math.PI&&(i-=2*Math.PI),d=Math.sin(r),S=Math.cos(r),{x:((h=n/Math.sqrt(1-t*(d*d)))+a)*S*Math.cos(i),y:(h+a)*S*Math.sin(i),z:(h*(1-t)+a)*d}}function P3(e,t,n,i){var d,_,S,D,A,F,k,G,Y,ne,fe,ge,Le,at,en,je=e.x,Ge=e.y,ot=e.z?e.z:0;if(d=Math.sqrt(je*je+Ge*Ge),_=Math.sqrt(je*je+Ge*Ge+ot*ot),d/n<1e-12){if(at=0,_/n<1e-12)return en=-i,{x:e.x,y:e.y,z:e.z}}else at=Math.atan2(Ge,je);S=ot/_,G=(D=d/_)*(1-t)*(A=1/Math.sqrt(1-t*(2-t)*D*D)),Y=S*A,Le=0;do{Le++,F=t*(k=n/Math.sqrt(1-t*Y*Y))/(k+(en=d*G+ot*Y-k*(1-t*Y*Y))),ge=(fe=S*(A=1/Math.sqrt(1-F*(2-F)*D*D)))*G-(ne=D*(1-F)*A)*Y,G=ne,Y=fe}while(ge*ge>1e-24&&Le<30);return{x:at,y:Math.atan(fe/Math.abs(ne)),z:en}}function Fw(e){return 1===e||2===e}function R3(e,t,n){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;var i={x:-n.x,y:n.y},r={x:Number.NaN,y:Number.NaN},a=[];e:for(var h=0;h<e.grids.length;h++){var d=e.grids[h];if(a.push(d.name),d.isNull){r=i;break}if(null!==d.grid)for(var _=d.grid.subgrids,S=0,D=_.length;S<D;S++){var A=_[S],F=(Math.abs(A.del[1])+Math.abs(A.del[0]))/1e4;if(!(A.ll[1]-F>i.y||A.ll[0]-F>i.x||A.ll[1]+(A.lim[1]-1)*A.del[1]+F<i.y||A.ll[0]+(A.lim[0]-1)*A.del[0]+F<i.x||(r=rie(i,t,A),isNaN(r.x))))break e}else if(d.mandatory)return console.log("Unable to find mandatory grid '"+d.name+"'"),-1}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*Hu+" "+i.y*Hu+" tried: '"+a+"'"),-1):(n.x=-r.x,n.y=r.y,0)}function rie(e,t,n){var i={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return i;var r={x:e.x,y:e.y};r.x-=n.ll[0],r.y-=n.ll[1],r.x=gt(r.x-Math.PI)+Math.PI;var a=N3(r,n);if(t){if(isNaN(a.x))return i;a.x=r.x-a.x,a.y=r.y-a.y;var _,S,h=9;do{if(S=N3(a,n),isNaN(S.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a.x+=(_={x:r.x-(S.x+a.x),y:r.y-(S.y+a.y)}).x,a.y+=_.y}while(h--&&Math.abs(_.x)>1e-12&&Math.abs(_.y)>1e-12);if(h<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=gt(a.x+n.ll[0]),i.y=a.y+n.ll[1]}else isNaN(a.x)||(i.x=e.x+a.x,i.y=e.y+a.y);return i}function N3(e,t){var h,n={x:e.x/t.del[0],y:e.y/t.del[1]},i_x=Math.floor(n.x),i_y=Math.floor(n.y),r_x=n.x-1*i_x,r_y=n.y-1*i_y,a={x:Number.NaN,y:Number.NaN};if(i_x<0||i_x>=t.lim[0]||i_y<0||i_y>=t.lim[1])return a;var d_x=t.cvs[h=i_y*t.lim[0]+i_x][0],d_y=t.cvs[h][1];h++;var __x=t.cvs[h][0],__y=t.cvs[h][1],S_x=t.cvs[h+=t.lim[0]][0],S_y=t.cvs[h][1];h--;var D_y=t.cvs[h][1],A=r_x*r_y,F=r_x*(1-r_y),k=(1-r_x)*(1-r_y),G=(1-r_x)*r_y;return a.x=k*d_x+F*__x+G*t.cvs[h][0]+A*S_x,a.y=k*d_y+F*__y+G*D_y+A*S_y,a}function k3(e,t,n){var h,d,_,i=n.x,r=n.y,a=n.z||0,S={};for(_=0;_<3;_++)if(!t||2!==_||void 0!==n.z)switch(0===_?(h=i,d=-1!=="ew".indexOf(e.axis[_])?"x":"y"):1===_?(h=r,d=-1!=="ns".indexOf(e.axis[_])?"y":"x"):(h=a,d="z"),e.axis[_]){case"e":case"n":S[d]=h;break;case"w":case"s":S[d]=-h;break;case"u":void 0!==n[d]&&(S.z=h);break;case"d":void 0!==n[d]&&(S.z=-h);break;default:return null}return S}function O3(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function F3(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function Lw(e,t,n,i){var r,a=void 0!==(n=Array.isArray(n)?O3(n):{x:n.x,y:n.y,z:n.z,m:n.m}).z;if(function oie(e){F3(e.x),F3(e.y)}(n),e.datum&&t.datum&&function sie(e,t){return(1===e.datum.datum_type||2===e.datum.datum_type||3===e.datum.datum_type)&&"WGS84"!==t.datumCode||(1===t.datum.datum_type||2===t.datum.datum_type||3===t.datum.datum_type)&&"WGS84"!==e.datumCode}(e,t)&&(n=Lw(e,r=new vm("WGS84"),n,i),e=r),i&&"enu"!==e.axis&&(n=k3(e,!1,n)),"longlat"===e.projName)n={x:n.x*is,y:n.y*is,z:n.z||0};else if(e.to_meter&&(n={x:n.x*e.to_meter,y:n.y*e.to_meter,z:n.z||0}),!(n=e.inverse(n)))return;if(e.from_greenwich&&(n.x+=e.from_greenwich),n=function iie(e,t,n){if(function eie(e,t){return!(e.datum_type!==t.datum_type||e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(1===e.datum_type?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:2!==e.datum_type||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t)||5===e.datum_type||5===t.datum_type)return n;var i=e.a,r=e.es;if(3===e.datum_type){if(0!==R3(e,!1,n))return;i=6378137,r=d3}var h=t.a,d=t.b,_=t.es;return 3===t.datum_type&&(h=6378137,d=6356752.314,_=d3),r!==_||i!==h||Fw(e.datum_type)||Fw(t.datum_type)?(n=A3(n,r,i),Fw(e.datum_type)&&(n=function tie(e,t,n){if(1===t)return{x:e.x+n[0],y:e.y+n[1],z:e.z+n[2]};if(2===t){var h=n[3],d=n[4],_=n[5],S=n[6];return{x:S*(e.x-_*e.y+d*e.z)+n[0],y:S*(_*e.x+e.y-h*e.z)+n[1],z:S*(-d*e.x+h*e.y+e.z)+n[2]}}}(n,e.datum_type,e.datum_params)),Fw(t.datum_type)&&(n=function nie(e,t,n){if(1===t)return{x:e.x-n[0],y:e.y-n[1],z:e.z-n[2]};if(2===t){var h=n[3],d=n[4],_=n[5],S=n[6],D=(e.x-n[0])/S,A=(e.y-n[1])/S,F=(e.z-n[2])/S;return{x:D+_*A-d*F,y:-_*D+A+h*F,z:d*D-h*A+F}}}(n,t.datum_type,t.datum_params)),n=P3(n,_,h,d),3!==t.datum_type||0===R3(t,!0,n)?n:void 0):n}(e.datum,t.datum,n))return t.from_greenwich&&(n={x:n.x-t.from_greenwich,y:n.y,z:n.z||0}),"longlat"===t.projName?n={x:n.x*Hu,y:n.y*Hu,z:n.z||0}:(n=t.forward(n),t.to_meter&&(n={x:n.x/t.to_meter,y:n.y/t.to_meter,z:n.z||0})),i&&"enu"!==t.axis?k3(t,!0,n):(n&&!a&&delete n.z,n)}var L3=vm("WGS84");function GC(e,t,n,i){var r,a,h;return Array.isArray(n)?(r=Lw(e,t,n,i)||{x:NaN,y:NaN},n.length>2?typeof e.name<"u"&&"geocent"===e.name||typeof t.name<"u"&&"geocent"===t.name?"number"==typeof r.z?[r.x,r.y,r.z].concat(n.slice(3)):[r.x,r.y,n[2]].concat(n.slice(3)):[r.x,r.y].concat(n.slice(2)):[r.x,r.y]):(a=Lw(e,t,n,i),2===(h=Object.keys(n)).length||h.forEach(function(d){if(typeof e.name<"u"&&"geocent"===e.name||typeof t.name<"u"&&"geocent"===t.name){if("x"===d||"y"===d||"z"===d)return}else if("x"===d||"y"===d)return;a[d]=n[d]}),a)}function Bw(e){return e instanceof vm?e:"object"==typeof e&&"oProj"in e?e.oProj:vm(e)}const cie={forward:V3,inverse:function uie(e){var t=HC(H3(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:U3};function V3(e,t){return t=t||5,function fie(e,t){var n="00000"+e.easting,i="00000"+e.northing;return e.zoneNumber+e.zoneLetter+function pie(e,t,n){var i=$3(n);return function gie(e,t,n){var i=n-1,r="AJSAJS".charCodeAt(i),a="AFAFAF".charCodeAt(i),h=r+e-1,d=a+t,_=!1;return h>90&&(h=h-90+65-1,_=!0),(73===h||r<73&&h>73||(h>73||r<73)&&_)&&h++,(79===h||r<79&&h>79||(h>79||r<79)&&_)&&73===++h&&h++,h>90&&(h=h-90+65-1),d>86?(d=d-86+65-1,_=!0):_=!1,(73===d||a<73&&d>73||(d>73||a<73)&&_)&&d++,(79===d||a<79&&d>79||(d>79||a<79)&&_)&&73===++d&&d++,d>86&&(d=d-86+65-1),String.fromCharCode(h)+String.fromCharCode(d)}(Math.floor(e/1e5),Math.floor(t/1e5)%20,i)}(e.easting,e.northing,e.zoneNumber)+n.substr(n.length-5,t)+i.substr(i.length-5,t)}(function hie(e){var d,_,S,D,A,Y,ne,t=e.lat,n=e.lon,i=6378137,r=.00669438,a=.9996,k=$C(t),G=$C(n);ne=Math.floor((n+180)/6)+1,180===n&&(ne=60),t>=56&&t<64&&n>=3&&n<12&&(ne=32),t>=72&&t<84&&(n>=0&&n<9?ne=31:n>=9&&n<21?ne=33:n>=21&&n<33?ne=35:n>=33&&n<42&&(ne=37)),Y=$C(6*(ne-1)-180+3),d=r/(1-r),_=i/Math.sqrt(1-r*Math.sin(k)*Math.sin(k)),S=Math.tan(k)*Math.tan(k),D=d*Math.cos(k)*Math.cos(k);var fe=a*_*((A=Math.cos(k)*(G-Y))+(1-S+D)*A*A*A/6+(5-18*S+S*S+72*D-58*d)*A*A*A*A*A/120)+5e5,ge=a*(i*(.9983242984503243*k-.002514607064228144*Math.sin(2*k)+2639046602129982e-21*Math.sin(4*k)-35*r*r*r/3072*Math.sin(6*k))+_*Math.tan(k)*(A*A/2+(5-S+9*D+4*D*D)*A*A*A*A/24+(61-58*S+S*S+600*D-330*d)*A*A*A*A*A*A/720));return t<0&&(ge+=1e7),{northing:Math.round(ge),easting:Math.round(fe),zoneNumber:ne,zoneLetter:die(t)}}({lat:e[1],lon:e[0]}),t)}function U3(e){var t=HC(H3(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function $C(e){return e*(Math.PI/180)}function G3(e){return e/Math.PI*180}function HC(e){var t=e.northing,n=e.easting,i=e.zoneLetter,r=e.zoneNumber;if(r<0||r>60)return null;var _,D,A,F,k,G,ne,fe,ge,a=.9996,h=6378137,d=.00669438,S=(1-Math.sqrt(1-d))/(1+Math.sqrt(1-d)),Le=n-5e5,je=t;i<"N"&&(je-=1e7),ne=6*(r-1)-180+3,_=d/(1-d),ge=(fe=je/a/6367449.145945056)+(3*S/2-27*S*S*S/32)*Math.sin(2*fe)+(21*S*S/16-55*S*S*S*S/32)*Math.sin(4*fe)+151*S*S*S/96*Math.sin(6*fe),D=h/Math.sqrt(1-d*Math.sin(ge)*Math.sin(ge)),A=Math.tan(ge)*Math.tan(ge),F=_*Math.cos(ge)*Math.cos(ge),k=h*(1-d)/Math.pow(1-d*Math.sin(ge)*Math.sin(ge),1.5),G=Le/(D*a);var Ge=ge-D*Math.tan(ge)/k*(G*G/2-(5+3*A+10*F-4*F*F-9*_)*G*G*G*G/24+(61+90*A+298*F+45*A*A-252*_-3*F*F)*G*G*G*G*G*G/720);Ge=G3(Ge);var at,ot=(G-(1+2*A+F)*G*G*G/6+(5-2*F+28*A-3*F*F+8*_+24*A*A)*G*G*G*G*G/120)/Math.cos(ge);if(ot=ne+G3(ot),e.accuracy){var Et=HC({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});at={top:Et.lat,right:Et.lon,bottom:Ge,left:ot}}else at={lat:Ge,lon:ot};return at}function die(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function $3(e){var t=e%6;return 0===t&&(t=6),t}function H3(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var r,t=e.length,n=null,i="",a=0;!/[A-Z]/.test(r=e.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+e;i+=r,a++}var h=parseInt(i,10);if(0===a||a+3>t)throw"MGRSPoint bad conversion from: "+e;var d=e.charAt(a++);if(d<="A"||"B"===d||"Y"===d||d>="Z"||"I"===d||"O"===d)throw"MGRSPoint zone letter "+d+" not handled: "+e;n=e.substring(a,a+=2);for(var _=$3(h),S=function mie(e,t){for(var n="AJSAJS".charCodeAt(t-1),i=1e5,r=!1;n!==e.charCodeAt(0);){if(73===++n&&n++,79===n&&n++,n>90){if(r)throw"Bad character: "+e;n=65,r=!0}i+=1e5}return i}(n.charAt(0),_),D=function _ie(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var n="AFAFAF".charCodeAt(t-1),i=0,r=!1;n!==e.charCodeAt(0);){if(73===++n&&n++,79===n&&n++,n>86){if(r)throw"Bad character: "+e;n=65,r=!0}i+=1e5}return i}(n.charAt(1),_);D<yie(d);)D+=2e6;var A=t-a;if(A%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var Y,ne,fe,F=A/2,k=0,G=0;return F>0&&(Y=1e5/Math.pow(10,F),ne=e.substring(a,a+F),k=parseFloat(ne)*Y,fe=e.substring(a+F),G=parseFloat(fe)*Y),{easting:k+S,northing:G+D,zoneLetter:d,zoneNumber:h,accuracy:Y}}function yie(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function wm(e,t,n){if(!(this instanceof wm))return new wm(e,t,n);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&typeof t>"u"){var i=e.split(",");this.x=parseFloat(i[0]),this.y=parseFloat(i[1]),this.z=parseFloat(i[2])||0}else this.x=e,this.y=t,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}wm.fromMGRS=function(e){return new wm(U3(e))},wm.prototype.toMGRS=function(e){return V3([this.x,this.y],e)};const vie=wm;var W3=.01953125,Z3=.01068115234375;function qC(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(W3+e*Z3))),t[1]=e*(.75-e*(.046875+e*(W3+e*Z3)));var n=e*e;return t[2]=n*(.46875-e*(.013020833333333334+.007120768229166667*e)),t[3]=(n*=e)*(.3645833333333333-.005696614583333333*e),t[4]=n*e*.3076171875,t}function xm(e,t,n,i){return i[0]*e-(n*=t)*(i[1]+(t*=t)*(i[2]+t*(i[3]+t*i[4])))}function WC(e,t,n){for(var i=1/(1-t),r=e,a=20;a;--a){var h=Math.sin(r),d=1-t*h*h;if(r-=d=(xm(r,h,Math.cos(r),n)-e)*(d*Math.sqrt(d))*i,Math.abs(d)<ct)return r}return r}const zw={init:function Aie(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=qC(this.es),this.ml0=xm(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function Pie(e){var r,a,h,n=e.y,i=gt(e.x-this.long0),d=Math.sin(n),_=Math.cos(n);if(this.es){var D=_*i,A=Math.pow(D,2),F=this.ep2*Math.pow(_,2),k=Math.pow(F,2),G=Math.abs(_)>ct?Math.tan(n):0,Y=Math.pow(G,2),ne=Math.pow(Y,2);r=1-this.es*Math.pow(d,2),D/=Math.sqrt(r);var fe=xm(n,d,_,this.en);a=this.a*(this.k0*D*(1+A/6*(1-Y+F+A/20*(5-18*Y+ne+14*F-58*Y*F+A/42*(61+179*ne-ne*Y-479*Y)))))+this.x0,h=this.a*(this.k0*(fe-this.ml0+d*i*D/2*(1+A/12*(5-Y+9*F+4*k+A/30*(61+ne-58*Y+270*F-330*Y*F+A/56*(1385+543*ne-ne*Y-3111*Y))))))+this.y0}else{var S=_*Math.sin(i);if(Math.abs(Math.abs(S)-1)<ct)return 93;if(a=.5*this.a*this.k0*Math.log((1+S)/(1-S))+this.x0,h=_*Math.cos(i)/Math.sqrt(1-Math.pow(S,2)),(S=Math.abs(h))>=1){if(S-1>ct)return 93;h=0}else h=Math.acos(h);n<0&&(h=-h),h=this.a*this.k0*(h-this.lat0)+this.y0}return e.x=a,e.y=h,e},inverse:function Rie(e){var t,n,i,r,a=1/this.a*(e.x-this.x0),h=1/this.a*(e.y-this.y0);if(this.es)if(n=WC(t=this.ml0+h/this.k0,this.es,this.en),Math.abs(n)<Ke){var A=Math.sin(n),F=Math.cos(n),k=Math.abs(F)>ct?Math.tan(n):0,G=this.ep2*Math.pow(F,2),Y=Math.pow(G,2),ne=Math.pow(k,2),fe=Math.pow(ne,2);t=1-this.es*Math.pow(A,2);var ge=a*Math.sqrt(t)/this.k0,Le=Math.pow(ge,2);i=n-(t*=k)*Le/(1-this.es)*.5*(1-Le/12*(5+3*ne-9*G*ne+G-4*Y-Le/30*(61+90*ne-252*G*ne+45*fe+46*G-Le/56*(1385+3633*ne+4095*fe+1574*fe*ne)))),r=gt(this.long0+ge*(1-Le/6*(1+2*ne+G-Le/20*(5+28*ne+24*fe+8*G*ne+6*G-Le/42*(61+662*ne+1320*fe+720*fe*ne))))/F)}else i=Ke*b0(h),r=0;else{var d=Math.exp(a/this.k0),_=.5*(d-1/d),D=Math.cos(this.lat0+h/this.k0);t=Math.sqrt((1-Math.pow(D,2))/(1+Math.pow(_,2))),i=Math.asin(t),h<0&&(i=-i),r=0===_&&0===D?0:gt(Math.atan2(_,D)+this.long0)}return e.x=r,e.y=i,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function K3(e){var t=Math.exp(e);return(t-1/t)/2}function Ma(e,t){e=Math.abs(e),t=Math.abs(t);var n=Math.max(e,t),i=Math.min(e,t)/(n||1);return n*Math.sqrt(1+Math.pow(i,2))}function ZC(e,t){for(var h,n=2*Math.cos(2*t),i=e.length-1,r=e[i],a=0;--i>=0;)h=n*r-a+e[i],a=r,r=h;return t+h*Math.sin(2*t)}function Y3(e,t,n){for(var G,Y,i=Math.sin(t),r=Math.cos(t),a=K3(n),h=function Lie(e){var t=Math.exp(e);return(t+1/t)/2}(n),d=2*r*h,_=-2*i*a,S=e.length-1,D=e[S],A=0,F=0,k=0;--S>=0;)G=F,Y=A,D=d*(F=D)-G-_*(A=k)+e[S],k=_*F-Y+d*A;return[(d=i*h)*D-(_=r*a)*k,d*k+_*D]}const jw={init:function Bie(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(zw.init.apply(this),this.forward=zw.forward,this.inverse=zw.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),n=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),this.cgb[1]=(n*=t)*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=n*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),this.cgb[2]=(n*=t)*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=n*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),this.cgb[3]=(n*=t)*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=n*(1237/630+t*(t*(-24832/14175)-2.4)),this.cgb[4]=(n*=t)*(4174/315+t*(-144838/6237)),this.cbg[4]=n*(-734/315+t*(109598/31185)),this.cgb[5]=(n*=t)*(601676/22275),this.cbg[5]=n*(444337/155925),n=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+n*(1/4+n*(1/64+n/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=n*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=n*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),this.utg[2]=(n*=t)*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=n*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),this.utg[3]=(n*=t)*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=n*(49561/161280+t*(-179/168+t*(6601661/7257600))),this.utg[4]=(n*=t)*(-4583/161280+t*(108847/3991680)),this.gtu[4]=n*(34729/80640+t*(-3418889/1995840)),this.utg[5]=(n*=t)*(-20648693/638668800),this.gtu[5]=.6650675310896665*n;var i=ZC(this.cbg,this.lat0);this.Zb=-this.Qn*(i+function Fie(e,t){for(var h,n=2*Math.cos(t),i=e.length-1,r=e[i],a=0;--i>=0;)h=n*r-a+e[i],a=r,r=h;return Math.sin(t)*h}(this.gtu,2*i))},forward:function zie(e){var t=gt(e.x-this.long0),n=e.y;n=ZC(this.cbg,n);var i=Math.sin(n),r=Math.cos(n),a=Math.sin(t),h=Math.cos(t);n=Math.atan2(i,h*r),t=Math.atan2(a*r,Ma(i,r*h)),t=function Oie(e){var t=Math.abs(e);return t=function kie(e){var t=1+e,n=t-1;return 0===n?e:e*Math.log(t)/n}(t*(1+t/(Ma(1,t)+1))),e<0?-t:t}(Math.tan(t));var _,S,d=Y3(this.gtu,2*n,2*t);return n+=d[0],t+=d[1],Math.abs(t)<=2.623395162778?(_=this.a*(this.Qn*t)+this.x0,S=this.a*(this.Qn*n+this.Zb)+this.y0):(_=1/0,S=1/0),e.x=_,e.y=S,e},inverse:function jie(e){var i,r,t=1/this.a*(e.x-this.x0),n=1/this.a*(e.y-this.y0);if(n=(n-this.Zb)/this.Qn,t/=this.Qn,Math.abs(t)<=2.623395162778){var a=Y3(this.utg,2*n,2*t);n+=a[0],t+=a[1],t=Math.atan(K3(t));var h=Math.sin(n),d=Math.cos(n),_=Math.sin(t),S=Math.cos(t);n=Math.atan2(h*S,Ma(_,S*d)),i=gt((t=Math.atan2(_,S*d))+this.long0),r=ZC(this.cgb,n)}else i=1/0,r=1/0;return e.x=i,e.y=r,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},qie={init:function $ie(){var e=function Uie(e,t){if(void 0===e){if((e=Math.floor(30*(gt(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*is,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,jw.init.apply(this),this.forward=jw.forward,this.inverse=jw.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function KC(e,t){return Math.pow((1-e)/(1+e),t)}const YC={init:function Zie(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+ti)/(Math.pow(Math.tan(.5*this.lat0+ti),this.C)*KC(this.e*e,this.ratexp))},forward:function Kie(e){var t=e.x,n=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+ti),this.C)*KC(this.e*Math.sin(n),this.ratexp))-Ke,e.x=this.C*t,e},inverse:function Yie(e){for(var n=e.x/this.C,i=e.y,r=Math.pow(Math.tan(.5*i+ti)/this.K,1/this.C),a=20;a>0&&(i=2*Math.atan(r*KC(this.e*Math.sin(e.y),-.5*this.e))-Ke,!(Math.abs(i-e.y)<1e-14));--a)e.y=i;return a?(e.x=n,e.y=i,e):null},names:["gauss"]},nre={init:function Qie(){YC.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function Jie(e){var t,n,i,r;return e.x=gt(e.x-this.long0),YC.forward.apply(this,[e]),t=Math.sin(e.y),n=Math.cos(e.y),i=Math.cos(e.x),e.x=(r=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*n*i))*n*Math.sin(e.x),e.y=r*(this.cosc0*t-this.sinc0*n*i),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function ere(e){var t,n,i,r,a;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,a=Ma(e.x,e.y)){var h=2*Math.atan2(a,this.R2);t=Math.sin(h),n=Math.cos(h),r=Math.asin(n*this.sinc0+e.y*t*this.cosc0/a),i=Math.atan2(e.x*t,a*this.cosc0*n-e.y*this.sinc0*t)}else r=this.phic0,i=0;return e.x=i,e.y=r,YC.inverse.apply(this,[e]),e.x=gt(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};function XC(e,t,n){return t*=n,Math.tan(.5*(Ke+e))*Math.pow((1-t)/(1+t),.5*n)}const are={init:function ire(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ct&&(this.k0=.5*(1+b0(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=ct&&(this.con=this.lat0>0?1:-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ct&&Math.abs(Math.cos(this.lat_ts))>ct&&(this.k0=.5*this.cons*qu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Fc(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=qu(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(XC(this.lat0,this.sinlat0,this.e))-Ke,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function rre(e){var a,h,d,_,S,D,t=e.x,n=e.y,i=Math.sin(n),r=Math.cos(n),A=gt(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=ct&&Math.abs(n+this.lat0)<=ct?(e.x=NaN,e.y=NaN,e):this.sphere?(a=2*this.k0/(1+this.sinlat0*i+this.coslat0*r*Math.cos(A)),e.x=this.a*a*r*Math.sin(A)+this.x0,e.y=this.a*a*(this.coslat0*i-this.sinlat0*r*Math.cos(A))+this.y0,e):(h=2*Math.atan(XC(n,i,this.e))-Ke,_=Math.cos(h),d=Math.sin(h),Math.abs(this.coslat0)<=ct?(S=Fc(this.e,n*this.con,this.con*i),e.x=this.x0+(D=2*this.a*this.k0*S/this.cons)*Math.sin(t-this.long0),e.y=this.y0-this.con*D*Math.cos(t-this.long0),e):(Math.abs(this.sinlat0)<ct?(a=2*this.a*this.k0/(1+_*Math.cos(A)),e.y=a*d):(a=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*d+this.cosX0*_*Math.cos(A))),e.y=a*(this.cosX0*d-this.sinX0*_*Math.cos(A))+this.y0),e.x=a*_*Math.sin(A)+this.x0,e))},inverse:function ore(e){e.x-=this.x0,e.y-=this.y0;var t,n,r,a,h=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var d=2*Math.atan(h/(2*this.a*this.k0));return t=this.long0,n=this.lat0,h<=ct?(e.x=t,e.y=n,e):(n=Math.asin(Math.cos(d)*this.sinlat0+e.y*Math.sin(d)*this.coslat0/h),t=Math.abs(this.coslat0)<ct?gt(this.lat0>0?this.long0+Math.atan2(e.x,-1*e.y):this.long0+Math.atan2(e.x,e.y)):gt(this.long0+Math.atan2(e.x*Math.sin(d),h*this.coslat0*Math.cos(d)-e.y*this.sinlat0*Math.sin(d))),e.x=t,e.y=n,e)}if(Math.abs(this.coslat0)<=ct){if(h<=ct)return n=this.lat0,e.x=t=this.long0,e.y=n,e;e.x*=this.con,e.y*=this.con,n=this.con*w0(this.e,h*this.cons/(2*this.a*this.k0)),t=this.con*gt(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else r=2*Math.atan(h*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,h<=ct?a=this.X0:(a=Math.asin(Math.cos(r)*this.sinX0+e.y*Math.sin(r)*this.cosX0/h),t=gt(this.long0+Math.atan2(e.x*Math.sin(r),h*this.cosX0*Math.cos(r)-e.y*this.sinX0*Math.sin(r)))),n=-1*w0(this.e,Math.tan(.5*(Ke+a)));return e.x=t,e.y=n,e},names:["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"],ssfn_:XC},dre={init:function lre(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),n=this.a,r=1/this.rf,a=2*r-Math.pow(r,2),h=this.e=Math.sqrt(a);this.R=this.k0*n*Math.sqrt(1-a)/(1-a*Math.pow(t,2)),this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var d=Math.log(Math.tan(Math.PI/4+this.b0/2)),_=Math.log(Math.tan(Math.PI/4+e/2)),S=Math.log((1+h*t)/(1-h*t));this.K=d-this.alpha*_+this.alpha*h/2*S},forward:function cre(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=2*(Math.atan(Math.exp(-this.alpha*(t+n)+this.K))-Math.PI/4),a=this.alpha*(e.x-this.lambda0),h=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(a))),d=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(a));return e.y=this.R/2*Math.log((1+Math.sin(d))/(1-Math.sin(d)))+this.y0,e.x=this.R*h+this.x0,e},inverse:function ure(e){for(var i=(e.x-this.x0)/this.R,r=2*(Math.atan(Math.exp((e.y-this.y0)/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),h=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),d=this.lambda0+h/this.alpha,_=0,S=a,D=-1e3,A=0;Math.abs(S-D)>1e-7;){if(++A>20)return;_=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(S))/2)),D=S,S=2*Math.atan(Math.exp(_))-Math.PI/2}return e.x=d,e.y=S,e},names:["somerc"]};var Sm=1e-7;const yre={init:function pre(){var e,t,n,i,r,a,h,d,_,S,A,D=0,F=0,k=0,G=0,Y=0,ne=0,fe=0;this.no_off=function fre(e){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],n="object"==typeof e.projName?Object.keys(e.projName)[0]:e.projName;return"no_uoff"in e||"no_off"in e||-1!==t.indexOf(n)||-1!==t.indexOf(C3(n))}(this),this.no_rot="no_rot"in this;var ge=!1;"alpha"in this&&(ge=!0);var Le=!1;if("rectified_grid_angle"in this&&(Le=!0),ge&&(fe=this.alpha),Le&&(D=this.rectified_grid_angle),ge||Le)F=this.longc;else if(k=this.long1,Y=this.lat1,G=this.long2,ne=this.lat2,Math.abs(Y-ne)<=Sm||(e=Math.abs(Y))<=Sm||Math.abs(e-Ke)<=Sm||Math.abs(Math.abs(this.lat0)-Ke)<=Sm||Math.abs(Math.abs(ne)-Ke)<=Sm)throw new Error;var je=1-this.es;t=Math.sqrt(je),Math.abs(this.lat0)>ct?(d=Math.sin(this.lat0),n=Math.cos(this.lat0),e=1-this.es*d*d,this.B=n*n,this.B=Math.sqrt(1+this.es*this.B*this.B/je),this.A=this.B*this.k0*t/e,(r=(i=this.B*t/(n*Math.sqrt(e)))*i-1)<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(Fc(this.e,this.lat0,d),this.B)):(this.B=1/t,this.A=this.k0,this.E=i=r=1),ge||Le?(ge?(A=Math.asin(Math.sin(fe)/i),Le||(D=fe)):(A=D,fe=Math.asin(i*Math.sin(A))),this.lam0=F-Math.asin(.5*(r-1/r)*Math.tan(A))/this.B):(a=Math.pow(Fc(this.e,Y,Math.sin(Y)),this.B),h=Math.pow(Fc(this.e,ne,Math.sin(ne)),this.B),r=this.E/a,_=(h-a)/(h+a),S=((S=this.E*this.E)-h*a)/(S+h*a),(e=k-G)<-Math.PI?G-=y0:e>Math.PI&&(G+=y0),this.lam0=gt(.5*(k+G)-Math.atan(S*Math.tan(.5*this.B*(k-G))/_)/this.B),A=Math.atan(2*Math.sin(this.B*gt(k-this.lam0))/(r-1/r)),D=fe=Math.asin(i*Math.sin(A))),this.singam=Math.sin(A),this.cosgam=Math.cos(A),this.sinrot=Math.sin(D),this.cosrot=Math.cos(D),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(fe))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*A,this.v_pole_n=this.ArB*Math.log(Math.tan(ti-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(ti+r))},forward:function gre(e){var n,i,r,a,h,d,_,S,t={};if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-Ke)>ct){if(n=.5*((h=this.E/Math.pow(Fc(this.e,e.y,Math.sin(e.y)),this.B))-(d=1/h)),i=.5*(h+d),a=Math.sin(this.B*e.x),r=(n*this.singam-a*this.cosgam)/i,Math.abs(Math.abs(r)-1)<ct)throw new Error;S=.5*this.ArB*Math.log((1-r)/(1+r)),d=Math.cos(this.B*e.x),_=Math.abs(d)<Sm?this.A*e.x:this.ArB*Math.atan2(n*this.cosgam+a*this.singam,d)}else S=e.y>0?this.v_pole_n:this.v_pole_s,_=this.ArB*e.y;return this.no_rot?(t.x=_,t.y=S):(t.x=S*this.cosrot+(_-=this.u_0)*this.sinrot,t.y=_*this.cosrot-S*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function mre(e){var t,n,i,r,a,h,d,_={};if(e.x=1/this.a*(e.x-this.x0),e.y=1/this.a*(e.y-this.y0),this.no_rot?(n=e.y,t=e.x):(n=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),r=.5*((i=Math.exp(-this.BrA*n))-1/i),a=.5*(i+1/i),d=((h=Math.sin(this.BrA*t))*this.cosgam+r*this.singam)/a,Math.abs(Math.abs(d)-1)<ct)_.x=0,_.y=d<0?-Ke:Ke;else{if(_.y=this.E/Math.sqrt((1+d)/(1-d)),_.y=w0(this.e,Math.pow(_.y,1/this.B)),_.y===1/0)throw new Error;_.x=-this.rB*Math.atan2(r*this.cosgam-h*this.singam,Math.cos(this.BrA*t))}return _.x+=this.lam0,_},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},Sre={init:function vre(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<ct)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),n=Math.cos(this.lat1),i=qu(this.e,t,n),r=Fc(this.e,this.lat1,t),a=Math.sin(this.lat2),h=Math.cos(this.lat2),d=qu(this.e,a,h),_=Fc(this.e,this.lat2,a),S=Math.abs(Math.abs(this.lat0)-Ke)<ct?0:Fc(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>ct?Math.log(i/d)/Math.log(r/_):t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(S,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function bre(e){var t=e.x,n=e.y;Math.abs(2*Math.abs(n)-Math.PI)<=ct&&(n=b0(n)*(Ke-2*ct));var r,a,i=Math.abs(Math.abs(n)-Ke);if(i>ct)r=Fc(this.e,n,Math.sin(n)),a=this.a*this.f0*Math.pow(r,this.ns);else{if((i=n*this.ns)<=0)return null;a=0}var h=this.ns*gt(t-this.long0);return e.x=this.k0*(a*Math.sin(h))+this.x0,e.y=this.k0*(this.rh-a*Math.cos(h))+this.y0,e},inverse:function wre(e){var t,n,i,r,a,h=(e.x-this.x0)/this.k0,d=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(h*h+d*d),n=1):(t=-Math.sqrt(h*h+d*d),n=-1);var _=0;if(0!==t&&(_=Math.atan2(n*h,n*d)),0!==t||this.ns>0){if(n=1/this.ns,i=Math.pow(t/(this.a*this.f0),n),-9999===(r=w0(this.e,i)))return null}else r=-Ke;return a=gt(_/this.ns+this.long0),e.x=a,e.y=r,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},Tre={init:function Ere(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function Mre(e){var t,n,i,r,a,h,d,S=e.y,D=gt(e.x-this.long0);return t=Math.pow((1+this.e*Math.sin(S))/(1-this.e*Math.sin(S)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(S/2+this.s45),this.alfa)/t)-this.s45),i=-D*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),a=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(r)),h=this.n*a,d=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),e.y=d*Math.cos(h)/1,e.x=d*Math.sin(h)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function Dre(e){var t,n,i,r,h,d,_,S=e.x;e.x=e.y,e.y=S,this.czech||(e.y*=-1,e.x*=-1),h=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.atan2(e.y,e.x)/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/h,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),n=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(t)),e.x=this.long0-n/this.alfa,d=t,_=0;var D=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(d))/(1-this.e*Math.sin(d)),this.e/2))-this.s45),Math.abs(d-e.y)<1e-10&&(_=1),d=e.y,D+=1}while(0===_&&D<15);return D>=15?null:e},names:["Krovak","krovak"]};function Vs(e,t,n,i,r){return e*r-t*Math.sin(2*r)+n*Math.sin(4*r)-i*Math.sin(6*r)}function E0(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function M0(e){return.375*e*(1+.25*e*(1+.46875*e))}function D0(e){return.05859375*e*e*(1+.75*e)}function C0(e){return e*e*e*(35/3072)}function QC(e,t,n){var i=t*n;return e/Math.sqrt(1-i*i)}function Kd(e){return Math.abs(e)<Ke?e:e-b0(e)*Math.PI}function Vw(e,t,n,i,r){var a,h;a=e/t;for(var d=0;d<15;d++)if(a+=h=(e-(t*a-n*Math.sin(2*a)+i*Math.sin(4*a)-r*Math.sin(6*a)))/(t-2*n*Math.cos(2*a)+4*i*Math.cos(4*a)-6*r*Math.cos(6*a)),Math.abs(h)<=1e-10)return a;return NaN}const Nre={init:function Ire(){this.sphere||(this.e0=E0(this.es),this.e1=M0(this.es),this.e2=D0(this.es),this.e3=C0(this.es),this.ml0=this.a*Vs(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function Are(e){var t,n,i=e.x,r=e.y;if(i=gt(i-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(r)*Math.sin(i)),n=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var a=Math.sin(r),h=Math.cos(r),d=QC(this.a,this.e,a),_=Math.tan(r)*Math.tan(r),S=i*Math.cos(r),D=S*S,A=this.es*h*h/(1-this.es);t=d*S*(1-D*_*(1/6-(8-_+8*A)*D/120)),n=this.a*Vs(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+d*a/h*D*(.5+(5-_+6*A)*D/24)}return e.x=t+this.x0,e.y=n+this.y0,e},inverse:function Pre(e){e.x-=this.x0,e.y-=this.y0;var i,r,t=e.x/this.a,n=e.y/this.a;if(this.sphere){var a=n+this.lat0;i=Math.asin(Math.sin(a)*Math.cos(t)),r=Math.atan2(Math.tan(t),Math.cos(a))}else{var d=Vw(this.ml0/this.a+n,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(d)-Ke)<=ct)return e.x=this.long0,e.y=Ke,n<0&&(e.y*=-1),e;var _=QC(this.a,this.e,Math.sin(d)),S=_*_*_/this.a/this.a*(1-this.es),D=Math.pow(Math.tan(d),2),A=t*this.a/_,F=A*A;i=d-_*Math.tan(d)/S*A*A*(.5-(1+3*D)*A*A/24),r=A*(1-F*(D/3+(1+3*D)*D*F/15))/Math.cos(d)}return e.x=gt(r+this.long0),e.y=Kd(i),e},names:["Cassini","Cassini_Soldner","cass"]};function Yd(e,t){var n;return e>1e-7?(1-e*e)*(t/(1-(n=e*t)*n)-.5/e*Math.log((1-n)/(1+n))):2*t}const qre={init:function kre(){var t,e=Math.abs(this.lat0);if(this.mode=Math.abs(e-Ke)<ct?this.lat0<0?1:2:Math.abs(e)<ct?3:4,this.es>0)switch(this.qp=Yd(this.e,1),this.mmf=.5/(1-this.es),this.apa=function Gre(e){var t,n=[];return n[0]=.3333333333333333*e,n[0]+=.17222222222222222*(t=e*e),n[1]=.06388888888888888*t,n[0]+=.10257936507936508*(t*=e),n[1]+=.0664021164021164*t,n[2]=.016415012942191543*t,n}(this.es),this.mode){case 2:case 1:this.dd=1;break;case 3:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case 4:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Yd(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else 4===this.mode&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function Ore(e){var t,n,i,r,a,h,d,_,S,D,A=e.x,F=e.y;if(A=gt(A-this.long0),this.sphere){if(a=Math.sin(F),D=Math.cos(F),i=Math.cos(A),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((n=this.mode===this.EQUIT?1+D*i:1+this.sinph0*a+this.cosph0*D*i)<=ct)return null;t=(n=Math.sqrt(2/n))*D*Math.sin(A),n*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*D*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(F+this.lat0)<ct)return null;n=ti-.5*F,t=(n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)))*Math.sin(A),n*=i}}else{switch(d=0,_=0,S=0,i=Math.cos(A),r=Math.sin(A),a=Math.sin(F),h=Yd(this.e,a),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=h/this.qp,_=Math.sqrt(1-d*d)),this.mode){case this.OBLIQ:S=1+this.sinb1*d+this.cosb1*_*i;break;case this.EQUIT:S=1+_*i;break;case this.N_POLE:S=Ke+F,h=this.qp-h;break;case this.S_POLE:S=F-Ke,h=this.qp+h}if(Math.abs(S)<ct)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:S=Math.sqrt(2/S),n=this.mode===this.OBLIQ?this.ymf*S*(this.cosb1*d-this.sinb1*_*i):(S=Math.sqrt(2/(1+_*i)))*d*this.ymf,t=this.xmf*S*_*r;break;case this.N_POLE:case this.S_POLE:h>=0?(t=(S=Math.sqrt(h))*r,n=i*(this.mode===this.S_POLE?S:-S)):t=n=0}}return e.x=this.a*t+this.x0,e.y=this.a*n+this.y0,e},inverse:function Fre(e){e.x-=this.x0,e.y-=this.y0;var i,r,a,h,d,_,S,t=e.x/this.a,n=e.y/this.a;if(this.sphere){var A,D=0,F=0;if((r=.5*(A=Math.sqrt(t*t+n*n)))>1)return null;switch(r=2*Math.asin(r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(F=Math.sin(r),D=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(A)<=ct?0:Math.asin(n*F/A),t*=F,n=D*A;break;case this.OBLIQ:r=Math.abs(A)<=ct?this.lat0:Math.asin(D*this.sinph0+n*F*this.cosph0/A),t*=F*this.cosph0,n=(D-Math.sin(r)*this.sinph0)*A;break;case this.N_POLE:n=-n,r=Ke-r;break;case this.S_POLE:r-=Ke}i=0!==n||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(t,n):0}else{if(S=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,n*=this.dd,(_=Math.sqrt(t*t+n*n))<ct)return e.x=this.long0,e.y=this.lat0,e;h=2*Math.asin(.5*_/this.rq),a=Math.cos(h),t*=h=Math.sin(h),this.mode===this.OBLIQ?(d=this.qp*(S=a*this.sinb1+n*h*this.cosb1/_),n=_*this.cosb1*a-n*this.sinb1*h):(d=this.qp*(S=n*h/_),n=_*a)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),!(d=t*t+n*n))return e.x=this.long0,e.y=this.lat0,e;S=1-d/this.qp,this.mode===this.S_POLE&&(S=-S)}i=Math.atan2(t,n),r=function $re(e,t){var n=e+e;return e+t[0]*Math.sin(n)+t[1]*Math.sin(n+n)+t[2]*Math.sin(n+n+n)}(Math.asin(S),this.apa)}return e.x=gt(this.long0+i),e.y=r,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Xd(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}const Qre={init:function Wre(){Math.abs(this.lat1+this.lat2)<ct||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=qu(this.e3,this.sin_po,this.cos_po),this.qs1=Yd(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=qu(this.e3,this.sin_po,this.cos_po),this.qs2=Yd(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Yd(this.e3,this.sin_po),this.ns0=Math.abs(this.lat1-this.lat2)>ct?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function Zre(e){var t=e.x,n=e.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var i=Yd(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,a=this.ns0*gt(t-this.long0),h=r*Math.sin(a)+this.x0,d=this.rh-r*Math.cos(a)+this.y0;return e.x=h,e.y=d,e},inverse:function Kre(e){var t,i,r,a,h;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),i=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),i=-1),r=0,0!==t&&(r=Math.atan2(i*e.x,i*e.y)),i=t*this.ns0/this.a,h=this.sphere?Math.asin((this.c-i*i)/(2*this.ns0)):this.phi1z(this.e3,(this.c-i*i)/this.ns0),a=gt(r/this.ns0+this.long0),e.x=a,e.y=h,e},names:["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"],phi1z:function Yre(e,t){var n,r,a,h,d=Xd(.5*t);if(e<ct)return d;for(var _=e*e,S=1;S<=25;S++)if(d+=h=.5*(a=1-(r=e*(n=Math.sin(d)))*r)*a/Math.cos(d)*(t/(1-_)-n/a+.5/e*Math.log((1-r)/(1+r))),Math.abs(h)<=1e-7)return d;return null}},ioe={init:function Jre(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function eoe(e){var t,n,i,r,h,d,_,D=e.y;return i=gt(e.x-this.long0),t=Math.sin(D),n=Math.cos(D),r=Math.cos(i),(h=this.sin_p14*t+this.cos_p14*n*r)>0||Math.abs(h)<=ct?(d=this.x0+1*this.a*n*Math.sin(i)/h,_=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*r)/h):(d=this.x0+this.infinity_dist*n*Math.sin(i),_=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*n*r)),e.x=d,e.y=_,e},inverse:function toe(e){var t,n,i,r,a,h;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(r=Math.atan2(t,this.rc),n=Math.sin(r),h=Xd((i=Math.cos(r))*this.sin_p14+e.y*n*this.cos_p14/t),a=Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n),a=gt(this.long0+a)):(h=this.phic0,a=0),e.x=a,e.y=h,e},names:["gnom"]},coe={init:function ooe(){this.sphere||(this.k0=qu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function soe(e){var i,r,n=e.y,a=gt(e.x-this.long0);if(this.sphere)i=this.x0+this.a*a*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);else{var h=Yd(this.e,Math.sin(n));i=this.x0+this.a*this.k0*a,r=this.y0+this.a*h*.5/this.k0}return e.x=i,e.y=r,e},inverse:function aoe(e){var t,n;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=gt(this.long0+e.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(n=function roe(e,t){var n=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-n)<1e-6)return t<0?-1*Ke:Ke;for(var r,a,h,d,i=Math.asin(.5*t),_=0;_<30;_++)if(a=Math.sin(i),h=Math.cos(i),d=e*a,i+=r=Math.pow(1-d*d,2)/(2*h)*(t/(1-e*e)-a/(1-d*d)+.5/e*Math.log((1-d)/(1+d))),Math.abs(r)<=1e-10)return i;return NaN}(this.e,2*e.y*this.k0/this.a),t=gt(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=n,e},names:["cea"]},poe={init:function uoe(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function hoe(e){var n=e.y,i=gt(e.x-this.long0),r=Kd(n-this.lat0);return e.x=this.x0+this.a*i*this.rc,e.y=this.y0+this.a*r,e},inverse:function doe(e){var n=e.y;return e.x=gt(this.long0+(e.x-this.x0)/(this.a*this.rc)),e.y=Kd(this.lat0+(n-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"]},voe={init:function goe(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=E0(this.es),this.e1=M0(this.es),this.e2=D0(this.es),this.e3=C0(this.es),this.ml0=this.a*Vs(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function moe(e){var i,r,a,n=e.y,h=gt(e.x-this.long0);if(a=h*Math.sin(n),this.sphere)Math.abs(n)<=ct?(i=this.a*h,r=-1*this.a*this.lat0):(i=this.a*Math.sin(a)/Math.tan(n),r=this.a*(Kd(n-this.lat0)+(1-Math.cos(a))/Math.tan(n)));else if(Math.abs(n)<=ct)i=this.a*h,r=-1*this.ml0;else{var d=QC(this.a,this.e,Math.sin(n))/Math.tan(n);i=d*Math.sin(a),r=this.a*Vs(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+d*(1-Math.cos(a))}return e.x=i+this.x0,e.y=r+this.y0,e},inverse:function _oe(e){var t,n,i,r,a,h,d,_,S;if(i=e.x-this.x0,r=e.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=ct)t=gt(i/this.a+this.long0),n=0;else{var D;for(d=i*i/this.a/this.a+(h=this.lat0+r/this.a)*h,_=h,a=20;a;--a)if(_+=S=-1*(h*(_*(D=Math.tan(_))+1)-_-.5*(_*_+d)*D)/((_-h)/D-1),Math.abs(S)<=ct){n=_;break}t=gt(this.long0+Math.asin(i*Math.tan(_)/this.a)/Math.sin(n))}else if(Math.abs(r+this.ml0)<=ct)n=0,t=gt(this.long0+i/this.a);else{var A,F,k,G,Y;for(d=i*i/this.a/this.a+(h=(this.ml0+r)/this.a)*h,_=h,a=20;a;--a)if(Y=this.e*Math.sin(_),A=Math.sqrt(1-Y*Y)*Math.tan(_),F=this.a*Vs(this.e0,this.e1,this.e2,this.e3,_),k=this.e0-2*this.e1*Math.cos(2*_)+4*this.e2*Math.cos(4*_)-6*this.e3*Math.cos(6*_),_-=S=(h*(A*(G=F/this.a)+1)-G-.5*A*(G*G+d))/(this.es*Math.sin(2*_)*(G*G+d-2*h*G)/(4*A)+(h-G)*(A*k-2/Math.sin(2*_))-k),Math.abs(S)<=ct){n=_;break}A=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),t=gt(this.long0+Math.asin(i*A/this.a)/Math.sin(n))}return e.x=t,e.y=n,e},names:["Polyconic","American_Polyconic","poly"]},Eoe={init:function boe(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function woe(e){var t,h=(e.y-this.lat0)/_0*1e-5,d=e.x-this.long0,_=1,S=0;for(t=1;t<=10;t++)S+=this.A[t]*(_*=h);var Y,D=S,A=d,F=1,k=0,ne=0,fe=0;for(t=1;t<=6;t++)Y=k*D+F*A,ne=ne+this.B_re[t]*(F=F*D-k*A)-this.B_im[t]*(k=Y),fe=fe+this.B_im[t]*F+this.B_re[t]*k;return e.x=fe*this.a+this.x0,e.y=ne*this.a+this.y0,e},inverse:function xoe(e){var t,A,h=(e.y-this.y0)/this.a,d=(e.x-this.x0)/this.a,_=1,S=0,F=0,k=0;for(t=1;t<=6;t++)A=S*h+_*d,F=F+this.C_re[t]*(_=_*h-S*d)-this.C_im[t]*(S=A),k=k+this.C_im[t]*_+this.C_re[t]*S;for(var G=0;G<this.iterations;G++){var ge,Y=F,ne=k,Le=h,je=d;for(t=2;t<=6;t++)ge=ne*F+Y*k,Le+=(t-1)*(this.B_re[t]*(Y=Y*F-ne*k)-this.B_im[t]*(ne=ge)),je+=(t-1)*(this.B_im[t]*Y+this.B_re[t]*ne);Y=1,ne=0;var Ge=this.B_re[1],ot=this.B_im[1];for(t=2;t<=6;t++)ge=ne*F+Y*k,Ge+=t*(this.B_re[t]*(Y=Y*F-ne*k)-this.B_im[t]*(ne=ge)),ot+=t*(this.B_im[t]*Y+this.B_re[t]*ne);var at=Ge*Ge+ot*ot;F=(Le*Ge+je*ot)/at,k=(je*Ge-Le*ot)/at}var Et=F,en=k,Fn=1,Kn=0;for(t=1;t<=9;t++)Kn+=this.D[t]*(Fn*=Et);var Gi=this.lat0+Kn*_0*1e5;return e.x=this.long0+en,e.y=Gi,e},names:["New_Zealand_Map_Grid","nzmg"]},Ioe={init:function Moe(){},forward:function Doe(e){var n=e.y,i=gt(e.x-this.long0),r=this.x0+this.a*i,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return e.x=r,e.y=a,e},inverse:function Coe(e){e.x-=this.x0,e.y-=this.y0;var t=gt(this.long0+e.x/this.a),n=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=n,e},names:["Miller_Cylindrical","mill"]},Ooe={init:function Poe(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=qC(this.es)},forward:function Roe(e){var t,n,i=e.x,r=e.y;if(i=gt(i-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(r),h=20;h;--h){var d=(this.m*r+Math.sin(r)-a)/(this.m+Math.cos(r));if(r-=d,Math.abs(d)<ct)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;t=this.a*this.C_x*i*(this.m+Math.cos(r)),n=this.a*this.C_y*r}else{var _=Math.sin(r),S=Math.cos(r);n=this.a*xm(r,_,S,this.en),t=this.a*i*S/Math.sqrt(1-this.es*_*_)}return e.x=t,e.y=n,e},inverse:function Noe(e){var t,i,r;return e.x-=this.x0,i=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,i/=this.C_x*(this.m+Math.cos(t)),this.m?t=Xd((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=Xd(Math.sin(t)/this.n)),i=gt(i+this.long0),t=Kd(t)):(t=WC(e.y/this.a,this.es,this.en),(r=Math.abs(t))<Ke?(r=Math.sin(t),i=gt(this.long0+e.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(t)))):r-ct<Ke&&(i=this.long0)),e.x=i,e.y=t,e},names:["Sinusoidal","sinu"]},joe={init:function Foe(){},forward:function Loe(e){for(var n=e.y,i=gt(e.x-this.long0),r=n,a=Math.PI*Math.sin(n);;){var h=-(r+Math.sin(r)-a)/(1+Math.cos(r));if(r+=h,Math.abs(h)<ct)break}r/=2,Math.PI/2-Math.abs(n)<ct&&(i=0);var d=.900316316158*this.a*i*Math.cos(r)+this.x0,_=1.4142135623731*this.a*Math.sin(r)+this.y0;return e.x=d,e.y=_,e},inverse:function Boe(e){var t,n;e.x-=this.x0,e.y-=this.y0,n=e.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),t=Math.asin(n);var i=gt(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),n=(2*t+Math.sin(2*t))/Math.PI,Math.abs(n)>1&&(n=1);var r=Math.asin(n);return e.x=i,e.y=r,e},names:["Mollweide","moll"]},Hoe={init:function Voe(){Math.abs(this.lat1+this.lat2)<ct||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=E0(this.es),this.e1=M0(this.es),this.e2=D0(this.es),this.e3=C0(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=qu(this.e,this.sin_phi,this.cos_phi),this.ml1=Vs(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<ct?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=qu(this.e,this.sin_phi,this.cos_phi),this.ml2=Vs(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Vs(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function Uoe(e){var i,t=e.x,n=e.y;if(this.sphere)i=this.a*(this.g-n);else{var r=Vs(this.e0,this.e1,this.e2,this.e3,n);i=this.a*(this.g-r)}var a=this.ns*gt(t-this.long0),h=this.x0+i*Math.sin(a),d=this.y0+this.rh-i*Math.cos(a);return e.x=h,e.y=d,e},inverse:function Goe(e){var t,n,i,r;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(n=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(n=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var a=0;return 0!==n&&(a=Math.atan2(t*e.x,t*e.y)),this.sphere?(r=gt(this.long0+a/this.ns),i=Kd(this.g-n/this.a),e.x=r,e.y=i,e):(i=Vw(this.g-n/this.a,this.e0,this.e1,this.e2,this.e3),r=gt(this.long0+a/this.ns),e.x=r,e.y=i,e)},names:["Equidistant_Conic","eqdc"]},Yoe={init:function qoe(){this.R=this.a},forward:function Woe(e){var r,a,n=e.y,i=gt(e.x-this.long0);Math.abs(n)<=ct&&(r=this.x0+this.R*i,a=this.y0);var h=Xd(2*Math.abs(n/Math.PI));(Math.abs(i)<=ct||Math.abs(Math.abs(n)-Ke)<=ct)&&(r=this.x0,a=n>=0?this.y0+Math.PI*this.R*Math.tan(.5*h):this.y0+Math.PI*this.R*-Math.tan(.5*h));var d=.5*Math.abs(Math.PI/i-i/Math.PI),_=d*d,S=Math.sin(h),D=Math.cos(h),A=D/(S+D-1),k=A*(2/S-1),G=k*k,Y=Math.PI*this.R*(d*(A-G)+Math.sqrt(_*(A-G)*(A-G)-(G+_)*(A*A-G)))/(G+_);i<0&&(Y=-Y),r=this.x0+Y;var ne=_+A;return Y=Math.PI*this.R*(k*ne-d*Math.sqrt((G+_)*(_+1)-ne*ne))/(G+_),a=n>=0?this.y0+Y:this.y0-Y,e.x=r,e.y=a,e},inverse:function Zoe(e){var t,n,i,r,a,h,d,_,S,D,A,F;return e.x-=this.x0,e.y-=this.y0,A=Math.PI*this.R,a=(i=e.x/A)*i+(r=e.y/A)*r,A=3*(r*r/(_=-2*(h=-Math.abs(r)*(1+a))+1+2*r*r+a*a)+(2*(d=h-2*r*r+i*i)*d*d/_/_/_-9*h*d/_/_)/27)/(S=(h-d*d/3/_)/_)/(D=2*Math.sqrt(-S/3)),Math.abs(A)>1&&(A=A>=0?1:-1),F=Math.acos(A)/3,n=e.y>=0?(-D*Math.cos(F+Math.PI/3)-d/3/_)*Math.PI:-(-D*Math.cos(F+Math.PI/3)-d/3/_)*Math.PI,t=Math.abs(i)<ct?this.long0:gt(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(i*i-r*r)+a*a))/2/i),e.x=t,e.y=n,e},names:["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"]},ise={init:function Joe(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))},forward:function ese(e){var h,d,_,S,D,A,F,k,G,Y,ne,t=e.x,n=e.y,i=Math.sin(e.y),r=Math.cos(e.y),a=gt(t-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=ct?(e.x=this.x0+this.a*(Ke-n)*Math.sin(a),e.y=this.y0-this.a*(Ke-n)*Math.cos(a),e):Math.abs(this.sin_p12+1)<=ct?(e.x=this.x0+this.a*(Ke+n)*Math.sin(a),e.y=this.y0+this.a*(Ke+n)*Math.cos(a),e):(G=this.sin_p12*i+this.cos_p12*r*Math.cos(a),k=(F=Math.acos(G))?F/Math.sin(F):1,e.x=this.x0+this.a*k*r*Math.sin(a),e.y=this.y0+this.a*k*(this.cos_p12*i-this.sin_p12*r*Math.cos(a)),e):(h=E0(this.es),d=M0(this.es),_=D0(this.es),S=C0(this.es),Math.abs(this.sin_p12-1)<=ct?(D=this.a*Vs(h,d,_,S,Ke),A=this.a*Vs(h,d,_,S,n),e.x=this.x0+(D-A)*Math.sin(a),e.y=this.y0-(D-A)*Math.cos(a),e):Math.abs(this.sin_p12+1)<=ct?(D=this.a*Vs(h,d,_,S,Ke),A=this.a*Vs(h,d,_,S,n),e.x=this.x0+(D+A)*Math.sin(a),e.y=this.y0+(D+A)*Math.cos(a),e):Math.abs(t)<ct&&Math.abs(n-this.lat0)<ct?(e.x=e.y=0,e):(Y=function Xoe(e,t,n,i,r,a){const h=i-t,d=Math.atan((1-a)*Math.tan(e)),_=Math.atan((1-a)*Math.tan(n)),S=Math.sin(d),D=Math.cos(d),A=Math.sin(_),F=Math.cos(_);let G,ne,fe,ge,Le,je,Ge,ot,at,Et,en,Fn,Kn,Gi,$i,k=h,Y=100;do{if(ne=Math.sin(k),fe=Math.cos(k),ge=Math.sqrt(F*ne*(F*ne)+(D*A-S*F*fe)*(D*A-S*F*fe)),0===ge)return{azi1:0,s12:0};Le=S*A+D*F*fe,je=Math.atan2(ge,Le),Ge=D*F*ne/ge,ot=1-Ge*Ge,at=0!==ot?Le-2*S*A/ot:0,Et=a/16*ot*(4+a*(4-3*ot)),G=k,k=h+(1-Et)*a*Ge*(je+Et*ge*(at+Et*Le*(2*at*at-1)))}while(Math.abs(k-G)>1e-12&&--Y>0);return 0===Y?{azi1:NaN,s12:NaN}:(en=ot*(r*r-r*(1-a)*(r*(1-a)))/(r*(1-a)*(r*(1-a))),Fn=1+en/16384*(4096+en*(en*(320-175*en)-768)),Kn=en/1024*(256+en*(en*(74-47*en)-128)),Gi=Kn*ge*(at+Kn/4*(Le*(2*at*at-1)-Kn/6*at*(4*ge*ge-3)*(4*at*at-3))),$i=r*(1-a)*Fn*(je-Gi),{azi1:Math.atan2(F*ne,D*A-S*F*fe),s12:$i})}(this.lat0,this.long0,n,t,this.a,this.f),ne=Y.azi1,e.x=Y.s12*Math.sin(ne),e.y=Y.s12*Math.cos(ne),e))},inverse:function tse(e){var t,n,i,r,a,h,d,_,S,D,A,F,G,Y,ne;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=Math.sqrt(e.x*e.x+e.y*e.y))>2*Ke*this.a?void 0:(n=t/this.a,i=Math.sin(n),r=Math.cos(n),a=this.long0,Math.abs(t)<=ct?h=this.lat0:(h=Xd(r*this.sin_p12+e.y*i*this.cos_p12/t),d=Math.abs(this.lat0)-Ke,a=Math.abs(d)<=ct?gt(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)):gt(this.long0+Math.atan2(e.x*i,t*this.cos_p12*r-e.y*this.sin_p12*i))),e.x=a,e.y=h,e):(_=E0(this.es),S=M0(this.es),D=D0(this.es),A=C0(this.es),Math.abs(this.sin_p12-1)<=ct?(h=Vw(((F=this.a*Vs(_,S,D,A,Ke))-(t=Math.sqrt(e.x*e.x+e.y*e.y)))/this.a,_,S,D,A),a=gt(this.long0+Math.atan2(e.x,-1*e.y)),e.x=a,e.y=h,e):Math.abs(this.sin_p12+1)<=ct?(F=this.a*Vs(_,S,D,A,Ke),h=Vw(((t=Math.sqrt(e.x*e.x+e.y*e.y))-F)/this.a,_,S,D,A),a=gt(this.long0+Math.atan2(e.x,e.y)),e.x=a,e.y=h,e):(G=Math.atan2(e.x,e.y),Y=Math.sqrt(e.x*e.x+e.y*e.y),ne=function Qoe(e,t,n,i,r,a){const h=Math.atan((1-a)*Math.tan(e)),d=Math.sin(h),_=Math.cos(h),S=Math.sin(n),D=Math.cos(n),A=Math.atan2(d,_*D),F=_*S,k=1-F*F,G=k*(r*r-r*(1-a)*(r*(1-a)))/(r*(1-a)*(r*(1-a))),Y=1+G/16384*(4096+G*(G*(320-175*G)-768)),ne=G/1024*(256+G*(G*(74-47*G)-128));let ge,je,Ge,ot,at,fe=i/(r*(1-a)*Y),Le=100;do{je=Math.cos(2*A+fe),Ge=Math.sin(fe),ot=Math.cos(fe),at=ne*Ge*(je+ne/4*(ot*(2*je*je-1)-ne/6*je*(4*Ge*Ge-3)*(4*je*je-3))),ge=fe,fe=i/(r*(1-a)*Y)+at}while(Math.abs(fe-ge)>1e-12&&--Le>0);if(0===Le)return{lat2:NaN,lon2:NaN};const Et=d*Ge-_*ot*D,Kn=a/16*k*(4+a*(4-3*k));return{lat2:Math.atan2(d*ot+_*Ge*D,(1-a)*Math.sqrt(F*F+Et*Et)),lon2:t+(Math.atan2(Ge*S,_*ot-d*Ge*D)-(1-Kn)*a*F*(fe+Kn*Ge*(je+Kn*ot*(2*je*je-1))))}}(this.lat0,this.long0,G,Y,this.a,this.f),e.x=ne.lon2,e.y=ne.lat2,e))},names:["Azimuthal_Equidistant","aeqd"]},lse={init:function rse(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function ose(e){var t,n,i,r,h,d,_,D=e.y;return i=gt(e.x-this.long0),t=Math.sin(D),n=Math.cos(D),r=Math.cos(i),((h=this.sin_p14*t+this.cos_p14*n*r)>0||Math.abs(h)<=ct)&&(d=1*this.a*n*Math.sin(i),_=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*r)),e.x=d,e.y=_,e},inverse:function sse(e){var t,n,i,r,a,h,d;return e.x-=this.x0,e.y-=this.y0,n=Xd((t=Math.sqrt(e.x*e.x+e.y*e.y))/this.a),i=Math.sin(n),r=Math.cos(n),h=this.long0,Math.abs(t)<=ct?(d=this.lat0,e.x=h,e.y=d,e):(d=Xd(r*this.sin_p14+e.y*i*this.cos_p14/t),a=Math.abs(this.lat0)-Ke,Math.abs(a)<=ct?(h=gt(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)),e.x=h,e.y=d,e):(h=gt(this.long0+Math.atan2(e.x*i,t*this.cos_p14*r-e.y*this.sin_p14*i)),e.x=h,e.y=d,e))},names:["ortho"]};function Gw(e,t,n,i){var r;return e<ct?(i.value=1,r=0):(r=Math.atan2(t,n),Math.abs(r)<=ti?i.value=1:r>ti&&r<=Ke+ti?(i.value=2,r-=Ke):r>Ke+ti||r<=-(Ke+ti)?(i.value=3,r=r>=0?r-$r:r+$r):(i.value=4,r+=Ke)),r}function Em(e,t){var n=e+t;return n<-$r?n+=y0:n>+$r&&(n-=y0),n}const fse={init:function cse(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.face=this.lat0>=Ke-ti/2?5:this.lat0<=-(Ke-ti/2)?6:Math.abs(this.long0)<=ti?1:Math.abs(this.long0)<=Ke+ti?this.long0>0?2:4:3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function use(e){var n,i,r,a,h,d,t={x:0,y:0},_={value:0};if(e.x-=this.long0,n=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,i=e.x,5===this.face)a=Ke-n,i>=ti&&i<=Ke+ti?(_.value=1,r=i-Ke):i>Ke+ti||i<=-(Ke+ti)?(_.value=2,r=i>0?i-$r:i+$r):i>-(Ke+ti)&&i<=-ti?(_.value=3,r=i+Ke):(_.value=4,r=i);else if(6===this.face)a=Ke+n,i>=ti&&i<=Ke+ti?(_.value=1,r=-i+Ke):i<ti&&i>=-ti?(_.value=2,r=-i):i<-ti&&i>=-(Ke+ti)?(_.value=3,r=-i-Ke):(_.value=4,r=i>0?-i+$r:-i-$r);else{var S,D,A,F,k,G;2===this.face?i=Em(i,+Ke):3===this.face?i=Em(i,+$r):4===this.face&&(i=Em(i,-Ke)),F=Math.sin(n),k=Math.cos(n),G=Math.sin(i),S=k*Math.cos(i),D=k*G,A=F,1===this.face?r=Gw(a=Math.acos(S),A,D,_):2===this.face?r=Gw(a=Math.acos(D),A,-S,_):3===this.face?r=Gw(a=Math.acos(-S),A,-D,_):4===this.face?r=Gw(a=Math.acos(-D),A,S,_):(a=r=0,_.value=1)}return d=Math.atan(12/$r*(r+Math.acos(Math.sin(r)*Math.cos(ti))-Ke)),h=Math.sqrt((1-Math.cos(a))/(Math.cos(d)*Math.cos(d))/(1-Math.cos(Math.atan(1/Math.cos(r))))),2===_.value?d+=Ke:3===_.value?d+=$r:4===_.value&&(d+=1.5*$r),t.x=h*Math.cos(d),t.y=h*Math.sin(d),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,e.x=t.x,e.y=t.y,e},inverse:function hse(e){var n,i,r,a,h,d,_,S,D,Y,ne,fe,t={lam:0,phi:0},A={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,i=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),n=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?A.value=1:e.y>=0&&e.y>=Math.abs(e.x)?(A.value=2,n-=Ke):e.x<0&&-e.x>=Math.abs(e.y)?(A.value=3,n=n<0?n+$r:n-$r):(A.value=4,n+=Ke),D=$r/12*Math.tan(n),h=Math.sin(D)/(Math.cos(D)-1/Math.sqrt(2)),d=Math.atan(h),(_=1-(r=Math.cos(n))*r*(a=Math.tan(i))*a*(1-Math.cos(Math.atan(1/Math.cos(d)))))<-1?_=-1:_>1&&(_=1),5===this.face)S=Math.acos(_),t.phi=Ke-S,t.lam=1===A.value?d+Ke:2===A.value?d<0?d+$r:d-$r:3===A.value?d-Ke:d;else if(6===this.face)S=Math.acos(_),t.phi=S-Ke,t.lam=1===A.value?-d+Ke:2===A.value?-d:3===A.value?-d-Ke:d<0?-d-$r:-d+$r;else{var F,k,G;D=(F=_)*F,k=(D+=(G=D>=1?0:Math.sqrt(1-D)*Math.sin(d))*G)>=1?0:Math.sqrt(1-D),2===A.value?(D=k,k=-G,G=D):3===A.value?(k=-k,G=-G):4===A.value&&(D=k,k=G,G=-D),2===this.face?(D=F,F=-k,k=D):3===this.face?(F=-F,k=-k):4===this.face&&(D=F,F=k,k=-D),t.phi=Math.acos(-G)-Ke,t.lam=Math.atan2(k,F),2===this.face?t.lam=Em(t.lam,-Ke):3===this.face?t.lam=Em(t.lam,-$r):4===this.face&&(t.lam=Em(t.lam,+Ke))}return 0!==this.es&&(Y=t.phi<0?1:0,ne=Math.tan(t.phi),fe=this.b/Math.sqrt(ne*ne+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-fe*fe)/(this.one_minus_f*fe)),Y&&(t.phi=-t.phi)),t.lam+=this.long0,e.x=t.lam,e.y=t.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var nT=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],T0=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],e4=Hu/5,pse=1/e4,$w=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))};const wse={init:function _se(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function yse(e){var t=gt(e.x-this.long0),n=Math.abs(e.y),i=Math.floor(n*e4);i<0?i=0:i>=18&&(i=17);var r={x:$w(nT[i],n=Hu*(n-pse*i))*t,y:$w(T0[i],n)};return e.y<0&&(r.y=-r.y),r.x=r.x*this.a*.8487+this.x0,r.y=r.y*this.a*1.3523+this.y0,r},inverse:function vse(e){var t={x:(e.x-this.x0)/(.8487*this.a),y:Math.abs(e.y-this.y0)/(1.3523*this.a)};if(t.y>=1)t.x/=nT[18][0],t.y=e.y<0?-Ke:Ke;else{var n=Math.floor(18*t.y);for(n<0?n=0:n>=18&&(n=17);;)if(T0[n][0]>t.y)--n;else{if(!(T0[n+1][0]<=t.y))break;++n}var i=T0[n],r=5*(t.y-i[0])/(T0[n+1][0]-i[0]);r=function mse(e,t,n,i){for(var r=t;i;--i){var a=e(r);if(r-=a,Math.abs(a)<n)break}return r}(function(a){return($w(i,a)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(i,a)},r,ct,100),t.x/=$w(nT[n],r),t.y=(5*n+r)*is,e.y<0&&(t.y=-t.y)}return t.x=gt(t.x+this.long0),t},names:["Robinson","robin"]},Dse={init:function xse(){this.name="geocent"},forward:function Sse(e){return A3(e,this.es,this.a)},inverse:function Ese(e){return P3(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var I0={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const Pse={init:function Cse(){if(Object.keys(I0).forEach(function(n){if(typeof this[n]>"u")this[n]=I0[n].def;else{if(I0[n].num&&isNaN(this[n]))throw new Error("Invalid parameter value, must be numeric "+n+" = "+this[n]);I0[n].num&&(this[n]=parseFloat(this[n]))}I0[n].degrees&&(this[n]=this[n]*is)}.bind(this)),Math.abs(Math.abs(this.lat0)-Ke)<ct?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<ct?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function Tse(e){e.x-=this.long0;var r,a,h,d,t=Math.sin(e.y),n=Math.cos(e.y),i=Math.cos(e.x);switch(this.mode){case 3:a=this.sinph0*t+this.cosph0*n*i;break;case 2:a=n*i;break;case 1:a=-t;break;case 0:a=t}switch(r=(a=this.pn1/(this.p-a))*n*Math.sin(e.x),this.mode){case 3:a*=this.cosph0*t-this.sinph0*n*i;break;case 2:a*=t;break;case 0:a*=-n*i;break;case 1:a*=n*i}return r=(r*this.cg-a*this.sg)*this.cw*(d=1/((h=a*this.cg+r*this.sg)*this.sw*this.h1+this.cw)),a=h*d,e.x=r*this.a,e.y=a*this.a,e},inverse:function Ise(e){e.x/=this.a,e.y/=this.a;var n,i,r,t={x:e.x,y:e.y};e.x=(n=this.pn1*e.x*(r=1/(this.pn1-e.y*this.sw)))*this.cg+(i=this.pn1*e.y*this.cw*r)*this.sg,e.y=i*this.cg-n*this.sg;var a=Ma(e.x,e.y);if(Math.abs(a)<ct)t.x=0,t.y=e.y;else{var h,d;switch(d=1-a*a*this.pfact,d=(this.p-Math.sqrt(d))/(this.pn1/a+a/this.pn1),h=Math.sqrt(1-d*d),this.mode){case 3:t.y=Math.asin(h*this.sinph0+e.y*d*this.cosph0/a),e.y=(h-this.sinph0*Math.sin(t.y))*a,e.x*=d*this.cosph0;break;case 2:t.y=Math.asin(e.y*d/a),e.y=h*a,e.x*=d;break;case 0:t.y=Math.asin(h),e.y=-e.y;break;case 1:t.y=-Math.asin(h)}t.x=Math.atan2(e.x,e.y)}return e.x=t.x+this.long0,e.y=t.y,e},names:["Tilted_Perspective","tpers"]},Fse={init:function Rse(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function Nse(e){var i,r,a,h,t=e.x,n=e.y;if(t-=this.long0,"ellipse"===this.shape){n=Math.atan(this.radius_p2*Math.tan(n));var d=this.radius_p/Ma(this.radius_p*Math.cos(n),Math.sin(n));if(r=d*Math.cos(t)*Math.cos(n),a=d*Math.sin(t)*Math.cos(n),h=d*Math.sin(n),(this.radius_g-r)*r-a*a-h*h*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(a/Ma(h,i)),e.y=this.radius_g_1*Math.atan(h/i)):(e.x=this.radius_g_1*Math.atan(a/i),e.y=this.radius_g_1*Math.atan(h/Ma(a,i)))}else"sphere"===this.shape&&(i=Math.cos(n),r=Math.cos(t)*i,a=Math.sin(t)*i,h=Math.sin(n),i=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(a/Ma(h,i)),e.y=this.radius_g_1*Math.atan(h/i)):(e.x=this.radius_g_1*Math.atan(a/i),e.y=this.radius_g_1*Math.atan(h/Ma(a,i))));return e.x=e.x*this.a,e.y=e.y*this.a,e},inverse:function kse(e){var r,a,h,d,t=-1,n=0,i=0;if(e.x=e.x/this.a,e.y=e.y/this.a,"ellipse"===this.shape){this.flip_axis?(i=Math.tan(e.y/this.radius_g_1),n=Math.tan(e.x/this.radius_g_1)*Ma(1,i)):(n=Math.tan(e.x/this.radius_g_1),i=Math.tan(e.y/this.radius_g_1)*Ma(1,n));var _=i/this.radius_p;if((h=(a=2*this.radius_g*t)*a-4*(r=n*n+_*_+t*t)*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;d=(-a-Math.sqrt(h))/(2*r),t=this.radius_g+d*t,n*=d,i*=d,e.x=Math.atan2(n,t),e.y=Math.atan(i*Math.cos(e.x)/t),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if("sphere"===this.shape){if(this.flip_axis?(i=Math.tan(e.y/this.radius_g_1),n=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+i*i)):(n=Math.tan(e.x/this.radius_g_1),i=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+n*n)),(h=(a=2*this.radius_g*t)*a-4*(r=n*n+i*i+t*t)*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;d=(-a-Math.sqrt(h))/(2*r),t=this.radius_g+d*t,n*=d,i*=d,e.x=Math.atan2(n,t),e.y=Math.atan(i*Math.cos(e.x)/t)}return e.x=e.x+this.long0,e},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var A0=1.340264,P0=-.081106,R0=893e-6,N0=.003796,Hw=Math.sqrt(3)/2;const Vse={init:function Lse(){this.es=0,this.long0=void 0!==this.long0?this.long0:0},forward:function Bse(e){var t=gt(e.x-this.long0),i=Math.asin(Hw*Math.sin(e.y)),r=i*i,a=r*r*r;return e.x=t*Math.cos(i)/(Hw*(A0+3*P0*r+a*(7*R0+9*N0*r))),e.y=i*(A0+P0*r+a*(R0+N0*r)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function zse(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var r,a,_,S,i=e.y;for(S=0;S<12&&(i-=_=(i*(A0+P0*(r=i*i)+(a=r*r*r)*(R0+N0*r))-e.y)/(A0+3*P0*r+a*(7*R0+9*N0*r)),!(Math.abs(_)<1e-9));++S);return e.x=Hw*e.x*(A0+3*P0*(r=i*i)+(a=r*r*r)*(7*R0+9*N0*r))/Math.cos(i),e.y=Math.asin(Math.sin(i)/Hw),e.x=gt(e.x+this.long0),e},names:["eqearth","Equal Earth","Equal_Earth"]};var k0=1e-10;function Gse(e){var i,r,a,t=gt(e.x-(this.long0||0)),n=e.y;return i=this.am1+this.m1-xm(n,r=Math.sin(n),a=Math.cos(n),this.en),r=a*t/(i*Math.sqrt(1-this.es*r*r)),e.x=i*Math.sin(r),e.y=this.am1-i*Math.cos(r),e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function $se(e){var t,n,i,r;if(e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a,n=Ma(e.x,e.y=this.am1-e.y),r=WC(this.am1+this.m1-n,this.es,this.en),(t=Math.abs(r))<Ke)t=Math.sin(r),i=n*Math.atan2(e.x,e.y)*Math.sqrt(1-this.es*t*t)/Math.cos(r);else{if(!(Math.abs(t-Ke)<=k0))throw new Error;i=0}return e.x=gt(i+(this.long0||0)),e.y=Kd(r),e}function Hse(e){var i,r,t=gt(e.x-(this.long0||0)),n=e.y;return r=this.cphi1+this.phi1-n,Math.abs(r)>k0?(e.x=r*Math.sin(i=t*Math.cos(n)/r),e.y=this.cphi1-r*Math.cos(i)):e.x=e.y=0,e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function qse(e){e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var t,n,i=Ma(e.x,e.y=this.cphi1-e.y);if(n=this.cphi1+this.phi1-i,Math.abs(n)>Ke)throw new Error;return t=Math.abs(Math.abs(n)-Ke)<=k0?0:i*Math.atan2(e.x,e.y)/Math.cos(n),e.x=gt(t+(this.long0||0)),e.y=Kd(n),e}const Zse={init:function Use(){var e;if(this.phi1=this.lat1,Math.abs(this.phi1)<k0)throw new Error;this.es?(this.en=qC(this.es),this.m1=xm(this.phi1,this.am1=Math.sin(this.phi1),e=Math.cos(this.phi1),this.en),this.am1=e/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=$se,this.forward=Gse):(this.cphi1=Math.abs(this.phi1)+k0>=Ke?0:1/Math.tan(this.phi1),this.inverse=qse,this.forward=Hse)},names:["bonne","Bonne (Werner lat_1=90)"]},t4=Object.assign(function aie(e,t,n){var i,r,h,a=!1;return typeof t>"u"?(r=Bw(e),i=L3,a=!0):(typeof t.x<"u"||Array.isArray(t))&&(n=t,r=Bw(e),i=L3,a=!0),i||(i=Bw(e)),r||(r=Bw(t)),n?GC(i,r,n):(h={forward:function(d,_){return GC(i,r,d,_)},inverse:function(d,_){return GC(r,i,d,_)}},a&&(h.oProj=r),h)},{defaultDatum:"WGS84",Proj:vm,WGS84:new vm("WGS84"),Point:vie,toPoint:O3,defs:kw,nadgrid:function Gne(e,t,n){return t instanceof ArrayBuffer?function $ne(e,t,n){var i=!0;void 0!==n&&!1===n.includeErrorFields&&(i=!1);var r=new DataView(t),a=function Zne(e){var t=e.getInt32(8,!1);return 11!==t&&(11!==(t=e.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(r),h=function Kne(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:UC(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}(r,a),d=function Yne(e,t,n,i){for(var r=176,a=[],h=0;h<t.nSubgrids;h++){var d=Qne(e,r,n),_=Jne(e,r,d,n,i),S=Math.round(1+(d.upperLongitude-d.lowerLongitude)/d.longitudeInterval),D=Math.round(1+(d.upperLatitude-d.lowerLatitude)/d.latitudeInterval);a.push({ll:[Zd(d.lowerLongitude),Zd(d.lowerLatitude)],del:[Zd(d.longitudeInterval),Zd(d.latitudeInterval)],lim:[S,D],count:d.gridNodeCount,cvs:Xne(_)});var A=16;!1===i&&(A=8),r+=176+d.gridNodeCount*A}return a}(r,h,a,i),_={header:h,subgrids:d};return jC[e]=_,_}(e,t,n):{ready:Hne(e,t)}},transform:Lw,mgrs:cie,version:"__VERSION__"});!function Kse(e){e.Proj.projections.add(zw),e.Proj.projections.add(jw),e.Proj.projections.add(qie),e.Proj.projections.add(nre),e.Proj.projections.add(are),e.Proj.projections.add(dre),e.Proj.projections.add(yre),e.Proj.projections.add(Sre),e.Proj.projections.add(Tre),e.Proj.projections.add(Nre),e.Proj.projections.add(qre),e.Proj.projections.add(Qre),e.Proj.projections.add(ioe),e.Proj.projections.add(coe),e.Proj.projections.add(poe),e.Proj.projections.add(voe),e.Proj.projections.add(Eoe),e.Proj.projections.add(Ioe),e.Proj.projections.add(Ooe),e.Proj.projections.add(joe),e.Proj.projections.add(Hoe),e.Proj.projections.add(Yoe),e.Proj.projections.add(ise),e.Proj.projections.add(lse),e.Proj.projections.add(fse),e.Proj.projections.add(wse),e.Proj.projections.add(Dse),e.Proj.projections.add(Pse),e.Proj.projections.add(Fse),e.Proj.projections.add(Vse),e.Proj.projections.add(Zse)}(t4);const O0=t4;let Yse=(()=>{class e{STANDARD_CRS="EPSG:3857";constructor(){O0.defs("EPSG:4326","+proj=longlat +datum=WGS84 +no_defs"),O0.defs("EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"),O0.defs("EPSG:22175","+proj=tmerc +lat_0=0 +lon_0=-57 +k=1 +x_0=5500000 +y_0=0 +ellps=GRS80 +units=m +no_defs")}KNOWN_CRS={"EPSG:3857":{epsg:"EPSG:3857",name:"Web Mercator",isWebMercator:!0},"EPSG:4326":{epsg:"EPSG:4326",name:"WGS84 Geographic",isWebMercator:!1},"EPSG:22183":{epsg:"EPSG:22183",name:"POSGAR 98 / Argentina 3",isWebMercator:!1},"EPSG:5343":{epsg:"EPSG:5343",name:"POSGAR 2007 / Argentina 3",isWebMercator:!1}};getStandardCRS(){return this.STANDARD_CRS}isWebMercatorCompatible(n){if(!n)return!0;const i=this.KNOWN_CRS[n.toUpperCase()];return!!i&&i.isWebMercator}getCRSInfo(n){return n?this.KNOWN_CRS[n.toUpperCase()]||null:this.KNOWN_CRS[this.STANDARD_CRS]}extractFirstCoordinate(n){if(!n||!n.coordinates)return null;switch(n.type){case"Point":return n.coordinates;case"LineString":case"MultiPoint":return n.coordinates[0];case"Polygon":case"MultiLineString":return n.coordinates[0][0];case"MultiPolygon":return n.coordinates[0][0][0];default:return null}}detectCRSFromCoordinates(n,i){return Math.abs(n)>180&&Math.abs(i)>90?"EPSG:3857":n>=-75&&n<=-53&&i>=-55&&i<=-21?"EPSG:4326":n>1e6&&n<8e6&&i>1e6&&i<8e6?"EPSG:22183":"EPSG:4326"}transformGeoJSON(n,i){var r=this;return wu(function*(a,h,d="EPSG:4326"){if(h?.toUpperCase()===d?.toUpperCase())return(yield fetch(a)).json();try{const S=yield(yield fetch(a)).json();try{const D=r.extractFirstCoordinate(S.features?.[0]?.geometry);D&&O0(h,d,D)}catch{}return r.transformGeoJSONCoordinates(S,h,d)}catch(_){throw console.error(`Error transformando GeoJSON de ${h} a ${d}:`,_),_}}).apply(this,arguments)}transformGeoJSONCoordinates(n,i,r){const a=JSON.parse(JSON.stringify(n));return a.features&&a.features.forEach(h=>{h.geometry&&this.transformGeometry(h.geometry,i,r)}),a.crs&&("EPSG:4326"===r?delete a.crs:a.crs={type:"name",properties:{name:`urn:ogc:def:crs:${r}`}}),a}transformGeometry(n,i,r){if(n.coordinates)switch(n.type){case"Point":n.coordinates=this.transformCoordinate(n.coordinates,i,r);break;case"LineString":case"MultiPoint":n.coordinates=n.coordinates.map(a=>this.transformCoordinate(a,i,r));break;case"Polygon":case"MultiLineString":n.coordinates=n.coordinates.map(a=>a.map(h=>this.transformCoordinate(h,i,r)));break;case"MultiPolygon":n.coordinates=n.coordinates.map(a=>a.map(h=>h.map(d=>this.transformCoordinate(d,i,r))))}}transformCoordinate(n,i,r){try{let a=n;return"EPSG:22175"===i&&(a=[-Math.abs(n[0]),-Math.abs(n[1])]),O0(i,r,a)}catch(a){return console.warn(`Error transformando coordenada de ${i} a ${r}:`,a),n}}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Xse=(()=>{class e{coordinateSystemService;constructor(n){this.coordinateSystemService=n}getAvailableLayers(){return this.layerMetadata.filter(n=>n.enabled)}getDefaultLayer(){return this.layerMetadata[0].id}getSources(){return{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},esriWorldImagery:{type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Tiles \xa9 Esri \u2014 Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},googleSatellite:{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"],tileSize:256,maxzoom:21,attribution:"\xa9 Google Maps"},argenMap:{type:"raster",tiles:["https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/{z}/{x}/{y}.png"],tileSize:256,maxzoom:21,attribution:"\xa9 IGN Argentina",scheme:"tms"},googleMaps:{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}"],tileSize:256,maxzoom:21,attribution:"\xa9 Google Maps"},googleHybrid:{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}"],tileSize:256,maxzoom:21,attribution:"\xa9 Google Maps"},esriTransportation:{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"\xa9 Esri"},comisarias:{type:"geojson",data:"assets/json/comisarias.geojson"},escuelas:{type:"geojson",data:"assets/json/escuelas.geojson"},partidos:{type:"geojson",data:"assets/json/partidos.geojson"},hidro:{type:"geojson",data:"assets/json/hidro.geojson"},localidades:{type:"geojson",data:"assets/json/localidades.geojson"},provincias:{type:"geojson",data:"assets/json/provincias.geojson"},rutas:{type:"geojson",data:"assets/json/rutas.geojson"}}}getLayers(){return[{id:"osm-tiles",type:"raster",source:"osm"},{id:"esri-satellite-tiles",type:"raster",source:"esriWorldImagery",layout:{visibility:"none"}},{id:"google-satellite-tiles",type:"raster",source:"googleSatellite",layout:{visibility:"none"}},{id:"argenmap-tiles",type:"raster",source:"argenMap",layout:{visibility:"none"}},{id:"google-maps-tiles",type:"raster",source:"googleMaps",layout:{visibility:"none"}},{id:"google-hybrid-tiles",type:"raster",source:"googleHybrid",layout:{visibility:"none"}},{id:"esri-transportation-tiles",type:"raster",source:"esriTransportation",layout:{visibility:"none"}},{id:"comisarias",type:"circle",source:"comisarias",layout:{visibility:"none"},paint:{"circle-radius":6,"circle-color":"#00b300","circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"escuelas",type:"circle",source:"escuelas",layout:{visibility:"none"},paint:{"circle-radius":6,"circle-color":"#b37400ff","circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"partidos",type:"fill",source:"partidos",layout:{visibility:"none"},paint:{"fill-color":"#3388ff","fill-opacity":.3,"fill-outline-color":"#2255aa"}},{id:"hidro",type:"line",source:"hidro",layout:{visibility:"none"},paint:{"line-color":"#0000ff","line-width":2}},{id:"localidades",type:"circle",source:"localidades",layout:{visibility:"none"},paint:{"circle-radius":6,"circle-color":"rgba(44, 187, 0, 1)"}},{id:"provincias",type:"fill",source:"provincias",layout:{visibility:"none"},paint:{"fill-color":"#3388ff","fill-opacity":.3,"fill-outline-color":"#aa2276ff"}},{id:"rutas",type:"line",source:"rutas",layout:{visibility:"none"},paint:{"line-color":"#ff0000","line-width":2}}]}layerMetadata=[{id:"osm-tiles",sourceId:"osm",displayName:"OpenStreetMap",enabled:!0},{id:"esri-satellite-tiles",sourceId:"esriWorldImagery",displayName:"Sat\xe9lite (Esri)",enabled:!0},{id:"argenmap-tiles",sourceId:"argenMap",displayName:"ArgenMap (IGN)",enabled:!0},{id:"google-maps-tiles",sourceId:"googleMaps",displayName:"Google Maps",enabled:!0},{id:"google-hybrid-tiles",sourceId:"googleHybrid",displayName:"Google H\xedbrido",enabled:!0},{id:"google-satellite-tiles",sourceId:"googleSatellite",displayName:"Google Sat\xe9lite",enabled:!0},{id:"esri-transportation-tiles",sourceId:"esriTransportation",displayName:"Esri Transporte",enabled:!0}];overlayMetadata=[{id:"comisarias",sourceId:"comisarias",displayName:"Comisar\xedas",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"escuelas",sourceId:"escuelas",displayName:"Escuelas",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"partidos",sourceId:"partidos",displayName:"Partidos",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"hidro",sourceId:"hidro",displayName:"Hidrograf\xeda",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"localidades",sourceId:"localidades",displayName:"Localidades",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"provincias",sourceId:"provincias",displayName:"Provincias",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"rutas",sourceId:"rutas",displayName:"Rutas",enabled:!0,visible:!1,crs:"EPSG:4326"}];getAvailableOverlays(){return this.overlayMetadata.filter(n=>n.enabled)}getMapStyle(){return{version:8,sources:this.getSources(),layers:this.getLayers()}}static \u0275fac=function(i){return new(i||e)(Ft(Yse))};static \u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Qse=["mapContainer"];function Jse(e,t){if(1&e){const n=Nl();bn(0,"button",11),Zn("click",function(){const r=Zi(n).$implicit;return zr(Jt().switchToLayer(r.id))}),ws(1),xn()}if(2&e){const n=t.$implicit;jt(),tp(" ",n.displayName," ")}}function eae(e,t){if(1&e){const n=Nl();bn(0,"button",11),Zn("click",function(){const r=Zi(n).$implicit;return zr(Jt().toggleOverlay(r.id,!r.visible))}),ws(1),xn()}if(2&e){const n=t.$implicit;jt(),tp(" ",n.displayName," ")}}let tae=(()=>{class e{layersService;mapContainer;map;currentLayerId="";availableLayers=[];availableOverlays=[];constructor(n){this.layersService=n}ngOnInit(){this.availableLayers=this.layersService.getAvailableLayers(),this.availableOverlays=this.layersService.getAvailableOverlays(),this.currentLayerId=this.layersService.getDefaultLayer(),this.initializeMap()}initializeMap(){var n=this;return wu(function*(){const i=n.layersService.getMapStyle();n.map=new Bb.Map({container:n.mapContainer.nativeElement,style:i,center:[-58.3816,-34.6037],zoom:5,attributionControl:!1}),n.map.addControl(new Bb.NavigationControl({visualizePitch:!0}),"top-right"),n.map.addControl(new Bb.AttributionControl,"bottom-left"),n.map.on("click",r=>{const a=n.availableOverlays.filter(D=>"visible"===n.map.getLayoutProperty(D.id,"visibility")).map(D=>D.id);if(0===a.length)return;const h=n.map.queryRenderedFeatures(r.point,{layers:a});if(!h.length)return;const _=h[0].properties;let S="<table>";for(const D in _)S+=`<tr><th style="text-align:left; padding-right:8px;">${D}</th><td>${_[D]}</td></tr>`;S+="</table>",(new Bb.Popup).setLngLat(r.lngLat).setHTML(S).addTo(n.map)})})()}switchToLayer(n){this.map&&(this.availableLayers.forEach(i=>{this.map.setLayoutProperty(i.id,"visibility","none")}),this.map.setLayoutProperty(n,"visibility","visible"),this.currentLayerId=n)}toggleOverlay(n,i){if(!this.map)return;this.map.setLayoutProperty(n,"visibility",i?"visible":"none");const r=this.availableOverlays.find(a=>a.id===n);r&&(r.visible=i)}ngOnDestroy(){this.map?.remove()}static \u0275fac=function(i){return new(i||e)(et(Xse))};static \u0275cmp=pa({type:e,selectors:[["app-mapa"]],viewQuery:function(i,r){if(1&i&&Ah(Qse,7),2&i){let a;Pi(a=Ri())&&(r.mapContainer=a.first)}},decls:17,vars:2,consts:[["mapContainer",""],[1,"mapa-overlay-layout"],[1,"map-container"],[1,"menu-overlay"],[1,"btn-group","me-3"],["ngbDropdown","","role","group","aria-label","Button group with nested dropdown",1,"btn-group"],["type","button","ngbDropdownToggle","",1,"btn","btn-secondary","btn-sm"],[1,"bi","bi-map",2,"font-size","1.1em","margin-right","6px"],["ngbDropdownMenu","",1,"dropdown-menu"],["ngbDropdownItem","",3,"click",4,"ngFor","ngForOf"],[1,"bi","bi-layers",2,"font-size","1.1em","margin-right","6px"],["ngbDropdownItem","",3,"click"]],template:function(i,r){1&i&&(bn(0,"div",1),tl(1,"div",2,0),bn(3,"div",3)(4,"div",4)(5,"div",5)(6,"button",6),tl(7,"i",7),ws(8," Capas base "),xn(),bn(9,"div",8),Ko(10,Jse,2,1,"button",9),xn()(),bn(11,"div",5)(12,"button",6),tl(13,"i",10),ws(14," Capas superpuestas "),xn(),bn(15,"div",8),Ko(16,eae,2,1,"button",9),xn()()()()()),2&i&&(jt(10),xr("ngForOf",r.availableLayers),jt(6),xr("ngForOf",r.availableOverlays))},dependencies:[MY,ZO,e3,Tw,JL,AC,Dw,QL],styles:["[_nghost-%COMP%]   .mapa-overlay-layout[_ngcontent-%COMP%]{position:relative;width:100vw;height:100vh}.menu-overlay[_ngcontent-%COMP%]{position:absolute;top:25px;left:10px;z-index:1000}[_nghost-%COMP%]{display:block;width:100%;height:100vh}.map-container[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .maplibregl-popup-content{background:#23272f;color:#fff;border-radius:10px;font-size:1.1em;box-shadow:0 2px 12px #00000040;padding:16px 20px;max-width:740px;min-width:420px;overflow-x:auto;word-break:break-word}[_nghost-%COMP%]     .maplibregl-popup-tip{border-top-color:#23272f!important}[_nghost-%COMP%]     .maplibregl-popup-content table{width:100%;border-collapse:collapse}[_nghost-%COMP%]     .maplibregl-popup-content th, [_nghost-%COMP%]     .maplibregl-popup-content td{padding:4px 8px;border-bottom:1px solid #444}[_nghost-%COMP%]     .maplibregl-popup-content th{font-weight:700;color:#90caf9;background:transparent}[_nghost-%COMP%]     .maplibregl-popup-content tr:last-child td{border-bottom:none}"]})}return e})();(function i7(e,t){return FG({rootComponent:e,...bN(t)})})((()=>{class e{title="mapLibre";static \u0275fac=function(i){return new(i||e)};static \u0275cmp=pa({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(i,r){1&i&&tl(0,"app-mapa")},dependencies:[tae],encapsulation:2})}return e})(),UZ).catch(e=>console.error(e))},797:()=>{"use strict";const Mt=function(nt,...yt){if(Mt.translate){const tn=Mt.translate(nt,yt);nt=tn[0],yt=tn[1]}let ht=Oi(nt[0],nt.raw[0]);for(let tn=1;tn<nt.length;tn++)ht+=yt[tn-1]+Oi(nt[tn],nt.raw[tn]);return ht},gi=":";function Oi(nt,yt){return yt.charAt(0)===gi?nt.substring(function zn(nt,yt){for(let ht=1,tn=1;ht<nt.length;ht++,tn++)if("\\"===yt[tn])tn++;else if(":"===nt[ht])return ht;throw new Error(`Unterminated $localize metadata block in "${yt}".`)}(nt,yt)+1):nt}globalThis.$localize=Mt}},Tp=>{var zc=jc=>Tp(Tp.s=jc);zc(797),zc(720)}]);