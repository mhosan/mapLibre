var CP=Object.create;var My=Object.defineProperty,PP=Object.defineProperties,DP=Object.getOwnPropertyDescriptor,AP=Object.getOwnPropertyDescriptors,RP=Object.getOwnPropertyNames,J1=Object.getOwnPropertySymbols,kP=Object.getPrototypeOf,tw=Object.prototype.hasOwnProperty,NP=Object.prototype.propertyIsEnumerable;var ew=(t,r,i)=>r in t?My(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,Je=(t,r)=>{for(var i in r||={})tw.call(r,i)&&ew(t,i,r[i]);if(J1)for(var i of J1(r))NP.call(r,i)&&ew(t,i,r[i]);return t},un=(t,r)=>PP(t,AP(r));var LP=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var OP=(t,r,i,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let h of RP(r))!tw.call(t,h)&&h!==i&&My(t,h,{get:()=>r[h],enumerable:!(c=DP(r,h))||c.enumerable});return t};var FP=(t,r,i)=>(i=t!=null?CP(kP(t)):{},OP(r||!t||!t.__esModule?My(i,"default",{value:t,enumerable:!0}):i,t));var VI=LP((qx,Zx)=>{"use strict";(function(t,r){typeof qx=="object"&&typeof Zx<"u"?Zx.exports=r():typeof define=="function"&&define.amd?define(r):(t=typeof globalThis<"u"?globalThis:t||self,t.maplibregl=r())})(qx,function(){"use strict";var t={},r={};function i(h,s,v){if(r[h]=v,h==="index"){var w="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",I={};return r.shared(I),r.index(t,I),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([w],{type:"text/javascript"}))),t}}i("shared",["exports"],function(h){"use strict";function s(a,n,o,u){return new(o||(o=Promise))(function(f,_){function y(T){try{M(u.next(T))}catch(P){_(P)}}function b(T){try{M(u.throw(T))}catch(P){_(P)}}function M(T){var P;T.done?f(T.value):(P=T.value,P instanceof o?P:new o(function(A){A(P)})).then(y,b)}M((u=u.apply(a,n||[])).next())})}function v(a,n){this.x=a,this.y=n}function w(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var I,N;typeof SuppressedError=="function"&&SuppressedError,v.prototype={clone(){return new v(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,n){return this.clone()._rotateAround(a,n)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){let n=a.x-this.x,o=a.y-this.y;return n*n+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,n){return Math.atan2(this.x*n-this.y*a,this.x*a+this.y*n)},_matMult(a){let n=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=n,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){let a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){let n=Math.cos(a),o=Math.sin(a),u=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=u,this},_rotateAround(a,n){let o=Math.cos(a),u=Math.sin(a),f=n.y+u*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-u*(this.y-n.y),this.y=f,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:v},v.convert=function(a){if(a instanceof v)return a;if(Array.isArray(a))return new v(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new v(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var B=function(){if(N)return I;function a(n,o,u,f){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=u,this.p2y=f}return N=1,I=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,o){if(o===void 0&&(o=1e-6),n<0)return 0;if(n>1)return 1;for(var u=n,f=0;f<8;f++){var _=this.sampleCurveX(u)-n;if(Math.abs(_)<o)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=_/y}var b=0,M=1;for(u=n,f=0;f<20&&(_=this.sampleCurveX(u),!(Math.abs(_-n)<o));f++)n>_?b=u:M=u,u=.5*(M-b)+b;return u},solve:function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))}},I}(),L=w(B);let ie,H;function me(){return ie==null&&(ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ie}function Ee(){if(H==null&&(H=!1,me())){let n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let u=0;u<5*5;u++){let f=4*u;n.fillStyle=`rgb(${f},${f+1},${f+2})`,n.fillRect(u%5,Math.floor(u/5),1,1)}let o=n.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&o[u]!==u){H=!0;break}}}return H||!1}var Me=1e-6,Ae=typeof Float32Array<"u"?Float32Array:Array;function We(){var a=new Ae(9);return Ae!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function it(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function _t(){var a=new Ae(3);return Ae!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Ct(a){return Math.hypot(a[0],a[1],a[2])}function Nt(a,n,o){var u=new Ae(3);return u[0]=a,u[1]=n,u[2]=o,u}function Gt(a,n,o){return a[0]=n[0]+o[0],a[1]=n[1]+o[1],a[2]=n[2]+o[2],a}function Xt(a,n,o){return a[0]=n[0]*o,a[1]=n[1]*o,a[2]=n[2]*o,a}function tn(a,n,o){var u=n[0],f=n[1],_=n[2],y=o[0],b=o[1],M=o[2];return a[0]=f*M-_*b,a[1]=_*y-u*M,a[2]=u*b-f*y,a}Math.hypot||(Math.hypot=function(){for(var a=0,n=arguments.length;n--;)a+=arguments[n]*arguments[n];return Math.sqrt(a)});var kn,xn=Ct;function Wr(a,n,o){var u=n[0],f=n[1],_=n[2],y=n[3];return a[0]=o[0]*u+o[4]*f+o[8]*_+o[12]*y,a[1]=o[1]*u+o[5]*f+o[9]*_+o[13]*y,a[2]=o[2]*u+o[6]*f+o[10]*_+o[14]*y,a[3]=o[3]*u+o[7]*f+o[11]*_+o[15]*y,a}function Ir(){var a=new Ae(4);return Ae!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function xo(a,n,o,u){var f=.5*Math.PI/180;n*=f,o*=f,u*=f;var _=Math.sin(n),y=Math.cos(n),b=Math.sin(o),M=Math.cos(o),T=Math.sin(u),P=Math.cos(u);return a[0]=_*M*P-y*b*T,a[1]=y*b*P+_*M*T,a[2]=y*M*T-_*b*P,a[3]=y*M*P+_*b*T,a}function Qo(){var a=new Ae(2);return Ae!=Float32Array&&(a[0]=0,a[1]=0),a}function tc(a,n){var o=new Ae(2);return o[0]=a,o[1]=n,o}_t(),kn=new Ae(4),Ae!=Float32Array&&(kn[0]=0,kn[1]=0,kn[2]=0,kn[3]=0),_t(),Nt(1,0,0),Nt(0,1,0),Ir(),Ir(),We(),Qo();let Ht=8192;function Jo(a,n,o){return n*(Ht/(a.tileSize*Math.pow(2,o-a.tileID.overscaledZ)))}function or(a,n){return(a%n+n)%n}function es(a,n,o){return a*(1-o)+n*o}function ki(a){if(a<=0)return 0;if(a>=1)return 1;let n=a*a,o=n*a;return 4*(a<.5?o:3*(a-n)+o-.75)}function bo(a,n,o,u){let f=new L(a,n,o,u);return _=>f.solve(_)}let ts=bo(.25,.1,.25,1);function Tr(a,n,o){return Math.min(o,Math.max(n,a))}function Xs(a,n,o){let u=o-n,f=((a-n)%u+u)%u+n;return f===n?o:f}function Xr(a,...n){for(let o of n)for(let u in o)a[u]=o[u];return a}let ui=1;function Ys(a,n,o){let u={};for(let f in a)u[f]=n.call(this,a[f],f,a);return u}function Ks(a,n,o){let u={};for(let f in a)n.call(this,a[f],f,a)&&(u[f]=a[f]);return u}function Fr(a){return Array.isArray(a)?a.map(Fr):typeof a=="object"&&a?Ys(a,Fr):a}let gn={};function bn(a){gn[a]||(typeof console<"u"&&console.warn(a),gn[a]=!0)}function hi(a,n,o){return(o.y-a.y)*(n.x-a.x)>(n.y-a.y)*(o.x-a.x)}function Ni(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let ns=null;function Li(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}let Oi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Qs(a,n,o,u,f){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let _=new VideoFrame(a,{timestamp:0});try{let y=_?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);let b=y.startsWith("BGR"),M=new Uint8ClampedArray(u*f*4);if(yield _.copyTo(M,function(T,P,A,O,z){let j=4*Math.max(-P,0),G=(Math.max(0,A)-A)*O*4+j,Z=4*O,K=Math.max(0,P),ce=Math.max(0,A);return{rect:{x:K,y:ce,width:Math.min(T.width,P+O)-K,height:Math.min(T.height,A+z)-ce},layout:[{offset:G,stride:Z}]}}(a,n,o,u,f)),b)for(let T=0;T<M.length;T+=4){let P=M[T];M[T]=M[T+2],M[T+2]=P}return M}finally{_.close()}})}let wo,Mo;function So(a,n,o,u){return a.addEventListener(n,o,u),{unsubscribe:()=>{a.removeEventListener(n,o,u)}}}function rs(a){return a*Math.PI/180}function Eo(a){return a/Math.PI*180}let Io={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},To={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Js="AbortError";function ue(){return new Error(Js)}let V={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function $(a){return V.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}let q="global-dispatcher";class te extends Error{constructor(n,o,u,f){super(`AJAXError: ${o} (${n}): ${u}`),this.status=n,this.statusText=o,this.url=u,this.body=f}}let le=()=>Ni(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,he=function(a,n){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){let u=$(a.url);if(u)return u(a,n);if(Ni(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:q},n)}if(!(/^file:/.test(o=a.url)||/^file:/.test(le())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(u,f){return s(this,void 0,void 0,function*(){let _=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:le(),signal:f.signal}),y,b;u.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{y=yield fetch(_)}catch(T){throw new te(0,T.message,u.url,new Blob)}if(!y.ok){let T=yield y.blob();throw new te(y.status,y.statusText,u.url,T)}b=u.type==="arrayBuffer"||u.type==="image"?y.arrayBuffer():u.type==="json"?y.json():y.text();let M=yield b;if(f.signal.aborted)throw ue();return{data:M,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(a,n);if(Ni(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:q},n)}var o;return function(u,f){return new Promise((_,y)=>{var b;let M=new XMLHttpRequest;M.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(M.responseType="arraybuffer");for(let T in u.headers)M.setRequestHeader(T,u.headers[T]);u.type==="json"&&(M.responseType="text",!((b=u.headers)===null||b===void 0)&&b.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=u.credentials==="include",M.onerror=()=>{y(new Error(M.statusText))},M.onload=()=>{if(!f.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let T=M.response;if(u.type==="json")try{T=JSON.parse(M.response)}catch(P){return void y(P)}_({data:T,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{let T=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});y(new te(M.status,M.statusText,u.url,T))}},f.signal.addEventListener("abort",()=>{M.abort(),y(ue())}),M.send(u.body)})}(a,n)};function ve(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;let n=new URL(a),o=window.location;return n.protocol===o.protocol&&n.host===o.host}function fe(a,n,o){o[a]&&o[a].indexOf(n)!==-1||(o[a]=o[a]||[],o[a].push(n))}function Se(a,n,o){if(o&&o[a]){let u=o[a].indexOf(n);u!==-1&&o[a].splice(u,1)}}class Re{constructor(n,o={}){Xr(this,o),this.type=n}}class Te extends Re{constructor(n,o={}){super("error",Xr({error:n},o))}}class Xe{on(n,o){return this._listeners=this._listeners||{},fe(n,o,this._listeners),{unsubscribe:()=>{this.off(n,o)}}}off(n,o){return Se(n,o,this._listeners),Se(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},fe(n,o,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,o){typeof n=="string"&&(n=new Re(n,o||{}));let u=n.type;if(this.listens(u)){n.target=this;let f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(let b of f)b.call(this,n);let _=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(let b of _)Se(u,b,this._oneTimeListeners),b.call(this,n);let y=this._eventedParent;y&&(Xr(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(n))}else n instanceof Te&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let st=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yt(a,n){let o={};for(let u in a)u!=="ref"&&(o[u]=a[u]);return st.forEach(u=>{u in n&&(o[u]=n[u])}),o}function Qe(a,n){if(Array.isArray(a)){if(!Array.isArray(n)||a.length!==n.length)return!1;for(let o=0;o<a.length;o++)if(!Qe(a[o],n[o]))return!1;return!0}if(typeof a=="object"&&a!==null&&n!==null){if(typeof n!="object"||Object.keys(a).length!==Object.keys(n).length)return!1;for(let o in a)if(!Qe(a[o],n[o]))return!1;return!0}return a===n}function ut(a,n){a.push(n)}function nn(a,n,o){ut(o,{command:"addSource",args:[a,n[a]]})}function Nn(a,n,o){ut(n,{command:"removeSource",args:[a]}),o[a]=!0}function Ln(a,n,o,u){Nn(a,o,u),nn(a,n,o)}function wn(a,n,o){let u;for(u in a[o])if(Object.prototype.hasOwnProperty.call(a[o],u)&&u!=="data"&&!Qe(a[o][u],n[o][u]))return!1;for(u in n[o])if(Object.prototype.hasOwnProperty.call(n[o],u)&&u!=="data"&&!Qe(a[o][u],n[o][u]))return!1;return!0}function St(a,n,o,u,f,_){a=a||{},n=n||{};for(let y in a)Object.prototype.hasOwnProperty.call(a,y)&&(Qe(a[y],n[y])||o.push({command:_,args:[u,y,n[y],f]}));for(let y in n)Object.prototype.hasOwnProperty.call(n,y)&&!Object.prototype.hasOwnProperty.call(a,y)&&(Qe(a[y],n[y])||o.push({command:_,args:[u,y,n[y],f]}))}function Rt(a){return a.id}function In(a,n){return a[n.id]=n,a}class Ne{constructor(n,o,u,f){this.message=(n?`${n}: `:"")+u,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)}}function sr(a,...n){for(let o of n)for(let u in o)a[u]=o[u];return a}class hn extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class Co{constructor(n,o=[]){this.parent=n,this.bindings={};for(let[u,f]of o)this.bindings[u]=f}concat(n){return new Co(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}let ea={kind:"null"},Ge={kind:"number"},vt={kind:"string"},mt={kind:"boolean"},Kn={kind:"color"},is={kind:"projectionDefinition"},Po={kind:"object"},dt={kind:"value"},nc={kind:"collator"},Do={kind:"formatted"},rc={kind:"padding"},Fi={kind:"colorArray"},ta={kind:"numberArray"},_n={kind:"resolvedImage"},ic={kind:"variableAnchorOffsetCollection"};function Cr(a,n){return{kind:"array",itemType:a,N:n}}function Yt(a){if(a.kind==="array"){let n=Yt(a.itemType);return typeof a.N=="number"?`array<${n}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${n}>`}return a.kind}let Lf=[ea,Ge,vt,mt,Kn,is,Do,Po,Cr(dt),rc,ta,Fi,_n,ic];function qa(a,n){if(n.kind==="error")return null;if(a.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!qa(a.itemType,n.itemType))&&(typeof a.N!="number"||a.N===n.N))return null}else{if(a.kind===n.kind)return null;if(a.kind==="value"){for(let o of Lf)if(!qa(o,n))return null}}return`Expected ${Yt(a)} but found ${Yt(n)} instead.`}function ih(a,n){return n.some(o=>o.kind===a.kind)}function Ao(a,n){return n.some(o=>o==="null"?a===null:o==="array"?Array.isArray(a):o==="object"?a&&!Array.isArray(a)&&typeof a=="object":o===typeof a)}function Ro(a,n){return a.kind==="array"&&n.kind==="array"?a.itemType.kind===n.itemType.kind&&typeof a.N=="number":a.kind===n.kind}let oh=.96422,Of=.82521,Ff=4/29,na=6/29,zf=3*na*na,c_=na*na*na,u_=Math.PI/180,h_=180/Math.PI;function sh(a){return(a%=360)<0&&(a+=360),a}function ra([a,n,o,u]){let f,_,y=lh((.2225045*(a=ah(a))+.7168786*(n=ah(n))+.0606169*(o=ah(o)))/1);a===n&&n===o?f=_=y:(f=lh((.4360747*a+.3850649*n+.1430804*o)/oh),_=lh((.0139322*a+.0971045*n+.7141733*o)/Of));let b=116*y-16;return[b<0?0:b,500*(f-y),200*(y-_),u]}function ah(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function lh(a){return a>c_?Math.pow(a,1/3):a/zf+Ff}function ia([a,n,o,u]){let f=(a+16)/116,_=isNaN(n)?f:f+n/500,y=isNaN(o)?f:f-o/200;return f=1*uh(f),_=oh*uh(_),y=Of*uh(y),[ch(3.1338561*_-1.6168667*f-.4906146*y),ch(-.9787684*_+1.9161415*f+.033454*y),ch(.0719453*_-.2289914*f+1.4052427*y),u]}function ch(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function uh(a){return a>na?a*a*a:zf*(a-Ff)}let d_=Object.hasOwn||function(a,n){return Object.prototype.hasOwnProperty.call(a,n)};function oa(a,n){return d_(a,n)?a[n]:void 0}function Za(a){return parseInt(a.padEnd(2,a),16)/255}function di(a,n){return xt(n?a/100:a,0,1)}function xt(a,n,o){return Math.min(Math.max(n,a),o)}function os(a){return!a.some(Number.isNaN)}let ko={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Qi(a,n,o){return a+o*(n-a)}function ss(a,n,o){return a.map((u,f)=>Qi(u,n[f],o))}class bt{constructor(n,o,u,f=1,_=!0){this.r=n,this.g=o,this.b=u,this.a=f,_||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[n,o,u,f]))}static parse(n){if(n instanceof bt)return n;if(typeof n!="string")return;let o=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];let f=oa(ko,u);if(f){let[y,b,M]=f;return[y/255,b/255,M/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){let y=u.length<6?1:2,b=1;return[Za(u.slice(b,b+=y)),Za(u.slice(b,b+=y)),Za(u.slice(b,b+=y)),Za(u.slice(b,b+y)||"ff")]}if(u.startsWith("rgb")){let y=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[b,M,T,P,A,O,z,j,G,Z,K,ce]=y,re=[P||" ",z||" ",Z].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){let se=[T,O,G].join(""),ye=se==="%%%"?100:se===""?255:0;if(ye){let we=[xt(+M/ye,0,1),xt(+A/ye,0,1),xt(+j/ye,0,1),K?di(+K,ce):1];if(os(we))return we}}return}}let _=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){let[y,b,M,T,P,A,O,z,j]=_,G=[M||" ",P||" ",O].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){let Z=[+b,xt(+T,0,100),xt(+A,0,100),z?di(+z,j):1];if(os(Z))return function([K,ce,re,se]){function ye(we){let De=(we+K/30)%12,Ve=ce*Math.min(re,1-re);return re-Ve*Math.max(-1,Math.min(De-3,9-De,1))}return K=sh(K),ce/=100,re/=100,[ye(0),ye(8),ye(4),se]}(Z)}}}(n);return o?new bt(...o,!1):void 0}get rgb(){let{r:n,g:o,b:u,a:f}=this,_=f||1/0;return this.overwriteGetter("rgb",[n/_,o/_,u/_,f])}get hcl(){return this.overwriteGetter("hcl",function(n){let[o,u,f,_]=ra(n),y=Math.sqrt(u*u+f*f);return[Math.round(1e4*y)?sh(Math.atan2(f,u)*h_):NaN,y,o,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ra(this.rgb))}overwriteGetter(n,o){return Object.defineProperty(this,n,{value:o}),o}toString(){let[n,o,u,f]=this.rgb;return`rgba(${[n,o,u].map(_=>Math.round(255*_)).join(",")},${f})`}static interpolate(n,o,u,f="rgb"){switch(f){case"rgb":{let[_,y,b,M]=ss(n.rgb,o.rgb,u);return new bt(_,y,b,M,!1)}case"hcl":{let[_,y,b,M]=n.hcl,[T,P,A,O]=o.hcl,z,j;if(isNaN(_)||isNaN(T))isNaN(_)?isNaN(T)?z=NaN:(z=T,b!==1&&b!==0||(j=P)):(z=_,A!==1&&A!==0||(j=y));else{let re=T-_;T>_&&re>180?re-=360:T<_&&_-T>180&&(re+=360),z=_+u*re}let[G,Z,K,ce]=function([re,se,ye,we]){return re=isNaN(re)?0:re*u_,ia([ye,Math.cos(re)*se,Math.sin(re)*se,we])}([z,j??Qi(y,P,u),Qi(b,A,u),Qi(M,O,u)]);return new bt(G,Z,K,ce,!1)}case"lab":{let[_,y,b,M]=ia(ss(n.lab,o.lab,u));return new bt(_,y,b,M,!1)}}}}bt.black=new bt(0,0,0,1),bt.white=new bt(1,1,1,1),bt.transparent=new bt(0,0,0,0),bt.red=new bt(1,0,0,1);class as{constructor(n,o,u){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let oc=["bottom","center","top"];class sc{constructor(n,o,u,f,_,y){this.text=n,this.image=o,this.scale=u,this.fontStack=f,this.textColor=_,this.verticalAlign=y}}class gr{constructor(n){this.sections=n}static fromString(n){return new gr([new sc(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof gr?n:gr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Bn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Bn)return n;if(typeof n=="number")return new Bn([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(let o of n)if(typeof o!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Bn(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,o,u){return new Bn(ss(n.values,o.values,u))}}class _r{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof _r)return n;if(typeof n=="number")return new _r([n]);if(Array.isArray(n)){for(let o of n)if(typeof o!="number")return;return new _r(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,o,u){return new _r(ss(n.values,o.values,u))}}class Tn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Tn)return n;if(typeof n=="string"){let u=bt.parse(n);return u?new Tn([u]):void 0}if(!Array.isArray(n))return;let o=[];for(let u of n){if(typeof u!="string")return;let f=bt.parse(u);if(!f)return;o.push(f)}return new Tn(o)}toString(){return JSON.stringify(this.values)}static interpolate(n,o,u,f="rgb"){let _=[];if(n.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${n.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let y=0;y<n.values.length;y++)_.push(bt.interpolate(n.values[y],o.values[y],u,f));return new Tn(_)}}class Kt extends Error{constructor(n){super(n),this.name="RuntimeError"}toJSON(){return this.message}}let jf=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class yr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof yr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let o=0;o<n.length;o+=2){let u=n[o],f=n[o+1];if(typeof u!="string"||!jf.has(u)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new yr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,o,u){let f=n.values,_=o.values;if(f.length!==_.length)throw new Kt(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${o.toString()}`);let y=[];for(let b=0;b<f.length;b+=2){if(f[b]!==_[b])throw new Kt(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${f[b]}, to[${b}]: ${_[b]}`);y.push(f[b]);let[M,T]=f[b+1],[P,A]=_[b+1];y.push([Qi(M,P,u),Qi(T,A,u)])}return new yr(y)}}class zr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new zr({name:n,available:!1}):null}}class ar{constructor(n,o,u){this.from=n,this.to=o,this.transition=u}static interpolate(n,o,u){return new ar(n,o,u)}static parse(n){return n instanceof ar?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new ar(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new ar(n.from,n.to,n.transition):typeof n=="string"?new ar(n,n,1):void 0}}function on(a,n,o,u){return typeof a=="number"&&a>=0&&a<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,n,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,n,o,u]:[a,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ls(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ar||a instanceof bt||a instanceof as||a instanceof gr||a instanceof Bn||a instanceof _r||a instanceof Tn||a instanceof yr||a instanceof zr)return!0;if(Array.isArray(a)){for(let n of a)if(!ls(n))return!1;return!0}if(typeof a=="object"){for(let n in a)if(!ls(a[n]))return!1;return!0}return!1}function nt(a){if(a===null)return ea;if(typeof a=="string")return vt;if(typeof a=="boolean")return mt;if(typeof a=="number")return Ge;if(a instanceof bt)return Kn;if(a instanceof ar)return is;if(a instanceof as)return nc;if(a instanceof gr)return Do;if(a instanceof Bn)return rc;if(a instanceof _r)return ta;if(a instanceof Tn)return Fi;if(a instanceof yr)return ic;if(a instanceof zr)return _n;if(Array.isArray(a)){let n=a.length,o;for(let u of a){let f=nt(u);if(o){if(o===f)continue;o=dt;break}o=f}return Cr(o||dt,n)}return Po}function ct(a){let n=typeof a;return a===null?"":n==="string"||n==="number"||n==="boolean"?String(a):a instanceof bt||a instanceof ar||a instanceof gr||a instanceof Bn||a instanceof _r||a instanceof Tn||a instanceof yr||a instanceof zr?a.toString():JSON.stringify(a)}class Ji{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!ls(n[1]))return o.error("invalid value");let u=n[1],f=nt(u),_=o.expectedType;return f.kind!=="array"||f.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(f=_),new Ji(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let kt={string:vt,number:Ge,boolean:mt,object:Po};class jr{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u,f=1,_=n[0];if(_==="array"){let b,M;if(n.length>2){let T=n[1];if(typeof T!="string"||!(T in kt)||T==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=kt[T],f++}else b=dt;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);M=n[2],f++}u=Cr(b,M)}else{if(!kt[_])throw new Error(`Types doesn't contain name = ${_}`);u=kt[_]}let y=[];for(;f<n.length;f++){let b=o.parse(n[f],f,dt);if(!b)return null;y.push(b)}return new jr(u,y)}evaluate(n){for(let o=0;o<this.args.length;o++){let u=this.args[o].evaluate(n);if(!qa(this.type,nt(u)))return u;if(o===this.args.length-1)throw new Kt(`Expected value to be of type ${Yt(this.type)}, but found ${Yt(nt(u))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}let zi={"to-boolean":mt,"to-color":Kn,"to-number":Ge,"to-string":vt};class ji{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u=n[0];if(!zi[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&n.length!==2)return o.error("Expected one argument.");let f=zi[u],_=[];for(let y=1;y<n.length;y++){let b=o.parse(n[y],y,dt);if(!b)return null;_.push(b)}return new ji(f,_)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let o,u;for(let f of this.args){if(o=f.evaluate(n),u=null,o instanceof bt)return o;if(typeof o=="string"){let _=n.parseColor(o);if(_)return _}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:on(o[0],o[1],o[2],o[3]),!u))return new bt(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Kt(u||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(let u of this.args){o=u.evaluate(n);let f=Bn.parse(o);if(f)return f}throw new Kt(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(let u of this.args){o=u.evaluate(n);let f=_r.parse(o);if(f)return f}throw new Kt(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(let u of this.args){o=u.evaluate(n);let f=Tn.parse(o);if(f)return f}throw new Kt(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(let u of this.args){o=u.evaluate(n);let f=yr.parse(o);if(f)return f}throw new Kt(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(let u of this.args){if(o=u.evaluate(n),o===null)return 0;let f=Number(o);if(!isNaN(f))return f}throw new Kt(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return gr.fromString(ct(this.args[0].evaluate(n)));case"resolvedImage":return zr.fromString(ct(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return ct(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}let ac=["Unknown","Point","LineString","Polygon"];class hh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ac[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let o=this._parseColorCache.get(n);return o||(o=bt.parse(n),this._parseColorCache.set(n,o)),o}}class sa{constructor(n,o,u=[],f,_=new Co,y=[]){this.registry=n,this.path=u,this.key=u.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=y,this.expectedType=f,this._isConstant=o}parse(n,o,u,f,_={}){return o?this.concat(o,u,f)._parse(n,_):this._parse(n,_)}_parse(n,o){function u(f,_,y){return y==="assert"?new jr(_,[f]):y==="coerce"?new ji(_,[f]):f}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=n[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let _=this.registry[f];if(_){let y=_.parse(n,this);if(!y)return null;if(this.expectedType){let b=this.expectedType,M=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||M.kind!=="value"){if(b.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(b.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(b.kind)&&["value","number","array"].includes(M.kind)||b.kind==="colorArray"&&["value","string","array"].includes(M.kind)||b.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))y=u(y,b,o.typeAnnotation||"coerce");else if(this.checkSubtype(b,M))return null}else y=u(y,b,o.typeAnnotation||"assert")}if(!(y instanceof Ji)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){let b=new hh;try{y=new Ji(y.type,y.evaluate(b))}catch(M){return this.error(M.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,u){let f=typeof n=="number"?this.path.concat(n):this.path,_=u?this.scope.concat(u):this.scope;return new sa(this.registry,this._isConstant,f,o||null,_,this.errors)}error(n,...o){let u=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new hn(u,n))}checkSubtype(n,o){let u=qa(n,o);return u&&this.error(u),u}}class Wa{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(let o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);let u=[];for(let _=1;_<n.length-1;_+=2){let y=n[_];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",_);let b=o.parse(n[_+1],_+1);if(!b)return null;u.push([y,b])}let f=o.parse(n[n.length-1],n.length-1,o.expectedType,u);return f?new Wa(u,f):null}outputDefined(){return this.result.outputDefined()}}class lc{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");let u=n[1];return o.scope.has(u)?new lc(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class cc{constructor(n,o,u){this.type=n,this.index=o,this.input=u}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let u=o.parse(n[1],1,Ge),f=o.parse(n[2],2,Cr(o.expectedType||dt));return u&&f?new cc(f.type.itemType,u,f):null}evaluate(n){let o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new Kt(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new Kt(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new Kt(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class uc{constructor(n,o){this.type=mt,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let u=o.parse(n[1],1,dt),f=o.parse(n[2],2,dt);return u&&f?ih(u.type,[mt,vt,Ge,ea,dt])?new uc(u,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(u.type)} instead`):null}evaluate(n){let o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!u)return!1;if(!Ao(o,["boolean","string","number","null"]))throw new Kt(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(nt(o))} instead.`);if(!Ao(u,["string","array"]))throw new Kt(`Expected second argument to be of type array or string, but found ${Yt(nt(u))} instead.`);return u.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class fi{constructor(n,o,u){this.type=Ge,this.needle=n,this.haystack=o,this.fromIndex=u}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let u=o.parse(n[1],1,dt),f=o.parse(n[2],2,dt);if(!u||!f)return null;if(!ih(u.type,[mt,vt,Ge,ea,dt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(u.type)} instead`);if(n.length===4){let _=o.parse(n[3],3,Ge);return _?new fi(u,f,_):null}return new fi(u,f)}evaluate(n){let o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!Ao(o,["boolean","string","number","null"]))throw new Kt(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(nt(o))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(n)),Ao(u,["string"])){let _=u.indexOf(o,f);return _===-1?-1:[...u.slice(0,_)].length}if(Ao(u,["array"]))return u.indexOf(o,f);throw new Kt(`Expected second argument to be of type array or string, but found ${Yt(nt(u))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class Un{constructor(n,o,u,f,_,y){this.inputType=n,this.type=o,this.input=u,this.cases=f,this.outputs=_,this.otherwise=y}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let u,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);let _={},y=[];for(let T=2;T<n.length-1;T+=2){let P=n[T],A=n[T+1];Array.isArray(P)||(P=[P]);let O=o.concat(T);if(P.length===0)return O.error("Expected at least one branch label.");for(let j of P){if(typeof j!="number"&&typeof j!="string")return O.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return O.error("Numeric branch labels must be integer values.");if(u){if(O.checkSubtype(u,nt(j)))return null}else u=nt(j);if(_[String(j)]!==void 0)return O.error("Branch labels must be unique.");_[String(j)]=y.length}let z=o.parse(A,T,f);if(!z)return null;f=f||z.type,y.push(z)}let b=o.parse(n[1],1,dt);if(!b)return null;let M=o.parse(n[n.length-1],n.length-1,f);return M?b.type.kind!=="value"&&o.concat(1).checkSubtype(u,b.type)?null:new Un(u,f,b,_,y,M):null}evaluate(n){let o=this.input.evaluate(n);return(nt(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class aa{constructor(n,o,u){this.type=n,this.branches=o,this.otherwise=u}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);let f=[];for(let y=1;y<n.length-1;y+=2){let b=o.parse(n[y],y,mt);if(!b)return null;let M=o.parse(n[y+1],y+1,u);if(!M)return null;f.push([b,M]),u=u||M.type}let _=o.parse(n[n.length-1],n.length-1,u);if(!_)return null;if(!u)throw new Error("Can't infer output type");return new aa(u,f,_)}evaluate(n){for(let[o,u]of this.branches)if(o.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(let[o,u]of this.branches)n(o),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class Xa{constructor(n,o,u,f){this.type=n,this.input=o,this.beginIndex=u,this.endIndex=f}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let u=o.parse(n[1],1,dt),f=o.parse(n[2],2,Ge);if(!u||!f)return null;if(!ih(u.type,[Cr(dt),vt,dt]))return o.error(`Expected first argument to be of type array or string, but found ${Yt(u.type)} instead`);if(n.length===4){let _=o.parse(n[3],3,Ge);return _?new Xa(u.type,u,f,_):null}return new Xa(u.type,u,f)}evaluate(n){let o=this.input.evaluate(n),u=this.beginIndex.evaluate(n),f;if(this.endIndex&&(f=this.endIndex.evaluate(n)),Ao(o,["string"]))return[...o].slice(u,f).join("");if(Ao(o,["array"]))return o.slice(u,f);throw new Kt(`Expected first argument to be of type array or string, but found ${Yt(nt(o))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function cs(a,n){let o=a.length-1,u,f,_=0,y=o,b=0;for(;_<=y;)if(b=Math.floor((_+y)/2),u=a[b],f=a[b+1],u<=n){if(b===o||n<f)return b;_=b+1}else{if(!(u>n))throw new Kt("Input is not a number.");y=b-1}return 0}class yn{constructor(n,o,u){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(let[f,_]of u)this.labels.push(f),this.outputs.push(_)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");let u=o.parse(n[1],1,Ge);if(!u)return null;let f=[],_=null;o.expectedType&&o.expectedType.kind!=="value"&&(_=o.expectedType);for(let y=1;y<n.length;y+=2){let b=y===1?-1/0:n[y],M=n[y+1],T=y,P=y+1;if(typeof b!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(f.length&&f[f.length-1][0]>=b)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);let A=o.parse(M,P,_);if(!A)return null;_=_||A.type,f.push([b,A])}return new yn(_,u,f)}evaluate(n){let o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);let f=this.input.evaluate(n);if(f<=o[0])return u[0].evaluate(n);let _=o.length;return f>=o[_-1]?u[_-1].evaluate(n):u[cs(o,f)].evaluate(n)}eachChild(n){n(this.input);for(let o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Bf(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Ya,dh,f_=function(){if(dh)return Ya;function a(n,o,u,f){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=u,this.p2y=f}return dh=1,Ya=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,o){if(o===void 0&&(o=1e-6),n<0)return 0;if(n>1)return 1;for(var u=n,f=0;f<8;f++){var _=this.sampleCurveX(u)-n;if(Math.abs(_)<o)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=_/y}var b=0,M=1;for(u=n,f=0;f<20&&(_=this.sampleCurveX(u),!(Math.abs(_-n)<o));f++)n>_?b=u:M=u,u=.5*(M-b)+b;return u},solve:function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))}},Ya}(),la=Bf(f_);class Qn{constructor(n,o,u,f,_){this.type=n,this.operator=o,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(let[y,b]of _)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(n,o,u,f){let _=0;if(n.name==="exponential")_=Ka(o,n.base,u,f);else if(n.name==="linear")_=Ka(o,1,u,f);else if(n.name==="cubic-bezier"){let y=n.controlPoints;_=new la(y[0],y[1],y[2],y[3]).solve(Ka(o,1,u,f))}return _}static parse(n,o){let[u,f,_,...y]=n;if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){let T=f[1];if(typeof T!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:T}}else{if(f[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{let T=f.slice(1);if(T.length!==4||T.some(P=>typeof P!="number"||P<0||P>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:T}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(_=o.parse(_,2,Ge),!_)return null;let b=[],M=null;u!=="interpolate-hcl"&&u!=="interpolate-lab"||o.expectedType==Fi?o.expectedType&&o.expectedType.kind!=="value"&&(M=o.expectedType):M=Kn;for(let T=0;T<y.length;T+=2){let P=y[T],A=y[T+1],O=T+3,z=T+4;if(typeof P!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(b.length&&b[b.length-1][0]>=P)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);let j=o.parse(A,z,M);if(!j)return null;M=M||j.type,b.push([P,j])}return Ro(M,Ge)||Ro(M,is)||Ro(M,Kn)||Ro(M,rc)||Ro(M,ta)||Ro(M,Fi)||Ro(M,ic)||Ro(M,Cr(Ge))?new Qn(M,u,f,_,b):o.error(`Type ${Yt(M)} is not interpolatable.`)}evaluate(n){let o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);let f=this.input.evaluate(n);if(f<=o[0])return u[0].evaluate(n);let _=o.length;if(f>=o[_-1])return u[_-1].evaluate(n);let y=cs(o,f),b=Qn.interpolationFactor(this.interpolation,f,o[y],o[y+1]),M=u[y].evaluate(n),T=u[y+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Qi(M,T,b);case"color":return bt.interpolate(M,T,b);case"padding":return Bn.interpolate(M,T,b);case"colorArray":return Tn.interpolate(M,T,b);case"numberArray":return _r.interpolate(M,T,b);case"variableAnchorOffsetCollection":return yr.interpolate(M,T,b);case"array":return ss(M,T,b);case"projectionDefinition":return ar.interpolate(M,T,b)}case"interpolate-hcl":switch(this.type.kind){case"color":return bt.interpolate(M,T,b,"hcl");case"colorArray":return Tn.interpolate(M,T,b,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return bt.interpolate(M,T,b,"lab");case"colorArray":return Tn.interpolate(M,T,b,"lab")}}}eachChild(n){n(this.input);for(let o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Ka(a,n,o,u){let f=u-o,_=a-o;return f===0?0:n===1?_/f:(Math.pow(n,_)-1)/(Math.pow(n,f)-1)}let Bi={color:bt.interpolate,number:Qi,padding:Bn.interpolate,numberArray:_r.interpolate,colorArray:Tn.interpolate,variableAnchorOffsetCollection:yr.interpolate,array:ss};class Qa{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u=null,f=o.expectedType;f&&f.kind!=="value"&&(u=f);let _=[];for(let b of n.slice(1)){let M=o.parse(b,1+_.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,_.push(M)}if(!u)throw new Error("No output type");let y=f&&_.some(b=>qa(f,b.type));return new Qa(y?dt:u,_)}evaluate(n){let o,u=null,f=0;for(let _ of this.args)if(f++,u=_.evaluate(n),u&&u instanceof zr&&!u.available&&(o||(o=u.name),u=null,f===this.args.length&&(u=o)),u!==null)break;return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function Ja(a,n){return a==="=="||a==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function el(a,n,o,u){return u.compare(n,o)===0}function lr(a,n,o){let u=a!=="=="&&a!=="!=";return class UI{constructor(_,y,b){this.type=mt,this.lhs=_,this.rhs=y,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");let b=_[0],M=y.parse(_[1],1,dt);if(!M)return null;if(!Ja(b,M.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Yt(M.type)}'.`);let T=y.parse(_[2],2,dt);if(!T)return null;if(!Ja(b,T.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Yt(T.type)}'.`);if(M.type.kind!==T.type.kind&&M.type.kind!=="value"&&T.type.kind!=="value")return y.error(`Cannot compare types '${Yt(M.type)}' and '${Yt(T.type)}'.`);u&&(M.type.kind==="value"&&T.type.kind!=="value"?M=new jr(T.type,[M]):M.type.kind!=="value"&&T.type.kind==="value"&&(T=new jr(M.type,[T])));let P=null;if(_.length===4){if(M.type.kind!=="string"&&T.type.kind!=="string"&&M.type.kind!=="value"&&T.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(P=y.parse(_[3],3,nc),!P)return null}return new UI(M,T,P)}evaluate(_){let y=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(u&&this.hasUntypedArgument){let M=nt(y),T=nt(b);if(M.kind!==T.kind||M.kind!=="string"&&M.kind!=="number")throw new Kt(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${M.kind}, ${T.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let M=nt(y),T=nt(b);if(M.kind!=="string"||T.kind!=="string")return n(_,y,b)}return this.collator?o(_,y,b,this.collator.evaluate(_)):n(_,y,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}let Uf=lr("==",function(a,n,o){return n===o},el),hc=lr("!=",function(a,n,o){return n!==o},function(a,n,o,u){return!el(0,n,o,u)}),p_=lr("<",function(a,n,o){return n<o},function(a,n,o,u){return u.compare(n,o)<0}),fh=lr(">",function(a,n,o){return n>o},function(a,n,o,u){return u.compare(n,o)>0}),m_=lr("<=",function(a,n,o){return n<=o},function(a,n,o,u){return u.compare(n,o)<=0}),g_=lr(">=",function(a,n,o){return n>=o},function(a,n,o,u){return u.compare(n,o)>=0});class dc{constructor(n,o,u){this.type=nc,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");let u=n[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");let f=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,mt);if(!f)return null;let _=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,mt);if(!_)return null;let y=null;return u.locale&&(y=o.parse(u.locale,1,vt),!y)?null:new dc(f,_,y)}evaluate(n){return new as(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class ph{constructor(n,o,u,f,_){this.type=vt,this.number=n,this.locale=o,this.currency=u,this.minFractionDigits=f,this.maxFractionDigits=_}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");let u=o.parse(n[1],1,Ge);if(!u)return null;let f=n[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=o.parse(f.locale,1,vt),!_))return null;let y=null;if(f.currency&&(y=o.parse(f.currency,1,vt),!y))return null;let b=null;if(f["min-fraction-digits"]&&(b=o.parse(f["min-fraction-digits"],1,Ge),!b))return null;let M=null;return f["max-fraction-digits"]&&(M=o.parse(f["max-fraction-digits"],1,Ge),!M)?null:new ph(u,_,y,b,M)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class us{constructor(n){this.type=Do,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u=n[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");let f=[],_=!1;for(let y=1;y<=n.length-1;++y){let b=n[y];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let M=null;if(b["font-scale"]&&(M=o.parse(b["font-scale"],1,Ge),!M))return null;let T=null;if(b["text-font"]&&(T=o.parse(b["text-font"],1,Cr(vt)),!T))return null;let P=null;if(b["text-color"]&&(P=o.parse(b["text-color"],1,Kn),!P))return null;let A=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!oc.includes(b["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(A=o.parse(b["vertical-align"],1,vt),!A)return null}let O=f[f.length-1];O.scale=M,O.font=T,O.textColor=P,O.verticalAlign=A}else{let M=o.parse(n[y],1,dt);if(!M)return null;let T=M.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new us(f)}evaluate(n){return new gr(this.sections.map(o=>{let u=o.content.evaluate(n);return nt(u)===_n?new sc("",u,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(n):null):new sc(ct(u),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null,o.verticalAlign?o.verticalAlign.evaluate(n):null)}))}eachChild(n){for(let o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor),o.verticalAlign&&n(o.verticalAlign)}outputDefined(){return!1}}class mh{constructor(n){this.type=_n,this.input=n}static parse(n,o){if(n.length!==2)return o.error("Expected two arguments.");let u=o.parse(n[1],1,vt);return u?new mh(u):o.error("No image name provided.")}evaluate(n){let o=this.input.evaluate(n),u=zr.fromString(o);return u&&n.availableImages&&(u.available=n.availableImages.indexOf(o)>-1),u}eachChild(n){n(this.input)}outputDefined(){return!1}}class fc{constructor(n){this.type=Ge,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);let u=o.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Yt(u.type)} instead.`):new fc(u):null}evaluate(n){let o=this.input.evaluate(n);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new Kt(`Expected value to be of type string or array, but found ${Yt(nt(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}let pi=8192;function __(a,n){let o=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,n.z);return[Math.round(o*f*pi),Math.round(u*f*pi)]}function pc(a,n){let o=Math.pow(2,n.z);return[(f=(a[0]/pi+n.x)/o,360*f-180),(u=(a[1]/pi+n.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90)];var u,f}function tl(a,n){a[0]=Math.min(a[0],n[0]),a[1]=Math.min(a[1],n[1]),a[2]=Math.max(a[2],n[0]),a[3]=Math.max(a[3],n[1])}function nl(a,n){return!(a[0]<=n[0]||a[2]>=n[2]||a[1]<=n[1]||a[3]>=n[3])}function y_(a,n,o){let u=a[0]-n[0],f=a[1]-n[1],_=a[0]-o[0],y=a[1]-o[1];return u*y-_*f==0&&u*_<=0&&f*y<=0}function mc(a,n,o,u){return(f=[u[0]-o[0],u[1]-o[1]])[0]*(_=[n[0]-a[0],n[1]-a[1]])[1]-f[1]*_[0]!=0&&!(!Gf(a,n,o,u)||!Gf(o,u,a,n));var f,_}function v_(a,n,o){for(let u of o)for(let f=0;f<u.length-1;++f)if(mc(a,n,u[f],u[f+1]))return!0;return!1}function hs(a,n,o=!1){let u=!1;for(let b of n)for(let M=0;M<b.length-1;M++){if(y_(a,b[M],b[M+1]))return o;(_=b[M])[1]>(f=a)[1]!=(y=b[M+1])[1]>f[1]&&f[0]<(y[0]-_[0])*(f[1]-_[1])/(y[1]-_[1])+_[0]&&(u=!u)}var f,_,y;return u}function Vf(a,n){for(let o of n)if(hs(a,o))return!0;return!1}function gh(a,n){for(let o of a)if(!hs(o,n))return!1;for(let o=0;o<a.length-1;++o)if(v_(a[o],a[o+1],n))return!1;return!0}function x_(a,n){for(let o of n)if(gh(a,o))return!0;return!1}function Gf(a,n,o,u){let f=u[0]-o[0],_=u[1]-o[1],y=(a[0]-o[0])*_-f*(a[1]-o[1]),b=(n[0]-o[0])*_-f*(n[1]-o[1]);return y>0&&b<0||y<0&&b>0}function _h(a,n,o){let u=[];for(let f=0;f<a.length;f++){let _=[];for(let y=0;y<a[f].length;y++){let b=__(a[f][y],o);tl(n,b),_.push(b)}u.push(_)}return u}function $f(a,n,o){let u=[];for(let f=0;f<a.length;f++){let _=_h(a[f],n,o);u.push(_)}return u}function gc(a,n,o,u){if(a[0]<o[0]||a[0]>o[2]){let f=.5*u,_=a[0]-o[0]>f?-u:o[0]-a[0]>f?u:0;_===0&&(_=a[0]-o[2]>f?-u:o[2]-a[0]>f?u:0),a[0]+=_}tl(n,a)}function Hf(a,n,o,u){let f=Math.pow(2,u.z)*pi,_=[u.x*pi,u.y*pi],y=[];for(let b of a)for(let M of b){let T=[M.x+_[0],M.y+_[1]];gc(T,n,o,f),y.push(T)}return y}function qf(a,n,o,u){let f=Math.pow(2,u.z)*pi,_=[u.x*pi,u.y*pi],y=[];for(let M of a){let T=[];for(let P of M){let A=[P.x+_[0],P.y+_[1]];tl(n,A),T.push(A)}y.push(T)}if(n[2]-n[0]<=f/2){(b=n)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let M of y)for(let T of M)gc(T,n,o,f)}var b;return y}class ds{constructor(n,o){this.type=mt,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(ls(n[1])){let u=n[1];if(u.type==="FeatureCollection"){let f=[];for(let _ of u.features){let{type:y,coordinates:b}=_.geometry;y==="Polygon"&&f.push(b),y==="MultiPolygon"&&f.push(...b)}if(f.length)return new ds(u,{type:"MultiPolygon",coordinates:f})}else if(u.type==="Feature"){let f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ds(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ds(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){let f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(u.type==="Polygon"){let b=_h(u.coordinates,_,y),M=Hf(o.geometry(),f,_,y);if(!nl(f,_))return!1;for(let T of M)if(!hs(T,b))return!1}if(u.type==="MultiPolygon"){let b=$f(u.coordinates,_,y),M=Hf(o.geometry(),f,_,y);if(!nl(f,_))return!1;for(let T of M)if(!Vf(T,b))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){let f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(u.type==="Polygon"){let b=_h(u.coordinates,_,y),M=qf(o.geometry(),f,_,y);if(!nl(f,_))return!1;for(let T of M)if(!gh(T,b))return!1}if(u.type==="MultiPolygon"){let b=$f(u.coordinates,_,y),M=qf(o.geometry(),f,_,y);if(!nl(f,_))return!1;for(let T of M)if(!x_(T,b))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let yh=class{constructor(a=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=a,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;let a=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),a}peek(){return this.data[0]}_up(a){let{data:n,compare:o}=this,u=n[a];for(;a>0;){let f=a-1>>1,_=n[f];if(o(u,_)>=0)break;n[a]=_,a=f}n[a]=u}_down(a){let{data:n,compare:o}=this,u=this.length>>1,f=n[a];for(;a<u;){let _=1+(a<<1),y=_+1;if(y<this.length&&o(n[y],n[_])<0&&(_=y),o(n[_],f)>=0)break;n[a]=n[_],a=_}n[a]=f}};function vh(a,n,o=0,u=a.length-1,f=b_){for(;u>o;){if(u-o>600){let M=u-o+1,T=n-o+1,P=Math.log(M),A=.5*Math.exp(2*P/3),O=.5*Math.sqrt(P*A*(M-A)/M)*(T-M/2<0?-1:1);vh(a,n,Math.max(o,Math.floor(n-T*A/M+O)),Math.min(u,Math.floor(n+(M-T)*A/M+O)),f)}let _=a[n],y=o,b=u;for(rl(a,o,n),f(a[u],_)>0&&rl(a,o,u);y<b;){for(rl(a,y,b),y++,b--;f(a[y],_)<0;)y++;for(;f(a[b],_)>0;)b--}f(a[o],_)===0?rl(a,o,b):(b++,rl(a,b,u)),b<=n&&(o=b+1),n<=b&&(u=b-1)}}function rl(a,n,o){let u=a[n];a[n]=a[o],a[o]=u}function b_(a,n){return a<n?-1:a>n?1:0}function il(a,n){if(a.length<=1)return[a];let o=[],u,f;for(let _ of a){let y=w_(_);y!==0&&(_.area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(u&&o.push(u),u=[_]):u.push(_))}if(u&&o.push(u),n>1)for(let _=0;_<o.length;_++)o[_].length<=n||(vh(o[_],n,1,o[_].length-1,Zf),o[_]=o[_].slice(0,n));return o}function Zf(a,n){return n.area-a.area}function w_(a){let n=0;for(let o,u,f=0,_=a.length,y=_-1;f<_;y=f++)o=a[f],u=a[y],n+=(u.x-o.x)*(o.y+u.y);return n}let Wf=1/298.257223563,Xf=Wf*(2-Wf),xh=Math.PI/180;class bh{constructor(n){let o=6378.137*xh*1e3,u=Math.cos(n*xh),f=1/(1-Xf*(1-u*u)),_=Math.sqrt(f);this.kx=o*_*u,this.ky=o*_*f*(1-Xf)}distance(n,o){let u=this.wrap(n[0]-o[0])*this.kx,f=(n[1]-o[1])*this.ky;return Math.sqrt(u*u+f*f)}pointOnLine(n,o){let u,f,_,y,b=1/0;for(let M=0;M<n.length-1;M++){let T=n[M][0],P=n[M][1],A=this.wrap(n[M+1][0]-T)*this.kx,O=(n[M+1][1]-P)*this.ky,z=0;A===0&&O===0||(z=(this.wrap(o[0]-T)*this.kx*A+(o[1]-P)*this.ky*O)/(A*A+O*O),z>1?(T=n[M+1][0],P=n[M+1][1]):z>0&&(T+=A/this.kx*z,P+=O/this.ky*z)),A=this.wrap(o[0]-T)*this.kx,O=(o[1]-P)*this.ky;let j=A*A+O*O;j<b&&(b=j,u=T,f=P,_=M,y=z)}return{point:[u,f],index:_,t:Math.max(0,Math.min(1,y))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Yf(a,n){return n[0]-a[0]}function _c(a){return a[1]-a[0]+1}function eo(a,n){return a[1]>=a[0]&&a[1]<n}function Lt(a,n){if(a[0]>a[1])return[null,null];let o=_c(a);if(n){if(o===2)return[a,null];let f=Math.floor(o/2);return[[a[0],a[0]+f],[a[0]+f,a[1]]]}if(o===1)return[a,null];let u=Math.floor(o/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}function wh(a,n){if(!eo(n,a.length))return[1/0,1/0,-1/0,-1/0];let o=[1/0,1/0,-1/0,-1/0];for(let u=n[0];u<=n[1];++u)tl(o,a[u]);return o}function Mh(a){let n=[1/0,1/0,-1/0,-1/0];for(let o of a)for(let u of o)tl(n,u);return n}function Kf(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Sh(a,n,o){if(!Kf(a)||!Kf(n))return NaN;let u=0,f=0;return a[2]<n[0]&&(u=n[0]-a[2]),a[0]>n[2]&&(u=a[0]-n[2]),a[1]>n[3]&&(f=a[1]-n[3]),a[3]<n[1]&&(f=n[1]-a[3]),o.distance([0,0],[u,f])}function fs(a,n,o){let u=o.pointOnLine(n,a);return o.distance(a,u.point)}function Eh(a,n,o,u,f){let _=Math.min(fs(a,[o,u],f),fs(n,[o,u],f)),y=Math.min(fs(o,[a,n],f),fs(u,[a,n],f));return Math.min(_,y)}function M_(a,n,o,u,f){if(!eo(n,a.length)||!eo(u,o.length))return 1/0;let _=1/0;for(let y=n[0];y<n[1];++y){let b=a[y],M=a[y+1];for(let T=u[0];T<u[1];++T){let P=o[T],A=o[T+1];if(mc(b,M,P,A))return 0;_=Math.min(_,Eh(b,M,P,A,f))}}return _}function S_(a,n,o,u,f){if(!eo(n,a.length)||!eo(u,o.length))return NaN;let _=1/0;for(let y=n[0];y<=n[1];++y)for(let b=u[0];b<=u[1];++b)if(_=Math.min(_,f.distance(a[y],o[b])),_===0)return _;return _}function E_(a,n,o){if(hs(a,n,!0))return 0;let u=1/0;for(let f of n){let _=f[0],y=f[f.length-1];if(_!==y&&(u=Math.min(u,fs(a,[y,_],o)),u===0))return u;let b=o.pointOnLine(f,a);if(u=Math.min(u,o.distance(a,b.point)),u===0)return u}return u}function I_(a,n,o,u){if(!eo(n,a.length))return NaN;for(let _=n[0];_<=n[1];++_)if(hs(a[_],o,!0))return 0;let f=1/0;for(let _=n[0];_<n[1];++_){let y=a[_],b=a[_+1];for(let M of o)for(let T=0,P=M.length,A=P-1;T<P;A=T++){let O=M[A],z=M[T];if(mc(y,b,O,z))return 0;f=Math.min(f,Eh(y,b,O,z,u))}}return f}function Qf(a,n){for(let o of a)for(let u of o)if(hs(u,n,!0))return!0;return!1}function T_(a,n,o,u=1/0){let f=Mh(a),_=Mh(n);if(u!==1/0&&Sh(f,_,o)>=u)return u;if(nl(f,_)){if(Qf(a,n))return 0}else if(Qf(n,a))return 0;let y=1/0;for(let b of a)for(let M=0,T=b.length,P=T-1;M<T;P=M++){let A=b[P],O=b[M];for(let z of n)for(let j=0,G=z.length,Z=G-1;j<G;Z=j++){let K=z[Z],ce=z[j];if(mc(A,O,K,ce))return 0;y=Math.min(y,Eh(A,O,K,ce,o))}}return y}function Jf(a,n,o,u,f,_){if(!_)return;let y=Sh(wh(u,_),f,o);y<n&&a.push([y,_,[0,0]])}function yc(a,n,o,u,f,_,y){if(!_||!y)return;let b=Sh(wh(u,_),wh(f,y),o);b<n&&a.push([b,_,y])}function vc(a,n,o,u,f=1/0){let _=Math.min(u.distance(a[0],o[0][0]),f);if(_===0)return _;let y=new yh([[0,[0,a.length-1],[0,0]]],Yf),b=Mh(o);for(;y.length>0;){let M=y.pop();if(M[0]>=_)continue;let T=M[1],P=n?50:100;if(_c(T)<=P){if(!eo(T,a.length))return NaN;if(n){let A=I_(a,T,o,u);if(isNaN(A)||A===0)return A;_=Math.min(_,A)}else for(let A=T[0];A<=T[1];++A){let O=E_(a[A],o,u);if(_=Math.min(_,O),_===0)return 0}}else{let A=Lt(T,n);Jf(y,_,u,a,b,A[0]),Jf(y,_,u,a,b,A[1])}}return _}function xc(a,n,o,u,f,_=1/0){let y=Math.min(_,f.distance(a[0],o[0]));if(y===0)return y;let b=new yh([[0,[0,a.length-1],[0,o.length-1]]],Yf);for(;b.length>0;){let M=b.pop();if(M[0]>=y)continue;let T=M[1],P=M[2],A=n?50:100,O=u?50:100;if(_c(T)<=A&&_c(P)<=O){if(!eo(T,a.length)&&eo(P,o.length))return NaN;let z;if(n&&u)z=M_(a,T,o,P,f),y=Math.min(y,z);else if(n&&!u){let j=a.slice(T[0],T[1]+1);for(let G=P[0];G<=P[1];++G)if(z=fs(o[G],j,f),y=Math.min(y,z),y===0)return y}else if(!n&&u){let j=o.slice(P[0],P[1]+1);for(let G=T[0];G<=T[1];++G)if(z=fs(a[G],j,f),y=Math.min(y,z),y===0)return y}else z=S_(a,T,o,P,f),y=Math.min(y,z)}else{let z=Lt(T,n),j=Lt(P,u);yc(b,y,f,a,o,z[0],j[0]),yc(b,y,f,a,o,z[0],j[1]),yc(b,y,f,a,o,z[1],j[0]),yc(b,y,f,a,o,z[1],j[1])}}return y}function Ih(a){return a.type==="MultiPolygon"?a.coordinates.map(n=>({type:"Polygon",coordinates:n})):a.type==="MultiLineString"?a.coordinates.map(n=>({type:"LineString",coordinates:n})):a.type==="MultiPoint"?a.coordinates.map(n=>({type:"Point",coordinates:n})):[a]}class ps{constructor(n,o){this.type=Ge,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(ls(n[1])){let u=n[1];if(u.type==="FeatureCollection")return new ps(u,u.features.map(f=>Ih(f.geometry)).flat());if(u.type==="Feature")return new ps(u,Ih(u.geometry));if("type"in u&&"coordinates"in u)return new ps(u,Ih(u))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){let f=o.geometry(),_=f.flat().map(M=>pc([M.x,M.y],o.canonical));if(f.length===0)return NaN;let y=new bh(_[0][1]),b=1/0;for(let M of u){switch(M.type){case"Point":b=Math.min(b,xc(_,!1,[M.coordinates],!1,y,b));break;case"LineString":b=Math.min(b,xc(_,!1,M.coordinates,!0,y,b));break;case"Polygon":b=Math.min(b,vc(_,!1,M.coordinates,y,b))}if(b===0)return b}return b}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){let f=o.geometry(),_=f.flat().map(M=>pc([M.x,M.y],o.canonical));if(f.length===0)return NaN;let y=new bh(_[0][1]),b=1/0;for(let M of u){switch(M.type){case"Point":b=Math.min(b,xc(_,!0,[M.coordinates],!1,y,b));break;case"LineString":b=Math.min(b,xc(_,!0,M.coordinates,!0,y,b));break;case"Polygon":b=Math.min(b,vc(_,!0,M.coordinates,y,b))}if(b===0)return b}return b}(n,this.geometries);if(n.geometryType()==="Polygon")return function(o,u){let f=o.geometry();if(f.length===0||f[0].length===0)return NaN;let _=il(f,0).map(M=>M.map(T=>T.map(P=>pc([P.x,P.y],o.canonical)))),y=new bh(_[0][0][0][1]),b=1/0;for(let M of u)for(let T of _){switch(M.type){case"Point":b=Math.min(b,vc([M.coordinates],!1,T,y,b));break;case"LineString":b=Math.min(b,vc(M.coordinates,!0,T,y,b));break;case"Polygon":b=Math.min(b,T_(T,M.coordinates,y,b))}if(b===0)return b}return b}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ol{constructor(n){this.type=dt,this.key=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);let u=n[1];return u==null?o.error("Global state property must be defined."):typeof u!="string"?o.error(`Global state property must be string, but found ${typeof n[1]} instead.`):new ol(u)}evaluate(n){var o;let u=(o=n.globals)===null||o===void 0?void 0:o.globalState;return u&&Object.keys(u).length!==0?oa(u,this.key):null}eachChild(){}outputDefined(){return!1}}let ca={"==":Uf,"!=":hc,">":fh,"<":p_,">=":g_,"<=":m_,array:jr,at:cc,boolean:jr,case:aa,coalesce:Qa,collator:dc,format:us,image:mh,in:uc,"index-of":fi,interpolate:Qn,"interpolate-hcl":Qn,"interpolate-lab":Qn,length:fc,let:Wa,literal:Ji,match:Un,number:jr,"number-format":ph,object:jr,slice:Xa,step:yn,string:jr,"to-boolean":ji,"to-color":ji,"to-number":ji,"to-string":ji,var:lc,within:ds,distance:ps,"global-state":ol};class Yr{constructor(n,o,u,f){this.name=n,this.type=o,this._evaluate=u,this.args=f}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,o){let u=n[0],f=Yr.definitions[u];if(!f)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let _=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,b=y.filter(([T])=>!Array.isArray(T)||T.length===n.length-1),M=null;for(let[T,P]of b){M=new sa(o.registry,bc,o.path,null,o.scope);let A=[],O=!1;for(let z=1;z<n.length;z++){let j=n[z],G=Array.isArray(T)?T[z-1]:T.type,Z=M.parse(j,1+A.length,G);if(!Z){O=!0;break}A.push(Z)}if(!O)if(Array.isArray(T)&&T.length!==A.length)M.error(`Expected ${T.length} arguments, but found ${A.length} instead.`);else{for(let z=0;z<A.length;z++){let j=Array.isArray(T)?T[z]:T.type,G=A[z];M.concat(z+1).checkSubtype(j,G.type)}if(M.errors.length===0)return new Yr(u,_,P,A)}}if(b.length===1)o.errors.push(...M.errors);else{let T=(b.length?b:y).map(([A])=>{return O=A,Array.isArray(O)?`(${O.map(Yt).join(", ")})`:`(${Yt(O.type)}...)`;var O}).join(" | "),P=[];for(let A=1;A<n.length;A++){let O=o.parse(n[A],1+P.length);if(!O)return null;P.push(Yt(O.type))}o.error(`Expected arguments of type ${T}, but found (${P.join(", ")}) instead.`)}return null}static register(n,o){Yr.definitions=o;for(let u in o)n[u]=Yr}}function ep(a,[n,o,u,f]){n=n.evaluate(a),o=o.evaluate(a),u=u.evaluate(a);let _=f?f.evaluate(a):1,y=on(n,o,u,_);if(y)throw new Kt(y);return new bt(n/255,o/255,u/255,_,!1)}function tp(a,n){return a in n}function Th(a,n){let o=n[a];return o===void 0?null:o}function ms(a){return{type:a}}function bc(a){if(a instanceof lc)return bc(a.boundExpression);if(a instanceof Yr&&a.name==="error"||a instanceof dc||a instanceof ds||a instanceof ps||a instanceof ol)return!1;let n=a instanceof ji||a instanceof jr,o=!0;return a.eachChild(u=>{o=n?o&&bc(u):o&&u instanceof Ji}),!!o&&wc(a)&&Mc(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function wc(a){if(a instanceof Yr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof ds||a instanceof ps)return!1;let n=!0;return a.eachChild(o=>{n&&!wc(o)&&(n=!1)}),n}function sl(a){if(a instanceof Yr&&a.name==="feature-state")return!1;let n=!0;return a.eachChild(o=>{n&&!sl(o)&&(n=!1)}),n}function Mc(a,n){if(a instanceof Yr&&n.indexOf(a.name)>=0)return!1;let o=!0;return a.eachChild(u=>{o&&!Mc(u,n)&&(o=!1)}),o}function np(a){return{result:"success",value:a}}function ua(a){return{result:"error",value:a}}function No(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function rp(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ch(a){return!!a.expression&&a.expression.interpolated}function Et(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function al(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&nt(a)===Po}function C_(a){return a}function ip(a,n){let o=a.stops&&typeof a.stops[0][0]=="object",u=o||!(o||a.property!==void 0),f=a.type||(Ch(n)?"exponential":"interval"),_=function(P){switch(P.type){case"color":return bt.parse;case"padding":return Bn.parse;case"numberArray":return _r.parse;case"colorArray":return Tn.parse;default:return null}}(n);if(_&&((a=sr({},a)).stops&&(a.stops=a.stops.map(P=>[P[0],_(P[1])])),a.default=_(a.default?a.default:n.default)),a.colorSpace&&(y=a.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var y;let b=function(P){switch(P){case"exponential":return sp;case"interval":return P_;case"categorical":return op;case"identity":return D_;default:throw new Error(`Unknown function type "${P}"`)}}(f),M,T;if(f==="categorical"){M=Object.create(null);for(let P of a.stops)M[P[0]]=P[1];T=typeof a.stops[0][0]}if(o){let P={},A=[];for(let j=0;j<a.stops.length;j++){let G=a.stops[j],Z=G[0].zoom;P[Z]===void 0&&(P[Z]={zoom:Z,type:a.type,property:a.property,default:a.default,stops:[]},A.push(Z)),P[Z].stops.push([G[0].value,G[1]])}let O=[];for(let j of A)O.push([P[j].zoom,ip(P[j],n)]);let z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Qn.interpolationFactor.bind(void 0,z),zoomStops:O.map(j=>j[0]),evaluate:({zoom:j},G)=>sp({stops:O,base:a.base},n,j).evaluate(j,G)}}if(u){let P=f==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Qn.interpolationFactor.bind(void 0,P),zoomStops:a.stops.map(A=>A[0]),evaluate:({zoom:A})=>b(a,n,A,M,T)}}return{kind:"source",evaluate(P,A){let O=A&&A.properties?A.properties[a.property]:void 0;return O===void 0?Lo(a.default,n.default):b(a,n,O,M,T)}}}function Lo(a,n,o){return a!==void 0?a:n!==void 0?n:o!==void 0?o:void 0}function op(a,n,o,u,f){return Lo(typeof o===f?u[o]:void 0,a.default,n.default)}function P_(a,n,o){if(Et(o)!=="number")return Lo(a.default,n.default);let u=a.stops.length;if(u===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[u-1][0])return a.stops[u-1][1];let f=cs(a.stops.map(_=>_[0]),o);return a.stops[f][1]}function sp(a,n,o){let u=a.base!==void 0?a.base:1;if(Et(o)!=="number")return Lo(a.default,n.default);let f=a.stops.length;if(f===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[f-1][0])return a.stops[f-1][1];let _=cs(a.stops.map(P=>P[0]),o),y=function(P,A,O,z){let j=z-O,G=P-O;return j===0?0:A===1?G/j:(Math.pow(A,G)-1)/(Math.pow(A,j)-1)}(o,u,a.stops[_][0],a.stops[_+1][0]),b=a.stops[_][1],M=a.stops[_+1][1],T=Bi[n.type]||C_;return typeof b.evaluate=="function"?{evaluate(...P){let A=b.evaluate.apply(void 0,P),O=M.evaluate.apply(void 0,P);if(A!==void 0&&O!==void 0)return T(A,O,y,a.colorSpace)}}:T(b,M,y,a.colorSpace)}function D_(a,n,o){switch(n.type){case"color":o=bt.parse(o);break;case"formatted":o=gr.fromString(o.toString());break;case"resolvedImage":o=zr.fromString(o.toString());break;case"padding":o=Bn.parse(o);break;case"colorArray":o=Tn.parse(o);break;case"numberArray":o=_r.parse(o);break;default:Et(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0)}return Lo(o,a.default,n.default)}Yr.register(ca,{error:[{kind:"error"},[vt],(a,[n])=>{throw new Kt(n.evaluate(a))}],typeof:[vt,[dt],(a,[n])=>Yt(nt(n.evaluate(a)))],"to-rgba":[Cr(Ge,4),[Kn],(a,[n])=>{let[o,u,f,_]=n.evaluate(a).rgb;return[255*o,255*u,255*f,_]}],rgb:[Kn,[Ge,Ge,Ge],ep],rgba:[Kn,[Ge,Ge,Ge,Ge],ep],has:{type:mt,overloads:[[[vt],(a,[n])=>tp(n.evaluate(a),a.properties())],[[vt,Po],(a,[n,o])=>tp(n.evaluate(a),o.evaluate(a))]]},get:{type:dt,overloads:[[[vt],(a,[n])=>Th(n.evaluate(a),a.properties())],[[vt,Po],(a,[n,o])=>Th(n.evaluate(a),o.evaluate(a))]]},"feature-state":[dt,[vt],(a,[n])=>Th(n.evaluate(a),a.featureState||{})],properties:[Po,[],a=>a.properties()],"geometry-type":[vt,[],a=>a.geometryType()],id:[dt,[],a=>a.id()],zoom:[Ge,[],a=>a.globals.zoom],"heatmap-density":[Ge,[],a=>a.globals.heatmapDensity||0],elevation:[Ge,[],a=>a.globals.elevation||0],"line-progress":[Ge,[],a=>a.globals.lineProgress||0],accumulated:[dt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Ge,ms(Ge),(a,n)=>{let o=0;for(let u of n)o+=u.evaluate(a);return o}],"*":[Ge,ms(Ge),(a,n)=>{let o=1;for(let u of n)o*=u.evaluate(a);return o}],"-":{type:Ge,overloads:[[[Ge,Ge],(a,[n,o])=>n.evaluate(a)-o.evaluate(a)],[[Ge],(a,[n])=>-n.evaluate(a)]]},"/":[Ge,[Ge,Ge],(a,[n,o])=>n.evaluate(a)/o.evaluate(a)],"%":[Ge,[Ge,Ge],(a,[n,o])=>n.evaluate(a)%o.evaluate(a)],ln2:[Ge,[],()=>Math.LN2],pi:[Ge,[],()=>Math.PI],e:[Ge,[],()=>Math.E],"^":[Ge,[Ge,Ge],(a,[n,o])=>Math.pow(n.evaluate(a),o.evaluate(a))],sqrt:[Ge,[Ge],(a,[n])=>Math.sqrt(n.evaluate(a))],log10:[Ge,[Ge],(a,[n])=>Math.log(n.evaluate(a))/Math.LN10],ln:[Ge,[Ge],(a,[n])=>Math.log(n.evaluate(a))],log2:[Ge,[Ge],(a,[n])=>Math.log(n.evaluate(a))/Math.LN2],sin:[Ge,[Ge],(a,[n])=>Math.sin(n.evaluate(a))],cos:[Ge,[Ge],(a,[n])=>Math.cos(n.evaluate(a))],tan:[Ge,[Ge],(a,[n])=>Math.tan(n.evaluate(a))],asin:[Ge,[Ge],(a,[n])=>Math.asin(n.evaluate(a))],acos:[Ge,[Ge],(a,[n])=>Math.acos(n.evaluate(a))],atan:[Ge,[Ge],(a,[n])=>Math.atan(n.evaluate(a))],min:[Ge,ms(Ge),(a,n)=>Math.min(...n.map(o=>o.evaluate(a)))],max:[Ge,ms(Ge),(a,n)=>Math.max(...n.map(o=>o.evaluate(a)))],abs:[Ge,[Ge],(a,[n])=>Math.abs(n.evaluate(a))],round:[Ge,[Ge],(a,[n])=>{let o=n.evaluate(a);return o<0?-Math.round(-o):Math.round(o)}],floor:[Ge,[Ge],(a,[n])=>Math.floor(n.evaluate(a))],ceil:[Ge,[Ge],(a,[n])=>Math.ceil(n.evaluate(a))],"filter-==":[mt,[vt,dt],(a,[n,o])=>a.properties()[n.value]===o.value],"filter-id-==":[mt,[dt],(a,[n])=>a.id()===n.value],"filter-type-==":[mt,[vt],(a,[n])=>a.geometryType()===n.value],"filter-<":[mt,[vt,dt],(a,[n,o])=>{let u=a.properties()[n.value],f=o.value;return typeof u==typeof f&&u<f}],"filter-id-<":[mt,[dt],(a,[n])=>{let o=a.id(),u=n.value;return typeof o==typeof u&&o<u}],"filter->":[mt,[vt,dt],(a,[n,o])=>{let u=a.properties()[n.value],f=o.value;return typeof u==typeof f&&u>f}],"filter-id->":[mt,[dt],(a,[n])=>{let o=a.id(),u=n.value;return typeof o==typeof u&&o>u}],"filter-<=":[mt,[vt,dt],(a,[n,o])=>{let u=a.properties()[n.value],f=o.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[mt,[dt],(a,[n])=>{let o=a.id(),u=n.value;return typeof o==typeof u&&o<=u}],"filter->=":[mt,[vt,dt],(a,[n,o])=>{let u=a.properties()[n.value],f=o.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[mt,[dt],(a,[n])=>{let o=a.id(),u=n.value;return typeof o==typeof u&&o>=u}],"filter-has":[mt,[dt],(a,[n])=>n.value in a.properties()],"filter-has-id":[mt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[mt,[Cr(vt)],(a,[n])=>n.value.indexOf(a.geometryType())>=0],"filter-id-in":[mt,[Cr(dt)],(a,[n])=>n.value.indexOf(a.id())>=0],"filter-in-small":[mt,[vt,Cr(dt)],(a,[n,o])=>o.value.indexOf(a.properties()[n.value])>=0],"filter-in-large":[mt,[vt,Cr(dt)],(a,[n,o])=>function(u,f,_,y){for(;_<=y;){let b=_+y>>1;if(f[b]===u)return!0;f[b]>u?y=b-1:_=b+1}return!1}(a.properties()[n.value],o.value,0,o.value.length-1)],all:{type:mt,overloads:[[[mt,mt],(a,[n,o])=>n.evaluate(a)&&o.evaluate(a)],[ms(mt),(a,n)=>{for(let o of n)if(!o.evaluate(a))return!1;return!0}]]},any:{type:mt,overloads:[[[mt,mt],(a,[n,o])=>n.evaluate(a)||o.evaluate(a)],[ms(mt),(a,n)=>{for(let o of n)if(o.evaluate(a))return!0;return!1}]]},"!":[mt,[mt],(a,[n])=>!n.evaluate(a)],"is-supported-script":[mt,[vt],(a,[n])=>{let o=a.globals&&a.globals.isSupportedScript;return!o||o(n.evaluate(a))}],upcase:[vt,[vt],(a,[n])=>n.evaluate(a).toUpperCase()],downcase:[vt,[vt],(a,[n])=>n.evaluate(a).toLowerCase()],concat:[vt,ms(dt),(a,n)=>n.map(o=>ct(o.evaluate(a))).join("")],"resolved-locale":[vt,[nc],(a,[n])=>n.evaluate(a).resolvedLocale()]});class Ph{constructor(n,o){this.expression=n,this._warningHistory={},this._evaluator=new hh,this._defaultValue=o?function(u){if(u.type==="color"&&al(u.default))return new bt(0,0,0,0);switch(u.type){case"color":return bt.parse(u.default)||null;case"padding":return Bn.parse(u.default)||null;case"numberArray":return _r.parse(u.default)||null;case"colorArray":return Tn.parse(u.default)||null;case"variableAnchorOffsetCollection":return yr.parse(u.default)||null;case"projectionDefinition":return ar.parse(u.default)||null;default:return u.default===void 0?null:u.default}}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,u,f,_,y){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(n,o,u,f,_,y){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Kt(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Sc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ca}function ll(a,n){let o=new sa(ca,bc,[],n?function(f){let _={color:Kn,string:vt,number:Ge,enum:vt,boolean:mt,formatted:Do,padding:rc,numberArray:ta,colorArray:Fi,projectionDefinition:is,resolvedImage:_n,variableAnchorOffsetCollection:ic};return f.type==="array"?Cr(_[f.value]||dt,f.length):_[f.type]}(n):void 0),u=o.parse(a,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?np(new Ph(u,n)):ua(o.errors)}class cl{constructor(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!sl(o.expression),this.globalStateRefs=dl(o.expression)}evaluateWithoutErrorHandling(n,o,u,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,f,_,y)}evaluate(n,o,u,f,_,y){return this._styleExpression.evaluate(n,o,u,f,_,y)}}class Dh{constructor(n,o,u,f){this.kind=n,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!sl(o.expression),this.globalStateRefs=dl(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(n,o,u,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,f,_,y)}evaluate(n,o,u,f,_,y){return this._styleExpression.evaluate(n,o,u,f,_,y)}interpolationFactor(n,o,u){return this.interpolationType?Qn.interpolationFactor(this.interpolationType,n,o,u):0}}function ap(a,n){let o=ll(a,n);if(o.result==="error")return o;let u=o.value.expression,f=wc(u);if(!f&&!No(n))return ua([new hn("","data expressions not supported")]);let _=Mc(u,["zoom"]);if(!_&&!rp(n))return ua([new hn("","zoom expressions not supported")]);let y=hl(u);return y||_?y instanceof hn?ua([y]):y instanceof Qn&&!Ch(n)?ua([new hn("",'"interpolate" expressions cannot be used with this property')]):np(y?new Dh(f?"camera":"composite",o.value,y.labels,y instanceof Qn?y.interpolation:void 0):new cl(f?"constant":"source",o.value)):ua([new hn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ul{constructor(n,o){this._parameters=n,this._specification=o,sr(this,ip(this._parameters,this._specification))}static deserialize(n){return new ul(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function hl(a){let n=null;if(a instanceof Wa)n=hl(a.result);else if(a instanceof Qa){for(let o of a.args)if(n=hl(o),n)break}else(a instanceof yn||a instanceof Qn)&&a.input instanceof Yr&&a.input.name==="zoom"&&(n=a);return n instanceof hn||a.eachChild(o=>{let u=hl(o);u instanceof hn?n=u:!n&&u?n=new hn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&u&&n!==u&&(n=new hn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function dl(a,n=new Set){return a instanceof ol&&n.add(a.key),a.eachChild(o=>{dl(o,n)}),n}function Ec(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(let n of a.slice(1))if(!Ec(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}let Ah={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function gs(a){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ec(a)||(a=_s(a));let n=ll(a,Ah);if(n.result==="error")throw new Error(n.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,u,f)=>n.value.evaluate(o,u,{},f),needGeometry:Ic(a),getGlobalStateRefs:()=>dl(n.value.expression)}}function Rh(a,n){return a<n?-1:a>n?1:0}function Ic(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let n=1;n<a.length;n++)if(Ic(a[n]))return!0;return!1}function _s(a){if(!a)return!0;let n=a[0];return a.length<=1?n!=="any":n==="=="?kh(a[1],a[2],"=="):n==="!="?Tc(kh(a[1],a[2],"==")):n==="<"||n===">"||n==="<="||n===">="?kh(a[1],a[2],n):n==="any"?(o=a.slice(1),["any"].concat(o.map(_s))):n==="all"?["all"].concat(a.slice(1).map(_s)):n==="none"?["all"].concat(a.slice(1).map(_s).map(Tc)):n==="in"?lp(a[1],a.slice(2)):n==="!in"?Tc(lp(a[1],a.slice(2))):n==="has"?cp(a[1]):n!=="!has"||Tc(cp(a[1]));var o}function kh(a,n,o){switch(a){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,a,n]}}function lp(a,n){if(n.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",a,["literal",n.sort(Rh)]]:["filter-in-small",a,["literal",n]]}}function cp(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Tc(a){return["!",a]}function Nh(a){let n=typeof a;if(n==="number"||n==="boolean"||n==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let f="[";for(let _ of a)f+=`${Nh(_)},`;return`${f}]`}let o=Object.keys(a).sort(),u="{";for(let f=0;f<o.length;f++)u+=`${JSON.stringify(o[f])}:${Nh(a[o[f]])},`;return`${u}}`}function A_(a){let n="";for(let o of st)n+=`/${Nh(a[o])}`;return n}function Lh(a){let n=a.value;return n?[new Ne(a.key,n,"constants have been deprecated as of v8")]:[]}function dn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ui(a){if(Array.isArray(a))return a.map(Ui);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){let n={};for(let o in a)n[o]=Ui(a[o]);return n}return dn(a)}function Kr(a){let n=a.key,o=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},_=a.style,y=a.styleSpec,b=a.validateSpec,M=[],T=Et(o);if(T!=="object")return[new Ne(n,o,`object expected, ${T} found`)];for(let P in o){let A=P.split(".")[0],O=oa(u,A)||u["*"],z;if(oa(f,A))z=f[A];else if(oa(u,A))z=b;else if(f["*"])z=f["*"];else{if(!u["*"]){M.push(new Ne(n,o[P],`unknown property "${P}"`));continue}z=b}M=M.concat(z({key:(n&&`${n}.`)+P,value:o[P],valueSpec:O,style:_,styleSpec:y,object:o,objectKey:P,validateSpec:b},o))}for(let P in u)f[P]||u[P].required&&u[P].default===void 0&&o[P]===void 0&&M.push(new Ne(n,o,`missing required property "${P}"`));return M}function Cc(a){let n=a.value,o=a.valueSpec,u=a.style,f=a.styleSpec,_=a.key,y=a.arrayElementValidator||a.validateSpec;if(Et(n)!=="array")return[new Ne(_,n,`array expected, ${Et(n)} found`)];if(o.length&&n.length!==o.length)return[new Ne(_,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new Ne(_,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let b={type:o.value,values:o.values};f.$version<7&&(b.function=o.function),Et(o.value)==="object"&&(b=o.value);let M=[];for(let T=0;T<n.length;T++)M=M.concat(y({array:n,arrayIndex:T,value:n[T],valueSpec:b,validateSpec:a.validateSpec,style:u,styleSpec:f,key:`${_}[${T}]`}));return M}function fl(a){let n=a.key,o=a.value,u=a.valueSpec,f=Et(o);return f==="number"&&o!=o&&(f="NaN"),f!=="number"?[new Ne(n,o,`number expected, ${f} found`)]:"minimum"in u&&o<u.minimum?[new Ne(n,o,`${o} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&o>u.maximum?[new Ne(n,o,`${o} is greater than the maximum value ${u.maximum}`)]:[]}function up(a){let n=a.valueSpec,o=dn(a.value.type),u,f,_,y={},b=o!=="categorical"&&a.value.property===void 0,M=!b,T=Et(a.value.stops)==="array"&&Et(a.value.stops[0])==="array"&&Et(a.value.stops[0][0])==="object",P=Kr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(z){if(o==="identity")return[new Ne(z.key,z.value,'identity function may not have a "stops" property')];let j=[],G=z.value;return j=j.concat(Cc({key:z.key,value:G,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:A})),Et(G)==="array"&&G.length===0&&j.push(new Ne(z.key,G,"array must have at least one stop")),j},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:n,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return o==="identity"&&b&&P.push(new Ne(a.key,a.value,'missing required property "property"')),o==="identity"||a.value.stops||P.push(new Ne(a.key,a.value,'missing required property "stops"')),o==="exponential"&&a.valueSpec.expression&&!Ch(a.valueSpec)&&P.push(new Ne(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(M&&!No(a.valueSpec)?P.push(new Ne(a.key,a.value,"property functions not supported")):b&&!rp(a.valueSpec)&&P.push(new Ne(a.key,a.value,"zoom functions not supported"))),o!=="categorical"&&!T||a.value.property!==void 0||P.push(new Ne(a.key,a.value,'"property" property is required')),P;function A(z){let j=[],G=z.value,Z=z.key;if(Et(G)!=="array")return[new Ne(Z,G,`array expected, ${Et(G)} found`)];if(G.length!==2)return[new Ne(Z,G,`array length 2 expected, length ${G.length} found`)];if(T){if(Et(G[0])!=="object")return[new Ne(Z,G,`object expected, ${Et(G[0])} found`)];if(G[0].zoom===void 0)return[new Ne(Z,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Ne(Z,G,"object stop key must have value")];if(_&&_>dn(G[0].zoom))return[new Ne(Z,G[0].zoom,"stop zoom values must appear in ascending order")];dn(G[0].zoom)!==_&&(_=dn(G[0].zoom),f=void 0,y={}),j=j.concat(Kr({key:`${Z}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:fl,value:O}}))}else j=j.concat(O({key:`${Z}[0]`,value:G[0],validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},G));return Sc(Ui(G[1]))?j.concat([new Ne(`${Z}[1]`,G[1],"expressions are not allowed in function stops.")]):j.concat(z.validateSpec({key:`${Z}[1]`,value:G[1],valueSpec:n,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function O(z,j){let G=Et(z.value),Z=dn(z.value),K=z.value!==null?z.value:j;if(u){if(G!==u)return[new Ne(z.key,K,`${G} stop domain type must match previous stop domain type ${u}`)]}else u=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new Ne(z.key,K,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&o!=="categorical"){let ce=`number expected, ${G} found`;return No(n)&&o===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ne(z.key,K,ce)]}return o!=="categorical"||G!=="number"||isFinite(Z)&&Math.floor(Z)===Z?o!=="categorical"&&G==="number"&&f!==void 0&&Z<f?[new Ne(z.key,K,"stop domain values must appear in ascending order")]:(f=Z,o==="categorical"&&Z in y?[new Ne(z.key,K,"stop domain values must be unique")]:(y[Z]=!0,[])):[new Ne(z.key,K,`integer expected, found ${Z}`)]}}function ys(a){let n=(a.expressionContext==="property"?ap:ll)(Ui(a.value),a.valueSpec);if(n.result==="error")return n.value.map(u=>new Ne(`${a.key}${u.key}`,a.value,u.message));let o=n.value.expression||n.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!o.outputDefined())return[new Ne(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!sl(o))return[new Ne(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!sl(o))return[new Ne(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Mc(o,["zoom","feature-state"]))return[new Ne(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!wc(o))return[new Ne(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pc(a){let n=a.key,o=a.value,u=Et(o);return u!=="string"?[new Ne(n,o,`color expected, ${u} found`)]:bt.parse(String(o))?[]:[new Ne(n,o,`color expected, "${o}" found`)]}function to(a){let n=a.key,o=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?u.values.indexOf(dn(o))===-1&&f.push(new Ne(n,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(dn(o))===-1&&f.push(new Ne(n,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),f}function Oh(a){return Ec(Ui(a.value))?ys(sr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hp(a)}function hp(a){let n=a.value,o=a.key;if(Et(n)!=="array")return[new Ne(o,n,`array expected, ${Et(n)} found`)];let u=a.styleSpec,f,_=[];if(n.length<1)return[new Ne(o,n,"filter array must have at least 1 element")];switch(_=_.concat(to({key:`${o}[0]`,value:n[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),dn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&dn(n[1])==="$type"&&_.push(new Ne(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&_.push(new Ne(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(f=Et(n[1]),f!=="string"&&_.push(new Ne(`${o}[1]`,n[1],`string expected, ${f} found`)));for(let y=2;y<n.length;y++)f=Et(n[y]),dn(n[1])==="$type"?_=_.concat(to({key:`${o}[${y}]`,value:n[y],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&_.push(new Ne(`${o}[${y}]`,n[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<n.length;y++)_=_.concat(hp({key:`${o}[${y}]`,value:n[y],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Et(n[1]),n.length!==2?_.push(new Ne(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):f!=="string"&&_.push(new Ne(`${o}[1]`,n[1],`string expected, ${f} found`))}return _}function dp(a,n){let o=a.key,u=a.validateSpec,f=a.style,_=a.styleSpec,y=a.value,b=a.objectKey,M=_[`${n}_${a.layerType}`];if(!M)return[];let T=b.match(/^(.*)-transition$/);if(n==="paint"&&T&&M[T[1]]&&M[T[1]].transition)return u({key:o,value:y,valueSpec:_.transition,style:f,styleSpec:_});let P=a.valueSpec||M[b];if(!P)return[new Ne(o,y,`unknown property "${b}"`)];let A;if(Et(y)==="string"&&No(P)&&!P.tokens&&(A=/^{([^}]+)}$/.exec(y)))return[new Ne(o,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];let O=[];return a.layerType==="symbol"&&(b==="text-field"&&f&&!f.glyphs&&O.push(new Ne(o,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&al(Ui(y))&&dn(y.type)==="identity"&&O.push(new Ne(o,y,'"text-font" does not support identity functions'))),O.concat(u({key:a.key,value:y,valueSpec:P,style:f,styleSpec:_,expressionContext:"property",propertyType:n,propertyKey:b}))}function fp(a){return dp(a,"paint")}function pp(a){return dp(a,"layout")}function mp(a){let n=[],o=a.value,u=a.key,f=a.style,_=a.styleSpec;if(Et(o)!=="object")return[new Ne(u,o,`object expected, ${Et(o)} found`)];o.type||o.ref||n.push(new Ne(u,o,'either "type" or "ref" is required'));let y=dn(o.type),b=dn(o.ref);if(o.id){let M=dn(o.id);for(let T=0;T<a.arrayIndex;T++){let P=f.layers[T];dn(P.id)===M&&n.push(new Ne(u,o.id,`duplicate layer id "${o.id}", previously used at line ${P.id.__line__}`))}}if("ref"in o){let M;["type","source","source-layer","filter","layout"].forEach(T=>{T in o&&n.push(new Ne(u,o[T],`"${T}" is prohibited for ref layers`))}),f.layers.forEach(T=>{dn(T.id)===b&&(M=T)}),M?M.ref?n.push(new Ne(u,o.ref,"ref cannot reference another ref layer")):y=dn(M.type):n.push(new Ne(u,o.ref,`ref layer "${b}" not found`))}else if(y!=="background")if(o.source){let M=f.sources&&f.sources[o.source],T=M&&dn(M.type);M?T==="vector"&&y==="raster"?n.push(new Ne(u,o.source,`layer "${o.id}" requires a raster source`)):T!=="raster-dem"&&y==="hillshade"||T!=="raster-dem"&&y==="color-relief"?n.push(new Ne(u,o.source,`layer "${o.id}" requires a raster-dem source`)):T==="raster"&&y!=="raster"?n.push(new Ne(u,o.source,`layer "${o.id}" requires a vector source`)):T!=="vector"||o["source-layer"]?T==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?n.push(new Ne(u,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!o.paint||!o.paint["line-gradient"]||T==="geojson"&&M.lineMetrics||n.push(new Ne(u,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Ne(u,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new Ne(u,o.source,`source "${o.source}" not found`))}else n.push(new Ne(u,o,'missing required property "source"'));return n=n.concat(Kr({key:u,value:o,valueSpec:_.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${u}.type`,value:o.type,valueSpec:_.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:o,objectKey:"type"}),filter:Oh,layout:M=>Kr({layer:o,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":T=>pp(sr({layerType:y},T))}}),paint:M=>Kr({layer:o,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":T=>fp(sr({layerType:y},T))}})}})),n}function mi(a){let n=a.value,o=a.key,u=Et(n);return u!=="string"?[new Ne(o,n,`string expected, ${u} found`)]:[]}let ha={promoteId:function({key:a,value:n}){if(Et(n)==="string")return mi({key:a,value:n});{let o=[];for(let u in n)o.push(...mi({key:`${a}.${u}`,value:n[u]}));return o}}};function Pr(a){let n=a.value,o=a.key,u=a.styleSpec,f=a.style,_=a.validateSpec;if(!n.type)return[new Ne(o,n,'"type" is required')];let y=dn(n.type),b;switch(y){case"vector":case"raster":return b=Kr({key:o,value:n,valueSpec:u[`source_${y.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:ha,validateSpec:_}),b;case"raster-dem":return b=function(M){var T;let P=(T=M.sourceName)!==null&&T!==void 0?T:"",A=M.value,O=M.styleSpec,z=O.source_raster_dem,j=M.style,G=[],Z=Et(A);if(A===void 0)return G;if(Z!=="object")return G.push(new Ne("source_raster_dem",A,`object expected, ${Z} found`)),G;let K=dn(A.encoding)==="custom",ce=["redFactor","greenFactor","blueFactor","baseShift"],re=M.value.encoding?`"${M.value.encoding}"`:"Default";for(let se in A)!K&&ce.includes(se)?G.push(new Ne(se,A[se],`In "${P}": "${se}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):z[se]?G=G.concat(M.validateSpec({key:se,value:A[se],valueSpec:z[se],validateSpec:M.validateSpec,style:j,styleSpec:O})):G.push(new Ne(se,A[se],`unknown property "${se}"`));return G}({sourceName:o,value:n,style:a.style,styleSpec:u,validateSpec:_}),b;case"geojson":if(b=Kr({key:o,value:n,valueSpec:u.source_geojson,style:f,styleSpec:u,validateSpec:_,objectElementValidators:ha}),n.cluster)for(let M in n.clusterProperties){let[T,P]=n.clusterProperties[M],A=typeof T=="string"?[T,["accumulated"],["get",M]]:T;b.push(...ys({key:`${o}.${M}.map`,value:P,expressionContext:"cluster-map"})),b.push(...ys({key:`${o}.${M}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return b;case"video":return Kr({key:o,value:n,valueSpec:u.source_video,style:f,validateSpec:_,styleSpec:u});case"image":return Kr({key:o,value:n,valueSpec:u.source_image,style:f,validateSpec:_,styleSpec:u});case"canvas":return[new Ne(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return to({key:`${o}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function da(a){let n=a.value,o=a.styleSpec,u=o.light,f=a.style,_=[],y=Et(n);if(n===void 0)return _;if(y!=="object")return _=_.concat([new Ne("light",n,`object expected, ${y} found`)]),_;for(let b in n){let M=b.match(/^(.*)-transition$/);_=_.concat(M&&u[M[1]]&&u[M[1]].transition?a.validateSpec({key:b,value:n[b],valueSpec:o.transition,validateSpec:a.validateSpec,style:f,styleSpec:o}):u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],validateSpec:a.validateSpec,style:f,styleSpec:o}):[new Ne(b,n[b],`unknown property "${b}"`)])}return _}function Fh(a){let n=a.value,o=a.styleSpec,u=o.sky,f=a.style,_=Et(n);if(n===void 0)return[];if(_!=="object")return[new Ne("sky",n,`object expected, ${_} found`)];let y=[];for(let b in n)y=y.concat(u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],style:f,styleSpec:o}):[new Ne(b,n[b],`unknown property "${b}"`)]);return y}function gp(a){let n=a.value,o=a.styleSpec,u=o.terrain,f=a.style,_=[],y=Et(n);if(n===void 0)return _;if(y!=="object")return _=_.concat([new Ne("terrain",n,`object expected, ${y} found`)]),_;for(let b in n)_=_.concat(u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],validateSpec:a.validateSpec,style:f,styleSpec:o}):[new Ne(b,n[b],`unknown property "${b}"`)]);return _}function _p(a){let n=[],o=a.value,u=a.key;if(Array.isArray(o)){let f=[],_=[];for(let y in o)o[y].id&&f.includes(o[y].id)&&n.push(new Ne(u,o,`all the sprites' ids must be unique, but ${o[y].id} is duplicated`)),f.push(o[y].id),o[y].url&&_.includes(o[y].url)&&n.push(new Ne(u,o,`all the sprites' URLs must be unique, but ${o[y].url} is duplicated`)),_.push(o[y].url),n=n.concat(Kr({key:`${u}[${y}]`,value:o[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return n}return mi({key:u,value:o})}function fa(a){return n=a.value,n&&n.constructor===Object?[]:[new Ne(a.key,a.value,`object expected, ${Et(a.value)} found`)];var n}let zh={"*":()=>[],array:Cc,boolean:function(a){let n=a.value,o=a.key,u=Et(n);return u!=="boolean"?[new Ne(o,n,`boolean expected, ${u} found`)]:[]},number:fl,color:Pc,constants:Lh,enum:to,filter:Oh,function:up,layer:mp,object:Kr,source:Pr,light:da,sky:Fh,terrain:gp,projection:function(a){let n=a.value,o=a.styleSpec,u=o.projection,f=a.style,_=Et(n);if(n===void 0)return[];if(_!=="object")return[new Ne("projection",n,`object expected, ${_} found`)];let y=[];for(let b in n)y=y.concat(u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],style:f,styleSpec:o}):[new Ne(b,n[b],`unknown property "${b}"`)]);return y},projectionDefinition:function(a){let n=a.key,o=a.value;o=o instanceof String?o.valueOf():o;let u=Et(o);return u!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(o)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(o)?["array","string"].includes(u)?[]:[new Ne(n,o,`projection expected, invalid type "${u}" found`)]:[new Ne(n,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:mi,formatted:function(a){return mi(a).length===0?[]:ys(a)},resolvedImage:function(a){return mi(a).length===0?[]:ys(a)},padding:function(a){let n=a.key,o=a.value;if(Et(o)==="array"){if(o.length<1||o.length>4)return[new Ne(n,o,`padding requires 1 to 4 values; ${o.length} values found`)];let u={type:"number"},f=[];for(let _=0;_<o.length;_++)f=f.concat(a.validateSpec({key:`${n}[${_}]`,value:o[_],validateSpec:a.validateSpec,valueSpec:u}));return f}return fl({key:n,value:o,valueSpec:{}})},numberArray:function(a){let n=a.key,o=a.value;if(Et(o)==="array"){let u={type:"number"};if(o.length<1)return[new Ne(n,o,"array length at least 1 expected, length 0 found")];let f=[];for(let _=0;_<o.length;_++)f=f.concat(a.validateSpec({key:`${n}[${_}]`,value:o[_],validateSpec:a.validateSpec,valueSpec:u}));return f}return fl({key:n,value:o,valueSpec:{}})},colorArray:function(a){let n=a.key,o=a.value;if(Et(o)==="array"){if(o.length<1)return[new Ne(n,o,"array length at least 1 expected, length 0 found")];let u=[];for(let f=0;f<o.length;f++)u=u.concat(Pc({key:`${n}[${f}]`,value:o[f]}));return u}return Pc({key:n,value:o})},variableAnchorOffsetCollection:function(a){let n=a.key,o=a.value,u=Et(o),f=a.styleSpec;if(u!=="array"||o.length<1||o.length%2!=0)return[new Ne(n,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let y=0;y<o.length;y+=2)_=_.concat(to({key:`${n}[${y}]`,value:o[y],valueSpec:f.layout_symbol["text-anchor"]})),_=_.concat(Cc({key:`${n}[${y+1}]`,value:o[y+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:f}));return _},sprite:_p,state:fa};function pa(a){let n=a.value,o=a.valueSpec,u=a.styleSpec;return a.validateSpec=pa,o.expression&&al(dn(n))?up(a):o.expression&&Sc(Ui(n))?ys(a):o.type&&zh[o.type]?zh[o.type](a):Kr(sr({},a,{valueSpec:o.type?u[o.type]:o}))}function yp(a){let n=a.value,o=a.key,u=mi(a);return u.length||(n.indexOf("{fontstack}")===-1&&u.push(new Ne(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&u.push(new Ne(o,n,'"glyphs" url must include a "{range}" token'))),u}function Dr(a,n=pe){let o=[];return o=o.concat(pa({key:"",value:a,valueSpec:n.$root,styleSpec:n,style:a,validateSpec:pa,objectElementValidators:{glyphs:yp,"*":()=>[]}})),a.constants&&(o=o.concat(Lh({key:"constants",value:a.constants}))),ma(o)}function gi(a){return function(n){return a(un(Je({},n),{validateSpec:pa}))}}function ma(a){return[].concat(a).sort((n,o)=>n.line-o.line)}function _i(a){return function(...n){return ma(a.apply(this,n))}}Dr.source=_i(gi(Pr)),Dr.sprite=_i(gi(_p)),Dr.glyphs=_i(gi(yp)),Dr.light=_i(gi(da)),Dr.sky=_i(gi(Fh)),Dr.terrain=_i(gi(gp)),Dr.state=_i(gi(fa)),Dr.layer=_i(gi(mp)),Dr.filter=_i(gi(Oh)),Dr.paintProperty=_i(gi(fp)),Dr.layoutProperty=_i(gi(pp));let ga=Dr,R_=ga.light,pl=ga.sky,k_=ga.paintProperty,N_=ga.layoutProperty;function ml(a,n){let o=!1;if(n&&n.length)for(let u of n)a.fire(new Te(new Error(u.message))),o=!0;return o}class gl{constructor(n,o,u){let f=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;let y=new Int32Array(this.arrayBuffer);n=y[0],this.d=(o=y[1])+2*(u=y[2]);for(let M=0;M<this.d*this.d;M++){let T=y[3+M],P=y[3+M+1];f.push(T===P?null:y.subarray(T,P))}let b=y[3+f.length+1];this.keys=y.subarray(y[3+f.length],b),this.bboxes=y.subarray(b),this.insert=this._insertReadonly}else{this.d=o+2*u;for(let y=0;y<this.d*this.d;y++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=n,this.padding=u,this.scale=o/n,this.uid=0;let _=u/o*n;this.min=-_,this.max=n+_}insert(n,o,u,f,_){this._forEachCell(o,u,f,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,o,u,f,_,y){this.cells[_].push(y)}query(n,o,u,f,_){let y=this.min,b=this.max;if(n<=y&&o<=y&&b<=u&&b<=f&&!_)return Array.prototype.slice.call(this.keys);{let M=[];return this._forEachCell(n,o,u,f,this._queryCell,M,{},_),M}}_queryCell(n,o,u,f,_,y,b,M){let T=this.cells[_];if(T!==null){let P=this.keys,A=this.bboxes;for(let O=0;O<T.length;O++){let z=T[O];if(b[z]===void 0){let j=4*z;(M?M(A[j+0],A[j+1],A[j+2],A[j+3]):n<=A[j+2]&&o<=A[j+3]&&u>=A[j+0]&&f>=A[j+1])?(b[z]=!0,y.push(P[z])):b[z]=!1}}}}_forEachCell(n,o,u,f,_,y,b,M){let T=this._convertToCellCoord(n),P=this._convertToCellCoord(o),A=this._convertToCellCoord(u),O=this._convertToCellCoord(f);for(let z=T;z<=A;z++)for(let j=P;j<=O;j++){let G=this.d*j+z;if((!M||M(this._convertFromCellCoord(z),this._convertFromCellCoord(j),this._convertFromCellCoord(z+1),this._convertFromCellCoord(j+1)))&&_.call(this,n,o,u,f,G,y,b,M))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let n=this.cells,o=3+this.cells.length+1+1,u=0;for(let y=0;y<this.cells.length;y++)u+=this.cells[y].length;let f=new Int32Array(o+u+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let _=o;for(let y=0;y<n.length;y++){let b=n[y];f[3+y]=_,f.set(b,_),_+=b.length}return f[3+n.length]=_,f.set(this.keys,_),_+=this.keys.length,f[3+n.length+1]=_,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer}static serialize(n,o){let u=n.toArrayBuffer();return o&&o.push(u),{buffer:u}}static deserialize(n){return new gl(n.buffer)}}let yi={};function $e(a,n,o={}){if(yi[a])throw new Error(`${a} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:a,writeable:!1}),yi[a]={klass:n,omit:o.omit||[],shallow:o.shallow||[]}}$e("Object",Object),$e("Set",Set),$e("TransferableGridIndex",gl),$e("Color",bt),$e("Error",Error),$e("AJAXError",te),$e("ResolvedImage",zr),$e("StylePropertyFunction",ul),$e("StyleExpression",Ph,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Dh),$e("ZoomConstantExpression",cl),$e("CompoundExpression",Yr,{omit:["_evaluate"]});for(let a in ca)ca[a]._classRegistryKey||$e(`Expression_${a}`,ca[a]);function jh(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Dc(a){return a.$name||a.constructor._classRegistryKey}function Bh(a){return!function(n){if(n===null||typeof n!="object")return!1;let o=Dc(n);return!(!o||o==="Object")}(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||jh(a)||Li(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function _a(a,n){if(Bh(a))return(jh(a)||Li(a))&&n&&n.push(a),ArrayBuffer.isView(a)&&n&&n.push(a.buffer),a instanceof ImageData&&n&&n.push(a.data.buffer),a;if(Array.isArray(a)){let _=[];for(let y of a)_.push(_a(y,n));return _}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);let o=Dc(a);if(!o)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!yi[o])throw new Error(`${o} is not registered.`);let{klass:u}=yi[o],f=u.serialize?u.serialize(a,n):{};if(u.serialize){if(n&&f===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let _ in a){if(!a.hasOwnProperty(_)||yi[o].omit.indexOf(_)>=0)continue;let y=a[_];f[_]=yi[o].shallow.indexOf(_)>=0?y:_a(y,n)}a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(f.$name=o),f}function vs(a){if(Bh(a))return a;if(Array.isArray(a))return a.map(vs);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);let n=Dc(a)||"Object";if(!yi[n])throw new Error(`can't deserialize unregistered class ${n}`);let{klass:o}=yi[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(a);let u=Object.create(o.prototype);for(let f of Object.keys(a)){if(f==="$name")continue;let _=a[f];u[f]=yi[n].shallow.indexOf(f)>=0?_:vs(_)}return u}class Ac{constructor(){this.first=!0}update(n,o){let u=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=u,!0))}}let Pt={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Rc(a){for(let n of a)if(Vh(n.charCodeAt(0)))return!0;return!1}function L_(a){for(let n of a)if(!vp(n.charCodeAt(0)))return!1;return!0}function kc(a){let n=a.map(o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}}).filter(o=>o);return new RegExp(n.join("|"),"u")}let O_=kc(["Arab","Dupl","Mong","Ougr","Syrc"]);function vp(a){return!O_.test(String.fromCodePoint(a))}let Uh=kc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Vh(a){return!(a!==746&&a!==747&&(a<4352||!(Pt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Pt["CJK Compatibility"](a)||Pt["CJK Strokes"](a)||!(!Pt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Pt["Enclosed CJK Letters and Months"](a)||Pt["Ideographic Description Characters"](a)||Pt.Kanbun(a)||Pt.Katakana(a)&&a!==12540||!(!Pt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Pt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Pt["Vertical Forms"](a)||Pt["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||Uh.test(String.fromCodePoint(a)))))}function xp(a){return!(Vh(a)||function(n){return!!(Pt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Pt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Pt["Letterlike Symbols"](n)||Pt["Number Forms"](n)||Pt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Pt["Control Pictures"](n)&&n!==9251||Pt["Optical Character Recognition"](n)||Pt["Enclosed Alphanumerics"](n)||Pt["Geometric Shapes"](n)||Pt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Pt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Pt["CJK Symbols and Punctuation"](n)||Pt.Katakana(n)||Pt["Private Use Area"](n)||Pt["CJK Compatibility Forms"](n)||Pt["Small Form Variants"](n)||Pt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(a))}let bp=kc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Gh(a){return bp.test(String.fromCodePoint(a))}function wp(a,n){return!(!n&&Gh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Pt.Khmer(a))}function Mp(a){for(let n of a)if(Gh(n.charCodeAt(0)))return!0;return!1}let vi=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(vi.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,n){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;let o=a.pluginURL,u=new Promise(_=>{this.loadScriptResolve=_});n(o);let f=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([u,f]),this.isParsed()){let _={pluginStatus:"loaded",pluginURL:o};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)})}};class an{constructor(n,o){this.zoom=n,o?(this.now=o.now||0,this.fadeDuration=o.fadeDuration||0,this.zoomHistory=o.zoomHistory||new Ac,this.transition=o.transition||{},this.globalState=o.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ac,this.transition={},this.globalState={})}isSupportedScript(n){return function(o,u){for(let f of o)if(!wp(f.charCodeAt(0),u))return!1;return!0}(n,vi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let n=this.zoom,o=n-Math.floor(n),u=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}}}class ya{constructor(n,o){this.property=n,this.value=o,this.expression=function(u,f){if(al(u))return new ul(u,f);if(Sc(u)){let _=ap(u,f);if(_.result==="error")throw new Error(_.value.map(y=>`${y.key}: ${y.message}`).join(", "));return _.value}{let _=u;return f.type==="color"&&typeof u=="string"?_=bt.parse(u):f.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?f.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?f.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?_=yr.parse(u):f.type==="projectionDefinition"&&typeof u=="string"&&(_=ar.parse(u)):_=Tn.parse(u):_=_r.parse(u):_=Bn.parse(u),{globalStateRefs:new Set,kind:"constant",evaluate:()=>_}}}(o===void 0?n.specification.default:o,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(n,o,u){return this.property.possiblyEvaluate(this,n,o,u)}}class $h{constructor(n){this.property=n,this.value=new ya(n,void 0)}transitioned(n,o){return new Hh(this.property,this.value,o,Xr({},n.transition,this.transition),n.now)}untransitioned(){return new Hh(this.property,this.value,null,{},0)}}class Sp{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Fr(this._values[n].value.value)}setValue(n,o){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new $h(this._values[n].property)),this._values[n].value=new ya(this._values[n].property,o===null?void 0:Fr(o))}getTransition(n){return Fr(this._values[n].transition)}setTransition(n,o){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new $h(this._values[n].property)),this._values[n].transition=Fr(o)||void 0}serialize(){let n={};for(let o of Object.keys(this._values)){let u=this.getValue(o);u!==void 0&&(n[o]=u);let f=this.getTransition(o);f!==void 0&&(n[`${o}-transition`]=f)}return n}transitioned(n,o){let u=new qh(this._properties);for(let f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(n,o._values[f]);return u}untransitioned(){let n=new qh(this._properties);for(let o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class Hh{constructor(n,o,u,f,_){this.property=n,this.value=o,this.begin=_+f.delay||0,this.end=this.begin+f.duration||0,n.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(n,o,u){let f=n.now||0,_=this.value.possiblyEvaluate(n,o,u),y=this.prior;if(y){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return y.possiblyEvaluate(n,o,u);{let b=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,o,u),_,ki(b))}}return _}}class qh{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,u){let f=new Nc(this._properties);for(let _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(n,o,u);return f}hasTransition(){for(let n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Ep{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return Fr(this._values[n].value)}setValue(n,o){this._values[n]=new ya(this._values[n].property,o===null?void 0:Fr(o))}serialize(){let n={};for(let o of Object.keys(this._values)){let u=this.getValue(o);u!==void 0&&(n[o]=u)}return n}possiblyEvaluate(n,o,u){let f=new Nc(this._properties);for(let _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(n,o,u);return f}}class Vi{constructor(n,o,u){this.property=n,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,u,f){return this.property.evaluate(this.value,this.parameters,n,o,u,f)}}class Nc{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Ye{constructor(n){this.specification=n}possiblyEvaluate(n,o){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(o)}interpolate(n,o,u){let f=Bi[this.specification.type];return f?f(n,o,u):n}}class tt{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,u,f){return new Vi(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},u,f)}:n.expression,o)}interpolate(n,o,u){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new Vi(this,{kind:"constant",value:void 0},n.parameters);let f=Bi[this.specification.type];if(f){let _=f(n.value.value,o.value.value,u);return new Vi(this,{kind:"constant",value:_},n.parameters)}return n}evaluate(n,o,u,f,_,y){return n.kind==="constant"?n.value:n.evaluate(o,u,f,_,y)}}class Lc extends tt{possiblyEvaluate(n,o,u,f){if(n.value===void 0)return new Vi(this,{kind:"constant",value:void 0},o);if(n.expression.kind==="constant"){let _=n.expression.evaluate(o,null,{},u,f),y=n.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(y,y,y,o);return new Vi(this,{kind:"constant",value:b},o)}if(n.expression.kind==="camera"){let _=this._calculate(n.expression.evaluate({zoom:o.zoom-1}),n.expression.evaluate({zoom:o.zoom}),n.expression.evaluate({zoom:o.zoom+1}),o);return new Vi(this,{kind:"constant",value:_},o)}return new Vi(this,n.expression,o)}evaluate(n,o,u,f,_,y){if(n.kind==="source"){let b=n.evaluate(o,u,f,_,y);return this._calculate(b,b,b,o)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(o.zoom)-1},u,f),n.evaluate({zoom:Math.floor(o.zoom)},u,f),n.evaluate({zoom:Math.floor(o.zoom)+1},u,f),o):n.value}_calculate(n,o,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:u,to:o}}interpolate(n){return n}}class Oo{constructor(n){this.specification=n}possiblyEvaluate(n,o,u,f){if(n.value!==void 0){if(n.expression.kind==="constant"){let _=n.expression.evaluate(o,null,{},u,f);return this._calculate(_,_,_,o)}return this._calculate(n.expression.evaluate(new an(Math.floor(o.zoom-1),o)),n.expression.evaluate(new an(Math.floor(o.zoom),o)),n.expression.evaluate(new an(Math.floor(o.zoom+1),o)),o)}}_calculate(n,o,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:u,to:o}}interpolate(n){return n}}class Oc{constructor(n){this.specification=n}possiblyEvaluate(n,o,u,f){return!!n.expression.evaluate(o,null,{},u,f)}interpolate(){return!1}}class vr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let o in n){let u=n[o];u.specification.overridable&&this.overridableProperties.push(o);let f=this.defaultPropertyValues[o]=new ya(u,void 0),_=this.defaultTransitionablePropertyValues[o]=new $h(u);this.defaultTransitioningPropertyValues[o]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=f.possiblyEvaluate({})}}}$e("DataDrivenProperty",tt),$e("DataConstantProperty",Ye),$e("CrossFadedDataDrivenProperty",Lc),$e("CrossFadedProperty",Oo),$e("ColorRampProperty",Oc);let Ip="-transition";class Qr extends Xe{constructor(n,o){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter,this._featureFilter=gs(n.filter)),o.layout&&(this._unevaluatedLayout=new Ep(o.layout)),o.paint)){this._transitionablePaint=new Sp(o.paint);for(let u in n.paint)this.setPaintProperty(u,n.paint[u],{validate:!1});for(let u in n.layout)this.setLayoutProperty(u,n.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nc(o.paint)}}setFilter(n){this.filter=n,this._featureFilter=gs(n)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}getLayoutAffectingGlobalStateRefs(){let n=new Set;if(this._unevaluatedLayout)for(let o in this._unevaluatedLayout._values){let u=this._unevaluatedLayout._values[o];for(let f of u.getGlobalStateRefs())n.add(f)}for(let o of this._featureFilter.getGlobalStateRefs())n.add(o);return n}setLayoutProperty(n,o,u={}){o!=null&&this._validate(N_,`layers.${this.id}.layout.${n}`,n,o,u)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,o):this.visibility=o)}getPaintProperty(n){return n.endsWith(Ip)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o,u={}){if(o!=null&&this._validate(k_,`layers.${this.id}.paint.${n}`,n,o,u))return!1;if(n.endsWith(Ip))return this._transitionablePaint.setTransition(n.slice(0,-11),o||void 0),!1;{let f=this._transitionablePaint._values[n],_=f.property.specification["property-type"]==="cross-faded-data-driven",y=f.value.isDataDriven(),b=f.value;this._transitionablePaint.setValue(n,o),this._handleSpecialPaintPropertyUpdate(n);let M=this._transitionablePaint._values[n].value;return M.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(n,b,M)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,o,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){let n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Ks(n,(o,u)=>!(o===void 0||u==="layout"&&!Object.keys(o).length||u==="paint"&&!Object.keys(o).length))}_validate(n,o,u,f,_={}){return(!_||_.validate!==!1)&&ml(this,n.call(ga,{key:o,layerType:this.type,objectKey:u,value:f,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let n in this.paint._values){let o=this.paint.get(n);if(o instanceof Vi&&No(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}let F_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _l{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){let o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function vn(a,n=1){let o=0,u=0;return{members:a.map(f=>{let _=F_[f.type].BYTES_PER_ELEMENT,y=o=Fc(o,Math.max(n,_)),b=f.components||1;return u=Math.max(u,_),o+=_*b,{name:f.name,type:f.type,components:b,offset:y}}),size:Fc(o,Math.max(u,n)),alignment:n}}function Fc(a,n){return Math.ceil(a/n)*n}class va extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){let u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){let f=2*n;return this.int16[f+0]=o,this.int16[f+1]=u,n}}va.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",va);class xa extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){let _=3*n;return this.int16[_+0]=o,this.int16[_+1]=u,this.int16[_+2]=f,n}}xa.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",xa);class Zh extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f){let _=this.length;return this.resize(_+1),this.emplace(_,n,o,u,f)}emplace(n,o,u,f,_){let y=4*n;return this.int16[y+0]=o,this.int16[y+1]=u,this.int16[y+2]=f,this.int16[y+3]=_,n}}Zh.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",Zh);class ba extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,n,o,u,f,_,y)}emplace(n,o,u,f,_,y,b){let M=6*n;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=f,this.int16[M+3]=_,this.int16[M+4]=y,this.int16[M+5]=b,n}}ba.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",ba);class xs extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,n,o,u,f,_,y)}emplace(n,o,u,f,_,y,b){let M=4*n,T=8*n;return this.int16[M+0]=o,this.int16[M+1]=u,this.uint8[T+4]=f,this.uint8[T+5]=_,this.uint8[T+6]=y,this.uint8[T+7]=b,n}}xs.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",xs);class yl extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){let u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){let f=2*n;return this.float32[f+0]=o,this.float32[f+1]=u,n}}yl.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",yl);class zc extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y,b,M,T,P){let A=this.length;return this.resize(A+1),this.emplace(A,n,o,u,f,_,y,b,M,T,P)}emplace(n,o,u,f,_,y,b,M,T,P,A){let O=10*n;return this.uint16[O+0]=o,this.uint16[O+1]=u,this.uint16[O+2]=f,this.uint16[O+3]=_,this.uint16[O+4]=y,this.uint16[O+5]=b,this.uint16[O+6]=M,this.uint16[O+7]=T,this.uint16[O+8]=P,this.uint16[O+9]=A,n}}zc.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",zc);class bs extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y,b,M,T,P,A,O){let z=this.length;return this.resize(z+1),this.emplace(z,n,o,u,f,_,y,b,M,T,P,A,O)}emplace(n,o,u,f,_,y,b,M,T,P,A,O,z){let j=12*n;return this.int16[j+0]=o,this.int16[j+1]=u,this.int16[j+2]=f,this.int16[j+3]=_,this.uint16[j+4]=y,this.uint16[j+5]=b,this.uint16[j+6]=M,this.uint16[j+7]=T,this.int16[j+8]=P,this.int16[j+9]=A,this.int16[j+10]=O,this.int16[j+11]=z,n}}bs.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",bs);class Wh extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){let _=3*n;return this.float32[_+0]=o,this.float32[_+1]=u,this.float32[_+2]=f,n}}Wh.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",Wh);class Xh extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){let o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}Xh.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",Xh);class jc extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y,b,M,T){let P=this.length;return this.resize(P+1),this.emplace(P,n,o,u,f,_,y,b,M,T)}emplace(n,o,u,f,_,y,b,M,T,P){let A=10*n,O=5*n;return this.int16[A+0]=o,this.int16[A+1]=u,this.int16[A+2]=f,this.int16[A+3]=_,this.int16[A+4]=y,this.int16[A+5]=b,this.uint32[O+3]=M,this.uint16[A+8]=T,this.uint16[A+9]=P,n}}jc.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",jc);class Yh extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,n,o,u,f,_,y)}emplace(n,o,u,f,_,y,b){let M=6*n;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=f,this.int16[M+3]=_,this.int16[M+4]=y,this.int16[M+5]=b,n}}Yh.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",Yh);class m extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,n,o,u,f,_)}emplace(n,o,u,f,_,y){let b=4*n,M=8*n;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=f,this.int16[M+6]=_,this.int16[M+7]=y,n}}m.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",m);class e extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,n,o,u,f,_,y)}emplace(n,o,u,f,_,y,b){let M=16*n,T=4*n,P=8*n;return this.uint8[M+0]=o,this.uint8[M+1]=u,this.float32[T+1]=f,this.float32[T+2]=_,this.int16[P+6]=y,this.int16[P+7]=b,n}}e.prototype.bytesPerElement=16,$e("StructArrayLayout2ub2f2i16",e);class l extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){let _=3*n;return this.uint16[_+0]=o,this.uint16[_+1]=u,this.uint16[_+2]=f,n}}l.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",l);class d extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y,b,M,T,P,A,O,z,j,G,Z,K){let ce=this.length;return this.resize(ce+1),this.emplace(ce,n,o,u,f,_,y,b,M,T,P,A,O,z,j,G,Z,K)}emplace(n,o,u,f,_,y,b,M,T,P,A,O,z,j,G,Z,K,ce){let re=24*n,se=12*n,ye=48*n;return this.int16[re+0]=o,this.int16[re+1]=u,this.uint16[re+2]=f,this.uint16[re+3]=_,this.uint32[se+2]=y,this.uint32[se+3]=b,this.uint32[se+4]=M,this.uint16[re+10]=T,this.uint16[re+11]=P,this.uint16[re+12]=A,this.float32[se+7]=O,this.float32[se+8]=z,this.uint8[ye+36]=j,this.uint8[ye+37]=G,this.uint8[ye+38]=Z,this.uint32[se+10]=K,this.int16[re+22]=ce,n}}d.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",d);class p extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,_,y,b,M,T,P,A,O,z,j,G,Z,K,ce,re,se,ye,we,De,Ve,Le,Be,Ke,je){let Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,n,o,u,f,_,y,b,M,T,P,A,O,z,j,G,Z,K,ce,re,se,ye,we,De,Ve,Le,Be,Ke,je)}emplace(n,o,u,f,_,y,b,M,T,P,A,O,z,j,G,Z,K,ce,re,se,ye,we,De,Ve,Le,Be,Ke,je,Ue){let Ie=32*n,rt=16*n;return this.int16[Ie+0]=o,this.int16[Ie+1]=u,this.int16[Ie+2]=f,this.int16[Ie+3]=_,this.int16[Ie+4]=y,this.int16[Ie+5]=b,this.int16[Ie+6]=M,this.int16[Ie+7]=T,this.uint16[Ie+8]=P,this.uint16[Ie+9]=A,this.uint16[Ie+10]=O,this.uint16[Ie+11]=z,this.uint16[Ie+12]=j,this.uint16[Ie+13]=G,this.uint16[Ie+14]=Z,this.uint16[Ie+15]=K,this.uint16[Ie+16]=ce,this.uint16[Ie+17]=re,this.uint16[Ie+18]=se,this.uint16[Ie+19]=ye,this.uint16[Ie+20]=we,this.uint16[Ie+21]=De,this.uint16[Ie+22]=Ve,this.uint32[rt+12]=Le,this.float32[rt+13]=Be,this.float32[rt+14]=Ke,this.uint16[Ie+30]=je,this.uint16[Ie+31]=Ue,n}}p.prototype.bytesPerElement=64,$e("StructArrayLayout8i15ui1ul2f2ui64",p);class g extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){let o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}g.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",g);class x extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){let _=3*n;return this.uint16[6*n+0]=o,this.float32[_+1]=u,this.float32[_+2]=f,n}}x.prototype.bytesPerElement=12,$e("StructArrayLayout1ui2f12",x);class S extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){let _=4*n;return this.uint32[2*n+0]=o,this.uint16[_+2]=u,this.uint16[_+3]=f,n}}S.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",S);class E extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){let u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){let f=2*n;return this.uint16[f+0]=o,this.uint16[f+1]=u,n}}E.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",E);class C extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){let o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}C.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",C);class D extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f){let _=this.length;return this.resize(_+1),this.emplace(_,n,o,u,f)}emplace(n,o,u,f,_){let y=4*n;return this.float32[y+0]=o,this.float32[y+1]=u,this.float32[y+2]=f,this.float32[y+3]=_,n}}D.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",D);class k extends _l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}k.prototype.size=20;class R extends jc{get(n){return new k(this,n)}}$e("CollisionBoxArray",R);class F extends _l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}F.prototype.size=48;class U extends d{get(n){return new F(this,n)}}$e("PlacedSymbolArray",U);class X extends _l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}X.prototype.size=64;class W extends p{get(n){return new X(this,n)}}$e("SymbolInstanceArray",W);class Y extends g{getoffsetX(n){return this.float32[1*n+0]}}$e("GlyphOffsetArray",Y);class Q extends xa{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}$e("SymbolLineVertexArray",Q);class ne extends _l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ne.prototype.size=12;class J extends x{get(n){return new ne(this,n)}}$e("TextAnchorOffsetArray",J);class oe extends _l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}oe.prototype.size=8;class ae extends S{get(n){return new oe(this,n)}}$e("FeatureIndexArray",ae);class ee extends va{}class de extends va{}class be extends va{}class ge extends ba{}class _e extends xs{}class xe extends yl{}class ke extends zc{}class Oe extends bs{}class Ce extends Wh{}class qe extends Xh{}class ft extends Yh{}class Ot extends e{}class Zt extends l{}class $t extends E{}let ln=vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:fn}=ln;class ht{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,o,u,f){let _=this.segments[this.segments.length-1];return n>ht.MAX_VERTEX_ARRAY_LENGTH&&bn(`Max vertices per segment is ${ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ht.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+n>ht.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f?this.createNewSegment(o,u,f):_}createNewSegment(n,o,u){let f={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return u!==void 0&&(f.sortKey=u),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(n,o,u){return this.prepareSegment(0,n,o,u)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let n of this.segments)for(let o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,u,f){return new ht([{vertexOffset:n,primitiveOffset:o,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}function Wt(a,n){return 256*(a=Tr(Math.floor(a),0,255))+Tr(Math.floor(n),0,255)}ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",ht);let Cn=vn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var On,Vn,xr,xi={exports:{}},Fo={exports:{}},zo={exports:{}},wa=function(){if(xr)return xi.exports;xr=1;var a=(On||(On=1,Fo.exports=function(o,u){var f,_,y,b,M,T,P,A;for(_=o.length-(f=3&o.length),y=u,M=3432918353,T=461845907,A=0;A<_;)P=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24,++A,y=27492+(65535&(b=5*(65535&(y=(y^=P=(65535&(P=(P=(65535&P)*M+(((P>>>16)*M&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(P=0,f){case 3:P^=(255&o.charCodeAt(A+2))<<16;case 2:P^=(255&o.charCodeAt(A+1))<<8;case 1:y^=P=(65535&(P=(P=(65535&(P^=255&o.charCodeAt(A)))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295}return y^=o.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Fo.exports),n=(Vn||(Vn=1,zo.exports=function(o,u){for(var f,_=o.length,y=u^_,b=0;_>=4;)f=1540483477*(65535&(f=255&o.charCodeAt(b)|(255&o.charCodeAt(++b))<<8|(255&o.charCodeAt(++b))<<16|(255&o.charCodeAt(++b))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),_-=4,++b;switch(_){case 3:y^=(255&o.charCodeAt(b+2))<<16;case 2:y^=(255&o.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&o.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),zo.exports);return xi.exports=a,xi.exports.murmur3=a,xi.exports.murmur2=n,xi.exports}(),Ma=w(wa);class ws{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,o,u,f){this.ids.push(Ms(n)),this.positions.push(o,u,f)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let o=Ms(n),u=0,f=this.ids.length-1;for(;u<f;){let y=u+f>>1;this.ids[y]>=o?f=y:u=y+1}let _=[];for(;this.ids[u]===o;)_.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return _}static serialize(n,o){let u=new Float64Array(n.ids),f=new Uint32Array(n.positions);return Ar(u,f,0,u.length-1),o&&o.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(n){let o=new ws;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o}}function Ms(a){let n=+a;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Ma(String(a))}function Ar(a,n,o,u){for(;o<u;){let f=a[o+u>>1],_=o-1,y=u+1;for(;;){do _++;while(a[_]<f);do y--;while(a[y]>f);if(_>=y)break;bi(a,_,y),bi(n,3*_,3*y),bi(n,3*_+1,3*y+1),bi(n,3*_+2,3*y+2)}y-o<u-y?(Ar(a,n,o,y),o=y+1):(Ar(a,n,y+1,u),u=y)}}function bi(a,n,o){let u=a[n];a[n]=a[o],a[o]=u}$e("FeaturePositionMap",ws);class br{constructor(n,o){this.gl=n.gl,this.location=o}}class jo extends br{constructor(n,o){super(n,o),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Pn extends br{constructor(n,o){super(n,o),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Fn extends br{constructor(n,o){super(n,o),this.current=bt.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}let Jr=new Float32Array(16);function Dn(a){return[Wt(255*a.r,255*a.g),Wt(255*a.b,255*a.a)]}class vl{constructor(n,o,u){this.value=n,this.uniformNames=o.map(f=>`u_${f}`),this.type=u}setUniform(n,o,u){n.set(u.constantOr(this.value))}getBinding(n,o,u){return this.type==="color"?new Fn(n,o):new jo(n,o)}}class Sa{constructor(n,o){this.uniformNames=o.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=n.tlbr}setUniform(n,o,u,f){let _=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&n.set(_)}getBinding(n,o,u){return u.substr(0,9)==="u_pattern"?new Pn(n,o):new jo(n,o)}}class no{constructor(n,o,u,f){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(_=>({name:`a_${_}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(n,o,u,f,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new an(0),o,{},f,[],_);this.paintVertexArray.resize(n),this._setPaintValue(y,n,b)}updatePaintArray(n,o,u,f){let _=this.expression.evaluate({zoom:0},u,f);this._setPaintValue(n,o,_)}_setPaintValue(n,o,u){if(this.type==="color"){let f=Dn(u);for(let _=n;_<o;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=n;f<o;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wi{constructor(n,o,u,f,_,y){this.expression=n,this.uniformNames=o.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=o.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,o,u,f,_){let y=this.expression.evaluate(new an(this.zoom),o,{},f,[],_),b=this.expression.evaluate(new an(this.zoom+1),o,{},f,[],_),M=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(M,n,y,b)}updatePaintArray(n,o,u,f){let _=this.expression.evaluate({zoom:this.zoom},u,f),y=this.expression.evaluate({zoom:this.zoom+1},u,f);this._setPaintValue(n,o,_,y)}_setPaintValue(n,o,u,f){if(this.type==="color"){let _=Dn(u),y=Dn(f);for(let b=n;b<o;b++)this.paintVertexArray.emplace(b,_[0],_[1],y[0],y[1])}else{for(let _=n;_<o;_++)this.paintVertexArray.emplace(_,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o){let u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,f=Tr(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(f)}getBinding(n,o,u){return new jo(n,o)}}class Bo{constructor(n,o,u,f,_,y){this.expression=n,this.type=o,this.useIntegerZoom=u,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(n,o,u){let f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(f,n,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(n,o,u,f,_){this._setPaintValues(n,o,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(n,o,u,f){if(!f||!u)return;let{min:_,mid:y,max:b}=u,M=f[_],T=f[y],P=f[b];if(M&&T&&P)for(let A=n;A<o;A++)this.zoomInPaintVertexArray.emplace(A,T.tl[0],T.tl[1],T.br[0],T.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],T.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,T.tl[0],T.tl[1],T.br[0],T.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],T.pixelRatio,P.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Cn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Cn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Tp{constructor(n,o,u){this.binders={},this._buffers=[];let f=[];for(let _ in n.paint._values){if(!u(_))continue;let y=n.paint.get(_);if(!(y instanceof Vi&&No(y.property.specification)))continue;let b=Cp(_,n.type),M=y.value,T=y.property.specification.type,P=y.property.useIntegerZoom,A=y.property.specification["property-type"],O=A==="cross-faded"||A==="cross-faded-data-driven";if(M.kind==="constant")this.binders[_]=O?new Sa(M.value,b):new vl(M.value,b,T),f.push(`/u_${_}`);else if(M.kind==="source"||O){let z=Kh(_,T,"source");this.binders[_]=O?new Bo(M,T,P,o,z,n.id):new no(M,b,T,z),f.push(`/a_${_}`)}else{let z=Kh(_,T,"composite");this.binders[_]=new wi(M,b,T,P,o,z),f.push(`/z_${_}`)}}this.cacheKey=f.sort().join("")}getMaxValue(n){let o=this.binders[n];return o instanceof no||o instanceof wi?o.maxValue:0}populatePaintArrays(n,o,u,f,_){for(let y in this.binders){let b=this.binders[y];(b instanceof no||b instanceof wi||b instanceof Bo)&&b.populatePaintArray(n,o,u,f,_)}}setConstantPatternPositions(n,o){for(let u in this.binders){let f=this.binders[u];f instanceof Sa&&f.setConstantPatternPositions(n,o)}}updatePaintArrays(n,o,u,f,_){let y=!1;for(let b in n){let M=o.getPositions(b);for(let T of M){let P=u.feature(T.index);for(let A in this.binders){let O=this.binders[A];if((O instanceof no||O instanceof wi||O instanceof Bo)&&O.expression.isStateDependent===!0){let z=f.paint.get(A);O.expression=z.value,O.updatePaintArray(T.start,T.end,P,n[b],_),y=!0}}}}return y}defines(){let n=[];for(let o in this.binders){let u=this.binders[o];(u instanceof vl||u instanceof Sa)&&n.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return n}getBinderAttributes(){let n=[];for(let o in this.binders){let u=this.binders[o];if(u instanceof no||u instanceof wi)for(let f=0;f<u.paintVertexAttributes.length;f++)n.push(u.paintVertexAttributes[f].name);else if(u instanceof Bo)for(let f=0;f<Cn.members.length;f++)n.push(Cn.members[f].name)}return n}getBinderUniforms(){let n=[];for(let o in this.binders){let u=this.binders[o];if(u instanceof vl||u instanceof Sa||u instanceof wi)for(let f of u.uniformNames)n.push(f)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,o){let u=[];for(let f in this.binders){let _=this.binders[f];if(_ instanceof vl||_ instanceof Sa||_ instanceof wi){for(let y of _.uniformNames)if(o[y]){let b=_.getBinding(n,o[y],y);u.push({name:y,property:f,binding:b})}}}return u}setUniforms(n,o,u,f){for(let{name:_,property:y,binding:b}of o)this.binders[y].setUniform(b,f,u.get(y),_)}updatePaintBuffers(n){this._buffers=[];for(let o in this.binders){let u=this.binders[o];if(n&&u instanceof Bo){let f=n.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(u instanceof no||u instanceof wi)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(n){for(let o in this.binders){let u=this.binders[o];(u instanceof no||u instanceof wi||u instanceof Bo)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(let n in this.binders){let o=this.binders[n];(o instanceof no||o instanceof wi||o instanceof Bo)&&o.destroy()}}}class Br{constructor(n,o,u=()=>!0){this.programConfigurations={};for(let f of n)this.programConfigurations[f.id]=new Tp(f,o,u);this.needsUpload=!1,this._featureMap=new ws,this._bufferOffset=0}populatePaintArrays(n,o,u,f,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(n,o,f,_,y);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,u,f){for(let _ of u)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(n,this._featureMap,o,_,f)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(let o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(let n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Cp(a,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${n}-`,"").replace(/-/g,"_")]}function Kh(a,n,o){let u={color:{source:yl,composite:D},number:{source:g,composite:yl}},f=function(_){return{"line-pattern":{source:ke,composite:ke},"fill-pattern":{source:ke,composite:ke},"fill-extrusion-pattern":{source:ke,composite:ke}}[_]}(a);return f&&f[o]||u[n][o]}$e("ConstantBinder",vl),$e("CrossFadedConstantBinder",Sa),$e("SourceExpressionBinder",no),$e("CrossFadedCompositeBinder",Bo),$e("CompositeExpressionBinder",wi),$e("ProgramConfiguration",Tp,{omit:["_buffers"]}),$e("ProgramConfigurationSet",Br);let Bc=Math.pow(2,14)-1,Uc=-Bc-1;function Uo(a){let n=Ht/a.extent,o=a.loadGeometry();for(let u=0;u<o.length;u++){let f=o[u];for(let _=0;_<f.length;_++){let y=f[_],b=Math.round(y.x*n),M=Math.round(y.y*n);y.x=Tr(b,Uc,Bc),y.y=Tr(M,Uc,Bc),(b<y.x||b>y.x+1||M<y.y||M>y.y+1)&&bn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function ro(a,n){return{type:a.type,id:a.id,properties:a.properties,geometry:n?Uo(a):[]}}let vb=-32768;function NC(a,n,o,u,f){a.emplaceBack(vb+8*n+u,vb+8*o+f)}class z_{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new de,this.indexArray=new Zt,this.segments=new ht,this.programConfigurations=new Br(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,u){let f=this.layers[0],_=[],y=null,b=!1,M=f.type==="heatmap";if(f.type==="circle"){let P=f;y=P.layout.get("circle-sort-key"),b=!y.isConstant(),M=M||P.paint.get("circle-pitch-alignment")==="map"}let T=M?o.subdivisionGranularity.circle:1;for(let{feature:P,id:A,index:O,sourceLayerIndex:z}of n){let j=this.layers[0]._featureFilter.needGeometry,G=ro(P,j);if(!this.layers[0]._featureFilter.filter(new an(this.zoom,{globalState:this.globalState}),G,u))continue;let Z=b?y.evaluate(G,{},u):void 0,K={id:A,properties:P.properties,type:P.type,sourceLayerIndex:z,index:O,geometry:j?G.geometry:Uo(P),patterns:{},sortKey:Z};_.push(K)}b&&_.sort((P,A)=>P.sortKey-A.sortKey);for(let P of _){let{geometry:A,index:O,sourceLayerIndex:z}=P,j=n[O].feature;this.addFeature(P,A,O,u,T),o.featureIndex.insert(j,A,O,z,this.index)}}update(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,fn),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,u,f,_=1){let y;switch(_){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}let b=y.length;for(let M of o)for(let T of M){let P=T.x,A=T.y;if(P<0||P>=Ht||A<0||A>=Ht)continue;let O=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,n.sortKey),z=O.vertexLength;for(let j=0;j<b;j++)for(let G=0;G<b;G++)NC(this.layoutVertexArray,P,A,y[G],y[j]);for(let j=0;j<b-1;j++)for(let G=0;G<b-1;G++){let Z=z+j*b+G,K=z+(j+1)*b+G;this.indexArray.emplaceBack(Z,K+1,Z+1),this.indexArray.emplaceBack(Z,K,K+1)}O.vertexLength+=b*b,O.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},f)}}function xb(a,n){for(let o=0;o<a.length;o++)if(Vc(n,a[o]))return!0;for(let o=0;o<n.length;o++)if(Vc(a,n[o]))return!0;return!!j_(a,n)}function LC(a,n,o){return!!Vc(a,n)||!!B_(n,a,o)}function bb(a,n){if(a.length===1)return Mb(n,a[0]);for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<u.length;f++)if(Vc(a,u[f]))return!0}for(let o=0;o<a.length;o++)if(Mb(n,a[o]))return!0;for(let o=0;o<n.length;o++)if(j_(a,n[o]))return!0;return!1}function OC(a,n,o){if(a.length>1){if(j_(a,n))return!0;for(let u=0;u<n.length;u++)if(B_(n[u],a,o))return!0}for(let u=0;u<a.length;u++)if(B_(a[u],n,o))return!0;return!1}function j_(a,n){if(a.length===0||n.length===0)return!1;for(let o=0;o<a.length-1;o++){let u=a[o],f=a[o+1];for(let _=0;_<n.length-1;_++)if(FC(u,f,n[_],n[_+1]))return!0}return!1}function FC(a,n,o,u){return hi(a,o,u)!==hi(n,o,u)&&hi(a,n,o)!==hi(a,n,u)}function B_(a,n,o){let u=o*o;if(n.length===1)return a.distSqr(n[0])<u;for(let f=1;f<n.length;f++)if(wb(a,n[f-1],n[f])<u)return!0;return!1}function wb(a,n,o){let u=n.distSqr(o);if(u===0)return a.distSqr(n);let f=((a.x-n.x)*(o.x-n.x)+(a.y-n.y)*(o.y-n.y))/u;return a.distSqr(f<0?n:f>1?o:o.sub(n)._mult(f)._add(n))}function Mb(a,n){let o,u,f,_=!1;for(let y=0;y<a.length;y++){o=a[y];for(let b=0,M=o.length-1;b<o.length;M=b++)u=o[b],f=o[M],u.y>n.y!=f.y>n.y&&n.x<(f.x-u.x)*(n.y-u.y)/(f.y-u.y)+u.x&&(_=!_)}return _}function Vc(a,n){let o=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){let _=a[u],y=a[f];_.y>n.y!=y.y>n.y&&n.x<(y.x-_.x)*(n.y-_.y)/(y.y-_.y)+_.x&&(o=!o)}return o}function zC(a,n,o){let u=o[0],f=o[2];if(a.x<u.x&&n.x<u.x||a.x>f.x&&n.x>f.x||a.y<u.y&&n.y<u.y||a.y>f.y&&n.y>f.y)return!1;let _=hi(a,n,o[0]);return _!==hi(a,n,o[1])||_!==hi(a,n,o[2])||_!==hi(a,n,o[3])}function Qh(a,n,o){let u=n.paint.get(a).value;return u.kind==="constant"?u.value:o.programConfigurations.get(n.id).getMaxValue(a)}function Pp(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Dp(a,n,o,u,f){if(!n[0]&&!n[1])return a;let _=v.convert(n)._mult(f);o==="viewport"&&_._rotate(-u);let y=[];for(let b=0;b<a.length;b++)y.push(a[b].sub(_));return y}let Sb,Eb;$e("CircleBucket",z_,{omit:["layers"]});var jC={get paint(){return Eb=Eb||new vr({"circle-radius":new tt(pe.paint_circle["circle-radius"]),"circle-color":new tt(pe.paint_circle["circle-color"]),"circle-blur":new tt(pe.paint_circle["circle-blur"]),"circle-opacity":new tt(pe.paint_circle["circle-opacity"]),"circle-translate":new Ye(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tt(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tt(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tt(pe.paint_circle["circle-stroke-opacity"])})},get layout(){return Sb=Sb||new vr({"circle-sort-key":new tt(pe.layout_circle["circle-sort-key"])})}};class BC extends Qr{constructor(n){super(n,jC)}createBucket(n){return new z_(n)}queryRadius(n){let o=n;return Qh("circle-radius",this,o)+Qh("circle-stroke-width",this,o)+Pp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:o,featureState:u,geometry:f,transform:_,pixelsToTileUnits:y,unwrappedTileID:b,getElevation:M}){let T=Dp(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,y),P=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u),A=this.paint.get("circle-pitch-alignment")==="map",O=A?T:function(j,G,Z,K){return j.map(ce=>Ib(ce,G,Z,K))}(T,_,b,M),z=A?P*y:P;for(let j of f)for(let G of j){let Z=A?G:Ib(G,_,b,M),K=z,ce=_.projectTileCoordinates(G.x,G.y,b,M).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?K*=ce/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(K*=_.cameraToCenterDistance/ce),LC(O,Z,K))return!0}return!1}}function Ib(a,n,o,u){let f=n.projectTileCoordinates(a.x,a.y,o,u).point;return new v((.5*f.x+.5)*n.width,(.5*-f.y+.5)*n.height)}class Tb extends z_{}let Cb;$e("HeatmapBucket",Tb,{omit:["layers"]});var UC={get paint(){return Cb=Cb||new vr({"heatmap-radius":new tt(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tt(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Oc(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(pe.paint_heatmap["heatmap-opacity"])})}};function U_(a,{width:n,height:o},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==n*o*u)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${n*o*u}`)}else f=new Uint8Array(n*o*u);return a.width=n,a.height=o,a.data=f,a}function Pb(a,{width:n,height:o},u){if(n===a.width&&o===a.height)return;let f=U_({},{width:n,height:o},u);V_(a,f,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,n),height:Math.min(a.height,o)},u),a.width=n,a.height=o,a.data=f.data}function V_(a,n,o,u,f,_){if(f.width===0||f.height===0)return n;if(f.width>a.width||f.height>a.height||o.x>a.width-f.width||o.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>n.width||f.height>n.height||u.x>n.width-f.width||u.y>n.height-f.height)throw new RangeError("out of range destination coordinates for image copy");let y=a.data,b=n.data;if(y===b)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<f.height;M++){let T=((o.y+M)*a.width+o.x)*_,P=((u.y+M)*n.width+u.x)*_;for(let A=0;A<f.width*_;A++)b[P+A]=y[T+A]}return n}class Jh{constructor(n,o){U_(this,n,1,o)}resize(n){Pb(this,n,1)}clone(){return new Jh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,f,_){V_(n,o,u,f,_,1)}}class Ur{constructor(n,o){U_(this,n,4,o)}resize(n){Pb(this,n,4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,f,_){V_(n,o,u,f,_,4)}setPixel(n,o,u){let f=4*(n*this.width+o);this.data[f+0]=Math.round(255*u.r/u.a),this.data[f+1]=Math.round(255*u.g/u.a),this.data[f+2]=Math.round(255*u.b/u.a),this.data[f+3]=Math.round(255*u.a)}}function Db(a){let n={},o=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new Ur({width:o,height:u});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);let _=(y,b,M)=>{n[a.evaluationKey]=M;let T=a.expression.evaluate(n);f.setPixel(y/4/o,b/4,T)};if(a.clips)for(let y=0,b=0;y<u;++y,b+=4*o)for(let M=0,T=0;M<o;M++,T+=4){let P=M/(o-1),{start:A,end:O}=a.clips[y];_(b,T,A*(1-P)+O*P)}else for(let y=0,b=0;y<o;y++,b+=4)_(0,b,y/(o-1));return f}$e("AlphaImage",Jh),$e("RGBAImage",Ur);let G_="big-fb";class VC extends Qr{createBucket(n){return new Tb(n)}constructor(n){super(n,UC),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Db({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(G_)&&this.heatmapFbos.delete(G_)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Ab;var GC={get paint(){return Ab=Ab||new vr({"hillshade-illumination-direction":new Ye(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ye(pe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ye(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(pe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ye(pe.paint_hillshade["hillshade-method"])})}};class $C extends Qr{constructor(n){super(n,GC),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let n=this.paint.get("hillshade-illumination-direction").values,o=this.paint.get("hillshade-illumination-altitude").values,u=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values,_=Math.max(n.length,o.length,u.length,f.length);n=n.concat(Array(_-n.length).fill(n.at(-1))),o=o.concat(Array(_-o.length).fill(o.at(-1))),u=u.concat(Array(_-u.length).fill(u.at(-1))),f=f.concat(Array(_-f.length).fill(f.at(-1)));let y=o.map(rs);return{directionRadians:n.map(rs),altitudeRadians:y,shadowColor:f,highlightColor:u}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Rb;var HC={get paint(){return Rb=Rb||new vr({"color-relief-opacity":new Ye(pe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Oc(pe["paint_color-relief"]["color-relief-color"])})}};class $_{constructor(n,o,u,f){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(o,f)}update(n,o,u){let{width:f,height:_}=n,y=!(this.size&&this.size[0]===f&&this.size[1]===_||u),{context:b}=this,{gl:M}=b;if(this.useMipmap=!!(o&&o.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!o||o.premultiply!==!1)),y)this.size=[f,_],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||Li(n)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,n):M.texImage2D(M.TEXTURE_2D,0,this.format,f,_,0,this.format,M.UNSIGNED_BYTE,n.data);else{let{x:T,y:P}=u||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||Li(n)?M.texSubImage2D(M.TEXTURE_2D,0,T,P,M.RGBA,M.UNSIGNED_BYTE,n):M.texSubImage2D(M.TEXTURE_2D,0,T,P,f,_,M.RGBA,M.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(n,o,u){let{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),u!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=_.LINEAR),n!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,u||n),this.filter=n),o!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class kb{constructor(n,o,u,f=1,_=1,y=1,b=0){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void bn(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;let M=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=_,this.blueFactor=y,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<M;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(M,T)]=this.data[this._idx(M-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,M)]=this.data[this._idx(T,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<M;T++)for(let P=0;P<M;P++){let A=this.get(T,P);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(n,o){let u=new Uint8Array(this.data.buffer),f=4*this._idx(n,o);return this.unpack(u[f],u[f+1],u[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}unpack(n,o,u){return n*this.redFactor+o*this.greenFactor+u*this.blueFactor-this.baseShift}pack(n){return Nb(n,this.getUnpackVector())}getPixels(){return new Ur({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,o,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,_=o*this.dim+this.dim,y=u*this.dim,b=u*this.dim+this.dim;switch(o){case-1:f=_-1;break;case 1:_=f+1}switch(u){case-1:y=b-1;break;case 1:b=y+1}let M=-o*this.dim,T=-u*this.dim;for(let P=y;P<b;P++)for(let A=f;A<_;A++)this.data[this._idx(A,P)]=n.data[this._idx(A+M,P+T)]}}function Nb(a,n){let o=n[0],u=n[1],f=n[2],_=n[3],y=Math.min(o,u,f),b=Math.round((a+_)/y);return{r:Math.floor(b*y/o)%256,g:Math.floor(b*y/u)%256,b:Math.floor(b*y/f)%256}}$e("DEMData",kb);class qC extends Qr{constructor(n){super(n,HC)}_createColorRamp(n){let o={elevationStops:[],colorStops:[]},u=this._transitionablePaint._values["color-relief-color"].value.expression;if(u instanceof cl&&u._styleExpression.expression instanceof Qn){this.colorRampExpression=u;let y=u._styleExpression.expression;o.elevationStops=y.labels,o.colorStops=[];for(let b of o.elevationStops)o.colorStops.push(y.evaluate({globals:{elevation:b}}))}if(o.elevationStops.length<1&&(o.elevationStops=[0],o.colorStops=[bt.transparent]),o.elevationStops.length<2&&(o.elevationStops.push(o.elevationStops[0]+1),o.colorStops.push(o.colorStops[0])),o.elevationStops.length<=n)return o;let f={elevationStops:[],colorStops:[]},_=(o.elevationStops.length-1)/(n-1);for(let y=0;y<o.elevationStops.length-.5;y+=_)f.elevationStops.push(o.elevationStops[Math.round(y)]),f.colorStops.push(o.colorStops[Math.round(y)]);return bn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(n,o,u){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let f=this._createColorRamp(o),_=new Ur({width:f.colorStops.length,height:1}),y=new Ur({width:f.colorStops.length,height:1});for(let b=0;b<f.elevationStops.length;b++){let M=Nb(f.elevationStops[b],u);y.setPixel(0,b,new bt(M.r/255,M.g/255,M.b/255,1)),_.setPixel(0,b,f.colorStops[b])}return this.colorRampTextures={elevationTexture:new $_(n,y,n.gl.RGBA),colorTexture:new $_(n,_,n.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let ZC=vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:WC}=ZC;function H_(a,n,o){let u=o.patternDependencies,f=!1;for(let _ of n){let y=_.paint.get(`${a}-pattern`);y.isConstant()||(f=!0);let b=y.constantOr(null);b&&(f=!0,u[b.to]=!0,u[b.from]=!0)}return f}function q_(a,n,o,u,f){let _=f.patternDependencies;for(let y of n){let b=y.paint.get(`${a}-pattern`).value;if(b.kind!=="constant"){let M=b.evaluate({zoom:u-1},o,{},f.availableImages),T=b.evaluate({zoom:u},o,{},f.availableImages),P=b.evaluate({zoom:u+1},o,{},f.availableImages);M=M&&M.name?M.name:M,T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,_[M]=!0,_[T]=!0,_[P]=!0,o.patterns[y.id]={min:M,mid:T,max:P}}}return o}function Lb(a,n,o,u,f){let _;if(f===function(y,b,M,T){let P=0;for(let A=b,O=M-T;A<M;A+=T)P+=(y[O]-y[A])*(y[A+1]+y[O+1]),O=A;return P}(a,n,o,u)>0)for(let y=n;y<o;y+=u)_=jb(y/u|0,a[y],a[y+1],_);else for(let y=o-u;y>=n;y-=u)_=jb(y/u|0,a[y],a[y+1],_);return _&&Gc(_,_.next)&&(rd(_),_=_.next),_}function xl(a,n){if(!a)return a;n||(n=a);let o,u=a;do if(o=!1,u.steiner||!Gc(u,u.next)&&Mn(u.prev,u,u.next)!==0)u=u.next;else{if(rd(u),u=n=u.prev,u===u.next)break;o=!0}while(o||u!==n);return n}function ed(a,n,o,u,f,_,y){if(!a)return;!y&&_&&function(M,T,P,A){let O=M;do O.z===0&&(O.z=Z_(O.x,O.y,T,P,A)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==M);O.prevZ.nextZ=null,O.prevZ=null,function(z){let j,G=1;do{let Z,K=z;z=null;let ce=null;for(j=0;K;){j++;let re=K,se=0;for(let we=0;we<G&&(se++,re=re.nextZ,re);we++);let ye=G;for(;se>0||ye>0&&re;)se!==0&&(ye===0||!re||K.z<=re.z)?(Z=K,K=K.nextZ,se--):(Z=re,re=re.nextZ,ye--),ce?ce.nextZ=Z:z=Z,Z.prevZ=ce,ce=Z;K=re}ce.nextZ=null,G*=2}while(j>1)}(O)}(a,u,f,_);let b=a;for(;a.prev!==a.next;){let M=a.prev,T=a.next;if(_?YC(a,u,f,_):XC(a))n.push(M.i,a.i,T.i),rd(a),a=T.next,b=T.next;else if((a=T)===b){y?y===1?ed(a=KC(xl(a),n),n,o,u,f,_,2):y===2&&QC(a,n,o,u,f,_):ed(xl(a),n,o,u,f,_,1);break}}}function XC(a){let n=a.prev,o=a,u=a.next;if(Mn(n,o,u)>=0)return!1;let f=n.x,_=o.x,y=u.x,b=n.y,M=o.y,T=u.y,P=Math.min(f,_,y),A=Math.min(b,M,T),O=Math.max(f,_,y),z=Math.max(b,M,T),j=u.next;for(;j!==n;){if(j.x>=P&&j.x<=O&&j.y>=A&&j.y<=z&&td(f,b,_,M,y,T,j.x,j.y)&&Mn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function YC(a,n,o,u){let f=a.prev,_=a,y=a.next;if(Mn(f,_,y)>=0)return!1;let b=f.x,M=_.x,T=y.x,P=f.y,A=_.y,O=y.y,z=Math.min(b,M,T),j=Math.min(P,A,O),G=Math.max(b,M,T),Z=Math.max(P,A,O),K=Z_(z,j,n,o,u),ce=Z_(G,Z,n,o,u),re=a.prevZ,se=a.nextZ;for(;re&&re.z>=K&&se&&se.z<=ce;){if(re.x>=z&&re.x<=G&&re.y>=j&&re.y<=Z&&re!==f&&re!==y&&td(b,P,M,A,T,O,re.x,re.y)&&Mn(re.prev,re,re.next)>=0||(re=re.prevZ,se.x>=z&&se.x<=G&&se.y>=j&&se.y<=Z&&se!==f&&se!==y&&td(b,P,M,A,T,O,se.x,se.y)&&Mn(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;re&&re.z>=K;){if(re.x>=z&&re.x<=G&&re.y>=j&&re.y<=Z&&re!==f&&re!==y&&td(b,P,M,A,T,O,re.x,re.y)&&Mn(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;se&&se.z<=ce;){if(se.x>=z&&se.x<=G&&se.y>=j&&se.y<=Z&&se!==f&&se!==y&&td(b,P,M,A,T,O,se.x,se.y)&&Mn(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function KC(a,n){let o=a;do{let u=o.prev,f=o.next.next;!Gc(u,f)&&Fb(u,o,o.next,f)&&nd(u,f)&&nd(f,u)&&(n.push(u.i,o.i,f.i),rd(o),rd(o.next),o=a=f),o=o.next}while(o!==a);return xl(o)}function QC(a,n,o,u,f,_){let y=a;do{let b=y.next.next;for(;b!==y.prev;){if(y.i!==b.i&&r2(y,b)){let M=zb(y,b);return y=xl(y,y.next),M=xl(M,M.next),ed(y,n,o,u,f,_,0),void ed(M,n,o,u,f,_,0)}b=b.next}y=y.next}while(y!==a)}function JC(a,n){let o=a.x-n.x;return o===0&&(o=a.y-n.y,o===0)&&(o=(a.next.y-a.y)/(a.next.x-a.x)-(n.next.y-n.y)/(n.next.x-n.x)),o}function e2(a,n){let o=function(f,_){let y=_,b=f.x,M=f.y,T,P=-1/0;if(Gc(f,y))return y;do{if(Gc(f,y.next))return y.next;if(M<=y.y&&M>=y.next.y&&y.next.y!==y.y){let G=y.x+(M-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(G<=b&&G>P&&(P=G,T=y.x<y.next.x?y:y.next,G===b))return T}y=y.next}while(y!==_);if(!T)return null;let A=T,O=T.x,z=T.y,j=1/0;y=T;do{if(b>=y.x&&y.x>=O&&b!==y.x&&Ob(M<z?b:P,M,O,z,M<z?P:b,M,y.x,y.y)){let G=Math.abs(M-y.y)/(b-y.x);nd(y,f)&&(G<j||G===j&&(y.x>T.x||y.x===T.x&&t2(T,y)))&&(T=y,j=G)}y=y.next}while(y!==A);return T}(a,n);if(!o)return n;let u=zb(o,a);return xl(u,u.next),xl(o,o.next)}function t2(a,n){return Mn(a.prev,a,n.prev)<0&&Mn(n.next,a,a.next)<0}function Z_(a,n,o,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-o)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function n2(a){let n=a,o=a;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==a);return o}function Ob(a,n,o,u,f,_,y,b){return(f-y)*(n-b)>=(a-y)*(_-b)&&(a-y)*(u-b)>=(o-y)*(n-b)&&(o-y)*(_-b)>=(f-y)*(u-b)}function td(a,n,o,u,f,_,y,b){return!(a===y&&n===b)&&Ob(a,n,o,u,f,_,y,b)}function r2(a,n){return a.next.i!==n.i&&a.prev.i!==n.i&&!function(o,u){let f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==u.i&&f.next.i!==u.i&&Fb(f,f.next,o,u))return!0;f=f.next}while(f!==o);return!1}(a,n)&&(nd(a,n)&&nd(n,a)&&function(o,u){let f=o,_=!1,y=(o.x+u.x)/2,b=(o.y+u.y)/2;do f.y>b!=f.next.y>b&&f.next.y!==f.y&&y<(f.next.x-f.x)*(b-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next;while(f!==o);return _}(a,n)&&(Mn(a.prev,a,n.prev)||Mn(a,n.prev,n))||Gc(a,n)&&Mn(a.prev,a,a.next)>0&&Mn(n.prev,n,n.next)>0)}function Mn(a,n,o){return(n.y-a.y)*(o.x-n.x)-(n.x-a.x)*(o.y-n.y)}function Gc(a,n){return a.x===n.x&&a.y===n.y}function Fb(a,n,o,u){let f=Rp(Mn(a,n,o)),_=Rp(Mn(a,n,u)),y=Rp(Mn(o,u,a)),b=Rp(Mn(o,u,n));return f!==_&&y!==b||!(f!==0||!Ap(a,o,n))||!(_!==0||!Ap(a,u,n))||!(y!==0||!Ap(o,a,u))||!(b!==0||!Ap(o,n,u))}function Ap(a,n,o){return n.x<=Math.max(a.x,o.x)&&n.x>=Math.min(a.x,o.x)&&n.y<=Math.max(a.y,o.y)&&n.y>=Math.min(a.y,o.y)}function Rp(a){return a>0?1:a<0?-1:0}function nd(a,n){return Mn(a.prev,a,a.next)<0?Mn(a,n,a.next)>=0&&Mn(a,a.prev,n)>=0:Mn(a,n,a.prev)<0||Mn(a,a.next,n)<0}function zb(a,n){let o=W_(a.i,a.x,a.y),u=W_(n.i,n.x,n.y),f=a.next,_=n.prev;return a.next=n,n.prev=a,o.next=f,f.prev=o,u.next=o,o.prev=u,_.next=u,u.prev=_,u}function jb(a,n,o,u){let f=W_(a,n,o);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function rd(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function W_(a,n,o){return{i:a,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class $c{constructor(n,o){if(o>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=o}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class kp{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}kp.noSubdivision=new kp({fill:new $c(0,0),line:new $c(0,0),tile:new $c(0,0),stencil:new $c(0,0),circle:1}),$e("SubdivisionGranularityExpression",$c),$e("SubdivisionGranularitySetting",kp);let Hc=-32768,id=32767;class i2{constructor(n,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=Ht/n,this._canonical=o}_getKey(n,o){return(n+=32768)<<16|o+32768}_vertexToIndex(n,o){if(n<-32768||o<-32768||n>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let u=0|Math.round(n),f=0|Math.round(o),_=this._getKey(u,f);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);let y=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,y),this._vertexBuffer.push(u,f),y}_subdivideTrianglesScanline(n){if(this._granularity<2)return function(f,_){let y=[];for(let b=0;b<_.length;b+=3){let M=_[b],T=_[b+1],P=_[b+2],A=f[2*M],O=f[2*M+1];(f[2*T]-A)*(f[2*P+1]-O)-(f[2*T+1]-O)*(f[2*P]-A)>0?(y.push(M),y.push(P),y.push(T)):(y.push(M),y.push(T),y.push(P))}return y}(this._vertexBuffer,n);let o=[],u=n.length;for(let f=0;f<u;f+=3){let _=[n[f+0],n[f+1],n[f+2]],y=[this._vertexBuffer[2*n[f+0]+0],this._vertexBuffer[2*n[f+0]+1],this._vertexBuffer[2*n[f+1]+0],this._vertexBuffer[2*n[f+1]+1],this._vertexBuffer[2*n[f+2]+0],this._vertexBuffer[2*n[f+2]+1]],b=1/0,M=1/0,T=-1/0,P=-1/0;for(let G=0;G<3;G++){let Z=y[2*G],K=y[2*G+1];b=Math.min(b,Z),T=Math.max(T,Z),M=Math.min(M,K),P=Math.max(P,K)}if(b===T||M===P)continue;let A=Math.floor(b/this._granularityCellSize),O=Math.ceil(T/this._granularityCellSize),z=Math.floor(M/this._granularityCellSize),j=Math.ceil(P/this._granularityCellSize);if(A!==O||z!==j)for(let G=z;G<j;G++){let Z=this._scanlineGenerateVertexRingForCellRow(G,y,_);o2(this._vertexBuffer,Z,o)}else o.push(..._)}return o}_scanlineGenerateVertexRingForCellRow(n,o,u){let f=n*this._granularityCellSize,_=f+this._granularityCellSize,y=[];for(let b=0;b<3;b++){let M=o[2*b],T=o[2*b+1],P=o[2*(b+1)%6],A=o[(2*(b+1)+1)%6],O=o[2*(b+2)%6],z=o[(2*(b+2)+1)%6],j=P-M,G=A-T,Z=j===0,K=G===0,ce=(f-T)/G,re=(_-T)/G,se=Math.min(ce,re),ye=Math.max(ce,re);if(!K&&(se>=1||ye<=0)||K&&(T<f||T>_)){A>=f&&A<=_&&y.push(u[(b+1)%3]);continue}!K&&se>0&&y.push(this._vertexToIndex(M+j*se,T+G*se));let we=M+j*Math.max(se,0),De=M+j*Math.min(ye,1);Z||this._generateIntraEdgeVertices(y,M,T,P,A,we,De),!K&&ye<1&&y.push(this._vertexToIndex(M+j*ye,T+G*ye)),(K||A>=f&&A<=_)&&y.push(u[(b+1)%3]),!K&&(A<=f||A>=_)&&this._generateInterEdgeVertices(y,M,T,P,A,O,z,De,f,_)}return y}_generateIntraEdgeVertices(n,o,u,f,_,y,b){let M=f-o,T=_-u,P=T===0,A=P?Math.min(o,f):Math.min(y,b),O=P?Math.max(o,f):Math.max(y,b),z=Math.floor(A/this._granularityCellSize)+1,j=Math.ceil(O/this._granularityCellSize)-1;if(P?o<f:y<b)for(let G=z;G<=j;G++){let Z=G*this._granularityCellSize;n.push(this._vertexToIndex(Z,u+T*(Z-o)/M))}else for(let G=j;G>=z;G--){let Z=G*this._granularityCellSize;n.push(this._vertexToIndex(Z,u+T*(Z-o)/M))}}_generateInterEdgeVertices(n,o,u,f,_,y,b,M,T,P){let A=_-u,O=y-f,z=b-_,j=(T-_)/z,G=(P-_)/z,Z=Math.min(j,G),K=Math.max(j,G),ce=f+O*Z,re=Math.floor(Math.min(ce,M)/this._granularityCellSize)+1,se=Math.ceil(Math.max(ce,M)/this._granularityCellSize)-1,ye=M<ce,we=z===0;if(we&&(b===T||b===P))return;if(we||Z>=1||K<=0){let Ve=u-b,Le=y+(o-y)*Math.min((T-b)/Ve,(P-b)/Ve);re=Math.floor(Math.min(Le,M)/this._granularityCellSize)+1,se=Math.ceil(Math.max(Le,M)/this._granularityCellSize)-1,ye=M<Le}let De=A>0?P:T;if(ye)for(let Ve=re;Ve<=se;Ve++)n.push(this._vertexToIndex(Ve*this._granularityCellSize,De));else for(let Ve=se;Ve>=re;Ve--)n.push(this._vertexToIndex(Ve*this._granularityCellSize,De))}_generateOutline(n){let o=[];for(let u of n){let f=bl(u,this._granularity,!0),_=this._pointArrayToIndices(f),y=[];for(let b=1;b<_.length;b++)y.push(_[b-1]),y.push(_[b]);o.push(y)}return o}_handlePoles(n){let o=!1,u=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(u=!0)),(o||u)&&this._fillPoles(n,o,u)}_ensureNoPoleVertices(){let n=this._vertexBuffer;for(let o=0;o<n.length;o+=2){let u=n[o+1];u===Hc&&(n[o+1]=-32767),u===id&&(n[o+1]=32766)}}_generatePoleQuad(n,o,u,f,_,y){f>_!=(y===Hc)?(n.push(o),n.push(u),n.push(this._vertexToIndex(f,y)),n.push(u),n.push(this._vertexToIndex(_,y)),n.push(this._vertexToIndex(f,y))):(n.push(u),n.push(o),n.push(this._vertexToIndex(f,y)),n.push(this._vertexToIndex(_,y)),n.push(u),n.push(this._vertexToIndex(f,y)))}_fillPoles(n,o,u){let f=this._vertexBuffer,_=Ht,y=n.length;for(let b=2;b<y;b+=3){let M=n[b-2],T=n[b-1],P=n[b],A=f[2*M],O=f[2*M+1],z=f[2*T],j=f[2*T+1],G=f[2*P],Z=f[2*P+1];o&&(O===0&&j===0&&this._generatePoleQuad(n,M,T,A,z,Hc),j===0&&Z===0&&this._generatePoleQuad(n,T,P,z,G,Hc),Z===0&&O===0&&this._generatePoleQuad(n,P,M,G,A,Hc)),u&&(O===_&&j===_&&this._generatePoleQuad(n,M,T,A,z,id),j===_&&Z===_&&this._generatePoleQuad(n,T,P,z,G,id),Z===_&&O===_&&this._generatePoleQuad(n,P,M,G,A,id))}}_initializeVertices(n){for(let o=0;o<n.length;o+=2)this._vertexToIndex(n[o],n[o+1])}subdividePolygonInternal(n,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:u,holeIndices:f}=function(b){let M=[],T=[];for(let P of b)if(P.length!==0){P!==b[0]&&M.push(T.length/2);for(let A=0;A<P.length;A++)T.push(P[A].x),T.push(P[A].y)}return{flattened:T,holeIndices:M}}(n),_;this._initializeVertices(u);try{let b=function(T,P,A=2){let O=P&&P.length,z=O?P[0]*A:T.length,j=Lb(T,0,z,A,!0),G=[];if(!j||j.next===j.prev)return G;let Z,K,ce;if(O&&(j=function(re,se,ye,we){let De=[];for(let Ve=0,Le=se.length;Ve<Le;Ve++){let Be=Lb(re,se[Ve]*we,Ve<Le-1?se[Ve+1]*we:re.length,we,!1);Be===Be.next&&(Be.steiner=!0),De.push(n2(Be))}De.sort(JC);for(let Ve=0;Ve<De.length;Ve++)ye=e2(De[Ve],ye);return ye}(T,P,j,A)),T.length>80*A){Z=T[0],K=T[1];let re=Z,se=K;for(let ye=A;ye<z;ye+=A){let we=T[ye],De=T[ye+1];we<Z&&(Z=we),De<K&&(K=De),we>re&&(re=we),De>se&&(se=De)}ce=Math.max(re-Z,se-K),ce=ce!==0?32767/ce:0}return ed(j,G,A,Z,K,ce,0),G}(u,f),M=this._convertIndices(u,b);_=this._subdivideTrianglesScanline(M)}catch(b){console.error(b)}let y=[];return o&&(y=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:y}}_convertIndices(n,o){let u=[];for(let f=0;f<o.length;f++)u.push(this._vertexToIndex(n[2*o[f]],n[2*o[f]+1]));return u}_pointArrayToIndices(n){let o=[];for(let u=0;u<n.length;u++){let f=n[u];o.push(this._vertexToIndex(f.x,f.y))}return o}}function Bb(a,n,o,u=!0){return new i2(o,n).subdividePolygonInternal(a,u)}function bl(a,n,o=!1){if(!a||a.length<1)return[];if(a.length<2)return[];let u=a[0],f=a[a.length-1],_=o&&(u.x!==f.x||u.y!==f.y);if(n<2)return _?[...a,a[0]]:[...a];let y=Math.floor(Ht/n),b=[];b.push(new v(a[0].x,a[0].y));let M=a.length,T=_?M:M-1;for(let P=0;P<T;P++){let A=a[P],O=P<M-1?a[P+1]:a[0],z=A.x,j=A.y,G=O.x,Z=O.y,K=z!==G,ce=j!==Z;if(!K&&!ce)continue;let re=G-z,se=Z-j,ye=Math.abs(re),we=Math.abs(se),De=z,Ve=j;for(;;){let Be=re>0?(Math.floor(De/y)+1)*y:(Math.ceil(De/y)-1)*y,Ke=se>0?(Math.floor(Ve/y)+1)*y:(Math.ceil(Ve/y)-1)*y,je=Math.abs(De-Be),Ue=Math.abs(Ve-Ke),Ie=Math.abs(De-G),rt=Math.abs(Ve-Z),ot=K?je/ye:Number.POSITIVE_INFINITY,et=ce?Ue/we:Number.POSITIVE_INFINITY;if((Ie<=je||!K)&&(rt<=Ue||!ce))break;if(ot<et&&K||!ce){De=Be,Ve+=se*ot;let Ze=new v(De,Math.round(Ve));b[b.length-1].x===Ze.x&&b[b.length-1].y===Ze.y||b.push(Ze)}else{De+=re*et,Ve=Ke;let Ze=new v(Math.round(De),Ve);b[b.length-1].x===Ze.x&&b[b.length-1].y===Ze.y||b.push(Ze)}}let Le=new v(G,Z);b[b.length-1].x===Le.x&&b[b.length-1].y===Le.y||b.push(Le)}return b}function o2(a,n,o){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let u=0,f=a[2*n[0]];for(let M=1;M<n.length;M++){let T=a[2*n[M]];T<f&&(f=T,u=M)}let _=n.length,y=u,b=(y+1)%_;for(;;){let M=y-1>=0?y-1:_-1,T=(b+1)%_,P=a[2*n[M]],A=a[2*n[T]],O=a[2*n[y]],z=a[2*n[y]+1],j=a[2*n[b]+1],G=!1;if(P<A)G=!0;else if(P>A)G=!1;else{let Z=j-z,K=-(a[2*n[b]]-O),ce=z<j?1:-1;((P-O)*Z+(a[2*n[M]+1]-z)*K)*ce>((A-O)*Z+(a[2*n[T]+1]-z)*K)*ce&&(G=!0)}if(G){let Z=n[M],K=n[y],ce=n[b];Z!==K&&Z!==ce&&K!==ce&&o.push(ce,K,Z),y--,y<0&&(y=_-1)}else{let Z=n[T],K=n[y],ce=n[b];Z!==K&&Z!==ce&&K!==ce&&o.push(ce,K,Z),b++,b>=_&&(b=0)}if(M===T)break}}function Ub(a,n,o,u,f,_,y,b,M){let T=f.length/2,P=y&&b&&M;if(T<ht.MAX_VERTEX_ARRAY_LENGTH){let A=n.prepareSegment(T,o,u),O=A.vertexLength;for(let G=0;G<_.length;G+=3)u.emplaceBack(O+_[G],O+_[G+1],O+_[G+2]);let z,j;A.vertexLength+=T,A.primitiveLength+=_.length/3,P&&(j=y.prepareSegment(T,o,b),z=j.vertexLength,j.vertexLength+=T);for(let G=0;G<f.length;G+=2)a(f[G],f[G+1]);if(P)for(let G=0;G<M.length;G++){let Z=M[G];for(let K=1;K<Z.length;K+=2)b.emplaceBack(z+Z[K-1],z+Z[K]);j.primitiveLength+=Z.length/2}}else(function(A,O,z,j,G,Z){let K=[];for(let we=0;we<j.length/2;we++)K.push(-1);let ce={count:0},re=0,se=A.getOrCreateLatestSegment(O,z),ye=se.vertexLength;for(let we=2;we<G.length;we+=3){let De=G[we-2],Ve=G[we-1],Le=G[we],Be=K[De]<re,Ke=K[Ve]<re,je=K[Le]<re;se.vertexLength+((Be?1:0)+(Ke?1:0)+(je?1:0))>ht.MAX_VERTEX_ARRAY_LENGTH&&(se=A.createNewSegment(O,z),re=ce.count,Be=!0,Ke=!0,je=!0,ye=0);let Ue=od(K,j,Z,ce,De,Be,se),Ie=od(K,j,Z,ce,Ve,Ke,se),rt=od(K,j,Z,ce,Le,je,se);z.emplaceBack(ye+Ue-re,ye+Ie-re,ye+rt-re),se.primitiveLength++}})(n,o,u,f,_,a),P&&function(A,O,z,j,G,Z){let K=[];for(let we=0;we<j.length/2;we++)K.push(-1);let ce={count:0},re=0,se=A.getOrCreateLatestSegment(O,z),ye=se.vertexLength;for(let we=0;we<G.length;we++){let De=G[we];for(let Ve=1;Ve<G[we].length;Ve+=2){let Le=De[Ve-1],Be=De[Ve],Ke=K[Le]<re,je=K[Be]<re;se.vertexLength+((Ke?1:0)+(je?1:0))>ht.MAX_VERTEX_ARRAY_LENGTH&&(se=A.createNewSegment(O,z),re=ce.count,Ke=!0,je=!0,ye=0);let Ue=od(K,j,Z,ce,Le,Ke,se),Ie=od(K,j,Z,ce,Be,je,se);z.emplaceBack(ye+Ue-re,ye+Ie-re),se.primitiveLength++}}}(y,o,b,f,M,a),n.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function od(a,n,o,u,f,_,y){if(_){let b=u.count;return o(n[2*f],n[2*f+1]),a[f]=u.count,u.count++,y.vertexLength++,b}return a[f]}class X_{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new be,this.indexArray=new Zt,this.indexArray2=new $t,this.programConfigurations=new Br(n.layers,n.zoom),this.segments=new ht,this.segments2=new ht,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,u){this.hasPattern=H_("fill",this.layers,o);let f=this.layers[0].layout.get("fill-sort-key"),_=!f.isConstant(),y=[];for(let{feature:b,id:M,index:T,sourceLayerIndex:P}of n){let A=this.layers[0]._featureFilter.needGeometry,O=ro(b,A);if(!this.layers[0]._featureFilter.filter(new an(this.zoom,{globalState:this.globalState}),O,u))continue;let z=_?f.evaluate(O,{},u,o.availableImages):void 0,j={id:M,properties:b.properties,type:b.type,sourceLayerIndex:P,index:T,geometry:A?O.geometry:Uo(b),patterns:{},sortKey:z};y.push(j)}_&&y.sort((b,M)=>b.sortKey-M.sortKey);for(let b of y){let{geometry:M,index:T,sourceLayerIndex:P}=b;if(this.hasPattern){let A=q_("fill",this.layers,b,this.zoom,o);this.patternFeatures.push(A)}else this.addFeature(b,M,T,u,{},o.subdivisionGranularity);o.featureIndex.insert(n[T].feature,M,T,P,this.index)}}update(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)}addFeatures(n,o,u){for(let f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,o,u,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,WC),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,u,f,_,y){for(let b of il(o,500)){let M=Bb(b,f,y.fill.getGranularityForZoomLevel(f.z)),T=this.layoutVertexArray;Ub((P,A)=>{T.emplaceBack(P,A)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,_,f)}}let Vb,Gb;$e("FillBucket",X_,{omit:["layers","patternFeatures"]});var s2={get paint(){return Gb=Gb||new vr({"fill-antialias":new Ye(pe.paint_fill["fill-antialias"]),"fill-opacity":new tt(pe.paint_fill["fill-opacity"]),"fill-color":new tt(pe.paint_fill["fill-color"]),"fill-outline-color":new tt(pe.paint_fill["fill-outline-color"]),"fill-translate":new Ye(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lc(pe.paint_fill["fill-pattern"])})},get layout(){return Vb=Vb||new vr({"fill-sort-key":new tt(pe.layout_fill["fill-sort-key"])})}};class a2 extends Qr{constructor(n){super(n,s2)}recalculate(n,o){super.recalculate(n,o);let u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new X_(n)}queryRadius(){return Pp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:o,transform:u,pixelsToTileUnits:f}){return bb(Dp(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-u.bearingInRadians,f),o)}isTileClipped(){return!0}}let l2=vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),c2=vn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:u2}=l2;class qc{constructor(n,o,u,f,_){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=f,this._values=_,n.readFields(h2,this,o)}loadGeometry(){let n=this._pbf;n.pos=this._geometry;let o=n.readVarint()+n.pos,u=[],f,_=1,y=0,b=0,M=0;for(;n.pos<o;){if(y<=0){let T=n.readVarint();_=7&T,y=T>>3}if(y--,_===1||_===2)b+=n.readSVarint(),M+=n.readSVarint(),_===1&&(f&&u.push(f),f=[]),f&&f.push(new v(b,M));else{if(_!==7)throw new Error(`unknown command ${_}`);f&&f.push(f[0].clone())}}return f&&u.push(f),u}bbox(){let n=this._pbf;n.pos=this._geometry;let o=n.readVarint()+n.pos,u=1,f=0,_=0,y=0,b=1/0,M=-1/0,T=1/0,P=-1/0;for(;n.pos<o;){if(f<=0){let A=n.readVarint();u=7&A,f=A>>3}if(f--,u===1||u===2)_+=n.readSVarint(),y+=n.readSVarint(),_<b&&(b=_),_>M&&(M=_),y<T&&(T=y),y>P&&(P=y);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,T,M,P]}toGeoJSON(n,o,u){let f=this.extent*Math.pow(2,u),_=this.extent*n,y=this.extent*o,b=this.loadGeometry();function M(O){return[360*(O.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((1-2*(O.y+y)/f)*Math.PI))-90]}function T(O){return O.map(M)}let P;if(this.type===1){let O=[];for(let j of b)O.push(j[0]);let z=T(O);P=O.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){let O=b.map(T);P=O.length===1?{type:"LineString",coordinates:O[0]}:{type:"MultiLineString",coordinates:O}}else{if(this.type!==3)throw new Error("unknown feature type");{let O=function(j){let G=j.length;if(G<=1)return[j];let Z=[],K,ce;for(let re=0;re<G;re++){let se=d2(j[re]);se!==0&&(ce===void 0&&(ce=se<0),ce===se<0?(K&&Z.push(K),K=[j[re]]):K&&K.push(j[re]))}return K&&Z.push(K),Z}(b),z=[];for(let j of O)z.push(j.map(T));P=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}let A={type:"Feature",geometry:P,properties:this.properties};return this.id!=null&&(A.id=this.id),A}}function h2(a,n,o){a===1?n.id=o.readVarint():a===2?function(u,f){let _=u.readVarint()+u.pos;for(;u.pos<_;){let y=f._keys[u.readVarint()],b=f._values[u.readVarint()];f.properties[y]=b}}(o,n):a===3?n.type=o.readVarint():a===4&&(n._geometry=o.pos)}function d2(a){let n=0;for(let o,u,f=0,_=a.length,y=_-1;f<_;y=f++)o=a[f],u=a[y],n+=(u.x-o.x)*(o.y+u.y);return n}qc.types=["Unknown","Point","LineString","Polygon"];class $b{constructor(n,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(f2,this,o),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];let o=this._pbf.readVarint()+this._pbf.pos;return new qc(this._pbf,o,this.extent,this._keys,this._values)}}function f2(a,n,o){a===15?n.version=o.readVarint():a===1?n.name=o.readString():a===5?n.extent=o.readVarint():a===2?n._features.push(o.pos):a===3?n._keys.push(o.readString()):a===4&&n._values.push(function(u){let f=null,_=u.readVarint()+u.pos;for(;u.pos<_;){let y=u.readVarint()>>3;f=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}if(f==null)throw new Error("unknown feature value");return f}(o))}class Hb{constructor(n,o){this.layers=n.readFields(p2,{},o)}}function p2(a,n,o){if(a===3){let u=new $b(o,o.readVarint()+o.pos);u.length&&(n[u.name]=u)}}let Y_=Math.pow(2,13);function sd(a,n,o,u,f,_,y,b){a.emplaceBack(n,o,2*Math.floor(u*Y_)+y,f*Y_*2,_*Y_*2,Math.round(b))}class K_{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ge,this.centroidVertexArray=new ee,this.indexArray=new Zt,this.programConfigurations=new Br(n.layers,n.zoom),this.segments=new ht,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,u){this.features=[],this.hasPattern=H_("fill-extrusion",this.layers,o);for(let{feature:f,id:_,index:y,sourceLayerIndex:b}of n){let M=this.layers[0]._featureFilter.needGeometry,T=ro(f,M);if(!this.layers[0]._featureFilter.filter(new an(this.zoom,{globalState:this.globalState}),T,u))continue;let P={id:_,sourceLayerIndex:b,index:y,geometry:M?T.geometry:Uo(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(q_("fill-extrusion",this.layers,P,this.zoom,o)):this.addFeature(P,P.geometry,y,u,{},o.subdivisionGranularity),o.featureIndex.insert(f,P.geometry,y,b,this.index,!0)}}addFeatures(n,o,u){for(let f of this.features){let{geometry:_}=f;this.addFeature(f,_,f.index,o,u,n.subdivisionGranularity)}}update(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,u2),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,c2.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,o,u,f,_,y){for(let b of il(o,500)){let M={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(M,f,n,b,y);let P=this.layoutVertexArray.length-T,A=Math.floor(M.x/M.sampleCount),O=Math.floor(M.y/M.sampleCount);for(let z=0;z<P;z++)this.centroidVertexArray.emplaceBack(A,O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,_,f)}processPolygon(n,o,u,f,_){if(f.length<1||qb(f[0]))return;for(let A of f)A.length!==0&&m2(n,A);let y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=_.fill.getGranularityForZoomLevel(o.z),M=qc.types[u.type]==="Polygon";for(let A of f){if(A.length===0||qb(A))continue;let O=bl(A,b,M);this._generateSideFaces(O,y)}if(!M)return;let T=Bb(f,o,b,!1),P=this.layoutVertexArray;Ub((A,O)=>{sd(P,A,O,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(n,o){let u=0;for(let f=1;f<n.length;f++){let _=n[f],y=n[f-1];if(g2(_,y))continue;o.segment.vertexLength+4>ht.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let b=_.sub(y)._perp()._unit(),M=y.dist(_);u+M>32768&&(u=0),sd(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,0,u),sd(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,1,u),u+=M,sd(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,0,u),sd(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,1,u);let T=o.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function m2(a,n){for(let o=0;o<n.length;o++){let u=n[o];o===n.length-1&&n[0].x===u.x&&n[0].y===u.y||(a.x+=u.x,a.y+=u.y,a.sampleCount++)}}function g2(a,n){return a.x===n.x&&(a.x<0||a.x>Ht)||a.y===n.y&&(a.y<0||a.y>Ht)}function qb(a){return a.every(n=>n.x<0)||a.every(n=>n.x>Ht)||a.every(n=>n.y<0)||a.every(n=>n.y>Ht)}let Zb;$e("FillExtrusionBucket",K_,{omit:["layers","features"]});var _2={get paint(){return Zb=Zb||new vr({"fill-extrusion-opacity":new Ye(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tt(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lc(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new tt(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tt(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class y2 extends Qr{constructor(n){super(n,_2)}createBucket(n){return new K_(n)}queryRadius(){return Pp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:o,featureState:u,geometry:f,transform:_,pixelsToTileUnits:y,pixelPosMatrix:b}){let M=Dp(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,y),T=this.paint.get("fill-extrusion-height").evaluate(o,u),P=this.paint.get("fill-extrusion-base").evaluate(o,u),A=function(z,j){let G=[];for(let Z of z){let K=[Z.x,Z.y,0,1];Wr(K,K,j),G.push(new v(K[0]/K[3],K[1]/K[3]))}return G}(M,b),O=function(z,j,G,Z){let K=[],ce=[],re=Z[8]*j,se=Z[9]*j,ye=Z[10]*j,we=Z[11]*j,De=Z[8]*G,Ve=Z[9]*G,Le=Z[10]*G,Be=Z[11]*G;for(let Ke of z){let je=[],Ue=[];for(let Ie of Ke){let rt=Ie.x,ot=Ie.y,et=Z[0]*rt+Z[4]*ot+Z[12],Ze=Z[1]*rt+Z[5]*ot+Z[13],Dt=Z[2]*rt+Z[6]*ot+Z[14],pn=Z[3]*rt+Z[7]*ot+Z[15],zn=Dt+ye,ur=pn+we,Si=et+De,Vr=Ze+Ve,Jn=Dt+Le,cn=pn+Be,$n=new v((et+re)/ur,(Ze+se)/ur);$n.z=zn/ur,je.push($n);let er=new v(Si/cn,Vr/cn);er.z=Jn/cn,Ue.push(er)}K.push(je),ce.push(Ue)}return[K,ce]}(f,P,T,b);return function(z,j,G){let Z=1/0;bb(G,j)&&(Z=Wb(G,j[0]));for(let K=0;K<j.length;K++){let ce=j[K],re=z[K];for(let se=0;se<ce.length-1;se++){let ye=ce[se],we=[ye,ce[se+1],re[se+1],re[se],ye];xb(G,we)&&(Z=Math.min(Z,Wb(G,we)))}}return Z!==1/0&&Z}(O[0],O[1],A)}}function ad(a,n){return a.x*n.x+a.y*n.y}function Wb(a,n){if(a.length===1){let o=0,u=n[o++],f;for(;!f||u.equals(f);)if(f=n[o++],!f)return 1/0;for(;o<n.length;o++){let _=n[o],y=a[0],b=f.sub(u),M=_.sub(u),T=y.sub(u),P=ad(b,b),A=ad(b,M),O=ad(M,M),z=ad(T,b),j=ad(T,M),G=P*O-A*A,Z=(O*z-A*j)/G,K=(P*j-A*z)/G,ce=u.z*(1-Z-K)+f.z*Z+_.z*K;if(isFinite(ce))return ce}return 1/0}{let o=1/0;for(let u of n)o=Math.min(o,u.z);return o}}let v2=vn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:x2}=v2,b2=vn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:w2}=b2,M2=Math.cos(Math.PI/180*37.5),Xb=Math.pow(2,14)/.5;class Q_{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new _e,this.layoutVertexArray2=new xe,this.indexArray=new Zt,this.programConfigurations=new Br(n.layers,n.zoom),this.segments=new ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,u){this.hasPattern=H_("line",this.layers,o);let f=this.layers[0].layout.get("line-sort-key"),_=!f.isConstant(),y=[];for(let{feature:b,id:M,index:T,sourceLayerIndex:P}of n){let A=this.layers[0]._featureFilter.needGeometry,O=ro(b,A);if(!this.layers[0]._featureFilter.filter(new an(this.zoom,{globalState:this.globalState}),O,u))continue;let z=_?f.evaluate(O,{},u):void 0,j={id:M,properties:b.properties,type:b.type,sourceLayerIndex:P,index:T,geometry:A?O.geometry:Uo(b),patterns:{},sortKey:z};y.push(j)}_&&y.sort((b,M)=>b.sortKey-M.sortKey);for(let b of y){let{geometry:M,index:T,sourceLayerIndex:P}=b;if(this.hasPattern){let A=q_("line",this.layers,b,this.zoom,o);this.patternFeatures.push(A)}else this.addFeature(b,M,T,u,{},o.subdivisionGranularity);o.featureIndex.insert(n[T].feature,M,T,P,this.index)}}update(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)}addFeatures(n,o,u){for(let f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,o,u,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,w2)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,x2),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,u,f,_,y){let b=this.layers[0].layout,M=b.get("line-join").evaluate(n,{}),T=b.get("line-cap"),P=b.get("line-miter-limit"),A=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(let O of o)this.addLine(O,n,M,T,P,A,f,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,_,f)}addLine(n,o,u,f,_,y,b,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=bl(n,b?M.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<n.length-1;re++)this.totalDistance+=n[re].dist(n[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=qc.types[o.type]==="Polygon",P=n.length;for(;P>=2&&n[P-1].equals(n[P-2]);)P--;let A=0;for(;A<P-1&&n[A].equals(n[A+1]);)A++;if(P<(T?3:2))return;u==="bevel"&&(_=1.05);let O=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray),j,G,Z,K,ce;this.e1=this.e2=-1,T&&(j=n[P-2],ce=n[A].sub(j)._unit()._perp());for(let re=A;re<P;re++){if(Z=re===P-1?T?n[A+1]:void 0:n[re+1],Z&&n[re].equals(Z))continue;ce&&(K=ce),j&&(G=j),j=n[re],ce=Z?Z.sub(j)._unit()._perp():K,K=K||ce;let se=K.add(ce);se.x===0&&se.y===0||se._unit();let ye=K.x*ce.x+K.y*ce.y,we=se.x*ce.x+se.y*ce.y,De=we!==0?1/we:1/0,Ve=2*Math.sqrt(2-2*we),Le=we<M2&&G&&Z,Be=K.x*ce.y-K.y*ce.x>0;if(Le&&re>A){let Ue=j.dist(G);if(Ue>2*O){let Ie=j.sub(j.sub(G)._mult(O/Ue)._round());this.updateDistance(G,Ie),this.addCurrentVertex(Ie,K,0,0,z),G=Ie}}let Ke=G&&Z,je=Ke?u:T?"butt":f;if(Ke&&je==="round"&&(De<y?je="miter":De<=2&&(je="fakeround")),je==="miter"&&De>_&&(je="bevel"),je==="bevel"&&(De>2&&(je="flipbevel"),De<_&&(je="miter")),G&&this.updateDistance(G,j),je==="miter")se._mult(De),this.addCurrentVertex(j,se,0,0,z);else if(je==="flipbevel"){if(De>100)se=ce.mult(-1);else{let Ue=De*K.add(ce).mag()/K.sub(ce).mag();se._perp()._mult(Ue*(Be?-1:1))}this.addCurrentVertex(j,se,0,0,z),this.addCurrentVertex(j,se.mult(-1),0,0,z)}else if(je==="bevel"||je==="fakeround"){let Ue=-Math.sqrt(De*De-1),Ie=Be?Ue:0,rt=Be?0:Ue;if(G&&this.addCurrentVertex(j,K,Ie,rt,z),je==="fakeround"){let ot=Math.round(180*Ve/Math.PI/20);for(let et=1;et<ot;et++){let Ze=et/ot;if(Ze!==.5){let pn=Ze-.5;Ze+=Ze*pn*(Ze-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*pn*pn+(.848013+ye*(.215638*ye-1.06021)))}let Dt=ce.sub(K)._mult(Ze)._add(K)._unit()._mult(Be?-1:1);this.addHalfVertex(j,Dt.x,Dt.y,!1,Be,0,z)}}Z&&this.addCurrentVertex(j,ce,-Ie,-rt,z)}else if(je==="butt")this.addCurrentVertex(j,se,0,0,z);else if(je==="square"){let Ue=G?1:-1;this.addCurrentVertex(j,se,Ue,Ue,z)}else je==="round"&&(G&&(this.addCurrentVertex(j,K,0,0,z),this.addCurrentVertex(j,K,1,1,z,!0)),Z&&(this.addCurrentVertex(j,ce,-1,-1,z,!0),this.addCurrentVertex(j,ce,0,0,z)));if(Le&&re<P-1){let Ue=j.dist(Z);if(Ue>2*O){let Ie=j.add(Z.sub(j)._mult(O/Ue)._round());this.updateDistance(j,Ie),this.addCurrentVertex(Ie,ce,0,0,z),j=Ie}}}}addCurrentVertex(n,o,u,f,_,y=!1){let b=o.y*f-o.x,M=-o.y-o.x*f;this.addHalfVertex(n,o.x+o.y*u,o.y-o.x*u,y,!1,u,_),this.addHalfVertex(n,b,M,y,!0,-f,_),this.distance>Xb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,o,u,f,_,y))}addHalfVertex({x:n,y:o},u,f,_,y,b,M){let T=.5*(this.lineClips?this.scaledDistance*(Xb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(_?1:0),(o<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(b===0?0:b<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let P=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,P,this.e2),M.primitiveLength++),y?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}let Yb,Kb;$e("LineBucket",Q_,{omit:["layers","patternFeatures"]});var Qb={get paint(){return Kb=Kb||new vr({"line-opacity":new tt(pe.paint_line["line-opacity"]),"line-color":new tt(pe.paint_line["line-color"]),"line-translate":new Ye(pe.paint_line["line-translate"]),"line-translate-anchor":new Ye(pe.paint_line["line-translate-anchor"]),"line-width":new tt(pe.paint_line["line-width"]),"line-gap-width":new tt(pe.paint_line["line-gap-width"]),"line-offset":new tt(pe.paint_line["line-offset"]),"line-blur":new tt(pe.paint_line["line-blur"]),"line-dasharray":new Oo(pe.paint_line["line-dasharray"]),"line-pattern":new Lc(pe.paint_line["line-pattern"]),"line-gradient":new Oc(pe.paint_line["line-gradient"])})},get layout(){return Yb=Yb||new vr({"line-cap":new Ye(pe.layout_line["line-cap"]),"line-join":new tt(pe.layout_line["line-join"]),"line-miter-limit":new Ye(pe.layout_line["line-miter-limit"]),"line-round-limit":new Ye(pe.layout_line["line-round-limit"]),"line-sort-key":new tt(pe.layout_line["line-sort-key"])})}};class S2 extends tt{possiblyEvaluate(n,o){return o=new an(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(n,o)}evaluate(n,o,u,f){return o=Xr({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,u,f)}}let Np;class E2 extends Qr{constructor(n){super(n,Qb),this.gradientVersion=0,Np||(Np=new S2(Qb.paint.properties["line-width"].specification),Np.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){let o=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof yn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,o){super.recalculate(n,o),this.paint._values["line-floorwidth"]=Np.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Q_(n)}queryRadius(n){let o=n,u=Jb(Qh("line-width",this,o),Qh("line-gap-width",this,o)),f=Qh("line-offset",this,o);return u/2+Math.abs(f)+Pp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:o,featureState:u,geometry:f,transform:_,pixelsToTileUnits:y}){let b=Dp(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,y),M=y/2*Jb(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),T=this.paint.get("line-offset").evaluate(o,u);return T&&(f=function(P,A){let O=[];for(let z=0;z<P.length;z++){let j=P[z],G=[];for(let Z=0;Z<j.length;Z++){let K=j[Z-1],ce=j[Z],re=j[Z+1],se=Z===0?new v(0,0):ce.sub(K)._unit()._perp(),ye=Z===j.length-1?new v(0,0):re.sub(ce)._unit()._perp(),we=se._add(ye)._unit(),De=we.x*ye.x+we.y*ye.y;De!==0&&we._mult(1/De),G.push(we._mult(A)._add(ce))}O.push(G)}return O}(f,T*y)),function(P,A,O){for(let z=0;z<A.length;z++){let j=A[z];if(P.length>=3){for(let G=0;G<j.length;G++)if(Vc(P,j[G]))return!0}if(OC(P,j,O))return!0}return!1}(b,f,M)}isTileClipped(){return!0}}function Jb(a,n){return n>0?n+2*a:a}let I2=vn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),T2=vn([{name:"a_projected_pos",components:3,type:"Float32"}],4);vn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let C2=vn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);vn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let e1=vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),P2=vn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function D2(a,n,o){return a.sections.forEach(u=>{u.text=function(f,_,y){let b=_.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?f=f.toLocaleUpperCase():b==="lowercase"&&(f=f.toLocaleLowerCase()),vi.applyArabicShaping&&(f=vi.applyArabicShaping(f)),f}(u.text,n,o)}),a}vn([{name:"triangle",components:3,type:"Uint16"}]),vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),vn([{type:"Float32",name:"offsetX"}]),vn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),vn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let ld={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Gn=24;let J_=4294967296,t1=1/J_,n1=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class ey{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,o,u=this.length){for(;this.pos<u;){let f=this.readVarint(),_=f>>3,y=this.pos;this.type=7&f,n(_,o,this),this.pos===y&&this.skip(f)}return o}readMessage(n,o){return this.readFields(n,o,this.readVarint()+this.pos)}readFixed32(){let n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){let n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){let n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*J_;return this.pos+=8,n}readSFixed64(){let n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*J_;return this.pos+=8,n}readFloat(){let n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){let n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){let o=this.buf,u,f;return f=o[this.pos++],u=127&f,f<128?u:(f=o[this.pos++],u|=(127&f)<<7,f<128?u:(f=o[this.pos++],u|=(127&f)<<14,f<128?u:(f=o[this.pos++],u|=(127&f)<<21,f<128?u:(f=o[this.pos],u|=(15&f)<<28,function(_,y,b){let M=b.buf,T,P;if(P=M[b.pos++],T=(112&P)>>4,P<128||(P=M[b.pos++],T|=(127&P)<<3,P<128)||(P=M[b.pos++],T|=(127&P)<<10,P<128)||(P=M[b.pos++],T|=(127&P)<<17,P<128)||(P=M[b.pos++],T|=(127&P)<<24,P<128)||(P=M[b.pos++],T|=(1&P)<<31,P<128))return Zc(_,T,y);throw new Error("Expected varint not more than 10 bytes")}(u,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){let n=this.readVarint()+this.pos,o=this.pos;return this.pos=n,n-o>=12&&n1?n1.decode(this.buf.subarray(o,n)):function(u,f,_){let y="",b=f;for(;b<_;){let M=u[b],T,P,A,O=null,z=M>239?4:M>223?3:M>191?2:1;if(b+z>_)break;z===1?M<128&&(O=M):z===2?(T=u[b+1],(192&T)==128&&(O=(31&M)<<6|63&T,O<=127&&(O=null))):z===3?(T=u[b+1],P=u[b+2],(192&T)==128&&(192&P)==128&&(O=(15&M)<<12|(63&T)<<6|63&P,(O<=2047||O>=55296&&O<=57343)&&(O=null))):z===4&&(T=u[b+1],P=u[b+2],A=u[b+3],(192&T)==128&&(192&P)==128&&(192&A)==128&&(O=(15&M)<<18|(63&T)<<12|(63&P)<<6|63&A,(O<=65535||O>=1114112)&&(O=null))),O===null?(O=65533,z=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),b+=z}return y}(this.buf,o,n)}readBytes(){let n=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,n);return this.pos=n,o}readPackedVarint(n=[],o){let u=this.readPackedEnd();for(;this.pos<u;)n.push(this.readVarint(o));return n}readPackedSVarint(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readFloat());return n}readPackedDouble(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){let o=this.readPackedEnd();for(;this.pos<o;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){let o=7&n;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(n,o){this.writeVarint(n<<3|o)}realloc(n){let o=this.length||16;for(;o<this.pos+n;)o*=2;if(o!==this.length){let u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.dataView=new DataView(u.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*t1),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*t1),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?function(o,u){let f,_;if(o>=0?(f=o%4294967296|0,_=o/4294967296|0):(f=~(-o%4294967296),_=~(-o/4294967296),4294967295^f?f=f+1|0:(f=0,_=_+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(y,b,M){M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,M.buf[M.pos]=127&(y>>>=7)}(f,0,u),function(y,b){let M=(7&y)<<4;b.buf[b.pos++]|=M|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(_,u)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;let o=this.pos;this.pos=function(f,_,y){for(let b,M,T=0;T<_.length;T++){if(b=_.charCodeAt(T),b>55295&&b<57344){if(!M){b>56319||T+1===_.length?(f[y++]=239,f[y++]=191,f[y++]=189):M=b;continue}if(b<56320){f[y++]=239,f[y++]=191,f[y++]=189,M=b;continue}b=M-55296<<10|b-56320|65536,M=null}else M&&(f[y++]=239,f[y++]=191,f[y++]=189,M=null);b<128?f[y++]=b:(b<2048?f[y++]=b>>6|192:(b<65536?f[y++]=b>>12|224:(f[y++]=b>>18|240,f[y++]=b>>12&63|128),f[y++]=b>>6&63|128),f[y++]=63&b|128)}return y}(this.buf,n,this.pos);let u=this.pos-o;u>=128&&r1(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){let o=n.length;this.writeVarint(o),this.realloc(o);for(let u=0;u<o;u++)this.buf[this.pos++]=n[u]}writeRawMessage(n,o){this.pos++;let u=this.pos;n(o,this);let f=this.pos-u;f>=128&&r1(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f}writeMessage(n,o,u){this.writeTag(n,2),this.writeRawMessage(o,u)}writePackedVarint(n,o){o.length&&this.writeMessage(n,A2,o)}writePackedSVarint(n,o){o.length&&this.writeMessage(n,R2,o)}writePackedBoolean(n,o){o.length&&this.writeMessage(n,L2,o)}writePackedFloat(n,o){o.length&&this.writeMessage(n,k2,o)}writePackedDouble(n,o){o.length&&this.writeMessage(n,N2,o)}writePackedFixed32(n,o){o.length&&this.writeMessage(n,O2,o)}writePackedSFixed32(n,o){o.length&&this.writeMessage(n,F2,o)}writePackedFixed64(n,o){o.length&&this.writeMessage(n,z2,o)}writePackedSFixed64(n,o){o.length&&this.writeMessage(n,j2,o)}writeBytesField(n,o){this.writeTag(n,2),this.writeBytes(o)}writeFixed32Field(n,o){this.writeTag(n,5),this.writeFixed32(o)}writeSFixed32Field(n,o){this.writeTag(n,5),this.writeSFixed32(o)}writeFixed64Field(n,o){this.writeTag(n,1),this.writeFixed64(o)}writeSFixed64Field(n,o){this.writeTag(n,1),this.writeSFixed64(o)}writeVarintField(n,o){this.writeTag(n,0),this.writeVarint(o)}writeSVarintField(n,o){this.writeTag(n,0),this.writeSVarint(o)}writeStringField(n,o){this.writeTag(n,2),this.writeString(o)}writeFloatField(n,o){this.writeTag(n,5),this.writeFloat(o)}writeDoubleField(n,o){this.writeTag(n,1),this.writeDouble(o)}writeBooleanField(n,o){this.writeVarintField(n,+o)}}function Zc(a,n,o){return o?4294967296*n+(a>>>0):4294967296*(n>>>0)+(a>>>0)}function r1(a,n,o){let u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(u);for(let f=o.pos-1;f>=a;f--)o.buf[f+u]=o.buf[f]}function A2(a,n){for(let o=0;o<a.length;o++)n.writeVarint(a[o])}function R2(a,n){for(let o=0;o<a.length;o++)n.writeSVarint(a[o])}function k2(a,n){for(let o=0;o<a.length;o++)n.writeFloat(a[o])}function N2(a,n){for(let o=0;o<a.length;o++)n.writeDouble(a[o])}function L2(a,n){for(let o=0;o<a.length;o++)n.writeBoolean(a[o])}function O2(a,n){for(let o=0;o<a.length;o++)n.writeFixed32(a[o])}function F2(a,n){for(let o=0;o<a.length;o++)n.writeSFixed32(a[o])}function z2(a,n){for(let o=0;o<a.length;o++)n.writeFixed64(a[o])}function j2(a,n){for(let o=0;o<a.length;o++)n.writeSFixed64(a[o])}function B2(a,n,o){a===1&&o.readMessage(U2,n)}function U2(a,n,o){if(a===3){let{id:u,bitmap:f,width:_,height:y,left:b,top:M,advance:T}=o.readMessage(V2,{});n.push({id:u,bitmap:new Jh({width:_+6,height:y+6},f),metrics:{width:_,height:y,left:b,top:M,advance:T}})}}function V2(a,n,o){a===1?n.id=o.readVarint():a===2?n.bitmap=o.readBytes():a===3?n.width=o.readVarint():a===4?n.height=o.readVarint():a===5?n.left=o.readSVarint():a===6?n.top=o.readSVarint():a===7&&(n.advance=o.readVarint())}function i1(a){let n=0,o=0;for(let y of a)n+=y.w*y.h,o=Math.max(o,y.w);a.sort((y,b)=>b.h-y.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}],f=0,_=0;for(let y of a)for(let b=u.length-1;b>=0;b--){let M=u[b];if(!(y.w>M.w||y.h>M.h)){if(y.x=M.x,y.y=M.y,_=Math.max(_,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===M.w&&y.h===M.h){let T=u.pop();T&&b<u.length&&(u[b]=T)}else y.h===M.h?(M.x+=y.w,M.w-=y.w):y.w===M.w?(M.y+=y.h,M.h-=y.h):(u.push({x:M.x+y.w,y:M.y,w:M.w-y.w,h:y.h}),M.y+=y.h,M.h-=y.h);break}}return{w:f,h:_,fill:n/(f*_)||0}}class ty{constructor(n,{pixelRatio:o,version:u,stretchX:f,stretchY:_,content:y,textFitWidth:b,textFitHeight:M}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=f,this.stretchY=_,this.content=y,this.version=u,this.textFitWidth=b,this.textFitHeight=M}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class o1{constructor(n,o){let u={},f={};this.haveRenderCallbacks=[];let _=[];this.addImages(n,u,_),this.addImages(o,f,_);let{w:y,h:b}=i1(_),M=new Ur({width:y||1,height:b||1});for(let T in n){let P=n[T],A=u[T].paddedRect;Ur.copy(P.data,M,{x:0,y:0},{x:A.x+1,y:A.y+1},P.data)}for(let T in o){let P=o[T],A=f[T].paddedRect,O=A.x+1,z=A.y+1,j=P.data.width,G=P.data.height;Ur.copy(P.data,M,{x:0,y:0},{x:O,y:z},P.data),Ur.copy(P.data,M,{x:0,y:G-1},{x:O,y:z-1},{width:j,height:1}),Ur.copy(P.data,M,{x:0,y:0},{x:O,y:z+G},{width:j,height:1}),Ur.copy(P.data,M,{x:j-1,y:0},{x:O-1,y:z},{width:1,height:G}),Ur.copy(P.data,M,{x:0,y:0},{x:O+j,y:z},{width:1,height:G})}this.image=M,this.iconPositions=u,this.patternPositions=f}addImages(n,o,u){for(let f in n){let _=n[f],y={x:0,y:0,w:_.data.width+2,h:_.data.height+2};u.push(y),o[f]=new ty(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(n,o){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let u in n.updatedImages)this.patchUpdatedImage(this.iconPositions[u],n.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],n.getImage(u),o)}patchUpdatedImage(n,o,u){if(!n||!o||n.version===o.version)return;n.version=o.version;let[f,_]=n.tl;u.update(o.data,void 0,{x:f,y:_})}}var Ea;$e("ImagePosition",ty),$e("ImageAtlas",o1),h.ao=void 0,(Ea=h.ao||(h.ao={}))[Ea.none=0]="none",Ea[Ea.horizontal=1]="horizontal",Ea[Ea.vertical=2]="vertical",Ea[Ea.horizontalOnly=3]="horizontalOnly";class cd{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(n,o,u){let f=new cd;return f.scale=n||1,f.fontStack=o,f.verticalAlign=u||"bottom",f}static forImage(n,o){let u=new cd;return u.imageName=n,u.verticalAlign=o||"bottom",u}}class Wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){let u=new Wc;for(let f=0;f<n.sections.length;f++){let _=n.sections[f];_.image?u.addImageSection(_):u.addTextSection(_,o)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let o="";for(let u=0;u<n.length;u++){let f=n.charCodeAt(u+1)||null,_=n.charCodeAt(u-1)||null;o+=f&&xp(f)&&!ld[n[u+1]]||_&&xp(_)&&!ld[n[u-1]]||!ld[n[u]]?n[u]:ld[n[u]]}return o}(this.text)}trim(){let n=0;for(let u=0;u<this.text.length&&Op[this.text.charCodeAt(u)];u++)n++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&Op[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){let u=new Wc;return u.text=this.text.substring(n,o),u.sectionIndex=this.sectionIndex.slice(n,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}getMaxImageSize(n){let o=0,u=0;for(let f=0;f<this.length();f++){let _=this.getSection(f);if(_.imageName){let y=n[_.imageName];if(!y)continue;let b=y.displaySize;o=Math.max(o,b[0]),u=Math.max(u,b[1])}}return{maxImageWidth:o,maxImageHeight:u}}addTextSection(n,o){this.text+=n.text,this.sections.push(cd.forText(n.scale,n.fontStack||o,n.verticalAlign));let u=this.sections.length-1;for(let f=0;f<n.text.length;++f)this.sectionIndex.push(u)}addImageSection(n){let o=n.image?n.image.name:"";if(o.length===0)return void bn("Can't add FormattedSection with an empty image.");let u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(cd.forImage(o,n.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):bn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lp(a,n,o,u,f,_,y,b,M,T,P,A,O,z,j){let G=Wc.fromFeature(a,f),Z;A===h.ao.vertical&&G.verticalizePunctuation();let{processBidirectionalText:K,processStyledBidirectionalText:ce}=vi;if(K&&G.sections.length===1){Z=[];let ye=K(G.toString(),ny(G,T,_,n,u,z));for(let we of ye){let De=new Wc;De.text=we,De.sections=G.sections;for(let Ve=0;Ve<we.length;Ve++)De.sectionIndex.push(0);Z.push(De)}}else if(ce){Z=[];let ye=ce(G.text,G.sectionIndex,ny(G,T,_,n,u,z));for(let we of ye){let De=new Wc;De.text=we[0],De.sectionIndex=we[1],De.sections=G.sections,Z.push(De)}}else Z=function(ye,we){let De=[],Ve=ye.text,Le=0;for(let Be of we)De.push(ye.substring(Le,Be)),Le=Be;return Le<Ve.length&&De.push(ye.substring(Le,Ve.length)),De}(G,ny(G,T,_,n,u,z));let re=[],se={positionedLines:re,text:G.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function(ye,we,De,Ve,Le,Be,Ke,je,Ue,Ie,rt,ot){let et=0,Ze=0,Dt=0,pn=0,zn=je==="right"?1:je==="left"?0:.5,ur=Gn/ot,Si=0;for(let cn of Le){cn.trim();let $n=cn.getMaxScale(),er={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Si]=er;let tr=er.positionedGlyphs,Rr=0;if(!cn.length()){Ze+=Be,++Si;continue}let Ei=q2(Ve,cn,ur);for(let Gr=0;Gr<cn.length();Gr++){let jn=cn.getSection(Gr),qn=cn.getSectionIndex(Gr),Zn=cn.getCharCode(Gr),An=Z2(Ue,rt,Zn),sn;if(jn.imageName){if(ye.iconsInText=!0,jn.scale=jn.scale*ur,sn=X2(jn,An,$n,Ei,Ve),!sn)continue;Rr=Math.max(Rr,sn.imageOffset)}else if(sn=W2(jn,Zn,An,Ei,we,De),!sn)continue;let{rect:io,metrics:Qc,baselineOffset:oo}=sn;tr.push({glyph:Zn,imageName:jn.imageName,x:et,y:Ze+oo+-17,vertical:An,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:qn,metrics:Qc,rect:io}),An?(ye.verticalizable=!0,et+=(jn.imageName?Qc.advance:Gn)*jn.scale+Ie):et+=Qc.advance*jn.scale+Ie}tr.length!==0&&(Dt=Math.max(et-Ie,Dt),Y2(tr,0,tr.length-1,zn)),et=0,er.lineOffset=Math.max(Rr,($n-1)*Gn);let Hn=Be*$n+Rr;Ze+=Hn,pn=Math.max(Hn,pn),++Si}let{horizontalAlign:Vr,verticalAlign:Jn}=ry(Ke);(function(cn,$n,er,tr,Rr,Ei,Hn,Gr,jn){let qn=($n-er)*Rr,Zn=0;Zn=Ei!==Hn?-Gr*tr- -17:-tr*jn*Hn+.5*Hn;for(let An of cn)for(let sn of An.positionedGlyphs)sn.x+=qn,sn.y+=Zn})(ye.positionedLines,zn,Vr,Jn,Dt,pn,Be,Ze,Le.length),ye.top+=-Jn*Ze,ye.bottom=ye.top+Ze,ye.left+=-Vr*Dt,ye.right=ye.left+Dt}(se,n,o,u,Z,y,b,M,A,T,O,j),!function(ye){for(let we of ye)if(we.positionedGlyphs.length!==0)return!1;return!0}(re)&&se}let Op={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},$2={40:!0};function s1(a,n,o,u,f,_){if(n.imageName){let y=u[n.imageName];return y?y.displaySize[0]*n.scale*Gn/_+f:0}{let y=o[n.fontStack],b=y&&y[a];return b?b.metrics.advance*n.scale+f:0}}function a1(a,n,o,u){let f=Math.pow(a-n,2);return u?a<n?f/2:2*f:f+Math.abs(o)*o}function H2(a,n,o){let u=0;return a===10&&(u-=1e4),o&&(u+=150),a!==40&&a!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function l1(a,n,o,u,f,_){let y=null,b=a1(n,o,f,_);for(let M of u){let T=a1(n-M.x,o,f,_)+M.badness;T<=b&&(y=M,b=T)}return{index:a,x:n,priorBreak:y,badness:b}}function c1(a){return a?c1(a.priorBreak).concat(a.index):[]}function ny(a,n,o,u,f,_){if(!a)return[];let y=[],b=function(A,O,z,j,G,Z){let K=0;for(let ce=0;ce<A.length();ce++){let re=A.getSection(ce);K+=s1(A.getCharCode(ce),re,j,G,O,Z)}return K/Math.max(1,Math.ceil(K/z))}(a,n,o,u,f,_),M=a.text.indexOf("\u200B")>=0,T=0;for(let A=0;A<a.length();A++){let O=a.getSection(A),z=a.getCharCode(A);if(Op[z]||(T+=s1(z,O,u,f,n,_)),A<a.length()-1){let j=!((P=z)<11904)&&(!!Pt["CJK Compatibility Forms"](P)||!!Pt["CJK Compatibility"](P)||!!Pt["CJK Strokes"](P)||!!Pt["CJK Symbols and Punctuation"](P)||!!Pt["Enclosed CJK Letters and Months"](P)||!!Pt["Halfwidth and Fullwidth Forms"](P)||!!Pt["Ideographic Description Characters"](P)||!!Pt["Vertical Forms"](P)||Uh.test(String.fromCodePoint(P)));(G2[z]||j||O.imageName||A!==a.length()-2&&$2[a.getCharCode(A+1)])&&y.push(l1(A+1,T,b,y,H2(z,a.getCharCode(A+1),j&&M),!1))}}var P;return c1(l1(a.length(),T,b,y,0,!0))}function ry(a){let n=.5,o=.5;switch(a){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function q2(a,n,o){let u=n.getMaxScale()*Gn,{maxImageWidth:f,maxImageHeight:_}=n.getMaxImageSize(a),y=Math.max(u,_*o);return{verticalLineContentWidth:Math.max(u,f*o),horizontalLineContentHeight:y}}function u1(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function Z2(a,n,o){return!(a===h.ao.horizontal||!n&&!Vh(o)||n&&(Op[o]||(u=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(u)))));var u}function W2(a,n,o,u,f,_){let y=_[a.fontStack],b=function(T,P,A,O){if(T&&T.rect)return T;let z=P[A.fontStack],j=z&&z[O];return j?{rect:null,metrics:j.metrics}:null}(y&&y[n],f,a,n);if(b===null)return null;let M;if(o)M=u.verticalLineContentWidth-a.scale*Gn;else{let T=u1(a.verticalAlign);M=(u.horizontalLineContentHeight-a.scale*Gn)*T}return{rect:b.rect,metrics:b.metrics,baselineOffset:M}}function X2(a,n,o,u,f){let _=f[a.imageName];if(!_)return null;let y=_.paddedRect,b=_.displaySize,M={width:b[0],height:b[1],left:1,top:-3,advance:n?b[1]:b[0]},T;if(n)T=u.verticalLineContentWidth-b[1]*a.scale;else{let P=u1(a.verticalAlign);T=(u.horizontalLineContentHeight-b[1]*a.scale)*P}return{rect:y,metrics:M,baselineOffset:T,imageOffset:(n?b[0]:b[1])*a.scale-Gn*o}}function Y2(a,n,o,u){if(u===0)return;let f=a[o],_=(a[o].x+f.metrics.advance*f.scale)*u;for(let y=n;y<=o;y++)a[y].x-=_}function K2(a,n,o){let{horizontalAlign:u,verticalAlign:f}=ry(o),_=n[0]-a.displaySize[0]*u,y=n[1]-a.displaySize[1]*f;return{image:a,top:y,bottom:y+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function h1(a){var n,o;let u=a.left,f=a.top,_=a.right-u,y=a.bottom-f,b=(n=a.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",M=(o=a.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",T=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(M==="proportional"){if(b==="stretchOnly"&&_/y<T||b==="proportional"){let P=Math.ceil(y*T);u*=P/_,_=P}}else if(b==="proportional"&&M==="stretchOnly"&&T!==0&&_/y>T){let P=Math.ceil(_/T);f*=P/y,y=P}return{x1:u,y1:f,x2:u+_,y2:f+y}}function d1(a,n,o,u,f,_){let y=a.image,b;if(y.content){let Z=y.content,K=y.pixelRatio||1;b=[Z[0]/K,Z[1]/K,y.displaySize[0]-Z[2]/K,y.displaySize[1]-Z[3]/K]}let M=n.left*_,T=n.right*_,P,A,O,z;o==="width"||o==="both"?(z=f[0]+M-u[3],A=f[0]+T+u[1]):(z=f[0]+(M+T-y.displaySize[0])/2,A=z+y.displaySize[0]);let j=n.top*_,G=n.bottom*_;return o==="height"||o==="both"?(P=f[1]+j-u[0],O=f[1]+G+u[2]):(P=f[1]+(j+G-y.displaySize[1])/2,O=P+y.displaySize[1]),{image:y,top:P,right:A,bottom:O,left:z,collisionPadding:b}}let Ss=128,Ia=32640;function f1(a,n){let{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new an(a+1))};if(o.kind==="source")return{kind:"source"};{let{zoomStops:u,interpolationType:f}=o,_=0;for(;_<u.length&&u[_]<=a;)_++;_=Math.max(0,_-1);let y=_;for(;y<u.length&&u[y]<a+1;)y++;y=Math.min(u.length-1,y);let b=u[_],M=u[y];return o.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:M,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:M,minSize:o.evaluate(new an(b)),maxSize:o.evaluate(new an(M)),interpolationType:f}}}function iy(a,n,o){let u="never",f=a.get(n);return f?u=f:a.get(o)&&(u="always"),u}let Q2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fp(a,n,o,u,f,_,y,b,M,T,P,A,O){let z=b?Math.min(Ia,Math.round(b[0])):0,j=b?Math.min(Ia,Math.round(b[1])):0;a.emplaceBack(n,o,Math.round(32*u),Math.round(32*f),_,y,(z<<1)+(M?1:0),j,16*T,16*P,256*A,256*O)}function oy(a,n,o){a.emplaceBack(n.x,n.y,o),a.emplaceBack(n.x,n.y,o),a.emplaceBack(n.x,n.y,o),a.emplaceBack(n.x,n.y,o)}function J2(a){for(let n of a.sections)if(Mp(n.text))return!0;return!1}class sy{constructor(n){this.layoutVertexArray=new Oe,this.indexArray=new Zt,this.programConfigurations=n,this.segments=new ht,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new qe,this.hasVisibleVertices=!1,this.placedSymbolArray=new U}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,o,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,I2.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,T2.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Q2,!0),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",sy);class ay{constructor(n,o,u){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new u,this.segments=new ht,this.collisionVertexArray=new Ot}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,C2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",ay);class Xc{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(y=>y.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=f1(this.zoom,o["text-size"]),this.iconSizeData=f1(this.zoom,o["icon-size"]);let u=this.layers[0].layout,f=u.get("symbol-sort-key"),_=u.get("symbol-z-order");this.canOverlap=iy(u,"text-overlap","text-allow-overlap")!=="never"||iy(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(y=>h.ao[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=n.sourceID}createArrays(){this.text=new sy(new Br(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new sy(new Br(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Y,this.lineVertexArray=new Q,this.symbolInstances=new W,this.textAnchorOffsets=new J}calculateGlyphDependencies(n,o,u,f,_){for(let y=0;y<n.length;y++)if(o[n.charCodeAt(y)]=!0,(u||f)&&_){let b=ld[n.charAt(y)];b&&(o[b.charCodeAt(0)]=!0)}}populate(n,o,u){let f=this.layers[0],_=f.layout,y=_.get("text-font"),b=_.get("text-field"),M=_.get("icon-image"),T=(b.value.kind!=="constant"||b.value.value instanceof gr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),P=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,A=_.get("symbol-sort-key");if(this.features=[],!T&&!P)return;let O=o.iconDependencies,z=o.glyphDependencies,j=o.availableImages,G=new an(this.zoom,{globalState:this.globalState});for(let{feature:Z,id:K,index:ce,sourceLayerIndex:re}of n){let se=f._featureFilter.needGeometry,ye=ro(Z,se);if(!f._featureFilter.filter(G,ye,u))continue;let we,De;if(se||(ye.geometry=Uo(Z)),T){let Le=f.getValueAndResolveTokens("text-field",ye,u,j),Be=gr.factory(Le),Ke=this.hasRTLText=this.hasRTLText||J2(Be);(!Ke||vi.getRTLTextPluginStatus()==="unavailable"||Ke&&vi.isParsed())&&(we=D2(Be,f,ye))}if(P){let Le=f.getValueAndResolveTokens("icon-image",ye,u,j);De=Le instanceof zr?Le:zr.fromString(Le)}if(!we&&!De)continue;let Ve=this.sortFeaturesByKey?A.evaluate(ye,{},u):void 0;if(this.features.push({id:K,text:we,icon:De,index:ce,sourceLayerIndex:re,geometry:ye.geometry,properties:Z.properties,type:qc.types[Z.type],sortKey:Ve}),De&&(O[De.name]=!0),we){let Le=y.evaluate(ye,{},u).join(","),Be=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ao.vertical)>=0;for(let Ke of we.sections)if(Ke.image)O[Ke.image.name]=!0;else{let je=Rc(we.toString()),Ue=Ke.fontStack||Le,Ie=z[Ue]=z[Ue]||{};this.calculateGlyphDependencies(Ke.text,Ie,Be,this.allowVerticalPlacement,je)}}}_.get("symbol-placement")==="line"&&(this.features=function(Z){let K={},ce={},re=[],se=0;function ye(Le){re.push(Z[Le]),se++}function we(Le,Be,Ke){let je=ce[Le];return delete ce[Le],ce[Be]=je,re[je].geometry[0].pop(),re[je].geometry[0]=re[je].geometry[0].concat(Ke[0]),je}function De(Le,Be,Ke){let je=K[Be];return delete K[Be],K[Le]=je,re[je].geometry[0].shift(),re[je].geometry[0]=Ke[0].concat(re[je].geometry[0]),je}function Ve(Le,Be,Ke){let je=Ke?Be[0][Be[0].length-1]:Be[0][0];return`${Le}:${je.x}:${je.y}`}for(let Le=0;Le<Z.length;Le++){let Be=Z[Le],Ke=Be.geometry,je=Be.text?Be.text.toString():null;if(!je){ye(Le);continue}let Ue=Ve(je,Ke),Ie=Ve(je,Ke,!0);if(Ue in ce&&Ie in K&&ce[Ue]!==K[Ie]){let rt=De(Ue,Ie,Ke),ot=we(Ue,Ie,re[rt].geometry);delete K[Ue],delete ce[Ie],ce[Ve(je,re[ot].geometry,!0)]=ot,re[rt].geometry=null}else Ue in ce?we(Ue,Ie,Ke):Ie in K?De(Ue,Ie,Ke):(ye(Le),K[Ue]=se-1,ce[Ie]=se-1)}return re.filter(Le=>Le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,K)=>Z.sortKey-K.sortKey)}update(n,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){let u=this.lineVertexArray.length;if(n.segment!==void 0){let f=n.dist(o[n.segment+1]),_=n.dist(o[n.segment]),y={};for(let b=n.segment+1;b<o.length;b++)y[b]={x:o[b].x,y:o[b].y,tileUnitDistanceFromAnchor:f},b<o.length-1&&(f+=o[b+1].dist(o[b]));for(let b=n.segment||0;b>=0;b--)y[b]={x:o[b].x,y:o[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=o[b-1].dist(o[b]));for(let b=0;b<o.length;b++){let M=y[b];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,o,u,f,_,y,b,M,T,P,A,O){let z=n.indexArray,j=n.layoutVertexArray,G=n.segments.prepareSegment(4*o.length,j,z,this.canOverlap?y.sortKey:void 0),Z=this.glyphOffsetArray.length,K=G.vertexLength,ce=this.allowVerticalPlacement&&b===h.ao.vertical?Math.PI/2:0,re=y.text&&y.text.sections;for(let se=0;se<o.length;se++){let{tl:ye,tr:we,bl:De,br:Ve,tex:Le,pixelOffsetTL:Be,pixelOffsetBR:Ke,minFontScaleX:je,minFontScaleY:Ue,glyphOffset:Ie,isSDF:rt,sectionIndex:ot}=o[se],et=G.vertexLength,Ze=Ie[1];Fp(j,M.x,M.y,ye.x,Ze+ye.y,Le.x,Le.y,u,rt,Be.x,Be.y,je,Ue),Fp(j,M.x,M.y,we.x,Ze+we.y,Le.x+Le.w,Le.y,u,rt,Ke.x,Be.y,je,Ue),Fp(j,M.x,M.y,De.x,Ze+De.y,Le.x,Le.y+Le.h,u,rt,Be.x,Ke.y,je,Ue),Fp(j,M.x,M.y,Ve.x,Ze+Ve.y,Le.x+Le.w,Le.y+Le.h,u,rt,Ke.x,Ke.y,je,Ue),oy(n.dynamicLayoutVertexArray,M,ce),z.emplaceBack(et,et+2,et+1),z.emplaceBack(et+1,et+2,et+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ie[0]),se!==o.length-1&&ot===o[se+1].sectionIndex||n.programConfigurations.populatePaintArrays(j.length,y,y.index,{},O,re&&re[ot])}n.placedSymbolArray.emplaceBack(M.x,M.y,Z,this.glyphOffsetArray.length-Z,K,T,P,M.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],b,0,!1,0,A)}_addCollisionDebugVertex(n,o,u,f,_,y){return o.emplaceBack(0,0),n.emplaceBack(u.x,u.y,f,_,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(n,o,u,f,_,y,b){let M=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),T=M.vertexLength,P=_.layoutVertexArray,A=_.collisionVertexArray,O=b.anchorX,z=b.anchorY;this._addCollisionDebugVertex(P,A,y,O,z,new v(n,o)),this._addCollisionDebugVertex(P,A,y,O,z,new v(u,o)),this._addCollisionDebugVertex(P,A,y,O,z,new v(u,f)),this._addCollisionDebugVertex(P,A,y,O,z,new v(n,f)),M.vertexLength+=4;let j=_.indexArray;j.emplaceBack(T,T+1),j.emplaceBack(T+1,T+2),j.emplaceBack(T+2,T+3),j.emplaceBack(T+3,T),M.primitiveLength+=4}addDebugCollisionBoxes(n,o,u,f){for(let _=n;_<o;_++){let y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ay(ft,e1.members,$t),this.iconCollisionBox=new ay(ft,e1.members,$t);for(let n=0;n<this.symbolInstances.length;n++){let o=this.symbolInstances.get(n);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(n,o,u,f,_,y,b,M,T){let P={};for(let A=o;A<u;A++){let O=n.get(A);P.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.textFeatureIndex=O.featureIndex;break}for(let A=f;A<_;A++){let O=n.get(A);P.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.verticalTextFeatureIndex=O.featureIndex;break}for(let A=y;A<b;A++){let O=n.get(A);P.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.iconFeatureIndex=O.featureIndex;break}for(let A=M;A<T;A++){let O=n.get(A);P.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.verticalIconFeatureIndex=O.featureIndex;break}return P}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){let u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,o){let u=n.placedSymbolArray.get(o),f=u.vertexStartIndex+4*u.numGlyphs;for(let _=u.vertexStartIndex;_<f;_+=4)n.indexArray.emplaceBack(_,_+2,_+1),n.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let o=Math.sin(n),u=Math.cos(n),f=[],_=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);let M=this.symbolInstances.get(b);f.push(0|Math.round(o*M.anchorX+u*M.anchorY)),_.push(M.featureIndex)}return y.sort((b,M)=>f[b]-f[M]||_[M]-_[b]),y}addToSortKeyRanges(n,o){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let o of this.symbolInstanceIndexes){let u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((f,_,y)=>{f>=0&&y.indexOf(f)===_&&this.addIndicesForPlacedSymbol(this.text,f)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let p1,m1;$e("SymbolBucket",Xc,{omit:["layers","collisionBoxArray","features","compareText"]}),Xc.MAX_GLYPHS=65535,Xc.addDynamicAttributes=oy;var ly={get paint(){return m1=m1||new vr({"icon-opacity":new tt(pe.paint_symbol["icon-opacity"]),"icon-color":new tt(pe.paint_symbol["icon-color"]),"icon-halo-color":new tt(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new tt(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tt(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new tt(pe.paint_symbol["text-opacity"]),"text-color":new tt(pe.paint_symbol["text-color"],{runtimeType:Kn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new tt(pe.paint_symbol["text-halo-color"]),"text-halo-width":new tt(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new tt(pe.paint_symbol["text-halo-blur"]),"text-translate":new Ye(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(pe.paint_symbol["text-translate-anchor"])})},get layout(){return p1=p1||new vr({"symbol-placement":new Ye(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tt(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new tt(pe.layout_symbol["icon-size"]),"icon-text-fit":new Ye(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new tt(pe.layout_symbol["icon-image"]),"icon-rotate":new tt(pe.layout_symbol["icon-rotate"]),"icon-padding":new tt(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new tt(pe.layout_symbol["icon-offset"]),"icon-anchor":new tt(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(pe.layout_symbol["text-rotation-alignment"]),"text-field":new tt(pe.layout_symbol["text-field"]),"text-font":new tt(pe.layout_symbol["text-font"]),"text-size":new tt(pe.layout_symbol["text-size"]),"text-max-width":new tt(pe.layout_symbol["text-max-width"]),"text-line-height":new Ye(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new tt(pe.layout_symbol["text-letter-spacing"]),"text-justify":new tt(pe.layout_symbol["text-justify"]),"text-radial-offset":new tt(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new tt(pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new tt(pe.layout_symbol["text-anchor"]),"text-max-angle":new Ye(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(pe.layout_symbol["text-writing-mode"]),"text-rotate":new tt(pe.layout_symbol["text-rotate"]),"text-padding":new Ye(pe.layout_symbol["text-padding"]),"text-keep-upright":new Ye(pe.layout_symbol["text-keep-upright"]),"text-transform":new tt(pe.layout_symbol["text-transform"]),"text-offset":new tt(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(pe.layout_symbol["text-optional"])})}};class g1{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:ea,this.defaultValue=n}evaluate(n){if(n.formattedSection){let o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",g1,{omit:["defaultValue"]});class zp extends Qr{constructor(n){super(n,ly)}recalculate(n,o){if(super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let u=this.layout.get("text-writing-mode");if(u){let f=[];for(let _ of u)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,o,u,f){let _=this.layout.get(n).evaluate(o,{},u,f),y=this._unevaluatedLayout._values[n];return y.isDataDriven()||Sc(y.value)||!_?_:function(b,M){return M.replace(/{([^{}]+)}/g,(T,P)=>b&&P in b?String(b[P]):"")}(o.properties,_)}createBucket(n){return new Xc(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let n of ly.paint.overridableProperties){if(!zp.hasPaintOverride(this.layout,n))continue;let o=this.paint.get(n),u=new g1(o),f=new Ph(u,o.property.specification),_=null;_=o.value.kind==="constant"||o.value.kind==="source"?new cl("source",f):new Dh("composite",f,o.value.zoomStops),this.paint._values[n]=new Vi(o.property,_,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&zp.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){let u=n.get("text-field"),f=ly.paint.properties[o],_=!1,y=b=>{for(let M of b)if(f.overrides&&f.overrides.hasOverride(M))return void(_=!0)};if(u.value.kind==="constant"&&u.value.value instanceof gr)y(u.value.value.sections);else if(u.value.kind==="source"){let b=T=>{_||(T instanceof Ji&&nt(T.value)===Do?y(T.value.sections):T instanceof us?y(T.sections):T.eachChild(b))},M=u.value;M._styleExpression&&b(M._styleExpression.expression)}return _}}let _1;var eP={get paint(){return _1=_1||new vr({"background-color":new Ye(pe.paint_background["background-color"]),"background-pattern":new Oo(pe.paint_background["background-pattern"]),"background-opacity":new Ye(pe.paint_background["background-opacity"])})}};class tP extends Qr{constructor(n){super(n,eP)}}let y1;var nP={get paint(){return y1=y1||new vr({"raster-opacity":new Ye(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(pe.paint_raster["raster-saturation"]),"raster-contrast":new Ye(pe.paint_raster["raster-contrast"]),"raster-resampling":new Ye(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(pe.paint_raster["raster-fade-duration"])})}};class rP extends Qr{constructor(n){super(n,nP)}}class iP extends Qr{constructor(n){super(n,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class oP{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let sP={once:!0},cy=63710088e-1;class Ta{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ta(Xs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){let o=Math.PI/180,u=this.lat*o,f=n.lat*o,_=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((n.lng-this.lng)*o);return cy*Math.acos(Math.min(_,1))}static convert(n){if(n instanceof Ta)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Ta(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Ta(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let v1=2*Math.PI*cy;function x1(a){return v1*Math.cos(a*Math.PI/180)}function b1(a){return(180+a)/360}function w1(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function M1(a,n){return a/x1(n)}function uy(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function S1(a,n){return a*x1(uy(n))}class ud{constructor(n,o,u=0){this.x=+n,this.y=+o,this.z=+u}static fromLngLat(n,o=0){let u=Ta.convert(n);return new ud(b1(u.lng),w1(u.lat),M1(o,u.lat))}toLngLat(){return new Ta(360*this.x-180,uy(this.y))}toAltitude(){return S1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/v1*(n=uy(this.y),1/Math.cos(n*Math.PI/180));var n}}function E1(a,n,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[a*u-2*Math.PI*6378137/2,n*u-2*Math.PI*6378137/2]}class hy{constructor(n,o,u){if(!function(f,_,y){return!(f<0||f>25||y<0||y>=Math.pow(2,f)||_<0||_>=Math.pow(2,f))}(n,o,u))throw new Error(`x=${o}, y=${u}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=o,this.y=u,this.key=Yc(0,n,n,o,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o,u){let f=(y=this.y,b=this.z,M=E1(256*(_=this.x),256*(y=Math.pow(2,b)-y-1),b),T=E1(256*(_+1),256*(y+1),b),M[0]+","+M[1]+","+T[0]+","+T[1]);var _,y,b,M,T;let P=function(A,O,z){let j,G="";for(let Z=A;Z>0;Z--)j=1<<Z-1,G+=(O&j?1:0)+(z&j?2:0);return G}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,f)}isChildOf(n){let o=this.z-n.z;return o>0&&n.x===this.x>>o&&n.y===this.y>>o}getTilePoint(n){let o=Math.pow(2,this.z);return new v((n.x*o-this.x)*Ht,(n.y*o-this.y)*Ht)}toString(){return`${this.z}/${this.x}/${this.y}`}}class I1{constructor(n,o){this.wrap=n,this.canonical=o,this.key=Yc(n,o.z,o.z,o.x,o.y)}}class Mi{constructor(n,o,u,f,_){if(this.terrainRttPosMatrix32f=null,n<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${u}`);this.overscaledZ=n,this.wrap=o,this.canonical=new hy(u,+f,+_),this.key=Yc(o,n,u,f,_)}clone(){return new Mi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);let o=this.canonical.z-n;return n>this.canonical.z?new Mi(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mi(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);let u=this.canonical.z-n;return n>this.canonical.z?Yc(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y):Yc(this.wrap*+o,n,n,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(n){if(n.wrap!==this.wrap)return!1;let o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new Mi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let o=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Mi(o,this.wrap,o,u,f),new Mi(o,this.wrap,o,u+1,f),new Mi(o,this.wrap,o,u,f+1),new Mi(o,this.wrap,o,u+1,f+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Mi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Mi(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new I1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new ud(n.x-this.wrap,n.y))}}function Yc(a,n,o,u,f){(a*=2)<0&&(a=-1*a-1);let _=1<<o;return(_*_*a+_*f+u).toString(36)+o.toString(36)+n.toString(36)}function hd(a,n){return n?a.properties[n]:a.id}$e("CanonicalTileID",hy),$e("OverscaledTileID",Mi,{omit:["terrainRttPosMatrix32f"]});class wl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(n){return this.minX=Math.min(this.minX,n.x),this.minY=Math.min(this.minY,n.y),this.maxX=Math.max(this.maxX,n.x),this.maxY=Math.max(this.maxY,n.y),this}expandBy(n){return this.minX-=n,this.minY-=n,this.maxX+=n,this.maxY+=n,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(n){return this.expandBy(-n)}map(n){let o=new wl;return o.extend(n(new v(this.minX,this.minY))),o.extend(n(new v(this.maxX,this.minY))),o.extend(n(new v(this.minX,this.maxY))),o.extend(n(new v(this.maxX,this.maxY))),o}static fromPoints(n){let o=new wl;for(let u of n)o.extend(u);return o}contains(n){return n.x>=this.minX&&n.x<=this.maxX&&n.y>=this.minY&&n.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(n){return!this.empty()&&!n.empty()&&n.minX>=this.minX&&n.maxX<=this.maxX&&n.minY>=this.minY&&n.maxY<=this.maxY}intersects(n){return!this.empty()&&!n.empty()&&n.minX<=this.maxX&&n.maxX>=this.minX&&n.minY<=this.maxY&&n.maxY>=this.minY}}class T1{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){let u=n[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class C1{constructor(n,o,u,f,_){this.type="Feature",this._vectorTileFeature=n,n._z=o,n._x=u,n._y=f,this.properties=n.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){let n={geometry:this.geometry};for(let o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(n[o]=this[o]);return n}}class P1{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new gl(Ht,16,0),this.grid3D=new gl(Ht,16,0),this.featureIndexArray=new ae,this.promoteId=o}insert(n,o,u,f,_,y){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,_);let M=y?this.grid3D:this.grid;for(let T=0;T<o.length;T++){let P=o[T],A=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){let z=P[O];A[0]=Math.min(A[0],z.x),A[1]=Math.min(A[1],z.y),A[2]=Math.max(A[2],z.x),A[3]=Math.max(A[3],z.y)}A[0]<Ht&&A[1]<Ht&&A[2]>=0&&A[3]>=0&&M.insert(b,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hb(new ey(this.rawTileData)).layers,this.sourceLayerCoder=new T1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,o,u,f){this.loadVTLayers();let _=n.params,y=Ht/n.tileSize/n.scale,b=gs(_.filter),M=n.queryGeometry,T=n.queryPadding*y,P=wl.fromPoints(M),A=this.grid.query(P.minX-T,P.minY-T,P.maxX+T,P.maxY+T),O=wl.fromPoints(n.cameraQueryGeometry).expandBy(T),z=this.grid3D.query(O.minX,O.minY,O.maxX,O.maxY,(Z,K,ce,re)=>function(se,ye,we,De,Ve){for(let Be of se)if(ye<=Be.x&&we<=Be.y&&De>=Be.x&&Ve>=Be.y)return!0;let Le=[new v(ye,we),new v(ye,Ve),new v(De,Ve),new v(De,we)];if(se.length>2){for(let Be of Le)if(Vc(se,Be))return!0}for(let Be=0;Be<se.length-1;Be++)if(zC(se[Be],se[Be+1],Le))return!0;return!1}(n.cameraQueryGeometry,Z-T,K-T,ce+T,re+T));for(let Z of z)A.push(Z);A.sort(aP);let j={},G;for(let Z=0;Z<A.length;Z++){let K=A[Z];if(K===G)continue;G=K;let ce=this.featureIndexArray.get(K),re=null;this.loadMatchingFeature(j,ce.bucketIndex,ce.sourceLayerIndex,ce.featureIndex,b,_.layers,_.availableImages,o,u,f,(se,ye,we)=>(re||(re=Uo(se)),ye.queryIntersectsFeature({queryGeometry:M,feature:se,featureState:we,geometry:re,zoom:this.z,transform:n.transform,pixelsToTileUnits:y,pixelPosMatrix:n.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:n.getElevation})))}return j}loadMatchingFeature(n,o,u,f,_,y,b,M,T,P,A){let O=this.bucketLayerIDs[o];if(y&&!O.some(Z=>y.has(Z)))return;let z=this.sourceLayerCoder.decode(u),j=this.vtLayers[z].feature(f);if(_.needGeometry){let Z=ro(j,!0);if(!_.filter(new an(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!_.filter(new an(this.tileID.overscaledZ),j))return;let G=this.getId(j,z);for(let Z=0;Z<O.length;Z++){let K=O[Z];if(y&&!y.has(K))continue;let ce=M[K];if(!ce)continue;let re={};G&&P&&(re=P.getState(ce.sourceLayer||"_geojsonTileLayer",G));let se=Xr({},T[K]);se.paint=D1(se.paint,ce.paint,j,re,b),se.layout=D1(se.layout,ce.layout,j,re,b);let ye=!A||A(j,ce,re);if(!ye)continue;let we=new C1(j,this.z,this.x,this.y,G);we.layer=se;let De=n[K];De===void 0&&(De=n[K]=[]),De.push({featureIndex:f,feature:we,intersectionZ:ye})}}lookupSymbolFeatures(n,o,u,f,_,y,b,M){let T={};this.loadVTLayers();let P=gs(_);for(let A of n)this.loadMatchingFeature(T,u,f,A,P,y,b,M,o);return T}hasLayer(n){for(let o of this.bucketLayerIDs)for(let u of o)if(n===u)return!0;return!1}getId(n,o){var u;let f=n.id;return this.promoteId&&(f=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((u=n.properties)===null||u===void 0)&&u.cluster)&&this.promoteId&&(f=Number(n.properties.cluster_id))),f}}function D1(a,n,o,u,f){return Ys(a,(_,y)=>{let b=n instanceof Nc?n.get(y):null;return b&&b.evaluate?b.evaluate(o,u,f):b})}function aP(a,n){return n-a}function A1(a,n,o,u,f){let _=[];for(let y=0;y<a.length;y++){let b=a[y],M;for(let T=0;T<b.length-1;T++){let P=b[T],A=b[T+1];P.x<n&&A.x<n||(P.x<n?P=new v(n,P.y+(n-P.x)/(A.x-P.x)*(A.y-P.y))._round():A.x<n&&(A=new v(n,P.y+(n-P.x)/(A.x-P.x)*(A.y-P.y))._round()),P.y<o&&A.y<o||(P.y<o?P=new v(P.x+(o-P.y)/(A.y-P.y)*(A.x-P.x),o)._round():A.y<o&&(A=new v(P.x+(o-P.y)/(A.y-P.y)*(A.x-P.x),o)._round()),P.x>=u&&A.x>=u||(P.x>=u?P=new v(u,P.y+(u-P.x)/(A.x-P.x)*(A.y-P.y))._round():A.x>=u&&(A=new v(u,P.y+(u-P.x)/(A.x-P.x)*(A.y-P.y))._round()),P.y>=f&&A.y>=f||(P.y>=f?P=new v(P.x+(f-P.y)/(A.y-P.y)*(A.x-P.x),f)._round():A.y>=f&&(A=new v(P.x+(f-P.y)/(A.y-P.y)*(A.x-P.x),f)._round()),M&&P.equals(M[M.length-1])||(M=[P],_.push(M)),M.push(A)))))}}return _}$e("FeatureIndex",P1,{omit:["rawTileData","sourceLayerCoder"]});class Ca extends v{constructor(n,o,u,f){super(n,o),this.angle=u,f!==void 0&&(this.segment=f)}clone(){return new Ca(this.x,this.y,this.angle,this.segment)}}function R1(a,n,o,u,f){if(n.segment===void 0||o===0)return!0;let _=n,y=n.segment+1,b=0;for(;b>-o/2;){if(y--,y<0)return!1;b-=a[y].dist(_),_=a[y]}b+=a[y].dist(a[y+1]),y++;let M=[],T=0;for(;b<o/2;){let P=a[y],A=a[y+1];if(!A)return!1;let O=a[y-1].angleTo(P)-P.angleTo(A);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:b,angleDelta:O}),T+=O;b-M[0].distance>u;)T-=M.shift().angleDelta;if(T>f)return!1;y++,b+=P.dist(A)}return!0}function k1(a){let n=0;for(let o=0;o<a.length-1;o++)n+=a[o].dist(a[o+1]);return n}function N1(a,n,o){return a?.6*n*o:0}function L1(a,n){return Math.max(a?a.right-a.left:0,n?n.right-n.left:0)}function lP(a,n,o,u,f,_){let y=N1(o,f,_),b=L1(o,u)*_,M=0,T=k1(a)/2;for(let P=0;P<a.length-1;P++){let A=a[P],O=a[P+1],z=A.dist(O);if(M+z>T){let j=(T-M)/z,G=Bi.number(A.x,O.x,j),Z=Bi.number(A.y,O.y,j),K=new Ca(G,Z,O.angleTo(A),P);return K._round(),!y||R1(a,K,b,y,n)?K:void 0}M+=z}}function cP(a,n,o,u,f,_,y,b,M){let T=N1(u,_,y),P=L1(u,f),A=P*y,O=a[0].x===0||a[0].x===M||a[0].y===0||a[0].y===M;return n-A<n/4&&(n=A+n/4),O1(a,O?n/2*b%n:(P/2+2*_)*y*b%n,n,T,o,A,O,!1,M)}function O1(a,n,o,u,f,_,y,b,M){let T=_/2,P=k1(a),A=0,O=n-o,z=[];for(let j=0;j<a.length-1;j++){let G=a[j],Z=a[j+1],K=G.dist(Z),ce=Z.angleTo(G);for(;O+o<A+K;){O+=o;let re=(O-A)/K,se=Bi.number(G.x,Z.x,re),ye=Bi.number(G.y,Z.y,re);if(se>=0&&se<M&&ye>=0&&ye<M&&O-T>=0&&O+T<=P){let we=new Ca(se,ye,ce,j);we._round(),u&&!R1(a,we,_,u,f)||z.push(we)}}A+=K}return b||z.length||y||(z=O1(a,A/2,o,u,f,_,y,!0,M)),z}function F1(a,n,o,u){let f=[],_=a.image,y=_.pixelRatio,b=_.paddedRect.w-2,M=_.paddedRect.h-2,T={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom},P=_.stretchX||[[0,b]],A=_.stretchY||[[0,M]],O=(Ie,rt)=>Ie+rt[1]-rt[0],z=P.reduce(O,0),j=A.reduce(O,0),G=b-z,Z=M-j,K=0,ce=z,re=0,se=j,ye=0,we=G,De=0,Ve=Z;if(_.content&&u){let Ie=_.content,rt=Ie[2]-Ie[0],ot=Ie[3]-Ie[1];(_.textFitWidth||_.textFitHeight)&&(T=h1(a)),K=jp(P,0,Ie[0]),re=jp(A,0,Ie[1]),ce=jp(P,Ie[0],Ie[2]),se=jp(A,Ie[1],Ie[3]),ye=Ie[0]-K,De=Ie[1]-re,we=rt-ce,Ve=ot-se}let Le=T.x1,Be=T.y1,Ke=T.x2-Le,je=T.y2-Be,Ue=(Ie,rt,ot,et)=>{let Ze=Bp(Ie.stretch-K,ce,Ke,Le),Dt=Up(Ie.fixed-ye,we,Ie.stretch,z),pn=Bp(rt.stretch-re,se,je,Be),zn=Up(rt.fixed-De,Ve,rt.stretch,j),ur=Bp(ot.stretch-K,ce,Ke,Le),Si=Up(ot.fixed-ye,we,ot.stretch,z),Vr=Bp(et.stretch-re,se,je,Be),Jn=Up(et.fixed-De,Ve,et.stretch,j),cn=new v(Ze,pn),$n=new v(ur,pn),er=new v(ur,Vr),tr=new v(Ze,Vr),Rr=new v(Dt/y,zn/y),Ei=new v(Si/y,Jn/y),Hn=n*Math.PI/180;if(Hn){let qn=Math.sin(Hn),Zn=Math.cos(Hn),An=[Zn,-qn,qn,Zn];cn._matMult(An),$n._matMult(An),tr._matMult(An),er._matMult(An)}let Gr=Ie.stretch+Ie.fixed,jn=rt.stretch+rt.fixed;return{tl:cn,tr:$n,bl:tr,br:er,tex:{x:_.paddedRect.x+1+Gr,y:_.paddedRect.y+1+jn,w:ot.stretch+ot.fixed-Gr,h:et.stretch+et.fixed-jn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rr,pixelOffsetBR:Ei,minFontScaleX:we/y/Ke,minFontScaleY:Ve/y/je,isSDF:o}};if(u&&(_.stretchX||_.stretchY)){let Ie=z1(P,G,z),rt=z1(A,Z,j);for(let ot=0;ot<Ie.length-1;ot++){let et=Ie[ot],Ze=Ie[ot+1];for(let Dt=0;Dt<rt.length-1;Dt++)f.push(Ue(et,rt[Dt],Ze,rt[Dt+1]))}}else f.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:M+1}));return f}function jp(a,n,o){let u=0;for(let f of a)u+=Math.max(n,Math.min(o,f[1]))-Math.max(n,Math.min(o,f[0]));return u}function z1(a,n,o){let u=[{fixed:-1,stretch:0}];for(let[f,_]of a){let y=u[u.length-1];u.push({fixed:f-y.stretch,stretch:y.stretch}),u.push({fixed:f-y.stretch,stretch:y.stretch+(_-f)})}return u.push({fixed:n+1,stretch:o}),u}function Bp(a,n,o,u){return a/n*o+u}function Up(a,n,o,u){return a-n*o/u}$e("Anchor",Ca);class Vp{constructor(n,o,u,f,_,y,b,M,T,P){var A;if(this.boxStartIndex=n.length,T){let O=y.top,z=y.bottom,j=y.collisionPadding;j&&(O-=j[1],z+=j[3]);let G=z-O;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let O=!((A=y.image)===null||A===void 0)&&A.content&&(y.image.textFitWidth||y.image.textFitHeight)?h1(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};O.y1=O.y1*b-M[0],O.y2=O.y2*b+M[2],O.x1=O.x1*b-M[3],O.x2=O.x2*b+M[1];let z=y.collisionPadding;if(z&&(O.x1-=z[0]*b,O.y1-=z[1]*b,O.x2+=z[2]*b,O.y2+=z[3]*b),P){let j=new v(O.x1,O.y1),G=new v(O.x2,O.y1),Z=new v(O.x1,O.y2),K=new v(O.x2,O.y2),ce=P*Math.PI/180;j._rotate(ce),G._rotate(ce),Z._rotate(ce),K._rotate(ce),O.x1=Math.min(j.x,G.x,Z.x,K.x),O.x2=Math.max(j.x,G.x,Z.x,K.x),O.y1=Math.min(j.y,G.y,Z.y,K.y),O.y2=Math.max(j.y,G.y,Z.y,K.y)}n.emplaceBack(o.x,o.y,O.x1,O.y1,O.x2,O.y2,u,f,_)}this.boxEndIndex=n.length}}class uP{constructor(n=[],o=(u,f)=>u<f?-1:u>f?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;let n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){let{data:o,compare:u}=this,f=o[n];for(;n>0;){let _=n-1>>1,y=o[_];if(u(f,y)>=0)break;o[n]=y,n=_}o[n]=f}_down(n){let{data:o,compare:u}=this,f=this.length>>1,_=o[n];for(;n<f;){let y=1+(n<<1),b=y+1;if(b<this.length&&u(o[b],o[y])<0&&(y=b),u(o[y],_)>=0)break;o[n]=o[y],n=y}o[n]=_}}function hP(a,n=1,o=!1){let u=wl.fromPoints(a[0]),f=Math.min(u.width(),u.height()),_=f/2,y=new uP([],dP),{minX:b,minY:M,maxX:T,maxY:P}=u;if(f===0)return new v(b,M);for(let z=b;z<T;z+=f)for(let j=M;j<P;j+=f)y.push(new Kc(z+_,j+_,_,a));let A=function(z){let j=0,G=0,Z=0,K=z[0];for(let ce=0,re=K.length,se=re-1;ce<re;se=ce++){let ye=K[ce],we=K[se],De=ye.x*we.y-we.x*ye.y;G+=(ye.x+we.x)*De,Z+=(ye.y+we.y)*De,j+=3*De}return new Kc(G/j,Z/j,0,z)}(a),O=y.length;for(;y.length;){let z=y.pop();(z.d>A.d||!A.d)&&(A=z,o&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,O)),z.max-A.d<=n||(_=z.h/2,y.push(new Kc(z.p.x-_,z.p.y-_,_,a)),y.push(new Kc(z.p.x+_,z.p.y-_,_,a)),y.push(new Kc(z.p.x-_,z.p.y+_,_,a)),y.push(new Kc(z.p.x+_,z.p.y+_,_,a)),O+=4)}return o&&(console.log(`num probes: ${O}`),console.log(`best distance: ${A.d}`)),A.p}function dP(a,n){return n.max-a.max}function Kc(a,n,o,u){this.p=new v(a,n),this.h=o,this.d=function(f,_){let y=!1,b=1/0;for(let M=0;M<_.length;M++){let T=_[M];for(let P=0,A=T.length,O=A-1;P<A;O=P++){let z=T[P],j=T[O];z.y>f.y!=j.y>f.y&&f.x<(j.x-z.x)*(f.y-z.y)/(j.y-z.y)+z.x&&(y=!y),b=Math.min(b,wb(f,z,j))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var cr;h.aE=void 0,(cr=h.aE||(h.aE={}))[cr.center=1]="center",cr[cr.left=2]="left",cr[cr.right=3]="right",cr[cr.top=4]="top",cr[cr.bottom=5]="bottom",cr[cr["top-left"]=6]="top-left",cr[cr["top-right"]=7]="top-right",cr[cr["bottom-left"]=8]="bottom-left",cr[cr["bottom-right"]=9]="bottom-right";let dy=Number.POSITIVE_INFINITY;function j1(a,n){return n[1]!==dy?function(o,u,f){let _=0,y=0;switch(u=Math.abs(u),f=Math.abs(f),o){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(o){case"top-right":case"bottom-right":case"right":_=-u;break;case"top-left":case"bottom-left":case"left":_=u}return[_,y]}(a,n[0],n[1]):function(o,u){let f=0,_=0;u<0&&(u=0);let y=u/Math.SQRT2;switch(o){case"top-right":case"top-left":_=y-7;break;case"bottom-right":case"bottom-left":_=7-y;break;case"bottom":_=7-u;break;case"top":_=u-7}switch(o){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=u;break;case"right":f=-u}return[f,_]}(a,n[0])}function B1(a,n,o){var u;let f=a.layout,_=(u=f.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(n,{},o);if(_){let b=_.values,M=[];for(let T=0;T<b.length;T+=2){let P=M[T]=b[T],A=b[T+1].map(O=>O*Gn);P.startsWith("top")?A[1]-=7:P.startsWith("bottom")&&(A[1]+=7),M[T+1]=A}return new yr(M)}let y=f.get("text-variable-anchor");if(y){let b;b=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(n,{},o)*Gn,dy]:f.get("text-offset").evaluate(n,{},o).map(T=>T*Gn);let M=[];for(let T of y)M.push(T,j1(T,b));return new yr(M)}return null}function fy(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fP(a,n,o,u,f,_,y,b,M,T,P,A){let O=_.textMaxSize.evaluate(n,{});O===void 0&&(O=y);let z=a.layers[0].layout,j=z.get("icon-offset").evaluate(n,{},P),G=V1(o.horizontal),Z=y/24,K=a.tilePixelRatio*Z,ce=a.tilePixelRatio*O/24,re=a.tilePixelRatio*b,se=a.tilePixelRatio*z.get("symbol-spacing"),ye=z.get("text-padding")*a.tilePixelRatio,we=function(ot,et,Ze,Dt=1){let pn=ot.get("icon-padding").evaluate(et,{},Ze),zn=pn&&pn.values;return[zn[0]*Dt,zn[1]*Dt,zn[2]*Dt,zn[3]*Dt]}(z,n,P,a.tilePixelRatio),De=z.get("text-max-angle")/180*Math.PI,Ve=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",Le=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Be=z.get("symbol-placement"),Ke=se/2,je=z.get("icon-text-fit"),Ue;u&&je!=="none"&&(a.allowVerticalPlacement&&o.vertical&&(Ue=d1(u,o.vertical,je,z.get("icon-text-fit-padding"),j,Z)),G&&(u=d1(u,G,je,z.get("icon-text-fit-padding"),j,Z)));let Ie=P?A.line.getGranularityForZoomLevel(P.z):1,rt=(ot,et)=>{et.x<0||et.x>=Ht||et.y<0||et.y>=Ht||function(Ze,Dt,pn,zn,ur,Si,Vr,Jn,cn,$n,er,tr,Rr,Ei,Hn,Gr,jn,qn,Zn,An,sn,io,Qc,oo,gP){let Jc=Ze.addToLineVertexArray(Dt,pn),Ml,eu,tu,nu,q1=0,Z1=0,W1=0,X1=0,by=-1,wy=-1,Es={},Y1=Ma("");if(Ze.allowVerticalPlacement&&zn.vertical){let wr=Jn.layout.get("text-rotate").evaluate(sn,{},oo)+90;tu=new Vp(cn,Dt,$n,er,tr,zn.vertical,Rr,Ei,Hn,wr),Vr&&(nu=new Vp(cn,Dt,$n,er,tr,Vr,jn,qn,Hn,wr))}if(ur){let wr=Jn.layout.get("icon-rotate").evaluate(sn,{}),Ii=Jn.layout.get("icon-text-fit")!=="none",Sl=F1(ur,wr,Qc,Ii),ao=Vr?F1(Vr,wr,Qc,Ii):void 0;eu=new Vp(cn,Dt,$n,er,tr,ur,jn,qn,!1,wr),q1=4*Sl.length;let El=Ze.iconSizeData,Vo=null;El.kind==="source"?(Vo=[Ss*Jn.layout.get("icon-size").evaluate(sn,{})],Vo[0]>Ia&&bn(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):El.kind==="composite"&&(Vo=[Ss*io.compositeIconSizes[0].evaluate(sn,{},oo),Ss*io.compositeIconSizes[1].evaluate(sn,{},oo)],(Vo[0]>Ia||Vo[1]>Ia)&&bn(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ze.addSymbols(Ze.icon,Sl,Vo,An,Zn,sn,h.ao.none,Dt,Jc.lineStartIndex,Jc.lineLength,-1,oo),by=Ze.icon.placedSymbolArray.length-1,ao&&(Z1=4*ao.length,Ze.addSymbols(Ze.icon,ao,Vo,An,Zn,sn,h.ao.vertical,Dt,Jc.lineStartIndex,Jc.lineLength,-1,oo),wy=Ze.icon.placedSymbolArray.length-1)}let K1=Object.keys(zn.horizontal);for(let wr of K1){let Ii=zn.horizontal[wr];if(!Ml){Y1=Ma(Ii.text);let ao=Jn.layout.get("text-rotate").evaluate(sn,{},oo);Ml=new Vp(cn,Dt,$n,er,tr,Ii,Rr,Ei,Hn,ao)}let Sl=Ii.positionedLines.length===1;if(W1+=U1(Ze,Dt,Ii,Si,Jn,Hn,sn,Gr,Jc,zn.vertical?h.ao.horizontal:h.ao.horizontalOnly,Sl?K1:[wr],Es,by,io,oo),Sl)break}zn.vertical&&(X1+=U1(Ze,Dt,zn.vertical,Si,Jn,Hn,sn,Gr,Jc,h.ao.vertical,["vertical"],Es,wy,io,oo));let _P=Ml?Ml.boxStartIndex:Ze.collisionBoxArray.length,yP=Ml?Ml.boxEndIndex:Ze.collisionBoxArray.length,vP=tu?tu.boxStartIndex:Ze.collisionBoxArray.length,xP=tu?tu.boxEndIndex:Ze.collisionBoxArray.length,bP=eu?eu.boxStartIndex:Ze.collisionBoxArray.length,wP=eu?eu.boxEndIndex:Ze.collisionBoxArray.length,MP=nu?nu.boxStartIndex:Ze.collisionBoxArray.length,SP=nu?nu.boxEndIndex:Ze.collisionBoxArray.length,so=-1,$p=(wr,Ii)=>wr&&wr.circleDiameter?Math.max(wr.circleDiameter,Ii):Ii;so=$p(Ml,so),so=$p(tu,so),so=$p(eu,so),so=$p(nu,so);let Q1=so>-1?1:0;Q1&&(so*=gP/Gn),Ze.glyphOffsetArray.length>=Xc.MAX_GLYPHS&&bn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sn.sortKey!==void 0&&Ze.addToSortKeyRanges(Ze.symbolInstances.length,sn.sortKey);let EP=B1(Jn,sn,oo),[IP,TP]=function(wr,Ii){let Sl=wr.length,ao=Ii?.values;if(ao?.length>0)for(let El=0;El<ao.length;El+=2){let Vo=ao[El+1];wr.emplaceBack(h.aE[ao[El]],Vo[0],Vo[1])}return[Sl,wr.length]}(Ze.textAnchorOffsets,EP);Ze.symbolInstances.emplaceBack(Dt.x,Dt.y,Es.right>=0?Es.right:-1,Es.center>=0?Es.center:-1,Es.left>=0?Es.left:-1,Es.vertical||-1,by,wy,Y1,_P,yP,vP,xP,bP,wP,MP,SP,$n,W1,X1,q1,Z1,Q1,0,Rr,so,IP,TP)}(a,et,ot,o,u,f,Ue,a.layers[0],a.collisionBoxArray,n.index,n.sourceLayerIndex,a.index,K,[ye,ye,ye,ye],Ve,M,re,we,Le,j,n,_,T,P,y)};if(Be==="line")for(let ot of A1(n.geometry,0,0,Ht,Ht)){let et=bl(ot,Ie),Ze=cP(et,se,De,o.vertical||G,u,24,ce,a.overscaling,Ht);for(let Dt of Ze)G&&pP(a,G.text,Ke,Dt)||rt(et,Dt)}else if(Be==="line-center"){for(let ot of n.geometry)if(ot.length>1){let et=bl(ot,Ie),Ze=lP(et,De,o.vertical||G,u,24,ce);Ze&&rt(et,Ze)}}else if(n.type==="Polygon")for(let ot of il(n.geometry,0)){let et=hP(ot,16);rt(bl(ot[0],Ie,!0),new Ca(et.x,et.y,0))}else if(n.type==="LineString")for(let ot of n.geometry){let et=bl(ot,Ie);rt(et,new Ca(et[0].x,et[0].y,0))}else if(n.type==="Point")for(let ot of n.geometry)for(let et of ot)rt([et],new Ca(et.x,et.y,0))}function U1(a,n,o,u,f,_,y,b,M,T,P,A,O,z,j){let G=function(ce,re,se,ye,we,De,Ve,Le){let Be=ye.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Ke=[];for(let je of re.positionedLines)for(let Ue of je.positionedGlyphs){if(!Ue.rect)continue;let Ie=Ue.rect||{},rt=4,ot=!0,et=1,Ze=0,Dt=(we||Le)&&Ue.vertical,pn=Ue.metrics.advance*Ue.scale/2;if(Le&&re.verticalizable&&(Ze=je.lineOffset/2-(Ue.imageName?-(Gn-Ue.metrics.width*Ue.scale)/2:(Ue.scale-1)*Gn)),Ue.imageName){let qn=Ve[Ue.imageName];ot=qn.sdf,et=qn.pixelRatio,rt=1/et}let zn=we?[Ue.x+pn,Ue.y]:[0,0],ur=we?[0,0]:[Ue.x+pn+se[0],Ue.y+se[1]-Ze],Si=[0,0];Dt&&(Si=ur,ur=[0,0]);let Vr=Ue.metrics.isDoubleResolution?2:1,Jn=(Ue.metrics.left-rt)*Ue.scale-pn+ur[0],cn=(-Ue.metrics.top-rt)*Ue.scale+ur[1],$n=Jn+Ie.w/Vr*Ue.scale/et,er=cn+Ie.h/Vr*Ue.scale/et,tr=new v(Jn,cn),Rr=new v($n,cn),Ei=new v(Jn,er),Hn=new v($n,er);if(Dt){let qn=new v(-pn,pn- -17),Zn=-Math.PI/2,An=12-pn,sn=new v(22-An,-(Ue.imageName?An:0)),io=new v(...Si);tr._rotateAround(Zn,qn)._add(sn)._add(io),Rr._rotateAround(Zn,qn)._add(sn)._add(io),Ei._rotateAround(Zn,qn)._add(sn)._add(io),Hn._rotateAround(Zn,qn)._add(sn)._add(io)}if(Be){let qn=Math.sin(Be),Zn=Math.cos(Be),An=[Zn,-qn,qn,Zn];tr._matMult(An),Rr._matMult(An),Ei._matMult(An),Hn._matMult(An)}let Gr=new v(0,0),jn=new v(0,0);Ke.push({tl:tr,tr:Rr,bl:Ei,br:Hn,tex:Ie,writingMode:re.writingMode,glyphOffset:zn,sectionIndex:Ue.sectionIndex,isSDF:ot,pixelOffsetTL:Gr,pixelOffsetBR:jn,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,o,b,f,_,y,u,a.allowVerticalPlacement),Z=a.textSizeData,K=null;Z.kind==="source"?(K=[Ss*f.layout.get("text-size").evaluate(y,{})],K[0]>Ia&&bn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Z.kind==="composite"&&(K=[Ss*z.compositeTextSizes[0].evaluate(y,{},j),Ss*z.compositeTextSizes[1].evaluate(y,{},j)],(K[0]>Ia||K[1]>Ia)&&bn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,G,K,b,_,y,T,n,M.lineStartIndex,M.lineLength,O,j);for(let ce of P)A[ce]=a.text.placedSymbolArray.length-1;return 4*G.length}function V1(a){for(let n in a)return a[n];return null}function pP(a,n,o,u){let f=a.compareText;if(n in f){let _=f[n];for(let y=_.length-1;y>=0;y--)if(u.dist(_[y])<o)return!0}else f[n]=[];return f[n].push(u),!1}let G1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class py{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[o,u]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");let f=u>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);let _=G1[15&u];if(!_)throw new Error("Unrecognized array type.");let[y]=new Uint16Array(n,2,1),[b]=new Uint32Array(n,4,1);return new py(b,y,_,n)}constructor(n,o=64,u=Float64Array,f){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;let _=G1.indexOf(this.ArrayType),y=2*n*this.ArrayType.BYTES_PER_ELEMENT,b=n*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+M,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+M),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+M,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=o,u}finish(){let n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return my(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:_,coords:y,nodeSize:b}=this,M=[0,_.length-1,0],T=[];for(;M.length;){let P=M.pop()||0,A=M.pop()||0,O=M.pop()||0;if(A-O<=b){for(let Z=O;Z<=A;Z++){let K=y[2*Z],ce=y[2*Z+1];K>=n&&K<=u&&ce>=o&&ce<=f&&T.push(_[Z])}continue}let z=O+A>>1,j=y[2*z],G=y[2*z+1];j>=n&&j<=u&&G>=o&&G<=f&&T.push(_[z]),(P===0?n<=j:o<=G)&&(M.push(O),M.push(z-1),M.push(1-P)),(P===0?u>=j:f>=G)&&(M.push(z+1),M.push(A),M.push(1-P))}return T}within(n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:f,coords:_,nodeSize:y}=this,b=[0,f.length-1,0],M=[],T=u*u;for(;b.length;){let P=b.pop()||0,A=b.pop()||0,O=b.pop()||0;if(A-O<=y){for(let Z=O;Z<=A;Z++)H1(_[2*Z],_[2*Z+1],n,o)<=T&&M.push(f[Z]);continue}let z=O+A>>1,j=_[2*z],G=_[2*z+1];H1(j,G,n,o)<=T&&M.push(f[z]),(P===0?n-u<=j:o-u<=G)&&(b.push(O),b.push(z-1),b.push(1-P)),(P===0?n+u>=j:o+u>=G)&&(b.push(z+1),b.push(A),b.push(1-P))}return M}}function my(a,n,o,u,f,_){if(f-u<=o)return;let y=u+f>>1;$1(a,n,y,u,f,_),my(a,n,o,u,y-1,1-_),my(a,n,o,y+1,f,1-_)}function $1(a,n,o,u,f,_){for(;f>u;){if(f-u>600){let T=f-u+1,P=o-u+1,A=Math.log(T),O=.5*Math.exp(2*A/3),z=.5*Math.sqrt(A*O*(T-O)/T)*(P-T/2<0?-1:1);$1(a,n,o,Math.max(u,Math.floor(o-P*O/T+z)),Math.min(f,Math.floor(o+(T-P)*O/T+z)),_)}let y=n[2*o+_],b=u,M=f;for(dd(a,n,u,o),n[2*f+_]>y&&dd(a,n,u,f);b<M;){for(dd(a,n,b,M),b++,M--;n[2*b+_]<y;)b++;for(;n[2*M+_]>y;)M--}n[2*u+_]===y?dd(a,n,u,M):(M++,dd(a,n,M,f)),M<=o&&(u=M+1),o<=M&&(f=M-1)}}function dd(a,n,o,u){gy(a,o,u),gy(n,2*o,2*u),gy(n,2*o+1,2*u+1)}function gy(a,n,o){let u=a[n];a[n]=a[o],a[o]=u}function H1(a,n,o,u){let f=a-o,_=n-u;return f*f+_*_}var _y;h.cx=void 0,(_y=h.cx||(h.cx={})).create="create",_y.load="load",_y.fullLoad="fullLoad";let Gp=null,fd=[],yy=1e3/60,vy="loadTime",xy="fullLoadTime",mP={mark(a){performance.mark(a)},frame(a){let n=a;Gp!=null&&fd.push(n-Gp),Gp=n},clearMetrics(){Gp=null,fd=[],performance.clearMeasures(vy),performance.clearMeasures(xy);for(let a in h.cx)performance.clearMarks(h.cx[a])},getPerformanceMetrics(){performance.measure(vy,h.cx.create,h.cx.load),performance.measure(xy,h.cx.create,h.cx.fullLoad);let a=performance.getEntriesByName(vy)[0].duration,n=performance.getEntriesByName(xy)[0].duration,o=fd.length,u=1/(fd.reduce((_,y)=>_+y,0)/o/1e3),f=fd.filter(_=>_>yy).reduce((_,y)=>_+(y-yy)/yy,0);return{loadTime:a,fullLoadTime:n,fps:u,percentDroppedFrames:f/(o+f)*100,totalFrames:o}}};h.$=Ht,h.A=Ae,h.B=function([a,n,o]){return n+=90,n*=Math.PI/180,o*=Math.PI/180,{x:a*Math.cos(n)*Math.sin(o),y:a*Math.sin(n)*Math.sin(o),z:a*Math.cos(o)}},h.C=Bi,h.D=Ye,h.E=Xe,h.F=an,h.G=pl,h.H=function(a){if(ns==null){let n=a.navigator?a.navigator.userAgent:null;ns=!!a.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return ns},h.I=ty,h.J=class{constructor(a,n){this.target=a,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new oP(()=>this.process()),this.subscription=So(this.target,"message",o=>this.receive(o),!1),this.globalScope=Ni(self)?a:window}registerMessageHandler(a,n){this.messageHandlers[a]=n}sendAsync(a,n){return new Promise((o,u)=>{let f=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=n?So(n.signal,"abort",()=>{_?.unsubscribe(),delete this.resolveRejects[f];let M={id:f,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},sP):null;this.resolveRejects[f]={resolve:M=>{_?.unsubscribe(),o(M)},reject:M=>{_?.unsubscribe(),u(M)}};let y=[],b=Object.assign(Object.assign({},a),{id:f,sourceMapId:this.mapId,origin:location.origin,data:_a(a.data,y)});this.target.postMessage(b,{transfer:y})})}receive(a){let n=a.data,o=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[o];let u=this.abortControllers[o];return delete this.abortControllers[o],void(u&&u.abort())}if(Ni(self)||n.mustQueue)return this.tasks[o]=n,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,n)}}process(){if(this.taskQueue.length===0)return;let a=this.taskQueue.shift(),n=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(a,n)}processTask(a,n){return s(this,void 0,void 0,function*(){if(n.type==="<response>"){let f=this.resolveRejects[a];return delete this.resolveRejects[a],f?void(n.error?f.reject(vs(n.error)):f.resolve(vs(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let o=vs(n.data),u=new AbortController;this.abortControllers[a]=u;try{let f=yield this.messageHandlers[n.type](n.sourceMapId,o,u);this.completeTask(a,null,f)}catch(f){this.completeTask(a,f)}})}completeTask(a,n,o){let u=[];delete this.abortControllers[a];let f={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?_a(n):null,data:_a(o,u)};this.target.postMessage(f,{transfer:u})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},h.K=q,h.L=function(){var a=new Ae(16);return Ae!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},h.M=function(a,n,o){var u,f,_,y,b,M,T,P,A,O,z,j,G=o[0],Z=o[1],K=o[2];return n===a?(a[12]=n[0]*G+n[4]*Z+n[8]*K+n[12],a[13]=n[1]*G+n[5]*Z+n[9]*K+n[13],a[14]=n[2]*G+n[6]*Z+n[10]*K+n[14],a[15]=n[3]*G+n[7]*Z+n[11]*K+n[15]):(f=n[1],_=n[2],y=n[3],b=n[4],M=n[5],T=n[6],P=n[7],A=n[8],O=n[9],z=n[10],j=n[11],a[0]=u=n[0],a[1]=f,a[2]=_,a[3]=y,a[4]=b,a[5]=M,a[6]=T,a[7]=P,a[8]=A,a[9]=O,a[10]=z,a[11]=j,a[12]=u*G+b*Z+A*K+n[12],a[13]=f*G+M*Z+O*K+n[13],a[14]=_*G+T*Z+z*K+n[14],a[15]=y*G+P*Z+j*K+n[15]),a},h.N=function(a,n,o){var u=o[0],f=o[1],_=o[2];return a[0]=n[0]*u,a[1]=n[1]*u,a[2]=n[2]*u,a[3]=n[3]*u,a[4]=n[4]*f,a[5]=n[5]*f,a[6]=n[6]*f,a[7]=n[7]*f,a[8]=n[8]*_,a[9]=n[9]*_,a[10]=n[10]*_,a[11]=n[11]*_,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},h.O=function(a,n,o){var u=n[0],f=n[1],_=n[2],y=n[3],b=n[4],M=n[5],T=n[6],P=n[7],A=n[8],O=n[9],z=n[10],j=n[11],G=n[12],Z=n[13],K=n[14],ce=n[15],re=o[0],se=o[1],ye=o[2],we=o[3];return a[0]=re*u+se*b+ye*A+we*G,a[1]=re*f+se*M+ye*O+we*Z,a[2]=re*_+se*T+ye*z+we*K,a[3]=re*y+se*P+ye*j+we*ce,a[4]=(re=o[4])*u+(se=o[5])*b+(ye=o[6])*A+(we=o[7])*G,a[5]=re*f+se*M+ye*O+we*Z,a[6]=re*_+se*T+ye*z+we*K,a[7]=re*y+se*P+ye*j+we*ce,a[8]=(re=o[8])*u+(se=o[9])*b+(ye=o[10])*A+(we=o[11])*G,a[9]=re*f+se*M+ye*O+we*Z,a[10]=re*_+se*T+ye*z+we*K,a[11]=re*y+se*P+ye*j+we*ce,a[12]=(re=o[12])*u+(se=o[13])*b+(ye=o[14])*A+(we=o[15])*G,a[13]=re*f+se*M+ye*O+we*Z,a[14]=re*_+se*T+ye*z+we*K,a[15]=re*y+se*P+ye*j+we*ce,a},h.P=v,h.Q=function(a,n){let o={};for(let u=0;u<n.length;u++){let f=n[u];f in a&&(o[f]=a[f])}return o},h.R=Ur,h.S=Ta,h.T=$_,h.U=w1,h.V=b1,h.W=me,h.X=Ee,h.Y=Qs,h.Z=Mi,h._=s,h.a=V,h.a$=xn,h.a0=function(a,n){var o,u,f,_;if(!a)return n??{};if(!n)return a;let y=Object.assign({},a);if(n.removeAll&&(y.removeAll=!0),n.remove){let b=new Set(y.remove?y.remove.concat(n.remove):n.remove);y.remove=Array.from(b.values())}if(n.add){let b=y.add?y.add.concat(n.add):n.add,M=new Map(b.map(T=>[T.id,T]));y.add=Array.from(M.values())}if(n.update){let b=new Map((o=y.update)===null||o===void 0?void 0:o.map(M=>[M.id,M]));for(let M of n.update){let T=(u=b.get(M.id))!==null&&u!==void 0?u:{id:M.id};M.newGeometry&&(T.newGeometry=M.newGeometry),M.addOrUpdateProperties&&(T.addOrUpdateProperties=((f=T.addOrUpdateProperties)!==null&&f!==void 0?f:[]).concat(M.addOrUpdateProperties)),M.removeProperties&&(T.removeProperties=((_=T.removeProperties)!==null&&_!==void 0?_:[]).concat(M.removeProperties)),M.removeAllProperties&&(T.removeAllProperties=!0),b.set(M.id,T)}y.update=Array.from(b.values())}return y},h.a1=ud,h.a2=wl,h.a3=25,h.a4=hy,h.a5=a=>{let n=window.document.createElement("video");return n.muted=!0,new Promise(o=>{n.onloadstart=()=>{o(n)};for(let u of a){let f=window.document.createElement("source");ve(u)||(n.crossOrigin="Anonymous"),f.src=u,n.appendChild(f)}})},h.a6=Ne,h.a7=function(){return ui++},h.a8=R,h.a9=Xc,h.aA=function(a){let n=1/0,o=1/0,u=-1/0,f=-1/0;for(let _ of a)n=Math.min(n,_.x),o=Math.min(o,_.y),u=Math.max(u,_.x),f=Math.max(f,_.y);return[n,o,u,f]},h.aB=Gn,h.aC=Jo,h.aD=function(a,n,o,u,f=!1){if(!o[0]&&!o[1])return[0,0];let _=f?u==="map"?-a.bearingInRadians:0:u==="viewport"?a.bearingInRadians:0;if(_){let y=Math.sin(_),b=Math.cos(_);o=[o[0]*b-o[1]*y,o[0]*y+o[1]*b]}return[f?o[0]:Jo(n,o[0],a.zoom),f?o[1]:Jo(n,o[1],a.zoom)]},h.aF=iy,h.aG=fy,h.aH=ry,h.aI=py,h.aJ=vn,h.aK=kp,h.aL=ee,h.aM=ht,h.aN=Zt,h.aO=Xs,h.aP=Eo,h.aQ=S1,h.aR=Xt,h.aS=Gt,h.aT=function(a){var n=new Ae(3);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n},h.aU=function(a,n,o){return a[0]=n[0]-o[0],a[1]=n[1]-o[1],a[2]=n[2]-o[2],a},h.aV=function(a,n){var o=n[0],u=n[1],f=n[2],_=o*o+u*u+f*f;return _>0&&(_=1/Math.sqrt(_)),a[0]=n[0]*_,a[1]=n[1]*_,a[2]=n[2]*_,a},h.aW=tn,h.aX=function(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]},h.aY=function(a,n,o){return a[0]=n[0]*o[0],a[1]=n[1]*o[1],a[2]=n[2]*o[2],a[3]=n[3]*o[3],a},h.aZ=Ct,h.a_=function(a,n,o){let u=n[0]*o[0]+n[1]*o[1]+n[2]*o[2];return u===0?null:(-(a[0]*o[0]+a[1]*o[1]+a[2]*o[2])-o[3])/u},h.aa=gs,h.ab=ro,h.ac=C1,h.ad=function(a){let n={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,f,_)=>{let y=f||_;return n[u]=!y||y.toLowerCase(),""}),n["max-age"]){let o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n},h.ae=rs,h.af=function(a){return Math.pow(2,a)},h.ag=it,h.ah=Tr,h.ai=85.051129,h.aj=M1,h.ak=function(a){return Math.log(a)/Math.LN2},h.al=function(a){var n=a[0],o=a[1];return n*n+o*o},h.am=function(a,n){let o=[];for(let u in a)u in n||o.push(u);return o},h.an=function(a,n){let o=0,u=0;if(a.kind==="constant")u=a.layoutSize;else if(a.kind!=="source"){let{interpolationType:f,minZoom:_,maxZoom:y}=a,b=f?Tr(Qn.interpolationFactor(f,n,_,y),0,1):0;a.kind==="camera"?u=Bi.number(a.minSize,a.maxSize,b):o=b}return{uSizeT:o,uSize:u}},h.ap=function(a,{uSize:n,uSizeT:o},{lowerSize:u,upperSize:f}){return a.kind==="source"?u/Ss:a.kind==="composite"?Bi.number(u/Ss,f/Ss,o):n},h.aq=function(a,n){var o=n[0],u=n[1],f=n[2],_=n[3],y=n[4],b=n[5],M=n[6],T=n[7],P=n[8],A=n[9],O=n[10],z=n[11],j=n[12],G=n[13],Z=n[14],K=n[15],ce=o*b-u*y,re=o*M-f*y,se=o*T-_*y,ye=u*M-f*b,we=u*T-_*b,De=f*T-_*M,Ve=P*G-A*j,Le=P*Z-O*j,Be=P*K-z*j,Ke=A*Z-O*G,je=A*K-z*G,Ue=O*K-z*Z,Ie=ce*Ue-re*je+se*Ke+ye*Be-we*Le+De*Ve;return Ie?(a[0]=(b*Ue-M*je+T*Ke)*(Ie=1/Ie),a[1]=(f*je-u*Ue-_*Ke)*Ie,a[2]=(G*De-Z*we+K*ye)*Ie,a[3]=(O*we-A*De-z*ye)*Ie,a[4]=(M*Be-y*Ue-T*Le)*Ie,a[5]=(o*Ue-f*Be+_*Le)*Ie,a[6]=(Z*se-j*De-K*re)*Ie,a[7]=(P*De-O*se+z*re)*Ie,a[8]=(y*je-b*Be+T*Ve)*Ie,a[9]=(u*Be-o*je-_*Ve)*Ie,a[10]=(j*we-G*se+K*ce)*Ie,a[11]=(A*se-P*we-z*ce)*Ie,a[12]=(b*Le-y*Ke-M*Ve)*Ie,a[13]=(o*Ke-u*Le+f*Ve)*Ie,a[14]=(G*re-j*ye-Z*ce)*Ie,a[15]=(P*ye-A*re+O*ce)*Ie,a):null},h.ar=Qo,h.as=function(a){return Math.hypot(a[0],a[1])},h.at=function(a){return a[0]=0,a[1]=0,a},h.au=function(a,n,o){return a[0]=n[0]*o,a[1]=n[1]*o,a},h.av=oy,h.aw=Wr,h.ax=function(a,n,o,u){let f=n.y-a.y,_=n.x-a.x,y=u.y-o.y,b=u.x-o.x,M=y*_-b*f;if(M===0)return null;let T=(b*(a.y-o.y)-y*(a.x-o.x))/M;return new v(a.x+T*_,a.y+T*f)},h.ay=A1,h.az=xb,h.b=Li,h.b$=class extends m{},h.b0=function(a,n,o){return a[0]=n[0]*o,a[1]=n[1]*o,a[2]=n[2]*o,a[3]=n[3]*o,a},h.b1=function(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]+a[3]},h.b2=I1,h.b3=Yc,h.b4=function(a,n,o,u,f){var _,y=1/Math.tan(n/2);return a[0]=y/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,f!=null&&f!==1/0?(a[10]=(f+u)*(_=1/(u-f)),a[14]=2*f*u*_):(a[10]=-1,a[14]=-2*u),a},h.b5=function(a){var n=new Ae(16);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n},h.b6=function(a,n,o){var u=Math.sin(o),f=Math.cos(o),_=n[0],y=n[1],b=n[2],M=n[3],T=n[4],P=n[5],A=n[6],O=n[7];return n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=_*f+T*u,a[1]=y*f+P*u,a[2]=b*f+A*u,a[3]=M*f+O*u,a[4]=T*f-_*u,a[5]=P*f-y*u,a[6]=A*f-b*u,a[7]=O*f-M*u,a},h.b7=function(a,n,o){var u=Math.sin(o),f=Math.cos(o),_=n[4],y=n[5],b=n[6],M=n[7],T=n[8],P=n[9],A=n[10],O=n[11];return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[4]=_*f+T*u,a[5]=y*f+P*u,a[6]=b*f+A*u,a[7]=M*f+O*u,a[8]=T*f-_*u,a[9]=P*f-y*u,a[10]=A*f-b*u,a[11]=O*f-M*u,a},h.b8=function(){let a=new Float32Array(16);return it(a),a},h.b9=function(){let a=new Float64Array(16);return it(a),a},h.bA=function(a,n){let o=or(a,360),u=or(n,360),f=u-o,_=u>o?f-360:f+360;return Math.abs(f)<Math.abs(_)?f:_},h.bB=function(a){return a[0]=0,a[1]=0,a[2]=0,a},h.bC=function(a,n,o,u){let f=Math.sqrt(a*a+n*n),_=Math.sqrt(o*o+u*u);a/=f,n/=f,o/=_,u/=_;let y=Math.acos(a*o+n*u);return-n*o+a*u>0?y:-y},h.bD=function(a,n){let o=or(a,2*Math.PI),u=or(n,2*Math.PI);return Math.min(Math.abs(o-u),Math.abs(o-u+2*Math.PI),Math.abs(o-u-2*Math.PI))},h.bE=function(){let a={},n=pe.$version;for(let o in pe.$root){let u=pe.$root[o];if(u.required){let f=null;f=o==="version"?n:u.type==="array"?[]:{},f!=null&&(a[o]=f)}}return a},h.bF=Ac,h.bG=le,h.bH=function a(n,o){if(Array.isArray(n)){if(!Array.isArray(o)||n.length!==o.length)return!1;for(let u=0;u<n.length;u++)if(!a(n[u],o[u]))return!1;return!0}if(typeof n=="object"&&n!==null&&o!==null){if(typeof o!="object"||Object.keys(n).length!==Object.keys(o).length)return!1;for(let u in n)if(!a(n[u],o[u]))return!1;return!0}return n===o},h.bI=function(a){a=a.slice();let n=Object.create(null);for(let o=0;o<a.length;o++)n[a[o].id]=a[o];for(let o=0;o<a.length;o++)"ref"in a[o]&&(a[o]=yt(a[o],n[a[o].ref]));return a},h.bJ=function(a){if(a.type==="custom")return new iP(a);switch(a.type){case"background":return new tP(a);case"circle":return new BC(a);case"color-relief":return new qC(a);case"fill":return new a2(a);case"fill-extrusion":return new y2(a);case"heatmap":return new VC(a);case"hillshade":return new $C(a);case"line":return new E2(a);case"raster":return new rP(a);case"symbol":return new zp(a)}},h.bK=Fr,h.bL=function(a,n){if(!a)return[{command:"setStyle",args:[n]}];let o=[];try{if(!Qe(a.version,n.version))return[{command:"setStyle",args:[n]}];Qe(a.center,n.center)||o.push({command:"setCenter",args:[n.center]}),Qe(a.state,n.state)||o.push({command:"setGlobalState",args:[n.state]}),Qe(a.centerAltitude,n.centerAltitude)||o.push({command:"setCenterAltitude",args:[n.centerAltitude]}),Qe(a.zoom,n.zoom)||o.push({command:"setZoom",args:[n.zoom]}),Qe(a.bearing,n.bearing)||o.push({command:"setBearing",args:[n.bearing]}),Qe(a.pitch,n.pitch)||o.push({command:"setPitch",args:[n.pitch]}),Qe(a.roll,n.roll)||o.push({command:"setRoll",args:[n.roll]}),Qe(a.sprite,n.sprite)||o.push({command:"setSprite",args:[n.sprite]}),Qe(a.glyphs,n.glyphs)||o.push({command:"setGlyphs",args:[n.glyphs]}),Qe(a.transition,n.transition)||o.push({command:"setTransition",args:[n.transition]}),Qe(a.light,n.light)||o.push({command:"setLight",args:[n.light]}),Qe(a.terrain,n.terrain)||o.push({command:"setTerrain",args:[n.terrain]}),Qe(a.sky,n.sky)||o.push({command:"setSky",args:[n.sky]}),Qe(a.projection,n.projection)||o.push({command:"setProjection",args:[n.projection]});let u={},f=[];(function(y,b,M,T){let P;for(P in b=b||{},y=y||{})Object.prototype.hasOwnProperty.call(y,P)&&(Object.prototype.hasOwnProperty.call(b,P)||Nn(P,M,T));for(P in b)Object.prototype.hasOwnProperty.call(b,P)&&(Object.prototype.hasOwnProperty.call(y,P)?Qe(y[P],b[P])||(y[P].type==="geojson"&&b[P].type==="geojson"&&wn(y,b,P)?ut(M,{command:"setGeoJSONSourceData",args:[P,b[P].data]}):Ln(P,b,M,T)):nn(P,b,M))})(a.sources,n.sources,f,u);let _=[];a.layers&&a.layers.forEach(y=>{"source"in y&&u[y.source]?o.push({command:"removeLayer",args:[y.id]}):_.push(y)}),o=o.concat(f),function(y,b,M){b=b||[];let T=(y=y||[]).map(Rt),P=b.map(Rt),A=y.reduce(In,{}),O=b.reduce(In,{}),z=T.slice(),j=Object.create(null),G,Z,K,ce,re;for(let se=0,ye=0;se<T.length;se++)G=T[se],Object.prototype.hasOwnProperty.call(O,G)?ye++:(ut(M,{command:"removeLayer",args:[G]}),z.splice(z.indexOf(G,ye),1));for(let se=0,ye=0;se<P.length;se++)G=P[P.length-1-se],z[z.length-1-se]!==G&&(Object.prototype.hasOwnProperty.call(A,G)?(ut(M,{command:"removeLayer",args:[G]}),z.splice(z.lastIndexOf(G,z.length-ye),1)):ye++,ce=z[z.length-se],ut(M,{command:"addLayer",args:[O[G],ce]}),z.splice(z.length-se,0,G),j[G]=!0);for(let se=0;se<P.length;se++)if(G=P[se],Z=A[G],K=O[G],!j[G]&&!Qe(Z,K))if(Qe(Z.source,K.source)&&Qe(Z["source-layer"],K["source-layer"])&&Qe(Z.type,K.type)){for(re in St(Z.layout,K.layout,M,G,null,"setLayoutProperty"),St(Z.paint,K.paint,M,G,null,"setPaintProperty"),Qe(Z.filter,K.filter)||ut(M,{command:"setFilter",args:[G,K.filter]}),Qe(Z.minzoom,K.minzoom)&&Qe(Z.maxzoom,K.maxzoom)||ut(M,{command:"setLayerZoomRange",args:[G,K.minzoom,K.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?St(Z[re],K[re],M,G,re.slice(6),"setPaintProperty"):Qe(Z[re],K[re])||ut(M,{command:"setLayerProperty",args:[G,re,K[re]]}));for(re in K)Object.prototype.hasOwnProperty.call(K,re)&&!Object.prototype.hasOwnProperty.call(Z,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?St(Z[re],K[re],M,G,re.slice(6),"setPaintProperty"):Qe(Z[re],K[re])||ut(M,{command:"setLayerProperty",args:[G,re,K[re]]}))}else ut(M,{command:"removeLayer",args:[G]}),ce=z[z.lastIndexOf(G)+1],ut(M,{command:"addLayer",args:[K,ce]})}(_,n.layers,o)}catch(u){console.warn("Unable to compute style diff:",u),o=[{command:"setStyle",args:[n]}]}return o},h.bM=function(a){let n=[],o=a.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),a.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},h.bN=Ys,h.bO=Ks,h.bP=class extends br{constructor(a,n){super(a,n),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},h.bQ=Fn,h.bR=class extends br{constructor(a,n){super(a,n),this.current=Jr}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let n=1;n<16;n++)if(a[n]!==this.current[n]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},h.bS=Pn,h.bT=class extends br{constructor(a,n){super(a,n),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},h.bU=class extends br{constructor(a,n){super(a,n),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},h.bV=We,h.bW=function(a,n){var o=Math.sin(n),u=Math.cos(n);return a[0]=u,a[1]=o,a[2]=0,a[3]=-o,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.bX=function(a,n,o){var u=n[0],f=n[1],_=n[2];return a[0]=u*o[0]+f*o[3]+_*o[6],a[1]=u*o[1]+f*o[4]+_*o[7],a[2]=u*o[2]+f*o[5]+_*o[8],a},h.bY=function(a,n,o,u,f,_,y){var b=1/(n-o),M=1/(u-f),T=1/(_-y);return a[0]=-2*b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*M,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(n+o)*b,a[13]=(f+u)*M,a[14]=(y+_)*T,a[15]=1,a},h.bZ=class extends br{constructor(a,n){super(a,n),this.current=new Array}set(a){if(a!=this.current){this.current=a;let n=new Float32Array(4*a.length);for(let o=0;o<a.length;o++)n[4*o]=a[o].r,n[4*o+1]=a[o].g,n[4*o+2]=a[o].b,n[4*o+3]=a[o].a;this.gl.uniform4fv(this.location,n)}}},h.b_=class extends br{constructor(a,n){super(a,n),this.current=new Array}set(a){if(a!=this.current){this.current=a;let n=new Float32Array(a);this.gl.uniform1fv(this.location,n)}}},h.ba=function(){return new Float64Array(16)},h.bb=function(a,n,o){let u=new Float64Array(4);return xo(u,a,n-90,o),u},h.bc=function(a,n,o,u){var f,_,y,b,M,T=n[0],P=n[1],A=n[2],O=n[3],z=o[0],j=o[1],G=o[2],Z=o[3];return(_=T*z+P*j+A*G+O*Z)<0&&(_=-_,z=-z,j=-j,G=-G,Z=-Z),1-_>Me?(f=Math.acos(_),y=Math.sin(f),b=Math.sin((1-u)*f)/y,M=Math.sin(u*f)/y):(b=1-u,M=u),a[0]=b*T+M*z,a[1]=b*P+M*j,a[2]=b*A+M*G,a[3]=b*O+M*Z,a},h.bd=function(a){let n=new Float64Array(9);var o,u,f,_,y,b,M,T,P,A,O,z,j,G,Z,K,ce,re;A=(f=(u=a)[0])*(M=f+f),O=(_=u[1])*M,j=(y=u[2])*M,G=y*(T=_+_),K=(b=u[3])*M,ce=b*T,re=b*(P=y+y),(o=n)[0]=1-(z=_*T)-(Z=y*P),o[3]=O-re,o[6]=j+ce,o[1]=O+re,o[4]=1-A-Z,o[7]=G-K,o[2]=j-ce,o[5]=G+K,o[8]=1-A-z;let se=Eo(-Math.asin(Tr(n[2],-1,1))),ye,we;return Math.hypot(n[5],n[8])<.001?(ye=0,we=-Eo(Math.atan2(n[3],n[4]))):(ye=Eo(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),we=Eo(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:ye,pitch:se+90,bearing:we}},h.be=function(a,n){return a.roll==n.roll&&a.pitch==n.pitch&&a.bearing==n.bearing},h.bf=bt,h.bg=jo,h.bh=Hc,h.bi=id,h.bj=$c,h.bk=es,h.bl=ki,h.bm=ar,h.bn=function(a,n,o,u,f){return es(u,f,Tr((a-n)/(o-n),0,1))},h.bo=or,h.bp=function(){return new Float64Array(3)},h.bq=function(a,n,o,u){return a[0]=n[0]+o[0]*u,a[1]=n[1]+o[1]*u,a[2]=n[2]+o[2]*u,a},h.br=xo,h.bs=function(a,n,o){var u=o[0],f=o[1],_=o[2],y=n[0],b=n[1],M=n[2],T=f*M-_*b,P=_*y-u*M,A=u*b-f*y,O=f*A-_*P,z=_*T-u*A,j=u*P-f*T,G=2*o[3];return P*=G,A*=G,z*=2,j*=2,a[0]=y+(T*=G)+(O*=2),a[1]=b+P+z,a[2]=M+A+j,a},h.bt=function(a,n,o){let u=(f=[a[0],a[1],a[2],n[0],n[1],n[2],o[0],o[1],o[2]])[0]*((P=f[8])*(y=f[4])-(b=f[5])*(T=f[7]))+f[1]*(-P*(_=f[3])+b*(M=f[6]))+f[2]*(T*_-y*M);var f,_,y,b,M,T,P;if(u===0)return null;let A=tn([],[n[0],n[1],n[2]],[o[0],o[1],o[2]]),O=tn([],[o[0],o[1],o[2]],[a[0],a[1],a[2]]),z=tn([],[a[0],a[1],a[2]],[n[0],n[1],n[2]]),j=Xt([],A,-a[3]);return Gt(j,j,Xt([],O,-n[3])),Gt(j,j,Xt([],z,-o[3])),Xt(j,j,1/u),j},h.bu=cy,h.bv=function(){return new Float64Array(4)},h.bw=function(a,n,o,u){var f=[],_=[];return f[0]=n[0]-o[0],f[1]=n[1]-o[1],f[2]=n[2]-o[2],_[0]=f[0]*Math.cos(u)-f[1]*Math.sin(u),_[1]=f[0]*Math.sin(u)+f[1]*Math.cos(u),_[2]=f[2],a[0]=_[0]+o[0],a[1]=_[1]+o[1],a[2]=_[2]+o[2],a},h.bx=function(a,n,o,u){var f=[],_=[];return f[0]=n[0]-o[0],f[1]=n[1]-o[1],f[2]=n[2]-o[2],_[0]=f[0],_[1]=f[1]*Math.cos(u)-f[2]*Math.sin(u),_[2]=f[1]*Math.sin(u)+f[2]*Math.cos(u),a[0]=_[0]+o[0],a[1]=_[1]+o[1],a[2]=_[2]+o[2],a},h.by=function(a,n,o,u){var f=[],_=[];return f[0]=n[0]-o[0],f[1]=n[1]-o[1],f[2]=n[2]-o[2],_[0]=f[2]*Math.sin(u)+f[0]*Math.cos(u),_[1]=f[1],_[2]=f[2]*Math.cos(u)-f[0]*Math.sin(u),a[0]=_[0]+o[0],a[1]=_[1]+o[1],a[2]=_[2]+o[2],a},h.bz=function(a,n,o){var u=Math.sin(o),f=Math.cos(o),_=n[0],y=n[1],b=n[2],M=n[3],T=n[8],P=n[9],A=n[10],O=n[11];return n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=_*f-T*u,a[1]=y*f-P*u,a[2]=b*f-A*u,a[3]=M*f-O*u,a[8]=_*u+T*f,a[9]=y*u+P*f,a[10]=b*u+A*f,a[11]=M*u+O*f,a},h.c=ue,h.c0=P2,h.c1=class extends l{},h.c2=G_,h.c3=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},h.c4=Db,h.c5=function(a,n,o){var u=n[0],f=n[1],_=n[2],y=o[3]*u+o[7]*f+o[11]*_+o[15];return a[0]=(o[0]*u+o[4]*f+o[8]*_+o[12])/(y=y||1),a[1]=(o[1]*u+o[5]*f+o[9]*_+o[13])/y,a[2]=(o[2]*u+o[6]*f+o[10]*_+o[14])/y,a},h.c6=class extends Zh{},h.c7=class extends C{},h.c8=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]&&a[4]===n[4]&&a[5]===n[5]&&a[6]===n[6]&&a[7]===n[7]&&a[8]===n[8]&&a[9]===n[9]&&a[10]===n[10]&&a[11]===n[11]&&a[12]===n[12]&&a[13]===n[13]&&a[14]===n[14]&&a[15]===n[15]},h.c9=function(a,n){var o=a[0],u=a[1],f=a[2],_=a[3],y=a[4],b=a[5],M=a[6],T=a[7],P=a[8],A=a[9],O=a[10],z=a[11],j=a[12],G=a[13],Z=a[14],K=a[15],ce=n[0],re=n[1],se=n[2],ye=n[3],we=n[4],De=n[5],Ve=n[6],Le=n[7],Be=n[8],Ke=n[9],je=n[10],Ue=n[11],Ie=n[12],rt=n[13],ot=n[14],et=n[15];return Math.abs(o-ce)<=Me*Math.max(1,Math.abs(o),Math.abs(ce))&&Math.abs(u-re)<=Me*Math.max(1,Math.abs(u),Math.abs(re))&&Math.abs(f-se)<=Me*Math.max(1,Math.abs(f),Math.abs(se))&&Math.abs(_-ye)<=Me*Math.max(1,Math.abs(_),Math.abs(ye))&&Math.abs(y-we)<=Me*Math.max(1,Math.abs(y),Math.abs(we))&&Math.abs(b-De)<=Me*Math.max(1,Math.abs(b),Math.abs(De))&&Math.abs(M-Ve)<=Me*Math.max(1,Math.abs(M),Math.abs(Ve))&&Math.abs(T-Le)<=Me*Math.max(1,Math.abs(T),Math.abs(Le))&&Math.abs(P-Be)<=Me*Math.max(1,Math.abs(P),Math.abs(Be))&&Math.abs(A-Ke)<=Me*Math.max(1,Math.abs(A),Math.abs(Ke))&&Math.abs(O-je)<=Me*Math.max(1,Math.abs(O),Math.abs(je))&&Math.abs(z-Ue)<=Me*Math.max(1,Math.abs(z),Math.abs(Ue))&&Math.abs(j-Ie)<=Me*Math.max(1,Math.abs(j),Math.abs(Ie))&&Math.abs(G-rt)<=Me*Math.max(1,Math.abs(G),Math.abs(rt))&&Math.abs(Z-ot)<=Me*Math.max(1,Math.abs(Z),Math.abs(ot))&&Math.abs(K-et)<=Me*Math.max(1,Math.abs(K),Math.abs(et))},h.cA=function(a,n){V.REGISTERED_PROTOCOLS[a]=n},h.cB=function(a){delete V.REGISTERED_PROTOCOLS[a]},h.cC=function(a,n){let o={};for(let f=0;f<a.length;f++){let _=n&&n[a[f].id]||A_(a[f]);n&&(n[a[f].id]=_);let y=o[_];y||(y=o[_]=[]),y.push(a[f])}let u=[];for(let f in o)u.push(o[f]);return u},h.cD=$e,h.cE=T1,h.cF=P1,h.cG=o1,h.cH=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Ht/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;let n=a.bucket.layers[0],o=n.layout,u=n._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new an(a.bucket.zoom+1),a.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new an(a.bucket.zoom+1),a.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new an(18))};if(a.bucket.textSizeData.kind==="composite"){let{minZoom:T,maxZoom:P}=a.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new an(T),a.canonical),u["text-size"].possiblyEvaluate(new an(P),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){let{minZoom:T,maxZoom:P}=a.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new an(T),a.canonical),u["icon-size"].possiblyEvaluate(new an(P),a.canonical)]}let _=o.get("text-line-height")*Gn,y=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",b=o.get("text-keep-upright"),M=o.get("text-size");for(let T of a.bucket.features){let P=o.get("text-font").evaluate(T,{},a.canonical).join(","),A=M.evaluate(T,{},a.canonical),O=f.layoutTextSize.evaluate(T,{},a.canonical),z=f.layoutIconSize.evaluate(T,{},a.canonical),j={horizontal:{},vertical:void 0},G=T.text,Z,K=[0,0];if(G){let se=G.toString(),ye=o.get("text-letter-spacing").evaluate(T,{},a.canonical)*Gn,we=L_(se)?ye:0,De=o.get("text-anchor").evaluate(T,{},a.canonical),Ve=B1(n,T,a.canonical);if(!Ve){let je=o.get("text-radial-offset").evaluate(T,{},a.canonical);K=je?j1(De,[je*Gn,dy]):o.get("text-offset").evaluate(T,{},a.canonical).map(Ue=>Ue*Gn)}let Le=y?"center":o.get("text-justify").evaluate(T,{},a.canonical),Be=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(T,{},a.canonical)*Gn:1/0,Ke=()=>{a.bucket.allowVerticalPlacement&&Rc(se)&&(j.vertical=Lp(G,a.glyphMap,a.glyphPositions,a.imagePositions,P,Be,_,De,"left",we,K,h.ao.vertical,!0,O,A))};if(!y&&Ve){let je=new Set;if(Le==="auto")for(let Ie=0;Ie<Ve.values.length;Ie+=2)je.add(fy(Ve.values[Ie]));else je.add(Le);let Ue=!1;for(let Ie of je)if(!j.horizontal[Ie])if(Ue)j.horizontal[Ie]=j.horizontal[0];else{let rt=Lp(G,a.glyphMap,a.glyphPositions,a.imagePositions,P,Be,_,"center",Ie,we,K,h.ao.horizontal,!1,O,A);rt&&(j.horizontal[Ie]=rt,Ue=rt.positionedLines.length===1)}Ke()}else{Le==="auto"&&(Le=fy(De));let je=Lp(G,a.glyphMap,a.glyphPositions,a.imagePositions,P,Be,_,De,Le,we,K,h.ao.horizontal,!1,O,A);je&&(j.horizontal[Le]=je),Ke(),Rc(se)&&y&&b&&(j.vertical=Lp(G,a.glyphMap,a.glyphPositions,a.imagePositions,P,Be,_,De,Le,we,K,h.ao.vertical,!1,O,A))}}let ce=!1;if(T.icon&&T.icon.name){let se=a.imageMap[T.icon.name];se&&(Z=K2(a.imagePositions[T.icon.name],o.get("icon-offset").evaluate(T,{},a.canonical),o.get("icon-anchor").evaluate(T,{},a.canonical)),ce=!!se.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ce:a.bucket.sdfIcons!==ce&&bn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==a.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}let re=V1(j.horizontal)||j.vertical;a.bucket.iconsInText=!!re&&re.iconsInText,(re||Z)&&fP(a.bucket,T,j,Z,a.imageMap,f,O,z,K,ce,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},h.cI=Q_,h.cJ=X_,h.cK=K_,h.cL=Hb,h.cM=ey,h.cN=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},h.cO=function(a,n,o,u,f){return s(this,void 0,void 0,function*(){if(Ee())try{return yield Qs(a,n,o,u,f)}catch{}return function(_,y,b,M,T){let P=_.width,A=_.height;wo&&Mo||(wo=new OffscreenCanvas(P,A),Mo=wo.getContext("2d",{willReadFrequently:!0})),wo.width=P,wo.height=A,Mo.drawImage(_,0,0,P,A);let O=Mo.getImageData(y,b,M,T);return Mo.clearRect(0,0,P,A),O.data}(a,n,o,u,f)})},h.cP=kb,h.cQ=w,h.cR=$b,h.cS=qc,h.cT=ll,h.cU=function(a,n){let o=new Map;if(a!=null)if(a.type==="Feature")o.set(hd(a,n),a);else for(let u of a.features)o.set(hd(u,n),u);return o},h.cV=function(a,n){if(a==null)return!0;if(a.type==="Feature")return hd(a,n)!=null;if(a.type==="FeatureCollection"){let o=new Set;for(let u of a.features){let f=hd(u,n);if(f==null||o.has(f))return!1;o.add(f)}return!0}return!1},h.cW=function(a,n,o){var u,f,_,y;if(n.removeAll&&a.clear(),n.remove)for(let b of n.remove)a.delete(b);if(n.add)for(let b of n.add){let M=hd(b,o);M!=null&&a.set(M,b)}if(n.update)for(let b of n.update){let M=a.get(b.id);if(M==null)continue;let T=!b.removeAllProperties&&(((u=b.removeProperties)===null||u===void 0?void 0:u.length)>0||((f=b.addOrUpdateProperties)===null||f===void 0?void 0:f.length)>0);if((b.newGeometry||b.removeAllProperties||T)&&(M=Object.assign({},M),a.set(b.id,M),T&&(M.properties=Object.assign({},M.properties))),b.newGeometry&&(M.geometry=b.newGeometry),b.removeAllProperties)M.properties={};else if(((_=b.removeProperties)===null||_===void 0?void 0:_.length)>0)for(let P of b.removeProperties)Object.prototype.hasOwnProperty.call(M.properties,P)&&delete M.properties[P];if(((y=b.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0)for(let{key:P,value:A}of b.addOrUpdateProperties)M.properties[P]=A}},h.cX=vi,h.ca=function(a,n){return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},h.cb=a=>a.type==="symbol",h.cc=a=>a.type==="circle",h.cd=a=>a.type==="heatmap",h.ce=a=>a.type==="line",h.cf=a=>a.type==="fill",h.cg=a=>a.type==="fill-extrusion",h.ch=a=>a.type==="hillshade",h.ci=a=>a.type==="color-relief",h.cj=a=>a.type==="raster",h.ck=a=>a.type==="background",h.cl=a=>a.type==="custom",h.cm=bo,h.cn=function(a,n,o){let u=tc(n.x-o.x,n.y-o.y),f=tc(a.x-o.x,a.y-o.y);var _,y;return Eo(Math.atan2(u[0]*f[1]-u[1]*f[0],(_=u)[0]*(y=f)[0]+_[1]*y[1]))},h.co=ts,h.cp=function(a,n){return To[n]&&(a instanceof MouseEvent||a instanceof WheelEvent)},h.cq=function(a,n){return Io[n]&&"touches"in a},h.cr=function(a){return Io[a]||To[a]},h.cs=function(a,n,o){var u=n[0],f=n[1];return a[0]=o[0]*u+o[4]*f+o[12],a[1]=o[1]*u+o[5]*f+o[13],a},h.ct=function(a,n){let{x:o,y:u}=ud.fromLngLat(n);return!(a<0||a>25||u<0||u>=1||o<0||o>=1)},h.cu=function(a,n){return a[0]=n[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},h.cv=class extends xa{},h.cw=mP,h.cy=function(a){return a.message===Js},h.cz=te,h.d=ve,h.e=Xr,h.f=a=>s(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));let n=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(n)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),h.g=$,h.h=a=>new Promise((n,o)=>{let u=new Image;u.onload=()=>{n(u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=Oi})},u.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let f=new Blob([new Uint8Array(a)],{type:"image/png"});u.src=a.byteLength?URL.createObjectURL(f):Oi}),h.i=Ni,h.j=(a,n)=>he(Xr(a,{type:"json"}),n),h.k=Te,h.l=Re,h.m=he,h.n=(a,n)=>he(Xr(a,{type:"arrayBuffer"}),n),h.o=function(a){return new ey(a).readFields(B2,[])},h.p=i1,h.q=Jh,h.r=vr,h.s=So,h.t=Sp,h.u=Pt,h.v=pe,h.w=bn,h.x=R_,h.y=ml,h.z=ga}),i("worker",["./shared"],function(h){"use strict";class s{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(let te of V){this._layerConfigs[te.id]=te;let le=this._layers[te.id]=h.bJ(te);le._featureFilter=h.aa(le.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(let te of $)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};let q=h.cC(Object.values(this._layerConfigs),this.keyCache);for(let te of q){let le=te.map(Te=>this._layers[Te.id]),he=le[0];if(he.visibility==="none")continue;let ve=he.source||"",fe=this.familiesBySource[ve];fe||(fe=this.familiesBySource[ve]={});let Se=he.sourceLayer||"_geojsonTileLayer",Re=fe[Se];Re||(Re=fe[Se]=[]),Re.push(le)}}}class v{constructor(V){let $={},q=[];for(let ve in V){let fe=V[ve],Se=$[ve]={};for(let Re in fe){let Te=fe[+Re];if(!Te||Te.bitmap.width===0||Te.bitmap.height===0)continue;let Xe={x:0,y:0,w:Te.bitmap.width+2,h:Te.bitmap.height+2};q.push(Xe),Se[Re]={rect:Xe,metrics:Te.metrics}}}let{w:te,h:le}=h.p(q),he=new h.q({width:te||1,height:le||1});for(let ve in V){let fe=V[ve];for(let Se in fe){let Re=fe[+Se];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;let Te=$[ve][Se].rect;h.q.copy(Re.bitmap,he,{x:0,y:0},{x:Te.x+1,y:Te.y+1},Re.bitmap)}}this.image=he,this.positions=$}}h.cD("GlyphAtlas",v);class w{constructor(V){this.tileID=new h.Z(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.globalState=V.globalState}parse(V,$,q,te,le){return h._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new h.a8;let he=new h.cE(Object.keys(V.layers).sort()),ve=new h.cF(this.tileID,this.promoteId);ve.bucketLayerIDs=[];let fe={},Se={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q,subdivisionGranularity:le},Re=$.familiesBySource[this.source];for(let St in Re){let Rt=V.layers[St];if(!Rt)continue;Rt.version===1&&h.w(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let In=he.encode(St),Ne=[];for(let sr=0;sr<Rt.length;sr++){let hn=Rt.feature(sr),Co=ve.getId(hn,St);Ne.push({feature:hn,id:Co,index:sr,sourceLayerIndex:In})}for(let sr of Re[St]){let hn=sr[0];hn.source!==this.source&&h.w(`layer.source = ${hn.source} does not equal this.source = ${this.source}`),hn.minzoom&&this.zoom<Math.floor(hn.minzoom)||hn.maxzoom&&this.zoom>=hn.maxzoom||hn.visibility!=="none"&&(I(sr,this.zoom,q),(fe[hn.id]=hn.createBucket({index:ve.bucketLayerIDs.length,layers:sr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source,globalState:this.globalState})).populate(Ne,Se,this.tileID.canonical),ve.bucketLayerIDs.push(sr.map(Co=>Co.id)))}}let Te=h.bN(Se.glyphDependencies,St=>Object.keys(St).map(Number));this.inFlightDependencies.forEach(St=>St?.abort()),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(Te).length){let St=new AbortController;this.inFlightDependencies.push(St),Xe=te.sendAsync({type:"GG",data:{stacks:Te,source:this.source,tileID:this.tileID,type:"glyphs"}},St)}let pe=Object.keys(Se.iconDependencies),st=Promise.resolve({});if(pe.length){let St=new AbortController;this.inFlightDependencies.push(St),st=te.sendAsync({type:"GI",data:{icons:pe,source:this.source,tileID:this.tileID,type:"icons"}},St)}let yt=Object.keys(Se.patternDependencies),Qe=Promise.resolve({});if(yt.length){let St=new AbortController;this.inFlightDependencies.push(St),Qe=te.sendAsync({type:"GI",data:{icons:yt,source:this.source,tileID:this.tileID,type:"patterns"}},St)}let[ut,nn,Nn]=yield Promise.all([Xe,st,Qe]),Ln=new v(ut),wn=new h.cG(nn,Nn);for(let St in fe){let Rt=fe[St];Rt instanceof h.a9?(I(Rt.layers,this.zoom,q),h.cH({bucket:Rt,glyphMap:ut,glyphPositions:Ln.positions,imageMap:nn,imagePositions:wn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Se.subdivisionGranularity})):Rt.hasPattern&&(Rt instanceof h.cI||Rt instanceof h.cJ||Rt instanceof h.cK)&&(I(Rt.layers,this.zoom,q),Rt.addFeatures(Se,this.tileID.canonical,wn.patternPositions))}return this.status="done",{buckets:Object.values(fe).filter(St=>!St.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ln.image,imageAtlas:wn,glyphMap:this.returnDependencies?ut:null,iconMap:this.returnDependencies?nn:null,glyphPositions:this.returnDependencies?Ln.positions:null}})}}function I(ue,V,$){let q=new h.F(V);for(let te of ue)te.recalculate(q,$)}class N{constructor(V,$,q){this.actor=V,this.layerIndex=$,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,$){return h._(this,void 0,void 0,function*(){let q=yield h.n(V.request,$);try{return{vectorTile:new h.cL(new h.cM(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(te){let le=new Uint8Array(q.data),he=`Unable to parse the tile at ${V.request.url}, `;throw he+=le[0]===31&&le[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.message}`,new Error(he)}})}loadTile(V){return h._(this,void 0,void 0,function*(){let $=V.uid,q=!!(V&&V.request&&V.request.collectResourceTiming)&&new h.cN(V.request),te=new w(V);this.loading[$]=te;let le=new AbortController;te.abort=le;try{let he=yield this.loadVectorTile(V,le);if(delete this.loading[$],!he)return null;let ve=he.rawData,fe={};he.expires&&(fe.expires=he.expires),he.cacheControl&&(fe.cacheControl=he.cacheControl);let Se={};if(q){let Te=q.finish();Te&&(Se.resourceTiming=JSON.parse(JSON.stringify(Te)))}te.vectorTile=he.vectorTile;let Re=te.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[$]=te,this.fetching[$]={rawTileData:ve,cacheControl:fe,resourceTiming:Se};try{let Te=yield Re;return h.e({rawTileData:ve.slice(0)},Te,fe,Se)}finally{delete this.fetching[$]}}catch(he){throw delete this.loading[$],te.status="done",this.loaded[$]=te,he}})}reloadTile(V){return h._(this,void 0,void 0,function*(){let $=V.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let q=this.loaded[$];if(q.showCollisionBoxes=V.showCollisionBoxes,q.globalState=V.globalState,q.status==="parsing"){let te=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity),le;if(this.fetching[$]){let{rawTileData:he,cacheControl:ve,resourceTiming:fe}=this.fetching[$];delete this.fetching[$],le=h.e({rawTileData:he.slice(0)},te,ve,fe)}else le=te;return le}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)})}abortTile(V){return h._(this,void 0,void 0,function*(){let $=this.loading,q=V.uid;$&&$[q]&&$[q].abort&&($[q].abort.abort(),delete $[q])})}removeTile(V){return h._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class B{constructor(){this.loaded={}}loadTile(V){return h._(this,void 0,void 0,function*(){let{uid:$,encoding:q,rawImageData:te,redFactor:le,greenFactor:he,blueFactor:ve,baseShift:fe}=V,Se=te.width+2,Re=te.height+2,Te=h.b(te)?new h.R({width:Se,height:Re},yield h.cO(te,-1,-1,Se,Re)):te,Xe=new h.cP($,Te,q,le,he,ve,fe);return this.loaded=this.loaded||{},this.loaded[$]=Xe,Xe})}removeTile(V){let $=this.loaded,q=V.uid;$&&$[q]&&delete $[q]}}var L,ie,H=function(){if(ie)return L;function ue($,q){if($.length!==0){V($[0],q);for(var te=1;te<$.length;te++)V($[te],!q)}}function V($,q){for(var te=0,le=0,he=0,ve=$.length,fe=ve-1;he<ve;fe=he++){var Se=($[he][0]-$[fe][0])*($[fe][1]+$[he][1]),Re=te+Se;le+=Math.abs(te)>=Math.abs(Se)?te-Re+Se:Se-Re+te,te=Re}te+le>=0!=!!q&&$.reverse()}return ie=1,L=function $(q,te){var le,he=q&&q.type;if(he==="FeatureCollection")for(le=0;le<q.features.length;le++)$(q.features[le],te);else if(he==="GeometryCollection")for(le=0;le<q.geometries.length;le++)$(q.geometries[le],te);else if(he==="Feature")$(q.geometry,te);else if(he==="Polygon")ue(q.coordinates,te);else if(he==="MultiPolygon")for(le=0;le<q.coordinates.length;le++)ue(q.coordinates[le],te);return q}}(),me=h.cQ(H);class Ee extends h.cS{constructor(V,$){super(new h.cM,0,$,[],[]),this.feature=V,this.type=V.type,this.properties=V.tags?V.tags:{},"id"in V&&(typeof V.id=="string"?this.id=parseInt(V.id,10):typeof V.id!="number"||isNaN(V.id)||(this.id=V.id))}loadGeometry(){let V=[],$=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let q of $){let te=[];for(let le of q)te.push(new h.P(le[0],le[1]));V.push(te)}return V}}class Me extends h.cR{constructor(V,$){super(new h.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=$?$.version:1,this.extent=$?$.extent:4096,this.length=V.length,this.features=V}feature(V){return new Ee(this.features[V],this.extent)}}function Ae(ue,V){V.writeVarintField(15,ue.version||1),V.writeStringField(1,ue.name||""),V.writeVarintField(5,ue.extent||4096);let $={keys:[],values:[],keycache:{},valuecache:{}};for(let le=0;le<ue.length;le++)$.feature=ue.feature(le),V.writeMessage(2,We,$);let q=$.keys;for(let le of q)V.writeStringField(3,le);let te=$.values;for(let le of te)V.writeMessage(4,Gt,le)}function We(ue,V){if(!ue.feature)return;let $=ue.feature;$.id!==void 0&&V.writeVarintField(1,$.id),V.writeMessage(2,it,ue),V.writeVarintField(3,$.type),V.writeMessage(4,Nt,$)}function it(ue,V){for(let $ in ue.feature?.properties){let q=ue.feature.properties[$],te=ue.keycache[$];if(q===null)continue;te===void 0&&(ue.keys.push($),te=ue.keys.length-1,ue.keycache[$]=te),V.writeVarint(te),typeof q!="string"&&typeof q!="boolean"&&typeof q!="number"&&(q=JSON.stringify(q));let le=typeof q+":"+q,he=ue.valuecache[le];he===void 0&&(ue.values.push(q),he=ue.values.length-1,ue.valuecache[le]=he),V.writeVarint(he)}}function _t(ue,V){return(V<<3)+(7&ue)}function Ct(ue){return ue<<1^ue>>31}function Nt(ue,V){let $=ue.loadGeometry(),q=ue.type,te=0,le=0;for(let he of $){let ve=1;q===1&&(ve=he.length),V.writeVarint(_t(1,ve));let fe=q===3?he.length-1:he.length;for(let Se=0;Se<fe;Se++){Se===1&&q!==1&&V.writeVarint(_t(2,fe-1));let Re=he[Se].x-te,Te=he[Se].y-le;V.writeVarint(Ct(Re)),V.writeVarint(Ct(Te)),te+=Re,le+=Te}ue.type===3&&V.writeVarint(_t(7,1))}}function Gt(ue,V){let $=typeof ue;$==="string"?V.writeStringField(1,ue):$==="boolean"?V.writeBooleanField(7,ue):$==="number"&&(ue%1!=0?V.writeDoubleField(3,ue):ue<0?V.writeSVarintField(6,ue):V.writeVarintField(5,ue))}let Xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},tn=Math.fround||(kn=new Float32Array(1),ue=>(kn[0]=+ue,kn[0]));var kn;class xn{constructor(V){this.options=Object.assign(Object.create(Xt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){let{log:$,minZoom:q,maxZoom:te}=this.options;$&&console.time("total time");let le=`prepare ${V.length} points`;$&&console.time(le),this.points=V;let he=[];for(let fe=0;fe<V.length;fe++){let Se=V[fe];if(!Se.geometry)continue;let[Re,Te]=Se.geometry.coordinates,Xe=tn(xo(Re)),pe=tn(Qo(Te));he.push(Xe,pe,1/0,fe,-1,1),this.options.reduce&&he.push(0)}let ve=this.trees[te+1]=this._createTree(he);$&&console.timeEnd(le);for(let fe=te;fe>=q;fe--){let Se=+Date.now();ve=this.trees[fe]=this._createTree(this._cluster(ve,fe)),$&&console.log("z%d: %d clusters in %dms",fe,ve.numItems,+Date.now()-Se)}return $&&console.timeEnd("total time"),this}getClusters(V,$){let q=((V[0]+180)%360+360)%360-180,te=Math.max(-90,Math.min(90,V[1])),le=V[2]===180?180:((V[2]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)q=-180,le=180;else if(q>le){let Te=this.getClusters([q,te,180,he],$),Xe=this.getClusters([-180,te,le,he],$);return Te.concat(Xe)}let ve=this.trees[this._limitZoom($)],fe=ve.range(xo(q),Qo(he),xo(le),Qo(te)),Se=ve.data,Re=[];for(let Te of fe){let Xe=this.stride*Te;Re.push(Se[Xe+5]>1?Wr(Se,Xe,this.clusterProps):this.points[Se[Xe+3]])}return Re}getChildren(V){let $=this._getOriginId(V),q=this._getOriginZoom(V),te="No cluster with the specified id.",le=this.trees[q];if(!le)throw new Error(te);let he=le.data;if($*this.stride>=he.length)throw new Error(te);let ve=this.options.radius/(this.options.extent*Math.pow(2,q-1)),fe=le.within(he[$*this.stride],he[$*this.stride+1],ve),Se=[];for(let Re of fe){let Te=Re*this.stride;he[Te+4]===V&&Se.push(he[Te+5]>1?Wr(he,Te,this.clusterProps):this.points[he[Te+3]])}if(Se.length===0)throw new Error(te);return Se}getLeaves(V,$,q){let te=[];return this._appendLeaves(te,V,$=$||10,q=q||0,0),te}getTile(V,$,q){let te=this.trees[this._limitZoom(V)],le=Math.pow(2,V),{extent:he,radius:ve}=this.options,fe=ve/he,Se=(q-fe)/le,Re=(q+1+fe)/le,Te={features:[]};return this._addTileFeatures(te.range(($-fe)/le,Se,($+1+fe)/le,Re),te.data,$,q,le,Te),$===0&&this._addTileFeatures(te.range(1-fe/le,Se,1,Re),te.data,le,q,le,Te),$===le-1&&this._addTileFeatures(te.range(0,Se,fe/le,Re),te.data,-1,q,le,Te),Te.features.length?Te:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){let q=this.getChildren(V);if($++,q.length!==1)break;V=q[0].properties.cluster_id}return $}_appendLeaves(V,$,q,te,le){let he=this.getChildren($);for(let ve of he){let fe=ve.properties;if(fe&&fe.cluster?le+fe.point_count<=te?le+=fe.point_count:le=this._appendLeaves(V,fe.cluster_id,q,te,le):le<te?le++:V.push(ve),V.length===q)break}return le}_createTree(V){let $=new h.aI(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<V.length;q+=this.stride)$.add(V[q],V[q+1]);return $.finish(),$.data=V,$}_addTileFeatures(V,$,q,te,le,he){for(let ve of V){let fe=ve*this.stride,Se=$[fe+5]>1,Re,Te,Xe;if(Se)Re=Ir($,fe,this.clusterProps),Te=$[fe],Xe=$[fe+1];else{let yt=this.points[$[fe+3]];Re=yt.properties;let[Qe,ut]=yt.geometry.coordinates;Te=xo(Qe),Xe=Qo(ut)}let pe={type:1,geometry:[[Math.round(this.options.extent*(Te*le-q)),Math.round(this.options.extent*(Xe*le-te))]],tags:Re},st;st=Se||this.options.generateId?$[fe+3]:this.points[$[fe+3]].id,st!==void 0&&(pe.id=st),he.features.push(pe)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){let{radius:q,extent:te,reduce:le,minPoints:he}=this.options,ve=q/(te*Math.pow(2,$)),fe=V.data,Se=[],Re=this.stride;for(let Te=0;Te<fe.length;Te+=Re){if(fe[Te+2]<=$)continue;fe[Te+2]=$;let Xe=fe[Te],pe=fe[Te+1],st=V.within(fe[Te],fe[Te+1],ve),yt=fe[Te+5],Qe=yt;for(let ut of st){let nn=ut*Re;fe[nn+2]>$&&(Qe+=fe[nn+5])}if(Qe>yt&&Qe>=he){let ut,nn=Xe*yt,Nn=pe*yt,Ln=-1,wn=(Te/Re<<5)+($+1)+this.points.length;for(let St of st){let Rt=St*Re;if(fe[Rt+2]<=$)continue;fe[Rt+2]=$;let In=fe[Rt+5];nn+=fe[Rt]*In,Nn+=fe[Rt+1]*In,fe[Rt+4]=wn,le&&(ut||(ut=this._map(fe,Te,!0),Ln=this.clusterProps.length,this.clusterProps.push(ut)),le(ut,this._map(fe,Rt)))}fe[Te+4]=wn,Se.push(nn/Qe,Nn/Qe,1/0,wn,-1,Qe),le&&Se.push(Ln)}else{for(let ut=0;ut<Re;ut++)Se.push(fe[Te+ut]);if(Qe>1)for(let ut of st){let nn=ut*Re;if(!(fe[nn+2]<=$)){fe[nn+2]=$;for(let Nn=0;Nn<Re;Nn++)Se.push(fe[nn+Nn])}}}}return Se}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$,q){if(V[$+5]>1){let he=this.clusterProps[V[$+6]];return q?Object.assign({},he):he}let te=this.points[V[$+3]].properties,le=this.options.map(te);return q&&le===te?Object.assign({},le):le}}function Wr(ue,V,$){return{type:"Feature",id:ue[V+3],properties:Ir(ue,V,$),geometry:{type:"Point",coordinates:[(q=ue[V],360*(q-.5)),tc(ue[V+1])]}};var q}function Ir(ue,V,$){let q=ue[V+5],te=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,le=ue[V+6],he=le===-1?{}:Object.assign({},$[le]);return Object.assign(he,{cluster:!0,cluster_id:ue[V+3],point_count:q,point_count_abbreviated:te})}function xo(ue){return ue/360+.5}function Qo(ue){let V=Math.sin(ue*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function tc(ue){let V=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Ht(ue,V,$,q){let te=q,le=V+($-V>>1),he,ve=$-V,fe=ue[V],Se=ue[V+1],Re=ue[$],Te=ue[$+1];for(let Xe=V+3;Xe<$;Xe+=3){let pe=Jo(ue[Xe],ue[Xe+1],fe,Se,Re,Te);if(pe>te)he=Xe,te=pe;else if(pe===te){let st=Math.abs(Xe-le);st<ve&&(he=Xe,ve=st)}}te>q&&(he-V>3&&Ht(ue,V,he,q),ue[he+2]=te,$-he>3&&Ht(ue,he,$,q))}function Jo(ue,V,$,q,te,le){let he=te-$,ve=le-q;if(he!==0||ve!==0){let fe=((ue-$)*he+(V-q)*ve)/(he*he+ve*ve);fe>1?($=te,q=le):fe>0&&($+=he*fe,q+=ve*fe)}return he=ue-$,ve=V-q,he*he+ve*ve}function or(ue,V,$,q){let te={id:ue??null,type:V,geometry:$,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")es(te,$);else if(V==="Polygon")es(te,$[0]);else if(V==="MultiLineString")for(let le of $)es(te,le);else if(V==="MultiPolygon")for(let le of $)es(te,le[0]);return te}function es(ue,V){for(let $=0;$<V.length;$+=3)ue.minX=Math.min(ue.minX,V[$]),ue.minY=Math.min(ue.minY,V[$+1]),ue.maxX=Math.max(ue.maxX,V[$]),ue.maxY=Math.max(ue.maxY,V[$+1])}function ki(ue,V,$,q){if(!V.geometry)return;let te=V.geometry.coordinates;if(te&&te.length===0)return;let le=V.geometry.type,he=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),ve=[],fe=V.id;if($.promoteId?fe=V.properties[$.promoteId]:$.generateId&&(fe=q||0),le==="Point")bo(te,ve);else if(le==="MultiPoint")for(let Se of te)bo(Se,ve);else if(le==="LineString")ts(te,ve,he,!1);else if(le==="MultiLineString"){if($.lineMetrics){for(let Se of te)ve=[],ts(Se,ve,he,!1),ue.push(or(fe,"LineString",ve,V.properties));return}Tr(te,ve,he,!1)}else if(le==="Polygon")Tr(te,ve,he,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(let Se of V.geometry.geometries)ki(ue,{id:fe,geometry:Se,properties:V.properties},$,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Se of te){let Re=[];Tr(Se,Re,he,!0),ve.push(Re)}}ue.push(or(fe,le,ve,V.properties))}function bo(ue,V){V.push(Xs(ue[0]),Xr(ue[1]),0)}function ts(ue,V,$,q){let te,le,he=0;for(let fe=0;fe<ue.length;fe++){let Se=Xs(ue[fe][0]),Re=Xr(ue[fe][1]);V.push(Se,Re,0),fe>0&&(he+=q?(te*Re-Se*le)/2:Math.sqrt(Math.pow(Se-te,2)+Math.pow(Re-le,2))),te=Se,le=Re}let ve=V.length-3;V[2]=1,Ht(V,0,ve,$),V[ve+2]=1,V.size=Math.abs(he),V.start=0,V.end=V.size}function Tr(ue,V,$,q){for(let te=0;te<ue.length;te++){let le=[];ts(ue[te],le,$,q),V.push(le)}}function Xs(ue){return ue/360+.5}function Xr(ue){let V=Math.sin(ue*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function ui(ue,V,$,q,te,le,he,ve){if(q/=V,le>=($/=V)&&he<q)return ue;if(he<$||le>=q)return null;let fe=[];for(let Se of ue){let Re=Se.geometry,Te=Se.type,Xe=te===0?Se.minX:Se.minY,pe=te===0?Se.maxX:Se.maxY;if(Xe>=$&&pe<q){fe.push(Se);continue}if(pe<$||Xe>=q)continue;let st=[];if(Te==="Point"||Te==="MultiPoint")Ys(Re,st,$,q,te);else if(Te==="LineString")Ks(Re,st,$,q,te,!1,ve.lineMetrics);else if(Te==="MultiLineString")gn(Re,st,$,q,te,!1);else if(Te==="Polygon")gn(Re,st,$,q,te,!0);else if(Te==="MultiPolygon")for(let yt of Re){let Qe=[];gn(yt,Qe,$,q,te,!0),Qe.length&&st.push(Qe)}if(st.length){if(ve.lineMetrics&&Te==="LineString"){for(let yt of st)fe.push(or(Se.id,Te,yt,Se.tags));continue}Te!=="LineString"&&Te!=="MultiLineString"||(st.length===1?(Te="LineString",st=st[0]):Te="MultiLineString"),Te!=="Point"&&Te!=="MultiPoint"||(Te=st.length===3?"Point":"MultiPoint"),fe.push(or(Se.id,Te,st,Se.tags))}}return fe.length?fe:null}function Ys(ue,V,$,q,te){for(let le=0;le<ue.length;le+=3){let he=ue[le+te];he>=$&&he<=q&&bn(V,ue[le],ue[le+1],ue[le+2])}}function Ks(ue,V,$,q,te,le,he){let ve=Fr(ue),fe=te===0?hi:Ni,Se,Re,Te=ue.start;for(let Qe=0;Qe<ue.length-3;Qe+=3){let ut=ue[Qe],nn=ue[Qe+1],Nn=ue[Qe+2],Ln=ue[Qe+3],wn=ue[Qe+4],St=te===0?ut:nn,Rt=te===0?Ln:wn,In=!1;he&&(Se=Math.sqrt(Math.pow(ut-Ln,2)+Math.pow(nn-wn,2))),St<$?Rt>$&&(Re=fe(ve,ut,nn,Ln,wn,$),he&&(ve.start=Te+Se*Re)):St>q?Rt<q&&(Re=fe(ve,ut,nn,Ln,wn,q),he&&(ve.start=Te+Se*Re)):bn(ve,ut,nn,Nn),Rt<$&&St>=$&&(Re=fe(ve,ut,nn,Ln,wn,$),In=!0),Rt>q&&St<=q&&(Re=fe(ve,ut,nn,Ln,wn,q),In=!0),!le&&In&&(he&&(ve.end=Te+Se*Re),V.push(ve),ve=Fr(ue)),he&&(Te+=Se)}let Xe=ue.length-3,pe=ue[Xe],st=ue[Xe+1],yt=te===0?pe:st;yt>=$&&yt<=q&&bn(ve,pe,st,ue[Xe+2]),Xe=ve.length-3,le&&Xe>=3&&(ve[Xe]!==ve[0]||ve[Xe+1]!==ve[1])&&bn(ve,ve[0],ve[1],ve[2]),ve.length&&V.push(ve)}function Fr(ue){let V=[];return V.size=ue.size,V.start=ue.start,V.end=ue.end,V}function gn(ue,V,$,q,te,le){for(let he of ue)Ks(he,V,$,q,te,le,!1)}function bn(ue,V,$,q){ue.push(V,$,q)}function hi(ue,V,$,q,te,le){let he=(le-V)/(q-V);return bn(ue,le,$+(te-$)*he,1),he}function Ni(ue,V,$,q,te,le){let he=(le-$)/(te-$);return bn(ue,V+(q-V)*he,le,1),he}function ns(ue,V){let $=[];for(let q=0;q<ue.length;q++){let te=ue[q],le=te.type,he;if(le==="Point"||le==="MultiPoint"||le==="LineString")he=Li(te.geometry,V);else if(le==="MultiLineString"||le==="Polygon"){he=[];for(let ve of te.geometry)he.push(Li(ve,V))}else if(le==="MultiPolygon"){he=[];for(let ve of te.geometry){let fe=[];for(let Se of ve)fe.push(Li(Se,V));he.push(fe)}}$.push(or(te.id,le,he,te.tags))}return $}function Li(ue,V){let $=[];$.size=ue.size,ue.start!==void 0&&($.start=ue.start,$.end=ue.end);for(let q=0;q<ue.length;q+=3)$.push(ue[q]+V,ue[q+1],ue[q+2]);return $}function Oi(ue,V){if(ue.transformed)return ue;let $=1<<ue.z,q=ue.x,te=ue.y;for(let le of ue.features){let he=le.geometry,ve=le.type;if(le.geometry=[],ve===1)for(let fe=0;fe<he.length;fe+=2)le.geometry.push(Qs(he[fe],he[fe+1],V,$,q,te));else for(let fe=0;fe<he.length;fe++){let Se=[];for(let Re=0;Re<he[fe].length;Re+=2)Se.push(Qs(he[fe][Re],he[fe][Re+1],V,$,q,te));le.geometry.push(Se)}}return ue.transformed=!0,ue}function Qs(ue,V,$,q,te,le){return[Math.round($*(ue*q-te)),Math.round($*(V*q-le))]}function wo(ue,V,$,q,te){let le=V===te.maxZoom?0:te.tolerance/((1<<V)*te.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:ue.length,source:null,x:$,y:q,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ve of ue)Mo(he,ve,le,te);return he}function Mo(ue,V,$,q){let te=V.geometry,le=V.type,he=[];if(ue.minX=Math.min(ue.minX,V.minX),ue.minY=Math.min(ue.minY,V.minY),ue.maxX=Math.max(ue.maxX,V.maxX),ue.maxY=Math.max(ue.maxY,V.maxY),le==="Point"||le==="MultiPoint")for(let ve=0;ve<te.length;ve+=3)he.push(te[ve],te[ve+1]),ue.numPoints++,ue.numSimplified++;else if(le==="LineString")So(he,te,ue,$,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(let ve=0;ve<te.length;ve++)So(he,te[ve],ue,$,le==="Polygon",ve===0);else if(le==="MultiPolygon")for(let ve=0;ve<te.length;ve++){let fe=te[ve];for(let Se=0;Se<fe.length;Se++)So(he,fe[Se],ue,$,!0,Se===0)}if(he.length){let ve=V.tags||null;if(le==="LineString"&&q.lineMetrics){ve={};for(let Se in V.tags)ve[Se]=V.tags[Se];ve.mapbox_clip_start=te.start/te.size,ve.mapbox_clip_end=te.end/te.size}let fe={geometry:he,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:ve};V.id!==null&&(fe.id=V.id),ue.features.push(fe)}}function So(ue,V,$,q,te,le){let he=q*q;if(q>0&&V.size<(te?he:q))return void($.numPoints+=V.length/3);let ve=[];for(let fe=0;fe<V.length;fe+=3)(q===0||V[fe+2]>he)&&($.numSimplified++,ve.push(V[fe],V[fe+1])),$.numPoints++;te&&function(fe,Se){let Re=0;for(let Te=0,Xe=fe.length,pe=Xe-2;Te<Xe;pe=Te,Te+=2)Re+=(fe[Te]-fe[pe])*(fe[Te+1]+fe[pe+1]);if(Re>0===Se)for(let Te=0,Xe=fe.length;Te<Xe/2;Te+=2){let pe=fe[Te],st=fe[Te+1];fe[Te]=fe[Xe-2-Te],fe[Te+1]=fe[Xe-1-Te],fe[Xe-2-Te]=pe,fe[Xe-1-Te]=st}}(ve,le),ue.push(ve)}let rs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Eo{constructor(V,$){let q=($=this.options=function(le,he){for(let ve in he)le[ve]=he[ve];return le}(Object.create(rs),$)).debug;if(q&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let te=function(le,he){let ve=[];if(le.type==="FeatureCollection")for(let fe=0;fe<le.features.length;fe++)ki(ve,le.features[fe],he,fe);else ki(ve,le.type==="Feature"?le:{geometry:le},he);return ve}(V,$);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(le,he){let ve=he.buffer/he.extent,fe=le,Se=ui(le,1,-1-ve,ve,0,-1,2,he),Re=ui(le,1,1-ve,2+ve,0,-1,2,he);return(Se||Re)&&(fe=ui(le,1,-ve,1+ve,0,-1,2,he)||[],Se&&(fe=ns(Se,1).concat(fe)),Re&&(fe=fe.concat(ns(Re,-1)))),fe}(te,$),te.length&&this.splitTile(te,0,0,0),q&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,$,q,te,le,he,ve){let fe=[V,$,q,te],Se=this.options,Re=Se.debug;for(;fe.length;){te=fe.pop(),q=fe.pop(),$=fe.pop(),V=fe.pop();let Te=1<<$,Xe=Io($,q,te),pe=this.tiles[Xe];if(!pe&&(Re>1&&console.time("creation"),pe=this.tiles[Xe]=wo(V,$,q,te,Se),this.tileCoords.push({z:$,x:q,y:te}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,q,te,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));let In=`z${$}`;this.stats[In]=(this.stats[In]||0)+1,this.total++}if(pe.source=V,le==null){if($===Se.indexMaxZoom||pe.numPoints<=Se.indexMaxPoints)continue}else{if($===Se.maxZoom||$===le)continue;if(le!=null){let In=le-$;if(q!==he>>In||te!==ve>>In)continue}}if(pe.source=null,V.length===0)continue;Re>1&&console.time("clipping");let st=.5*Se.buffer/Se.extent,yt=.5-st,Qe=.5+st,ut=1+st,nn=null,Nn=null,Ln=null,wn=null,St=ui(V,Te,q-st,q+Qe,0,pe.minX,pe.maxX,Se),Rt=ui(V,Te,q+yt,q+ut,0,pe.minX,pe.maxX,Se);V=null,St&&(nn=ui(St,Te,te-st,te+Qe,1,pe.minY,pe.maxY,Se),Nn=ui(St,Te,te+yt,te+ut,1,pe.minY,pe.maxY,Se),St=null),Rt&&(Ln=ui(Rt,Te,te-st,te+Qe,1,pe.minY,pe.maxY,Se),wn=ui(Rt,Te,te+yt,te+ut,1,pe.minY,pe.maxY,Se),Rt=null),Re>1&&console.timeEnd("clipping"),fe.push(nn||[],$+1,2*q,2*te),fe.push(Nn||[],$+1,2*q,2*te+1),fe.push(Ln||[],$+1,2*q+1,2*te),fe.push(wn||[],$+1,2*q+1,2*te+1)}}getTile(V,$,q){V=+V,$=+$,q=+q;let te=this.options,{extent:le,debug:he}=te;if(V<0||V>24)return null;let ve=1<<V,fe=Io(V,$=$+ve&ve-1,q);if(this.tiles[fe])return Oi(this.tiles[fe],le);he>1&&console.log("drilling down to z%d-%d-%d",V,$,q);let Se,Re=V,Te=$,Xe=q;for(;!Se&&Re>0;)Re--,Te>>=1,Xe>>=1,Se=this.tiles[Io(Re,Te,Xe)];return Se&&Se.source?(he>1&&(console.log("found parent tile z%d-%d-%d",Re,Te,Xe),console.time("drilling down")),this.splitTile(Se.source,Re,Te,Xe,V,$,q),he>1&&console.timeEnd("drilling down"),this.tiles[fe]?Oi(this.tiles[fe],le):null):null}}function Io(ue,V,$){return 32*((1<<ue)*$+V)+ue}class To extends N{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,$){return h._(this,void 0,void 0,function*(){let q=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let te=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!te)return null;let le=new Me(te.features,{version:2,extent:h.$}),he=function(ve){let fe=new h.cM;return function(Se,Re){for(let Te in Se.layers)Re.writeMessage(3,Ae,Se.layers[Te])}(ve,fe),fe.finish()}(le);return he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),{vectorTile:le,rawData:he.buffer}})}loadData(V){return h._(this,void 0,void 0,function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();let q=!!(V&&V.request&&V.request.collectResourceTiming)&&new h.cN(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest);let te=yield this._pendingData;this._geoJSONIndex=V.cluster?new xn(function({superclusterOptions:he,clusterProperties:ve}){if(!ve||!he)return he;let fe={},Se={},Re={accumulated:null,zoom:0},Te={properties:null},Xe=Object.keys(ve);for(let pe of Xe){let[st,yt]=ve[pe],Qe=h.cT(yt),ut=h.cT(typeof st=="string"?[st,["accumulated"],["get",pe]]:st);fe[pe]=Qe.value,Se[pe]=ut.value}return he.map=pe=>{Te.properties=pe;let st={};for(let yt of Xe)st[yt]=fe[yt].evaluate(Re,Te);return st},he.reduce=(pe,st)=>{Te.properties=st;for(let yt of Xe)Re.accumulated=pe[yt],pe[yt]=Se[yt].evaluate(Re,Te)},he}(V)).load(te.features):function(he,ve){return new Eo(he,ve)}(te,V.geojsonVtOptions),this.loaded={};let le={data:te};if(q){let he=q.finish();he&&(le.resourceTiming={},le.resourceTiming[V.source]=JSON.parse(JSON.stringify(he)))}return le}catch(te){if(delete this._pendingRequest,h.cy(te))return{abandoned:!0};throw te}})}getData(){return h._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(V){let $=this.loaded;return $&&$[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,$){return h._(this,void 0,void 0,function*(){let q=yield this.loadGeoJSON(V,$);if(delete this._pendingRequest,typeof q!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(me(q,!0),V.filter){let te=h.cT(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(he=>`${he.key}: ${he.message}`).join(", "));q={type:"FeatureCollection",features:q.features.filter(he=>te.value.evaluate({zoom:0},he))}}return q})}loadGeoJSON(V,$){return h._(this,void 0,void 0,function*(){let{promoteId:q}=V;if(V.request){let te=yield h.j(V.request,$);return this._dataUpdateable=h.cV(te.data,q)?h.cU(te.data,q):void 0,te.data}if(typeof V.data=="string")try{let te=JSON.parse(V.data);return this._dataUpdateable=h.cV(te,q)?h.cU(te,q):void 0,te}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return h.cW(this._dataUpdateable,V.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return h._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class Js{constructor(V){this.self=V,this.actor=new h.J(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=($,q)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=q},this.self.addProtocol=h.cA,this.self.removeProtocol=h.cB,this.self.registerRTLTextPlugin=$=>{h.cX.setMethods($)},this.actor.registerMessageHandler("LDT",($,q)=>this._getDEMWorkerSource($,q.source).loadTile(q)),this.actor.registerMessageHandler("RDT",($,q)=>h._(this,void 0,void 0,function*(){this._getDEMWorkerSource($,q.source).removeTile(q)})),this.actor.registerMessageHandler("GCEZ",($,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource($,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("GCC",($,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource($,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("GCL",($,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource($,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("LD",($,q)=>this._getWorkerSource($,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("GD",($,q)=>this._getWorkerSource($,q.type,q.source).getData()),this.actor.registerMessageHandler("LT",($,q)=>this._getWorkerSource($,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("RT",($,q)=>this._getWorkerSource($,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("AT",($,q)=>this._getWorkerSource($,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("RMT",($,q)=>this._getWorkerSource($,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("RS",($,q)=>h._(this,void 0,void 0,function*(){if(!this.workerSources[$]||!this.workerSources[$][q.type]||!this.workerSources[$][q.type][q.source])return;let te=this.workerSources[$][q.type][q.source];delete this.workerSources[$][q.type][q.source],te.removeSource!==void 0&&te.removeSource(q)})),this.actor.registerMessageHandler("RM",$=>h._(this,void 0,void 0,function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$]})),this.actor.registerMessageHandler("SR",($,q)=>h._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("SRPS",($,q)=>this._syncRTLPluginState($,q)),this.actor.registerMessageHandler("IS",($,q)=>h._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("SI",($,q)=>this._setImages($,q)),this.actor.registerMessageHandler("UL",($,q)=>h._(this,void 0,void 0,function*(){this._getLayerIndex($).update(q.layers,q.removedIds)})),this.actor.registerMessageHandler("SL",($,q)=>h._(this,void 0,void 0,function*(){this._getLayerIndex($).replace(q)}))}_setImages(V,$){return h._(this,void 0,void 0,function*(){this.availableImages[V]=$;for(let q in this.workerSources[V]){let te=this.workerSources[V][q];for(let le in te)te[le].availableImages=$}})}_syncRTLPluginState(V,$){return h._(this,void 0,void 0,function*(){return yield h.cX.syncState($,this.self.importScripts)})}_getAvailableImages(V){let $=this.availableImages[V];return $||($=[]),$}_getLayerIndex(V){let $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new s),$}_getWorkerSource(V,$,q){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),!this.workerSources[V][$][q]){let te={sendAsync:(le,he)=>(le.targetMapId=V,this.actor.sendAsync(le,he))};switch($){case"vector":this.workerSources[V][$][q]=new N(te,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][$][q]=new To(te,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][$][q]=new this.externalWorkerSourceTypes[$](te,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][$][q]}_getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new B),this.demWorkerSources[V][$]}}return h.i(self)&&(self.worker=new Js(self)),Js}),i("index",["exports","./shared"],function(h,s){"use strict";var v="5.6.2";function w(){var m=new s.A(4);return s.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let I,N,B={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,l){let d=requestAnimationFrame(g=>{p(),e(g)}),{unsubscribe:p}=s.s(m.signal,"abort",()=>{p(),cancelAnimationFrame(d),l(s.c())},!1)},frameAsync(m){return new Promise((e,l)=>{this.frame(m,e,l)})},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){let e=window.document.createElement("canvas"),l=e.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,l.drawImage(m,0,0,m.width,m.height),l},resolveURL:m=>(I||(I=document.createElement("a")),I.href=m,I.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(N==null&&(N=matchMedia("(prefers-reduced-motion: reduce)")),N.matches)}};class L{static testProp(e){if(!L.docStyle)return e[0];for(let l=0;l<e.length;l++)if(e[l]in L.docStyle)return e[l];return e[0]}static create(e,l,d){let p=window.document.createElement(e);return l!==void 0&&(p.className=l),d&&d.appendChild(p),p}static createNS(e,l){return window.document.createElementNS(e,l)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(e,l){e.style[L.transformProp]=l}static addEventListener(e,l,d,p={}){e.addEventListener(l,d,"passive"in p?p:p.capture)}static removeEventListener(e,l,d,p={}){e.removeEventListener(l,d,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static getScale(e){let l=e.getBoundingClientRect();return{x:l.width/e.offsetWidth||1,y:l.height/e.offsetHeight||1,boundingClientRect:l}}static getPoint(e,l,d){let p=l.boundingClientRect;return new s.P((d.clientX-p.left)/l.x-e.clientLeft,(d.clientY-p.top)/l.y-e.clientTop)}static mousePos(e,l){let d=L.getScale(e);return L.getPoint(e,d,l)}static touchPos(e,l){let d=[],p=L.getScale(e);for(let g=0;g<l.length;g++)d.push(L.getPoint(e,p,l[g]));return d}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let l=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),d=l.querySelectorAll("script");for(let p of d)p.remove();return L.clean(l),l.innerHTML}static isPossiblyDangerous(e,l){let d=l.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!d.includes("javascript:")&&!d.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let l=e.children;for(let d of l)L.removeAttributes(d),L.clean(d)}static removeAttributes(e){for(let{name:l,value:d}of e.attributes)L.isPossiblyDangerous(l,d)&&e.removeAttribute(l)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);let ie={supported:!1,testSupport:function(m){!Ee&&me&&(Me?Ae(m):H=m)}},H,me,Ee=!1,Me=!1;function Ae(m){let e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,me),m.isContextLost())return;ie.supported=!0}catch{}m.deleteTexture(e),Ee=!0}var We;typeof document<"u"&&(me=document.createElement("img"),me.onload=()=>{H&&Ae(H),H=null,Me=!0},me.onerror=()=>{Ee=!0,H=null},me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,l,d,p;m.resetRequestQueue=()=>{e=[],l=0,d=0,p={}},m.addThrottleControl=E=>{let C=d++;return p[C]=E,C},m.removeThrottleControl=E=>{delete p[E],x()},m.getImage=(E,C,D=!0)=>new Promise((k,R)=>{ie.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),s.e(E,{type:"image"}),e.push({abortController:C,requestParameters:E,supportImageRefresh:D,state:"queued",onError:F=>{R(F)},onSuccess:F=>{k(F)}}),x()});let g=E=>s._(this,void 0,void 0,function*(){E.state="running";let{requestParameters:C,supportImageRefresh:D,onError:k,onSuccess:R,abortController:F}=E,U=D===!1&&!s.i(self)&&!s.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((Y,Q)=>Y&&Q==="accept",!0));l++;let X=U?S(C,F):s.m(C,F);try{let Y=yield X;delete E.abortController,E.state="completed",Y.data instanceof HTMLImageElement||s.b(Y.data)?R(Y):Y.data&&R({data:yield(W=Y.data,typeof createImageBitmap=="function"?s.f(W):s.h(W)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete E.abortController,k(Y)}finally{l--,x()}var W}),x=()=>{let E=(()=>{for(let C of Object.keys(p))if(p[C]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=l;C<E&&e.length>0;C++){let D=e.shift();D.abortController.signal.aborted?C--:g(D)}},S=(E,C)=>new Promise((D,k)=>{let R=new Image,F=E.url,U=E.credentials;U&&U==="include"?R.crossOrigin="use-credentials":(U&&U==="same-origin"||!s.d(F))&&(R.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{R.src="",k(s.c())}),R.fetchPriority="high",R.onload=()=>{R.onerror=R.onload=null,D({data:R})},R.onerror=()=>{R.onerror=R.onload=null,C.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},R.src=F})}(We||(We={})),We.resetRequestQueue();class it{constructor(e){this._transformRequestFn=e??null}transformRequest(e,l){return this._transformRequestFn&&this._transformRequestFn(e,l)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function _t(m){let e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){let l=[];for(let{id:d,url:p}of m){let g=`${d}${p}`;l.indexOf(g)===-1&&(l.push(g),e.push({id:d,url:p}))}}return e}function Ct(m,e,l){try{let d=new URL(m);return d.pathname+=`${e}${l}`,d.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Nt(m){let{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Gt extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:l,promiseResolve:d}of this.requestors)d(this._getImagesForIds(l));this.requestors=[]}}getImage(e){let l=this.images[e];if(l&&!l.data&&l.spriteData){let d=l.spriteData;l.data=new s.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),l.spriteData=null}return l}addImage(e,l){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,l)&&(this.images[e]=l)}_validate(e,l){let d=!0,p=l.data||l.spriteData;return this._validateStretch(l.stretchX,p&&p.width)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchX" value`))),d=!1),this._validateStretch(l.stretchY,p&&p.height)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchY" value`))),d=!1),this._validateContent(l.content,l)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "content" value`))),d=!1),d}_validateStretch(e,l){if(!e)return!0;let d=0;for(let p of e){if(p[0]<d||p[1]<p[0]||l<p[1])return!1;d=p[1]}return!0}_validateContent(e,l){if(!e)return!0;if(e.length!==4)return!1;let d=l.spriteData,p=d&&d.width||l.data.width,g=d&&d.height||l.data.height;return!(e[0]<0||p<e[0]||e[1]<0||g<e[1]||e[2]<0||p<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,l,d=!0){let p=this.getImage(e);if(d&&(p.data.width!==l.data.width||p.data.height!==l.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=p.version+1,this.images[e]=l,this.updatedImages[e]=!0}removeImage(e){let l=this.images[e];delete this.images[e],delete this.patterns[e],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((l,d)=>{let p=!0;if(!this.isLoaded())for(let g of e)this.images[g]||(p=!1);this.isLoaded()||p?l(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:l})})}_getImagesForIds(e){let l={};for(let d of e){let p=this.getImage(d);p||(this.fire(new s.l("styleimagemissing",{id:d})),p=this.getImage(d)),p?l[d]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:s.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return l}getPixelSize(){let{width:e,height:l}=this.atlasImage;return{width:e,height:l}}getPattern(e){let l=this.patterns[e],d=this.getImage(e);if(!d)return null;if(l&&l.position.version===d.version)return l.position;if(l)l.position.version=d.version;else{let p={w:d.data.width+2,h:d.data.height+2,x:0,y:0},g=new s.I(p,d);this.patterns[e]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let l=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(e,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let g in this.patterns)e.push(this.patterns[g].bin);let{w:l,h:d}=s.p(e),p=this.atlasImage;p.resize({width:l||1,height:d||1});for(let g in this.patterns){let{bin:x}=this.patterns[g],S=x.x+1,E=x.y+1,C=this.getImage(g).data,D=C.width,k=C.height;s.R.copy(C,p,{x:0,y:0},{x:S,y:E},{width:D,height:k}),s.R.copy(C,p,{x:0,y:k-1},{x:S,y:E-1},{width:D,height:1}),s.R.copy(C,p,{x:0,y:0},{x:S,y:E+k},{width:D,height:1}),s.R.copy(C,p,{x:D-1,y:0},{x:S-1,y:E},{width:1,height:k}),s.R.copy(C,p,{x:0,y:0},{x:S+D,y:E},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let l of e){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;let d=this.getImage(l);d||s.w(`Image with ID: "${l}" was not found`),Nt(d)&&this.updateImage(l,d)}}}let Xt=1e20;function tn(m,e,l,d,p,g,x,S,E){for(let C=e;C<e+d;C++)kn(m,l*g+C,g,p,x,S,E);for(let C=l;C<l+p;C++)kn(m,C*g+e,1,d,x,S,E)}function kn(m,e,l,d,p,g,x){g[0]=0,x[0]=-Xt,x[1]=Xt,p[0]=m[e];for(let S=1,E=0,C=0;S<d;S++){p[S]=m[e+S*l];let D=S*S;do{let k=g[E];C=(p[S]-p[k]+D-k*k)/(S-k)/2}while(C<=x[E]&&--E>-1);E++,g[E]=S,x[E]=C,x[E+1]=Xt}for(let S=0,E=0;S<d;S++){for(;x[E+1]<S;)E++;let C=g[E],D=S-C;m[e+S*l]=p[C]+D*D}}class xn{constructor(e,l){this.requestManager=e,this.localIdeographFontFamily=l,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return s._(this,void 0,void 0,function*(){let l=[];for(let g in e)for(let x of e[g])l.push(this._getAndCacheGlyphsPromise(g,x));let d=yield Promise.all(l),p={};for(let{stack:g,id:x,glyph:S}of d)p[g]||(p[g]={}),p[g][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return p})}_getAndCacheGlyphsPromise(e,l){return s._(this,void 0,void 0,function*(){let d=this.entries[e];d||(d=this.entries[e]={glyphs:{},requests:{},ranges:{}});let p=d.glyphs[l];if(p!==void 0)return{stack:e,id:l,glyph:p};if(p=this._tinySDF(d,e,l),p)return d.glyphs[l]=p,{stack:e,id:l,glyph:p};let g=Math.floor(l/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[g])return{stack:e,id:l,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[g]){let S=xn.loadGlyphRange(e,g,this.url,this.requestManager);d.requests[g]=S}let x=yield d.requests[g];for(let S in x)this._doesCharSupportLocalGlyph(+S)||(d.glyphs[+S]=x[+S]);return d.ranges[g]=!0,{stack:e,id:l,glyph:x[l]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||s.u["CJK Unified Ideographs"](e)||s.u["Hangul Syllables"](e)||s.u.Hiragana(e)||s.u.Katakana(e)||s.u["CJK Symbols and Punctuation"](e)||s.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,l,d){let p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let g=e.tinySDF;if(!g){let S="400";/bold/i.test(l)?S="900":/medium/i.test(l)?S="500":/light/i.test(l)&&(S="200"),g=e.tinySDF=new xn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:S})}let x=g.draw(String.fromCharCode(d));return{id:d,bitmap:new s.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}xn.loadGlyphRange=function(m,e,l,d){return s._(this,void 0,void 0,function*(){let p=256*e,g=p+255,x=d.transformRequest(l.replace("{fontstack}",m).replace("{range}",`${p}-${g}`),"Glyphs"),S=yield s.n(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${p}-${g}`);let E={};for(let C of s.o(S.data))E[C.id]=C;return E})},xn.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:l=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal",lang:S=null}={}){this.buffer=e,this.cutoff=d,this.radius=l,this.lang=S;let E=this.size=m+4*e,C=this._createCanvas(E),D=this.ctx=C.getContext("2d",{willReadFrequently:!0});D.font=`${x} ${g} ${m}px ${p}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(m){let e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){let{width:e,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(m),x=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),E=Math.min(this.size-this.buffer,x+Math.ceil(d)),C=S+2*this.buffer,D=E+2*this.buffer,k=Math.max(C*D,0),R=new Uint8ClampedArray(k),F={data:R,width:C,height:D,glyphWidth:S,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(S===0||E===0)return F;let{ctx:U,buffer:X,gridInner:W,gridOuter:Y}=this;this.lang&&(U.lang=this.lang),U.clearRect(X,X,S,E),U.fillText(m,X,X+x);let Q=U.getImageData(X,X,S,E);Y.fill(Xt,0,k),W.fill(0,0,k);for(let ne=0;ne<E;ne++)for(let J=0;J<S;J++){let oe=Q.data[4*(ne*S+J)+3]/255;if(oe===0)continue;let ae=(ne+X)*C+J+X;if(oe===1)Y[ae]=0,W[ae]=Xt;else{let ee=.5-oe;Y[ae]=ee>0?ee*ee:0,W[ae]=ee<0?ee*ee:0}}tn(Y,0,0,C,D,C,this.f,this.v,this.z),tn(W,X,X,S,E,C,this.f,this.v,this.z);for(let ne=0;ne<k;ne++){let J=Math.sqrt(Y[ne])-Math.sqrt(W[ne]);R[ne]=Math.round(255-255*(J/this.radius+this.cutoff))}return F}};class Wr{constructor(){this.specification=s.v.light.position}possiblyEvaluate(e,l){return s.B(e.expression.evaluate(l))}interpolate(e,l,d){return{x:s.C.number(e.x,l.x,d),y:s.C.number(e.y,l.y,d),z:s.C.number(e.z,l.z,d)}}}let Ir;class xo extends s.E{constructor(e){super(),Ir=Ir||new s.r({anchor:new s.D(s.v.light.anchor),position:new Wr,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.t(Ir),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,l={}){if(!this._validate(s.x,e,l))for(let d in e){let p=e[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),p):this._transitionable.setValue(d,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,l,d){return(!d||d.validate!==!1)&&s.y(this,e.call(s.z,{value:l,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}let Qo=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class tc extends s.E{constructor(e){super(),this._transitionable=new s.t(Qo),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0))}setSky(e,l={}){if(!this._validate(s.G,e,l)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let d in e){let p=e[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),p):this._transitionable.setValue(d,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,l,d={}){return d?.validate!==!1&&s.y(this,e.call(s.z,s.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ht{constructor(e,l){this.width=e,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,l){let d=e.join(",")+String(l);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(e,l)),this.dashEntry[d]}getDashRanges(e,l,d){let p=[],g=e.length%2==1?-e[e.length-1]*d:0,x=e[0]*d,S=!0;p.push({left:g,right:x,isDash:S,zeroLength:e[0]===0});let E=e[0];for(let C=1;C<e.length;C++){S=!S;let D=e[C];g=E*d,E+=D,x=E*d,p.push({left:g,right:x,isDash:S,zeroLength:D===0})}return p}addRoundDash(e,l,d){let p=l/2;for(let g=-d;g<=d;g++){let x=this.width*(this.nextRow+d+g),S=0,E=e[S];for(let C=0;C<this.width;C++){C/E.right>1&&(E=e[++S]);let D=Math.abs(C-E.left),k=Math.abs(C-E.right),R=Math.min(D,k),F,U=g/d*(p+1);if(E.isDash){let X=p-Math.abs(U);F=Math.sqrt(R*R+X*X)}else F=p-Math.sqrt(R*R+U*U);this.data[x+C]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){let E=e[S],C=e[S+1];E.zeroLength?e.splice(S,1):C&&C.isDash===E.isDash&&(C.left=E.left,e.splice(S,1))}let l=e[0],d=e[e.length-1];l.isDash===d.isDash&&(l.left=d.left-this.width,d.right=l.right+this.width);let p=this.width*this.nextRow,g=0,x=e[g];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++g]);let E=Math.abs(S-x.left),C=Math.abs(S-x.right),D=Math.min(E,C);this.data[p+S]=Math.max(0,Math.min(255,(x.isDash?D:-D)+128))}}addDash(e,l){let d=l?7:0,p=2*d+1;if(this.nextRow+p>this.height)return s.w("LineAtlas out of space"),null;let g=0;for(let S=0;S<e.length;S++)g+=e[S];if(g!==0){let S=this.width/g,E=this.getDashRanges(e,this.width,S);l?this.addRoundDash(E,S,d):this.addRegularDash(E)}let x={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:g};return this.nextRow+=p,this.dirty=!0,x}bind(e){let l=e.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}let Jo="maplibre_preloaded_worker_pool";class or{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<or.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Jo]}numActive(){return Object.keys(this.active).length}}let es=Math.floor(B.hardwareConcurrency/2),ki,bo;function ts(){return ki||(ki=new or),ki}or.workerCount=s.H(globalThis)?Math.max(Math.min(es,3),1):1;class Tr{constructor(e,l){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=l;let d=this.workerPool.acquire(l);for(let p=0;p<d.length;p++){let g=new s.J(d[p],l);g.name=`Worker ${p}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,l){let d=[];for(let p of this.actors)d.push(p.sendAsync({type:e,data:l}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,l){for(let d of this.actors)d.registerMessageHandler(e,l)}}function Xs(){return bo||(bo=new Tr(ts(),s.K),bo.registerMessageHandler("GR",(m,e,l)=>s.m(e,l))),bo}function Xr(m,e){let l=s.L();return s.M(l,l,[1,1,0]),s.N(l,l,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?s.O(l,l,m.calculatePosMatrix(e.toUnwrapped())):l}function ui(m,e,l,d,p,g,x){var S;let E=function(R,F,U){if(R)for(let X of R){let W=F[X];if(W&&W.source===U&&W.type==="fill-extrusion")return!0}else for(let X in F){let W=F[X];if(W.source===U&&W.type==="fill-extrusion")return!0}return!1}((S=p?.layers)!==null&&S!==void 0?S:null,e,m.id),C=g.maxPitchScaleFactor(),D=m.tilesIn(d,C,E);D.sort(Ys);let k=[];for(let R of D)k.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,l,m._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,p,g,C,Xr(m.transform,R.tileID),x?(F,U)=>x(R.tileID,F,U):void 0)});return function(R,F){for(let U in R)for(let X of R[U])Ks(X,F);return R}(function(R){let F={},U={};for(let X of R){let W=X.queryResults,Y=X.wrappedTileID,Q=U[Y]=U[Y]||{};for(let ne in W){let J=W[ne],oe=Q[ne]=Q[ne]||{},ae=F[ne]=F[ne]||[];for(let ee of J)oe[ee.featureIndex]||(oe[ee.featureIndex]=!0,ae.push(ee))}}return F}(k),m)}function Ys(m,e){let l=m.tileID,d=e.tileID;return l.overscaledZ-d.overscaledZ||l.canonical.y-d.canonical.y||l.wrap-d.wrap||l.canonical.x-d.canonical.x}function Ks(m,e){let l=m.feature,d=e.getFeatureState(l.layer["source-layer"],l.id);l.source=l.layer.source,l.layer["source-layer"]&&(l.sourceLayer=l.layer["source-layer"]),l.state=d}function Fr(m,e,l){return s._(this,void 0,void 0,function*(){let d=m;if(m.url?d=(yield s.j(e.transformRequest(m.url,"Source"),l)).data:yield B.frameAsync(l),!d)return null;let p=s.Q(s.e(d,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(p.vectorLayerIds=d.vector_layers.map(g=>g.id)),p})}class gn{constructor(e,l){e&&(l?this.setSouthWest(e).setNorthEast(l):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof s.S?new s.S(e.lng,e.lat):s.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof s.S?new s.S(e.lng,e.lat):s.S.convert(e),this}extend(e){let l=this._sw,d=this._ne,p,g;if(e instanceof s.S)p=e,g=e;else{if(!(e instanceof gn))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(gn.convert(e)):this.extend(s.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(s.S.convert(e)):this;if(p=e._sw,g=e._ne,!p||!g)return this}return l||d?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),d.lng=Math.max(g.lng,d.lng),d.lat=Math.max(g.lat,d.lat)):(this._sw=new s.S(p.lng,p.lat),this._ne=new s.S(g.lng,g.lat)),this}getCenter(){return new s.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.S(this.getWest(),this.getNorth())}getSouthEast(){return new s.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:l,lat:d}=s.S.convert(e),p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(e){return e instanceof gn?e:e&&new gn(e)}static fromLngLat(e,l=0){let d=360*l/40075017,p=d/Math.cos(Math.PI/180*e.lat);return new gn(new s.S(e.lng-p,e.lat-d),new s.S(e.lng+p,e.lat+d))}adjustAntiMeridian(){let e=new s.S(this._sw.lng,this._sw.lat),l=new s.S(this._ne.lng,this._ne.lat);return new gn(e,e.lng>l.lng?new s.S(l.lng+360,l.lat):l)}}class bn{constructor(e,l,d){this.bounds=gn.convert(this.validateBounds(e)),this.minzoom=l||0,this.maxzoom=d||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let l=Math.pow(2,e.z),d=Math.floor(s.V(this.bounds.getWest())*l),p=Math.floor(s.U(this.bounds.getNorth())*l),g=Math.ceil(s.V(this.bounds.getEast())*l),x=Math.ceil(s.U(this.bounds.getSouth())*l);return e.x>=d&&e.x<g&&e.y>=p&&e.y<x}}class hi extends s.E{constructor(e,l,d,p){if(super(),this.id=e,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.Q(l,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(s.e(this,e),e.bounds&&(this.tileBounds=new bn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new s.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(e){return s._(this,void 0,void 0,function*(){let l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(l,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};d.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((g,x)=>{e.reloadPromise={resolve:g,reject:x}})}else e.actor=this.dispatcher.getActor(),p="LT";e.abortController=new AbortController;try{let g=yield e.actor.sendAsync({type:p,data:d},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,l){if(l&&l.resourceTiming&&(e.resourceTiming=l.resourceTiming),l&&this.map._refreshExpiredTiles&&e.setExpiryData(l),e.loadVectorData(l,this.map.painter),e.reloadPromise){let d=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(d.resolve).catch(d.reject)}}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ni extends s.E{constructor(e,l,d,p){super(),this.id=e,this.dispatcher=d,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},l),s.e(this,s.Q(l,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let l=yield Fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(s.e(this,l),l.bounds&&(this.tileBounds=new bn(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(l){this._tileJSONRequest=null,this.fire(new s.k(l))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return s.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return s._(this,void 0,void 0,function*(){let l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let d=yield We.getImage(this.map._requestManager.transformRequest(l,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});let p=this.map.painter.context,g=p.gl,x=d.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new s.T(p,x,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class ns extends Ni{constructor(e,l,d,p){super(e,l,d,p),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(e){return s._(this,void 0,void 0,function*(){let l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(l,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let p=yield We.getImage(d,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){let g=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});let x=s.b(g)&&s.W()?g:yield this.readImageNow(g),S={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let E=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}})}readImageNow(e){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.X()){let l=e.width+2,d=e.height+2;try{return new s.R({width:l,height:d},yield s.Y(e,-1,-1,l,d))}catch{}}return B.getImageData(e,1)})}_getNeighboringTiles(e){let l=e.canonical,d=Math.pow(2,l.z),p=(l.x-1+d)%d,g=l.x===0?e.wrap-1:e.wrap,x=(l.x+1+d)%d,S=l.x+1===d?e.wrap+1:e.wrap,E={};return E[new s.Z(e.overscaledZ,g,l.z,p,l.y).key]={backfilled:!1},E[new s.Z(e.overscaledZ,S,l.z,x,l.y).key]={backfilled:!1},l.y>0&&(E[new s.Z(e.overscaledZ,g,l.z,p,l.y-1).key]={backfilled:!1},E[new s.Z(e.overscaledZ,e.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},E[new s.Z(e.overscaledZ,S,l.z,x,l.y-1).key]={backfilled:!1}),l.y+1<d&&(E[new s.Z(e.overscaledZ,g,l.z,p,l.y+1).key]={backfilled:!1},E[new s.Z(e.overscaledZ,e.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},E[new s.Z(e.overscaledZ,S,l.z,x,l.y+1).key]={backfilled:!1}),E}unloadTile(e){return s._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Li extends s.E{constructor(e,l,d,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:l.data},this.actor=d.getActor(),this.setEventedParent(p),this._data=l.data,this._options=s.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId,l.clusterMaxZoom!==void 0&&this.maxzoom<=l.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${l.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(l.buffer!==void 0?l.buffer:128),tolerance:this._pixelsToTileUnits(l.tolerance!==void 0?l.tolerance:.375),extent:s.$,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(l.clusterMaxZoom),minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.$,radius:this._pixelsToTileUnits(l.clusterRadius||50),log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(s.$/this.tileSize)}_getClusterMaxZoom(e){let l=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${l}"`),l}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=s.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return s._(this,void 0,void 0,function*(){let e=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(l=>l.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,function*(){let e=new gn,l=yield this.getData(),d;switch(l.type){case"FeatureCollection":d=l.features.map(p=>this.getCoordinatesFromGeometry(p.geometry)).flat(1/0);break;case"Feature":d=this.getCoordinatesFromGeometry(l.geometry);break;default:d=this.getCoordinatesFromGeometry(l)}if(d.length==0)return e;for(let p=0;p<d.length-1;p+=2)e.extend([d[p],d[p+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,l,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:l,offset:d}})}_updateWorkerData(){return s._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;let{data:e,diff:l}=this._pendingWorkerUpdate;if(!e&&!l)return void s.w(`No data or diff provided to GeoJSONSource ${this.id}.`);let d=s.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(d.request=this.map._requestManager.transformRequest(B.resolveURL(e),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):l&&(d.dataDiff=l,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{let p=yield this.actor.sendAsync({type:"LD",data:d});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));this._data=p.data;let g=null;p.resourceTiming&&p.resourceTiming[this.id]&&(g=p.resourceTiming[this.id].slice(0));let x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&s.e(x,{resourceTiming:g}),this.fire(new s.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(p))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return s._(this,void 0,void 0,function*(){let l=e.actor?"RT":"LT";e.actor=this.actor;let d={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;let p=yield this.actor.sendAsync({type:l,data:d},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(p,this.map.painter,l==="RT")})}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Oi extends s.E{constructor(e,l,d,p){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=d,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=l}load(e){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let l=yield We.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,l&&l.data&&(this.image=l.data,e&&(this.coordinates=e),this._finishLoading())}catch(l){this._request=null,this._loaded=!0,this.fire(new s.k(l))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let l=e.map(s.a1.fromLngLat);var d;return this.tileID=function(p){let g=s.a2.fromPoints(p),x=g.width(),S=g.height(),E=Math.max(x,S),C=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),D=Math.pow(2,C);return new s.a4(C,Math.floor((g.minX+g.maxX)/2*D),Math.floor((g.minY+g.maxY)/2*D))}(l),this.terrainTileRanges=this._getOverlappingTileRanges(l),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=l.map(p=>this.tileID.getTilePoint(p)._round()),this.flippedWindingOrder=((d=this.tileCoords)[1].x-d[0].x)*(d[2].y-d[0].y)-(d[1].y-d[0].y)*(d[2].x-d[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,l=e.gl;this.texture||(this.texture=new s.T(e,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let d=!1;for(let p in this.tiles){let g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,d=!0)}d&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let{minX:l,minY:d,maxX:p,maxY:g}=s.a2.fromPoints(e),x={};for(let S=0;S<=s.a3;S++){let E=Math.pow(2,S),C=Math.floor(l*E),D=Math.floor(d*E),k=Math.floor(p*E),R=Math.floor(g*E);x[S]={minTileX:C,minTileY:D,maxTileX:k,maxTileY:R}}return x}}class Qs extends Oi{constructor(e,l,d,p){super(e,l,d,p),this.roundZoom=!0,this.type="video",this.options=l}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let l of e.urls)this.urls.push(this.map._requestManager.transformRequest(l,"Source").url);try{let l=yield s.a5(this.urls);if(this._loaded=!0,!l)return;this.video=l,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(l){this.fire(new s.k(l))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let l=this.video.seekable;e<l.start(0)||e>l.end(0)?this.fire(new s.k(new s.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,l=e.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(e,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let d=!1;for(let p in this.tiles){let g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,d=!0)}d&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wo extends Oi{constructor(e,l,d,p){super(e,l,d,p),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new s.k(new s.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a6(`sources.${e}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.k(new s.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let l=this.map.painter.context,d=l.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(l,this.canvas,d.RGBA,{premultiply:!0});let p=!1;for(let g in this.tiles){let x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let Mo={},So=m=>{switch(m){case"geojson":return Li;case"image":return Oi;case"raster":return Ni;case"raster-dem":return ns;case"vector":return hi;case"video":return Qs;case"canvas":return wo}return Mo[m]},rs="RTLPluginLoaded";class Eo extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Xs()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(l=>{throw this.status="error",l})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return s._(this,arguments,void 0,function*(l,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=B.resolveURL(l),!this.url)throw new Error(`requested url ${l} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(rs))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Io=null;function To(){return Io||(Io=new Eo),Io}class Js{constructor(e,l){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=s.a7(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let l=e+this.timeAdded;l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,l,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,g){let x={};if(!g)return x;for(let S of p){let E=S.layerIds.map(C=>g.getLayer(C)).filter(Boolean);if(E.length!==0){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(C=>E.filter(D=>D.id===C)[0]));for(let C of E)x[C.id]=S}}return x}(e.buckets,l?.style),this.hasSymbolBuckets=!1;for(let p in this.buckets){let g=this.buckets[p];if(g instanceof s.a9){if(this.hasSymbolBuckets=!0,!d)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let p in this.buckets){let g=this.buckets[p];if(g instanceof s.a9&&g.hasRTLText){this.hasRTLText=!0,To().lazyLoad();break}}this.queryPadding=0;for(let p in this.buckets){let g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new s.a8}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let d in this.buckets){let p=this.buckets[d];p.uploadPending()&&p.upload(e)}let l=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(e,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(e,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,l,d,p,g,x,S,E,C,D,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:D,transform:E,params:S,queryPadding:this.queryPadding*C,getElevation:k},e,l,d):{}}querySourceFeatures(e,l){let d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;let p=d.loadVTLayers(),g=l&&l.sourceLayer?l.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;let S=s.aa(l&&l.filter),{z:E,x:C,y:D}=this.tileID.canonical,k={z:E,x:C,y:D};for(let R=0;R<x.length;R++){let F=x.feature(R);if(S.needGeometry){let W=s.ab(F,!0);if(!S.filter(new s.F(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!S.filter(new s.F(this.tileID.overscaledZ),F))continue;let U=d.getId(F,g),X=new s.ac(F,E,C,D,U);X.tile=k,e.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let l=this.expirationTime;if(e.cacheControl){let d=s.ad(e.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let d=Date.now(),p=!1;if(this.expirationTime>d)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{let g=this.expirationTime-l;g?this.expirationTime=d+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let d=this.latestFeatureIndex.loadVTLayers();for(let p in this.buckets){if(!l.style.hasLayer(p))continue;let g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",S=d[x],E=e[x];if(!S||!E||Object.keys(E).length===0)continue;g.update(E,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});let C=l&&l.style&&l.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=B.now()+e}setDependencies(e,l){let d={};for(let p of l)d[p]=!0;this.dependencies[e]=d}hasDependency(e,l){for(let d of e){let p=this.dependencies[d];if(p){for(let g of l)if(p[g])return!0}}return!1}}class ue{constructor(e,l){this.max=e,this.onRemove=l,this.reset()}reset(){for(let e in this.data)for(let l of this.data[e])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(e,l,d){let p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);let g={value:l,timeout:void 0};if(d!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},d)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let l=this.data[e].shift();return l.timeout&&clearTimeout(l.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),l.value}getByKey(e){let l=this.data[e];return l?l[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,l){if(!this.has(e))return this;let d=e.wrapped().key,p=l===void 0?0:this.data[d].indexOf(l),g=this.data[d][p];return this.data[d].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(g.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(e){let l=[];for(let d in this.data)for(let p of this.data[d])e(p.value)||l.push(p);for(let d of l)this.remove(d.value.tileID,d)}}class V{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,l,d){let p=String(l);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},s.e(this.stateChanges[e][p],d),this.deletedStates[e]===null){this.deletedStates[e]={};for(let g in this.state[e])g!==p&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(let g in this.state[e][p])d[g]||(this.deletedStates[e][p][g]=null)}else for(let g in d)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][g]===null&&delete this.deletedStates[e][p][g]}removeFeatureState(e,l,d){if(this.deletedStates[e]===null)return;let p=String(l);if(this.deletedStates[e]=this.deletedStates[e]||{},d&&l!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][d]=null);else if(l!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(d in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][d]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,l){let d=String(l),p=s.e({},(this.state[e]||{})[d],(this.stateChanges[e]||{})[d]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let g=this.deletedStates[e][l];if(g===null)return{};for(let x in g)delete p[x]}return p}initializeTileState(e,l){e.setFeatureState(this.state,l)}coalesceChanges(e,l){let d={};for(let p in this.stateChanges){this.state[p]=this.state[p]||{};let g={};for(let x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),s.e(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];d[p]=g}for(let p in this.deletedStates){this.state[p]=this.state[p]||{};let g={};if(this.deletedStates[p]===null)for(let x in this.state[p])g[x]={},this.state[p][x]={};else for(let x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(let S of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][S];g[x]=this.state[p][x]}d[p]=d[p]||{},s.e(d[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(let p in e)e[p].setFeatureState(d,l)}}let $=89.25;function q(m,e){let l=s.ah(e.lat,-s.ai,s.ai);return new s.P(s.V(e.lng)*m,s.U(l)*m)}function te(m,e){return new s.a1(e.x/m,e.y/m).toLngLat()}function le(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(s.ae(90-m.pitch)),Math.tan(s.ae($-m.pitch)))}function he(m,e){let l=m.canonical,d=e/s.af(l.z),p=l.x+Math.pow(2,l.z)*m.wrap,g=s.ag(new Float64Array(16));return s.M(g,g,[p*d,l.y*d,0]),s.N(g,g,[d/s.$,d/s.$,1]),g}function ve(m,e,l,d,p){let g=s.a1.fromLngLat(m,e),x=p*s.aj(1,m.lat),S=x*Math.cos(s.ae(l)),E=Math.sqrt(x*x-S*S),C=E*Math.sin(s.ae(-d)),D=E*Math.cos(s.ae(-d));return new s.a1(g.x+C,g.y+D,g.z+S)}function fe(m,e,l){let d=e.intersectsFrustum(m);if(!l||d===0)return d;let p=e.intersectsPlane(l);return p===0?0:d===2&&p===2?2:1}function Se(m,e,l){let d=0,p=(l-e)/10;for(let g=0;g<10;g++)d+=p*Math.pow(Math.cos(e+(g+.5)/10*(l-e)),m);return d}function Re(m,e){return function(l,d,p,g,x){let S=2*((m-1)/s.ak(Math.cos(s.ae($-x))/Math.cos(s.ae($)))-1),E=Math.acos(p/g),C=2*Se(S-1,0,s.ae(x/2)),D=Math.min(s.ae($),E+s.ae(x/2)),k=Se(S-1,Math.min(D,E-s.ae(x/2)),D),R=Math.atan(d/p),F=Math.hypot(d,p),U=l;return U+=s.ak(g/F/Math.max(.5,Math.cos(s.ae(x/2)))),U+=S*s.ak(Math.cos(R))/2,U-=s.ak(Math.max(1,k/C/e))/2,U}}let Te=Re(9.314,3);function Xe(m,e){let l=(e.roundZoom?Math.round:Math.floor)(m.zoom+s.ak(m.tileSize/e.tileSize));return Math.max(0,l)}function pe(m,e){let l=m.getCameraFrustum(),d=m.getClippingPlane(),p=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=s.a1.fromLngLat(m.center,m.elevation);p.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;let x=m.getCoveringTilesDetailsProvider(),S=x.allowVariableZoom(m,e),E=Xe(m,e),C=e.minzoom||0,D=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,k=Math.min(Math.max(0,E),D),R=Math.pow(2,k),F=[R*p.x,R*p.y,0],U=[R*g.x,R*g.y,0],X=Math.hypot(g.x-p.x,g.y-p.y),W=Math.abs(g.z-p.z),Y=Math.hypot(X,W),Q=oe=>({zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),ne=[],J=[];if(m.renderWorldCopies&&x.allowWorldCopies())for(let oe=1;oe<=3;oe++)ne.push(Q(-oe)),ne.push(Q(oe));for(ne.push(Q(0));ne.length>0;){let oe=ne.pop(),ae=oe.x,ee=oe.y,de=oe.fullyVisible,be={x:ae,y:ee,z:oe.zoom},ge=x.getTileBoundingVolume(be,oe.wrap,m.elevation,e);if(!de){let Oe=fe(l,ge,d);if(Oe===0)continue;de=Oe===2}let _e=x.distanceToTile2d(p.x,p.y,be,ge),xe=E;S&&(xe=(e.calculateTileZoom||Te)(m.zoom+s.ak(m.tileSize/e.tileSize),_e,W,Y,m.fov)),xe=(e.roundZoom?Math.round:Math.floor)(xe),xe=Math.max(0,xe);let ke=Math.min(xe,D);if(oe.wrap=x.getWrap(g,be,oe.wrap),oe.zoom>=ke){if(oe.zoom<C)continue;let Oe=k-oe.zoom,Ce=F[0]-.5-(ae<<Oe),qe=F[1]-.5-(ee<<Oe),ft=e.reparseOverscaled?Math.max(oe.zoom,xe):oe.zoom;J.push({tileID:new s.Z(oe.zoom===D?ft:oe.zoom,oe.wrap,oe.zoom,ae,ee),distanceSq:s.al([U[0]-.5-ae,U[1]-.5-ee]),tileDistanceToCamera:Math.sqrt(Ce*Ce+qe*qe)})}else for(let Oe=0;Oe<4;Oe++)ne.push({zoom:oe.zoom+1,x:(ae<<1)+Oe%2,y:(ee<<1)+(Oe>>1),wrap:oe.wrap,fullyVisible:de})}return J.sort((oe,ae)=>oe.distanceSq-ae.distanceSq).map(oe=>oe.tileID)}let st=s.a2.fromPoints([new s.P(0,0),new s.P(s.$,s.$)]);class yt extends s.E{constructor(e,l,d){super(),this.id=e,this.dispatcher=d,this.on("data",p=>this._dataHandler(p)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,g,x,S)=>{let E=new(So(g.type))(p,g,x,S);if(E.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${E.id}`);return E})(e,l,d,this),this._tiles={},this._cache=new ue(0,p=>this._unloadTile(p)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new V,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let l=this._tiles[e];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,l,d){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,l,d)}catch(p){e.state="errored",p.status!==404?this._source.fire(new s.k(p,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new s.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let l in this._tiles){let d=this._tiles[l];d.upload(e),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Qe).map(e=>e.key)}getRenderableIds(e){let l=[];for(let d in this._tiles)this._isIdRenderable(d,e)&&l.push(this._tiles[d]);return e?l.sort((d,p)=>{let g=d.tileID,x=p.tileID,S=new s.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),E=new s.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-x.overscaledZ||E.y-S.y||E.x-S.x}).map(d=>d.tileID.key):l.map(d=>d.tileID).sort(Qe).map(d=>d.key)}hasRenderableParent(e){let l=this.findLoadedParent(e,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(e,l){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(l||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let l in this._tiles)e?this._reloadTile(l,"expired"):this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(e,l){return s._(this,void 0,void 0,function*(){let d=this._tiles[e];d&&(d.state!=="loading"&&(d.state=l),yield this._loadTile(d,e,l))})}_tileLoaded(e,l,d){e.timeAdded=B.now(),d==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(l,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let l=this.getRenderableIds();for(let p=0;p<l.length;p++){let g=l[p];if(e.neighboringTiles&&e.neighboringTiles[g]){let x=this.getTileByID(g);d(e,x),d(x,e)}}function d(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x,S=g.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),C=g.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,S),p.neighboringTiles&&p.neighboringTiles[C]&&(p.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,l,d,p){for(let g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=l||x.tileID.overscaledZ>d)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>l+1;){let C=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[C.key],x&&x.hasData()&&(S=C)}let E=S;for(;E.overscaledZ>l;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]||e[E.canonical.key]){p[S.key]=S;break}}}findLoadedParent(e,l){if(e.key in this._loadedParentTiles){let d=this._loadedParentTiles[e.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=e.overscaledZ-1;d>=l;d--){let p=e.scaledTo(d),g=this._getLoadedTile(p);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let l=this._tiles[e.key];return l&&l.hasData()?l:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let l=Math.ceil(e.width/this._source.tileSize)+1,d=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(l*d*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(e){let l=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,l){let d={};for(let p in this._tiles){let g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+l),d[g.tileID.key]=g}this._tiles=d;for(let p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(let p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}_updateCoveredAndRetainedTiles(e,l,d,p,g,x){let S={},E={},C=Object.keys(e),D=B.now();for(let k of C){let R=e[k],F=this._tiles[k];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=D)continue;let U=this.findLoadedParent(R,l),X=this.findLoadedSibling(R),W=U||X||null;W&&(this._addTile(W.tileID),S[W.tileID.key]=W.tileID),E[k]=R}this._retainLoadedChildren(E,p,d,e);for(let k in S)e[k]||(this._coveredTiles[k]=!0,e[k]=S[k]);if(x){let k={},R={};for(let F of g)this._tiles[F.key].hasData()?k[F.key]=F:R[F.key]=F;for(let F in R){let U=R[F].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(k[U[0].key]=e[U[0].key]=U[0],k[U[1].key]=e[U[1].key]=U[1],k[U[2].key]=e[U[2].key]=U[2],k[U[3].key]=e[U[3].key]=U[3],delete R[F])}for(let F in R){let U=R[F],X=this.findLoadedParent(U,this._source.minzoom),W=this.findLoadedSibling(U),Y=X||W||null;if(Y){k[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(let Q in k)k[Q].isChildOf(Y.tileID)&&delete k[Q]}}for(let F in this._tiles)k[F]||(this._coveredTiles[F]=!0)}}update(e,l){if(!this._sourceLoaded||this._paused)return;let d;this.transform=e,this.terrain=l,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new s.Z(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(d=pe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(d=d.filter(D=>this._source.hasTile(D)))):d=[];let p=Xe(e,this._source),g=Math.max(p-yt.maxOverzooming,this._source.minzoom),x=Math.max(p+yt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let D={};for(let k of d)if(k.canonical.z>this._source.minzoom){let R=k.scaledTo(k.canonical.z-1);D[R.key]=R;let F=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));D[F.key]=F}d=d.concat(Object.values(D))}let S=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let E=this._updateRetainedTiles(d,p);ut(this._source.type)&&this._updateCoveredAndRetainedTiles(E,g,x,p,d,l);for(let D in E)this._tiles[D].clearFadeHold();let C=s.am(this._tiles,E);for(let D of C){let k=this._tiles[D];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,l){var d;let p={},g={},x=Math.max(l-yt.maxOverzooming,this._source.minzoom),S=Math.max(l+yt.maxUnderzooming,this._source.minzoom),E={};for(let C of e){let D=this._addTile(C);p[C.key]=C,D.hasData()||l<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,l,S,p);for(let C of e){let D=this._tiles[C.key];if(D.hasData())continue;if(l+1>this._source.maxzoom){let R=C.children(this._source.maxzoom)[0],F=this.getTile(R);if(F&&F.hasData()){p[R.key]=R;continue}}else{let R=C.children(this._source.maxzoom);if(p[R[0].key]&&p[R[1].key]&&p[R[2].key]&&p[R[3].key])continue}let k=D.wasRequested();for(let R=C.overscaledZ-1;R>=x;--R){let F=C.scaledTo(R);if(g[F.key])break;if(g[F.key]=!0,D=this.getTile(F),!D&&k&&(D=this._addTile(F)),D){let U=D.hasData();if((U||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||k)&&(p[F.key]=F),k=D.wasRequested(),U)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let l=[],d,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){d=this._loadedParentTiles[p.key];break}l.push(p.key);let g=p.scaledTo(p.overscaledZ-1);if(d=this._getLoadedTile(g),d)break;p=g}for(let g of l)this._loadedParentTiles[g]=d}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let l=this._tiles[e].tileID,d=this._getLoadedTile(l);this._loadedSiblingTiles[l.key]=d}}_addTile(e){let l=this._tiles[e.key];if(l)return l;l=this._cache.getAndRemove(e),l&&(this._setTileReloadTimer(e.key,l),l.tileID=e,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,l)));let d=l;return l||(l=new Js(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(l,e.key,l.state)),l.uses++,this._tiles[e.key]=l,d||this._source.fire(new s.l("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(e,l){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let d=l.getExpiryTimeout();d&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},d))}refreshTiles(e){for(let l in this._tiles)(this._isIdRenderable(l)||this._tiles[l].state=="errored")&&e.some(d=>d.equals(this._tiles[l].tileID.canonical))&&this._reloadTile(l,"expired")}_removeTile(e){let l=this._tiles[e];l&&(l.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}_dataHandler(e){let l=e.sourceDataType;e.dataType==="source"&&l==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&l==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,l,d){let p=[],g=this.transform;if(!g)return p;let x=g.getCoveringTilesDetailsProvider().allowWorldCopies(),S=d?g.getCameraQueryGeometry(e):e,E=F=>g.screenPointToMercatorCoordinate(F,this.terrain),C=this.transformBbox(e,E,!x),D=this.transformBbox(S,E,!x),k=this.getIds(),R=s.a2.fromPoints(D);for(let F=0;F<k.length;F++){let U=this._tiles[k[F]];if(U.holdingForFade())continue;let X=x?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],W=Math.pow(2,g.zoom-U.tileID.overscaledZ),Y=l*U.queryPadding*s.$/U.tileSize/W;for(let Q of X){let ne=R.map(J=>Q.getTilePoint(new s.a1(J.x,J.y)));if(ne.expandBy(Y),ne.intersects(st)){let J=C.map(ae=>Q.getTilePoint(ae)),oe=D.map(ae=>Q.getTilePoint(ae));p.push({tile:U,tileID:x?Q:Q.unwrapTo(0),queryGeometry:J,cameraQueryGeometry:oe,scale:W})}}}return p}transformBbox(e,l,d){let p=e.map(l);if(d){let g=s.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));let x=g.map(l);s.a2.fromPoints(p).covers(x)||(p=p.map(S=>S.x>.5?new s.a1(S.x-1,S.y,S.z):S))}return p}getVisibleCoordinates(e){let l=this.getRenderableIds(e).map(d=>this._tiles[d].tileID);return this.transform&&this.transform.populateCache(l),l}hasTransition(){if(this._source.hasTransition())return!0;if(ut(this._source.type)){let e=B.now();for(let l in this._tiles)if(this._tiles[l].fadeEndTime>=e)return!0}return!1}setFeatureState(e,l,d){this._state.updateState(e=e||"_geojsonTileLayer",l,d)}removeFeatureState(e,l,d){this._state.removeFeatureState(e=e||"_geojsonTileLayer",l,d)}getFeatureState(e,l){return this._state.getState(e=e||"_geojsonTileLayer",l)}setDependencies(e,l,d){let p=this._tiles[e];p&&p.setDependencies(l,d)}reloadTilesForDependencies(e,l){for(let d in this._tiles)this._tiles[d].hasDependency(e,l)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(e,l))}}function Qe(m,e){let l=Math.abs(2*m.wrap)-+(m.wrap<0),d=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||d-l||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function ut(m){return m==="raster"||m==="image"||m==="video"}yt.maxOverzooming=10,yt.maxUnderzooming=3;class nn{constructor(e,l){this.reset(e,l)}reset(e,l){this.points=e||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=s.ah(e,0,1);let l=1,d=this._distances[l],p=e*this.paddedLength+this.padding;for(;d<p&&l<this._distances.length;)d=this._distances[++l];let g=l-1,x=this._distances[g],S=d-x,E=S>0?(p-x)/S:0;return this.points[g].mult(1-E).add(this.points[l].mult(E))}}function Nn(m,e){let l=!0;return m==="always"||m!=="never"&&e!=="never"||(l=!1),l}class Ln{constructor(e,l,d){let p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/d),this.yCellCount=Math.ceil(l/d);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=l,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,l,d,p,g){this._forEachCell(l,d,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(e,l,d,p){this._forEachCell(l-p,d-p,l+p,d+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(l),this.circles.push(d),this.circles.push(p)}_insertBoxCell(e,l,d,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(e,l,d,p,g,x){this.circleCells[g].push(x)}_query(e,l,d,p,g,x,S){if(d<0||e>this.width||p<0||l>this.height)return[];let E=[];if(e<=0&&l<=0&&this.width<=d&&this.height<=p){if(g)return[{key:null,x1:e,y1:l,x2:d,y2:p}];for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){let D=this.circles[3*C],k=this.circles[3*C+1],R=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:D-R,y1:k-R,x2:D+R,y2:k+R})}}else this._forEachCell(e,l,d,p,this._queryCell,E,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},S);return E}query(e,l,d,p){return this._query(e,l,d,p,!1,null)}hitTest(e,l,d,p,g,x){return this._query(e,l,d,p,!0,g,x).length>0}hitTestCircle(e,l,d,p,g){let x=e-d,S=e+d,E=l-d,C=l+d;if(S<0||x>this.width||C<0||E>this.height)return!1;let D=[];return this._forEachCell(x,E,S,C,this._queryCellCircle,D,{hitTest:!0,overlapMode:p,circle:{x:e,y:l,radius:d},seenUids:{box:{},circle:{}}},g),D.length>0}_queryCell(e,l,d,p,g,x,S,E){let{seenUids:C,hitTest:D,overlapMode:k}=S,R=this.boxCells[g];if(R!==null){let U=this.bboxes;for(let X of R)if(!C.box[X]){C.box[X]=!0;let W=4*X,Y=this.boxKeys[X];if(e<=U[W+2]&&l<=U[W+3]&&d>=U[W+0]&&p>=U[W+1]&&(!E||E(Y))&&(!D||!Nn(k,Y.overlapMode))&&(x.push({key:Y,x1:U[W],y1:U[W+1],x2:U[W+2],y2:U[W+3]}),D))return!0}}let F=this.circleCells[g];if(F!==null){let U=this.circles;for(let X of F)if(!C.circle[X]){C.circle[X]=!0;let W=3*X,Y=this.circleKeys[X];if(this._circleAndRectCollide(U[W],U[W+1],U[W+2],e,l,d,p)&&(!E||E(Y))&&(!D||!Nn(k,Y.overlapMode))){let Q=U[W],ne=U[W+1],J=U[W+2];if(x.push({key:Y,x1:Q-J,y1:ne-J,x2:Q+J,y2:ne+J}),D)return!0}}}return!1}_queryCellCircle(e,l,d,p,g,x,S,E){let{circle:C,seenUids:D,overlapMode:k}=S,R=this.boxCells[g];if(R!==null){let U=this.bboxes;for(let X of R)if(!D.box[X]){D.box[X]=!0;let W=4*X,Y=this.boxKeys[X];if(this._circleAndRectCollide(C.x,C.y,C.radius,U[W+0],U[W+1],U[W+2],U[W+3])&&(!E||E(Y))&&!Nn(k,Y.overlapMode))return x.push(!0),!0}}let F=this.circleCells[g];if(F!==null){let U=this.circles;for(let X of F)if(!D.circle[X]){D.circle[X]=!0;let W=3*X,Y=this.circleKeys[X];if(this._circlesCollide(U[W],U[W+1],U[W+2],C.x,C.y,C.radius)&&(!E||E(Y))&&!Nn(k,Y.overlapMode))return x.push(!0),!0}}}_forEachCell(e,l,d,p,g,x,S,E){let C=this._convertToXCellCoord(e),D=this._convertToYCellCoord(l),k=this._convertToXCellCoord(d),R=this._convertToYCellCoord(p);for(let F=C;F<=k;F++)for(let U=D;U<=R;U++)if(g.call(this,e,l,d,p,this.xCellCount*U+F,x,S,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,l,d,p,g,x){let S=p-e,E=g-l,C=d+x;return C*C>S*S+E*E}_circleAndRectCollide(e,l,d,p,g,x,S){let E=(x-p)/2,C=Math.abs(e-(p+E));if(C>E+d)return!1;let D=(S-g)/2,k=Math.abs(l-(g+D));if(k>D+d)return!1;if(C<=E||k<=D)return!0;let R=C-E,F=k-D;return R*R+F*F<=d*d}}function wn(m,e,l){let d=s.L();if(!m){let{vecSouth:k,vecEast:R}=Rt(e),F=w();F[0]=R[0],F[1]=R[1],F[2]=k[0],F[3]=k[1],p=F,(D=(x=(g=F)[0])*(C=g[3])-(E=g[2])*(S=g[1]))&&(p[0]=C*(D=1/D),p[1]=-S*D,p[2]=-E*D,p[3]=x*D),d[0]=F[0],d[1]=F[1],d[4]=F[2],d[5]=F[3]}var p,g,x,S,E,C,D;return s.N(d,d,[1/l,1/l,1]),d}function St(m,e,l,d){if(m){let p=s.L();if(!e){let{vecSouth:g,vecEast:x}=Rt(l);p[0]=x[0],p[1]=x[1],p[4]=g[0],p[5]=g[1]}return s.N(p,p,[d,d,1]),p}return l.pixelsToClipSpaceMatrix}function Rt(m){let e=Math.cos(m.rollInRadians),l=Math.sin(m.rollInRadians),d=Math.cos(m.pitchInRadians),p=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),x=s.ar();x[0]=-p*d*l-g*e,x[1]=-g*d*l+p*e;let S=s.as(x);S<1e-9?s.at(x):s.au(x,x,1/S);let E=s.ar();E[0]=p*d*e-g*l,E[1]=g*d*e+p*l;let C=s.as(E);return C<1e-9?s.at(E):s.au(E,E,1/C),{vecEast:E,vecSouth:x}}function In(m,e,l,d){let p;d?(p=[m,e,d(m,e),1],s.aw(p,p,l)):(p=[m,e,0,1],ta(p,p,l));let g=p[3];return{point:new s.P(p[0]/g,p[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Ne(m,e){return .5+m/e*.5}function sr(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function hn(m,e,l,d,p,g,x,S,E,C,D,k,R){let F=l?m.textSizeData:m.iconSizeData,U=s.an(F,e.transform.zoom),X=[256/e.width*2+1,256/e.height*2+1],W=l?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;W.clear();let Y=m.lineVertexArray,Q=l?m.text.placedSymbolArray:m.icon.placedSymbolArray,ne=e.transform.width/e.transform.height,J=!1;for(let oe=0;oe<Q.length;oe++){let ae=Q.get(oe);if(ae.hidden||ae.writingMode===s.ao.vertical&&!J){Fi(ae.numGlyphs,W);continue}J=!1;let ee=new s.P(ae.anchorX,ae.anchorY),de={getElevation:R,pitchedLabelPlaneMatrix:d,lineVertexArray:Y,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ee,unwrappedTileID:E,width:C,height:D,translation:k},be=Po(ae.anchorX,ae.anchorY,de);if(!sr(be.point,X)){Fi(ae.numGlyphs,W);continue}let ge=Ne(e.transform.cameraToCenterDistance,be.signedDistanceFromCamera),_e=s.ap(F,U,ae),xe=g?_e*e.transform.getPitchedTextCorrection(ae.anchorX,ae.anchorY,E)/ge:_e*ge,ke=Ge({projectionContext:de,pitchedLabelPlaneMatrixInverse:p,symbol:ae,fontSize:xe,flip:!1,keepUpright:x,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:S});J=ke.useVertical,(ke.notEnoughRoom||J||ke.needsFlipping&&Ge({projectionContext:de,pitchedLabelPlaneMatrixInverse:p,symbol:ae,fontSize:xe,flip:!0,keepUpright:x,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:S}).notEnoughRoom)&&Fi(ae.numGlyphs,W)}l?m.text.dynamicLayoutVertexBuffer.updateData(W):m.icon.dynamicLayoutVertexBuffer.updateData(W)}function Co(m,e,l,d,p,g,x,S){let E=g.glyphStartIndex+g.numGlyphs,C=g.lineStartIndex,D=g.lineStartIndex+g.lineLength,k=e.getoffsetX(g.glyphStartIndex),R=e.getoffsetX(E-1),F=Do(m*k,l,d,p,g.segment,C,D,S,x);if(!F)return null;let U=Do(m*R,l,d,p,g.segment,C,D,S,x);return U?S.projectionCache.anyProjectionOccluded?null:{first:F,last:U}:null}function ea(m,e,l,d){return m===s.ao.horizontal&&Math.abs(l.y-e.y)>Math.abs(l.x-e.x)*d?{useVertical:!0}:(m===s.ao.vertical?e.y<l.y:e.x>l.x)?{needsFlipping:!0}:null}function Ge(m){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:l,symbol:d,fontSize:p,flip:g,keepUpright:x,glyphOffsetArray:S,dynamicLayoutVertexArray:E,aspectRatio:C,rotateToLine:D}=m,k=p/24,R=d.lineOffsetX*k,F=d.lineOffsetY*k,U;if(d.numGlyphs>1){let X=d.glyphStartIndex+d.numGlyphs,W=d.lineStartIndex,Y=d.lineStartIndex+d.lineLength,Q=Co(k,S,R,F,g,d,D,e);if(!Q)return{notEnoughRoom:!0};let ne=is(Q.first.point.x,Q.first.point.y,e,l),J=is(Q.last.point.x,Q.last.point.y,e,l);if(x&&!g){let oe=ea(d.writingMode,ne,J,C);if(oe)return oe}U=[Q.first];for(let oe=d.glyphStartIndex+1;oe<X-1;oe++){let ae=Do(k*S.getoffsetX(oe),R,F,g,d.segment,W,Y,e,D);if(!ae)return{notEnoughRoom:!0};U.push(ae)}U.push(Q.last)}else{if(x&&!g){let W=Kn(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Y=d.lineStartIndex+d.segment+1,Q=new s.P(e.lineVertexArray.getx(Y),e.lineVertexArray.gety(Y)),ne=Kn(Q.x,Q.y,e),J=ne.signedDistanceFromCamera>0?ne.point:vt(e.tileAnchorPoint,Q,W,1,e),oe=is(W.x,W.y,e,l),ae=is(J.x,J.y,e,l),ee=ea(d.writingMode,oe,ae,C);if(ee)return ee}let X=Do(k*S.getoffsetX(d.glyphStartIndex),R,F,g,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,e,D);if(!X||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[X]}for(let X of U)s.av(E,X.point,X.angle);return{}}function vt(m,e,l,d,p){let g=m.add(m.sub(e)._unit()),x=Kn(g.x,g.y,p).point,S=l.sub(x);return l.add(S._mult(d/S.mag()))}function mt(m,e,l){let d=e.projectionCache;if(d.projections[m])return d.projections[m];let p=new s.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=Kn(p.x,p.y,e);if(g.signedDistanceFromCamera>0)return d.projections[m]=g.point,d.anyProjectionOccluded=d.anyProjectionOccluded||g.isOccluded,g.point;let x=m-l.direction;return vt(l.distanceFromAnchor===0?e.tileAnchorPoint:new s.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),p,l.previousVertex,l.absOffsetX-l.distanceFromAnchor+1,e)}function Kn(m,e,l){let d=m+l.translation[0],p=e+l.translation[1],g;return l.pitchWithMap?(g=In(d,p,l.pitchedLabelPlaneMatrix,l.getElevation),g.isOccluded=!1):(g=l.transform.projectTileCoordinates(d,p,l.unwrappedTileID,l.getElevation),g.point.x=(.5*g.point.x+.5)*l.width,g.point.y=(.5*-g.point.y+.5)*l.height),g}function is(m,e,l,d){if(l.pitchWithMap){let p=[m,e,0,1];return s.aw(p,p,d),l.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],l.unwrappedTileID,l.getElevation).point}return{x:m/l.width*2-1,y:1-e/l.height*2}}function Po(m,e,l){return l.transform.projectTileCoordinates(m,e,l.unwrappedTileID,l.getElevation)}function dt(m,e,l){return m._unit()._perp()._mult(e*l)}function nc(m,e,l,d,p,g,x,S,E){if(S.projectionCache.offsets[m])return S.projectionCache.offsets[m];let C=l.add(e);if(m+E.direction<d||m+E.direction>=p)return S.projectionCache.offsets[m]=C,C;let D=mt(m+E.direction,S,E),k=dt(D.sub(l),x,E.direction),R=l.add(k),F=D.add(k);return S.projectionCache.offsets[m]=s.ax(g,C,R,F)||C,S.projectionCache.offsets[m]}function Do(m,e,l,d,p,g,x,S,E){let C=d?m-e:m+e,D=C>0?1:-1,k=0;d&&(D*=-1,k=Math.PI),D<0&&(k+=Math.PI);let R,F=D>0?g+p:g+p+1;S.projectionCache.cachedAnchorPoint?R=S.projectionCache.cachedAnchorPoint:(R=Kn(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=R);let U,X,W=R,Y=R,Q=0,ne=0,J=Math.abs(C),oe=[],ae;for(;Q+ne<=J;){if(F+=D,F<g||F>=x)return null;Q+=ne,Y=W,X=U;let be={absOffsetX:J,direction:D,distanceFromAnchor:Q,previousVertex:Y};if(W=mt(F,S,be),l===0)oe.push(Y),ae=W.sub(Y);else{let ge,_e=W.sub(Y);ge=_e.mag()===0?dt(mt(F+D,S,be).sub(W),l,D):dt(_e,l,D),X||(X=Y.add(ge)),U=nc(F,ge,W,g,x,X,l,S,be),oe.push(X),ae=U.sub(X)}ne=ae.mag()}let ee=ae._mult((J-Q)/ne)._add(X||Y),de=k+Math.atan2(W.y-Y.y,W.x-Y.x);return oe.push(ee),{point:ee,angle:E?de:0,path:oe}}let rc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fi(m,e){for(let l=0;l<m;l++){let d=e.length;e.resize(d+4),e.float32.set(rc,3*d)}}function ta(m,e,l){let d=e[0],p=e[1];return m[0]=l[0]*d+l[4]*p+l[12],m[1]=l[1]*d+l[5]*p+l[13],m[3]=l[3]*d+l[7]*p+l[15],m}let _n=100;class ic{constructor(e,l=new Ln(e.width+200,e.height+200,25),d=new Ln(e.width+200,e.height+200,25)){this.transform=e,this.grid=l,this.ignoredGrid=d,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+_n,this.screenBottomBoundary=e.height+_n,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,l,d,p,g,x,S,E,C,D,k,R){let F=this.projectAndGetPerspectiveRatio(e.anchorPointX+E[0],e.anchorPointY+E[1],g,D,R),U=d*F.perspectiveRatio,X;if(x||S)X=this._projectCollisionBox(e,U,p,g,x,S,E,F,D,k,R);else{let ae=F.x+(k?k.x*U:0),ee=F.y+(k?k.y*U:0);X={allPointsOccluded:!1,box:[ae+e.x1*U,ee+e.y1*U,ae+e.x2*U,ee+e.y2*U]}}let[W,Y,Q,ne]=X.box,J=x?X.allPointsOccluded:F.isOccluded,oe=J;return oe||(oe=F.perspectiveRatio<this.perspectiveRatioCutoff),oe||(oe=!this.isInsideGrid(W,Y,Q,ne)),oe||l!=="always"&&this.grid.hitTest(W,Y,Q,ne,l,C)?{box:[W,Y,Q,ne],placeable:!1,offscreen:!1,occluded:J}:{box:[W,Y,Q,ne],placeable:!0,offscreen:this.isOffscreen(W,Y,Q,ne),occluded:J}}placeCollisionCircles(e,l,d,p,g,x,S,E,C,D,k,R,F,U){let X=[],W=new s.P(l.anchorX,l.anchorY),Y=this.getPerspectiveRatio(W.x,W.y,x,U),Q=(C?g*this.transform.getPitchedTextCorrection(l.anchorX,l.anchorY,x)/Y:g*Y)/s.aB,ne={getElevation:U,pitchedLabelPlaneMatrix:S,lineVertexArray:d,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:F},J=Co(Q,p,l.lineOffsetX*Q,l.lineOffsetY*Q,!1,l,!1,ne),oe=!1,ae=!1,ee=!0;if(J){let de=.5*k*Y+R,be=new s.P(-100,-100),ge=new s.P(this.screenRightBoundary,this.screenBottomBoundary),_e=new nn,xe=J.first,ke=J.last,Oe=[];for(let ft=xe.path.length-1;ft>=1;ft--)Oe.push(xe.path[ft]);for(let ft=1;ft<ke.path.length;ft++)Oe.push(ke.path[ft]);let Ce=2.5*de;if(C){let ft=this.projectPathToScreenSpace(Oe,ne);Oe=ft.some(Ot=>Ot.signedDistanceFromCamera<=0)?[]:ft.map(Ot=>Ot.point)}let qe=[];if(Oe.length>0){let ft=Oe[0].clone(),Ot=Oe[0].clone();for(let Zt=1;Zt<Oe.length;Zt++)ft.x=Math.min(ft.x,Oe[Zt].x),ft.y=Math.min(ft.y,Oe[Zt].y),Ot.x=Math.max(Ot.x,Oe[Zt].x),Ot.y=Math.max(Ot.y,Oe[Zt].y);qe=ft.x>=be.x&&Ot.x<=ge.x&&ft.y>=be.y&&Ot.y<=ge.y?[Oe]:Ot.x<be.x||ft.x>ge.x||Ot.y<be.y||ft.y>ge.y?[]:s.ay([Oe],be.x,be.y,ge.x,ge.y)}for(let ft of qe){_e.reset(ft,.25*de);let Ot=0;Ot=_e.length<=.5*de?1:Math.ceil(_e.paddedLength/Ce)+1;for(let Zt=0;Zt<Ot;Zt++){let $t=Zt/Math.max(Ot-1,1),ln=_e.lerp($t),fn=ln.x+_n,ht=ln.y+_n;X.push(fn,ht,de,0);let Wt=fn-de,Cn=ht-de,On=fn+de,Vn=ht+de;if(ee=ee&&this.isOffscreen(Wt,Cn,On,Vn),ae=ae||this.isInsideGrid(Wt,Cn,On,Vn),e!=="always"&&this.grid.hitTestCircle(fn,ht,de,e,D)&&(oe=!0,!E))return{circles:[],offscreen:!1,collisionDetected:oe}}}}return{circles:!E&&oe||!ae||Y<this.perspectiveRatioCutoff?[]:X,offscreen:ee,collisionDetected:oe}}projectPathToScreenSpace(e,l){let d=function(p,g){let x=s.L();return s.aq(x,g.pitchedLabelPlaneMatrix),p.map(S=>{let E=In(S.x,S.y,x,g.getElevation),C=g.transform.projectTileCoordinates(E.point.x,E.point.y,g.unwrappedTileID,g.getElevation);return C.point.x=(.5*C.point.x+.5)*g.width,C.point.y=(.5*-C.point.y+.5)*g.height,C})}(e,l);return function(p){let g=0,x=0,S=0,E=0;for(let C=0;C<p.length;C++)p[C].isOccluded?(S=C+1,E=0):(E++,E>x&&(x=E,g=S));return p.slice(g,g+x)}(d)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let l=[],d=new s.a2;for(let k of e){let R=new s.P(k.x+_n,k.y+_n);d.extend(R),l.push(R)}let{minX:p,minY:g,maxX:x,maxY:S}=d,E=this.grid.query(p,g,x,S).concat(this.ignoredGrid.query(p,g,x,S)),C={},D={};for(let k of E){let R=k.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;let F=[new s.P(k.x1,k.y1),new s.P(k.x2,k.y1),new s.P(k.x2,k.y2),new s.P(k.x1,k.y2)];s.az(l,F)&&(C[R.bucketInstanceId][R.featureIndex]=!0,D[R.bucketInstanceId]===void 0&&(D[R.bucketInstanceId]=[]),D[R.bucketInstanceId].push(R.featureIndex))}return D}insertCollisionBox(e,l,d,p,g,x){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:l},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,l,d,p,g,x){let S=d?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:l};for(let C=0;C<e.length;C+=4)S.insertCircle(E,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,l,d,p,g){if(g){let x;p?(x=[e,l,p(e,l),1],s.aw(x,x,g)):(x=[e,l,0,1],ta(x,x,g));let S=x[3];return{x:(x[0]/S+1)/2*this.transform.width+_n,y:(-x[1]/S+1)/2*this.transform.height+_n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{let x=this.transform.projectTileCoordinates(e,l,d,p);return{x:(x.point.x+1)/2*this.transform.width+_n,y:(1-x.point.y)/2*this.transform.height+_n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(e,l,d,p){let g=this.transform.projectTileCoordinates(e,l,d,p);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,l,d,p){return d<_n||e>=this.screenRightBoundary||p<_n||l>this.screenBottomBoundary}isInsideGrid(e,l,d,p){return d>=0&&e<this.gridRightBoundary&&p>=0&&l<this.gridBottomBoundary}getViewportMatrix(){let e=s.ag([]);return s.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,l,d,p,g,x,S,E,C,D,k){let R=1,F=0,U=0,X=1,W=e.anchorPointX+S[0],Y=e.anchorPointY+S[1];if(x&&!g){let Oe=this.projectAndGetPerspectiveRatio(W+1,Y,p,C,k),Ce=Oe.x-E.x,qe=Math.atan((Oe.y-E.y)/Ce)+(Ce<0?Math.PI:0),ft=Math.sin(qe),Ot=Math.cos(qe);R=Ot,F=ft,U=-ft,X=Ot}else if(!x&&g){let Oe=Rt(this.transform);R=Oe.vecEast[0],F=Oe.vecEast[1],U=Oe.vecSouth[0],X=Oe.vecSouth[1]}let Q=E.x,ne=E.y,J=l;g&&(Q=W,ne=Y,J=Math.pow(2,-(this.transform.zoom-d.overscaledZ)),J*=this.transform.getPitchedTextCorrection(W,Y,p),D||(J*=s.ah(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(Q+=R*D.x*J+U*D.y*J,ne+=F*D.x*J+X*D.y*J);let oe=e.x1*J,ae=e.x2*J,ee=(oe+ae)/2,de=e.y1*J,be=e.y2*J,ge=(de+be)/2,_e=[{offsetX:oe,offsetY:de},{offsetX:ee,offsetY:de},{offsetX:ae,offsetY:de},{offsetX:ae,offsetY:ge},{offsetX:ae,offsetY:be},{offsetX:ee,offsetY:be},{offsetX:oe,offsetY:be},{offsetX:oe,offsetY:ge}],xe=[];for(let{offsetX:Oe,offsetY:Ce}of _e)xe.push(new s.P(Q+R*Oe+U*Ce,ne+F*Oe+X*Ce));let ke=!1;if(g){let Oe=xe.map(Ce=>this.projectAndGetPerspectiveRatio(Ce.x,Ce.y,p,C,k));ke=Oe.some(Ce=>!Ce.isOccluded),xe=Oe.map(Ce=>new s.P(Ce.x,Ce.y))}else ke=!0;return{box:s.aA(xe),allPointsOccluded:!ke}}}class Cr{constructor(e,l,d,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?l:-l))):p&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Yt{constructor(e,l,d,p,g){this.text=new Cr(e?e.text:null,l,d,g),this.icon=new Cr(e?e.icon:null,l,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lf{constructor(e,l,d){this.text=e,this.icon=l,this.skipFade=d}}class qa{constructor(e,l,d,p,g){this.bucketInstanceId=e,this.featureIndex=l,this.sourceLayerIndex=d,this.bucketIndex=p,this.tileID=g}}class ih{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let l=++this.maxGroupID;this.collisionGroups[e]={ID:l,predicate:d=>d.collisionGroupID===l}}return this.collisionGroups[e]}}function Ao(m,e,l,d,p){let{horizontalAlign:g,verticalAlign:x}=s.aH(m);return new s.P(-(g-.5)*e+d[0]*p,-(x-.5)*l+d[1]*p)}class Ro{constructor(e,l,d,p,g){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new ic(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new ih(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let l=this.terrain;return l?(d,p)=>l.getElevation(e,d,p):null}getBucketParts(e,l,d,p){let g=d.getBucket(l),x=d.latestFeatureIndex;if(!g||!x||l.id!==g.layerIds[0])return;let S=d.collisionBoxArray,E=g.layers[0].layout,C=g.layers[0].paint,D=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),k=d.tileSize/s.$,R=d.tileID.toUnwrapped(),F=E.get("text-rotation-alignment")==="map",U=s.aC(d,1,this.transform.zoom),X=s.aD(this.collisionIndex.transform,d,C.get("text-translate"),C.get("text-translate-anchor")),W=s.aD(this.collisionIndex.transform,d,C.get("icon-translate"),C.get("icon-translate-anchor")),Y=wn(F,this.transform,U);this.retainedQueryData[g.bucketInstanceId]=new qa(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,d.tileID);let Q={bucket:g,layout:E,translationText:X,translationIcon:W,unwrappedTileID:R,pitchedLabelPlaneMatrix:Y,scale:D,textPixelRatio:k,holdingForFade:d.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:s.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(let ne of g.sortKeyRanges){let{sortKey:J,symbolInstanceStart:oe,symbolInstanceEnd:ae}=ne;e.push({sortKey:J,symbolInstanceStart:oe,symbolInstanceEnd:ae,parameters:Q})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(e,l,d,p,g,x,S,E,C,D,k,R,F,U,X,W,Y,Q,ne,J){let oe=s.aE[e.textAnchor],ae=[e.textOffset0,e.textOffset1],ee=Ao(oe,d,p,ae,g),de=this.collisionIndex.placeCollisionBox(l,R,E,C,D,S,x,W,k.predicate,ne,ee,J);if((!Q||this.collisionIndex.placeCollisionBox(Q,R,E,C,D,S,x,Y,k.predicate,ne,ee,J).placeable)&&de.placeable){let be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(be=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:ae,width:d,height:p,anchor:oe,textBoxScale:g,prevAnchor:be},this.markUsedJustification(U,oe,F,X),U.allowVerticalPlacement&&(this.markUsedOrientation(U,X,F),this.placedOrientations[F.crossTileID]=X),{shift:ee,placedGlyphBoxes:de}}}placeLayerBucketPart(e,l,d){let{bucket:p,layout:g,translationText:x,translationIcon:S,unwrappedTileID:E,pitchedLabelPlaneMatrix:C,textPixelRatio:D,holdingForFade:k,collisionBoxArray:R,partiallyEvaluatedTextSize:F,collisionGroup:U}=e.parameters,X=g.get("text-optional"),W=g.get("icon-optional"),Y=s.aF(g,"text-overlap","text-allow-overlap"),Q=Y==="always",ne=s.aF(g,"icon-overlap","icon-allow-overlap"),J=ne==="always",oe=g.get("text-rotation-alignment")==="map",ae=g.get("text-pitch-alignment")==="map",ee=g.get("icon-text-fit")!=="none",de=g.get("symbol-z-order")==="viewport-y",be=Q&&(J||!p.hasIconData()||W),ge=J&&(Q||!p.hasTextData()||X);!p.collisionArrays&&R&&p.deserializeCollisionBoxes(R);let _e=this.retainedQueryData[p.bucketInstanceId].tileID,xe=this._getTerrainElevationFunc(_e),ke=this.transform.getFastPathSimpleProjectionMatrix(_e),Oe=(Ce,qe,ft)=>{var Ot,Zt;if(l[Ce.crossTileID])return;if(k)return void(this.placements[Ce.crossTileID]=new Lf(!1,!1,!1));let $t=!1,ln=!1,fn=!0,ht=null,Wt={box:null,placeable:!1,offscreen:null,occluded:!1},Cn={placeable:!1},On=null,Vn=null,xr=null,xi=0,Fo=0,zo=0;qe.textFeatureIndex?xi=qe.textFeatureIndex:Ce.useRuntimeCollisionCircles&&(xi=Ce.featureIndex),qe.verticalTextFeatureIndex&&(Fo=qe.verticalTextFeatureIndex);let wa=qe.textBox;if(wa){let Ar=Pn=>{let Fn=s.ao.horizontal;if(p.allowVerticalPlacement&&!Pn&&this.prevPlacement){let Jr=this.prevPlacement.placedOrientations[Ce.crossTileID];Jr&&(this.placedOrientations[Ce.crossTileID]=Jr,Fn=Jr,this.markUsedOrientation(p,Fn,Ce))}return Fn},bi=(Pn,Fn)=>{if(p.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&qe.verticalTextBox){for(let Jr of p.writingModes)if(Jr===s.ao.vertical?(Wt=Fn(),Cn=Wt):Wt=Pn(),Wt&&Wt.placeable)break}else Wt=Pn()},br=Ce.textAnchorOffsetStartIndex,jo=Ce.textAnchorOffsetEndIndex;if(jo===br){let Pn=(Fn,Jr)=>{let Dn=this.collisionIndex.placeCollisionBox(Fn,Y,D,_e,E,ae,oe,x,U.predicate,xe,void 0,ke);return Dn&&Dn.placeable&&(this.markUsedOrientation(p,Jr,Ce),this.placedOrientations[Ce.crossTileID]=Jr),Dn};bi(()=>Pn(wa,s.ao.horizontal),()=>{let Fn=qe.verticalTextBox;return p.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&Fn?Pn(Fn,s.ao.vertical):{box:null,offscreen:null}}),Ar(Wt&&Wt.placeable)}else{let Pn=s.aE[(Zt=(Ot=this.prevPlacement)===null||Ot===void 0?void 0:Ot.variableOffsets[Ce.crossTileID])===null||Zt===void 0?void 0:Zt.anchor],Fn=(Dn,vl,Sa)=>{let no=Dn.x2-Dn.x1,wi=Dn.y2-Dn.y1,Bo=Ce.textBoxScale,Tp=ee&&ne==="never"?vl:null,Br=null,Cp=Y==="never"?1:2,Kh="never";Pn&&Cp++;for(let Bc=0;Bc<Cp;Bc++){for(let Uc=br;Uc<jo;Uc++){let Uo=p.textAnchorOffsets.get(Uc);if(Pn&&Uo.textAnchor!==Pn)continue;let ro=this.attemptAnchorPlacement(Uo,Dn,no,wi,Bo,oe,ae,D,_e,E,U,Kh,Ce,p,Sa,x,S,Tp,xe);if(ro&&(Br=ro.placedGlyphBoxes,Br&&Br.placeable))return $t=!0,ht=ro.shift,Br}Pn?Pn=null:Kh=Y}return d&&!Br&&(Br={box:this.collisionIndex.placeCollisionBox(wa,"always",D,_e,E,ae,oe,x,U.predicate,xe,void 0,ke).box,offscreen:!1,placeable:!1,occluded:!1}),Br};bi(()=>Fn(wa,qe.iconBox,s.ao.horizontal),()=>{let Dn=qe.verticalTextBox;return p.allowVerticalPlacement&&(!Wt||!Wt.placeable)&&Ce.numVerticalGlyphVertices>0&&Dn?Fn(Dn,qe.verticalIconBox,s.ao.vertical):{box:null,occluded:!0,offscreen:null}}),Wt&&($t=Wt.placeable,fn=Wt.offscreen);let Jr=Ar(Wt&&Wt.placeable);if(!$t&&this.prevPlacement){let Dn=this.prevPlacement.variableOffsets[Ce.crossTileID];Dn&&(this.variableOffsets[Ce.crossTileID]=Dn,this.markUsedJustification(p,Dn.anchor,Ce,Jr))}}}if(On=Wt,$t=On&&On.placeable,fn=On&&On.offscreen,Ce.useRuntimeCollisionCircles){let Ar=p.text.placedSymbolArray.get(Ce.centerJustifiedTextSymbolIndex),bi=s.ap(p.textSizeData,F,Ar),br=g.get("text-padding");Vn=this.collisionIndex.placeCollisionCircles(Y,Ar,p.lineVertexArray,p.glyphOffsetArray,bi,E,C,d,ae,U.predicate,Ce.collisionCircleDiameter,br,x,xe),Vn.circles.length&&Vn.collisionDetected&&!d&&s.w("Collisions detected, but collision boxes are not shown"),$t=Q||Vn.circles.length>0&&!Vn.collisionDetected,fn=fn&&Vn.offscreen}if(qe.iconFeatureIndex&&(zo=qe.iconFeatureIndex),qe.iconBox){let Ar=bi=>this.collisionIndex.placeCollisionBox(bi,ne,D,_e,E,ae,oe,S,U.predicate,xe,ee&&ht?ht:void 0,ke);Cn&&Cn.placeable&&qe.verticalIconBox?(xr=Ar(qe.verticalIconBox),ln=xr.placeable):(xr=Ar(qe.iconBox),ln=xr.placeable),fn=fn&&xr.offscreen}let Ma=X||Ce.numHorizontalGlyphVertices===0&&Ce.numVerticalGlyphVertices===0,ws=W||Ce.numIconVertices===0;Ma||ws?ws?Ma||(ln=ln&&$t):$t=ln&&$t:ln=$t=ln&&$t;let Ms=ln&&xr.placeable;if($t&&On.placeable&&this.collisionIndex.insertCollisionBox(On.box,Y,g.get("text-ignore-placement"),p.bucketInstanceId,Cn&&Cn.placeable&&Fo?Fo:xi,U.ID),Ms&&this.collisionIndex.insertCollisionBox(xr.box,ne,g.get("icon-ignore-placement"),p.bucketInstanceId,zo,U.ID),Vn&&$t&&this.collisionIndex.insertCollisionCircles(Vn.circles,Y,g.get("text-ignore-placement"),p.bucketInstanceId,xi,U.ID),d&&this.storeCollisionData(p.bucketInstanceId,ft,qe,On,xr,Vn),Ce.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ce.crossTileID]=new Lf(($t||be)&&!On?.occluded,(ln||ge)&&!xr?.occluded,fn||p.justReloaded),l[Ce.crossTileID]=!0};if(de){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ce=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let qe=Ce.length-1;qe>=0;--qe){let ft=Ce[qe];Oe(p.symbolInstances.get(ft),p.collisionArrays[ft],ft)}}else for(let Ce=e.symbolInstanceStart;Ce<e.symbolInstanceEnd;Ce++)Oe(p.symbolInstances.get(Ce),p.collisionArrays[Ce],Ce);p.justReloaded=!1}storeCollisionData(e,l,d,p,g,x){if(d.textBox||d.iconBox){let S,E;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(l)?E=S.get(l):(E={text:null,icon:null},S.set(l,E)),d.textBox&&(E.text=p.box),d.iconBox&&(E.icon=g.box)}if(x){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let E=0;E<x.circles.length;E+=4)S.push(x.circles[E+0]-_n),S.push(x.circles[E+1]-_n),S.push(x.circles[E+2]),S.push(x.collisionDetected?1:0)}}markUsedJustification(e,l,d,p){let g;g=p===s.ao.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[s.aG(l)];let x=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(let S of x)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:d.crossTileID)}markUsedOrientation(e,l,d){let p=l===s.ao.horizontal||l===s.ao.horizontalOnly?l:0,g=l===s.ao.vertical?l:0,x=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(let S of x)e.text.placedSymbolArray.get(S).placedOrientation=p;d.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let l=this.prevPlacement,d=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;let p=l?l.symbolFadeChange(e):1,g=l?l.opacities:{},x=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(let E in this.placements){let C=this.placements[E],D=g[E];D?(this.opacities[E]=new Yt(D,p,C.text,C.icon),d=d||C.text!==D.text.placed||C.icon!==D.icon.placed):(this.opacities[E]=new Yt(null,p,C.text,C.icon,C.skipFade),d=d||C.text||C.icon)}for(let E in g){let C=g[E];if(!this.opacities[E]){let D=new Yt(C,p,!1,!1);D.isHidden()||(this.opacities[E]=D,d=d||C.text.placed||C.icon.placed)}}for(let E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(let E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:e)}updateLayerOpacities(e,l){let d={};for(let p of l){let g=p.getBucket(e);g&&p.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,p.tileID,d,p.collisionBoxArray)}}updateBucketOpacities(e,l,d,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let g=e.layers[0],x=g.layout,S=new Yt(null,0,!1,!1,!0),E=x.get("text-allow-overlap"),C=x.get("icon-allow-overlap"),D=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=x.get("text-rotation-alignment")==="map",R=x.get("text-pitch-alignment")==="map",F=x.get("icon-text-fit")!=="none",U=new Yt(null,0,E&&(C||!e.hasIconData()||x.get("icon-optional")),C&&(E||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);let X=(Y,Q,ne)=>{for(let J=0;J<Q/4;J++)Y.opacityVertexArray.emplaceBack(ne);Y.hasVisibleVertices=Y.hasVisibleVertices||ne!==ra},W=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){let Q=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:J,crossTileID:oe}=Q,ae=this.opacities[oe];d[oe]?ae=S:ae||(ae=U,this.opacities[oe]=ae),d[oe]=!0;let ee=Q.numIconVertices>0,de=this.placedOrientations[Q.crossTileID],be=de===s.ao.vertical,ge=de===s.ao.horizontal||de===s.ao.horizontalOnly;if(ne>0||J>0){let xe=sh(ae.text);X(e.text,ne,be?ra:xe),X(e.text,J,ge?ra:xe);let ke=ae.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(qe=>{qe>=0&&(e.text.placedSymbolArray.get(qe).hidden=ke||be?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=ke||ge?1:0);let Oe=this.variableOffsets[Q.crossTileID];Oe&&this.markUsedJustification(e,Oe.anchor,Q,de);let Ce=this.placedOrientations[Q.crossTileID];Ce&&(this.markUsedJustification(e,"left",Q,Ce),this.markUsedOrientation(e,Ce,Q))}if(ee){let xe=sh(ae.icon),ke=!(F&&Q.verticalPlacedIconSymbolIndex&&be);Q.placedIconSymbolIndex>=0&&(X(e.icon,Q.numIconVertices,ke?xe:ra),e.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=ae.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(X(e.icon,Q.numVerticalIconVertices,ke?ra:xe),e.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}let _e=W&&W.has(Y)?W.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let xe=e.collisionArrays[Y];if(xe){let ke=new s.P(0,0);if(xe.textBox||xe.verticalTextBox){let Oe=!0;if(D){let Ce=this.variableOffsets[oe];Ce?(ke=Ao(Ce.anchor,Ce.width,Ce.height,Ce.textOffset,Ce.textBoxScale),k&&ke._rotate(R?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Oe=!1}if(xe.textBox||xe.verticalTextBox){let Ce;xe.textBox&&(Ce=be),xe.verticalTextBox&&(Ce=ge),oh(e.textCollisionBox.collisionVertexArray,ae.text.placed,!Oe||Ce,_e.text,ke.x,ke.y)}}if(xe.iconBox||xe.verticalIconBox){let Oe=!!(!ge&&xe.verticalIconBox),Ce;xe.iconBox&&(Ce=Oe),xe.verticalIconBox&&(Ce=!Oe),oh(e.iconCollisionBox.collisionVertexArray,ae.icon.placed,Ce,_e.icon,F?ke.x:0,F?ke.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,l){let d=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*d>e}setStale(){this.stale=!0}}function oh(m,e,l,d,p,g){d&&d.length!==0||(d=[0,0,0,0]);let x=d[0]-_n,S=d[1]-_n,E=d[2]-_n,C=d[3]-_n;m.emplaceBack(e?1:0,l?1:0,p||0,g||0,x,S),m.emplaceBack(e?1:0,l?1:0,p||0,g||0,E,S),m.emplaceBack(e?1:0,l?1:0,p||0,g||0,E,C),m.emplaceBack(e?1:0,l?1:0,p||0,g||0,x,C)}let Of=Math.pow(2,25),Ff=Math.pow(2,24),na=Math.pow(2,17),zf=Math.pow(2,16),c_=Math.pow(2,9),u_=Math.pow(2,8),h_=Math.pow(2,1);function sh(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let e=m.placed?1:0,l=Math.floor(127*m.opacity);return l*Of+e*Ff+l*na+e*zf+l*c_+e*u_+l*h_+e}let ra=0;class ah{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,l,d,p,g){let x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(l.getBucketParts(x,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,E)=>S.sortKey-E.sortKey));this._currentPartIndex<x.length;)if(l.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,g())return!0;return!1}}class lh{constructor(e,l,d,p,g,x,S,E){this.placement=new Ro(e,l,x,S,E),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,l,d){let p=B.now(),g=()=>!this._forceFullPlacement&&B.now()-p>2;for(;this._currentPlacementIndex>=0;){let x=l[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ah(x)),this._inProgressLayer.continuePlacement(d[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let ia=512/s.$/2;class ch{constructor(e,l,d){this.tileID=e,this.bucketInstanceId=d,this._symbolsByKey={};let p=new Map;for(let g=0;g<l.length;g++){let x=l.get(g),S=x.key,E=p.get(S);E?E.push(x):p.set(S,[x])}for(let[g,x]of p){let S={positions:x.map(E=>({x:Math.floor(E.anchorX*ia),y:Math.floor(E.anchorY*ia)})),crossTileIDs:x.map(E=>E.crossTileID)};if(S.positions.length>128){let E=new s.aI(S.positions.length,16,Uint16Array);for(let{x:C,y:D}of S.positions)E.add(C,D);E.finish(),delete S.positions,S.index=E}this._symbolsByKey[g]=S}}getScaledCoordinates(e,l){let{x:d,y:p,z:g}=this.tileID.canonical,{x,y:S,z:E}=l.canonical,C=ia/Math.pow(2,E-g),D=(S*s.$+e.anchorY)*C,k=p*s.$*ia;return{x:Math.floor((x*s.$+e.anchorX)*C-d*s.$*ia),y:Math.floor(D-k)}}findMatches(e,l,d){let p=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let g=0;g<e.length;g++){let x=e.get(g);if(x.crossTileID)continue;let S=this._symbolsByKey[x.key];if(!S)continue;let E=this.getScaledCoordinates(x,l);if(S.index){let C=S.index.range(E.x-p,E.y-p,E.x+p,E.y+p).sort();for(let D of C){let k=S.crossTileIDs[D];if(!d[k]){d[k]=!0,x.crossTileID=k;break}}}else if(S.positions)for(let C=0;C<S.positions.length;C++){let D=S.positions[C],k=S.crossTileIDs[C];if(Math.abs(D.x-E.x)<=p&&Math.abs(D.y-E.y)<=p&&!d[k]){d[k]=!0,x.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class uh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class d_{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let l=Math.round((e-this.lng)/360);if(l!==0)for(let d in this.indexes){let p=this.indexes[d],g={};for(let x in p){let S=p[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),g[S.tileID.key]=S}this.indexes[d]=g}this.lng=e}addBucket(e,l,d){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<l.symbolInstances.length;g++)l.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let p=this.usedCrossTileIDs[e.overscaledZ];for(let g in this.indexes){let x=this.indexes[g];if(Number(g)>e.overscaledZ)for(let S in x){let E=x[S];E.tileID.isChildOf(e)&&E.findMatches(l.symbolInstances,e,p)}else{let S=x[e.scaledTo(Number(g)).key];S&&S.findMatches(l.symbolInstances,e,p)}}for(let g=0;g<l.symbolInstances.length;g++){let x=l.symbolInstances.get(g);x.crossTileID||(x.crossTileID=d.generate(),p[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ch(e,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(e,l){for(let d of l.getCrossTileIDsLists())for(let p of d)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let l=!1;for(let d in this.indexes){let p=this.indexes[d];for(let g in p)e[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,p[g]),delete p[g],l=!0)}return l}}class oa{constructor(){this.layerIndexes={},this.crossTileIDs=new uh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,l,d){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new d_);let g=!1,x={};p.handleWrapJump(d);for(let S of l){let E=S.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(S.tileID,E,this.crossTileIDs)&&(g=!0),x[E.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(e){let l={};e.forEach(d=>{l[d]=!0});for(let d in this.layerIndexes)l[d]||delete this.layerIndexes[d]}}var Za="void main() {fragColor=vec4(1.0);}";let di={prelude:xt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:xt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:xt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:xt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:xt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:xt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:xt(Za,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:xt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:xt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:xt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:xt(Za,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:xt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:xt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:xt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:xt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:xt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:xt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:xt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:xt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:xt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:xt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:xt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:xt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:xt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:xt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:xt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:xt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:xt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:xt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function xt(m,e){let l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=e.match(/in ([\w]+) ([\w]+)/g),p=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(p):p,S={};return{fragmentSource:m=m.replace(l,(E,C,D,k,R)=>(S[R]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${D} ${k} ${R};
#else
uniform ${D} ${k} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${D} ${k} ${R} = u_${R};
#endif
`)),vertexSource:e=e.replace(l,(E,C,D,k,R)=>{let F=k==="float"?"vec2":"vec4",U=R.match(/color/)?"color":F;return S[R]?C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${D} ${F} a_${R};
out ${D} ${k} ${R};
#else
uniform ${D} ${k} u_${R};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${D} ${k} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${U}(a_${R}, u_${R}_t);
#else
    ${D} ${k} ${R} = u_${R};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${D} ${F} a_${R};
#else
uniform ${D} ${k} u_${R};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${D} ${k} ${R} = a_${R};
#else
    ${D} ${k} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${D} ${k} ${R} = unpack_mix_${U}(a_${R}, u_${R}_t);
#else
    ${D} ${k} ${R} = u_${R};
#endif
`}),staticAttributes:d,staticUniforms:x}}class os{constructor(e,l,d){this.vertexBuffer=e,this.indexBuffer=l,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ko=s.aJ([{name:"a_pos",type:"Int16",components:2}]);let Qi="#define PROJECTION_MERCATOR",ss="mercator";class bt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ss}get shaderDefine(){return Qi}get shaderPreludeCode(){return di.projectionMercator}get vertexShaderPreludeCode(){return di.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,l,d,p,g){if(this._cachedMesh)return this._cachedMesh;let x=new s.aL;x.emplaceBack(0,0),x.emplaceBack(s.$,0),x.emplaceBack(0,s.$),x.emplaceBack(s.$,s.$);let S=e.createVertexBuffer(x,ko.members),E=s.aM.simpleSegment(0,0,4,2),C=new s.aN;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);let D=e.createIndexBuffer(C);return this._cachedMesh=new os(S,D,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class as{constructor(e=0,l=0,d=0,p=0){if(isNaN(e)||e<0||isNaN(l)||l<0||isNaN(d)||d<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=l,this.left=d,this.right=p}interpolate(e,l,d){return l.top!=null&&e.top!=null&&(this.top=s.C.number(e.top,l.top,d)),l.bottom!=null&&e.bottom!=null&&(this.bottom=s.C.number(e.bottom,l.bottom,d)),l.left!=null&&e.left!=null&&(this.left=s.C.number(e.left,l.left,d)),l.right!=null&&e.right!=null&&(this.right=s.C.number(e.right,l.right,d)),this}getCenter(e,l){let d=s.ah((this.left+e-this.right)/2,0,e),p=s.ah((this.top+l-this.bottom)/2,0,l);return new s.P(d,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function oc(m,e){if(!m.renderWorldCopies||m.lngRange)return;let l=e.lng-m.center.lng;e.lng+=l>180?-360:l<-180?360:0}function sc(m){return Math.max(0,Math.floor(m))}class gr{constructor(e,l,d,p,g,x){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=sc(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new as,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,l,d){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=sc(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new as(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!d&&e.autoCalculateNearFarZ,l&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let l=s.aO(e,-180,180)*Math.PI/180;var d,p,g,x,S,E,C,D,k;this._bearingInRadians!==l&&(this._unmodified=!1,this._bearingInRadians=l,this._calcMatrices(),this._rotationMatrix=w(),d=this._rotationMatrix,g=-this._bearingInRadians,x=(p=this._rotationMatrix)[0],S=p[1],E=p[2],C=p[3],D=Math.sin(g),k=Math.cos(g),d[0]=x*k+E*D,d[1]=S*k+C*D,d[2]=x*-D+E*k,d[3]=S*-D+C*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let l=s.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==l&&(this._unmodified=!1,this._pitchInRadians=l,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let l=e/180*Math.PI;this._rollInRadians!==l&&(this._unmodified=!1,this._rollInRadians=l,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aP(this._fovInRadians)}setFov(e){e=s.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=s.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let l=this.getConstrained(this._center,e).zoom;this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this._tileZoom=Math.max(0,Math.floor(l)),this._scale=s.af(l),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,l){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=l,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,l,d){this._unmodified=!1,this._edgeInsets.interpolate(e,l,d),this._constrain(),this._calcMatrices()}resize(e,l,d=!0){this._width=e,this._height=l,d&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new gn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-s.ai,s.ai])}getConstrained(e,l){return this._callbacks.getConstrained(e,l)}getCameraQueryGeometry(e,l){if(l.length===1)return[l[0],e];{let{minX:d,minY:p,maxX:g,maxY:x}=s.a2.fromPoints(l).extend(e);return[new s.P(d,p),new s.P(g,p),new s.P(g,x),new s.P(d,x),new s.P(d,p)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:l,zoom:d}=this.getConstrained(this.center,this.zoom);this.setCenter(l),this.setZoom(d),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=s.ag(new Float64Array(16));s.N(e,e,[this._width/2,-this._height/2,1]),s.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=s.ag(new Float64Array(16)),s.N(e,e,[1,-1,1]),s.M(e,e,[-1,-1,0]),s.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,l,d,p){let g=d!==void 0?d:this.bearing,x=p=p!==void 0?p:this.pitch,S=s.a1.fromLngLat(e,l),E=-Math.cos(s.ae(x)),C=Math.sin(s.ae(x)),D=C*Math.sin(s.ae(g)),k=-C*Math.cos(s.ae(g)),R=this.elevation,F=l-R,U;E*F>=0||Math.abs(E)<.1?(U=1e4,R=l+U*E):U=-F/E;let X,W,Y=s.aQ(1,S.y),Q=0;do{if(Q+=1,Q>10)break;W=U/Y,X=new s.a1(S.x+D*W,S.y+k*W),Y=1/X.meterInMercatorCoordinateUnits()}while(Math.abs(U-W*Y)>1e-12);return{center:X.toLngLat(),elevation:R,zoom:s.ak(this.height/2/Math.tan(this.fovInRadians/2)/W/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let l=s.aj(1,this.center.lat)*this.worldSize,d=this.cameraToCenterDistance/l,p=s.a1.fromLngLat(this.center,this.elevation),g=ve(this.center,this.elevation,this.pitch,this.bearing,d);this._elevation=e;let x=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),s.aQ(g.z,p.y),this.bearing,this.pitch);this._elevation=x.elevation,this._center=x.center,this.setZoom(x.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=s.aj(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let l=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/l,e.canonical.y/l,1/l/s.$,1/l/s.$]}}class Bn{constructor(e,l){this.min=e,this.max=l,this.center=s.aR([],s.aS([],this.min,this.max),.5)}quadrant(e){let l=[e%2==0,e<2],d=s.aT(this.min),p=s.aT(this.max);for(let g=0;g<l.length;g++)d[g]=l[g]?this.min[g]:this.center[g],p[g]=l[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new Bn(d,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let l=!0;for(let d=0;d<e.planes.length;d++){let p=this.intersectsPlane(e.planes[d]);if(p===0)return 0;p===1&&(l=!1)}return l?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let l=e[3],d=e[3];for(let p=0;p<3;p++)e[p]>0?(l+=e[p]*this.min[p],d+=e[p]*this.max[p]):(d+=e[p]*this.min[p],l+=e[p]*this.max[p]);return l>=0?2:d<0?0:1}}class _r{distanceToTile2d(e,l,d,p){let g=p.distanceX([e,l]),x=p.distanceY([e,l]);return Math.hypot(g,x)}getWrap(e,l,d){return d}getTileBoundingVolume(e,l,d,p){var g,x;let S=0,E=0;if(p?.terrain){let D=new s.Z(e.z,l,e.z,e.x,e.y),k=p.terrain.getMinMaxElevation(D);S=(g=k.minElevation)!==null&&g!==void 0?g:Math.min(0,d),E=(x=k.maxElevation)!==null&&x!==void 0?x:Math.max(0,d)}let C=1<<e.z;return new Bn([l+e.x/C,e.y/C,S],[l+(e.x+1)/C,(e.y+1)/C,E])}allowVariableZoom(e,l){let d=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,p=s.ah(78.5-d/2,0,60);return!!l.terrain||e.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Tn{constructor(e,l,d){this.points=e,this.planes=l,this.aabb=d}static fromInvProjectionMatrix(e,l=1,d=0,p,g){let x=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,d),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>function(F,U,X,W){let Y=s.aw([],F,U),Q=1/Y[3]/X*W;return s.aY(Y,Y,[Q,Q,1/Y[3],Q])}(R,e,l,S));p&&function(R,F,U,X){let W=X?4:0,Y=X?0:4,Q=0,ne=[],J=[];for(let ee=0;ee<4;ee++){let de=s.aU([],R[ee+Y],R[ee+W]),be=s.aZ(de);s.aR(de,de,1/be),ne.push(be),J.push(de)}for(let ee=0;ee<4;ee++){let de=s.a_(R[ee+W],J[ee],U);Q=de!==null&&de>=0?Math.max(Q,de):Math.max(Q,ne[ee])}let oe=function(ee,de){let be=s.aU([],ee[de[0]],ee[de[1]]),ge=s.aU([],ee[de[2]],ee[de[1]]),_e=[0,0,0,0];return s.aV(_e,s.aW([],be,ge)),_e[3]=-s.aX(_e,ee[de[0]]),_e}(R,F),ae=function(ee,de){let be=s.a$(ee),ge=s.b0([],ee,1/be),_e=s.aU([],de,s.aR([],ge,s.aX(de,ge))),xe=s.a$(_e);if(xe>0){let ke=Math.sqrt(1-ge[3]*ge[3]),Oe=s.aR([],ge,-ge[3]),Ce=s.aS([],Oe,s.aR([],_e,ke/xe));return s.b1(de,Ce)}return null}(U,oe);if(ae!==null){let ee=ae/s.aX(J[0],oe);Q=Math.min(Q,ee)}for(let ee=0;ee<4;ee++){let de=Math.min(Q,ne[ee]);R[ee+Y]=[R[ee+W][0]+J[ee][0]*de,R[ee+W][1]+J[ee][1]*de,R[ee+W][2]+J[ee][2]*de,1]}}(E,x[0],p,g);let C=x.map(R=>{let F=s.aU([],E[R[0]],E[R[1]]),U=s.aU([],E[R[2]],E[R[1]]),X=s.aV([],s.aW([],F,U)),W=-s.aX(X,E[R[1]]);return X.concat(W)}),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],k=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let R of E)for(let F=0;F<3;F++)D[F]=Math.min(D[F],R[F]),k[F]=Math.max(k[F],R[F]);return new Tn(E,C,new Bn(D,k))}}class Kt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,l,d){return this._helper.interpolatePadding(e,l,d)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,l,d=!0){this._helper.resize(e,l,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,l){this._helper.overrideNearFarZ(e,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,l){}constructor(e,l,d,p,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new gr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(x,S)=>this.getConstrained(x,S)},e,l,d,p,g),this._coveringTilesDetailsProvider=new _r}clone(){let e=new Kt;return e.apply(this),e}apply(e,l,d){this._helper.apply(e,l,d)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let l=[new s.b2(0,e)];if(this._helper._renderWorldCopies){let d=this.screenPointToMercatorCoordinate(new s.P(0,0)),p=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),S=Math.floor(Math.min(d.x,p.x,g.x,x.x)),E=Math.floor(Math.max(d.x,p.x,g.x,x.x)),C=1;for(let D=S-C;D<=E+C;D++)D!==0&&l.push(new s.b2(D,e))}return l}getCameraFrustum(){return Tn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let l=this.screenPointToLocation(this.centerPoint,e),d=e?e.getElevationForLngLatZoom(l,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(d)}setLocationAtPoint(e,l){let d=s.aj(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(l,d),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,d),x=s.a1.fromLngLat(e),S=new s.a1(x.x-(p.x-g.x),x.y-(p.y-g.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,l){return l?this.coordinatePoint(s.a1.fromLngLat(e),l.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.a1.fromLngLat(e))}screenPointToLocation(e,l){var d;return(d=this.screenPointToMercatorCoordinate(e,l))===null||d===void 0?void 0:d.toLngLat()}screenPointToMercatorCoordinate(e,l){if(l){let d=l.pointCoordinate(e);if(d!=null)return d}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,l){let d=l||0,p=[e.x,e.y,0,1],g=[e.x,e.y,1,1];s.aw(p,p,this._pixelMatrixInverse),s.aw(g,g,this._pixelMatrixInverse);let x=p[3],S=g[3],E=p[1]/x,C=g[1]/S,D=p[2]/x,k=g[2]/S,R=D===k?0:(d-D)/(k-D);return new s.a1(s.C.number(p[0]/x,g[0]/S,R)/this.worldSize,s.C.number(E,C,R)/this.worldSize,d)}coordinatePoint(e,l=0,d=this._pixelMatrix){let p=[e.x*this.worldSize,e.y*this.worldSize,l,1];return s.aw(p,p,d),new s.P(p[0]/p[3],p[1]/p[3])}getBounds(){let e=Math.max(0,this._helper._height/2-le(this));return new gn().extend(this.screenPointToLocation(new s.P(0,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(e,l){return l?l.pointCoordinate(e)!=null:e.y>this.height/2-le(this)}calculatePosMatrix(e,l=!1,d){var p;let g=(p=e.key)!==null&&p!==void 0?p:s.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),x=l?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(g)){let C=x.get(g);return d?C.f32:C.f64}let S=he(e,this.worldSize);s.O(S,l?this._alignedProjMatrix:this._viewProjMatrix,S);let E={f64:S,f32:new Float32Array(S)};return x.set(g,E),d?E.f32:E.f64}calculateFogMatrix(e){let l=e.key,d=this._fogMatrixCacheF32;if(d.has(l))return d.get(l);let p=he(e,this.worldSize);return s.O(p,this._fogMatrix,p),d.set(l,new Float32Array(p)),d.get(l)}getConstrained(e,l){l=s.ah(+l,this.minZoom,this.maxZoom);let d={center:new s.S(e.lng,e.lat),zoom:l},p=this._helper._lngRange;if(!this._helper._renderWorldCopies&&p===null){let ne=179.9999999999;p=[-ne,ne]}let g=this.tileSize*s.af(d.zoom),x=0,S=g,E=0,C=g,D=0,k=0,{x:R,y:F}=this.size;if(this._helper._latRange){let ne=this._helper._latRange;x=s.U(ne[1])*g,S=s.U(ne[0])*g,S-x<F&&(D=F/(S-x))}p&&(E=s.aO(s.V(p[0])*g,0,g),C=s.aO(s.V(p[1])*g,0,g),C<E&&(C+=g),C-E<R&&(k=R/(C-E)));let{x:U,y:X}=q(g,e),W,Y,Q=Math.max(k||0,D||0);if(Q){let ne=new s.P(k?(C+E)/2:U,D?(S+x)/2:X);return d.center=te(g,ne).wrap(),d.zoom+=s.ak(Q),d}if(this._helper._latRange){let ne=F/2;X-ne<x&&(Y=x+ne),X+ne>S&&(Y=S-ne)}if(p){let ne=(E+C)/2,J=U;this._helper._renderWorldCopies&&(J=s.aO(U,ne-g/2,ne+g/2));let oe=R/2;J-oe<E&&(W=E+oe),J+oe>C&&(W=C-oe)}if(W!==void 0||Y!==void 0){let ne=new s.P(W??U,Y??X);d.center=te(g,ne).wrap()}return d}calculateCenterFromCameraLngLatAlt(e,l,d,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,l,d,p)}_calculateNearFarZIfNeeded(e,l,d){if(!this._helper.autoCalculateNearFarZ)return;let p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-p*this._helper._pixelPerMeter/Math.cos(l),x=p<0?g:e,S=Math.PI/2+this.pitchInRadians,E=s.ae(this.fov)*(Math.abs(Math.cos(s.ae(this.roll)))*this.height+Math.abs(Math.sin(s.ae(this.roll)))*this.width)/this.height*(.5+d.y/this.height),C=Math.sin(E)*x/Math.sin(s.ah(Math.PI-S-E,.01,Math.PI-.01)),D=le(this),k=Math.atan(D/this._helper.cameraToCenterDistance),R=s.ae(.75),F=k>R?2*k*(.5+d.y/(2*D)):R,U=Math.sin(F)*x/Math.sin(s.ah(Math.PI-S-F,.01,Math.PI-.01)),X=Math.min(C,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-l)*X+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,l=q(this.worldSize,this.center),d=l.x,p=l.y;this._helper._pixelPerMeter=s.aj(1,this.center.lat)*this.worldSize;let g=s.ae(Math.min(this.pitch,$)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g)),S;this._calculateNearFarZIfNeeded(x,g,e),S=new Float64Array(16),s.b4(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aq(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=s.b5(S),s.N(S,S,[1,-1,1]),s.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),s.b6(S,S,-this.rollInRadians),s.b7(S,S,this.pitchInRadians),s.b6(S,S,-this.bearingInRadians),s.M(S,S,[-d,-p,0]),this._mercatorMatrix=s.N([],S,[this.worldSize,this.worldSize,this.worldSize]),s.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),s.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=s.aq([],S);let E=[0,0,-1,1];s.aw(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),s.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,s.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.M(this._fogMatrix,this._fogMatrix,[-d,-p,0]),s.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);let C=this._helper._width%2/2,D=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),R=Math.sin(-this.bearingInRadians),F=d-Math.round(d)+k*C+R*D,U=p-Math.round(p)+k*D+R*C,X=new Float64Array(S);if(s.M(X,X,[F>.5?F-1:F,U>.5?U-1:U,0]),this._alignedProjMatrix=X,S=s.aq(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new s.P(0,0)),l=[e.x*this.worldSize,e.y*this.worldSize,0,1];return s.aw(l,l,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=s.aj(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,l){let d=s.a1.fromLngLat(e),p=[d.x*this.worldSize,d.y*this.worldSize,l,1];return s.aw(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(e){let{overscaledTileID:l,aligned:d,applyTerrainMatrix:p}=e,g=this._helper.getMercatorTileCoordinates(l),x=l?this.calculatePosMatrix(l,d,!0):null,S;return S=l&&l.terrainRttPosMatrix32f&&p?l.terrainRttPosMatrix32f:x||s.b8(),{mainMatrix:S,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,l,d){return 1}transformLightDirection(e){return s.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,l,d,p){let g=this.calculatePosMatrix(d),x;p?(x=[e,l,p(e,l),1],s.aw(x,x,g)):(x=[e,l,0,1],ta(x,x,g));let S=x[3];return{point:new s.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(let l of e)this.calculatePosMatrix(l)}getMatrixForModel(e,l){let d=s.a1.fromLngLat(e,l),p=d.meterInMercatorCoordinateUnits(),g=s.b9();return s.M(g,g,[d.x,d.y,d.z]),s.b6(g,g,Math.PI),s.b7(g,g,Math.PI/2),s.N(g,g,[-p,p,p]),g}getProjectionDataForCustomLayer(e=!0){let l=new s.Z(0,0,0,0,0),d=this.getProjectionData({overscaledTileID:l,applyGlobeMatrix:e}),p=he(l,this.worldSize);s.O(p,this._viewProjMatrix,p),d.tileMercatorCoords=[0,0,1,1];let g=[s.$,s.$,this.worldSize/this._helper.pixelsPerMeter],x=s.ba();return s.N(x,p,g),d.fallbackMatrix=x,d.mainMatrix=x,d}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function jf(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function yr(m){if(m.useSlerp)if(m.k<1){let e=s.bb(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),l=s.bb(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),d=new Float64Array(4);s.bc(d,e,l,m.k);let p=s.bd(d);m.tr.setRoll(p.roll),m.tr.setPitch(p.pitch),m.tr.setBearing(p.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(s.C.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(s.C.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(s.C.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function zr(m,e,l,d,p){let g=p.padding,x=q(p.worldSize,l.getNorthWest()),S=q(p.worldSize,l.getNorthEast()),E=q(p.worldSize,l.getSouthEast()),C=q(p.worldSize,l.getSouthWest()),D=s.ae(-d),k=x.rotate(D),R=S.rotate(D),F=E.rotate(D),U=C.rotate(D),X=new s.P(Math.max(k.x,R.x,U.x,F.x),Math.max(k.y,R.y,U.y,F.y)),W=new s.P(Math.min(k.x,R.x,U.x,F.x),Math.min(k.y,R.y,U.y,F.y)),Y=X.sub(W),Q=(p.width-(g.left+g.right+e.left+e.right))/Y.x,ne=(p.height-(g.top+g.bottom+e.top+e.bottom))/Y.y;if(ne<0||Q<0)return void jf();let J=Math.min(s.ak(p.scale*Math.min(Q,ne)),m.maxZoom),oe=s.P.convert(m.offset),ae=new s.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(s.ae(d)),ee=oe.add(ae).mult(p.scale/s.af(J));return{center:te(p.worldSize,x.add(E).div(2).sub(ee)),zoom:J,bearing:d}}class ar{get useGlobeControls(){return!1}handlePanInertia(e,l){return{easingOffset:e,easingCenter:l.center}}handleMapControlsRollPitchBearingZoom(e,l){e.bearingDelta&&l.setBearing(l.bearing+e.bearingDelta),e.pitchDelta&&l.setPitch(l.pitch+e.pitchDelta),e.rollDelta&&l.setRoll(l.roll+e.rollDelta),e.zoomDelta&&l.setZoom(l.zoom+e.zoomDelta)}handleMapControlsPan(e,l,d){e.around.distSqr(l.centerPoint)<.01||l.setLocationAtPoint(d,e.around)}cameraForBoxAndBearing(e,l,d,p,g){return zr(e,l,d,p,g)}handleJumpToCenterZoom(e,l){e.zoom!==(l.zoom!==void 0?+l.zoom:e.zoom)&&e.setZoom(+l.zoom),l.center!==void 0&&e.setCenter(s.S.convert(l.center))}handleEaseTo(e,l){let d=e.zoom,p=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},x={roll:l.roll===void 0?e.roll:l.roll,pitch:l.pitch===void 0?e.pitch:l.pitch,bearing:l.bearing===void 0?e.bearing:l.bearing},S=l.zoom!==void 0,E=!e.isPaddingEqual(l.padding),C=!1,D=S?+l.zoom:e.zoom,k=e.centerPoint.add(l.offsetAsPoint),R=e.screenPointToLocation(k),{center:F,zoom:U}=e.getConstrained(s.S.convert(l.center||R),D??d);oc(e,F);let X=q(e.worldSize,R),W=q(e.worldSize,F).sub(X),Y=s.af(U-d);return C=U!==d,{easeFunc:Q=>{if(C&&e.setZoom(s.C.number(d,U,Q)),s.be(g,x)||yr({startEulerAngles:g,endEulerAngles:x,tr:e,k:Q,useSlerp:g.roll!=x.roll}),E&&(e.interpolatePadding(p,l.padding,Q),k=e.centerPoint.add(l.offsetAsPoint)),l.around)e.setLocationAtPoint(l.around,l.aroundPoint);else{let ne=s.af(e.zoom-d),J=U>d?Math.min(2,Y):Math.max(.5,Y),oe=Math.pow(J,1-Q),ae=te(e.worldSize,X.add(W.mult(Q*oe)).mult(ne));e.setLocationAtPoint(e.renderWorldCopies?ae.wrap():ae,k)}},isZooming:C,elevationCenter:F}}handleFlyTo(e,l){let d=l.zoom!==void 0,p=e.zoom,g=e.getConstrained(s.S.convert(l.center||l.locationAtOffset),d?+l.zoom:p),x=g.center,S=g.zoom;oc(e,x);let E=q(e.worldSize,l.locationAtOffset),C=q(e.worldSize,x).sub(E),D=C.mag(),k=s.af(S-p),R;if(l.minZoom!==void 0){let F=Math.min(+l.minZoom,p,S),U=e.getConstrained(x,F).zoom;R=s.af(U-p)}return{easeFunc:(F,U,X,W)=>{e.setZoom(F===1?S:p+s.ak(U));let Y=F===1?x:te(e.worldSize,E.add(C.mult(X)).mult(U));e.setLocationAtPoint(e.renderWorldCopies?Y.wrap():Y,W)},scaleOfZoom:k,targetCenter:x,scaleOfMinZoom:R,pixelPathLength:D}}}class on{constructor(e,l,d){this.blendFunction=e,this.blendColor=l,this.mask=d}}on.Replace=[1,0],on.disabled=new on(on.Replace,s.bf.transparent,[!1,!1,!1,!1]),on.unblended=new on(on.Replace,s.bf.transparent,[!0,!0,!0,!0]),on.alphaBlended=new on([1,771],s.bf.transparent,[!0,!0,!0,!0]);let ls=2305;class nt{constructor(e,l,d){this.enable=e,this.mode=l,this.frontFace=d}}nt.disabled=new nt(!1,1029,ls),nt.backCCW=new nt(!0,1029,ls),nt.frontCCW=new nt(!0,1028,ls);class ct{constructor(e,l,d){this.func=e,this.mask=l,this.range=d}}ct.ReadOnly=!1,ct.ReadWrite=!0,ct.disabled=new ct(519,ct.ReadOnly,[0,1]);let Ji=7680;class kt{constructor(e,l,d,p,g,x){this.test=e,this.ref=l,this.mask=d,this.fail=p,this.depthFail=g,this.pass=x}}kt.disabled=new kt({func:519,mask:0},0,0,Ji,Ji,Ji);let jr=new WeakMap;function zi(m){var e;if(jr.has(m))return jr.get(m);{let l=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return jr.set(m,l),l}}class ji{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let l=e.context,d=l.gl;this._texFormat=d.RGBA,this._texType=d.UNSIGNED_BYTE;let p=new s.aL;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);let g=new s.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new os(l.createVertexBuffer(p,ko.members),l.createIndexBuffer(g),s.aM.simpleSegment(0,0,p.length,g.length)),this._resultBuffer=new Uint8Array(4),l.activeTexture.set(d.TEXTURE1);let x=d.createTexture();d.bindTexture(d.TEXTURE_2D,x),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=l.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),zi(d)&&(this._pbo=d.createBuffer(),d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.bufferData(d.PIXEL_PACK_BUFFER,4,d.STREAM_READ),d.bindBuffer(d.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,l){let d=this._updateCount;return this._readbackQueue?d>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():d>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,l),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,l=e.gl;e.activeTexture.set(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,l){let d=this._cachedRenderContext.context,p=d.gl;if(this._bindFramebuffer(),d.viewport.set([0,0,this._texWidth,this._texHeight]),d.clear({color:s.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(d,p.TRIANGLES,ct.disabled,kt.disabled,on.unblended,nt.disabled,((g,x)=>({u_input:g,u_output_expected:x}))(e,l),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&zi(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);let g=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&zi(e)){let l=e.clientWaitSync(this._readbackQueue.sync,0,0);if(l===e.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(l===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ji._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let l=0;return l+=e[0]/256,l+=e[1]/65536,l+=e[2]/16777216,e[3]<127&&(l=-l),l/128}}let ac=s.$/128;function hh(m,e){let l=m.granularity!==void 0?Math.max(m.granularity,1):1,d=l+(m.generateBorders?2:0),p=l+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=d+1,x=p+1,S=m.generateBorders?-1:0,E=m.generateBorders||m.extendToNorthPole?-1:0,C=l+(m.generateBorders?1:0),D=l+(m.generateBorders||m.extendToSouthPole?1:0),k=g*x,R=d*p*6,F=g*x>65536;if(F&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let U=F||e==="32bit",X=new Int16Array(2*k),W=0;for(let ne=E;ne<=D;ne++)for(let J=S;J<=C;J++){let oe=J/l*s.$;J===-1&&(oe=-ac),J===l+1&&(oe=s.$+ac);let ae=ne/l*s.$;ne===-1&&(ae=m.extendToNorthPole?s.bh:-ac),ne===l+1&&(ae=m.extendToSouthPole?s.bi:s.$+ac),X[W++]=oe,X[W++]=ae}let Y=U?new Uint32Array(R):new Uint16Array(R),Q=0;for(let ne=0;ne<p;ne++)for(let J=0;J<d;J++){let oe=J+1+ne*g,ae=J+(ne+1)*g,ee=J+1+(ne+1)*g;Y[Q++]=J+ne*g,Y[Q++]=ae,Y[Q++]=oe,Y[Q++]=oe,Y[Q++]=ae,Y[Q++]=ee}return{vertices:X.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:U}}let sa=new s.aK({fill:new s.bj(128,2),line:new s.bj(512,0),tile:new s.bj(128,32),stencil:new s.bj(128,1),circle:3});class Wa{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return di.projectionGlobe}get vertexShaderPreludeCode(){return di.projectionMercator.vertexSource}get subdivisionGranularity(){return sa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new ji(e));let l=s.U(this._errorQueryLatitudeDegrees),d=2*Math.atan(Math.exp(Math.PI-l*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(l,d),g=B.now();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=g);let x=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bl(x))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,l,d,p,g){let x=(g==="stencil"?sa.stencil:sa.tile).getGranularityForZoomLevel(l.z);return this._getMesh(e,{granularity:x,generateBorders:d,extendToNorthPole:l.y===0&&p,extendToSouthPole:l.y===(1<<l.z)-1&&p})}_getMesh(e,l){let d=this._getMeshKey(l);if(d in this._tileMeshCache)return this._tileMeshCache[d];let p=function(g,x){let S=hh(x,"16bit"),E=s.aL.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),C=s.aN.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new os(g.createVertexBuffer(E,ko.members),g.createIndexBuffer(C),s.aM.simpleSegment(0,0,E.length,C.length))}(e,l);return this._tileMeshCache[d]=p,p}recalculate(e){}hasTransition(){let e=B.now(),l=!1;return l=l||(e-this._errorMeasurementLastChangeTime)/1e3<.7,l=l||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,l}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let lc=new s.r({type:new s.D(s.v.projection.type)});class cc extends s.E{constructor(e){super(),this._transitionable=new s.t(lc),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0)),this._mercatorProjection=new bt,this._verticalPerspectiveProjection=new Wa}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof s.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,l,d,p,g){return this.currentProjection.getMeshFromTileID(e,l,d,p,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function uc(m){let e=aa(m.worldSize,m.center.lat);return 2*Math.PI*e}function fi(m,e,l,d,p){let g=1/(1<<p),x=e/s.$*g+d*g,S=s.bo((m/s.$*g+l*g)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,C=Math.cos(E),D=new Float64Array(3);return D[0]=Math.sin(S)*C,D[1]=Math.sin(E),D[2]=Math.cos(S)*C,D}function Un(m){return function(e,l){let d=Math.cos(l),p=new Float64Array(3);return p[0]=Math.sin(e)*d,p[1]=Math.sin(l),p[2]=Math.cos(e)*d,p}(m.lng*Math.PI/180,m.lat*Math.PI/180)}function aa(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Xa(m){let e=Math.asin(m[1])/Math.PI*180,l=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(l>1e-6){let d=m[0]/l,p=Math.acos(m[2]/l),g=(d>0?p:-p)/Math.PI*180;return new s.S(s.aO(g,-180,180),e)}return new s.S(0,e)}function cs(m){return Math.cos(m*Math.PI/180)}function yn(m,e){let l=cs(m),d=cs(e);return s.ak(d/l)}function Bf(m,e){let l=m.rotate(e.bearingInRadians),d=e.zoom+yn(e.center.lat,0),p=s.bk(1/cs(e.center.lat),1/cs(Math.min(Math.abs(e.center.lat),60)),s.bn(d,7,3,0,1)),g=360/uc({worldSize:e.worldSize,center:{lat:e.center.lat}});return new s.S(e.center.lng-l.x*g*p,s.ah(e.center.lat+l.y*g,-s.ai,s.ai))}function Ya(m){let e=.5*m,l=Math.sin(e),d=Math.cos(e);return Math.log(l+d)-Math.log(d-l)}function dh(m,e,l,d){let p=m.lat+l*d;if(Math.abs(l)>1){let g=(Math.sign(m.lat+l)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,x=Math.abs(m.lat+l)*Math.PI/180,S=Ya(g+d*(x-g)),E=Ya(g),C=Ya(x);return new s.S(m.lng+e*((S-E)/(C-E)),p)}return new s.S(m.lng+e*d,p)}class f_{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,l,d,p){let g=`${e.z}_${e.x}_${e.y}_${p?.terrain?"t":""}`,x=this._cache.get(g);if(x)return x;let S=this._cachePrevious.get(g);if(S)return this._cache.set(g,S),S;let E=this._boundingVolumeFactory(e,l,d,p);return this._cache.set(g,E),this._hadAnyChanges=!0,E}}class la{constructor(e,l,d,p){this.min=d,this.max=p,this.points=e,this.planes=l}static fromAabb(e,l){let d=[];for(let p=0;p<8;p++)d.push([1&~p?e[0]:l[0],(p>>1&1)==1?l[1]:e[1],(p>>2&1)==1?l[2]:e[2]]);return new la(d,[[-1,0,0,l[0]],[1,0,0,-e[0]],[0,-1,0,l[1]],[0,1,0,-e[1]],[0,0,-1,l[2]],[0,0,1,-e[2]]],e,l)}static fromCenterSizeAngles(e,l,d){let p=s.br([],d[0],d[1],d[2]),g=s.bs([],[l[0],0,0],p),x=s.bs([],[0,l[1],0],p),S=s.bs([],[0,0,l[2]],p),E=[...e],C=[...e];for(let k=0;k<8;k++)for(let R=0;R<3;R++){let F=e[R]+g[R]*(1&~k?-1:1)+x[R]*((k>>1&1)==1?1:-1)+S[R]*((k>>2&1)==1?1:-1);E[R]=Math.min(E[R],F),C[R]=Math.max(C[R],F)}let D=[];for(let k=0;k<8;k++){let R=[...e];s.aS(R,R,s.aR([],g,1&~k?-1:1)),s.aS(R,R,s.aR([],x,(k>>1&1)==1?1:-1)),s.aS(R,R,s.aR([],S,(k>>2&1)==1?1:-1)),D.push(R)}return new la(D,[[...g,-s.aX(g,D[0])],[...x,-s.aX(x,D[0])],[...S,-s.aX(S,D[0])],[-g[0],-g[1],-g[2],-s.aX(g,D[7])],[-x[0],-x[1],-x[2],-s.aX(x,D[7])],[-S[0],-S[1],-S[2],-s.aX(S,D[7])]],E,C)}intersectsFrustum(e){let l=!0,d=this.points.length,p=this.planes.length,g=e.planes.length,x=e.points.length;for(let S=0;S<g;S++){let E=e.planes[S],C=0;for(let D=0;D<d;D++){let k=this.points[D];E[0]*k[0]+E[1]*k[1]+E[2]*k[2]+E[3]>=0&&C++}if(C===0)return 0;C<d&&(l=!1)}if(l)return 2;for(let S=0;S<p;S++){let E=this.planes[S],C=0;for(let D=0;D<x;D++){let k=e.points[D];E[0]*k[0]+E[1]*k[1]+E[2]*k[2]+E[3]>=0&&C++}if(C===0)return 0}return 1}intersectsPlane(e){let l=this.points.length,d=0;for(let p=0;p<l;p++){let g=this.points[p];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&d++}return d===l?2:d===0?0:1}}function Qn(m,e,l){let d=m-e;return d<0?-d:Math.max(0,d-l)}function Ka(m,e,l,d,p){let g=m-l,x;return x=g<0?Math.min(-g,1+g-p):g>1?Math.min(Math.max(g-p,0),1-g):0,Math.max(x,Qn(e,d,p))}class Bi{constructor(){this._boundingVolumeCache=new f_(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,l,d,p){let g=1<<d.z,x=1/g,S=d.x/g,E=d.y/g,C=2;return C=Math.min(C,Ka(e,l,S,E,x)),C=Math.min(C,Ka(e,l,S+.5,-E-x,x)),C=Math.min(C,Ka(e,l,S+.5,2-E-x,x)),C}getWrap(e,l,d){let p=1<<l.z,g=1/p,x=l.x/p,S=Qn(e.x,x,g),E=Qn(e.x,x-1,g),C=Qn(e.x,x+1,g),D=Math.min(S,E,C);return D===C?1:D===E?-1:0}allowVariableZoom(e,l){return Xe(e,l)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,l,d,p){return this._boundingVolumeCache.getTileBoundingVolume(e,l,d,p)}_computeTileBoundingVolume(e,l,d,p){var g,x;let S=0,E=0;if(p?.terrain){let C=new s.Z(e.z,l,e.z,e.x,e.y),D=p.terrain.getMinMaxElevation(C);S=(g=D.minElevation)!==null&&g!==void 0?g:Math.min(0,d),E=(x=D.maxElevation)!==null&&x!==void 0?x:Math.max(0,d)}if(S/=s.bu,E/=s.bu,S+=1,E+=1,e.z<=0)return la.fromAabb([-E,-E,-E],[E,E,E]);if(e.z===1)return la.fromAabb([e.x===0?-E:0,e.y===0?0:-E,-E],[e.x===0?0:E,e.y===0?E:0,E]);{let C=[fi(0,0,e.x,e.y,e.z),fi(s.$,0,e.x,e.y,e.z),fi(s.$,s.$,e.x,e.y,e.z),fi(0,s.$,e.x,e.y,e.z)],D=[];for(let _e of C)D.push(s.aR([],_e,E));if(E!==S)for(let _e of C)D.push(s.aR([],_e,S));e.y===0&&D.push([0,1,0]),e.y===(1<<e.z)-1&&D.push([0,-1,0]);let k=[1,1,1],R=[-1,-1,-1];for(let _e of D)for(let xe=0;xe<3;xe++)k[xe]=Math.min(k[xe],_e[xe]),R[xe]=Math.max(R[xe],_e[xe]);let F=fi(s.$/2,s.$/2,e.x,e.y,e.z),U=s.aW([],[0,1,0],F);s.aV(U,U);let X=s.aW([],F,U);s.aV(X,X);let W=s.aW([],C[2],C[1]);s.aV(W,W);let Y=s.aW([],C[0],C[3]);s.aV(Y,Y),D.push(s.aR([],F,E)),e.y>=(1<<e.z)/2&&D.push(s.aR([],fi(s.$/2,0,e.x,e.y,e.z),E)),e.y<(1<<e.z)/2&&D.push(s.aR([],fi(s.$/2,s.$,e.x,e.y,e.z),E));let Q=Qa(F,D),ne=Qa(X,D),J=[-F[0],-F[1],-F[2],Q.max],oe=[F[0],F[1],F[2],-Q.min],ae=[-X[0],-X[1],-X[2],ne.max],ee=[X[0],X[1],X[2],-ne.min],de=[...W,0],be=[...Y,0],ge=[];return e.y===0?ge.push(s.bt(be,de,J),s.bt(be,de,oe)):ge.push(s.bt(ae,de,J),s.bt(ae,de,oe),s.bt(ae,be,J),s.bt(ae,be,oe)),e.y===(1<<e.z)-1?ge.push(s.bt(be,de,J),s.bt(be,de,oe)):ge.push(s.bt(ee,de,J),s.bt(ee,de,oe),s.bt(ee,be,J),s.bt(ee,be,oe)),new la(ge,[J,oe,ae,ee,de,be],k,R)}}}function Qa(m,e){let l=1/0,d=-1/0;for(let p of e){let g=s.aX(m,p);l=Math.min(l,g),d=Math.max(d,g)}return{min:l,max:d}}class Ja{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,l,d){return this._helper.interpolatePadding(e,l,d)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,l){this._helper.resize(e,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,l){this._helper.overrideNearFarZ(e,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=s.bv(),this._projectionMatrix=s.b9(),this._globeViewProjMatrix32f=s.b8(),this._globeViewProjMatrixNoCorrection=s.b9(),this._globeViewProjMatrixNoCorrectionInverted=s.b9(),this._globeProjMatrixInverted=s.b9(),this._cameraPosition=s.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new gr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,l)=>this.getConstrained(e,l)}),this._coveringTilesDetailsProvider=new Bi}clone(){let e=new Ja;return e.apply(this),e}apply(e,l){this._globeLatitudeErrorCorrectionRadians=l||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=s.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:l,applyGlobeMatrix:d}=e,p=this._helper.getMercatorTileCoordinates(l);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:d?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let l=this.pitchInRadians,d=this.cameraToCenterDistance/e,p=Math.sin(l)*d,g=Math.cos(l)*d+1,x=1/Math.sqrt(p*p+g*g)*1,S=-p,E=g,C=Math.sqrt(S*S+E*E);S/=C,E/=C;let D=[0,S,E];s.bw(D,D,[0,0,0],-this.bearingInRadians),s.bx(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),s.by(D,D,[0,0,0],this.center.lng*Math.PI/180);let k=1/s.aZ(D);return s.aR(D,D,k),[...D,-x*k]}isLocationOccluded(e){return!this.isSurfacePointVisible(Un(e))}transformLightDirection(e){let l=this._helper._center.lng*Math.PI/180,d=this._helper._center.lat*Math.PI/180,p=Math.cos(d),g=[Math.sin(l)*p,Math.sin(d),Math.cos(l)*p],x=[g[2],0,-g[0]],S=[0,0,0];s.aW(S,x,g),s.aV(x,x),s.aV(S,S);let E=[0,0,0];return s.aV(E,[x[0]*e[0]+S[0]*e[1]+g[0]*e[2],x[1]*e[0]+S[1]*e[1]+g[1]*e[2],x[2]*e[0]+S[2]*e[1]+g[2]*e[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,l,d){let p=function(S,E,C){let D=1/(1<<C.z);return new s.a1(S/s.$*D+C.x*D,E/s.$*D+C.y*D)}(e,l,d.canonical),g=(x=p.y,[s.bo(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,l,d,p){let g=d.canonical,x=fi(e,l,g.x,g.y,g.z),S=1+(p?p(e,l):0)/s.bu,E=[x[0]*S,x[1]*S,x[2]*S,1];s.aw(E,E,this._globeViewProjMatrixNoCorrection);let C=this._cachedClippingPlane,D=C[0]*x[0]+C[1]*x[1]+C[2]*x[2]+C[3]<0;return{point:new s.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=aa(this.worldSize,this.center.lat),l=s.ba(),d=s.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),s.b4(l,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let p=this.centerOffset;l[8]=2*-p.x/this._helper._width,l[9]=2*p.y/this._helper._height,this._projectionMatrix=s.b5(l),this._globeProjMatrixInverted=s.ba(),s.aq(this._globeProjMatrixInverted,l),s.M(l,l,[0,0,-this.cameraToCenterDistance]),s.b6(l,l,this.rollInRadians),s.b7(l,l,-this.pitchInRadians),s.b6(l,l,this.bearingInRadians),s.M(l,l,[0,0,-e]);let g=s.bp();g[0]=e,g[1]=e,g[2]=e,s.b7(d,l,this.center.lat*Math.PI/180),s.bz(d,d,-this.center.lng*Math.PI/180),s.N(d,d,g),this._globeViewProjMatrixNoCorrection=d,s.b7(l,l,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bz(l,l,-this.center.lng*Math.PI/180),s.N(l,l,g),this._globeViewProjMatrix32f=new Float32Array(l),this._globeViewProjMatrixNoCorrectionInverted=s.ba(),s.aq(this._globeViewProjMatrixNoCorrectionInverted,d);let x=s.bp();this._cameraPosition=s.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,s.bw(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),s.bx(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),s.bw(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),s.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bx(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),s.by(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let S=s.b5(this._globeViewProjMatrixNoCorrectionInverted);s.N(S,S,[1,1,-1]),this._cachedFrustum=Tn.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){s.w("calculateFogMatrix is not supported on globe projection.");let l=s.ba();return s.ag(l),l}getVisibleUnwrappedCoordinates(e){return[new s.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,l){if(!this._globeViewProjMatrixNoCorrection)return 1;let d=Un(e);s.aR(d,d,1+l/s.bu);let p=s.bv();return s.aw(p,[d[0],d[1],d[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(e){}getBounds(){let e=.5*this.width,l=.5*this.height,d=[new s.P(0,0),new s.P(e,0),new s.P(this.width,0),new s.P(this.width,l),new s.P(this.width,this.height),new s.P(e,this.height),new s.P(0,this.height),new s.P(0,l)],p=[];for(let k of d)p.push(this.unprojectScreenPoint(k));let g=0,x=0,S=0,E=0,C=this.center;for(let k of p){let R=s.bA(C.lng,k.lng),F=s.bA(C.lat,k.lat);R<x&&(x=R),R>g&&(g=R),F<E&&(E=F),F>S&&(S=F)}let D=[C.lng+x,C.lat+E,C.lng+g,C.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new gn(D)}getConstrained(e,l){let d=s.ah(e.lat,-s.ai,s.ai),p=s.ah(+l,this.minZoom+yn(0,d),this.maxZoom);return{center:new s.S(e.lng,d),zoom:p}}calculateCenterFromCameraLngLatAlt(e,l,d,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,l,d,p)}setLocationAtPoint(e,l){let d=Un(this.unprojectScreenPoint(l)),p=Un(e),g=s.bp();s.bB(g);let x=s.bp();s.by(x,d,g,-this.center.lng*Math.PI/180),s.bx(x,x,g,this.center.lat*Math.PI/180);let S=p[0]*p[0]+p[2]*p[2],E=x[0]*x[0];if(S<E)return;let C=Math.sqrt(S-E),D=-C,k=s.bC(p[0],p[2],x[0],C),R=s.bC(p[0],p[2],x[0],D),F=s.bp();s.by(F,p,g,-k);let U=s.bC(F[1],F[2],x[1],x[2]),X=s.bp();s.by(X,p,g,-R);let W=s.bC(X[1],X[2],x[1],x[2]),Y=.5*Math.PI,Q=U>=-Y&&U<=Y,ne=W>=-Y&&W<=Y,J,oe;if(Q&&ne){let be=this.center.lng*Math.PI/180,ge=this.center.lat*Math.PI/180;s.bD(k,be)+s.bD(U,ge)<s.bD(R,be)+s.bD(W,ge)?(J=k,oe=U):(J=R,oe=W)}else if(Q)J=k,oe=U;else{if(!ne)return;J=R,oe=W}let ae=J/Math.PI*180,ee=oe/Math.PI*180,de=this.center.lat;this.setCenter(new s.S(ae,s.ah(ee,-90,90))),this.setZoom(this.zoom+yn(de,this.center.lat))}locationToScreenPoint(e,l){let d=Un(e);if(l){let p=l.getElevationForLngLatZoom(e,this._helper._tileZoom);s.aR(d,d,1+p/s.bu)}return this._projectSurfacePointToScreen(d)}_projectSurfacePointToScreen(e){let l=s.bv();return s.aw(l,[...e,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],new s.P((.5*l[0]+.5)*this.width,(.5*-l[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,l){if(l){let d=l.pointCoordinate(e);if(d)return d}return s.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,l){var d;return(d=this.screenPointToMercatorCoordinate(e,l))===null||d===void 0?void 0:d.toLngLat()}isPointOnMapSurface(e,l){let d=this._cameraPosition,p=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(d,p)}getRayDirectionFromPixel(e){let l=s.bv();l[0]=e.x/this.width*2-1,l[1]=-1*(e.y/this.height*2-1),l[2]=1,l[3]=1,s.aw(l,l,this._globeViewProjMatrixNoCorrectionInverted),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3];let d=s.bp();d[0]=l[0]-this._cameraPosition[0],d[1]=l[1]-this._cameraPosition[1],d[2]=l[2]-this._cameraPosition[2];let p=s.bp();return s.aV(p,d),p}isSurfacePointVisible(e){let l=this._cachedClippingPlane;return l[0]*e[0]+l[1]*e[1]+l[2]*e[2]+l[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let l=s.bv();return s.aw(l,[...e,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3],l[0]>-1&&l[0]<1&&l[1]>-1&&l[1]<1&&l[2]>-1&&l[2]<1}rayPlanetIntersection(e,l){let d=s.aX(e,l),p=s.bp(),g=s.bp();s.aR(g,l,d),s.aU(p,e,g);let x=1-s.aX(p,p);if(x<0)return null;let S=s.aX(e,e)-1,E=-d+(d<0?1:-1)*Math.sqrt(x),C=S/E,D=E;return{tMin:Math.min(C,D),tMax:Math.max(C,D)}}unprojectScreenPoint(e){let l=this._cameraPosition,d=this.getRayDirectionFromPixel(e),p=this.rayPlanetIntersection(l,d);if(p){let D=s.bp();s.aS(D,l,[d[0]*p.tMin,d[1]*p.tMin,d[2]*p.tMin]);let k=s.bp();return s.aV(k,D),Xa(k)}let g=this._cachedClippingPlane,x=g[0]*d[0]+g[1]*d[1]+g[2]*d[2],S=-s.b1(g,l)/x,E=s.bp();if(S>0)s.aS(E,l,[d[0]*S,d[1]*S,d[2]*S]);else{let D=s.bp();s.aS(D,l,[2*d[0],2*d[1],2*d[2]]);let k=s.b1(this._cachedClippingPlane,D);s.aU(E,D,[this._cachedClippingPlane[0]*k,this._cachedClippingPlane[1]*k,this._cachedClippingPlane[2]*k])}let C=function(D){let k=s.bp();return k[0]=D[0]*-D[3],k[1]=D[1]*-D[3],k[2]=D[2]*-D[3],{center:k,radius:Math.sqrt(1-D[3]*D[3])}}(g);return Xa(function(D,k,R){let F=s.bp();s.aU(F,R,D);let U=s.bp();return s.bq(U,D,F,k/s.a$(F)),U}(C.center,C.radius,E))}getMatrixForModel(e,l){let d=s.S.convert(e),p=1/s.bu,g=s.b9();return s.bz(g,g,d.lng/180*Math.PI),s.b7(g,g,-d.lat/180*Math.PI),s.M(g,g,[0,0,1+l/s.bu]),s.b7(g,g,.5*Math.PI),s.N(g,g,[p,p,p]),g}getProjectionDataForCustomLayer(e=!0){let l=this.getProjectionData({overscaledTileID:new s.Z(0,0,0,0,0),applyGlobeMatrix:e});return l.tileMercatorCoords=[0,0,1,1],l}getFastPathSimpleProjectionMatrix(e){}}class el{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,l,d){return this._helper.interpolatePadding(e,l,d)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,l,d=!0){this._helper.resize(e,l,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,l){this._helper.overrideNearFarZ(e,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,l){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=l,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new gr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,l)=>this.getConstrained(e,l)}),this._globeness=1,this._mercatorTransform=new Kt,this._verticalPerspectiveTransform=new Ja}clone(){let e=new el;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let l=this._mercatorTransform.getProjectionData(e),d=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?d.mainMatrix:l.mainMatrix,clippingPlane:d.clippingPlane,tileMercatorCoords:d.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:l.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return s.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,l,d){let p=this._mercatorTransform.getPitchedTextCorrection(e,l,d),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,l,d);return s.bk(p,g,this._globeness)}projectTileCoordinates(e,l,d,p){return this.currentTransform.projectTileCoordinates(e,l,d,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,l){return this.currentTransform.lngLatToCameraDepth(e,l)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,l){return this.currentTransform.getConstrained(e,l)}calculateCenterFromCameraLngLatAlt(e,l,d,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,l,d,p)}setLocationAtPoint(e,l){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,l),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,l),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,l){return this.currentTransform.locationToScreenPoint(e,l)}screenPointToMercatorCoordinate(e,l){return this.currentTransform.screenPointToMercatorCoordinate(e,l)}screenPointToLocation(e,l){return this.currentTransform.screenPointToLocation(e,l)}isPointOnMapSurface(e,l){return this.currentTransform.isPointOnMapSurface(e,l)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,l){return this.currentTransform.getMatrixForModel(e,l)}getProjectionDataForCustomLayer(e=!0){let l=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return l;let d=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return d.fallbackMatrix=l.mainMatrix,d}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class lr{get useGlobeControls(){return!0}handlePanInertia(e,l){let d=Bf(e,l);return Math.abs(d.lng-l.center.lng)>180&&(d.lng=l.center.lng+179.5*Math.sign(d.lng-l.center.lng)),{easingCenter:d,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,l){let d=e.around,p=l.screenPointToLocation(d);e.bearingDelta&&l.setBearing(l.bearing+e.bearingDelta),e.pitchDelta&&l.setPitch(l.pitch+e.pitchDelta),e.rollDelta&&l.setRoll(l.roll+e.rollDelta);let g=l.zoom;e.zoomDelta&&l.setZoom(l.zoom+e.zoomDelta);let x=l.zoom-g;if(x===0)return;let S=s.bA(l.center.lng,p.lng),E=S/(Math.abs(S/180)+1),C=s.bA(l.center.lat,p.lat),D=l.getRayDirectionFromPixel(d),k=l.cameraPosition,R=-1*s.aX(k,D),F=s.bp();s.aS(F,k,[D[0]*R,D[1]*R,D[2]*R]);let U=s.aZ(F)-1,X=Math.exp(.5*-Math.max(U-.3,0)),W=aa(l.worldSize,l.center.lat)/Math.min(l.width,l.height),Y=s.bn(W,.9,.5,1,.25),Q=(1-s.af(-x))*Math.min(X,Y),ne=l.center.lat,J=l.zoom,oe=new s.S(l.center.lng+E*Q,s.ah(l.center.lat+C*Q,-s.ai,s.ai));l.setLocationAtPoint(p,d);let ae=l.center,ee=s.bn(Math.abs(S),45,85,0,1),de=s.bn(W,.75,.35,0,1),be=Math.pow(Math.max(ee,de),.25),ge=s.bA(ae.lng,oe.lng),_e=s.bA(ae.lat,oe.lat);l.setCenter(new s.S(ae.lng+ge*be,ae.lat+_e*be).wrap()),l.setZoom(J+yn(ne,l.center.lat))}handleMapControlsPan(e,l,d){if(!e.panDelta)return;let p=l.center.lat,g=l.zoom;l.setCenter(Bf(e.panDelta,l).wrap()),l.setZoom(g+yn(p,l.center.lat))}cameraForBoxAndBearing(e,l,d,p,g){let x=zr(e,l,d,p,g),S=l.left/g.width*2-1,E=(g.width-l.right)/g.width*2-1,C=l.top/g.height*-2+1,D=(g.height-l.bottom)/g.height*-2+1,k=s.bA(d.getWest(),d.getEast())<0,R=k?d.getEast():d.getWest(),F=k?d.getWest():d.getEast(),U=Math.max(d.getNorth(),d.getSouth()),X=Math.min(d.getNorth(),d.getSouth()),W=R+.5*s.bA(R,F),Y=U+.5*s.bA(U,X),Q=g.clone();Q.setCenter(x.center),Q.setBearing(x.bearing),Q.setPitch(0),Q.setRoll(0),Q.setZoom(x.zoom);let ne=Q.modelViewProjectionMatrix,J=[Un(d.getNorthWest()),Un(d.getNorthEast()),Un(d.getSouthWest()),Un(d.getSouthEast()),Un(new s.S(F,Y)),Un(new s.S(R,Y)),Un(new s.S(W,U)),Un(new s.S(W,X))],oe=Un(x.center),ae=Number.POSITIVE_INFINITY;for(let ee of J)S<0&&(ae=lr.getLesserNonNegativeNonNull(ae,lr.solveVectorScale(ee,oe,ne,"x",S))),E>0&&(ae=lr.getLesserNonNegativeNonNull(ae,lr.solveVectorScale(ee,oe,ne,"x",E))),C>0&&(ae=lr.getLesserNonNegativeNonNull(ae,lr.solveVectorScale(ee,oe,ne,"y",C))),D<0&&(ae=lr.getLesserNonNegativeNonNull(ae,lr.solveVectorScale(ee,oe,ne,"y",D)));if(Number.isFinite(ae)&&ae!==0)return x.zoom=Q.zoom+s.ak(ae),x;jf()}handleJumpToCenterZoom(e,l){let d=e.center.lat,p=e.getConstrained(l.center?s.S.convert(l.center):e.center,e.zoom).center;e.setCenter(p.wrap());let g=l.zoom!==void 0?+l.zoom:e.zoom+yn(d,p.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,l){let d=e.zoom,p=e.center,g=e.padding,x={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:l.roll===void 0?e.roll:l.roll,pitch:l.pitch===void 0?e.pitch:l.pitch,bearing:l.bearing===void 0?e.bearing:l.bearing},E=l.zoom!==void 0,C=!e.isPaddingEqual(l.padding),D=!1,k=l.center?s.S.convert(l.center):p,R=e.getConstrained(k,d).center;oc(e,R);let F=e.clone();F.setCenter(R),F.setZoom(E?+l.zoom:d+yn(p.lat,k.lat)),F.setBearing(l.bearing);let U=new s.P(s.ah(e.centerPoint.x+l.offsetAsPoint.x,0,e.width),s.ah(e.centerPoint.y+l.offsetAsPoint.y,0,e.height));F.setLocationAtPoint(R,U);let X=(l.offset&&l.offsetAsPoint.mag())>0?F.center:R,W=E?+l.zoom:d+yn(p.lat,X.lat),Y=d+yn(p.lat,0),Q=W+yn(X.lat,0),ne=s.bA(p.lng,X.lng),J=s.bA(p.lat,X.lat),oe=s.af(Q-Y);return D=W!==d,{easeFunc:ae=>{if(s.be(x,S)||yr({startEulerAngles:x,endEulerAngles:S,tr:e,k:ae,useSlerp:x.roll!=S.roll}),C&&e.interpolatePadding(g,l.padding,ae),l.around)s.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(l.around,l.aroundPoint);else{let ee=Q>Y?Math.min(2,oe):Math.max(.5,oe),de=Math.pow(ee,1-ae),be=dh(p,ne,J,ae*de);e.setCenter(be.wrap())}if(D){let ee=s.C.number(Y,Q,ae)+yn(0,e.center.lat);e.setZoom(ee)}},isZooming:D,elevationCenter:X}}handleFlyTo(e,l){let d=l.zoom!==void 0,p=e.center,g=e.zoom,x=e.padding,S=!e.isPaddingEqual(l.padding),E=e.getConstrained(s.S.convert(l.center||l.locationAtOffset),g).center,C=d?+l.zoom:e.zoom+yn(e.center.lat,E.lat),D=e.clone();D.setCenter(E),D.setZoom(C),D.setBearing(l.bearing);let k=new s.P(s.ah(e.centerPoint.x+l.offsetAsPoint.x,0,e.width),s.ah(e.centerPoint.y+l.offsetAsPoint.y,0,e.height));D.setLocationAtPoint(E,k);let R=D.center;oc(e,R);let F=function(J,oe,ae){let ee=Un(oe),de=Un(ae),be=s.aX(ee,de),ge=Math.acos(be),_e=uc(J);return ge/(2*Math.PI)*_e}(e,p,R),U=g+yn(p.lat,0),X=C+yn(R.lat,0),W=s.af(X-U),Y;if(typeof l.minZoom=="number"){let J=+l.minZoom+yn(R.lat,0),oe=Math.min(J,U,X)+yn(0,R.lat),ae=e.getConstrained(R,oe).zoom+yn(R.lat,0);Y=s.af(ae-U)}let Q=s.bA(p.lng,R.lng),ne=s.bA(p.lat,R.lat);return{easeFunc:(J,oe,ae,ee)=>{let de=dh(p,Q,ne,ae);S&&e.interpolatePadding(x,l.padding,J);let be=J===1?R:de;e.setCenter(be.wrap());let ge=U+s.ak(oe);e.setZoom(J===1?C:ge+yn(0,be.lat))},scaleOfZoom:W,targetCenter:R,scaleOfMinZoom:Y,pixelPathLength:F}}static solveVectorScale(e,l,d,p,g){let x=p==="x"?[d[0],d[4],d[8],d[12]]:[d[1],d[5],d[9],d[13]],S=[d[3],d[7],d[11],d[15]],E=e[0]*x[0]+e[1]*x[1]+e[2]*x[2],C=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],D=l[0]*x[0]+l[1]*x[1]+l[2]*x[2],k=l[0]*S[0]+l[1]*S[1]+l[2]*S[2];return D+g*C===E+g*k||S[3]*(E-D)+x[3]*(k-C)+E*k==D*C?null:(D+x[3]-g*k-g*S[3])/(D-E-g*k+g*C)}static getLesserNonNegativeNonNull(e,l){return l!==null&&l>=0&&l<e?l:e}}class Uf{constructor(e){this._globe=e,this._mercatorCameraHelper=new ar,this._verticalPerspectiveCameraHelper=new lr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,l){return this.currentHelper.handlePanInertia(e,l)}handleMapControlsRollPitchBearingZoom(e,l){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,l)}handleMapControlsPan(e,l,d){this.currentHelper.handleMapControlsPan(e,l,d)}cameraForBoxAndBearing(e,l,d,p,g){return this.currentHelper.cameraForBoxAndBearing(e,l,d,p,g)}handleJumpToCenterZoom(e,l){this.currentHelper.handleJumpToCenterZoom(e,l)}handleEaseTo(e,l){return this.currentHelper.handleEaseTo(e,l)}handleFlyTo(e,l){return this.currentHelper.handleFlyTo(e,l)}}let hc=(m,e)=>s.y(m,e&&e.filter(l=>l.identifier!=="source.canvas")),p_=s.bE();class fh extends s.E{constructor(e,l={}){super(),this._rtlPluginLoaded=()=>{for(let d in this.sourceCaches){let p=this.sourceCaches[d].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[d].reload()}},this.map=e,this.dispatcher=new Tr(ts(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(d,p)=>this.getGlyphs(d,p)),this.dispatcher.registerMessageHandler("GI",(d,p)=>this.getImages(d,p)),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new xn(e._requestManager,l.localIdeographFontFamily),this.lineAtlas=new Ht(256,512),this.crossTileSymbolIndex=new oa,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",s.bG()),To().on(rs,this._rtlPluginLoaded),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;let p=this.sourceCaches[d.sourceId];if(!p)return;let g=p.getSource();if(g&&g.vectorLayerIds)for(let x in this._layers){let S=this._layers[x];S.source===g.id&&this._validateLayer(S)}})}setGlobalStateProperty(e,l){var d,p,g;this._checkLoaded();let x=l===null?(g=(p=(d=this.stylesheet.state)===null||d===void 0?void 0:d[e])===null||p===void 0?void 0:p.default)!==null&&g!==void 0?g:null:l;if(s.bH(x,this._globalState[e]))return this;this._globalState[e]=x;let S=this._findGlobalStateAffectedSources([e]);for(let E in this.sourceCaches)S.has(E)&&(this._reloadSource(E),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();let l=[];for(let p in e)!s.bH(this._globalState[p],e[p].default)&&(l.push(p),this._globalState[p]=e[p].default);let d=this._findGlobalStateAffectedSources(l);for(let p in this.sourceCaches)d.has(p)&&(this._reloadSource(p),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;let l=new Set;for(let d in this._layers){let p=this._layers[d],g=p.getLayoutAffectingGlobalStateRefs();for(let x of e)g.has(x)&&l.add(p.source)}return l}loadURL(e,l={},d){this.fire(new s.l("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;let p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let g=this._loadStyleRequest;s.j(p,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,l,d)}).catch(x=>{this._loadStyleRequest=null,x&&!g.signal.aborted&&this.fire(new s.k(x))})}loadJSON(e,l={},d){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,l.validate=l.validate!==!1,this._load(e,l,d)}).catch(()=>{})}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(p_,{validate:!1})}_load(e,l,d){var p,g,x;let S=l.transformStyle?l.transformStyle(d,e):e;if(!l.validate||!hc(this,s.z(S))){this._loaded=!0,this.stylesheet=S;for(let E in S.sources)this.addSource(E,S.sources[E],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new xo(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new tc(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.setGlobalState((x=this.stylesheet.state)!==null&&x!==void 0?x:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){let e=s.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(l=>l.id),this._layers={},this._serializedLayers=null;for(let l of e){let d=s.bJ(l);d.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=d}}_loadSprite(e,l=!1,d=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(g,x,S,E){return s._(this,void 0,void 0,function*(){let C=_t(g),D=S>1?"@2x":"",k={},R={};for(let{id:F,url:U}of C){let X=x.transformRequest(Ct(U,D,".json"),"SpriteJSON");k[F]=s.j(X,E);let W=x.transformRequest(Ct(U,D,".png"),"SpriteImage");R[F]=We.getImage(W,E)}return yield Promise.all([...Object.values(k),...Object.values(R)]),function(F,U){return s._(this,void 0,void 0,function*(){let X={};for(let W in F){X[W]={};let Y=B.getImageCanvasContext((yield U[W]).data),Q=(yield F[W]).data;for(let ne in Q){let{width:J,height:oe,x:ae,y:ee,sdf:de,pixelRatio:be,stretchX:ge,stretchY:_e,content:xe,textFitWidth:ke,textFitHeight:Oe}=Q[ne];X[W][ne]={data:null,pixelRatio:be,sdf:de,stretchX:ge,stretchY:_e,content:xe,textFitWidth:ke,textFitHeight:Oe,spriteData:{width:J,height:oe,x:ae,y:ee,context:Y}}}}return X})}(k,R)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(g=>{if(this._spriteRequest=null,g)for(let x in g){this._spritesImagesIds[x]=[];let S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(E=>!(E in g)):[];for(let E of S)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(let E in g[x]){let C=x==="default"?E:`${x}:${E}`;this._spritesImagesIds[x].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,g[x][E],!1):this.imageManager.addImage(C,g[x][E]),l&&(this._changedImages[C]=!0)}}}).catch(g=>{this._spriteRequest=null,p=g,this.fire(new s.k(p))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),d&&d(p)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(e){let l=this.sourceCaches[e.source];if(!l)return;let d=e.sourceLayer;if(!d)return;let p=l.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.k(new Error(`Source layer "${d}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,l=!1){let d=this._serializedAllLayers();if(!e||e.length===0)return Object.values(l?s.bK(d):d);let p=[];for(let g of e)if(d[g]){let x=l?s.bK(d[g]):d[g];p.push(x)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let l=Object.keys(this._layers);for(let d of l){let p=this._layers[d];p.type!=="custom"&&(e[d]=p.serialize())}return e}hasTransitions(){var e,l,d;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((l=this.sky)===null||l===void 0)&&l.hasTransition()||!((d=this.projection)===null||d===void 0)&&d.hasTransition())return!0;for(let p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(let p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let l=this._changed;if(l){let p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(let x in this._updatedSources){let S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let d={};for(let p in this.sourceCaches){let g=this.sourceCaches[p];d[p]=g.used,g.used=!1}for(let p of this._order){let g=this._layers[p];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(let p in d){let g=this.sourceCaches[p];!!d[p]!=!!g.used&&g.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,l&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,l){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,l={}){var d;this._checkLoaded();let p=this.serialize();if(e=l.transformStyle?l.transformStyle(p,e):e,((d=l.validate)===null||d===void 0||d)&&hc(this,s.z(e)))return!1;(e=s.bK(e)).layers=s.bI(e.layers);let g=s.bL(p,e),x=this._getOperationsToPerform(g);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(let S of x.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let l=[],d=[];for(let p of e)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":l.push(()=>this.addLayer.apply(this,p.args));break;case"removeLayer":l.push(()=>this.removeLayer.apply(this,p.args));break;case"setPaintProperty":l.push(()=>this.setPaintProperty.apply(this,p.args));break;case"setLayoutProperty":l.push(()=>this.setLayoutProperty.apply(this,p.args));break;case"setFilter":l.push(()=>this.setFilter.apply(this,p.args));break;case"addSource":l.push(()=>this.addSource.apply(this,p.args));break;case"removeSource":l.push(()=>this.removeSource.apply(this,p.args));break;case"setLayerZoomRange":l.push(()=>this.setLayerZoomRange.apply(this,p.args));break;case"setLight":l.push(()=>this.setLight.apply(this,p.args));break;case"setGeoJSONSourceData":l.push(()=>this.setGeoJSONSourceData.apply(this,p.args));break;case"setGlyphs":l.push(()=>this.setGlyphs.apply(this,p.args));break;case"setSprite":l.push(()=>this.setSprite.apply(this,p.args));break;case"setTerrain":l.push(()=>this.map.setTerrain.apply(this,p.args));break;case"setSky":l.push(()=>this.setSky.apply(this,p.args));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":l.push(()=>this.setGlobalState.apply(this,p.args));break;case"setTransition":l.push(()=>{});break;default:d.push(p.command)}return{operations:l,unimplemented:d}}addImage(e,l){if(this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,l),this._afterImageUpdated(e)}updateImage(e,l){this.imageManager.updateImage(e,l)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,l,d={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(s.z.source,`sources.${e}`,l,null,d))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);let p=this.sourceCaches[e]=new yt(e,l,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e})),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let d in this._layers)if(this._layers[d].source===e)return this.fire(new s.k(new Error(`Source "${e}" cannot be removed while layer "${d}" is using it.`)));let l=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],l.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,l){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let d=this.sourceCaches[e].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(l),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,l,d={}){this._checkLoaded();let p=e.id;if(this.getLayer(p))return void this.fire(new s.k(new Error(`Layer "${p}" already exists on this map.`)));let g;if(e.type==="custom"){if(hc(this,s.bM(e)))return;g=s.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=s.bK(e),e=s.e(e,{source:p})),this._validate(s.z.layer,`layers.${p}`,e,{arrayIndex:-1},d))return;g=s.bJ(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}let x=l?this._order.indexOf(l):this._order.length;if(l&&x===-1)this.fire(new s.k(new Error(`Cannot add layer "${p}" before non-existing layer "${l}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){let S=this._removedLayers[p];delete this._removedLayers[p],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,l){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new s.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===l)return;let d=this._order.indexOf(e);this._order.splice(d,1);let p=l?this._order.indexOf(l):this._order.length;l&&p===-1?this.fire(new s.k(new Error(`Cannot move layer "${e}" before non-existing layer "${l}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let l=this._layers[e];if(!l)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${e}".`)));l.setEventedParent(null);let d=this._order.indexOf(e);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=l,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],l.onRemove&&l.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,l,d){this._checkLoaded();let p=this.getLayer(e);p?p.minzoom===l&&p.maxzoom===d||(l!=null&&(p.minzoom=l),d!=null&&(p.maxzoom=d),this._updateLayer(p)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,l,d={}){this._checkLoaded();let p=this.getLayer(e);if(p){if(!s.bH(p.filter,l))return l==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(s.z.filter,`layers.${p.id}.filter`,l,null,d)||(p.setFilter(s.bK(l)),this._updateLayer(p)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return s.bK(this.getLayer(e).filter)}setLayoutProperty(e,l,d,p={}){this._checkLoaded();let g=this.getLayer(e);g?s.bH(g.getLayoutProperty(l),d)||(g.setLayoutProperty(l,d,p),this._updateLayer(g)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,l){let d=this.getLayer(e);if(d)return d.getLayoutProperty(l);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,l,d,p={}){this._checkLoaded();let g=this.getLayer(e);g?s.bH(g.getPaintProperty(l),d)||(g.setPaintProperty(l,d,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,l){return this.getLayer(e).getPaintProperty(l)}setFeatureState(e,l){this._checkLoaded();let d=e.source,p=e.sourceLayer,g=this.sourceCaches[d];if(g===void 0)return void this.fire(new s.k(new Error(`The source '${d}' does not exist in the map's style.`)));let x=g.getSource().type;x==="geojson"&&p?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,e.id,l)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,l){this._checkLoaded();let d=e.source,p=this.sourceCaches[d];if(p===void 0)return void this.fire(new s.k(new Error(`The source '${d}' does not exist in the map's style.`)));let g=p.getSource().type,x=g==="vector"?e.sourceLayer:void 0;g!=="vector"||x?l&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,e.id,l):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let l=e.source,d=e.sourceLayer,p=this.sourceCaches[l];if(p!==void 0)return p.getSource().type!=="vector"||d?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(d,e.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=s.bN(this.sourceCaches,g=>g.serialize()),l=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,p=this.stylesheet;return s.bO({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:e,layers:l,terrain:d},g=>g!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let l=x=>this._layers[x].type==="fill-extrusion",d={},p=[];for(let x=this._order.length-1;x>=0;x--){let S=this._order[x];if(l(S)){d[S]=x;for(let E of e){let C=E[S];if(C)for(let D of C)p.push(D)}}}p.sort((x,S)=>S.intersectionZ-x.intersectionZ);let g=[];for(let x=this._order.length-1;x>=0;x--){let S=this._order[x];if(l(S))for(let E=p.length-1;E>=0;E--){let C=p[E].feature;if(d[C.layer.id]<x)break;g.push(C),p.pop()}else for(let E of e){let C=E[S];if(C)for(let D of C)g.push(D.feature)}}return g}queryRenderedFeatures(e,l,d){l&&l.filter&&this._validate(s.z.filter,"queryRenderedFeatures.filter",l.filter,null,l);let p={};if(l&&l.layers){if(!(Array.isArray(l.layers)||l.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let C of l.layers){let D=this._layers[C];if(!D)return this.fire(new s.k(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];p[D.source]=!0}}let g=[];l.availableImages=this._availableImages;let x=this._serializedAllLayers(),S=l.layers instanceof Set?l.layers:Array.isArray(l.layers)?new Set(l.layers):null,E=Object.assign(Object.assign({},l),{layers:S});for(let C in this.sourceCaches)l.layers&&!p[C]||g.push(ui(this.sourceCaches[C],this._layers,x,e,E,d,this.map.terrain?(D,k,R)=>this.map.terrain.getElevation(D,k,R):void 0));return this.placement&&g.push(function(C,D,k,R,F,U,X){let W={},Y=U.queryRenderedSymbols(R),Q=[];for(let ne of Object.keys(Y).map(Number))Q.push(X[ne]);Q.sort(Ys);for(let ne of Q){let J=ne.featureIndex.lookupSymbolFeatures(Y[ne.bucketInstanceId],D,ne.bucketIndex,ne.sourceLayerIndex,F.filter,F.layers,F.availableImages,C);for(let oe in J){let ae=W[oe]=W[oe]||[],ee=J[oe];ee.sort((de,be)=>{let ge=ne.featureSortOrder;if(ge){let _e=ge.indexOf(de.featureIndex);return ge.indexOf(be.featureIndex)-_e}return be.featureIndex-de.featureIndex});for(let de of ee)ae.push(de)}}return function(ne,J,oe){for(let ae in ne)for(let ee of ne[ae])Ks(ee,oe[J[ae].source]);return ne}(W,C,k)}(this._layers,x,this.sourceCaches,e,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,l){l&&l.filter&&this._validate(s.z.filter,"querySourceFeatures.filter",l.filter,null,l);let d=this.sourceCaches[e];return d?function(p,g){let x=p.getRenderableIds().map(C=>p.getTileByID(C)),S=[],E={};for(let C=0;C<x.length;C++){let D=x[C],k=D.tileID.canonical.key;E[k]||(E[k]=!0,D.querySourceFeatures(S,g))}return S}(d,l):[]}getLight(){return this.light.getLight()}setLight(e,l={}){this._checkLoaded();let d=this.light.getLight(),p=!1;for(let x in e)if(!s.bH(e[x],d[x])){p=!0;break}if(!p)return;let g={now:B.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,l),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,l={}){this._checkLoaded();let d=this.getSky(),p=!1;if(!e&&!d)return;if(e&&!d)p=!0;else if(!e&&d)p=!0;else for(let x in e)if(!s.bH(e[x],d[x])){p=!0;break}if(!p)return;let g={now:B.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,l),this.sky.updateTransitions(g)}_setProjectionInternal(e){let l=function(d){if(Array.isArray(d)){let p=new cc({type:d});return{projection:p,transform:new el,cameraHelper:new Uf(p)}}switch(d){case"mercator":return{projection:new bt,transform:new Kt,cameraHelper:new ar};case"globe":{let p=new cc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:p,transform:new el,cameraHelper:new Uf(p)}}case"vertical-perspective":return{projection:new Wa,transform:new Ja,cameraHelper:new lr};default:return s.w(`Unknown projection name: ${d}. Falling back to mercator projection.`),{projection:new bt,transform:new Kt,cameraHelper:new ar}}}(e);this.projection=l.projection,this.map.migrateProjection(l.transform,l.cameraHelper);for(let d in this.sourceCaches)this.sourceCaches[d].reload()}_validate(e,l,d,p,g={}){return(!g||g.validate!==!1)&&hc(this,e.call(s.z,s.e({key:l,style:this.serialize(),value:d,styleSpec:s.v},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),To().off(rs,this._rtlPluginLoaded);for(let l in this._layers)this._layers[l].setEventedParent(null);for(let l in this.sourceCaches){let d=this.sourceCaches[l];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let l in this.sourceCaches)this.sourceCaches[l].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,l,d,p,g=!1){let x=!1,S=!1,E={};for(let C of this._order){let D=this._layers[C];if(D.type!=="symbol")continue;if(!E[D.source]){let R=this.sourceCaches[D.source];E[D.source]=R.getRenderableIds(!0).map(F=>R.getTileByID(F)).sort((F,U)=>U.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(U.tileID)?-1:1))}let k=this.crossTileSymbolIndex.addLayer(D,E[D.source],e.center.lng);x=x||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(B.now(),e.zoom))&&(this.pauseablePlacement=new lh(e,this.map.terrain,this._order,g,l,d,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(B.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(let C of this._order){let D=this._layers[C];D.type==="symbol"&&this.placement.updateLayerOpacities(D,E[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(B.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,l){return s._(this,void 0,void 0,function*(){let d=yield this.imageManager.getImages(l.icons);this._updateTilesForChangedImages();let p=this.sourceCaches[l.source];return p&&p.setDependencies(l.tileID.key,l.type,l.icons),d})}getGlyphs(e,l){return s._(this,void 0,void 0,function*(){let d=yield this.glyphManager.getGlyphs(l.stacks),p=this.sourceCaches[l.source];return p&&p.setDependencies(l.tileID.key,l.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,l={}){this._checkLoaded(),e&&this._validate(s.z.glyphs,"glyphs",e,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,l,d={},p){this._checkLoaded();let g=[{id:e,url:l}],x=[..._t(this.stylesheet.sprite),...g];this._validate(s.z.sprite,"sprite",x,null,d)||(this.stylesheet.sprite=x,this._loadSprite(g,!0,p))}removeSprite(e){this._checkLoaded();let l=_t(this.stylesheet.sprite);if(l.find(d=>d.id===e)){if(this._spritesImagesIds[e])for(let d of this._spritesImagesIds[e])this.imageManager.removeImage(d),this._changedImages[d]=!0;l.splice(l.findIndex(d=>d.id===e),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return _t(this.stylesheet.sprite)}setSprite(e,l={},d){this._checkLoaded(),e&&this._validate(s.z.sprite,"sprite",e,null,l)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,d):(this._unloadSprite(),d&&d(null)))}}var m_=s.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class g_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,l,d,p,g,x,S,E,C){this.context=e;let D=this.boundPaintVertexBuffers.length!==p.length;for(let k=0;!D&&k<p.length;k++)this.boundPaintVertexBuffers[k]!==p[k]&&(D=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==d||D||this.boundIndexBuffer!==g||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==C?this.freshBind(l,d,p,g,x,S,E,C):(e.bindVertexArray.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),C&&C.bind())}freshBind(e,l,d,p,g,x,S,E){let C=e.numAttributes,D=this.context,k=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=E,l.enableAttributes(k,e);for(let R of d)R.enableAttributes(k,e);x&&x.enableAttributes(k,e),S&&S.enableAttributes(k,e),E&&E.enableAttributes(k,e),l.bind(),l.setVertexAttribPointers(k,e,g);for(let R of d)R.bind(),R.setVertexAttribPointers(k,e,g);x&&(x.bind(),x.setVertexAttribPointers(k,e,g)),p&&p.bind(),S&&(S.bind(),S.setVertexAttribPointers(k,e,g)),E&&(E.bind(),E.setVertexAttribPointers(k,e,g)),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let dc=(m,e,l,d,p)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:l?l.properties.get("fog-color"):s.bf.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:l?l.calculateFogBlendOpacity(d):0,u_horizon_color:l?l.properties.get("horizon-color"):s.bf.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),ph={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function us(m){let e=[];for(let l=0;l<m.length;l++){if(m[l]===null)continue;let d=m[l].split(" ");e.push(d.pop())}return e}class mh{constructor(e,l,d,p,g,x,S,E,C=[]){let D=e.gl;this.program=D.createProgram();let k=us(l.staticAttributes),R=d?d.getBinderAttributes():[],F=k.concat(R),U=di.prelude.staticUniforms?us(di.prelude.staticUniforms):[],X=S.staticUniforms?us(S.staticUniforms):[],W=l.staticUniforms?us(l.staticUniforms):[],Y=d?d.getBinderUniforms():[],Q=U.concat(X).concat(W).concat(Y),ne=[];for(let ge of Q)ne.indexOf(ge)<0&&ne.push(ge);let J=d?d.defines():[];zi(D)&&J.unshift("#version 300 es"),g&&J.push("#define OVERDRAW_INSPECTOR;"),x&&J.push("#define TERRAIN3D;"),E&&J.push(E),C&&J.push(...C);let oe=J.concat(di.prelude.fragmentSource,S.fragmentSource,l.fragmentSource).join(`
`),ae=J.concat(di.prelude.vertexSource,S.vertexSource,l.vertexSource).join(`
`);zi(D)||(oe=function(ge){return ge.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(oe),ae=function(ge){return ge.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ae));let ee=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(ee,oe),D.compileShader(ee),!D.getShaderParameter(ee,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(ee)}`);D.attachShader(this.program,ee);let de=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(de,ae),D.compileShader(de),!D.getShaderParameter(de,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(de)}`);D.attachShader(this.program,de),this.attributes={};let be={};this.numAttributes=F.length;for(let ge=0;ge<this.numAttributes;ge++)F[ge]&&(D.bindAttribLocation(this.program,ge,F[ge]),this.attributes[F[ge]]=ge);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(de),D.deleteShader(ee);for(let ge=0;ge<ne.length;ge++){let _e=ne[ge];if(_e&&!be[_e]){let xe=D.getUniformLocation(this.program,_e);xe&&(be[_e]=xe)}}this.fixedUniforms=p(e,be),this.terrainUniforms=((ge,_e)=>({u_depth:new s.bP(ge,_e.u_depth),u_terrain:new s.bP(ge,_e.u_terrain),u_terrain_dim:new s.bg(ge,_e.u_terrain_dim),u_terrain_matrix:new s.bR(ge,_e.u_terrain_matrix),u_terrain_unpack:new s.bS(ge,_e.u_terrain_unpack),u_terrain_exaggeration:new s.bg(ge,_e.u_terrain_exaggeration)}))(e,be),this.projectionUniforms=((ge,_e)=>({u_projection_matrix:new s.bR(ge,_e.u_projection_matrix),u_projection_tile_mercator_coords:new s.bS(ge,_e.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bS(ge,_e.u_projection_clipping_plane),u_projection_transition:new s.bg(ge,_e.u_projection_transition),u_projection_fallback_matrix:new s.bR(ge,_e.u_projection_fallback_matrix)}))(e,be),this.binderUniforms=d?d.getUniforms(e,be):[]}draw(e,l,d,p,g,x,S,E,C,D,k,R,F,U,X,W,Y,Q,ne){let J=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(d),e.setStencilMode(p),e.setColorMode(g),e.setCullFace(x),E){e.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,E.depthTexture),e.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,E.texture);for(let ae in this.terrainUniforms)this.terrainUniforms[ae].set(E[ae])}if(C)for(let ae in C)this.projectionUniforms[ph[ae]].set(C[ae]);if(S)for(let ae in this.fixedUniforms)this.fixedUniforms[ae].set(S[ae]);W&&W.setUniforms(e,this.binderUniforms,U,{zoom:X});let oe=0;switch(l){case J.LINES:oe=2;break;case J.TRIANGLES:oe=3;break;case J.LINE_STRIP:oe=1}for(let ae of F.get()){let ee=ae.vaos||(ae.vaos={});(ee[D]||(ee[D]=new g_)).bind(e,this,k,W?W.getPaintVertexBuffers():[],R,ae.vertexOffset,Y,Q,ne),J.drawElements(l,ae.primitiveLength*oe,J.UNSIGNED_SHORT,ae.primitiveOffset*oe*2)}}}function fc(m,e,l){let d=1/s.aC(l,1,e.transform.tileZoom),p=Math.pow(2,l.tileID.overscaledZ),g=l.tileSize*Math.pow(2,e.transform.tileZoom)/p,x=g*(l.tileID.canonical.x+l.tileID.wrap*p),S=g*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[d,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}let pi=(m,e,l,d)=>{let p=m.style.light,g=p.properties.get("position"),x=[g.x,g.y,g.z],S=s.bV();p.properties.get("anchor")==="viewport"&&s.bW(S,m.transform.bearingInRadians),s.bX(x,x,S);let E=m.transform.transformLightDirection(x),C=p.properties.get("color");return{u_lightpos:x,u_lightpos_globe:E,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+e,u_opacity:l,u_fill_translate:d}},__=(m,e,l,d,p,g,x)=>s.e(pi(m,e,l,d),fc(g,m,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),pc=(m,e,l,d)=>s.e(fc(e,m,l),{u_fill_translate:d}),tl=(m,e)=>({u_world:m,u_fill_translate:e}),nl=(m,e,l,d,p)=>s.e(pc(m,e,l,p),{u_world:d}),y_=(m,e,l,d,p)=>{let g=m.transform,x,S,E=0;if(l.paint.get("circle-pitch-alignment")==="map"){let C=s.aC(e,1,g.zoom);x=!0,S=[C,C],E=C/(s.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*p}else x=!1,S=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:E,u_translate:d}},mc=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),v_=m=>({u_viewport_size:[m.width,m.height]}),hs=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),Vf=(m,e,l,d)=>{let p=s.aC(m,1,e)/(s.$*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*d;return{u_extrude_scale:s.aC(m,1,e),u_intensity:l,u_globe_extrude_scale:p}},gh=(m,e,l,d)=>{let p=s.L();s.bY(p,0,m.width,m.height,0,0,1);let g=m.context.gl;return{u_matrix:p,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:l,u_color_ramp:d,u_opacity:e.paint.get("heatmap-opacity")}},x_=(m,e,l)=>{let d=l.paint.get("hillshade-accent-color"),p;switch(l.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}let g=l.getIlluminationProperties();for(let x=0;x<g.directionRadians.length;x++)l.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[x]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:_h(0,e.tileID),u_exaggeration:l.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:d,u_method:p,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Gf=(m,e)=>{let l=e.stride,d=s.L();return s.bY(d,0,s.$,-s.$,0,0,1),s.M(d,d,[0,-s.$,0]),{u_matrix:d,u_image:1,u_dimension:[l,l],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function _h(m,e){let l=Math.pow(2,e.canonical.z),d=e.canonical.y;return[new s.a1(0,d/l).toLngLat().lat,new s.a1(0,(d+1)/l).toLngLat().lat]}let $f=(m,e,l=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:l,u_opacity:m.paint.get("color-relief-opacity")}),gc=(m,e,l,d)=>{let p=m.transform;return{u_translation:vh(m,e,l),u_ratio:d/s.aC(e,1,p.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Hf=(m,e,l,d,p)=>s.e(gc(m,e,l,d),{u_image:0,u_image_height:p}),qf=(m,e,l,d,p)=>{let g=m.transform,x=yh(e,g);return{u_translation:vh(m,e,l),u_texsize:e.imageAtlasTexture.size,u_ratio:d/s.aC(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ds=(m,e,l,d,p,g)=>{let x=m.lineAtlas,S=yh(e,m.transform),E=l.layout.get("line-cap")==="round",C=x.getDash(p.from,E),D=x.getDash(p.to,E),k=C.width*g.fromScale,R=D.width*g.toScale;return s.e(gc(m,e,l,d),{u_patternscale_a:[S/k,-C.height/2],u_patternscale_b:[S/R,-D.height/2],u_sdfgamma:x.width/(256*Math.min(k,R)*m.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:D.y,u_mix:g.t})};function yh(m,e){return 1/s.aC(m,1,e.tileZoom)}function vh(m,e,l){return s.aD(m.transform,e,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}let rl=(m,e,l,d,p)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(x=d.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=d.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:b_(d.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var g,x};function b_(m){m*=Math.PI/180;let e=Math.sin(m),l=Math.cos(m);return[(2*l+1)/3,(-Math.sqrt(3)*e-l+1)/3,(Math.sqrt(3)*e-l+1)/3]}let il=(m,e,l,d,p,g,x,S,E,C,D,k,R)=>{let F=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:F.width/F.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:E,u_is_text:+D,u_pitch_with_map:+d,u_is_along_line:p,u_is_variable_anchor:g,u_texsize:k,u_texture:0,u_translation:C,u_pitched_scale:R}},Zf=(m,e,l,d,p,g,x,S,E,C,D,k,R,F)=>{let U=x.transform;return s.e(il(m,e,l,d,p,g,x,S,E,C,D,k,F),{u_gamma_scale:d?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},w_=(m,e,l,d,p,g,x,S,E,C,D,k,R)=>s.e(Zf(m,e,l,d,p,g,x,S,E,C,!0,D,0,R),{u_texsize_icon:k,u_texture_icon:1}),Wf=(m,e)=>({u_opacity:m,u_color:e}),Xf=(m,e,l,d,p)=>s.e(function(g,x,S,E){let C=S.imageManager.getPattern(g.from.toString()),D=S.imageManager.getPattern(g.to.toString()),{width:k,height:R}=S.imageManager.getPixelSize(),F=Math.pow(2,E.tileID.overscaledZ),U=E.tileSize*Math.pow(2,S.transform.tileZoom)/F,X=U*(E.tileID.canonical.x+E.tileID.wrap*F),W=U*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[k,R],u_mix:x.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/s.aC(E,1,S.transform.tileZoom),u_pixel_coord_upper:[X>>16,W>>16],u_pixel_coord_lower:[65535&X,65535&W]}}(l,p,e,d),{u_opacity:m}),xh=(m,e)=>{},bh={fillExtrusion:(m,e)=>({u_lightpos:new s.bT(m,e.u_lightpos),u_lightpos_globe:new s.bT(m,e.u_lightpos_globe),u_lightintensity:new s.bg(m,e.u_lightintensity),u_lightcolor:new s.bT(m,e.u_lightcolor),u_vertical_gradient:new s.bg(m,e.u_vertical_gradient),u_opacity:new s.bg(m,e.u_opacity),u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new s.bT(m,e.u_lightpos),u_lightpos_globe:new s.bT(m,e.u_lightpos_globe),u_lightintensity:new s.bg(m,e.u_lightintensity),u_lightcolor:new s.bT(m,e.u_lightcolor),u_vertical_gradient:new s.bg(m,e.u_vertical_gradient),u_height_factor:new s.bg(m,e.u_height_factor),u_opacity:new s.bg(m,e.u_opacity),u_fill_translate:new s.bU(m,e.u_fill_translate),u_image:new s.bP(m,e.u_image),u_texsize:new s.bU(m,e.u_texsize),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new s.bP(m,e.u_image),u_texsize:new s.bU(m,e.u_texsize),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade),u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new s.bU(m,e.u_world),u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new s.bU(m,e.u_world),u_image:new s.bP(m,e.u_image),u_texsize:new s.bU(m,e.u_texsize),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade),u_fill_translate:new s.bU(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_scale_with_map:new s.bP(m,e.u_scale_with_map),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_extrude_scale:new s.bU(m,e.u_extrude_scale),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new s.bg(m,e.u_globe_extrude_scale),u_translate:new s.bU(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new s.bU(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new s.bU(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new s.bQ(m,e.u_color),u_overlay:new s.bP(m,e.u_overlay),u_overlay_scale:new s.bg(m,e.u_overlay_scale)}),depth:xh,clippingMask:xh,heatmap:(m,e)=>({u_extrude_scale:new s.bg(m,e.u_extrude_scale),u_intensity:new s.bg(m,e.u_intensity),u_globe_extrude_scale:new s.bg(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new s.bR(m,e.u_matrix),u_world:new s.bU(m,e.u_world),u_image:new s.bP(m,e.u_image),u_color_ramp:new s.bP(m,e.u_color_ramp),u_opacity:new s.bg(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new s.bP(m,e.u_image),u_latrange:new s.bU(m,e.u_latrange),u_exaggeration:new s.bg(m,e.u_exaggeration),u_altitudes:new s.b_(m,e.u_altitudes),u_azimuths:new s.b_(m,e.u_azimuths),u_accent:new s.bQ(m,e.u_accent),u_method:new s.bP(m,e.u_method),u_shadows:new s.bZ(m,e.u_shadows),u_highlights:new s.bZ(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new s.bR(m,e.u_matrix),u_image:new s.bP(m,e.u_image),u_dimension:new s.bU(m,e.u_dimension),u_zoom:new s.bg(m,e.u_zoom),u_unpack:new s.bS(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new s.bP(m,e.u_image),u_unpack:new s.bS(m,e.u_unpack),u_dimension:new s.bU(m,e.u_dimension),u_elevation_stops:new s.bP(m,e.u_elevation_stops),u_color_stops:new s.bP(m,e.u_color_stops),u_color_ramp_size:new s.bP(m,e.u_color_ramp_size),u_opacity:new s.bg(m,e.u_opacity)}),line:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels),u_image:new s.bP(m,e.u_image),u_image_height:new s.bg(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_texsize:new s.bU(m,e.u_texsize),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_image:new s.bP(m,e.u_image),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels),u_patternscale_a:new s.bU(m,e.u_patternscale_a),u_patternscale_b:new s.bU(m,e.u_patternscale_b),u_sdfgamma:new s.bg(m,e.u_sdfgamma),u_image:new s.bP(m,e.u_image),u_tex_y_a:new s.bg(m,e.u_tex_y_a),u_tex_y_b:new s.bg(m,e.u_tex_y_b),u_mix:new s.bg(m,e.u_mix)}),raster:(m,e)=>({u_tl_parent:new s.bU(m,e.u_tl_parent),u_scale_parent:new s.bg(m,e.u_scale_parent),u_buffer_scale:new s.bg(m,e.u_buffer_scale),u_fade_t:new s.bg(m,e.u_fade_t),u_opacity:new s.bg(m,e.u_opacity),u_image0:new s.bP(m,e.u_image0),u_image1:new s.bP(m,e.u_image1),u_brightness_low:new s.bg(m,e.u_brightness_low),u_brightness_high:new s.bg(m,e.u_brightness_high),u_saturation_factor:new s.bg(m,e.u_saturation_factor),u_contrast_factor:new s.bg(m,e.u_contrast_factor),u_spin_weights:new s.bT(m,e.u_spin_weights),u_coords_top:new s.bS(m,e.u_coords_top),u_coords_bottom:new s.bS(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new s.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(m,e.u_is_size_feature_constant),u_size_t:new s.bg(m,e.u_size_t),u_size:new s.bg(m,e.u_size),u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_pitch:new s.bg(m,e.u_pitch),u_rotate_symbol:new s.bP(m,e.u_rotate_symbol),u_aspect_ratio:new s.bg(m,e.u_aspect_ratio),u_fade_change:new s.bg(m,e.u_fade_change),u_label_plane_matrix:new s.bR(m,e.u_label_plane_matrix),u_coord_matrix:new s.bR(m,e.u_coord_matrix),u_is_text:new s.bP(m,e.u_is_text),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_is_along_line:new s.bP(m,e.u_is_along_line),u_is_variable_anchor:new s.bP(m,e.u_is_variable_anchor),u_texsize:new s.bU(m,e.u_texsize),u_texture:new s.bP(m,e.u_texture),u_translation:new s.bU(m,e.u_translation),u_pitched_scale:new s.bg(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new s.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(m,e.u_is_size_feature_constant),u_size_t:new s.bg(m,e.u_size_t),u_size:new s.bg(m,e.u_size),u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_pitch:new s.bg(m,e.u_pitch),u_rotate_symbol:new s.bP(m,e.u_rotate_symbol),u_aspect_ratio:new s.bg(m,e.u_aspect_ratio),u_fade_change:new s.bg(m,e.u_fade_change),u_label_plane_matrix:new s.bR(m,e.u_label_plane_matrix),u_coord_matrix:new s.bR(m,e.u_coord_matrix),u_is_text:new s.bP(m,e.u_is_text),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_is_along_line:new s.bP(m,e.u_is_along_line),u_is_variable_anchor:new s.bP(m,e.u_is_variable_anchor),u_texsize:new s.bU(m,e.u_texsize),u_texture:new s.bP(m,e.u_texture),u_gamma_scale:new s.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_is_halo:new s.bP(m,e.u_is_halo),u_translation:new s.bU(m,e.u_translation),u_pitched_scale:new s.bg(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new s.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(m,e.u_is_size_feature_constant),u_size_t:new s.bg(m,e.u_size_t),u_size:new s.bg(m,e.u_size),u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_pitch:new s.bg(m,e.u_pitch),u_rotate_symbol:new s.bP(m,e.u_rotate_symbol),u_aspect_ratio:new s.bg(m,e.u_aspect_ratio),u_fade_change:new s.bg(m,e.u_fade_change),u_label_plane_matrix:new s.bR(m,e.u_label_plane_matrix),u_coord_matrix:new s.bR(m,e.u_coord_matrix),u_is_text:new s.bP(m,e.u_is_text),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_is_along_line:new s.bP(m,e.u_is_along_line),u_is_variable_anchor:new s.bP(m,e.u_is_variable_anchor),u_texsize:new s.bU(m,e.u_texsize),u_texsize_icon:new s.bU(m,e.u_texsize_icon),u_texture:new s.bP(m,e.u_texture),u_texture_icon:new s.bP(m,e.u_texture_icon),u_gamma_scale:new s.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_is_halo:new s.bP(m,e.u_is_halo),u_translation:new s.bU(m,e.u_translation),u_pitched_scale:new s.bg(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new s.bg(m,e.u_opacity),u_color:new s.bQ(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new s.bg(m,e.u_opacity),u_image:new s.bP(m,e.u_image),u_pattern_tl_a:new s.bU(m,e.u_pattern_tl_a),u_pattern_br_a:new s.bU(m,e.u_pattern_br_a),u_pattern_tl_b:new s.bU(m,e.u_pattern_tl_b),u_pattern_br_b:new s.bU(m,e.u_pattern_br_b),u_texsize:new s.bU(m,e.u_texsize),u_mix:new s.bg(m,e.u_mix),u_pattern_size_a:new s.bU(m,e.u_pattern_size_a),u_pattern_size_b:new s.bU(m,e.u_pattern_size_b),u_scale_a:new s.bg(m,e.u_scale_a),u_scale_b:new s.bg(m,e.u_scale_b),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bg(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new s.bP(m,e.u_texture),u_ele_delta:new s.bg(m,e.u_ele_delta),u_fog_matrix:new s.bR(m,e.u_fog_matrix),u_fog_color:new s.bQ(m,e.u_fog_color),u_fog_ground_blend:new s.bg(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bg(m,e.u_fog_ground_blend_opacity),u_horizon_color:new s.bQ(m,e.u_horizon_color),u_horizon_fog_blend:new s.bg(m,e.u_horizon_fog_blend),u_is_globe_mode:new s.bg(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new s.bg(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new s.bP(m,e.u_texture),u_terrain_coords_id:new s.bg(m,e.u_terrain_coords_id),u_ele_delta:new s.bg(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new s.bg(m,e.u_input),u_output_expected:new s.bg(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new s.bT(m,e.u_sun_pos),u_atmosphere_blend:new s.bg(m,e.u_atmosphere_blend),u_globe_position:new s.bT(m,e.u_globe_position),u_globe_radius:new s.bg(m,e.u_globe_radius),u_inv_proj_matrix:new s.bR(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new s.bQ(m,e.u_sky_color),u_horizon_color:new s.bQ(m,e.u_horizon_color),u_horizon:new s.bU(m,e.u_horizon),u_horizon_normal:new s.bU(m,e.u_horizon_normal),u_sky_horizon_blend:new s.bg(m,e.u_sky_horizon_blend),u_sky_blend:new s.bg(m,e.u_sky_blend)})};class Yf{constructor(e,l,d){this.context=e;let p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let _c={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class eo{constructor(e,l,d,p){this.length=l.length,this.attributes=d,this.itemSize=l.bytesPerElement,this.dynamicDraw=p,this.context=e;let g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,l){for(let d=0;d<this.attributes.length;d++){let p=l.attributes[this.attributes[d].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,l,d){for(let p=0;p<this.attributes.length;p++){let g=this.attributes[p],x=l.attributes[g.name];x!==void 0&&e.vertexAttribPointer(x,g.components,e[_c[g.type]],!1,this.itemSize,g.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Lt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wh extends Lt{getDefault(){return s.bf.transparent}set(e){let l=this.current;(e.r!==l.r||e.g!==l.g||e.b!==l.b||e.a!==l.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Mh extends Lt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Kf extends Lt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Sh extends Lt{getDefault(){return[!0,!0,!0,!0]}set(e){let l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||e[3]!==l[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class fs extends Lt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Eh extends Lt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class M_ extends Lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let l=this.current;(e.func!==l.func||e.ref!==l.ref||e.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class S_ extends Lt{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class E_ extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;e?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=e,this.dirty=!1}}class I_ extends Lt{getDefault(){return[0,1]}set(e){let l=this.current;(e[0]!==l[0]||e[1]!==l[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Qf extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;e?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=e,this.dirty=!1}}class T_ extends Lt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Jf extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;e?l.enable(l.BLEND):l.disable(l.BLEND),this.current=e,this.dirty=!1}}class yc extends Lt{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let l=this.current;(e[0]!==l[0]||e[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class vc extends Lt{getDefault(){return s.bf.transparent}set(e){let l=this.current;(e.r!==l.r||e.g!==l.g||e.b!==l.b||e.a!==l.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class xc extends Lt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ih extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;e?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=e,this.dirty=!1}}class ps extends Lt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ol extends Lt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ca extends Lt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Yr extends Lt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ep extends Lt{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||e[3]!==l[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class tp extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Th extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ms extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;l.bindTexture(l.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class bc extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class wc extends Lt{getDefault(){return null}set(e){let l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class sl extends Lt{getDefault(){return null}set(e){var l;if(e===this.current&&!this.dirty)return;let d=this.gl;zi(d)?d.bindVertexArray(e):(l=d.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Mc extends Lt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class np extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ua extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class No extends Lt{constructor(e,l){super(e),this.context=e,this.parent=l}getDefault(){return null}}class rp extends No{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ch extends No{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Et extends No{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let al="Framebuffer is not complete";class C_{constructor(e,l,d,p,g){this.context=e,this.width=l,this.height=d;let x=e.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new rp(e,S),p)this.depthAttachment=g?new Et(e,S):new Ch(e,S);else if(g)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(al)}destroy(){let e=this.context.gl,l=this.colorAttachment.get();if(l&&e.deleteTexture(l),this.depthAttachment){let d=this.depthAttachment.get();d&&e.deleteRenderbuffer(d)}e.deleteFramebuffer(this.framebuffer)}}class ip{constructor(e){var l,d;if(this.gl=e,this.clearColor=new wh(this),this.clearDepth=new Mh(this),this.clearStencil=new Kf(this),this.colorMask=new Sh(this),this.depthMask=new fs(this),this.stencilMask=new Eh(this),this.stencilFunc=new M_(this),this.stencilOp=new S_(this),this.stencilTest=new E_(this),this.depthRange=new I_(this),this.depthTest=new Qf(this),this.depthFunc=new T_(this),this.blend=new Jf(this),this.blendFunc=new yc(this),this.blendColor=new vc(this),this.blendEquation=new xc(this),this.cullFace=new Ih(this),this.cullFaceSide=new ps(this),this.frontFace=new ol(this),this.program=new ca(this),this.activeTexture=new Yr(this),this.viewport=new ep(this),this.bindFramebuffer=new tp(this),this.bindRenderbuffer=new Th(this),this.bindTexture=new ms(this),this.bindVertexBuffer=new bc(this),this.bindElementBuffer=new wc(this),this.bindVertexArray=new sl(this),this.pixelStoreUnpack=new Mc(this),this.pixelStoreUnpackPremultiplyAlpha=new np(this),this.pixelStoreUnpackFlipY=new ua(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),zi(e)){this.HALF_FLOAT=e.HALF_FLOAT;let p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=e.RGBA16F)!==null&&l!==void 0?l:p?.RGBA16F_EXT,this.RGB16F=(d=e.RGB16F)!==null&&d!==void 0?d:p?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,l){return new Yf(this,e,l)}createVertexBuffer(e,l,d){return new eo(this,e,l,d)}createRenderbuffer(e,l,d){let p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,e,l,d),this.bindRenderbuffer.set(null),g}createFramebuffer(e,l,d,p){return new C_(this,e,l,d,p)}clear({color:e,depth:l,stencil:d}){let p=this.gl,g=0;e&&(g|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(g|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),d!==void 0&&(g|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),p.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){s.bH(e.blendFunction,on.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return zi(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var l;return zi(this.gl)?this.gl.deleteVertexArray(e):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Lo;function op(m,e,l,d,p){let g=m.context,x=m.transform,S=g.gl,E=m.useProgram("collisionBox"),C=[],D=0,k=0;for(let Y=0;Y<d.length;Y++){let Q=d[Y],ne=e.getTile(Q).getBucket(l);if(!ne)continue;let J=p?ne.textCollisionBox:ne.iconCollisionBox,oe=ne.collisionCircleArray;oe.length>0&&(C.push({circleArray:oe,circleOffset:k,coord:Q}),D+=oe.length/4,k=D),J&&E.draw(g,S.LINES,ct.disabled,kt.disabled,m.colorModeForRenderPass(),nt.disabled,mc(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),x.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),l.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,null,m.transform.zoom,null,null,J.collisionVertexBuffer)}if(!p||!C.length)return;let R=m.useProgram("collisionCircle"),F=new s.b$;F.resize(4*D),F._trim();let U=0;for(let Y of C)for(let Q=0;Q<Y.circleArray.length/4;Q++){let ne=4*Q,J=Y.circleArray[ne+0],oe=Y.circleArray[ne+1],ae=Y.circleArray[ne+2],ee=Y.circleArray[ne+3];F.emplace(U++,J,oe,ae,ee,0),F.emplace(U++,J,oe,ae,ee,1),F.emplace(U++,J,oe,ae,ee,2),F.emplace(U++,J,oe,ae,ee,3)}(!Lo||Lo.length<2*D)&&(Lo=function(Y){let Q=2*Y,ne=new s.c1;ne.resize(Q),ne._trim();for(let J=0;J<Q;J++){let oe=6*J;ne.uint16[oe+0]=4*J+0,ne.uint16[oe+1]=4*J+1,ne.uint16[oe+2]=4*J+2,ne.uint16[oe+3]=4*J+2,ne.uint16[oe+4]=4*J+3,ne.uint16[oe+5]=4*J+0}return ne}(D));let X=g.createIndexBuffer(Lo,!0),W=g.createVertexBuffer(F,s.c0.members,!0);for(let Y of C){let Q=v_(m.transform);R.draw(g,S.TRIANGLES,ct.disabled,kt.disabled,m.colorModeForRenderPass(),nt.disabled,Q,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),null,l.id,W,X,s.aM.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}W.destroy(),X.destroy()}let P_=s.ag(new Float32Array(16));function sp(m,e,l,d,p,g){let{horizontalAlign:x,verticalAlign:S}=s.aH(m);return new s.P((-(x-.5)*e/p+d[0])*g,(-(S-.5)*l/p+d[1])*g)}function D_(m,e,l,d,p,g){let x=e.tileAnchorPoint.add(new s.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=d.mult(g);l||(S=S.rotate(-p));let E=x.add(S);return In(E.x,E.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(l){let S=Kn(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),E=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return m.add(d.rotate(E))}return m.add(d)}function Ph(m,e,l,d,p,g,x,S,E,C,D,k){let R=m.text.placedSymbolArray,F=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,X={};F.clear();for(let W=0;W<R.length;W++){let Y=R.get(W),Q=Y.hidden||!Y.crossTileID||m.allowVerticalPlacement&&!Y.placedOrientation?null:d[Y.crossTileID];if(Q){let ne=new s.P(Y.anchorX,Y.anchorY),J={getElevation:k,width:p.width,height:p.height,pitchedLabelPlaneMatrix:g,pitchWithMap:l,transform:p,tileAnchorPoint:ne,translation:C,unwrappedTileID:D},oe=l?Po(ne.x,ne.y,J):Kn(ne.x,ne.y,J),ae=Ne(p.cameraToCenterDistance,oe.signedDistanceFromCamera),ee=s.ap(m.textSizeData,S,Y)*ae/s.aB;l&&(ee*=m.tilePixelRatio/x);let{width:de,height:be,anchor:ge,textOffset:_e,textBoxScale:xe}=Q,ke=sp(ge,de,be,_e,xe,ee),Oe=p.getPitchedTextCorrection(ne.x+C[0],ne.y+C[1],D),Ce=D_(oe.point,J,e,ke,-p.bearingInRadians,Oe),qe=m.allowVerticalPlacement&&Y.placedOrientation===s.ao.vertical?Math.PI/2:0;for(let ft=0;ft<Y.numGlyphs;ft++)s.av(F,Ce,qe);E&&Y.associatedIconIndex>=0&&(X[Y.associatedIconIndex]={shiftedAnchor:Ce,angle:qe})}else Fi(Y.numGlyphs,F)}if(E){U.clear();let W=m.icon.placedSymbolArray;for(let Y=0;Y<W.length;Y++){let Q=W.get(Y);if(Q.hidden)Fi(Q.numGlyphs,U);else{let ne=X[Y];if(ne)for(let J=0;J<Q.numGlyphs;J++)s.av(U,ne.shiftedAnchor,ne.angle);else Fi(Q.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(F)}function Sc(m,e,l){return l.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function ll(m,e,l,d,p,g,x,S,E,C,D,k,R){let F=m.context,U=F.gl,X=m.transform,W=S==="map",Y=E==="map",Q=S!=="viewport"&&l.layout.get("symbol-placement")!=="point",ne=W&&!Y&&!Q,J=!l.layout.get("symbol-sort-key").isConstant(),oe=!1,ae=m.getDepthModeForSublayer(0,ct.ReadOnly),ee=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),de=[],be=X.getCircleRadiusCorrection();for(let ge of d){let _e=e.getTile(ge),xe=_e.getBucket(l);if(!xe)continue;let ke=p?xe.text:xe.icon;if(!ke||!ke.segments.get().length||!ke.hasVisibleVertices)continue;let Oe=ke.programConfigurations.get(l.id),Ce=p||xe.sdfIcons,qe=p?xe.textSizeData:xe.iconSizeData,ft=Y||X.pitch!==0,Ot=m.useProgram(Sc(Ce,p,xe),Oe),Zt=s.an(qe,X.zoom),$t=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ge),ln,fn,ht,Wt,Cn=[0,0],On=null;if(p)fn=_e.glyphAtlasTexture,ht=U.LINEAR,ln=_e.glyphAtlasTexture.size,xe.iconsInText&&(Cn=_e.imageAtlasTexture.size,On=_e.imageAtlasTexture,Wt=ft||m.options.rotating||m.options.zooming||qe.kind==="composite"||qe.kind==="camera"?U.LINEAR:U.NEAREST);else{let Pn=l.layout.get("icon-size").constantOr(0)!==1||xe.iconsNeedLinear;fn=_e.imageAtlasTexture,ht=Ce||m.options.rotating||m.options.zooming||Pn||ft?U.LINEAR:U.NEAREST,ln=_e.imageAtlasTexture.size}let Vn=s.aC(_e,1,m.transform.zoom),xr=wn(W,m.transform,Vn),xi=s.L();s.aq(xi,xr);let Fo=St(Y,W,m.transform,Vn),zo=s.aD(X,_e,g,x),wa=X.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ma=ee&&xe.hasTextData(),ws=l.layout.get("icon-text-fit")!=="none"&&Ma&&xe.hasIconData();if(Q){let Pn=m.style.map.terrain?(Jr,Dn)=>m.style.map.terrain.getElevation(ge,Jr,Dn):null,Fn=l.layout.get("text-rotation-alignment")==="map";hn(xe,m,p,xr,xi,Y,C,Fn,ge.toUnwrapped(),X.width,X.height,zo,Pn)}let Ms=p&&ee||ws,Ar=Q||Ms?P_:Y?xr:m.transform.clipSpaceToPixelsMatrix,bi=Ce&&l.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0,br;br=Ce?xe.iconsInText?w_(qe.kind,Zt,ne,Y,Q,Ms,m,Ar,Fo,zo,ln,Cn,be):Zf(qe.kind,Zt,ne,Y,Q,Ms,m,Ar,Fo,zo,p,ln,0,be):il(qe.kind,Zt,ne,Y,Q,Ms,m,Ar,Fo,zo,p,ln,be);let jo={program:Ot,buffers:ke,uniformValues:br,projectionData:wa,atlasTexture:fn,atlasTextureIcon:On,atlasInterpolation:ht,atlasInterpolationIcon:Wt,isSDF:Ce,hasHalo:bi};if(J&&xe.canOverlap){oe=!0;let Pn=ke.segments.get();for(let Fn of Pn)de.push({segments:new s.aM([Fn]),sortKey:Fn.sortKey,state:jo,terrainData:$t})}else de.push({segments:ke.segments,sortKey:0,state:jo,terrainData:$t})}oe&&de.sort((ge,_e)=>ge.sortKey-_e.sortKey);for(let ge of de){let _e=ge.state;if(F.activeTexture.set(U.TEXTURE0),_e.atlasTexture.bind(_e.atlasInterpolation,U.CLAMP_TO_EDGE),_e.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),_e.atlasTextureIcon&&_e.atlasTextureIcon.bind(_e.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),_e.isSDF){let xe=_e.uniformValues;_e.hasHalo&&(xe.u_is_halo=1,cl(_e.buffers,ge.segments,l,m,_e.program,ae,D,k,xe,_e.projectionData,ge.terrainData)),xe.u_is_halo=0}cl(_e.buffers,ge.segments,l,m,_e.program,ae,D,k,_e.uniformValues,_e.projectionData,ge.terrainData)}}function cl(m,e,l,d,p,g,x,S,E,C,D){let k=d.context;p.draw(k,k.gl.TRIANGLES,g,x,S,nt.backCCW,E,D,C,l.id,m.layoutVertexBuffer,m.indexBuffer,e,l.paint,d.transform.zoom,m.programConfigurations.get(l.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Dh(m,e,l,d,p){let g=m.context,x=g.gl,S=kt.disabled,E=new on([x.ONE,x.ONE],s.bf.transparent,[!0,!0,!0,!0]),C=e.getBucket(l);if(!C)return;let D=d.key,k=l.heatmapFbos.get(D);k||(k=ul(g,e.tileSize,e.tileSize),l.heatmapFbos.set(D,k)),g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:s.bf.transparent});let R=C.programConfigurations.get(l.id),F=m.useProgram("heatmap",R,!p),U=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=m.style.map.terrain.getTerrainData(d);F.draw(g,x.TRIANGLES,ct.disabled,S,E,nt.disabled,Vf(e,m.transform.zoom,l.paint.get("heatmap-intensity"),1),X,U,l.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,l.paint,m.transform.zoom,R)}function ap(m,e,l,d,p){let g=m.context,x=g.gl,S=m.transform;g.setColorMode(m.colorModeForRenderPass());let E=hl(g,e),C=l.key,D=e.heatmapFbos.get(C);if(!D)return;g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,D.colorAttachment.get()),g.activeTexture.set(x.TEXTURE1),E.bind(x.LINEAR,x.CLAMP_TO_EDGE);let k=S.getProjectionData({overscaledTileID:l,applyTerrainMatrix:p,applyGlobeMatrix:!d});m.useProgram("heatmapTexture").draw(g,x.TRIANGLES,ct.disabled,kt.disabled,m.colorModeForRenderPass(),nt.disabled,gh(m,e,0,1),null,k,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,S.zoom),D.destroy(),e.heatmapFbos.delete(C)}function ul(m,e,l){var d,p;let g=m.gl,x=g.createTexture();g.bindTexture(g.TEXTURE_2D,x),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);let S=(d=m.HALF_FLOAT)!==null&&d!==void 0?d:g.UNSIGNED_BYTE,E=(p=m.RGBA16F)!==null&&p!==void 0?p:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,E,e,l,0,g.RGBA,S,null);let C=m.createFramebuffer(e,l,!1,!1);return C.colorAttachment.set(x),C}function hl(m,e){return e.colorRampTexture||(e.colorRampTexture=new s.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function dl(m,e,l,d,p){if(!l||!d||!d.imageAtlas)return;let g=d.imageAtlas.patternPositions,x=g[l.to.toString()],S=g[l.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){let E=p.getPaintProperty(e);x=g[E],S=g[E]}x&&S&&m.setConstantPatternPositions(x,S)}function Ec(m,e,l,d,p,g,x,S){let E=m.context.gl,C="fill-pattern",D=l.paint.get(C),k=D&&D.constantOr(1),R=l.getCrossfadeParameters(),F,U,X,W,Y,Q=m.transform,ne=l.paint.get("fill-translate"),J=l.paint.get("fill-translate-anchor");x?(U=k&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=E.LINES):(U=k?"fillPattern":"fill",F=E.TRIANGLES);let oe=D.constantOr(null);for(let ae of d){let ee=e.getTile(ae);if(k&&!ee.patternsLoaded())continue;let de=ee.getBucket(l);if(!de)continue;let be=de.programConfigurations.get(l.id),ge=m.useProgram(U,be),_e=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ae);k&&(m.context.activeTexture.set(E.TEXTURE0),ee.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),be.updatePaintBuffers(R)),dl(be,C,oe,ee,l);let xe=Q.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),ke=s.aD(Q,ee,ne,J);if(x){W=de.indexBuffer2,Y=de.segments2;let Ce=[E.drawingBufferWidth,E.drawingBufferHeight];X=U==="fillOutlinePattern"&&k?nl(m,R,ee,Ce,ke):tl(Ce,ke)}else W=de.indexBuffer,Y=de.segments,X=k?pc(m,R,ee,ke):{u_fill_translate:ke};let Oe=m.stencilModeForClipping(ae);ge.draw(m.context,F,p,Oe,g,nt.backCCW,X,_e,xe,l.id,de.layoutVertexBuffer,W,Y,l.paint,m.transform.zoom,be)}}function Ah(m,e,l,d,p,g,x,S){let E=m.context,C=E.gl,D="fill-extrusion-pattern",k=l.paint.get(D),R=k.constantOr(1),F=l.getCrossfadeParameters(),U=l.paint.get("fill-extrusion-opacity"),X=k.constantOr(null),W=m.transform;for(let Y of d){let Q=e.getTile(Y),ne=Q.getBucket(l);if(!ne)continue;let J=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),oe=ne.programConfigurations.get(l.id),ae=m.useProgram(R?"fillExtrusionPattern":"fillExtrusion",oe);R&&(m.context.activeTexture.set(C.TEXTURE0),Q.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),oe.updatePaintBuffers(F));let ee=W.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!S,applyTerrainMatrix:!0});dl(oe,D,X,Q,l);let de=s.aD(W,Q,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),be=l.paint.get("fill-extrusion-vertical-gradient"),ge=R?__(m,be,U,de,Y,F,Q):pi(m,be,U,de);ae.draw(E,E.gl.TRIANGLES,p,g,x,nt.backCCW,ge,J,ee,l.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,l.paint,m.transform.zoom,oe,m.style.map.terrain&&ne.centroidVertexBuffer)}}function gs(m,e,l,d,p,g,x,S,E){var C;let D=m.style.projection,k=m.context,R=m.transform,F=k.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${l.paint.get("hillshade-highlight-color").values.length}`],X=m.useProgram("hillshade",null,!1,U),W=!m.options.moving;for(let Y of d){let Q=e.getTile(Y),ne=Q.fbo;if(!ne)continue;let J=D.getMeshFromTileID(k,Y.canonical,S,!0,"raster"),oe=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(Y);k.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,ne.colorAttachment.get());let ae=R.getProjectionData({overscaledTileID:Y,aligned:W,applyGlobeMatrix:!E,applyTerrainMatrix:!0});X.draw(k,F.TRIANGLES,g,p[Y.overscaledZ],x,nt.backCCW,x_(m,Q,l),oe,ae,l.id,J.vertexBuffer,J.indexBuffer,J.segments)}}function Rh(m,e,l,d,p,g,x,S,E){var C;let D=m.style.projection,k=m.context,R=m.transform,F=k.gl,U=m.useProgram("colorRelief"),X=!m.options.moving,W=!0,Y=0;for(let Q of d){let ne=e.getTile(Q),J=ne.dem;if(W){let ge=F.getParameter(F.MAX_TEXTURE_SIZE),{elevationTexture:_e,colorTexture:xe}=l.getColorRampTextures(k,ge,J.getUnpackVector());k.activeTexture.set(F.TEXTURE1),_e.bind(F.NEAREST,F.CLAMP_TO_EDGE),k.activeTexture.set(F.TEXTURE4),xe.bind(F.LINEAR,F.CLAMP_TO_EDGE),W=!1,Y=_e.size[0]}if(!J||!J.data)continue;let oe=J.stride,ae=J.getPixels();if(k.activeTexture.set(F.TEXTURE0),k.pixelStoreUnpackPremultiplyAlpha.set(!1),ne.demTexture=ne.demTexture||m.getTileTexture(oe),ne.demTexture){let ge=ne.demTexture;ge.update(ae,{premultiply:!1}),ge.bind(F.LINEAR,F.CLAMP_TO_EDGE)}else ne.demTexture=new s.T(k,ae,F.RGBA,{premultiply:!1}),ne.demTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let ee=D.getMeshFromTileID(k,Q.canonical,S,!0,"raster"),de=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(Q),be=R.getProjectionData({overscaledTileID:Q,aligned:X,applyGlobeMatrix:!E,applyTerrainMatrix:!0});U.draw(k,F.TRIANGLES,g,p[Q.overscaledZ],x,nt.backCCW,$f(l,ne.dem,Y),de,be,l.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}let Ic=[new s.P(0,0),new s.P(s.$,0),new s.P(s.$,s.$),new s.P(0,s.$)];function _s(m,e,l,d,p,g,x,S,E=!1,C=!1){let D=d[d.length-1].overscaledZ,k=m.context,R=k.gl,F=m.useProgram("raster"),U=m.transform,X=m.style.projection,W=m.colorModeForRenderPass(),Y=!m.options.moving;for(let Q of d){let ne=m.getDepthModeForSublayer(Q.overscaledZ-D,l.paint.get("raster-opacity")===1?ct.ReadWrite:ct.ReadOnly,R.LESS),J=e.getTile(Q);J.registerFadeDuration(l.paint.get("raster-fade-duration"));let oe=e.findLoadedParent(Q,0),ae=e.findLoadedSibling(Q),ee=kh(J,oe||ae||null,e,l,m.transform,m.style.map.terrain),de,be,ge=l.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;k.activeTexture.set(R.TEXTURE0),J.texture.bind(ge,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(R.TEXTURE1),oe?(oe.texture.bind(ge,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),de=Math.pow(2,oe.tileID.overscaledZ-J.tileID.overscaledZ),be=[J.tileID.canonical.x*de%1,J.tileID.canonical.y*de%1]):J.texture.bind(ge,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),J.texture.useMipmap&&k.extTextureFilterAnisotropic&&m.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);let _e=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),xe=U.getProjectionData({overscaledTileID:Q,aligned:Y,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),ke=rl(be||[0,0],de||1,ee,l,S),Oe=X.getMeshFromTileID(k,Q.canonical,g,x,"raster");F.draw(k,R.TRIANGLES,ne,p?p[Q.overscaledZ]:kt.disabled,W,E?nt.frontCCW:nt.backCCW,ke,_e,xe,l.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}}function kh(m,e,l,d,p,g){let x=d.paint.get("raster-fade-duration");if(!g&&x>0){let S=B.now(),E=(S-m.timeAdded)/x,C=e?(S-e.timeAdded)/x:-1,D=l.getSource(),k=Xe(p,{tileSize:D.tileSize,roundZoom:D.roundZoom}),R=!e||Math.abs(e.tileID.overscaledZ-k)>Math.abs(m.tileID.overscaledZ-k),F=R&&m.refreshedUponExpiration?1:s.ah(R?E:1-C,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}let lp=new s.bf(1,0,0,1),cp=new s.bf(0,1,0,1),Tc=new s.bf(0,0,1,1),Nh=new s.bf(1,0,1,1),A_=new s.bf(0,1,1,1);function Lh(m,e,l,d){Ui(m,0,e+l/2,m.transform.width,l,d)}function dn(m,e,l,d){Ui(m,e-l/2,0,l,m.transform.height,d)}function Ui(m,e,l,d,p,g){let x=m.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*m.pixelRatio,l*m.pixelRatio,d*m.pixelRatio,p*m.pixelRatio),x.clear({color:g}),S.disable(S.SCISSOR_TEST)}function Kr(m,e,l){let d=m.context,p=d.gl,g=m.useProgram("debug"),x=ct.disabled,S=kt.disabled,E=m.colorModeForRenderPass(),C="$debug",D=m.style.map.terrain&&m.style.map.terrain.getTerrainData(l);d.activeTexture.set(p.TEXTURE0);let k=e.getTileByID(l.key).latestRawTileData,R=Math.floor((k&&k.byteLength||0)/1024),F=e.getTile(l).tileSize,U=512/Math.min(F,512)*(l.overscaledZ/m.transform.zoom)*.5,X=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(X+=` => ${l.overscaledZ}`),function(Y,Q){Y.initDebugOverlayCanvas();let ne=Y.debugOverlayCanvas,J=Y.context.gl,oe=Y.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,ne.width,ne.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(Q,5,5),oe.strokeText(Q,5,5),Y.debugOverlayTexture.update(ne),Y.debugOverlayTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE)}(m,`${X} ${R}kB`);let W=m.transform.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(d,p.TRIANGLES,x,S,on.alphaBlended,nt.disabled,hs(s.bf.transparent,U),null,W,C,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(d,p.LINE_STRIP,x,S,E,nt.disabled,hs(s.bf.red),D,W,C,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Cc(m,e,l,d){let{isRenderingGlobe:p}=d,g=m.context,x=g.gl,S=m.transform,E=m.colorModeForRenderPass(),C=m.getDepthModeFor3D(),D=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(let k of l){let R=e.getTerrainMesh(k.tileID),F=m.renderToTexture.getTexture(k),U=e.getTerrainData(k.tileID);g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,F.texture);let X=e.getMeshFrameDelta(S.zoom),W=S.calculateFogMatrix(k.tileID.toUnwrapped()),Y=dc(X,W,m.style.sky,S.pitch,p),Q=S.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(g,x.TRIANGLES,C,kt.disabled,E,nt.backCCW,Y,U,Q,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}function fl(m,e){if(!e.mesh){let l=new s.aL;l.emplaceBack(-1,-1),l.emplaceBack(1,-1),l.emplaceBack(1,1),l.emplaceBack(-1,1);let d=new s.aN;d.emplaceBack(0,1,2),d.emplaceBack(0,2,3),e.mesh=new os(m.createVertexBuffer(l,ko.members),m.createIndexBuffer(d),s.aM.simpleSegment(0,0,l.length,d.length))}return e.mesh}class up{constructor(e,l){this.context=new ip(e),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=yt.maxUnderzooming+yt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new oa}resize(e,l,d){if(this.width=Math.floor(e*d),this.height=Math.floor(l*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style._order)this.style._layers[p].resize()}setup(){let e=this.context,l=new s.aL;l.emplaceBack(0,0),l.emplaceBack(s.$,0),l.emplaceBack(0,s.$),l.emplaceBack(s.$,s.$),this.tileExtentBuffer=e.createVertexBuffer(l,ko.members),this.tileExtentSegments=s.aM.simpleSegment(0,0,4,2);let d=new s.aL;d.emplaceBack(0,0),d.emplaceBack(s.$,0),d.emplaceBack(0,s.$),d.emplaceBack(s.$,s.$),this.debugBuffer=e.createVertexBuffer(d,ko.members),this.debugSegments=s.aM.simpleSegment(0,0,4,5);let p=new s.c6;p.emplaceBack(0,0,0,0),p.emplaceBack(s.$,0,s.$,0),p.emplaceBack(0,s.$,0,s.$),p.emplaceBack(s.$,s.$,s.$,s.$),this.rasterBoundsBuffer=e.createVertexBuffer(p,m_.members),this.rasterBoundsSegments=s.aM.simpleSegment(0,0,4,2);let g=new s.aL;g.emplaceBack(0,0),g.emplaceBack(s.$,0),g.emplaceBack(0,s.$),g.emplaceBack(s.$,s.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,ko.members),this.rasterBoundsSegmentsPosOnly=s.aM.simpleSegment(0,0,4,5);let x=new s.aL;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(x,ko.members),this.viewportSegments=s.aM.simpleSegment(0,0,4,2);let S=new s.c7;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);let E=new s.aN;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(E);let C=this.context.gl;this.stencilClearMode=new kt({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new os(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,l=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let d=s.L();s.bY(d,0,this.width,this.height,0,0,1),s.N(d,d,[l.drawingBufferWidth,l.drawingBufferHeight,0]);let p={mainMatrix:d,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:d};this.useProgram("clippingMask",null,!0).draw(e,l.TRIANGLES,ct.disabled,this.stencilClearMode,on.disabled,nt.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,l,d){if(this.currentStencilSource===e.source||!e.isTileClipped()||!l||!l.length)return;this.currentStencilSource=e.source,this.nextStencilID+l.length>256&&this.clearStencil();let p=this.context;p.setColorMode(on.disabled),p.setDepthMode(ct.disabled);let g={};for(let x of l)g[x.key]=this.nextStencilID++;this._renderTileMasks(g,l,d,!0),this._renderTileMasks(g,l,d,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,l,d,p){let g=this.context,x=g.gl,S=this.style.projection,E=this.transform,C=this.useProgram("clippingMask");for(let D of l){let k=e[D.key],R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),F=S.getMeshFromTileID(this.context,D.canonical,p,!0,"stencil"),U=E.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!d,applyTerrainMatrix:!0});C.draw(g,x.TRIANGLES,ct.disabled,new kt({func:x.ALWAYS,mask:0},k,255,x.KEEP,x.KEEP,x.REPLACE),on.disabled,d?nt.disabled:nt.backCCW,null,R,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}_renderTilesDepthBuffer(){let e=this.context,l=e.gl,d=this.style.projection,p=this.transform,g=this.useProgram("depth"),x=this.getDepthModeFor3D(),S=pe(p,{tileSize:p.tileSize});for(let E of S){let C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),D=d.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),k=p.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,l.TRIANGLES,x,kt.disabled,on.disabled,nt.backCCW,null,C,k,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,l=this.context.gl;return new kt({func:l.NOTEQUAL,mask:255},e,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(e){let l=this.context.gl;return new kt({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,l.KEEP,l.KEEP,l.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let l=this.context.gl,d=e.sort((x,S)=>S.overscaledZ-x.overscaledZ),p=d[d.length-1].overscaledZ,g=d[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();let x={};for(let S=0;S<g;S++)x[S+p]=new kt({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=g,[x,d]}return[{[p]:kt.disabled},d]}stencilConfigForOverlapTwoPass(e){let l=this.context.gl,d=e.sort((x,S)=>S.overscaledZ-x.overscaledZ),p=d[d.length-1].overscaledZ,g=d[0].overscaledZ-p+1;if(this.clearStencil(),g>1){let x={},S={};for(let E=0;E<g;E++)x[E+p]=new kt({func:l.GREATER,mask:255},g+1+E,255,l.KEEP,l.KEEP,l.REPLACE),S[E+p]=new kt({func:l.GREATER,mask:255},1+E,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID=2*g+1,[x,S,d]}return this.nextStencilID=3,[{[p]:new kt({func:l.GREATER,mask:255},2,255,l.KEEP,l.KEEP,l.REPLACE)},{[p]:new kt({func:l.GREATER,mask:255},1,255,l.KEEP,l.KEEP,l.REPLACE)},d]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new on([e.CONSTANT_COLOR,e.ONE],new s.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?on.unblended:on.alphaBlended}getDepthModeForSublayer(e,l,d){if(!this.opaquePassEnabledForLayer())return ct.disabled;let p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ct(d||this.context.gl.LEQUAL,l,[p,p])}getDepthModeFor3D(){return new ct(this.context.gl.LEQUAL,ct.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,l){var d,p;this.style=e,this.options=l,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(B.now()),this.imageManager.beginFrame();let g=this.style._order,x=this.style.sourceCaches,S={},E={},C={},D={isRenderingToTexture:!1,isRenderingGlobe:((d=e.projection)===null||d===void 0?void 0:d.transitionState)>0};for(let R in x){let F=x[R];F.used&&F.prepare(this.context),S[R]=F.getVisibleCoordinates(!1),E[R]=S[R].slice().reverse(),C[R]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let R of g){let F=this.style._layers[R];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;let U=E[F.source];(F.type==="custom"||U.length)&&this.renderLayer(this,x[F.source],F,U,D)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:R=>this.useProgram(R)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?s.bf.black:s.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(R,F){let U=R.context,X=U.gl,W=((ae,ee,de)=>{let be=Math.cos(ee.rollInRadians),ge=Math.sin(ee.rollInRadians),_e=le(ee),xe=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ae.properties.get("sky-color"),u_horizon_color:ae.properties.get("horizon-color"),u_horizon:[(ee.width/2-_e*ge)*de,(ee.height/2+_e*be)*de],u_horizon_normal:[-ge,be],u_sky_horizon_blend:ae.properties.get("sky-horizon-blend")*ee.height/2*de,u_sky_blend:xe}})(F,R.style.map.transform,R.pixelRatio),Y=new ct(X.LEQUAL,ct.ReadWrite,[0,1]),Q=kt.disabled,ne=R.colorModeForRenderPass(),J=R.useProgram("sky"),oe=fl(U,F);J.draw(U,X.TRIANGLES,Y,Q,ne,nt.disabled,W,null,void 0,"sky",oe.vertexBuffer,oe.indexBuffer,oe.segments)}(this,this.style.sky),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){let R=this.style._layers[g[this.currentLayer]],F=x[R.source],U=S[R.source];this._renderTileClippingMasks(R,U,!1),this.renderLayer(this,F,R,U,D)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){let R=this.style._layers[g[this.currentLayer]],F=x[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R,D))continue;this.opaquePassEnabledForLayer()||k||(k=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let U=(R.type==="symbol"?C:E)[R.source];this._renderTileClippingMasks(R,S[R.source],!!this.renderToTexture),this.renderLayer(this,F,R,U,D)}if(D.isRenderingGlobe&&function(R,F,U){let X=R.context,W=X.gl,Y=R.useProgram("atmosphere"),Q=new ct(W.LEQUAL,ct.ReadOnly,[0,1]),ne=R.transform,J=function(xe,ke){let Oe=xe.properties.get("position"),Ce=[-Oe.x,-Oe.y,-Oe.z],qe=s.ag(new Float64Array(16));return xe.properties.get("anchor")==="map"&&(s.b6(qe,qe,ke.rollInRadians),s.b7(qe,qe,-ke.pitchInRadians),s.b6(qe,qe,ke.bearingInRadians),s.b7(qe,qe,ke.center.lat*Math.PI/180),s.bz(qe,qe,-ke.center.lng*Math.PI/180)),s.c5(Ce,Ce,qe),Ce}(U,R.transform),oe=ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ae=F.properties.get("atmosphere-blend")*oe.projectionTransition;if(ae===0)return;let ee=aa(ne.worldSize,ne.center.lat),de=ne.inverseProjectionMatrix,be=new Float64Array(4);be[3]=1,s.aw(be,be,ne.modelViewProjectionMatrix),be[0]/=be[3],be[1]/=be[3],be[2]/=be[3],be[3]=1,s.aw(be,be,de),be[0]/=be[3],be[1]/=be[3],be[2]/=be[3],be[3]=1;let ge=((xe,ke,Oe,Ce,qe)=>({u_sun_pos:xe,u_atmosphere_blend:ke,u_globe_position:Oe,u_globe_radius:Ce,u_inv_proj_matrix:qe}))(J,ae,[be[0],be[1],be[2]],ee,de),_e=fl(X,F);Y.draw(X,W.TRIANGLES,Q,kt.disabled,on.alphaBlended,nt.disabled,ge,null,null,"atmosphere",_e.vertexBuffer,_e.indexBuffer,_e.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let R=function(F,U){let X=null,W=Object.values(F._layers).flatMap(J=>J.source&&!J.isHidden(U)?[F.sourceCaches[J.source]]:[]),Y=W.filter(J=>J.getSource().type==="vector"),Q=W.filter(J=>J.getSource().type!=="vector"),ne=J=>{(!X||X.getSource().maxzoom<J.getSource().maxzoom)&&(X=J)};return Y.forEach(J=>ne(J)),X||Q.forEach(J=>ne(J)),X}(this.style,this.transform.zoom);R&&function(F,U,X){for(let W=0;W<X.length;W++)Kr(F,U,X[W])}(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){let F=R.transform.padding;Lh(R,R.transform.height-(F.top||0),3,lp),Lh(R,F.bottom||0,3,cp),dn(R,F.left||0,3,Tc),dn(R,R.transform.width-(F.right||0),3,Nh);let U=R.transform.centerPoint;(function(X,W,Y,Q){Ui(X,W-1,Y-10,2,20,Q),Ui(X,W-10,Y-1,20,2,Q)})(R,U.x,R.transform.height-U.y,A_)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let l=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix,p=this.terrainFacilitator.dirty;p||(p=e?!s.c8(l,d):!s.c9(l,d)),p||(p=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(s.ca(l,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(g,x){let S=g.context,E=S.gl,C=g.transform,D=on.unblended,k=new ct(E.LEQUAL,ct.ReadWrite,[0,1]),R=x.sourceCache.getRenderableTiles(),F=g.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:s.bf.transparent,depth:1});for(let U of R){let X=x.getTerrainMesh(U.tileID),W=x.getTerrainData(U.tileID),Y=C.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Q={u_ele_delta:x.getMeshFrameDelta(C.zoom)};F.draw(S,E.TRIANGLES,k,kt.disabled,D,nt.backCCW,Q,W,Y,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain),function(g,x){let S=g.context,E=S.gl,C=g.transform,D=on.unblended,k=new ct(E.LEQUAL,ct.ReadWrite,[0,1]),R=x.getCoordsTexture(),F=x.sourceCache.getRenderableTiles(),U=g.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:s.bf.transparent,depth:1}),x.coordsIndex=[];for(let X of F){let W=x.getTerrainMesh(X.tileID),Y=x.getTerrainData(X.tileID);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,R.texture);let Q={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(C.zoom)},ne=C.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(S,E.TRIANGLES,k,kt.disabled,D,nt.backCCW,Q,Y,ne,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),x.coordsIndex.push(X.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain))}renderLayer(e,l,d,p,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||(p||[]).length)&&(this.id=d.id,s.cb(d)?function(x,S,E,C,D,k){if(x.renderPass!=="translucent")return;let{isRenderingToTexture:R}=k,F=kt.disabled,U=x.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(X,W,Y,Q,ne,J,oe,ae,ee){let de=W.transform,be=W.style.map.terrain,ge=ne==="map",_e=J==="map";for(let xe of X){let ke=Q.getTile(xe),Oe=ke.getBucket(Y);if(!Oe||!Oe.text||!Oe.text.segments.get().length)continue;let Ce=s.an(Oe.textSizeData,de.zoom),qe=s.aC(ke,1,W.transform.zoom),ft=wn(ge,W.transform,qe),Ot=Y.layout.get("icon-text-fit")!=="none"&&Oe.hasIconData();if(Ce){let Zt=Math.pow(2,de.zoom-ke.tileID.overscaledZ),$t=be?(ln,fn)=>be.getElevation(xe,ln,fn):null;Ph(Oe,ge,_e,ee,de,ft,Zt,Ce,Ot,s.aD(de,ke,oe,ae),xe.toUnwrapped(),$t)}}}(C,x,E,S,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),D),E.paint.get("icon-opacity").constantOr(1)!==0&&ll(x,S,E,C,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),F,U,R),E.paint.get("text-opacity").constantOr(1)!==0&&ll(x,S,E,C,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),F,U,R),S.map.showCollisionBoxes&&(op(x,S,E,C,!0),op(x,S,E,C,!1))}(e,l,d,p,this.style.placement.variableOffsets,g):s.cc(d)?function(x,S,E,C,D){if(x.renderPass!=="translucent")return;let{isRenderingToTexture:k}=D,R=E.paint.get("circle-opacity"),F=E.paint.get("circle-stroke-width"),U=E.paint.get("circle-stroke-opacity"),X=!E.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(F.constantOr(1)===0||U.constantOr(1)===0))return;let W=x.context,Y=W.gl,Q=x.transform,ne=x.getDepthModeForSublayer(0,ct.ReadOnly),J=kt.disabled,oe=x.colorModeForRenderPass(),ae=[],ee=Q.getCircleRadiusCorrection();for(let de=0;de<C.length;de++){let be=C[de],ge=S.getTile(be),_e=ge.getBucket(E);if(!_e)continue;let xe=E.paint.get("circle-translate"),ke=E.paint.get("circle-translate-anchor"),Oe=s.aD(Q,ge,xe,ke),Ce=_e.programConfigurations.get(E.id),qe=x.useProgram("circle",Ce),ft=_e.layoutVertexBuffer,Ot=_e.indexBuffer,Zt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(be),$t={programConfiguration:Ce,program:qe,layoutVertexBuffer:ft,indexBuffer:Ot,uniformValues:y_(x,ge,E,Oe,ee),terrainData:Zt,projectionData:Q.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(X){let ln=_e.segments.get();for(let fn of ln)ae.push({segments:new s.aM([fn]),sortKey:fn.sortKey,state:$t})}else ae.push({segments:_e.segments,sortKey:0,state:$t})}X&&ae.sort((de,be)=>de.sortKey-be.sortKey);for(let de of ae){let{programConfiguration:be,program:ge,layoutVertexBuffer:_e,indexBuffer:xe,uniformValues:ke,terrainData:Oe,projectionData:Ce}=de.state;ge.draw(W,Y.TRIANGLES,ne,J,oe,nt.backCCW,ke,Oe,Ce,E.id,_e,xe,de.segments,E.paint,x.transform.zoom,be)}}(e,l,d,p,g):s.cd(d)?function(x,S,E,C,D){if(E.paint.get("heatmap-opacity")===0)return;let k=x.context,{isRenderingToTexture:R,isRenderingGlobe:F}=D;if(x.style.map.terrain){for(let U of C){let X=S.getTile(U);S.hasRenderableParent(U)||(x.renderPass==="offscreen"?Dh(x,X,E,U,F):x.renderPass==="translucent"&&ap(x,E,U,R,F))}k.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?function(U,X,W,Y){let Q=U.context,ne=Q.gl,J=U.transform,oe=kt.disabled,ae=new on([ne.ONE,ne.ONE],s.bf.transparent,[!0,!0,!0,!0]);(function(ee,de,be){let ge=ee.gl;ee.activeTexture.set(ge.TEXTURE1),ee.viewport.set([0,0,de.width/4,de.height/4]);let _e=be.heatmapFbos.get(s.c2);_e?(ge.bindTexture(ge.TEXTURE_2D,_e.colorAttachment.get()),ee.bindFramebuffer.set(_e.framebuffer)):(_e=ul(ee,de.width/4,de.height/4),be.heatmapFbos.set(s.c2,_e))})(Q,U,W),Q.clear({color:s.bf.transparent});for(let ee=0;ee<Y.length;ee++){let de=Y[ee];if(X.hasRenderableParent(de))continue;let be=X.getTile(de),ge=be.getBucket(W);if(!ge)continue;let _e=ge.programConfigurations.get(W.id),xe=U.useProgram("heatmap",_e),ke=J.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Oe=J.getCircleRadiusCorrection();xe.draw(Q,ne.TRIANGLES,ct.disabled,oe,ae,nt.backCCW,Vf(be,J.zoom,W.paint.get("heatmap-intensity"),Oe),null,ke,W.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,W.paint,J.zoom,_e)}Q.viewport.set([0,0,U.width,U.height])}(x,S,E,C):x.renderPass==="translucent"&&function(U,X){let W=U.context,Y=W.gl;W.setColorMode(U.colorModeForRenderPass());let Q=X.heatmapFbos.get(s.c2);Q&&(W.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Q.colorAttachment.get()),W.activeTexture.set(Y.TEXTURE1),hl(W,X).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(W,Y.TRIANGLES,ct.disabled,kt.disabled,U.colorModeForRenderPass(),nt.disabled,gh(U,X,0,1),null,null,X.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,X.paint,U.transform.zoom))}(x,E)}(e,l,d,p,g):s.ce(d)?function(x,S,E,C,D){if(x.renderPass!=="translucent")return;let{isRenderingToTexture:k}=D,R=E.paint.get("line-opacity"),F=E.paint.get("line-width");if(R.constantOr(1)===0||F.constantOr(1)===0)return;let U=x.getDepthModeForSublayer(0,ct.ReadOnly),X=x.colorModeForRenderPass(),W=E.paint.get("line-dasharray"),Y=E.paint.get("line-pattern"),Q=Y.constantOr(1),ne=E.paint.get("line-gradient"),J=E.getCrossfadeParameters(),oe=Q?"linePattern":W?"lineSDF":ne?"lineGradient":"line",ae=x.context,ee=ae.gl,de=x.transform,be=!0;for(let ge of C){let _e=S.getTile(ge);if(Q&&!_e.patternsLoaded())continue;let xe=_e.getBucket(E);if(!xe)continue;let ke=xe.programConfigurations.get(E.id),Oe=x.context.program.get(),Ce=x.useProgram(oe,ke),qe=be||Ce.program!==Oe,ft=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ge),Ot=Y.constantOr(null);if(Ot&&_e.imageAtlas){let ht=_e.imageAtlas,Wt=ht.patternPositions[Ot.to.toString()],Cn=ht.patternPositions[Ot.from.toString()];Wt&&Cn&&ke.setConstantPatternPositions(Wt,Cn)}let Zt=de.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),$t=de.getPixelScale(),ln=Q?qf(x,_e,E,$t,J):W?ds(x,_e,E,$t,W,J):ne?Hf(x,_e,E,$t,xe.lineClipsArray.length):gc(x,_e,E,$t);if(Q)ae.activeTexture.set(ee.TEXTURE0),_e.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ke.updatePaintBuffers(J);else if(W&&(qe||x.lineAtlas.dirty))ae.activeTexture.set(ee.TEXTURE0),x.lineAtlas.bind(ae);else if(ne){let ht=xe.gradients[E.id],Wt=ht.texture;if(E.gradientVersion!==ht.version){let Cn=256;if(E.stepInterpolant){let On=S.getSource().maxzoom,Vn=ge.canonical.z===On?Math.ceil(1<<x.transform.maxZoom-ge.canonical.z):1;Cn=s.ah(s.c3(xe.maxLineLength/s.$*1024*Vn),256,ae.maxTextureSize)}ht.gradient=s.c4({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:Cn,image:ht.gradient||void 0,clips:xe.lineClipsArray}),ht.texture?ht.texture.update(ht.gradient):ht.texture=new s.T(ae,ht.gradient,ee.RGBA),ht.version=E.gradientVersion,Wt=ht.texture}ae.activeTexture.set(ee.TEXTURE0),Wt.bind(E.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}let fn=x.stencilModeForClipping(ge);Ce.draw(ae,ee.TRIANGLES,U,fn,X,nt.disabled,ln,ft,Zt,E.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,E.paint,x.transform.zoom,ke,xe.layoutVertexBuffer2),be=!1}}(e,l,d,p,g):s.cf(d)?function(x,S,E,C,D){let k=E.paint.get("fill-color"),R=E.paint.get("fill-opacity");if(R.constantOr(1)===0)return;let{isRenderingToTexture:F}=D,U=x.colorModeForRenderPass(),X=E.paint.get("fill-pattern"),W=x.opaquePassEnabledForLayer()&&!X.constantOr(1)&&k.constantOr(s.bf.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===W){let Y=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?ct.ReadWrite:ct.ReadOnly);Ec(x,S,E,C,Y,U,!1,F)}if(x.renderPass==="translucent"&&E.paint.get("fill-antialias")){let Y=x.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,ct.ReadOnly);Ec(x,S,E,C,Y,U,!0,F)}}(e,l,d,p,g):s.cg(d)?function(x,S,E,C,D){let k=E.paint.get("fill-extrusion-opacity");if(k===0)return;let{isRenderingToTexture:R}=D;if(x.renderPass==="translucent"){let F=new ct(x.context.gl.LEQUAL,ct.ReadWrite,x.depthRangeFor3D);if(k!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Ah(x,S,E,C,F,kt.disabled,on.disabled,R),Ah(x,S,E,C,F,x.stencilModeFor3D(),x.colorModeForRenderPass(),R);else{let U=x.colorModeForRenderPass();Ah(x,S,E,C,F,kt.disabled,U,R)}}}(e,l,d,p,g):s.ch(d)?function(x,S,E,C,D){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;let{isRenderingToTexture:k}=D,R=x.context,F=x.style.projection.useSubdivision,U=x.getDepthModeForSublayer(0,ct.ReadOnly),X=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(W,Y,Q,ne,J,oe,ae){let ee=W.context,de=ee.gl;for(let be of Q){let ge=Y.getTile(be),_e=ge.dem;if(!_e||!_e.data||!ge.needsHillshadePrepare)continue;let xe=_e.dim,ke=_e.stride,Oe=_e.getPixels();if(ee.activeTexture.set(de.TEXTURE1),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),ge.demTexture=ge.demTexture||W.getTileTexture(ke),ge.demTexture){let qe=ge.demTexture;qe.update(Oe,{premultiply:!1}),qe.bind(de.NEAREST,de.CLAMP_TO_EDGE)}else ge.demTexture=new s.T(ee,Oe,de.RGBA,{premultiply:!1}),ge.demTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE);ee.activeTexture.set(de.TEXTURE0);let Ce=ge.fbo;if(!Ce){let qe=new s.T(ee,{width:xe,height:xe,data:null},de.RGBA);qe.bind(de.LINEAR,de.CLAMP_TO_EDGE),Ce=ge.fbo=ee.createFramebuffer(xe,xe,!0,!1),Ce.colorAttachment.set(qe.texture)}ee.bindFramebuffer.set(Ce.framebuffer),ee.viewport.set([0,0,xe,xe]),W.useProgram("hillshadePrepare").draw(ee,de.TRIANGLES,J,oe,ae,nt.disabled,Gf(ge.tileID,_e),null,null,ne.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),ge.needsHillshadePrepare=!1}})(x,S,C,E,U,kt.disabled,X),R.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(F){let[W,Y,Q]=x.stencilConfigForOverlapTwoPass(C);gs(x,S,E,Q,W,U,X,!1,k),gs(x,S,E,Q,Y,U,X,!0,k)}else{let[W,Y]=x.getStencilConfigForOverlapAndUpdateStencilID(C);gs(x,S,E,Y,W,U,X,!1,k)}}(e,l,d,p,g):s.ci(d)?function(x,S,E,C,D){if(x.renderPass!=="translucent"||!C.length)return;let{isRenderingToTexture:k}=D,R=x.style.projection.useSubdivision,F=x.getDepthModeForSublayer(0,ct.ReadOnly),U=x.colorModeForRenderPass();if(R){let[X,W,Y]=x.stencilConfigForOverlapTwoPass(C);Rh(x,S,E,Y,X,F,U,!1,k),Rh(x,S,E,Y,W,F,U,!0,k)}else{let[X,W]=x.getStencilConfigForOverlapAndUpdateStencilID(C);Rh(x,S,E,W,X,F,U,!1,k)}}(e,l,d,p,g):s.cj(d)?function(x,S,E,C,D){if(x.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!C.length)return;let{isRenderingToTexture:k}=D,R=S.getSource(),F=x.style.projection.useSubdivision;if(R instanceof Oi)_s(x,S,E,C,null,!1,!1,R.tileCoords,R.flippedWindingOrder,k);else if(F){let[U,X,W]=x.stencilConfigForOverlapTwoPass(C);_s(x,S,E,W,U,!1,!0,Ic,!1,k),_s(x,S,E,W,X,!0,!0,Ic,!1,k)}else{let[U,X]=x.getStencilConfigForOverlapAndUpdateStencilID(C);_s(x,S,E,X,U,!1,!0,Ic,!1,k)}}(e,l,d,p,g):s.ck(d)?function(x,S,E,C,D){let k=E.paint.get("background-color"),R=E.paint.get("background-opacity");if(R===0)return;let{isRenderingToTexture:F}=D,U=x.context,X=U.gl,W=x.style.projection,Y=x.transform,Q=Y.tileSize,ne=E.paint.get("background-pattern");if(x.isPatternMissing(ne))return;let J=!ne&&k.a===1&&R===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==J)return;let oe=kt.disabled,ae=x.getDepthModeForSublayer(0,J==="opaque"?ct.ReadWrite:ct.ReadOnly),ee=x.colorModeForRenderPass(),de=x.useProgram(ne?"backgroundPattern":"background"),be=C||pe(Y,{tileSize:Q,terrain:x.style.map.terrain});ne&&(U.activeTexture.set(X.TEXTURE0),x.imageManager.bind(x.context));let ge=E.getCrossfadeParameters();for(let _e of be){let xe=Y.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),ke=ne?Xf(R,x,ne,{tileID:_e,tileSize:Q},ge):Wf(R,k),Oe=x.style.map.terrain&&x.style.map.terrain.getTerrainData(_e),Ce=W.getMeshFromTileID(U,_e.canonical,!1,!0,"raster");de.draw(U,X.TRIANGLES,ae,oe,ee,nt.backCCW,ke,Oe,xe,E.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}}(e,0,d,p,g):s.cl(d)&&function(x,S,E,C){let{isRenderingGlobe:D}=C,k=x.context,R=E.implementation,F=x.style.projection,U=x.transform,X=U.getProjectionDataForCustomLayer(D),W={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:F.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${F.shaderPreludeCode.vertexSource}`,define:F.shaderDefine},defaultProjectionData:X},Y=R.renderingMode?R.renderingMode:"2d";if(x.renderPass==="offscreen"){let Q=R.prerender;Q&&(x.setCustomLayerDefaults(),k.setColorMode(x.colorModeForRenderPass()),Q.call(R,k.gl,W),k.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),k.setColorMode(x.colorModeForRenderPass()),k.setStencilMode(kt.disabled);let Q=Y==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,ct.ReadOnly);k.setDepthMode(Q),R.render(k.gl,W),k.setDirty(),x.setBaseState(),k.bindFramebuffer.set(null)}}(e,0,d,g))}saveTileTexture(e){let l=this._tileTextures[e.size[0]];l?l.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let l=this._tileTextures[e];return l&&l.length>0?l.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let l=this.imageManager.getPattern(e.from.toString()),d=this.imageManager.getPattern(e.to.toString());return!l||!d}useProgram(e,l,d=!1,p=[]){this.cache=this.cache||{};let g=!!this.style.map.terrain,x=this.style.projection,S=d?di.projectionMercator:x.shaderPreludeCode,E=d?Qi:x.shaderDefine,C=e+(l?l.cacheKey:"")+`/${d?ss:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[C]||(this.cache[C]=new mh(this.context,di[e],l,bh[e],this._showOverdrawInspector,g,S,E,p)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:l}=this.context.gl;return this.width!==e||this.height!==l}}function ys(m,e){let l,d=!1,p=null,g=null,x=()=>{p=null,d&&(m.apply(g,l),p=setTimeout(x,e),d=!1)};return(...S)=>(d=!0,g=this,l=S,p||x(),p)}class Pc{constructor(e){this._getCurrentHash=()=>{let l=window.location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(d=p)}),(d&&d[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{let l=this._getCurrentHash();if(!this._isValidHash(l))return!1;let d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0},this._updateHashUnthrottled=()=>{let l=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,l)},this._removeHash=()=>{let l=this._getCurrentHash();if(l.length===0)return;let d=l.join("/"),p=d;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${d}`);let g=window.location.hash.replace(p,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let x=window.location.href.replace(/(#.+)?$/,g);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=ys(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let l=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,p=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(l.lng*g)/g,S=Math.round(l.lat*g)/g,E=this._map.getBearing(),C=this._map.getPitch(),D="";if(D+=e?`/${x}/${S}/${d}`:`${d}/${S}/${x}`,(E||C)&&(D+="/"+Math.round(10*E)/10),C&&(D+=`/${Math.round(C)}`),this._hashName){let k=this._hashName,R=!1,F=window.location.hash.slice(1).split("&").map(U=>{let X=U.split("=")[0];return X===k?(R=!0,`${X}=${D}`):U}).filter(U=>U);return R||F.push(`${k}=${D}`),`#${F.join("&")}`}return`#${D}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new s.S(+e[2],+e[1])}catch{return!1}let l=+e[0],d=+(e[3]||0),p=+(e[4]||0);return l>=this._map.getMinZoom()&&l<=this._map.getMaxZoom()&&d>=-180&&d<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}let to={linearity:.3,easing:s.cm(0,0,.3,1)},Oh=s.e({deceleration:2500,maxSpeed:1400},to),hp=s.e({deceleration:20,maxSpeed:1400},to),dp=s.e({deceleration:1e3,maxSpeed:360},to),fp=s.e({deceleration:1e3,maxSpeed:90},to),pp=s.e({deceleration:1e3,maxSpeed:360},to);class mp{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:B.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,l=B.now();for(;e.length>0&&l-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let l={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:g}of this._inertiaBuffer)l.zoom+=g.zoomDelta||0,l.bearing+=g.bearingDelta||0,l.pitch+=g.pitchDelta||0,l.roll+=g.rollDelta||0,g.panDelta&&l.pan._add(g.panDelta),g.around&&(l.around=g.around),g.pinchAround&&(l.pinchAround=g.pinchAround);let d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(l.pan.mag()){let g=ha(l.pan.mag(),d,s.e({},Oh,e||{})),x=l.pan.mult(g.amount/l.pan.mag()),S=this._map.cameraHelper.handlePanInertia(x,this._map.transform);p.center=S.easingCenter,p.offset=S.easingOffset,mi(p,g)}if(l.zoom){let g=ha(l.zoom,d,hp);p.zoom=this._map.transform.zoom+g.amount,mi(p,g)}if(l.bearing){let g=ha(l.bearing,d,dp);p.bearing=this._map.transform.bearing+s.ah(g.amount,-179,179),mi(p,g)}if(l.pitch){let g=ha(l.pitch,d,fp);p.pitch=this._map.transform.pitch+g.amount,mi(p,g)}if(l.roll){let g=ha(l.roll,d,pp);p.roll=this._map.transform.roll+s.ah(g.amount,-179,179),mi(p,g)}if(p.zoom||p.bearing){let g=l.pinchAround===void 0?l.around:l.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),s.e(p,{noMoveStart:!0})}}function mi(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function ha(m,e,l){let{maxSpeed:d,linearity:p,deceleration:g}=l,x=s.ah(m*p/(e/1e3),-d,d),S=Math.abs(x)/(g*p);return{easing:l.easing,duration:1e3*S,amount:x*(S/2)}}class Pr extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,d,p={}){d=d instanceof MouseEvent?d:new MouseEvent(e,d);let g=L.mousePos(l.getCanvas(),d),x=l.unproject(g);super(e,s.e({point:g,lngLat:x,originalEvent:d},p)),this._defaultPrevented=!1,this.target=l}}class da extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,d){let p=e==="touchend"?d.changedTouches:d.touches,g=L.touchPos(l.getCanvasContainer(),p),x=g.map(E=>l.unproject(E)),S=g.reduce((E,C,D,k)=>E.add(C.div(k.length)),new s.P(0,0));super(e,{points:g,point:S,lngLats:x,lngLat:l.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class Fh extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,d){super(e,{originalEvent:d}),this._defaultPrevented=!1}}class gp{constructor(e,l){this._map=e,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Fh(e.type,this._map,e))}mousedown(e,l){return this._mousedownPos=l,this._firePreventable(new Pr(e.type,this._map,e))}mouseup(e){this._map.fire(new Pr(e.type,this._map,e))}click(e,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new Pr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Pr(e.type,this._map,e))}mouseover(e){this._map.fire(new Pr(e.type,this._map,e))}mouseout(e){this._map.fire(new Pr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new da(e.type,this._map,e))}touchmove(e){this._map.fire(new da(e.type,this._map,e))}touchend(e){this._map.fire(new da(e.type,this._map,e))}touchcancel(e){this._map.fire(new da(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _p{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Pr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Pr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fa{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(s.P.convert(e),this._map.terrain)}}class zh{constructor(e,l){this._map=e,this._tr=new fa(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,l){this.isEnabled()&&e.shiftKey&&e.button===0&&(L.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(e,l){if(!this._active)return;let d=l;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;let p=this._startPos;this._lastPos=d,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let g=Math.min(p.x,d.x),x=Math.max(p.x,d.x),S=Math.min(p.y,d.y),E=Math.max(p.y,d.y);L.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=x-g+"px",this._box.style.height=E-S+"px"}mouseupWindow(e,l){if(!this._active||e.button!==0)return;let d=this._startPos,p=l;if(this.reset(),L.suppressClick(),d.x!==p.x||d.y!==p.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(d,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,l){return this._map.fire(new s.l(e,{originalEvent:l}))}}function pa(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);let l={};for(let d=0;d<m.length;d++)l[m[d].identifier]=e[d];return l}class yp{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,l,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),d.length===this.numTouches&&(this.centroid=function(p){let g=new s.P(0,0);for(let x of p)g._add(x);return g.div(p.length)}(l),this.touches=pa(d,l)))}touchmove(e,l,d){if(this.aborted||!this.centroid)return;let p=pa(d,l);for(let g in this.touches){let x=p[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,l,d){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){let p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Dr{constructor(e){this.singleTap=new yp(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,l,d){this.singleTap.touchstart(e,l,d)}touchmove(e,l,d){this.singleTap.touchmove(e,l,d)}touchend(e,l,d){let p=this.singleTap.touchend(e,l,d);if(p){let g=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class gi{constructor(e){this._tr=new fa(e),this._zoomIn=new Dr({numTouches:1,numTaps:2}),this._zoomOut=new Dr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,l,d){this._zoomIn.touchstart(e,l,d),this._zoomOut.touchstart(e,l,d)}touchmove(e,l,d){this._zoomIn.touchmove(e,l,d),this._zoomOut.touchmove(e,l,d)}touchend(e,l,d){let p=this._zoomIn.touchend(e,l,d),g=this._zoomOut.touchend(e,l,d),x=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(p)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ma{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let l=this._moveFunction(...e);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(e,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(l)?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,l){if(!this.isEnabled())return;let d=this._lastPoint;if(!d)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let p=Array.isArray(l)?l[0]:l;return!this._moved&&p.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(d,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&L.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let _i=0,ga=2,R_={[_i]:1,[ga]:2};class pl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let l=L.mouseButton(e);this._eventButton=l}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(l,d){let p=R_[d];return l.buttons===void 0||(l.buttons&p)!==p}(e,this._eventButton)}isValidEndEvent(e){return L.mouseButton(e)===this._eventButton}}class k_{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class N_{constructor(e=new pl({checkCorrectEvent:()=>!0}),l=new k_){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=l}_executeRelevantHandler(e,l,d){return e instanceof MouseEvent?l(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?d(e):void 0}startMove(e){this._executeRelevantHandler(e,l=>this.mouseMoveStateManager.startMove(l),l=>this.oneFingerTouchMoveStateManager.startMove(l))}endMove(e){this._executeRelevantHandler(e,l=>this.mouseMoveStateManager.endMove(l),l=>this.oneFingerTouchMoveStateManager.endMove(l))}isValidStartEvent(e){return this._executeRelevantHandler(e,l=>this.mouseMoveStateManager.isValidStartEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidStartEvent(l))}isValidMoveEvent(e){return this._executeRelevantHandler(e,l=>this.mouseMoveStateManager.isValidMoveEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(l))}isValidEndEvent(e){return this._executeRelevantHandler(e,l=>this.mouseMoveStateManager.isValidEndEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidEndEvent(l))}}let ml=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class gl{constructor(e,l){this._clickTolerance=e.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,l,d){return this._calculateTransform(e,l,d)}touchmove(e,l,d){if(this._active){if(!this._shouldBePrevented(d.length))return e.preventDefault(),this._calculateTransform(e,l,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,l,d){this._calculateTransform(e,l,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,l,d){d.length>0&&(this._active=!0);let p=pa(d,l),g=new s.P(0,0),x=new s.P(0,0),S=0;for(let C in p){let D=p[C],k=this._touches[C];k&&(g._add(D),x._add(D.sub(k)),S++,p[C]=D)}if(this._touches=p,this._shouldBePrevented(S)||!x.mag())return;let E=x.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,l,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([l[0],l[1]]))}touchmove(e,l,d){if(!this._firstTwoTouches)return;e.preventDefault();let[p,g]=this._firstTwoTouches,x=$e(d,l,p),S=$e(d,l,g);if(!x||!S)return;let E=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],E,e)}touchend(e,l,d){if(!this._firstTwoTouches)return;let[p,g]=this._firstTwoTouches,x=$e(d,l,p),S=$e(d,l,g);x&&S||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function $e(m,e,l){for(let d=0;d<m.length;d++)if(m[d].identifier===l)return e[d]}function jh(m,e){return Math.log(m/e)/Math.LN2}class Dc extends yi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,l){let d=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(jh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jh(this._distance,d),pinchAround:l}}}function Bh(m,e){return 180*m.angleWith(e)/Math.PI}class _a extends yi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,l,d){let p=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bh(this._vector,p),pinchAround:l}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let l=25/(Math.PI*this._minDiameter)*360,d=Bh(e,this._startVector);return Math.abs(d)<l}}function vs(m){return Math.abs(m.y)>Math.abs(m.x)}class Ac extends yi{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,l,d){super.touchstart(e,l,d),this._currentTouchCount=d.length}_start(e){this._lastPoints=e,vs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,l,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let p=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,d.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,l,d){if(this._valid!==void 0)return this._valid;let p=e.mag()>=2,g=l.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;let x=e.y>0==l.y>0;return vs(e)&&vs(l)&&x}}let Pt={panStep:100,bearingStep:15,pitchStep:10};class Rc{constructor(e){this._tr=new fa(e);let l=Pt;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let l=0,d=0,p=0,g=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:e.shiftKey?d=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?d=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(d=0,p=0),{cameraAnimation:S=>{let E=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:L_,zoom:l?Math.round(E.zoom)+l*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+d*this._bearingStep,pitch:E.pitch+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function L_(m){return m*(2-m)}let kc=4.000244140625,O_=1/450;class vp{constructor(e,l){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=e,this._tr=new fa(e),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=O_}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let l=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,d=B.now(),p=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,l!==0&&l%kc==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),e.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=e,this._delta-=l,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let l=L.mousePos(this._map.getCanvas(),e),d=this._tr;this._aroundPoint=this._aroundCenter?d.transform.locationToScreenPoint(s.S.convert(d.center)):l,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){let S=this._type==="wheel"&&Math.abs(this._delta)>kc?this._wheelZoomRate:this._defaultZoomRate,E=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&E!==0&&(E=1/E);let C=typeof this._targetZoom!="number"?e.scale:s.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),s.ak(C*E)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let l=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,d=this._startZoom,p=this._easing,g,x=!1;if(this._type==="wheel"&&d&&p){let S=B.now()-this._lastWheelEventTime,E=Math.min((S+5)/200,1),C=p(E);g=s.C.number(d,l,C),E<1?this._frameId||(this._frameId=!0):x=!0}else g=l,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let l=s.co;if(this._prevEase){let d=this._prevEase,p=(B.now()-d.start)/d.duration,g=d.easing(p+.01)-d.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-x*x);l=s.cm(x,S,.25,1)}return this._prevEase={start:B.now(),duration:e,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Uh{constructor(e,l){this._clickZoom=e,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vh{constructor(e){this._tr=new fa(e),this.reset()}reset(){this._active=!1}dblclick(e,l){return e.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xp{constructor(){this._tap=new Dr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,l,d){if(!this._swipePoint)if(this._tapTime){let p=l[0],g=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(p)<30;g&&x?d.length>0&&(this._swipePoint=p,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(e,l,d)}touchmove(e,l,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;let p=l[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,l,d)}touchend(e,l,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{let p=this._tap.touchend(e,l,d);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bp{constructor(e,l,d){this._el=e,this._mousePan=l,this._touchPan=d}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gh{constructor(e,l,d,p){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=l,this._mousePitch=d,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class wp{constructor(e,l,d,p){this._el=e,this._touchZoom=l,this._touchRotate=d,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Mp{constructor(e,l){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=l,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",e);let l=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(l=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=l,this._container.appendChild(p);let g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=d,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,l){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:e,originalEvent:l})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let vi=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class an extends s.l{}function ya(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class $h{constructor(e,l){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,g)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let x=p.type==="renderFrame"?void 0:p,S={needsRenderFrame:!1},E={},C={};for(let{handlerName:R,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let X;if(this._blockedByActive(C,U,R))F.reset();else if(F[g||p.type]){if(s.cp(p,g||p.type)){let W=L.mousePos(this._map.getCanvas(),p);X=F[g||p.type](p,W)}else if(s.cq(p,g||p.type)){let W=this._getMapTouches(p.touches),Y=L.touchPos(this._map.getCanvas(),W);X=F[g||p.type](p,Y,W)}else s.cr(g||p.type)||(X=F[g||p.type](p));this.mergeHandlerResult(S,E,X,R,x),X&&X.needsRenderFrame&&this._triggerRenderFrame()}(X||F.isActive())&&(C[R]=F)}let D={};for(let R in this._previousActiveHandlers)C[R]||(D[R]=x);this._previousActiveHandlers=C,(Object.keys(D).length||ya(S))&&(this._changes.push([S,E,D]),this._triggerRenderFrame()),(Object.keys(C).length||ya(S))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:k}=S;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mp(e),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);let d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(let[p,g,x]of this._listeners)L.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(let[e,l,d]of this._listeners)L.removeEventListener(e,l,e===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(e){let l=this._map,d=l.getCanvasContainer();this._add("mapEvent",new gp(l,e));let p=l.boxZoom=new zh(l,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();let g=l.cooperativeGestures=new Mp(l,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();let x=new gi(l),S=new Vh(l);l.doubleClickZoom=new Uh(S,x),this._add("tapZoom",x),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&l.doubleClickZoom.enable();let E=new xp;this._add("tapDragZoom",E);let C=l.touchPitch=new Ac(l);this._add("touchPitch",C),e.interactive&&e.touchPitch&&l.touchPitch.enable(e.touchPitch);let D=()=>l.project(l.getCenter()),k=function({enable:J,clickTolerance:oe,aroundCenter:ae=!0,minPixelCenterThreshold:ee=100,rotateDegreesPerPixelMoved:de=.8},be){let ge=new pl({checkCorrectEvent:_e=>L.mouseButton(_e)===0&&_e.ctrlKey||L.mouseButton(_e)===2&&!_e.ctrlKey});return new ma({clickTolerance:oe,move:(_e,xe)=>{let ke=be();if(ae&&Math.abs(ke.y-_e.y)>ee)return{bearingDelta:s.cn(new s.P(_e.x,xe.y),xe,ke)};let Oe=(xe.x-_e.x)*de;return ae&&xe.y<ke.y&&(Oe=-Oe),{bearingDelta:Oe}},moveStateManager:ge,enable:J,assignEvents:ml})}(e,D),R=function({enable:J,clickTolerance:oe,pitchDegreesPerPixelMoved:ae=-.5}){let ee=new pl({checkCorrectEvent:de=>L.mouseButton(de)===0&&de.ctrlKey||L.mouseButton(de)===2});return new ma({clickTolerance:oe,move:(de,be)=>({pitchDelta:(be.y-de.y)*ae}),moveStateManager:ee,enable:J,assignEvents:ml})}(e),F=function({enable:J,clickTolerance:oe,rollDegreesPerPixelMoved:ae=.3},ee){let de=new pl({checkCorrectEvent:be=>L.mouseButton(be)===2&&be.ctrlKey});return new ma({clickTolerance:oe,move:(be,ge)=>{let _e=ee(),xe=(ge.x-be.x)*ae;return ge.y<_e.y&&(xe=-xe),{rollDelta:xe}},moveStateManager:de,enable:J,assignEvents:ml})}(e,D);l.dragRotate=new Gh(e,k,R,F),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",R,["mouseRotate","mouseRoll"]),this._add("mouseRoll",F,["mousePitch"]),e.interactive&&e.dragRotate&&l.dragRotate.enable();let U=function({enable:J,clickTolerance:oe}){let ae=new pl({checkCorrectEvent:ee=>L.mouseButton(ee)===0&&!ee.ctrlKey});return new ma({clickTolerance:oe,move:(ee,de)=>({around:de,panDelta:de.sub(ee)}),activateOnStart:!0,moveStateManager:ae,enable:J,assignEvents:ml})}(e),X=new gl(e,l);l.dragPan=new bp(d,U,X),this._add("mousePan",U),this._add("touchPan",X,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&l.dragPan.enable(e.dragPan);let W=new _a,Y=new Dc;l.touchZoomRotate=new wp(d,Y,W,E),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&l.touchZoomRotate.enable(e.touchZoomRotate);let Q=l.scrollZoom=new vp(l,()=>this._triggerRenderFrame());this._add("scrollZoom",Q,["mousePan"]),e.interactive&&e.scrollZoom&&l.scrollZoom.enable(e.scrollZoom);let ne=l.keyboard=new Rc(l);this._add("keyboard",ne),e.interactive&&e.keyboard&&l.keyboard.enable(),this._add("blockableMapEvent",new _p(l))}_add(e,l,d){this._handlers.push({handlerName:e,handler:l,allowed:d}),this._handlersById[e]=l}stop(e){if(!this._updatingCamera){for(let{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,l,d){for(let p in e)if(p!==d&&(!l||l.indexOf(p)<0))return!0;return!1}_getMapTouches(e){let l=[];for(let d of e)this._el.contains(d.target)&&l.push(d);return l}mergeHandlerResult(e,l,d,p,g){if(!d)return;s.e(e,d);let x={handlerName:p,originalEvent:d.originalEvent||g};d.zoomDelta!==void 0&&(l.zoom=x),d.panDelta!==void 0&&(l.drag=x),d.rollDelta!==void 0&&(l.roll=x),d.pitchDelta!==void 0&&(l.pitch=x),d.bearingDelta!==void 0&&(l.rotate=x)}_applyChanges(){let e={},l={},d={};for(let[p,g,x]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(e.rollDelta=(e.rollDelta||0)+p.rollDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),s.e(l,g),s.e(d,x);this._updateMapTransform(e,l,d),this._changes=[]}_updateMapTransform(e,l,d){let p=this._map,g=p._getTransformForUpdate(),x=p.terrain;if(!(ya(e)||x&&this._terrainMovement))return this._fireEvents(l,d,!0);p._stop(!0);let{panDelta:S,zoomDelta:E,bearingDelta:C,pitchDelta:D,rollDelta:k,around:R,pinchAround:F}=e;F!==void 0&&(R=F),R=R||p.transform.centerPoint,x&&!g.isPointOnMapSurface(R)&&(R=g.centerPoint);let U={panDelta:S,zoomDelta:E,rollDelta:k,pitchDelta:D,bearingDelta:C,around:R};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(R)&&(R=g.centerPoint);let X=R.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(S?R.sub(S):R);x?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,g),this._terrainMovement||!l.drag&&!l.zoom?l.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(U,g,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(U,g,X))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,g),this._map.cameraHelper.handleMapControlsPan(U,g,X)),p._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(l,d,!0)}_fireEvents(e,l,d){let p=vi(this._eventsInProgress),g=vi(e),x={};for(let k in e){let{originalEvent:R}=e[k];this._eventsInProgress[k]||(x[`${k}start`]=R),this._eventsInProgress[k]=e[k]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(let k in x)this._fireEvent(k,x[k]);g&&this._fireEvent("move",g.originalEvent);for(let k in e){let{originalEvent:R}=e[k];this._fireEvent(k,R)}let S={},E;for(let k in this._eventsInProgress){let{handlerName:R,originalEvent:F}=this._eventsInProgress[k];this._handlersById[R].isActive()||(delete this._eventsInProgress[k],E=l[R]||F,S[`${k}end`]=E)}for(let k in S)this._fireEvent(k,S[k]);let C=vi(this._eventsInProgress),D=(p||g)&&!C;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(d&&D){this._updatingCamera=!0;let k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!k||!k.essential&&B.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:E})),R(this._map.getBearing())&&this._map.resetNorth()):(R(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,l){this._map.fire(new s.l(e,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new an("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Sp extends s.E{constructor(e,l,d){super(),this._renderFrameCallback=()=>{let p=Math.min((B.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=d.bearingSnap,this.cameraHelper=l,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,l){e.apply(this.transform),this.transform=e,this.cameraHelper=l}getCenter(){return new s.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,l){return this.jumpTo({center:e},l)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,l){return this.jumpTo({elevation:e},l),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,l,d){return e=s.P.convert(e).mult(-1),this.panTo(this.transform.center,s.e({offset:e},l),d)}panTo(e,l,d){return this.easeTo(s.e({center:e},l),d)}getZoom(){return this.transform.zoom}setZoom(e,l){return this.jumpTo({zoom:e},l),this}zoomTo(e,l,d){return this.easeTo(s.e({zoom:e},l),d)}zoomIn(e,l){return this.zoomTo(this.getZoom()+1,e,l),this}zoomOut(e,l){return this.zoomTo(this.getZoom()-1,e,l),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,l){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new s.l("movestart",l)).fire(new s.l("move",l)).fire(new s.l("moveend",l))),this}getBearing(){return this.transform.bearing}setBearing(e,l){return this.jumpTo({bearing:e},l),this}getPadding(){return this.transform.padding}setPadding(e,l){return this.jumpTo({padding:e},l),this}rotateTo(e,l,d){return this.easeTo(s.e({bearing:e},l),d)}resetNorth(e,l){return this.rotateTo(0,s.e({duration:1e3},e),l),this}resetNorthPitch(e,l){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},e),l),this}snapToNorth(e,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,l):this}getPitch(){return this.transform.pitch}setPitch(e,l){return this.jumpTo({pitch:e},l),this}getRoll(){return this.transform.roll}setRoll(e,l){return this.jumpTo({roll:e},l),this}cameraForBounds(e,l){e=gn.convert(e).adjustAntiMeridian();let d=l&&l.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),d,l)}_cameraForBoxAndBearing(e,l,d,p){let g={top:0,bottom:0,right:0,left:0};if(typeof(p=s.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){let C=p.padding;p.padding={top:C,bottom:C,right:C,left:C}}let x=s.e(g,p.padding);p.padding=x;let S=this.transform,E=new gn(e,l);return this.cameraHelper.cameraForBoxAndBearing(p,x,E,d,S)}fitBounds(e,l,d){return this._fitInternal(this.cameraForBounds(e,l),l,d)}fitScreenCoordinates(e,l,d,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(e)),this.transform.screenPointToLocation(s.P.convert(l)),d,p),p,g)}_fitInternal(e,l,d){return e?(delete(l=s.e(e,l)).padding,l.linear?this.easeTo(l,d):this.flyTo(l,d)):this}jumpTo(e,l){this.stop();let d=this._getTransformForUpdate(),p=!1,g=!1,x=!1,S=d.zoom;this.cameraHelper.handleJumpToCenterZoom(d,e);let E=d.zoom!==S;return"elevation"in e&&d.elevation!==+e.elevation&&d.setElevation(+e.elevation),"bearing"in e&&d.bearing!==+e.bearing&&(p=!0,d.setBearing(+e.bearing)),"pitch"in e&&d.pitch!==+e.pitch&&(g=!0,d.setPitch(+e.pitch)),"roll"in e&&d.roll!==+e.roll&&(x=!0,d.setRoll(+e.roll)),e.padding==null||d.isPaddingEqual(e.padding)||d.setPadding(e.padding),this._applyUpdatedTransform(d),this.fire(new s.l("movestart",l)).fire(new s.l("move",l)),E&&this.fire(new s.l("zoomstart",l)).fire(new s.l("zoom",l)).fire(new s.l("zoomend",l)),p&&this.fire(new s.l("rotatestart",l)).fire(new s.l("rotate",l)).fire(new s.l("rotateend",l)),g&&this.fire(new s.l("pitchstart",l)).fire(new s.l("pitch",l)).fire(new s.l("pitchend",l)),x&&this.fire(new s.l("rollstart",l)).fire(new s.l("roll",l)).fire(new s.l("rollend",l)),this.fire(new s.l("moveend",l))}calculateCameraOptionsFromTo(e,l,d,p=0){let g=s.a1.fromLngLat(e,l),x=s.a1.fromLngLat(d,p),S=x.x-g.x,E=x.y-g.y,C=x.z-g.z,D=Math.hypot(S,E,C);if(D===0)throw new Error("Can't calculate camera options with same From and To");let k=Math.hypot(S,E),R=s.ak(this.transform.cameraToCenterDistance/D/this.transform.tileSize),F=180*Math.atan2(S,-E)/Math.PI,U=180*Math.acos(k/D)/Math.PI;return U=C<0?90-U:90+U,{center:x.toLngLat(),elevation:p,zoom:R,pitch:U,bearing:F}}calculateCameraOptionsFromCameraLngLatAltRotation(e,l,d,p,g){let x=this.transform.calculateCenterFromCameraLngLatAlt(e,l,d,p);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:d,pitch:p,roll:g}}easeTo(e,l){this._stop(!1,e.easeId),((e=s.e({offset:[0,0],duration:500,easing:s.co},e)).animate===!1||!e.essential&&B.prefersReducedMotion)&&(e.duration=0);let d=this._getTransformForUpdate(),p=this.getBearing(),g=d.pitch,x=d.roll,S="bearing"in e?this._normalizeBearing(e.bearing,p):p,E="pitch"in e?+e.pitch:g,C="roll"in e?this._normalizeBearing(e.roll,x):x,D="padding"in e?e.padding:d.padding,k=s.P.convert(e.offset),R,F;e.around&&(R=s.S.convert(e.around),F=d.locationToScreenPoint(R));let U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(d,{bearing:S,pitch:E,roll:C,padding:D,around:R,aroundPoint:F,offsetAsPoint:k,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||p!==S,this._pitching=this._pitching||E!==g,this._rolling=this._rolling||C!==x,this._padding=!d.isPaddingEqual(D),this._zooming=this._zooming||X.isZooming,this._easeId=e.easeId,this._prepareEase(l,e.noMoveStart,U),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease(W=>{X.easeFunc(W),this.terrain&&!e.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(d),this._fireMoveEvents(l)},W=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(l,W)},e),this}_prepareEase(e,l,d={}){this._moving=!0,l||d.moving||this.fire(new s.l("movestart",e)),this._zooming&&!d.zooming&&this.fire(new s.l("zoomstart",e)),this._rotating&&!d.rotating&&this.fire(new s.l("rotatestart",e)),this._pitching&&!d.pitching&&this.fire(new s.l("pitchstart",e)),this._rolling&&!d.rolling&&this.fire(new s.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&l!==this._elevationTarget){let d=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(d-(l-(d*e+this._elevationStart))/(1-e)),this._elevationTarget=l}this.transform.setElevation(s.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let l=e.getCameraLngLat(),d=e.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(l,e.zoom):0;if(d<p){let g=this.calculateCameraOptionsFromTo(l,p,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){let l=[];if(l.push(p=>this._elevateCameraIfInsideTerrain(p)),this.transformCameraUpdate&&l.push(p=>this.transformCameraUpdate(p)),!l.length)return;let d=e.clone();for(let p of l){let g=d.clone(),{center:x,zoom:S,roll:E,pitch:C,bearing:D,elevation:k}=p(g);x&&g.setCenter(x),k!==void 0&&g.setElevation(k),S!==void 0&&g.setZoom(S),E!==void 0&&g.setRoll(E),C!==void 0&&g.setPitch(C),D!==void 0&&g.setBearing(D),d.apply(g)}this.transform.apply(d)}_fireMoveEvents(e){this.fire(new s.l("move",e)),this._zooming&&this.fire(new s.l("zoom",e)),this._rotating&&this.fire(new s.l("rotate",e)),this._pitching&&this.fire(new s.l("pitch",e)),this._rolling&&this.fire(new s.l("roll",e))}_afterEase(e,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;let d=this._zooming,p=this._rotating,g=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,d&&this.fire(new s.l("zoomend",e)),p&&this.fire(new s.l("rotateend",e)),g&&this.fire(new s.l("pitchend",e)),x&&this.fire(new s.l("rollend",e)),this.fire(new s.l("moveend",e))}flyTo(e,l){if(!e.essential&&B.prefersReducedMotion){let xe=s.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(xe,l)}this.stop(),e=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.co},e);let d=this._getTransformForUpdate(),p=d.bearing,g=d.pitch,x=d.roll,S=d.padding,E="bearing"in e?this._normalizeBearing(e.bearing,p):p,C="pitch"in e?+e.pitch:g,D="roll"in e?this._normalizeBearing(e.roll,x):x,k="padding"in e?e.padding:d.padding,R=s.P.convert(e.offset),F=d.centerPoint.add(R),U=d.screenPointToLocation(F),X=this.cameraHelper.handleFlyTo(d,{bearing:E,pitch:C,roll:D,padding:k,locationAtOffset:U,offsetAsPoint:R,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),W=e.curve,Y=Math.max(d.width,d.height),Q=Y/X.scaleOfZoom,ne=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&(W=Math.sqrt(Y/X.scaleOfMinZoom/ne*2));let J=W*W;function oe(xe){let ke=(Q*Q-Y*Y+(xe?-1:1)*J*J*ne*ne)/(2*(xe?Q:Y)*J*ne);return Math.log(Math.sqrt(ke*ke+1)-ke)}function ae(xe){return(Math.exp(xe)-Math.exp(-xe))/2}function ee(xe){return(Math.exp(xe)+Math.exp(-xe))/2}let de=oe(!1),be=function(xe){return ee(de)/ee(de+W*xe)},ge=function(xe){return Y*((ee(de)*(ae(ke=de+W*xe)/ee(ke))-ae(de))/J)/ne;var ke},_e=(oe(!0)-de)/W;if(Math.abs(ne)<2e-6||!isFinite(_e)){if(Math.abs(Y-Q)<1e-6)return this.easeTo(e,l);let xe=Q<Y?-1:1;_e=Math.abs(Math.log(Q/Y))/W,ge=()=>0,be=ke=>Math.exp(xe*W*ke)}return e.duration="duration"in e?+e.duration:1e3*_e/("screenSpeed"in e?+e.screenSpeed/W:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=p!==E,this._pitching=C!==g,this._rolling=D!==x,this._padding=!d.isPaddingEqual(k),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease(xe=>{let ke=xe*_e,Oe=1/be(ke),Ce=ge(ke);this._rotating&&d.setBearing(s.C.number(p,E,xe)),this._pitching&&d.setPitch(s.C.number(g,C,xe)),this._rolling&&d.setRoll(s.C.number(x,D,xe)),this._padding&&(d.interpolatePadding(S,k,xe),F=d.centerPoint.add(R)),X.easeFunc(xe,Oe,Ce,F),this.terrain&&!e.freezeElevation&&this._updateElevation(xe),this._applyUpdatedTransform(d),this._fireMoveEvents(l)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(l)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,l){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,l)}return e||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(e,l,d){d.animate===!1||d.duration===0?(e(1),l()):(this._easeStart=B.now(),this._easeOptions=d,this._onEaseFrame=e,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,l){e=s.aO(e,-180,180);let d=Math.abs(e-l);return Math.abs(e-360-l)<d&&(e-=360),Math.abs(e+360-l)<d&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(s.S.convert(e),this.transform.tileZoom):null}}let Hh={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class qh{constructor(e=Hh){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,l){let d=this._map._getUIString(`AttributionControl.${l}`);e.title=d,e.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}let l=this._map.style.sourceCaches;for(let p in l){let g=l[p];if(g.used||g.usedForTerrain){let x=g.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(p=>String(p).trim()),e.sort((p,g)=>p.length-g.length),e=e.filter((p,g)=>{for(let x=g+1;x<e.length;x++)if(e[x].indexOf(p)>=0)return!1;return!0});let d=e.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,e.length?(this._innerContainer.innerHTML=L.sanitize(d),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ep{constructor(e={}){this._updateCompact=()=>{let l=this._container.children;if(l.length){let d=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");let l=L.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Vi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let l=++this._id;return this._queue.push({callback:e,id:l,cancelled:!1}),l}remove(e){let l=this._currentlyRunning,d=l?this._queue.concat(l):this._queue;for(let p of d)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let l=this._currentlyRunning=this._queue;this._queue=[];for(let d of l)if(!d.cancelled&&(d.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nc=s.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ye extends s.E{constructor(e){super(),this._lastTilesetChange=B.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,l){this.sourceCache.update(e,l),this._renderableTilesKeys=[];let d={};for(let p of pe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))d[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),s.bY(p.terrainRttPosMatrix32f,0,s.$,s.$,0,0,1),this._tiles[p.key]=new Js(p,this.tileSize),this._lastTilesetChange=B.now());for(let p in this._tiles)d[p]||delete this._tiles[p]}freeRtt(e){for(let l in this._tiles){let d=this._tiles[l];(!e||d.tileID.equals(e)||d.tileID.isChildOf(e)||e.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,l){return l?this._getTerrainCoordsForTileRanges(e,l):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let l={};for(let d of this._renderableTilesKeys){let p=this._tiles[d].tileID,g=e.clone(),x=s.ba();if(p.canonical.equals(e.canonical))s.bY(x,0,s.$,s.$,0,0,1);else if(p.canonical.isChildOf(e.canonical)){let S=p.canonical.z-e.canonical.z,E=p.canonical.x-(p.canonical.x>>S<<S),C=p.canonical.y-(p.canonical.y>>S<<S),D=s.$>>S;s.bY(x,0,D,D,0,0,1),s.M(x,x,[-E*D,-C*D,0])}else{if(!e.canonical.isChildOf(p.canonical))continue;{let S=e.canonical.z-p.canonical.z,E=e.canonical.x-(e.canonical.x>>S<<S),C=e.canonical.y-(e.canonical.y>>S<<S),D=s.$>>S;s.bY(x,0,s.$,s.$,0,0,1),s.M(x,x,[E*D,C*D,0]),s.N(x,x,[1/2**S,1/2**S,0])}}g.terrainRttPosMatrix32f=new Float32Array(x),l[d]=g}return l}_getTerrainCoordsForTileRanges(e,l){let d={};for(let p of this._renderableTilesKeys){let g=this._tiles[p].tileID;if(!this._isWithinTileRanges(g,l))continue;let x=e.clone(),S=s.ba();if(g.canonical.z===e.canonical.z){let E=e.canonical.x-g.canonical.x,C=e.canonical.y-g.canonical.y;s.bY(S,0,s.$,s.$,0,0,1),s.M(S,S,[E*s.$,C*s.$,0])}else if(g.canonical.z>e.canonical.z){let E=g.canonical.z-e.canonical.z,C=g.canonical.x-(g.canonical.x>>E<<E),D=g.canonical.y-(g.canonical.y>>E<<E),k=e.canonical.x-(g.canonical.x>>E),R=e.canonical.y-(g.canonical.y>>E),F=s.$>>E;s.bY(S,0,F,F,0,0,1),s.M(S,S,[-C*F+k*s.$,-D*F+R*s.$,0])}else{let E=e.canonical.z-g.canonical.z,C=e.canonical.x-(e.canonical.x>>E<<E),D=e.canonical.y-(e.canonical.y>>E<<E),k=(e.canonical.x>>E)-g.canonical.x,R=(e.canonical.y>>E)-g.canonical.y,F=s.$<<E;s.bY(S,0,F,F,0,0,1),s.M(S,S,[C*s.$+k*F,D*s.$+R*F,0])}x.terrainRttPosMatrix32f=new Float32Array(S),d[p]=x}return d}getSourceTile(e,l){let d=this.sourceCache._source,p=e.overscaledZ-this.deltaZoom;if(p>d.maxzoom&&(p=d.maxzoom),p<d.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&l)for(;p>=d.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(p--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,l){return l[e.canonical.z]&&e.canonical.x>=l[e.canonical.z].minTileX&&e.canonical.x<=l[e.canonical.z].maxTileX&&e.canonical.y>=l[e.canonical.z].minTileY&&e.canonical.y<=l[e.canonical.z].maxTileY}}class tt{constructor(e,l,d){this._meshCache={},this.painter=e,this.sourceCache=new Ye(l),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,l,d,p=s.$){var g;if(!(l>=0&&l<p&&d>=0&&d<p))return 0;let x=this.getTerrainData(e),S=(g=x.tile)===null||g===void 0?void 0:g.dem;if(!S)return 0;let E=s.cs([],[l/p*s.$,d/p*s.$],x.u_terrain_matrix),C=[E[0]*S.dim,E[1]*S.dim],D=Math.floor(C[0]),k=Math.floor(C[1]),R=C[0]-D,F=C[1]-k;return S.get(D,k)*(1-R)*(1-F)+S.get(D+1,k)*R*(1-F)+S.get(D,k+1)*(1-R)*F+S.get(D+1,k+1)*R*F}getElevationForLngLatZoom(e,l){if(!s.ct(l,e.wrap()))return 0;let{tileID:d,mercatorX:p,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,l);return this.getElevation(d,p%s.$,g%s.$,s.$)}getElevation(e,l,d,p=s.$){return this.getDEMElevation(e,l,d,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let p=this.painter.context,g=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(p,new s.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ag([])}let l=this.sourceCache.getSourceTile(e,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){let p=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new s.T(p,l.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),l.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}let d=l&&l+l.tileID.key+e.key;if(d&&!this._demMatrixCache[d]){let p=this.sourceCache.sourceCache._source.maxzoom,g=e.canonical.z-l.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?g=e.canonical.z-p:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let x=e.canonical.x-(e.canonical.x>>g<<g),S=e.canonical.y-(e.canonical.y>>g<<g),E=s.cu(new Float64Array(16),[1/(s.$<<g),1/(s.$<<g),0]);s.M(E,E,[x*s.$,S*s.$,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(e){let l=this.painter,d=l.width/devicePixelRatio,p=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(l.context,{width:d,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(l.context,{width:d,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(d,p,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,d,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)l[x+0]=255&S,l[x+1]=255&g,l[x+2]=S>>8<<4|g>>8,l[x+3]=0;let d=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),p=new s.T(e,d,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let l=new Uint8Array(4),d=this.painter.context,p=d.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(g,S-x-1,1,1,p.RGBA,p.UNSIGNED_BYTE,l),d.bindFramebuffer.set(null);let E=l[0]+(l[2]>>4<<8),C=l[1]+((15&l[2])<<8),D=this.coordsIndex[255-l[3]],k=D&&this.sourceCache.getTileByID(D);if(!k)return null;let R=this._coordsTextureSize,F=(1<<k.tileID.canonical.z)*R;return new s.a1((k.tileID.canonical.x*R+E)/F+k.tileID.wrap,(k.tileID.canonical.y*R+C)/F,this.getElevation(k.tileID,E,C,R))}depthAtPoint(e){let l=new Uint8Array(4),d=this.painter.context,p=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,l),d.bindFramebuffer.set(null),(l[0]/16777216+l[1]/65536+l[2]/256+l[3])/256}getTerrainMesh(e){var l;let d=((l=this.painter.style.projection)===null||l===void 0?void 0:l.transitionState)>0,p=d&&e.canonical.y===0,g=d&&e.canonical.y===(1<<e.canonical.z)-1,x=`m_${p?"n":""}_${g?"s":""}`;if(this._meshCache[x])return this._meshCache[x];let S=this.painter.context,E=new s.cv,C=new s.aN,D=this.meshSize,k=s.$/D,R=D*D;for(let ee=0;ee<=D;ee++)for(let de=0;de<=D;de++)E.emplaceBack(de*k,ee*k,0);for(let ee=0;ee<R;ee+=D+1)for(let de=0;de<D;de++)C.emplaceBack(de+ee,D+de+ee+1,D+de+ee+2),C.emplaceBack(de+ee,D+de+ee+2,de+ee+1);let F=E.length,U=F+(D+1),X=(D+1)*D,W=p?s.bh:0,Y=p?0:1,Q=g?s.bi:s.$,ne=g?0:1;for(let ee=0;ee<=D;ee++)E.emplaceBack(ee*k,W,Y);for(let ee=0;ee<=D;ee++)E.emplaceBack(ee*k,Q,ne);for(let ee=0;ee<D;ee++)C.emplaceBack(X+ee,U+ee,U+ee+1),C.emplaceBack(X+ee,U+ee+1,X+ee+1),C.emplaceBack(0+ee,F+ee+1,F+ee),C.emplaceBack(0+ee,0+ee+1,F+ee+1);let J=E.length,oe=J+2*(D+1);for(let ee of[0,1])for(let de=0;de<=D;de++)for(let be of[0,1])E.emplaceBack(ee*s.$,de*k,be);for(let ee=0;ee<2*D;ee+=2)C.emplaceBack(J+ee,J+ee+1,J+ee+3),C.emplaceBack(J+ee,J+ee+3,J+ee+2),C.emplaceBack(oe+ee,oe+ee+3,oe+ee+1),C.emplaceBack(oe+ee,oe+ee+2,oe+ee+3);let ae=new os(S.createVertexBuffer(E,Nc.members),S.createIndexBuffer(C),s.aM.simpleSegment(0,0,E.length,C.length));return this._meshCache[x]=ae,ae}getMeshFrameDelta(e){return 2*Math.PI*s.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,l){var d;let{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,l);return(d=this.getMinMaxElevation(p).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(e){let l=this.getTerrainData(e).tile,d={minElevation:null,maxElevation:null};return l&&l.dem&&(d.minElevation=l.dem.min*this.exaggeration,d.maxElevation=l.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(e,l){let d=s.a1.fromLngLat(e.wrap()),p=(1<<l)*s.$,g=d.x*p,x=d.y*p,S=Math.floor(g/s.$),E=Math.floor(x/s.$);return{tileID:new s.Z(l,0,l,S,E),mercatorX:g,mercatorY:x}}}class Lc{constructor(e,l,d){this._context=e,this._size=l,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(d.texture),{id:e,fbo:l,texture:d,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>e.id!==l),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let Oo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Oc{constructor(e,l){this.painter=e,this.terrain=l,this.pool=new Lc(e.context,30,l.sourceCache.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(d=>!e._layers[d].isHidden(l)),this._coordsAscending={};for(let d in e.sourceCaches){this._coordsAscending[d]={};let p=e.sourceCaches[d].getVisibleCoordinates(),g=e.sourceCaches[d].getSource(),x=g instanceof Oi?g.terrainTileRanges:null;for(let S of p){let E=this.terrain.sourceCache.getTerrainCoords(S,x);for(let C in E)this._coordsAscending[d][C]||(this._coordsAscending[d][C]=[]),this._coordsAscending[d][C].push(E[C])}}this._coordsAscendingStr={};for(let d of e._order){let p=e._layers[d],g=p.source;if(Oo[p.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(let x in this._coordsAscending[g])this._coordsAscendingStr[g][x]=this._coordsAscending[g][x].map(S=>S.key).sort().join()}}for(let d of this._renderableTiles)for(let p in this._coordsAscendingStr){let g=this._coordsAscendingStr[p][d.tileID.key];g&&g!==d.rttCoords[p]&&(d.rtt=[])}}renderLayer(e,l){if(e.isHidden(this.painter.transform.zoom))return!1;let d=Object.assign(Object.assign({},l),{isRenderingToTexture:!0}),p=e.type,g=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Oo[p]&&(this._prevType&&Oo[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(e.id),!x))return!0;if(Oo[this._prevType]||Oo[p]&&x){this._prevType=p;let S=this._stacks.length-1,E=this._stacks[S]||[];for(let C of this._renderableTiles){if(this.pool.isFull()&&(Cc(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[S]){let k=this.pool.getObjectForId(C.rtt[S].id);if(k.stamp===C.rtt[S].stamp){this.pool.useObject(k);continue}}let D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),C.rtt[S]={id:D.id,stamp:D.stamp},g.context.bindFramebuffer.set(D.fbo.framebuffer),g.context.clear({color:s.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let k=0;k<E.length;k++){let R=g.style._layers[E[k]],F=R.source?this._coordsAscending[R.source][C.tileID.key]:[C.tileID];g.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),g._renderTileClippingMasks(R,F,!0),g.renderLayer(g,g.style.sourceCaches[R.source],R,F,d),R.source&&(C.rttCoords[R.source]=this._coordsAscendingStr[R.source][C.tileID.key])}}return Cc(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects(),Oo[p]}return!1}}let vr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ip=v,Qr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Hh,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},F_={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class _l{constructor(e,l,d=!1){this.mousedown=g=>{this.startMove(g,L.mousePos(this.element,g)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,L.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=l;let p=new N_;this._rotatePitchHandler=new ma({clickTolerance:3,move:(g,x)=>{let S=l.getBoundingClientRect(),E=new s.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:s.cn(new s.P(g.x,x.y),x,E),pitchDelta:d?-.5*(x.y-g.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=e,L.addEventListener(l,"mousedown",this.mousedown),L.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(l,"touchcancel",this.reset)}startMove(e,l){this._rotatePitchHandler.dragStart(e,l),L.disableDrag()}move(e,l){let d=this.map,{bearingDelta:p,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,l)||{};p&&d.setBearing(d.getBearing()+p),g&&d.setPitch(d.getPitch()+g)}off(){let e=this.element;L.removeEventListener(e,"mousedown",this.mousedown),L.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let qt;function vn(m,e,l,d=!1){if(d||!l.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();let p=new s.S(m.lng,m.lat);if(m=new s.S(m.lng,m.lat),e){let g=new s.S(m.lng-360,m.lat),x=new s.S(m.lng+360,m.lat),S=l.locationToScreenPoint(m).distSqr(e);l.locationToScreenPoint(g).distSqr(e)<S?m=g:l.locationToScreenPoint(x).distSqr(e)<S&&(m=x)}for(;Math.abs(m.lng-l.center.lng)>180;){let g=l.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=l.width&&g.y<=l.height)break;m.lng>l.center.lng?m.lng-=360:m.lng+=360}return m.lng!==p.lng&&l.isPointOnMapSurface(l.locationToScreenPoint(m))?m:p}let Fc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function va(m,e,l){let d=m.classList;for(let p in Fc)d.remove(`maplibregl-${l}-anchor-${p}`);d.add(`maplibregl-${l}-anchor-${e}`)}class xa extends s.E{constructor(e){if(super(),this._onKeyPress=l=>{let d=l.code,p=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=l=>{let d=l.originalEvent.target,p=this._element;this._popup&&(d===p||p.contains(d))&&this.togglePopup()},this._update=l=>{if(!this._map)return;let d=this._map.loaded()&&!this._map.isMoving();(l?.type==="terrain"||l?.type==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=vn(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||l&&l.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${Fc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${p}`),B.frameAsync(new AbortController).then(()=>{this._updateOpacity(l&&l.type==="moveend")}).catch(()=>{})},this._onMove=l=>{if(!this._isDragging){let d=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=s.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div");let l=L.createNS("http://www.w3.org/2000/svg","svg"),d=41,p=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${d}px`),l.setAttributeNS(null,"width",`${p}px`),l.setAttributeNS(null,"viewBox",`0 0 ${p} ${d}`);let g=L.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");let x=L.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");let S=L.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");let E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let Y of E){let Q=L.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",Y.rx),Q.setAttributeNS(null,"ry",Y.ry),S.appendChild(Q)}let C=L.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);let D=L.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(D);let k=L.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");let R=L.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(R);let F=L.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");let U=L.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");let X=L.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");let W=L.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),U.appendChild(X),U.appendChild(W),x.appendChild(S),x.appendChild(C),x.appendChild(k),x.appendChild(F),x.appendChild(U),l.appendChild(x),l.setAttributeNS(null,"height",d*this._scale+"px"),l.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(l),this._offset=s.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),va(this._element,this._anchor,"marker"),e&&e.className)for(let l of e.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=s.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let p=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var l,d;let p=(l=this._map)===null||l===void 0?void 0:l.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!p||g){let F=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==F&&(this._element.style.opacity=F))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let x=this._map,S=x.terrain.depthAtPoint(this._pos),E=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,E)-S<.006)return void(this._element.style.opacity=this._opacity);let C=-this._offset.y/x.transform.pixelsPerMeter,D=Math.sin(x.getPitch()*Math.PI/180)*C,k=x.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),R=x.transform.lngLatToCameraDepth(this._lngLat,E+D)-k>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=s.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,l){return(this._opacity===void 0||e===void 0&&l===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),l!==void 0&&(this._opacityWhenCovered=l),this._map&&this._updateOpacity(!0),this}}let Zh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ba=0,xs=!1,yl={maxWidth:100,unit:"metric"};function zc(m,e,l){let d=l&&l.maxWidth||100,p=m._container.clientHeight/2,g=m._container.clientWidth/2,x=m.unproject([g-d/2,p]),S=m.unproject([g+d/2,p]),E=Math.round(m.project(S).x-m.project(x).x),C=Math.min(d,E,m._container.clientWidth),D=x.distanceTo(S);if(l&&l.unit==="imperial"){let k=3.2808*D;k>5280?bs(e,C,k/5280,m._getUIString("ScaleControl.Miles")):bs(e,C,k,m._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?bs(e,C,D/1852,m._getUIString("ScaleControl.NauticalMiles")):D>=1e3?bs(e,C,D/1e3,m._getUIString("ScaleControl.Kilometers")):bs(e,C,D,m._getUIString("ScaleControl.Meters"))}function bs(m,e,l,d){let p=function(g){let x=Math.pow(10,`${Math.floor(g)}`.length-1),S=g/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(E){let C=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*C)/C}(S),x*S}(l);m.style.width=e*(p/l)+"px",m.innerHTML=`${p}&nbsp;${d}`}let Wh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Xh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jc(m){if(m){if(typeof m=="number"){let e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,m),"top-left":new s.P(e,e),"top-right":new s.P(-e,e),bottom:new s.P(0,-m),"bottom-left":new s.P(e,-e),"bottom-right":new s.P(-e,-e),left:new s.P(m,0),right:new s.P(-m,0)}}if(m instanceof s.P||Array.isArray(m)){let e=s.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:s.P.convert(m.center||[0,0]),top:s.P.convert(m.top||[0,0]),"top-left":s.P.convert(m["top-left"]||[0,0]),"top-right":s.P.convert(m["top-right"]||[0,0]),bottom:s.P.convert(m.bottom||[0,0]),"bottom-left":s.P.convert(m["bottom-left"]||[0,0]),"bottom-right":s.P.convert(m["bottom-right"]||[0,0]),left:s.P.convert(m.left||[0,0]),right:s.P.convert(m.right||[0,0])}}return jc(new s.P(0,0))}let Yh=v;h.AJAXError=s.cz,h.Event=s.l,h.Evented=s.E,h.LngLat=s.S,h.MercatorCoordinate=s.a1,h.Point=s.P,h.addProtocol=s.cA,h.config=s.a,h.removeProtocol=s.cB,h.AttributionControl=qh,h.BoxZoomHandler=zh,h.CanvasSource=wo,h.CooperativeGesturesHandler=Mp,h.DoubleClickZoomHandler=Uh,h.DragPanHandler=bp,h.DragRotateHandler=Gh,h.EdgeInsets=as,h.FullscreenControl=class extends s.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let l=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=l?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)l=l.shadowRoot.fullscreenElement;l===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let m=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},h.GeoJSONSource=Li,h.GeolocateControl=class extends s.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let l=new s.S(e.coords.longitude,e.coords.latitude),d=e.coords.accuracy,p=this._map.getBearing(),g=s.e({bearing:p},this.options.fitBoundsOptions),x=gn.fromLngLat(l,d);this._map.fitBounds(x,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let l=new s.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&xs)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{let l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xa({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{let d=l?.[0]instanceof ResizeObserverEntry;l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))})}},this.options=s.e({},Zh,m)}onAdd(m){return this._map=m,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(e=!1){if(qt!==void 0&&!e)return qt;if(window.navigator.permissions===void 0)return qt=!!window.navigator.geolocation,qt;try{qt=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{qt=!!window.navigator.geolocation}return qt})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ba=0,xs=!1}_isOutOfMapMaxBounds(m){let e=this._map.getMaxBounds(),l=m.coords;return e&&(l.longitude<e.getWest()||l.longitude>e.getEast()||l.latitude<e.getSouth()||l.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let m=this._map.getBounds(),e=m.getSouthEast(),l=m.getNorthEast(),d=e.distanceTo(l),p=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ba--,xs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ba++,ba>1?(m={maximumAge:6e5,timeout:0},xs=!0):(m=this.options.positionOptions,xs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},h.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;let e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=L.create("button","maplibregl-ctrl-globe",this._container),L.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},h.Hash=Pc,h.ImageSource=Oi,h.KeyboardHandler=Rc,h.LngLatBounds=gn,h.LogoControl=Ep,h.Map=class extends Sp{constructor(m){var e,l;s.cw.mark(s.cx.create);let d=Object.assign(Object.assign(Object.assign({},Qr),m),{canvasContextAttributes:Object.assign(Object.assign({},Qr.canvasContextAttributes),m.canvasContextAttributes)});if(d.minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let p=new Kt,g=new ar;if(d.minZoom!==void 0&&p.setMinZoom(d.minZoom),d.maxZoom!==void 0&&p.setMaxZoom(d.maxZoom),d.minPitch!==void 0&&p.setMinPitch(d.minPitch),d.maxPitch!==void 0&&p.setMaxPitch(d.maxPitch),d.renderWorldCopies!==void 0&&p.setRenderWorldCopies(d.renderWorldCopies),super(p,g,{bearingSnap:d.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Vi,this._controls=[],this._mapId=s.a7(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},d.canvasContextAttributes),this._trackResize=d.trackResize===!0,this._bearingSnap=d.bearingSnap,this._centerClampedToGround=d.centerClampedToGround,this._refreshExpiredTiles=d.refreshExpiredTiles===!0,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions===!0,this._collectResourceTiming=d.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},vr),d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=d.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=We.addThrottleControl(()=>this.isMoving()),this._requestManager=new it(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1,E=ys(C=>{this._trackResize&&!this._removed&&(this.resize(C),this.redraw())},50);this._resizeObserver=new ResizeObserver(C=>{S?E(C):S=!0}),this._resizeObserver.observe(this._container)}this.handlers=new $h(this,d),this._hash=d.hash&&new Pc(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,elevation:d.elevation,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,roll:d.roll}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,s.e({},d.fitBoundsOptions,{duration:0}))));let x=typeof d.style=="string"||((l=(e=d.style)===null||e===void 0?void 0:e.projection)===null||l===void 0?void 0:l.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new qh(typeof d.attributionControl=="boolean"?void 0:d.attributionControl)),d.maplibreLogo&&this.addControl(new Ep,d.logoPosition),this.on("style.load",()=>{if(x||this._resizeTransform(),this.transform.unmodified){let S=s.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new s.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new s.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new s.l("sourcedataabort",S))})}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let l=m.onAdd(this);this._controls.push(m);let d=this._controlPositions[e];return e.indexOf("bottom")!==-1?d.insertBefore(l,d.firstChild):d.appendChild(l),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,l,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,l,d)}resize(m,e=!0){let[l,d]=this._containerDimensions(),p=this._getClampedPixelRatio(l,d);if(this._resizeCanvas(l,d,p),this.painter.resize(l,d,p),this.painter.overLimit()){let x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];let S=this._getClampedPixelRatio(l,d);this._resizeCanvas(l,d,S),this.painter.resize(l,d,S)}this._resizeTransform(e);let g=!this._moving;return g&&(this.stop(),this.fire(new s.l("movestart",m)).fire(new s.l("move",m))),this.fire(new s.l("resize",m)),g&&this.fire(new s.l("moveend",m)),this}_resizeTransform(m=!0){var e;let[l,d]=this._containerDimensions();this.transform.resize(l,d,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,d,m)}_getClampedPixelRatio(m,e){let{0:l,1:d}=this._maxCanvasSize,p=this.getPixelRatio(),g=m*p,x=e*p;return Math.min(g>l?l/g:1,x>d?d/x:1)*p}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(gn.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(s.S.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(s.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,l){if(m==="mouseenter"||m==="mouseover"){let d=!1;return{layers:e,listener:l,delegates:{mousemove:g=>{let x=e.filter(E=>this.getLayer(E)),S=x.length!==0?this.queryRenderedFeatures(g.point,{layers:x}):[];S.length?d||(d=!0,l.call(this,new Pr(m,this,g.originalEvent,{features:S}))):d=!1},mouseout:()=>{d=!1}}}}if(m==="mouseleave"||m==="mouseout"){let d=!1;return{layers:e,listener:l,delegates:{mousemove:x=>{let S=e.filter(E=>this.getLayer(E));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?d=!0:d&&(d=!1,l.call(this,new Pr(m,this,x.originalEvent)))},mouseout:x=>{d&&(d=!1,l.call(this,new Pr(m,this,x.originalEvent)))}}}}{let d=p=>{let g=e.filter(S=>this.getLayer(S)),x=g.length!==0?this.queryRenderedFeatures(p.point,{layers:g}):[];x.length&&(p.features=x,l.call(this,p),delete p.features)};return{layers:e,listener:l,delegates:{[m]:d}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,l){if(!this._delegatedListeners||!this._delegatedListeners[m])return;let d=this._delegatedListeners[m];for(let p=0;p<d.length;p++){let g=d[p];if(g.listener===l&&g.layers.length===e.length&&g.layers.every(x=>e.includes(x))){for(let x in g.delegates)this.off(x,g.delegates[x]);return void d.splice(p,1)}}}on(m,e,l){if(l===void 0)return super.on(m,e);let d=typeof e=="string"?[e]:e,p=this._createDelegatedListener(m,d,l);this._saveDelegatedListener(m,p);for(let g in p.delegates)this.on(g,p.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,d,l)}}}once(m,e,l){if(l===void 0)return super.once(m,e);let d=typeof e=="string"?[e]:e,p=this._createDelegatedListener(m,d,l);for(let g in p.delegates){let x=p.delegates[g];p.delegates[g]=(...S)=>{this._removeDelegatedListener(m,d,l),x(...S)}}this._saveDelegatedListener(m,p);for(let g in p.delegates)this.once(g,p.delegates[g]);return this}off(m,e,l){return l===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,l),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let l,d=m instanceof s.P||Array.isArray(m),p=d?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(d?{}:m)||{},p instanceof s.P||typeof p[0]=="number")l=[s.P.convert(p)];else{let g=s.P.convert(p[0]),x=s.P.convert(p[1]);l=[g,new s.P(x.x,g.y),x,new s.P(g.x,x.y),g]}return this.style.queryRenderedFeatures(l,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){let e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var l,d;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));let p=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new fh(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,p):this.style.loadJSON(m,e,p),this):((d=(l=this.style)===null||l===void 0?void 0:l.projection)===null||d===void 0||d.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){let l=this._requestManager.transformRequest(m,"Style");s.j(l,new AbortController).then(d=>{this._updateDiff(d.data,e)}).catch(d=>{d&&this.fire(new s.k(d))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(l){s.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){let e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new s.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){let e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(let l in this.style._layers){let d=this.style._layers[l];d.type==="hillshade"&&d.source===m.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),d.type==="color-relief"&&d.source===m.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new tt(this.painter,e,m),this.painter.renderToTexture=new Oc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=l=>{var d;l.dataType==="style"?this.terrain.sourceCache.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((d=l.source)===null||d===void 0?void 0:d.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let m=this.style&&this.style.sourceCaches;for(let e in m){let l=m[e]._tiles;for(let d in l){let p=l[d];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,l){if(l){let d=this.getSource(l);if(!d)throw new Error(`There is no source with ID "${l}", cannot set LOD parameters`);d.calculateTileZoom=Re(Math.max(1,m),Math.max(1,e))}else for(let d in this.style.sourceCaches)this.style.sourceCaches[d].getSource().calculateTileZoom=Re(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){let l=this.style.sourceCaches[m];if(!l)throw new Error(`There is no source cache with ID "${m}", cannot refresh tile`);e===void 0?l.reload(!0):l.refreshTiles(e.map(d=>new s.a4(d.z,d.x,d.y)))}addImage(m,e,l={}){let{pixelRatio:d=1,sdf:p=!1,stretchX:g,stretchY:x,content:S,textFitWidth:E,textFitHeight:C}=l;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||s.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:D,height:k,data:R}=e,F=e;return this.style.addImage(m,{data:new s.R({width:D,height:k},new Uint8Array(R)),pixelRatio:d,stretchX:g,stretchY:x,content:S,textFitWidth:E,textFitHeight:C,sdf:p,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m),this}}{let{width:D,height:k,data:R}=B.getImageData(e);this.style.addImage(m,{data:new s.R({width:D,height:k},R),pixelRatio:d,stretchX:g,stretchY:x,content:S,textFitWidth:E,textFitHeight:C,sdf:p,version:0})}}updateImage(m,e){let l=this.style.getImage(m);if(!l)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let d=e instanceof HTMLImageElement||s.b(e)?B.getImageData(e):e,{width:p,height:g,data:x}=d;if(p===void 0||g===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==l.data.width||g!==l.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let S=!(e instanceof HTMLImageElement||s.b(e));return l.data.replace(x,S),this.style.updateImage(m,l),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return We.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,l){return this.style.setLayerZoomRange(m,e,l),this._update(!0)}setFilter(m,e,l={}){return this.style.setFilter(m,e,l),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,l,d={}){return this.style.setPaintProperty(m,e,l,d),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,l,d={}){return this.style.setLayoutProperty(m,e,l,d),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,l,d=>{d||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,l=>{l||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){let m=this._container;m.classList.add("maplibregl-map");let e=this._canvasContainer=L.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let l=this._containerDimensions(),d=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],d);let p=this._controlContainer=L.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=L.create("div",`maplibregl-ctrl-${x} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,l){this._canvas.width=Math.floor(l*m),this._canvas.height=Math.floor(l*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{e={requestedAttributes:m},d&&(e.statusMessage=d.statusMessage,e.type=d.type)},{once:!0});let l=null;if(l=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!l){let d="Failed to initialize WebGL";throw e?(e.message=d,new Error(JSON.stringify(e))):new Error(d)}this.painter=new up(l,this.transform),ie.testSupport(l)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,l,d,p,g;let x=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let k=this.transform.zoom,R=B.now();this.style.zoomHistory.update(k,R);let F=new s.F(k,{now:R,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),U=F.crossFadingFactor();U===1&&U===this._crossFadingFactor||(E=!0,this._crossFadingFactor=U),this.style.update(F)}let C=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0!==S;(d=this.style.projection)===null||d===void 0||d.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cw.mark(s.cx.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,s.cw.mark(s.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(let l of this._controls)l.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),We.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cw.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,B.frame(this._frameRequest,m=>{s.cw.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!s.cy(e)&&!function(l){return l.message===al}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Ip}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},h.MapMouseEvent=Pr,h.MapTouchEvent=da,h.MapWheelEvent=Fh,h.Marker=xa,h.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{let e=this._map.getZoom(),l=e===this._map.getMaxZoom(),d=e===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,l)=>{let d=this._map._getUIString(`NavigationControl.${l}`);e.title=d,e.setAttribute("aria-label",d)},this.options=s.e({},F_,m),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _l(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){let l=L.create("button",m,this._container);return l.type="button",l.addEventListener("click",e),l}},h.Popup=class extends s.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=vn(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let d=this.options.anchor,p=jc(this.options.offset);if(!d){let x=this._container.offsetWidth,S=this._container.offsetHeight,E;E=l.y+p.bottom.y<S?["top"]:l.y>this._map.transform.height-S?["bottom"]:[],l.x<x/2?E.push("left"):l.x>this._map.transform.width-x/2&&E.push("right"),d=E.length===0?"bottom":E.join("-")}let g=l.add(p[d]);this.options.subpixelPositioning||(g=g.round()),L.setTransform(this._container,`${Fc[d]} translate(${g.x}px,${g.y}px)`),va(this._container,d,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Wh),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=s.S.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let e=document.createDocumentFragment(),l=document.createElement("body"),d;for(l.innerHTML=m;d=l.firstChild,d;)e.appendChild(d);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(Xh);m&&m.focus()}},h.RasterDEMTileSource=ns,h.RasterTileSource=Ni,h.ScaleControl=class{constructor(m){this._onMove=()=>{zc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,zc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},yl),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},h.ScrollZoomHandler=vp,h.Style=fh,h.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},h.TwoFingersTouchPitchHandler=Ac,h.TwoFingersTouchRotateHandler=_a,h.TwoFingersTouchZoomHandler=Dc,h.TwoFingersTouchZoomRotateHandler=wp,h.VectorTileSource=hi,h.VideoSource=Qs,h.addSourceType=(m,e)=>s._(void 0,void 0,void 0,function*(){if(So(m))throw new Error(`A source type called "${m}" already exists.`);((l,d)=>{Mo[l]=d})(m,e)}),h.clearPrewarmedResources=function(){let m=ki;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Jo),ki=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.createTileMesh=hh,h.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},h.getRTLTextPluginStatus=function(){return To().getRTLTextPluginStatus()},h.getVersion=function(){return Yh},h.getWorkerCount=function(){return or.workerCount},h.getWorkerUrl=function(){return s.a.WORKER_URL},h.importScriptInWorkers=function(m){return Xs().broadcast("IS",m)},h.prewarm=function(){ts().acquire(Jo)},h.setMaxParallelImageRequests=function(m){s.a.MAX_PARALLEL_IMAGE_REQUESTS=m},h.setRTLTextPlugin=function(m,e){return To().setRTLTextPlugin(m,e)},h.setWorkerCount=function(m){or.workerCount=m},h.setWorkerUrl=function(m){s.a.WORKER_URL=m}});var c=t;return c})});var Sy;function Hp(){return Sy}function Go(t){let r=Sy;return Sy=t,r}var nw=Symbol("NotFound");function ru(t){return t===nw||t?.name==="\u0275NotFound"}function rw(t,r){return Object.is(t,r)}var kr=null,qp=!1,Iy=1;var Zp=Symbol("SIGNAL");function Ut(t){let r=kr;return kr=t,r}function Ty(){return kr}var Wp={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Cy(t){if(qp)throw new Error("");if(kr===null)return;kr.consumerOnSignalRead(t);let r=kr.producersTail;if(r!==void 0&&r.producer===t)return;let i,c=kr.recomputing;if(c&&(i=r!==void 0?r.nextProducer:kr.producers,i!==void 0&&i.producer===t)){kr.producersTail=i,i.lastReadVersion=t.version;return}let h=t.consumersTail;if(h!==void 0&&h.consumer===kr&&(!c||jP(h,kr)))return;let s=iu(kr),v={producer:t,consumer:kr,nextProducer:i,prevConsumer:h,lastReadVersion:t.version,nextConsumer:void 0};kr.producersTail=v,r!==void 0?r.nextProducer=v:kr.producers=v,s&&aw(t,v)}function iw(){Iy++}function ow(t){if(!(iu(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===Iy)){if(!t.producerMustRecompute(t)&&!Yp(t)){Ey(t);return}t.producerRecomputeValue(t),Ey(t)}}function Py(t){if(t.consumers===void 0)return;let r=qp;qp=!0;try{for(let i=t.consumers;i!==void 0;i=i.nextConsumer){let c=i.consumer;c.dirty||zP(c)}}finally{qp=r}}function sw(){return kr?.consumerAllowSignalWrites!==!1}function zP(t){t.dirty=!0,Py(t),t.consumerMarkedDirty?.(t)}function Ey(t){t.dirty=!1,t.lastCleanEpoch=Iy}function Xp(t){return t&&(t.producersTail=void 0,t.recomputing=!0),Ut(t)}function Dy(t,r){if(Ut(r),!t)return;t.recomputing=!1;let i=t.producersTail,c=i!==void 0?i.nextProducer:t.producers;if(c!==void 0){if(iu(t))do c=Ay(c);while(c!==void 0);i!==void 0?i.nextProducer=void 0:t.producers=void 0}}function Yp(t){for(let r=t.producers;r!==void 0;r=r.nextProducer){let i=r.producer,c=r.lastReadVersion;if(c!==i.version||(ow(i),c!==i.version))return!0}return!1}function Kp(t){if(iu(t)){let r=t.producers;for(;r!==void 0;)r=Ay(r)}t.producers=void 0,t.producersTail=void 0,t.consumers=void 0,t.consumersTail=void 0}function aw(t,r){let i=t.consumersTail,c=iu(t);if(i!==void 0?(r.nextConsumer=i.nextConsumer,i.nextConsumer=r):(r.nextConsumer=void 0,t.consumers=r),r.prevConsumer=i,t.consumersTail=r,!c)for(let h=t.producers;h!==void 0;h=h.nextProducer)aw(h.producer,h)}function Ay(t){let r=t.producer,i=t.nextProducer,c=t.nextConsumer,h=t.prevConsumer;if(t.nextConsumer=void 0,t.prevConsumer=void 0,c!==void 0?c.prevConsumer=h:r.consumersTail=h,h!==void 0)h.nextConsumer=c;else if(r.consumers=c,!iu(r)){let s=r.producers;for(;s!==void 0;)s=Ay(s)}return i}function iu(t){return t.consumerIsAlwaysLive||t.consumers!==void 0}function jP(t,r){let i=r.producersTail;if(i!==void 0){let c=r.producers;do{if(c===t)return!0;if(c===i)break;c=c.nextProducer}while(c!==void 0)}return!1}function BP(){throw new Error}var lw=BP;function UP(t){lw(t)}function Ry(t){lw=t}var VP=null;function ky(t,r){sw()||UP(t),t.equal(t.value,r)||(t.value=r,GP(t))}var Ny=un(Je({},Wp),{equal:rw,value:void 0,kind:"signal"});function GP(t){t.version++,iw(),Py(t),VP?.(t)}function wt(t){return typeof t=="function"}function ou(t){let i=t(c=>{Error.call(c),c.stack=new Error().stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}var Qp=ou(t=>function(i){t(this),this.message=i?`${i.length} errors occurred during unsubscription:
${i.map((c,h)=>`${h+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=i});function pd(t,r){if(t){let i=t.indexOf(r);0<=i&&t.splice(i,1)}}var Wn=class t{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;let{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(let s of i)s.remove(this);else i.remove(this);let{initialTeardown:c}=this;if(wt(c))try{c()}catch(s){r=s instanceof Qp?s.errors:[s]}let{_finalizers:h}=this;if(h){this._finalizers=null;for(let s of h)try{cw(s)}catch(v){r=r??[],v instanceof Qp?r=[...r,...v.errors]:r.push(v)}}if(r)throw new Qp(r)}}add(r){var i;if(r&&r!==this)if(this.closed)cw(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(i=this._finalizers)!==null&&i!==void 0?i:[]).push(r)}}_hasParent(r){let{_parentage:i}=this;return i===r||Array.isArray(i)&&i.includes(r)}_addParent(r){let{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(r),i):i?[i,r]:r}_removeParent(r){let{_parentage:i}=this;i===r?this._parentage=null:Array.isArray(i)&&pd(i,r)}remove(r){let{_finalizers:i}=this;i&&pd(i,r),r instanceof t&&r._removeParent(this)}};Wn.EMPTY=(()=>{let t=new Wn;return t.closed=!0,t})();var Ly=Wn.EMPTY;function Jp(t){return t instanceof Wn||t&&"closed"in t&&wt(t.remove)&&wt(t.add)&&wt(t.unsubscribe)}function cw(t){wt(t)?t():t.unsubscribe()}var lo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var su={setTimeout(t,r,...i){let{delegate:c}=su;return c?.setTimeout?c.setTimeout(t,r,...i):setTimeout(t,r,...i)},clearTimeout(t){let{delegate:r}=su;return(r?.clearTimeout||clearTimeout)(t)},delegate:void 0};function em(t){su.setTimeout(()=>{let{onUnhandledError:r}=lo;if(r)r(t);else throw t})}function md(){}var uw=Oy("C",void 0,void 0);function hw(t){return Oy("E",void 0,t)}function dw(t){return Oy("N",t,void 0)}function Oy(t,r,i){return{kind:t,value:r,error:i}}var Il=null;function au(t){if(lo.useDeprecatedSynchronousErrorHandling){let r=!Il;if(r&&(Il={errorThrown:!1,error:null}),t(),r){let{errorThrown:i,error:c}=Il;if(Il=null,i)throw c}}else t()}function fw(t){lo.useDeprecatedSynchronousErrorHandling&&Il&&(Il.errorThrown=!0,Il.error=t)}var Tl=class extends Wn{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,Jp(r)&&r.add(this)):this.destination=qP}static create(r,i,c){return new lu(r,i,c)}next(r){this.isStopped?zy(dw(r),this):this._next(r)}error(r){this.isStopped?zy(hw(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?zy(uw,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},$P=Function.prototype.bind;function Fy(t,r){return $P.call(t,r)}var jy=class{constructor(r){this.partialObserver=r}next(r){let{partialObserver:i}=this;if(i.next)try{i.next(r)}catch(c){tm(c)}}error(r){let{partialObserver:i}=this;if(i.error)try{i.error(r)}catch(c){tm(c)}else tm(r)}complete(){let{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(i){tm(i)}}},lu=class extends Tl{constructor(r,i,c){super();let h;if(wt(r)||!r)h={next:r??void 0,error:i??void 0,complete:c??void 0};else{let s;this&&lo.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=()=>this.unsubscribe(),h={next:r.next&&Fy(r.next,s),error:r.error&&Fy(r.error,s),complete:r.complete&&Fy(r.complete,s)}):h=r}this.destination=new jy(h)}};function tm(t){lo.useDeprecatedSynchronousErrorHandling?fw(t):em(t)}function HP(t){throw t}function zy(t,r){let{onStoppedNotification:i}=lo;i&&su.setTimeout(()=>i(t,r))}var qP={closed:!0,next:md,error:HP,complete:md};var cu=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Ti(t){return t}function By(...t){return Uy(t)}function Uy(t){return t.length===0?Ti:t.length===1?t[0]:function(i){return t.reduce((c,h)=>h(c),i)}}var Vt=(()=>{class t{constructor(i){i&&(this._subscribe=i)}lift(i){let c=new t;return c.source=this,c.operator=i,c}subscribe(i,c,h){let s=WP(i)?i:new lu(i,c,h);return au(()=>{let{operator:v,source:w}=this;s.add(v?v.call(s,w):w?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(i){try{return this._subscribe(i)}catch(c){i.error(c)}}forEach(i,c){return c=pw(c),new c((h,s)=>{let v=new lu({next:w=>{try{i(w)}catch(I){s(I),v.unsubscribe()}},error:s,complete:h});this.subscribe(v)})}_subscribe(i){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(i)}[cu](){return this}pipe(...i){return Uy(i)(this)}toPromise(i){return i=pw(i),new i((c,h)=>{let s;this.subscribe(v=>s=v,v=>h(v),()=>c(s))})}}return t.create=r=>new t(r),t})();function pw(t){var r;return(r=t??lo.Promise)!==null&&r!==void 0?r:Promise}function ZP(t){return t&&wt(t.next)&&wt(t.error)&&wt(t.complete)}function WP(t){return t&&t instanceof Tl||ZP(t)&&Jp(t)}function Vy(t){return wt(t?.lift)}function zt(t){return r=>{if(Vy(r))return r.lift(function(i){try{return t(i,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function jt(t,r,i,c,h){return new Gy(t,r,i,c,h)}var Gy=class extends Tl{constructor(r,i,c,h,s,v){super(r),this.onFinalize=s,this.shouldUnsubscribe=v,this._next=i?function(w){try{i(w)}catch(I){r.error(I)}}:super._next,this._error=h?function(w){try{h(w)}catch(I){r.error(I)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(w){r.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:i}=this;super.unsubscribe(),!i&&((r=this.onFinalize)===null||r===void 0||r.call(this))}}};function uu(){return zt((t,r)=>{let i=null;t._refCount++;let c=jt(r,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){i=null;return}let h=t._connection,s=i;i=null,h&&(!s||h===s)&&h.unsubscribe(),r.unsubscribe()});t.subscribe(c),c.closed||(i=t.connect())})}var hu=class extends Vt{constructor(r,i){super(),this.source=r,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,Vy(r)&&(this.lift=r.lift)}_subscribe(r){return this.getSubject().subscribe(r)}getSubject(){let r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:r}=this;this._subject=this._connection=null,r?.unsubscribe()}connect(){let r=this._connection;if(!r){r=this._connection=new Wn;let i=this.getSubject();r.add(this.source.subscribe(jt(i,void 0,()=>{this._teardown(),i.complete()},c=>{this._teardown(),i.error(c)},()=>this._teardown()))),r.closed&&(this._connection=null,r=Wn.EMPTY)}return r}refCount(){return uu()(this)}};var mw=ou(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var hr=(()=>{class t extends Vt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){let c=new nm(this,this);return c.operator=i,c}_throwIfClosed(){if(this.closed)throw new mw}next(i){au(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(i)}})}error(i){au(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;let{observers:c}=this;for(;c.length;)c.shift().error(i)}})}complete(){au(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return((i=this.observers)===null||i===void 0?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){let{hasError:c,isStopped:h,observers:s}=this;return c||h?Ly:(this.currentObservers=null,s.push(i),new Wn(()=>{this.currentObservers=null,pd(s,i)}))}_checkFinalizedStatuses(i){let{hasError:c,thrownError:h,isStopped:s}=this;c?i.error(h):s&&i.complete()}asObservable(){let i=new Vt;return i.source=this,i}}return t.create=(r,i)=>new nm(r,i),t})(),nm=class extends hr{constructor(r,i){super(),this.destination=r,this.source=i}next(r){var i,c;(c=(i=this.destination)===null||i===void 0?void 0:i.next)===null||c===void 0||c.call(i,r)}error(r){var i,c;(c=(i=this.destination)===null||i===void 0?void 0:i.error)===null||c===void 0||c.call(i,r)}complete(){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||i===void 0||i.call(r)}_subscribe(r){var i,c;return(c=(i=this.source)===null||i===void 0?void 0:i.subscribe(r))!==null&&c!==void 0?c:Ly}};var Mr=class extends hr{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){let i=super._subscribe(r);return!i.closed&&r.next(this._value),i}getValue(){let{hasError:r,thrownError:i,_value:c}=this;if(r)throw i;return this._throwIfClosed(),c}next(r){super.next(this._value=r)}};var ei=new Vt(t=>t.complete());function gw(t){return t&&wt(t.schedule)}function _w(t){return t[t.length-1]}function yw(t){return wt(_w(t))?t.pop():void 0}function Pa(t){return gw(_w(t))?t.pop():void 0}function xw(t,r,i,c){function h(s){return s instanceof i?s:new i(function(v){v(s)})}return new(i||(i=Promise))(function(s,v){function w(B){try{N(c.next(B))}catch(L){v(L)}}function I(B){try{N(c.throw(B))}catch(L){v(L)}}function N(B){B.done?s(B.value):h(B.value).then(w,I)}N((c=c.apply(t,r||[])).next())})}function vw(t){var r=typeof Symbol=="function"&&Symbol.iterator,i=r&&t[r],c=0;if(i)return i.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&c>=t.length&&(t=void 0),{value:t&&t[c++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cl(t){return this instanceof Cl?(this.v=t,this):new Cl(t)}function bw(t,r,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=i.apply(t,r||[]),h,s=[];return h=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),w("next"),w("throw"),w("return",v),h[Symbol.asyncIterator]=function(){return this},h;function v(H){return function(me){return Promise.resolve(me).then(H,L)}}function w(H,me){c[H]&&(h[H]=function(Ee){return new Promise(function(Me,Ae){s.push([H,Ee,Me,Ae])>1||I(H,Ee)})},me&&(h[H]=me(h[H])))}function I(H,me){try{N(c[H](me))}catch(Ee){ie(s[0][3],Ee)}}function N(H){H.value instanceof Cl?Promise.resolve(H.value.v).then(B,L):ie(s[0][2],H)}function B(H){I("next",H)}function L(H){I("throw",H)}function ie(H,me){H(me),s.shift(),s.length&&I(s[0][0],s[0][1])}}function ww(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t[Symbol.asyncIterator],i;return r?r.call(t):(t=typeof vw=="function"?vw(t):t[Symbol.iterator](),i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i);function c(s){i[s]=t[s]&&function(v){return new Promise(function(w,I){v=t[s](v),h(w,I,v.done,v.value)})}}function h(s,v,w,I){Promise.resolve(I).then(function(N){s({value:N,done:w})},v)}}var rm=t=>t&&typeof t.length=="number"&&typeof t!="function";function im(t){return wt(t?.then)}function om(t){return wt(t[cu])}function sm(t){return Symbol.asyncIterator&&wt(t?.[Symbol.asyncIterator])}function am(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function XP(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var lm=XP();function cm(t){return wt(t?.[lm])}function um(t){return bw(this,arguments,function*(){let i=t.getReader();try{for(;;){let{value:c,done:h}=yield Cl(i.read());if(h)return yield Cl(void 0);yield yield Cl(c)}}finally{i.releaseLock()}})}function hm(t){return wt(t?.getReader)}function dr(t){if(t instanceof Vt)return t;if(t!=null){if(om(t))return YP(t);if(rm(t))return KP(t);if(im(t))return QP(t);if(sm(t))return Mw(t);if(cm(t))return JP(t);if(hm(t))return eD(t)}throw am(t)}function YP(t){return new Vt(r=>{let i=t[cu]();if(wt(i.subscribe))return i.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function KP(t){return new Vt(r=>{for(let i=0;i<t.length&&!r.closed;i++)r.next(t[i]);r.complete()})}function QP(t){return new Vt(r=>{t.then(i=>{r.closed||(r.next(i),r.complete())},i=>r.error(i)).then(null,em)})}function JP(t){return new Vt(r=>{for(let i of t)if(r.next(i),r.closed)return;r.complete()})}function Mw(t){return new Vt(r=>{tD(t,r).catch(i=>r.error(i))})}function eD(t){return Mw(um(t))}function tD(t,r){var i,c,h,s;return xw(this,void 0,void 0,function*(){try{for(i=ww(t);c=yield i.next(),!c.done;){let v=c.value;if(r.next(v),r.closed)return}}catch(v){h={error:v}}finally{try{c&&!c.done&&(s=i.return)&&(yield s.call(i))}finally{if(h)throw h.error}}r.complete()})}function ti(t,r,i,c=0,h=!1){let s=r.schedule(function(){i(),h?t.add(this.schedule(null,c)):this.unsubscribe()},c);if(t.add(s),!h)return s}function dm(t,r=0){return zt((i,c)=>{i.subscribe(jt(c,h=>ti(c,t,()=>c.next(h),r),()=>ti(c,t,()=>c.complete(),r),h=>ti(c,t,()=>c.error(h),r)))})}function fm(t,r=0){return zt((i,c)=>{c.add(t.schedule(()=>i.subscribe(c),r))})}function Sw(t,r){return dr(t).pipe(fm(r),dm(r))}function Ew(t,r){return dr(t).pipe(fm(r),dm(r))}function Iw(t,r){return new Vt(i=>{let c=0;return r.schedule(function(){c===t.length?i.complete():(i.next(t[c++]),i.closed||this.schedule())})})}function Tw(t,r){return new Vt(i=>{let c;return ti(i,r,()=>{c=t[lm](),ti(i,r,()=>{let h,s;try{({value:h,done:s}=c.next())}catch(v){i.error(v);return}s?i.complete():i.next(h)},0,!0)}),()=>wt(c?.return)&&c.return()})}function pm(t,r){if(!t)throw new Error("Iterable cannot be null");return new Vt(i=>{ti(i,r,()=>{let c=t[Symbol.asyncIterator]();ti(i,r,()=>{c.next().then(h=>{h.done?i.complete():i.next(h.value)})},0,!0)})})}function Cw(t,r){return pm(um(t),r)}function Pw(t,r){if(t!=null){if(om(t))return Sw(t,r);if(rm(t))return Iw(t,r);if(im(t))return Ew(t,r);if(sm(t))return pm(t,r);if(cm(t))return Tw(t,r);if(hm(t))return Cw(t,r)}throw am(t)}function Xn(t,r){return r?Pw(t,r):dr(t)}function gt(...t){let r=Pa(t);return Xn(t,r)}function du(t,r){let i=wt(t)?t:()=>t,c=h=>h.error(i());return new Vt(r?h=>r.schedule(c,0,h):c)}function $y(t){return!!t&&(t instanceof Vt||wt(t.lift)&&wt(t.subscribe))}var Is=ou(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function Bt(t,r){return zt((i,c)=>{let h=0;i.subscribe(jt(c,s=>{c.next(t.call(r,s,h++))}))})}var{isArray:nD}=Array;function rD(t,r){return nD(r)?t(...r):t(r)}function Dw(t){return Bt(r=>rD(t,r))}var{isArray:iD}=Array,{getPrototypeOf:oD,prototype:sD,keys:aD}=Object;function Aw(t){if(t.length===1){let r=t[0];if(iD(r))return{args:r,keys:null};if(lD(r)){let i=aD(r);return{args:i.map(c=>r[c]),keys:i}}}return{args:t,keys:null}}function lD(t){return t&&typeof t=="object"&&oD(t)===sD}function Rw(t,r){return t.reduce((i,c,h)=>(i[c]=r[h],i),{})}function mm(...t){let r=Pa(t),i=yw(t),{args:c,keys:h}=Aw(t);if(c.length===0)return Xn([],r);let s=new Vt(cD(c,r,h?v=>Rw(h,v):Ti));return i?s.pipe(Dw(i)):s}function cD(t,r,i=Ti){return c=>{kw(r,()=>{let{length:h}=t,s=new Array(h),v=h,w=h;for(let I=0;I<h;I++)kw(r,()=>{let N=Xn(t[I],r),B=!1;N.subscribe(jt(c,L=>{s[I]=L,B||(B=!0,w--),w||c.next(i(s.slice()))},()=>{--v||c.complete()}))},c)},c)}}function kw(t,r,i){t?ti(i,t,r):r()}function Nw(t,r,i,c,h,s,v,w){let I=[],N=0,B=0,L=!1,ie=()=>{L&&!I.length&&!N&&r.complete()},H=Ee=>N<c?me(Ee):I.push(Ee),me=Ee=>{s&&r.next(Ee),N++;let Me=!1;dr(i(Ee,B++)).subscribe(jt(r,Ae=>{h?.(Ae),s?H(Ae):r.next(Ae)},()=>{Me=!0},void 0,()=>{if(Me)try{for(N--;I.length&&N<c;){let Ae=I.shift();v?ti(r,v,()=>me(Ae)):me(Ae)}ie()}catch(Ae){r.error(Ae)}}))};return t.subscribe(jt(r,H,()=>{L=!0,ie()})),()=>{w?.()}}function nr(t,r,i=1/0){return wt(r)?nr((c,h)=>Bt((s,v)=>r(c,s,h,v))(dr(t(c,h))),i):(typeof r=="number"&&(i=r),zt((c,h)=>Nw(c,h,t,i)))}function Lw(t=1/0){return nr(Ti,t)}function Ow(){return Lw(1)}function fu(...t){return Ow()(Xn(t,Pa(t)))}function gd(t){return new Vt(r=>{dr(t()).subscribe(r)})}function Gi(t,r){return zt((i,c)=>{let h=0;i.subscribe(jt(c,s=>t.call(r,s,h++)&&c.next(s)))})}function Da(t){return zt((r,i)=>{let c=null,h=!1,s;c=r.subscribe(jt(i,void 0,void 0,v=>{s=dr(t(v,Da(t)(r))),c?(c.unsubscribe(),c=null,s.subscribe(i)):h=!0})),h&&(c.unsubscribe(),c=null,s.subscribe(i))})}function Fw(t,r,i,c,h){return(s,v)=>{let w=i,I=r,N=0;s.subscribe(jt(v,B=>{let L=N++;I=w?t(I,B,L):(w=!0,B),c&&v.next(I)},h&&(()=>{w&&v.next(I),v.complete()})))}}function pu(t,r){return wt(r)?nr(t,r,1):nr(t,1)}function Aa(t){return zt((r,i)=>{let c=!1;r.subscribe(jt(i,h=>{c=!0,i.next(h)},()=>{c||i.next(t),i.complete()}))})}function Ts(t){return t<=0?()=>ei:zt((r,i)=>{let c=0;r.subscribe(jt(i,h=>{++c<=t&&(i.next(h),t<=c&&i.complete())}))})}function gm(t=uD){return zt((r,i)=>{let c=!1;r.subscribe(jt(i,h=>{c=!0,i.next(h)},()=>c?i.complete():i.error(t())))})}function uD(){return new Is}function _d(t){return zt((r,i)=>{try{r.subscribe(i)}finally{i.add(t)}})}function Cs(t,r){let i=arguments.length>=2;return c=>c.pipe(t?Gi((h,s)=>t(h,s,c)):Ti,Ts(1),i?Aa(r):gm(()=>new Is))}function mu(t){return t<=0?()=>ei:zt((r,i)=>{let c=[];r.subscribe(jt(i,h=>{c.push(h),t<c.length&&c.shift()},()=>{for(let h of c)i.next(h);i.complete()},void 0,()=>{c=null}))})}function Hy(t,r){let i=arguments.length>=2;return c=>c.pipe(t?Gi((h,s)=>t(h,s,c)):Ti,mu(1),i?Aa(r):gm(()=>new Is))}function qy(t,r){return zt(Fw(t,r,arguments.length>=2,!0))}function Zy(...t){let r=Pa(t);return zt((i,c)=>{(r?fu(t,i,r):fu(t,i)).subscribe(c)})}function ni(t,r){return zt((i,c)=>{let h=null,s=0,v=!1,w=()=>v&&!h&&c.complete();i.subscribe(jt(c,I=>{h?.unsubscribe();let N=0,B=s++;dr(t(I,B)).subscribe(h=jt(c,L=>c.next(r?r(I,L,B,N++):L),()=>{h=null,w()}))},()=>{v=!0,w()}))})}function _m(t){return zt((r,i)=>{dr(t).subscribe(jt(i,()=>i.complete(),md)),!i.closed&&r.subscribe(i)})}function fr(t,r,i){let c=wt(t)||r||i?{next:t,error:r,complete:i}:t;return c?zt((h,s)=>{var v;(v=c.subscribe)===null||v===void 0||v.call(c);let w=!0;h.subscribe(jt(s,I=>{var N;(N=c.next)===null||N===void 0||N.call(c,I),s.next(I)},()=>{var I;w=!1,(I=c.complete)===null||I===void 0||I.call(c),s.complete()},I=>{var N;w=!1,(N=c.error)===null||N===void 0||N.call(c,I),s.error(I)},()=>{var I,N;w&&((I=c.unsubscribe)===null||I===void 0||I.call(c)),(N=c.finalize)===null||N===void 0||N.call(c)}))}):Ti}var at=class extends Error{code;constructor(r,i){super(Mm(r,i)),this.code=r}};function dD(t){return`NG0${Math.abs(t)}`}function Mm(t,r){return`${dD(t)}${r?": "+r:""}`}function Qt(t){for(let r in t)if(t[r]===Qt)return r;throw Error("")}function Ra(t){if(typeof t=="string")return t;if(Array.isArray(t))return`[${t.map(Ra).join(", ")}]`;if(t==null)return""+t;let r=t.overriddenName||t.name;if(r)return`${r}`;let i=t.toString();if(i==null)return""+i;let c=i.indexOf(`
`);return c>=0?i.slice(0,c):i}function ov(t,r){return t?r?`${t} ${r}`:t:r||""}var fD=Qt({__forward_ref__:Qt});function Sm(t){return t.__forward_ref__=Sm,t.toString=function(){return Ra(this())},t}function ri(t){return sv(t)?t():t}function sv(t){return typeof t=="function"&&t.hasOwnProperty(fD)&&t.__forward_ref__===Sm}function Bw(t,r){t==null&&av(r,t,null,"!=")}function av(t,r,i,c){throw new Error(`ASSERTION ERROR: ${t}`+(c==null?"":` [Expected=> ${i} ${c} ${r} <=Actual]`))}function lt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function wd(t){return pD(t,Em)}function lv(t){return wd(t)!==null}function pD(t,r){return t.hasOwnProperty(r)&&t[r]||null}function mD(t){let r=t?.[Em]??null;return r||null}function Xy(t){return t&&t.hasOwnProperty(vm)?t[vm]:null}var Em=Qt({\u0275prov:Qt}),vm=Qt({\u0275inj:Qt}),pt=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(r,i){this._desc=r,this.\u0275prov=void 0,typeof i=="number"?this.__NG_ELEMENT_ID__=i:i!==void 0&&(this.\u0275prov=lt({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function cv(t){return t&&!!t.\u0275providers}var uv=Qt({\u0275cmp:Qt}),hv=Qt({\u0275dir:Qt}),dv=Qt({\u0275pipe:Qt}),fv=Qt({\u0275mod:Qt}),xd=Qt({\u0275fac:Qt}),Nl=Qt({__NG_ELEMENT_ID__:Qt}),zw=Qt({__NG_ENV_ID__:Qt});function Uw(t){return typeof t=="string"?t:t==null?"":String(t)}function xm(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():Uw(t)}var pv=Qt({ngErrorCode:Qt}),Vw=Qt({ngErrorMessage:Qt}),vd=Qt({ngTokenPath:Qt});function mv(t,r){return Gw("",-200,r)}function Im(t,r){throw new at(-201,!1)}function gD(t,r){t[vd]??=[];let i=t[vd],c;typeof r=="object"&&"multi"in r&&r?.multi===!0?(Bw(r.provide,"Token with multi: true should have a provide property"),c=xm(r.provide)):c=xm(r),i[0]!==c&&t[vd].unshift(c)}function _D(t,r){let i=t[vd],c=t[pv],h=t[Vw]||t.message;return t.message=vD(h,c,i,r),t}function Gw(t,r,i){let c=new at(r,t);return c[pv]=r,c[Vw]=t,i&&(c[vd]=i),c}function yD(t){return t[pv]}function vD(t,r,i=[],c=null){let h="";i&&i.length>1&&(h=` Path: ${i.join(" -> ")}.`);let s=c?` Source: ${c}.`:"";return Mm(r,`${t}${s}${h}`)}var Yy;function $w(){return Yy}function Ci(t){let r=Yy;return Yy=t,r}function gv(t,r,i){let c=wd(t);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(i&8)return null;if(r!==void 0)return r;Im(t,"Injector")}var xD={},Pl=xD,bD="__NG_DI_FLAG__",Ky=class{injector;constructor(r){this.injector=r}retrieve(r,i){let c=Dl(i)||0;try{return this.injector.get(r,c&8?null:Pl,c)}catch(h){if(ru(h))return h;throw h}}};function wD(t,r=0){let i=Hp();if(i===void 0)throw new at(-203,!1);if(i===null)return gv(t,void 0,r);{let c=MD(r),h=i.retrieve(t,c);if(ru(h)){if(c.optional)return null;throw h}return h}}function It(t,r=0){return($w()||wD)(ri(t),r)}function He(t,r){return It(t,Dl(r))}function Dl(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function MD(t){return{optional:!!(t&8),host:!!(t&1),self:!!(t&2),skipSelf:!!(t&4)}}function Qy(t){let r=[];for(let i=0;i<t.length;i++){let c=ri(t[i]);if(Array.isArray(c)){if(c.length===0)throw new at(900,!1);let h,s=0;for(let v=0;v<c.length;v++){let w=c[v],I=SD(w);typeof I=="number"?I===-1?h=w.token:s|=I:h=w}r.push(It(h,s))}else r.push(It(c))}return r}function SD(t){return t[bD]}function Al(t,r){let i=t.hasOwnProperty(xd);return i?t[xd]:null}function Hw(t,r,i){if(t.length!==r.length)return!1;for(let c=0;c<t.length;c++){let h=t[c],s=r[c];if(i&&(h=i(h),s=i(s)),s!==h)return!1}return!0}function qw(t){return t.flat(Number.POSITIVE_INFINITY)}function Tm(t,r){t.forEach(i=>Array.isArray(i)?Tm(i,r):r(i))}function _v(t,r,i){r>=t.length?t.push(i):t.splice(r,0,i)}function Md(t,r){return r>=t.length-1?t.pop():t.splice(r,1)[0]}var Ll={},Rl=[],Ds=new pt(""),yv=new pt("",-1),vv=new pt(""),bd=class{get(r,i=Pl){if(i===Pl){let h=Gw("",-201);throw h.name="\u0275NotFound",h}return i}};function xv(t){return t[fv]||null}function La(t){return t[uv]||null}function bv(t){return t[hv]||null}function Zw(t){return t[dv]||null}function Ol(t){return{\u0275providers:t}}function Ww(t){return Ol([{provide:Ds,multi:!0,useValue:t}])}function Xw(...t){return{\u0275providers:wv(!0,t),\u0275fromNgModule:!0}}function wv(t,...r){let i=[],c=new Set,h,s=v=>{i.push(v)};return Tm(r,v=>{let w=v;bm(w,s,[],c)&&(h||=[],h.push(w))}),h!==void 0&&Yw(h,s),i}function Yw(t,r){for(let i=0;i<t.length;i++){let{ngModule:c,providers:h}=t[i];Mv(h,s=>{r(s,c)})}}function bm(t,r,i,c){if(t=ri(t),!t)return!1;let h=null,s=Xy(t),v=!s&&La(t);if(!s&&!v){let I=t.ngModule;if(s=Xy(I),s)h=I;else return!1}else{if(v&&!v.standalone)return!1;h=t}let w=c.has(h);if(v){if(w)return!1;if(c.add(h),v.dependencies){let I=typeof v.dependencies=="function"?v.dependencies():v.dependencies;for(let N of I)bm(N,r,i,c)}}else if(s){if(s.imports!=null&&!w){c.add(h);let N;try{Tm(s.imports,B=>{bm(B,r,i,c)&&(N||=[],N.push(B))})}finally{}N!==void 0&&Yw(N,r)}if(!w){let N=Al(h)||(()=>new h);r({provide:h,useFactory:N,deps:Rl},h),r({provide:vv,useValue:h,multi:!0},h),r({provide:Ds,useValue:()=>It(h),multi:!0},h)}let I=s.providers;if(I!=null&&!w){let N=t;Mv(I,B=>{r(B,N)})}}else return!1;return h!==t&&t.providers!==void 0}function Mv(t,r){for(let i of t)cv(i)&&(i=i.\u0275providers),Array.isArray(i)?Mv(i,r):r(i)}var ED=Qt({provide:String,useValue:Qt});function Kw(t){return t!==null&&typeof t=="object"&&ED in t}function ID(t){return!!(t&&t.useExisting)}function TD(t){return!!(t&&t.useFactory)}function wm(t){return typeof t=="function"}var Sd=new pt(""),ym={},jw={},Wy;function Ed(){return Wy===void 0&&(Wy=new bd),Wy}var Sr=class{},kl=class extends Sr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(r,i,c,h){super(),this.parent=i,this.source=c,this.scopes=h,ev(r,v=>this.processProvider(v)),this.records.set(yv,gu(void 0,this)),h.has("environment")&&this.records.set(Sr,gu(void 0,this));let s=this.records.get(Sd);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(vv,Rl,{self:!0}))}retrieve(r,i){let c=Dl(i)||0;try{return this.get(r,Pl,c)}catch(h){if(ru(h))return h;throw h}}destroy(){yd(this),this._destroyed=!0;let r=Ut(null);try{for(let c of this._ngOnDestroyHooks)c.ngOnDestroy();let i=this._onDestroyHooks;this._onDestroyHooks=[];for(let c of i)c()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ut(r)}}onDestroy(r){return yd(this),this._onDestroyHooks.push(r),()=>this.removeOnDestroy(r)}runInContext(r){yd(this);let i=Go(this),c=Ci(void 0),h;try{return r()}finally{Go(i),Ci(c)}}get(r,i=Pl,c){if(yd(this),r.hasOwnProperty(zw))return r[zw](this);let h=Dl(c),s,v=Go(this),w=Ci(void 0);try{if(!(h&4)){let N=this.records.get(r);if(N===void 0){let B=RD(r)&&wd(r);B&&this.injectableDefInScope(B)?N=gu(Jy(r),ym):N=null,this.records.set(r,N)}if(N!=null)return this.hydrate(r,N,h)}let I=h&2?Ed():this.parent;return i=h&8&&i===Pl?null:i,I.get(r,i)}catch(I){let N=yD(I);throw N===-200||N===-201?new at(N,null):I}finally{Ci(w),Go(v)}}resolveInjectorInitializers(){let r=Ut(null),i=Go(this),c=Ci(void 0),h;try{let s=this.get(Ds,Rl,{self:!0});for(let v of s)v()}finally{Go(i),Ci(c),Ut(r)}}toString(){let r=[],i=this.records;for(let c of i.keys())r.push(Ra(c));return`R3Injector[${r.join(", ")}]`}processProvider(r){r=ri(r);let i=wm(r)?r:ri(r&&r.provide),c=PD(r);if(!wm(r)&&r.multi===!0){let h=this.records.get(i);h||(h=gu(void 0,ym,!0),h.factory=()=>Qy(h.multi),this.records.set(i,h)),i=r,h.multi.push(r)}this.records.set(i,c)}hydrate(r,i,c){let h=Ut(null);try{if(i.value===jw)throw mv(Ra(r));return i.value===ym&&(i.value=jw,i.value=i.factory(void 0,c)),typeof i.value=="object"&&i.value&&AD(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}finally{Ut(h)}}injectableDefInScope(r){if(!r.providedIn)return!1;let i=ri(r.providedIn);return typeof i=="string"?i==="any"||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(r){let i=this._onDestroyHooks.indexOf(r);i!==-1&&this._onDestroyHooks.splice(i,1)}};function Jy(t){let r=wd(t),i=r!==null?r.factory:Al(t);if(i!==null)return i;if(t instanceof pt)throw new at(204,!1);if(t instanceof Function)return CD(t);throw new at(204,!1)}function CD(t){if(t.length>0)throw new at(204,!1);let i=mD(t);return i!==null?()=>i.factory(t):()=>new t}function PD(t){if(Kw(t))return gu(void 0,t.useValue);{let r=Qw(t);return gu(r,ym)}}function Qw(t,r,i){let c;if(wm(t)){let h=ri(t);return Al(h)||Jy(h)}else if(Kw(t))c=()=>ri(t.useValue);else if(TD(t))c=()=>t.useFactory(...Qy(t.deps||[]));else if(ID(t))c=(h,s)=>It(ri(t.useExisting),s!==void 0&&s&8?8:void 0);else{let h=ri(t&&(t.useClass||t.provide));if(DD(t))c=()=>new h(...Qy(t.deps));else return Al(h)||Jy(h)}return c}function yd(t){if(t.destroyed)throw new at(205,!1)}function gu(t,r,i=!1){return{factory:t,value:r,multi:i?[]:void 0}}function DD(t){return!!t.deps}function AD(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function RD(t){return typeof t=="function"||typeof t=="object"&&t.ngMetadataName==="InjectionToken"}function ev(t,r){for(let i of t)Array.isArray(i)?ev(i,r):i&&cv(i)?ev(i.\u0275providers,r):r(i)}function $r(t,r){let i;t instanceof kl?(yd(t),i=t):i=new Ky(t);let c,h=Go(i),s=Ci(void 0);try{return r()}finally{Go(h),Ci(s)}}function Jw(){return $w()!==void 0||Hp()!=null}var co=0,Mt=1,Tt=2,pr=3,$i=4,Hi=5,Id=6,Td=7,Pi=8,_u=9,As=10,qi=11,yu=12,Sv=13,vu=14,Zi=15,Oa=16,Fl=17,qo=18,Cd=19,Ev=20,Ps=21,Cm=22,Pd=23,Di=24,Pm=25,uo=26,eM=1;var Fa=7,Dd=8,zl=9,Hr=10;function Rs(t){return Array.isArray(t)&&typeof t[eM]=="object"}function ho(t){return Array.isArray(t)&&t[eM]===!0}function Iv(t){return(t.flags&4)!==0}function xu(t){return t.componentOffset>-1}function Tv(t){return(t.flags&1)===1}function jl(t){return!!t.template}function bu(t){return(t[Tt]&512)!==0}function Bl(t){return(t[Tt]&256)===256}var tM="svg",nM="math";function Zo(t){for(;Array.isArray(t);)t=t[co];return t}function za(t,r){return Zo(r[t.index])}function Cv(t,r){return t.data[r]}function ks(t,r){let i=r[t];return Rs(i)?i:i[co]}function rM(t){return(t[Tt]&4)===4}function Dm(t){return(t[Tt]&128)===128}function iM(t){return ho(t[pr])}function Ad(t,r){return r==null?null:t[r]}function Pv(t){t[Fl]=0}function Dv(t){t[Tt]&1024||(t[Tt]|=1024,Dm(t)&&kd(t))}function Rd(t){return!!(t[Tt]&9216||t[Di]?.dirty)}function Am(t){t[As].changeDetectionScheduler?.notify(8),t[Tt]&64&&(t[Tt]|=1024),Rd(t)&&kd(t)}function kd(t){t[As].changeDetectionScheduler?.notify(0);let r=ka(t);for(;r!==null&&!(r[Tt]&8192||(r[Tt]|=8192,!Dm(r)));)r=ka(r)}function Av(t,r){if(Bl(t))throw new at(911,!1);t[Ps]===null&&(t[Ps]=[]),t[Ps].push(r)}function oM(t,r){if(t[Ps]===null)return;let i=t[Ps].indexOf(r);i!==-1&&t[Ps].splice(i,1)}function ka(t){let r=t[pr];return ho(r)?r[pr]:r}function sM(t){return t[Td]??=[]}function aM(t){return t.cleanup??=[]}function lM(t,r,i,c){let h=sM(r);h.push(i),t.firstCreatePass&&aM(t).push(c,h.length-1)}var rn={lFrame:xM(null),bindingsEnabled:!0,skipHydrationRootTNode:null},Nd=function(t){return t[t.Off=0]="Off",t[t.Exhaustive=1]="Exhaustive",t[t.OnlyDirtyViews=2]="OnlyDirtyViews",t}(Nd||{}),kD=0,tv=!1;function cM(){return rn.lFrame.elementDepthCount}function uM(){rn.lFrame.elementDepthCount++}function Rv(){rn.lFrame.elementDepthCount--}function hM(){return rn.bindingsEnabled}function dM(){return rn.skipHydrationRootTNode!==null}function kv(t){return rn.skipHydrationRootTNode===t}function Nv(){rn.skipHydrationRootTNode=null}function Nr(){return rn.lFrame.lView}function Rm(){return rn.lFrame.tView}function fo(){let t=Lv();for(;t!==null&&t.type===64;)t=t.parent;return t}function Lv(){return rn.lFrame.currentTNode}function fM(){let t=rn.lFrame,r=t.currentTNode;return t.isParent?r:r.parent}function km(t,r){let i=rn.lFrame;i.currentTNode=t,i.isParent=r}function Ov(){return rn.lFrame.isParent}function pM(){rn.lFrame.isParent=!1}function Fv(t){av("Must never be called in production mode"),kD=t}function zv(){return tv}function jv(t){let r=tv;return tv=t,r}function mM(t){return rn.lFrame.bindingIndex=t}function gM(){return rn.lFrame.inI18n}function _M(t,r){let i=rn.lFrame;i.bindingIndex=i.bindingRootIndex=t,Nm(r)}function yM(){return rn.lFrame.currentDirectiveIndex}function Nm(t){rn.lFrame.currentDirectiveIndex=t}function Bv(){return rn.lFrame.currentQueryIndex}function Lm(t){rn.lFrame.currentQueryIndex=t}function ND(t){let r=t[Mt];return r.type===2?r.declTNode:r.type===1?t[Hi]:null}function Uv(t,r,i){if(i&4){let h=r,s=t;for(;h=h.parent,h===null&&!(i&1);)if(h=ND(s),h===null||(s=s[vu],h.type&10))break;if(h===null)return!1;r=h,t=s}let c=rn.lFrame=vM();return c.currentTNode=r,c.lView=t,!0}function Om(t){let r=vM(),i=t[Mt];rn.lFrame=r,r.currentTNode=i.firstChild,r.lView=t,r.tView=i,r.contextLView=t,r.bindingIndex=i.bindingStartIndex,r.inI18n=!1}function vM(){let t=rn.lFrame,r=t===null?null:t.child;return r===null?xM(t):r}function xM(t){let r={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=r),r}function bM(){let t=rn.lFrame;return rn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var Vv=bM;function Fm(){let t=bM();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function wM(){return rn.lFrame.selectedIndex}function ja(t){rn.lFrame.selectedIndex=t}function MM(){return rn.lFrame.currentNamespace}var SM=!0;function EM(){return SM}function IM(t){SM=t}function nv(t,r=null,i=null,c){let h=Gv(t,r,i,c);return h.resolveInjectorInitializers(),h}function Gv(t,r=null,i=null,c,h=new Set){let s=[i||Rl,Xw(t)];return c=c||(typeof t=="object"?void 0:Ra(t)),new kl(s,r||Ed(),c||null,h)}var $o=class t{static THROW_IF_NOT_FOUND=Pl;static NULL=new bd;static create(r,i){if(Array.isArray(r))return nv({name:""},i,r,"");{let c=r.name??"";return nv({name:c},r.parent,r.providers,c)}}static \u0275prov=lt({token:t,providedIn:"any",factory:()=>It(yv)});static __NG_ELEMENT_ID__=-1},mr=new pt(""),Ul=(()=>{class t{static __NG_ELEMENT_ID__=LD;static __NG_ENV_ID__=i=>i}return t})(),rv=class extends Ul{_lView;constructor(r){super(),this._lView=r}get destroyed(){return Bl(this._lView)}onDestroy(r){let i=this._lView;return Av(i,r),()=>oM(i,r)}};function LD(){return new rv(Nr())}var Ho=class{_console=console;handleError(r){this._console.error("ERROR",r)}},po=new pt("",{providedIn:"root",factory:()=>{let t=He(Sr),r;return i=>{t.destroyed&&!r?setTimeout(()=>{throw i}):(r??=t.get(Ho),r.handleError(i))}}}),TM={provide:Ds,useValue:()=>void He(Ho),multi:!0},OD=new pt("",{providedIn:"root",factory:()=>{let t=He(mr).defaultView;if(!t)return;let r=He(po),i=s=>{r(s.reason),s.preventDefault()},c=s=>{s.error?r(s.error):r(new Error(s.message,{cause:s})),s.preventDefault()},h=()=>{t.addEventListener("unhandledrejection",i),t.addEventListener("error",c)};typeof Zone<"u"?Zone.root.run(h):h(),He(Ul).onDestroy(()=>{t.removeEventListener("error",c),t.removeEventListener("unhandledrejection",i)})}});function $v(){return Ol([Ww(()=>void He(OD))])}var Na=class{},Ld=new pt("",{providedIn:"root",factory:()=>!1});var Hv=new pt(""),zm=new pt("");var Ns=(()=>{class t{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Mr(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Vt(i=>{i.next(!1),i.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let i=this.taskId++;return this.pendingTasks.add(i),i}has(i){return this.pendingTasks.has(i)}remove(i){this.pendingTasks.delete(i),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=lt({token:t,providedIn:"root",factory:()=>new t})}return t})();function Od(...t){}var qv=(()=>{class t{static \u0275prov=lt({token:t,providedIn:"root",factory:()=>new iv})}return t})(),iv=class{dirtyEffectCount=0;queues=new Map;add(r){this.enqueue(r),this.schedule(r)}schedule(r){r.dirty&&this.dirtyEffectCount++}remove(r){let i=r.zone,c=this.queues.get(i);c.has(r)&&(c.delete(r),r.dirty&&this.dirtyEffectCount--)}enqueue(r){let i=r.zone;this.queues.has(i)||this.queues.set(i,new Set);let c=this.queues.get(i);c.has(r)||c.add(r)}flush(){for(;this.dirtyEffectCount>0;){let r=!1;for(let[i,c]of this.queues)i===null?r||=this.flushQueue(c):r||=i.run(()=>this.flushQueue(c));r||(this.dirtyEffectCount=0)}}flushQueue(r){let i=!1;for(let c of r)c.dirty&&(this.dirtyEffectCount--,i=!0,c.run());return i}};function ng(t){return{toString:t}.toString()}function KD(t){return typeof t=="function"}var Gm=class{previousValue;currentValue;firstChange;constructor(r,i,c){this.previousValue=r,this.currentValue=i,this.firstChange=c}isFirstChange(){return this.firstChange}};function tS(t,r,i,c){r!==null?r.applyValueToInputSignal(r,c):t[i]=c}var y0=(()=>{let t=()=>nS;return t.ngInherit=!0,t})();function nS(t){return t.type.prototype.ngOnChanges&&(t.setInput=JD),QD}function QD(){let t=iS(this),r=t?.current;if(r){let i=t.previous;if(i===Ll)t.previous=r;else for(let c in r)i[c]=r[c];t.current=null,this.ngOnChanges(r)}}function JD(t,r,i,c,h){let s=this.declaredInputs[c],v=iS(t)||eA(t,{previous:Ll,current:null}),w=v.current||(v.current={}),I=v.previous,N=I[s];w[s]=new Gm(N&&N.currentValue,i,I===Ll),tS(t,r,h,i)}var rS="__ngSimpleChanges__";function iS(t){return t[rS]||null}function eA(t,r){return t[rS]=r}var CM=[];var mn=function(t,r=null,i){for(let c=0;c<CM.length;c++){let h=CM[c];h(t,r,i)}};function tA(t,r,i){let{ngOnChanges:c,ngOnInit:h,ngDoCheck:s}=r.type.prototype;if(c){let v=nS(r);(i.preOrderHooks??=[]).push(t,v),(i.preOrderCheckHooks??=[]).push(t,v)}h&&(i.preOrderHooks??=[]).push(0-t,h),s&&((i.preOrderHooks??=[]).push(t,s),(i.preOrderCheckHooks??=[]).push(t,s))}function nA(t,r){for(let i=r.directiveStart,c=r.directiveEnd;i<c;i++){let s=t.data[i].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:w,ngAfterViewInit:I,ngAfterViewChecked:N,ngOnDestroy:B}=s;v&&(t.contentHooks??=[]).push(-i,v),w&&((t.contentHooks??=[]).push(i,w),(t.contentCheckHooks??=[]).push(i,w)),I&&(t.viewHooks??=[]).push(-i,I),N&&((t.viewHooks??=[]).push(i,N),(t.viewCheckHooks??=[]).push(i,N)),B!=null&&(t.destroyHooks??=[]).push(i,B)}}function jm(t,r,i){oS(t,r,3,i)}function Bm(t,r,i,c){(t[Tt]&3)===i&&oS(t,r,i,c)}function Zv(t,r){let i=t[Tt];(i&3)===r&&(i&=16383,i+=1,t[Tt]=i)}function oS(t,r,i,c){let h=c!==void 0?t[Fl]&65535:0,s=c??-1,v=r.length-1,w=0;for(let I=h;I<v;I++)if(typeof r[I+1]=="number"){if(w=r[I],c!=null&&w>=c)break}else r[I]<0&&(t[Fl]+=65536),(w<s||s==-1)&&(rA(t,i,r,I),t[Fl]=(t[Fl]&4294901760)+I+2),I++}function PM(t,r){mn(4,t,r);let i=Ut(null);try{r.call(t)}finally{Ut(i),mn(5,t,r)}}function rA(t,r,i,c){let h=i[c]<0,s=i[c+1],v=h?-i[c]:i[c],w=t[v];h?t[Tt]>>14<t[Fl]>>16&&(t[Tt]&3)===r&&(t[Tt]+=16384,PM(w,s)):PM(w,s)}var Mu=-1,jd=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(r,i,c,h){this.factory=r,this.name=h,this.canSeeViewProviders=i,this.injectImpl=c}};function iA(t){return(t.flags&8)!==0}function oA(t){return(t.flags&16)!==0}function sA(t,r,i){let c=0;for(;c<i.length;){let h=i[c];if(typeof h=="number"){if(h!==0)break;c++;let s=i[c++],v=i[c++],w=i[c++];t.setAttribute(r,v,w,s)}else{let s=h,v=i[++c];lA(s)?t.setProperty(r,s,v):t.setAttribute(r,s,v),c++}}return c}function aA(t){return t===3||t===4||t===6}function lA(t){return t.charCodeAt(0)===64}function v0(t,r){if(!(r===null||r.length===0))if(t===null||t.length===0)t=r.slice();else{let i=-1;for(let c=0;c<r.length;c++){let h=r[c];typeof h=="number"?i=h:i===0||(i===-1||i===2?DM(t,i,h,null,r[++c]):DM(t,i,h,null,null))}}return t}function DM(t,r,i,c,h){let s=0,v=t.length;if(r===-1)v=-1;else for(;s<t.length;){let w=t[s++];if(typeof w=="number"){if(w===r){v=-1;break}else if(w>r){v=s-1;break}}}for(;s<t.length;){let w=t[s];if(typeof w=="number")break;if(w===i){h!==null&&(t[s+1]=h);return}s++,h!==null&&s++}v!==-1&&(t.splice(v,0,r),s=v+1),t.splice(s++,0,i),h!==null&&t.splice(s++,0,h)}function sS(t){return t!==Mu}function $m(t){return t&32767}function cA(t){return t>>16}function Hm(t,r){let i=cA(t),c=r;for(;i>0;)c=c[vu],i--;return c}var Kv=!0;function AM(t){let r=Kv;return Kv=t,r}var uA=256,aS=uA-1,lS=5,hA=0,Wo={};function dA(t,r,i){let c;typeof i=="string"?c=i.charCodeAt(0)||0:i.hasOwnProperty(Nl)&&(c=i[Nl]),c==null&&(c=i[Nl]=hA++);let h=c&aS,s=1<<h;r.data[t+(h>>lS)]|=s}function cS(t,r){let i=uS(t,r);if(i!==-1)return i;let c=r[Mt];c.firstCreatePass&&(t.injectorIndex=r.length,Wv(c.data,t),Wv(r,null),Wv(c.blueprint,null));let h=x0(t,r),s=t.injectorIndex;if(sS(h)){let v=$m(h),w=Hm(h,r),I=w[Mt].data;for(let N=0;N<8;N++)r[s+N]=w[v+N]|I[v+N]}return r[s+8]=h,s}function Wv(t,r){t.push(0,0,0,0,0,0,0,0,r)}function uS(t,r){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||r[t.injectorIndex+8]===null?-1:t.injectorIndex}function x0(t,r){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let i=0,c=null,h=r;for(;h!==null;){if(c=mS(h),c===null)return Mu;if(i++,h=h[vu],c.injectorIndex!==-1)return c.injectorIndex|i<<16}return Mu}function fA(t,r,i){dA(t,r,i)}function hS(t,r,i){if(i&8||t!==void 0)return t;Im(r,"NodeInjector")}function dS(t,r,i,c){if(i&8&&c===void 0&&(c=null),(i&3)===0){let h=t[_u],s=Ci(void 0);try{return h?h.get(r,c,i&8):gv(r,c,i&8)}finally{Ci(s)}}return hS(c,r,i)}function fS(t,r,i,c=0,h){if(t!==null){if(r[Tt]&2048&&!(c&2)){let v=_A(t,r,i,c,Wo);if(v!==Wo)return v}let s=pS(t,r,i,c,Wo);if(s!==Wo)return s}return dS(r,i,c,h)}function pS(t,r,i,c,h){let s=mA(i);if(typeof s=="function"){if(!Uv(r,t,c))return c&1?hS(h,i,c):dS(r,i,c,h);try{let v;if(v=s(c),v==null&&!(c&8))Im(i);else return v}finally{Vv()}}else if(typeof s=="number"){let v=null,w=uS(t,r),I=Mu,N=c&1?r[Zi][Hi]:null;for((w===-1||c&4)&&(I=w===-1?x0(t,r):r[w+8],I===Mu||!kM(c,!1)?w=-1:(v=r[Mt],w=$m(I),r=Hm(I,r)));w!==-1;){let B=r[Mt];if(RM(s,w,B.data)){let L=pA(w,r,i,v,c,N);if(L!==Wo)return L}I=r[w+8],I!==Mu&&kM(c,r[Mt].data[w+8]===N)&&RM(s,w,r)?(v=B,w=$m(I),r=Hm(I,r)):w=-1}}return h}function pA(t,r,i,c,h,s){let v=r[Mt],w=v.data[t+8],I=c==null?xu(w)&&Kv:c!=v&&(w.type&3)!==0,N=h&1&&s===w,B=Um(w,v,i,I,N);return B!==null?qm(r,v,B,w,h):Wo}function Um(t,r,i,c,h){let s=t.providerIndexes,v=r.data,w=s&1048575,I=t.directiveStart,N=t.directiveEnd,B=s>>20,L=c?w:w+B,ie=h?w+B:N;for(let H=L;H<ie;H++){let me=v[H];if(H<I&&i===me||H>=I&&me.type===i)return H}if(h){let H=v[I];if(H&&jl(H)&&H.type===i)return I}return null}function qm(t,r,i,c,h){let s=t[i],v=r.data;if(s instanceof jd){let w=s;if(w.resolving){let H=xm(v[i]);throw mv(H)}let I=AM(w.canSeeViewProviders);w.resolving=!0;let N=v[i].type||v[i],B,L=w.injectImpl?Ci(w.injectImpl):null,ie=Uv(t,c,0);try{s=t[i]=w.factory(void 0,h,v,t,c),r.firstCreatePass&&i>=c.directiveStart&&tA(i,v[i],r)}finally{L!==null&&Ci(L),AM(I),w.resolving=!1,Vv()}}return s}function mA(t){if(typeof t=="string")return t.charCodeAt(0)||0;let r=t.hasOwnProperty(Nl)?t[Nl]:void 0;return typeof r=="number"?r>=0?r&aS:gA:r}function RM(t,r,i){let c=1<<t;return!!(i[r+(t>>lS)]&c)}function kM(t,r){return!(t&2)&&!(t&1&&r)}var Vl=class{_tNode;_lView;constructor(r,i){this._tNode=r,this._lView=i}get(r,i,c){return fS(this._tNode,this._lView,r,Dl(c),i)}};function gA(){return new Vl(fo(),Nr())}function rg(t){return ng(()=>{let r=t.prototype.constructor,i=r[xd]||Qv(r),c=Object.prototype,h=Object.getPrototypeOf(t.prototype).constructor;for(;h&&h!==c;){let s=h[xd]||Qv(h);if(s&&s!==i)return s;h=Object.getPrototypeOf(h)}return s=>new s})}function Qv(t){return sv(t)?()=>{let r=Qv(ri(t));return r&&r()}:Al(t)}function _A(t,r,i,c,h){let s=t,v=r;for(;s!==null&&v!==null&&v[Tt]&2048&&!bu(v);){let w=pS(s,v,i,c|2,Wo);if(w!==Wo)return w;let I=s.parent;if(!I){let N=v[Ev];if(N){let B=N.get(i,Wo,c);if(B!==Wo)return B}I=mS(v),v=v[vu]}s=I}return h}function mS(t){let r=t[Mt],i=r.type;return i===2?r.declTNode:i===1?t[Hi]:null}function yA(){return Iu(fo(),Nr())}function Iu(t,r){return new Hd(za(t,r))}var Hd=(()=>{class t{nativeElement;constructor(i){this.nativeElement=i}static __NG_ELEMENT_ID__=yA}return t})();function vA(t){return t instanceof Hd?t.nativeElement:t}function xA(){return this._results[Symbol.iterator]()}var Zm=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new hr}constructor(r=!1){this._emitDistinctChangesOnly=r}get(r){return this._results[r]}map(r){return this._results.map(r)}filter(r){return this._results.filter(r)}find(r){return this._results.find(r)}reduce(r,i){return this._results.reduce(r,i)}forEach(r){this._results.forEach(r)}some(r){return this._results.some(r)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(r,i){this.dirty=!1;let c=qw(r);(this._changesDetected=!Hw(this._results,c,i))&&(this._results=c,this.length=c.length,this.last=c[this.length-1],this.first=c[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(r){this._onDirty=r}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=xA};function gS(t){return(t.flags&128)===128}var b0=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(b0||{}),_S=new Map,bA=0;function wA(){return bA++}function MA(t){_S.set(t[Cd],t)}function Jv(t){_S.delete(t[Cd])}var NM="__ngContext__";function Bd(t,r){Rs(r)?(t[NM]=r[Cd],MA(r)):t[NM]=r}function yS(t){return xS(t[yu])}function vS(t){return xS(t[$i])}function xS(t){for(;t!==null&&!ho(t);)t=t[$i];return t}var e0;function w0(t){e0=t}function bS(){if(e0!==void 0)return e0;if(typeof document<"u")return document;throw new at(210,!1)}var ig=new pt("",{providedIn:"root",factory:()=>SA}),SA="ng",og=new pt(""),Tu=new pt("",{providedIn:"platform",factory:()=>"unknown"});var sg=new pt("",{providedIn:"root",factory:()=>bS().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var EA="h",IA="b";var wS=!1,MS=new pt("",{providedIn:"root",factory:()=>wS});function M0(t){return(t.flags&32)===32}var TA=()=>null;function SS(t,r,i=!1){return TA(t,r,i)}function ES(t,r){let i=t.contentQueries;if(i!==null){let c=Ut(null);try{for(let h=0;h<i.length;h+=2){let s=i[h],v=i[h+1];if(v!==-1){let w=t.data[v];Lm(s),w.contentQueries(2,r[v],v)}}}finally{Ut(c)}}}function t0(t,r,i){Lm(0);let c=Ut(null);try{r(t,i)}finally{Ut(c)}}function IS(t,r,i){if(Iv(r)){let c=Ut(null);try{let h=r.directiveStart,s=r.directiveEnd;for(let v=h;v<s;v++){let w=t.data[v];if(w.contentQueries){let I=i[v];w.contentQueries(1,I,v)}}}finally{Ut(c)}}}var Ls=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Ls||{});function TS(t){return t instanceof Function?t():t}function CA(t,r,i){let c=t.length;for(;;){let h=t.indexOf(r,i);if(h===-1)return h;if(h===0||t.charCodeAt(h-1)<=32){let s=r.length;if(h+s===c||t.charCodeAt(h+s)<=32)return h}i=h+1}}var CS="ng-template";function PA(t,r,i,c){let h=0;if(c){for(;h<r.length&&typeof r[h]=="string";h+=2)if(r[h]==="class"&&CA(r[h+1].toLowerCase(),i,0)!==-1)return!0}else if(S0(t))return!1;if(h=r.indexOf(1,h),h>-1){let s;for(;++h<r.length&&typeof(s=r[h])=="string";)if(s.toLowerCase()===i)return!0}return!1}function S0(t){return t.type===4&&t.value!==CS}function DA(t,r,i){let c=t.type===4&&!i?CS:t.value;return r===c}function AA(t,r,i){let c=4,h=t.attrs,s=h!==null?NA(h):0,v=!1;for(let w=0;w<r.length;w++){let I=r[w];if(typeof I=="number"){if(!v&&!mo(c)&&!mo(I))return!1;if(v&&mo(I))continue;v=!1,c=I|c&1;continue}if(!v)if(c&4){if(c=2|c&1,I!==""&&!DA(t,I,i)||I===""&&r.length===1){if(mo(c))return!1;v=!0}}else if(c&8){if(h===null||!PA(t,h,I,i)){if(mo(c))return!1;v=!0}}else{let N=r[++w],B=RA(I,h,S0(t),i);if(B===-1){if(mo(c))return!1;v=!0;continue}if(N!==""){let L;if(B>s?L="":L=h[B+1].toLowerCase(),c&2&&N!==L){if(mo(c))return!1;v=!0}}}}return mo(c)||v}function mo(t){return(t&1)===0}function RA(t,r,i,c){if(r===null)return-1;let h=0;if(c||!i){let s=!1;for(;h<r.length;){let v=r[h];if(v===t)return h;if(v===3||v===6)s=!0;else if(v===1||v===2){let w=r[++h];for(;typeof w=="string";)w=r[++h];continue}else{if(v===4)break;if(v===0){h+=4;continue}}h+=s?1:2}return-1}else return LA(r,t)}function kA(t,r,i=!1){for(let c=0;c<r.length;c++)if(AA(t,r[c],i))return!0;return!1}function NA(t){for(let r=0;r<t.length;r++){let i=t[r];if(aA(i))return r}return t.length}function LA(t,r){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){let c=t[i];if(typeof c=="number")return-1;if(c===r)return i;i++}return-1}function LM(t,r){return t?":not("+r.trim()+")":r}function OA(t){let r=t[0],i=1,c=2,h="",s=!1;for(;i<t.length;){let v=t[i];if(typeof v=="string")if(c&2){let w=t[++i];h+="["+v+(w.length>0?'="'+w+'"':"")+"]"}else c&8?h+="."+v:c&4&&(h+=" "+v);else h!==""&&!mo(v)&&(r+=LM(s,h),h=""),c=v,s=s||!mo(c);i++}return h!==""&&(r+=LM(s,h)),r}function FA(t){return t.map(OA).join(",")}function zA(t){let r=[],i=[],c=1,h=2;for(;c<t.length;){let s=t[c];if(typeof s=="string")h===2?s!==""&&r.push(s,t[++c]):h===8&&i.push(s);else{if(!mo(h))break;h=s}c++}return i.length&&r.push(1,...i),r}var E0={};function PS(t,r,i){return t.createElement(r,i)}function Wm(t,r,i,c,h){t.insertBefore(r,i,c,h)}function DS(t,r,i){t.appendChild(r,i)}function OM(t,r,i,c,h){c!==null?Wm(t,r,i,c,h):DS(t,r,i)}function jA(t,r,i){t.removeChild(null,r,i)}function BA(t,r,i){t.setAttribute(r,"style",i)}function UA(t,r,i){i===""?t.removeAttribute(r,"class"):t.setAttribute(r,"class",i)}function AS(t,r,i){let{mergedAttrs:c,classes:h,styles:s}=i;c!==null&&sA(t,r,c),h!==null&&UA(t,r,h),s!==null&&BA(t,r,s)}function RS(t,r,i,c,h,s,v,w,I,N,B){let L=uo+c,ie=L+h,H=VA(L,ie),me=typeof N=="function"?N():N;return H[Mt]={type:t,blueprint:H,template:i,queries:null,viewQuery:w,declTNode:r,data:H.slice().fill(null,L),bindingStartIndex:L,expandoStartIndex:ie,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof v=="function"?v():v,firstChild:null,schemas:I,consts:me,incompleteFirstPass:!1,ssrId:B}}function VA(t,r){let i=[];for(let c=0;c<r;c++)i.push(c<t?null:E0);return i}function GA(t){let r=t.tView;return r===null||r.incompleteFirstPass?t.tView=RS(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):r}function I0(t,r,i,c,h,s,v,w,I,N,B){let L=r.blueprint.slice();return L[co]=h,L[Tt]=c|4|128|8|64|1024,(N!==null||t&&t[Tt]&2048)&&(L[Tt]|=2048),Pv(L),L[pr]=L[vu]=t,L[Pi]=i,L[As]=v||t&&t[As],L[qi]=w||t&&t[qi],L[_u]=I||t&&t[_u]||null,L[Hi]=s,L[Cd]=wA(),L[Id]=B,L[Ev]=N,L[Zi]=r.type==2?t[Zi]:L,L}function $A(t,r,i){let c=za(r,t),h=GA(i),s=t[As].rendererFactory,v=LS(t,I0(t,h,null,kS(i),c,r,null,s.createRenderer(c,i),null,null,null));return t[r.index]=v}function kS(t){let r=16;return t.signals?r=4096:t.onPush&&(r=64),r}function NS(t,r,i,c){if(i===0)return-1;let h=r.length;for(let s=0;s<i;s++)r.push(c),t.blueprint.push(c),t.data.push(null);return h}function LS(t,r){return t[yu]?t[Sv][$i]=r:t[yu]=r,t[Sv]=r,r}function HA(t,r,i,c){if(!c)if((r[Tt]&3)===3){let s=t.preOrderCheckHooks;s!==null&&jm(r,s,i)}else{let s=t.preOrderHooks;s!==null&&Bm(r,s,0,i)}ja(i)}var ag=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(ag||{});function n0(t,r,i,c){let h=Ut(null);try{let[s,v,w]=t.inputs[i],I=null;(v&ag.SignalBased)!==0&&(I=r[s][Zp]),I!==null&&I.transformFn!==void 0?c=I.transformFn(c):w!==null&&(c=w.call(r,c)),t.setInput!==null?t.setInput(r,I,c,i,s):tS(r,I,s,c)}finally{Ut(h)}}var $l=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}($l||{}),qA;function T0(t,r){return qA(t,r)}function wu(t,r,i,c,h){if(c!=null){let s,v=!1;ho(c)?s=c:Rs(c)&&(v=!0,c=c[co]);let w=Zo(c);t===0&&i!==null?h==null?DS(r,i,w):Wm(r,i,w,h||null,!0):t===1&&i!==null?Wm(r,i,w,h||null,!0):t===2?jA(r,w,v):t===3&&r.destroyNode(w),s!=null&&oR(r,t,s,i,h)}}function ZA(t,r){OS(t,r),r[co]=null,r[Hi]=null}function WA(t,r,i,c,h,s){c[co]=h,c[Hi]=r,lg(t,c,i,1,h,s)}function OS(t,r){r[As].changeDetectionScheduler?.notify(9),lg(t,r,r[qi],2,null,null)}function XA(t){let r=t[yu];if(!r)return Xv(t[Mt],t);for(;r;){let i=null;if(Rs(r))i=r[yu];else{let c=r[Hr];c&&(i=c)}if(!i){for(;r&&!r[$i]&&r!==t;)Rs(r)&&Xv(r[Mt],r),r=r[pr];r===null&&(r=t),Rs(r)&&Xv(r[Mt],r),i=r&&r[$i]}r=i}}function C0(t,r){let i=t[zl],c=i.indexOf(r);i.splice(c,1)}function FS(t,r){if(Bl(r))return;let i=r[qi];i.destroyNode&&lg(t,r,i,3,null,null),XA(r)}function Xv(t,r){if(Bl(r))return;let i=Ut(null);try{r[Tt]&=-129,r[Tt]|=256,r[Di]&&Kp(r[Di]),KA(t,r),YA(t,r),r[Mt].type===1&&r[qi].destroy();let c=r[Oa];if(c!==null&&ho(r[pr])){c!==r[pr]&&C0(c,r);let h=r[qo];h!==null&&h.detachView(t)}Jv(r)}finally{Ut(i)}}function YA(t,r){let i=t.cleanup,c=r[Td];if(i!==null)for(let v=0;v<i.length-1;v+=2)if(typeof i[v]=="string"){let w=i[v+3];w>=0?c[w]():c[-w].unsubscribe(),v+=2}else{let w=c[i[v+1]];i[v].call(w)}c!==null&&(r[Td]=null);let h=r[Ps];if(h!==null){r[Ps]=null;for(let v=0;v<h.length;v++){let w=h[v];w()}}let s=r[Pd];if(s!==null){r[Pd]=null;for(let v of s)v.destroy()}}function KA(t,r){let i;if(t!=null&&(i=t.destroyHooks)!=null)for(let c=0;c<i.length;c+=2){let h=r[i[c]];if(!(h instanceof jd)){let s=i[c+1];if(Array.isArray(s))for(let v=0;v<s.length;v+=2){let w=h[s[v]],I=s[v+1];mn(4,w,I);try{I.call(w)}finally{mn(5,w,I)}}else{mn(4,h,s);try{s.call(h)}finally{mn(5,h,s)}}}}}function QA(t,r,i){return JA(t,r.parent,i)}function JA(t,r,i){let c=r;for(;c!==null&&c.type&168;)r=c,c=r.parent;if(c===null)return i[co];if(xu(c)){let{encapsulation:h}=t.data[c.directiveStart+c.componentOffset];if(h===Ls.None||h===Ls.Emulated)return null}return za(c,i)}function eR(t,r,i){return nR(t,r,i)}function tR(t,r,i){return t.type&40?za(t,i):null}var nR=tR,FM;function rR(t,r,i,c){let h=QA(t,c,r),s=r[qi],v=c.parent||r[Hi],w=eR(v,c,r);if(h!=null)if(Array.isArray(i))for(let I=0;I<i.length;I++)OM(s,h,i[I],w,!1);else OM(s,h,i,w,!1);FM!==void 0&&FM(s,c,r,i,h)}function Fd(t,r){if(r!==null){let i=r.type;if(i&3)return za(r,t);if(i&4)return r0(-1,t[r.index]);if(i&8){let c=r.child;if(c!==null)return Fd(t,c);{let h=t[r.index];return ho(h)?r0(-1,h):Zo(h)}}else{if(i&128)return Fd(t,r.next);if(i&32)return T0(r,t)()||Zo(t[r.index]);{let c=zS(t,r);if(c!==null){if(Array.isArray(c))return c[0];let h=ka(t[Zi]);return Fd(h,c)}else return Fd(t,r.next)}}}return null}function zS(t,r){if(r!==null){let c=t[Zi][Hi],h=r.projection;return c.projection[h]}return null}function r0(t,r){let i=Hr+t+1;if(i<r.length){let c=r[i],h=c[Mt].firstChild;if(h!==null)return Fd(c,h)}return r[Fa]}function P0(t,r,i,c,h,s,v){for(;i!=null;){if(i.type===128){i=i.next;continue}let w=c[i.index],I=i.type;if(v&&r===0&&(w&&Bd(Zo(w),c),i.flags|=2),!M0(i))if(I&8)P0(t,r,i.child,c,h,s,!1),wu(r,t,h,w,s);else if(I&32){let N=T0(i,c),B;for(;B=N();)wu(r,t,h,B,s);wu(r,t,h,w,s)}else I&16?iR(t,r,c,i,h,s):wu(r,t,h,w,s);i=v?i.projectionNext:i.next}}function lg(t,r,i,c,h,s){P0(i,c,t.firstChild,r,h,s,!1)}function iR(t,r,i,c,h,s){let v=i[Zi],I=v[Hi].projection[c.projection];if(Array.isArray(I))for(let N=0;N<I.length;N++){let B=I[N];wu(r,t,h,B,s)}else{let N=I,B=v[pr];gS(c)&&(N.flags|=128),P0(t,r,N,B,h,s,!0)}}function oR(t,r,i,c,h){let s=i[Fa],v=Zo(i);s!==v&&wu(r,t,c,s,h);for(let w=Hr;w<i.length;w++){let I=i[w];lg(I[Mt],I,t,r,c,s)}}function jS(t,r,i,c,h){let s=wM(),v=c&2;try{ja(-1),v&&r.length>uo&&HA(t,r,uo,!1),mn(v?2:0,h,i),i(c,h)}finally{ja(s),mn(v?3:1,h,i)}}function BS(t,r,i){cR(t,r,i),(i.flags&64)===64&&uR(t,r,i)}function US(t,r,i=za){let c=r.localNames;if(c!==null){let h=r.index+1;for(let s=0;s<c.length;s+=2){let v=c[s+1],w=v===-1?i(r,t):t[v];t[h++]=w}}}function sR(t,r,i,c){let s=c.get(MS,wS)||i===Ls.ShadowDom,v=t.selectRootElement(r,s);return aR(v),v}function aR(t){lR(t)}var lR=()=>null;function cR(t,r,i){let c=i.directiveStart,h=i.directiveEnd;xu(i)&&$A(r,i,t.data[c+i.componentOffset]),t.firstCreatePass||cS(i,r);let s=i.initialInputs;for(let v=c;v<h;v++){let w=t.data[v],I=qm(r,t,v,i);if(Bd(I,r),s!==null&&fR(r,v-c,I,w,i,s),jl(w)){let N=ks(i.index,r);N[Pi]=qm(r,t,v,i)}}}function uR(t,r,i){let c=i.directiveStart,h=i.directiveEnd,s=i.index,v=yM();try{ja(s);for(let w=c;w<h;w++){let I=t.data[w],N=r[w];Nm(w),(I.hostBindings!==null||I.hostVars!==0||I.hostAttrs!==null)&&hR(I,N)}}finally{ja(-1),Nm(v)}}function hR(t,r){t.hostBindings!==null&&t.hostBindings(1,r)}function dR(t,r){let i=t.directiveRegistry,c=null;if(i)for(let h=0;h<i.length;h++){let s=i[h];kA(r,s.selectors,!1)&&(c??=[],jl(s)?c.unshift(s):c.push(s))}return c}function fR(t,r,i,c,h,s){let v=s[r];if(v!==null)for(let w=0;w<v.length;w+=2){let I=v[w],N=v[w+1];n0(c,i,I,N)}}function VS(t,r,i,c,h){let s=uo+i,v=r[Mt],w=h(v,r,t,c,i);r[s]=w,km(t,!0);let I=t.type===2;return I?(AS(r[qi],w,t),(cM()===0||Tv(t))&&Bd(w,r),uM()):Bd(w,r),EM()&&(!I||!M0(t))&&rR(v,r,w,t),t}function GS(t){let r=t;return Ov()?pM():(r=r.parent,km(r,!1)),r}function $S(t,r,i,c,h){let s=t.inputs?.[c],v=t.hostDirectiveInputs?.[c],w=!1;if(v)for(let I=0;I<v.length;I+=2){let N=v[I],B=v[I+1],L=r.data[N];n0(L,i[N],B,h),w=!0}if(s)for(let I of s){let N=i[I],B=r.data[I];n0(B,N,c,h),w=!0}return w}function pR(t,r){let i=ks(r,t),c=i[Mt];mR(c,i);let h=i[co];h!==null&&i[Id]===null&&(i[Id]=SS(h,i[_u])),mn(18),D0(c,i,i[Pi]),mn(19,i[Pi])}function mR(t,r){for(let i=r.length;i<t.blueprint.length;i++)r.push(t.blueprint[i])}function D0(t,r,i){Om(r);try{let c=t.viewQuery;c!==null&&t0(1,c,i);let h=t.template;h!==null&&jS(t,r,h,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),r[qo]?.finishViewCreation(t),t.staticContentQueries&&ES(t,r),t.staticViewQueries&&t0(2,t.viewQuery,i);let s=t.components;s!==null&&gR(r,s)}catch(c){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),c}finally{r[Tt]&=-5,Fm()}}function gR(t,r){for(let i=0;i<r.length;i++)pR(t,r[i])}function _R(t,r,i,c){let h=Ut(null);try{let s=r.tView,w=t[Tt]&4096?4096:16,I=I0(t,s,i,w,null,r,null,null,c?.injector??null,c?.embeddedViewInjector??null,c?.dehydratedView??null),N=t[r.index];I[Oa]=N;let B=t[qo];return B!==null&&(I[qo]=B.createEmbeddedView(s)),D0(s,I,i),I}finally{Ut(h)}}function zM(t,r){return!r||r.firstChild===null||gS(t)}var jM=!1,yR=new pt("");function Ud(t,r,i,c,h=!1){for(;i!==null;){if(i.type===128){i=h?i.projectionNext:i.next;continue}let s=r[i.index];s!==null&&c.push(Zo(s)),ho(s)&&HS(s,c);let v=i.type;if(v&8)Ud(t,r,i.child,c);else if(v&32){let w=T0(i,r),I;for(;I=w();)c.push(I)}else if(v&16){let w=zS(r,i);if(Array.isArray(w))c.push(...w);else{let I=ka(r[Zi]);Ud(I[Mt],I,w,c,!0)}}i=h?i.projectionNext:i.next}return c}function HS(t,r){for(let i=Hr;i<t.length;i++){let c=t[i],h=c[Mt].firstChild;h!==null&&Ud(c[Mt],c,h,r)}t[Fa]!==t[co]&&r.push(t[Fa])}function qS(t){if(t[Pm]!==null){for(let r of t[Pm])r.impl.addSequence(r);t[Pm].length=0}}var ZS=[];function vR(t){return t[Di]??xR(t)}function xR(t){let r=ZS.pop()??Object.create(wR);return r.lView=t,r}function bR(t){t.lView[Di]!==t&&(t.lView=null,ZS.push(t))}var wR=un(Je({},Wp),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{kd(t.lView)},consumerOnSignalRead(){this.lView[Di]=this}});function MR(t){let r=t[Di]??Object.create(SR);return r.lView=t,r}var SR=un(Je({},Wp),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let r=ka(t.lView);for(;r&&!WS(r[Mt]);)r=ka(r);r&&Dv(r)},consumerOnSignalRead(){this.lView[Di]=this}});function WS(t){return t.type!==2}function XS(t){if(t[Pd]===null)return;let r=!0;for(;r;){let i=!1;for(let c of t[Pd])c.dirty&&(i=!0,c.zone===null||Zone.current===c.zone?c.run():c.zone.run(()=>c.run()));r=i&&!!(t[Tt]&8192)}}var ER=100;function A0(t,r=0){let c=t[As].rendererFactory,h=!1;h||c.begin?.();try{IR(t,r)}finally{h||c.end?.()}}function IR(t,r){let i=zv();try{jv(!0),i0(t,r);let c=0;for(;Rd(t);){if(c===ER)throw new at(103,!1);c++,i0(t,1)}}finally{jv(i)}}function YS(t,r){Fv(r?Nd.Exhaustive:Nd.OnlyDirtyViews);try{A0(t)}finally{Fv(Nd.Off)}}function TR(t,r,i,c){if(Bl(r))return;let h=r[Tt],s=!1,v=!1;Om(r);let w=!0,I=null,N=null;s||(WS(t)?(N=vR(r),I=Xp(N)):Ty()===null?(w=!1,N=MR(r),I=Xp(N)):r[Di]&&(Kp(r[Di]),r[Di]=null));try{Pv(r),mM(t.bindingStartIndex),i!==null&&jS(t,r,i,2,c);let B=(h&3)===3;if(!s)if(B){let H=t.preOrderCheckHooks;H!==null&&jm(r,H,null)}else{let H=t.preOrderHooks;H!==null&&Bm(r,H,0,null),Zv(r,0)}if(v||CR(r),XS(r),KS(r,0),t.contentQueries!==null&&ES(t,r),!s)if(B){let H=t.contentCheckHooks;H!==null&&jm(r,H)}else{let H=t.contentHooks;H!==null&&Bm(r,H,1),Zv(r,1)}DR(t,r);let L=t.components;L!==null&&JS(r,L,0);let ie=t.viewQuery;if(ie!==null&&t0(2,ie,c),!s)if(B){let H=t.viewCheckHooks;H!==null&&jm(r,H)}else{let H=t.viewHooks;H!==null&&Bm(r,H,2),Zv(r,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),r[Cm]){for(let H of r[Cm])H();r[Cm]=null}s||(qS(r),r[Tt]&=-73)}catch(B){throw s||kd(r),B}finally{N!==null&&(Dy(N,I),w&&bR(N)),Fm()}}function KS(t,r){for(let i=yS(t);i!==null;i=vS(i))for(let c=Hr;c<i.length;c++){let h=i[c];QS(h,r)}}function CR(t){for(let r=yS(t);r!==null;r=vS(r)){if(!(r[Tt]&2))continue;let i=r[zl];for(let c=0;c<i.length;c++){let h=i[c];Dv(h)}}}function PR(t,r,i){mn(18);let c=ks(r,t);QS(c,i),mn(19,c[Pi])}function QS(t,r){Dm(t)&&i0(t,r)}function i0(t,r){let c=t[Mt],h=t[Tt],s=t[Di],v=!!(r===0&&h&16);if(v||=!!(h&64&&r===0),v||=!!(h&1024),v||=!!(s?.dirty&&Yp(s)),v||=!1,s&&(s.dirty=!1),t[Tt]&=-9217,v)TR(c,t,c.template,t[Pi]);else if(h&8192){let w=Ut(null);try{XS(t),KS(t,1);let I=c.components;I!==null&&JS(t,I,1),qS(t)}finally{Ut(w)}}}function JS(t,r,i){for(let c=0;c<r.length;c++)PR(t,r[c],i)}function DR(t,r){let i=t.hostBindingOpCodes;if(i!==null)try{for(let c=0;c<i.length;c++){let h=i[c];if(h<0)ja(~h);else{let s=h,v=i[++c],w=i[++c];_M(v,s);let I=r[s];mn(24,I),w(2,I),mn(25,I)}}}finally{ja(-1)}}function eE(t,r){let i=zv()?64:1088;for(t[As].changeDetectionScheduler?.notify(r);t;){t[Tt]|=i;let c=ka(t);if(bu(t)&&!c)return t;t=c}return null}function AR(t,r,i,c){return[t,!0,0,r,null,c,null,i,null,null]}function RR(t,r,i,c=!0){let h=r[Mt];if(kR(h,r,t,i),c){let v=r0(i,t),w=r[qi],I=w.parentNode(t[Fa]);I!==null&&WA(h,t[Hi],w,r,I,v)}let s=r[Id];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function o0(t,r){if(t.length<=Hr)return;let i=Hr+r,c=t[i];if(c){let h=c[Oa];h!==null&&h!==t&&C0(h,c),r>0&&(t[i-1][$i]=c[$i]);let s=Md(t,Hr+r);ZA(c[Mt],c);let v=s[qo];v!==null&&v.detachView(s[Mt]),c[pr]=null,c[$i]=null,c[Tt]&=-129}return c}function kR(t,r,i,c){let h=Hr+c,s=i.length;c>0&&(i[h-1][$i]=r),c<s-Hr?(r[$i]=i[h],_v(i,Hr+c,r)):(i.push(r),r[$i]=null),r[pr]=i;let v=r[Oa];v!==null&&i!==v&&tE(v,r);let w=r[qo];w!==null&&w.insertView(t),Am(r),r[Tt]|=128}function tE(t,r){let i=t[zl],c=r[pr];if(Rs(c))t[Tt]|=2;else{let h=c[pr][Zi];r[Zi]!==h&&(t[Tt]|=2)}i===null?t[zl]=[r]:i.push(r)}var Ba=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let r=this._lView,i=r[Mt];return Ud(i,r,i.firstChild,[])}constructor(r,i){this._lView=r,this._cdRefInjectingView=i}get context(){return this._lView[Pi]}set context(r){this._lView[Pi]=r}get destroyed(){return Bl(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let r=this._lView[pr];if(ho(r)){let i=r[Dd],c=i?i.indexOf(this):-1;c>-1&&(o0(r,c),Md(i,c))}this._attachedToViewContainer=!1}FS(this._lView[Mt],this._lView)}onDestroy(r){Av(this._lView,r)}markForCheck(){eE(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Tt]&=-129}reattach(){Am(this._lView),this._lView[Tt]|=128}detectChanges(){this._lView[Tt]|=1024,A0(this._lView)}checkNoChanges(){return;try{this.exhaustive??=this._lView[_u].get(yR,jM)}catch{this.exhaustive=jM}}attachToViewContainerRef(){if(this._appRef)throw new at(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let r=bu(this._lView),i=this._lView[Oa];i!==null&&!r&&C0(i,this._lView),OS(this._lView[Mt],this._lView)}attachToAppRef(r){if(this._attachedToViewContainer)throw new at(902,!1);this._appRef=r;let i=bu(this._lView),c=this._lView[Oa];c!==null&&!i&&tE(c,this._lView),Am(this._lView)}};var Vd=(()=>{class t{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=NR;constructor(i,c,h){this._declarationLView=i,this._declarationTContainer=c,this.elementRef=h}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,c){return this.createEmbeddedViewImpl(i,c)}createEmbeddedViewImpl(i,c,h){let s=_R(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:c,dehydratedView:h});return new Ba(s)}}return t})();function NR(){return R0(fo(),Nr())}function R0(t,r){return t.type&4?new Vd(r,t,Iu(t,r)):null}function nE(t,r,i,c,h){let s=t.data[r];if(s===null)s=LR(t,r,i,c,h),gM()&&(s.flags|=32);else if(s.type&64){s.type=i,s.value=c,s.attrs=h;let v=fM();s.injectorIndex=v===null?-1:v.injectorIndex}return km(s,!0),s}function LR(t,r,i,c,h){let s=Lv(),v=Ov(),w=v?s:s&&s.parent,I=t.data[r]=FR(t,w,i,r,c,h);return OR(t,I,s,v),I}function OR(t,r,i,c){t.firstChild===null&&(t.firstChild=r),i!==null&&(c?i.child==null&&r.parent!==null&&(i.child=r):i.next===null&&(i.next=r,r.prev=i))}function FR(t,r,i,c,h,s){let v=r?r.injectorIndex:-1,w=0;return dM()&&(w|=128),{type:i,index:c,insertBeforeIndex:null,injectorIndex:v,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:w,providerIndexes:0,value:h,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:r,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var xV=new RegExp(`^(\\d+)*(${IA}|${EA})*(.*)`);var zR=()=>null;function BM(t,r){return zR(t,r)}var rE=class{},cg=class{},s0=class{resolveComponentFactory(r){throw new at(917,!1)}},qd=class{static NULL=new s0},Gl=class{};var iE=(()=>{class t{static \u0275prov=lt({token:t,providedIn:"root",factory:()=>null})}return t})();var Vm={},a0=class{injector;parentInjector;constructor(r,i){this.injector=r,this.parentInjector=i}get(r,i,c){let h=this.injector.get(r,Vm,c);return h!==Vm||i===Vm?h:this.parentInjector.get(r,i,c)}};function Xm(t,r,i){let c=i?t.styles:null,h=i?t.classes:null,s=0;if(r!==null)for(let v=0;v<r.length;v++){let w=r[v];if(typeof w=="number")s=w;else if(s==1)h=ov(h,w);else if(s==2){let I=w,N=r[++v];c=ov(c,I+": "+N+";")}}i?t.styles=c:t.stylesWithoutHost=c,i?t.classes=h:t.classesWithoutHost=h}function ug(t,r=0){let i=Nr();if(i===null)return It(t,r);let c=fo();return fS(c,i,ri(t),r)}function jR(t,r,i,c,h){let s=c===null?null:{"":-1},v=h(t,i);if(v!==null){let w=v,I=null,N=null;for(let B of v)if(B.resolveHostDirectives!==null){[w,I,N]=B.resolveHostDirectives(v);break}VR(t,r,i,w,s,I,N)}s!==null&&c!==null&&BR(i,c,s)}function BR(t,r,i){let c=t.localNames=[];for(let h=0;h<r.length;h+=2){let s=i[r[h+1]];if(s==null)throw new at(-301,!1);c.push(r[h],s)}}function UR(t,r,i){r.componentOffset=i,(t.components??=[]).push(r.index)}function VR(t,r,i,c,h,s,v){let w=c.length,I=!1;for(let ie=0;ie<w;ie++){let H=c[ie];!I&&jl(H)&&(I=!0,UR(t,i,ie)),fA(cS(i,r),t,H.type)}WR(i,t.data.length,w);for(let ie=0;ie<w;ie++){let H=c[ie];H.providersResolver&&H.providersResolver(H)}let N=!1,B=!1,L=NS(t,r,w,null);w>0&&(i.directiveToIndex=new Map);for(let ie=0;ie<w;ie++){let H=c[ie];if(i.mergedAttrs=v0(i.mergedAttrs,H.hostAttrs),$R(t,i,r,L,H),ZR(L,H,h),v!==null&&v.has(H)){let[Ee,Me]=v.get(H);i.directiveToIndex.set(H.type,[L,Ee+i.directiveStart,Me+i.directiveStart])}else(s===null||!s.has(H))&&i.directiveToIndex.set(H.type,L);H.contentQueries!==null&&(i.flags|=4),(H.hostBindings!==null||H.hostAttrs!==null||H.hostVars!==0)&&(i.flags|=64);let me=H.type.prototype;!N&&(me.ngOnChanges||me.ngOnInit||me.ngDoCheck)&&((t.preOrderHooks??=[]).push(i.index),N=!0),!B&&(me.ngOnChanges||me.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(i.index),B=!0),L++}GR(t,i,s)}function GR(t,r,i){for(let c=r.directiveStart;c<r.directiveEnd;c++){let h=t.data[c];if(i===null||!i.has(h))UM(0,r,h,c),UM(1,r,h,c),GM(r,c,!1);else{let s=i.get(h);VM(0,r,s,c),VM(1,r,s,c),GM(r,c,!0)}}}function UM(t,r,i,c){let h=t===0?i.inputs:i.outputs;for(let s in h)if(h.hasOwnProperty(s)){let v;t===0?v=r.inputs??={}:v=r.outputs??={},v[s]??=[],v[s].push(c),oE(r,s)}}function VM(t,r,i,c){let h=t===0?i.inputs:i.outputs;for(let s in h)if(h.hasOwnProperty(s)){let v=h[s],w;t===0?w=r.hostDirectiveInputs??={}:w=r.hostDirectiveOutputs??={},w[v]??=[],w[v].push(c,s),oE(r,v)}}function oE(t,r){r==="class"?t.flags|=8:r==="style"&&(t.flags|=16)}function GM(t,r,i){let{attrs:c,inputs:h,hostDirectiveInputs:s}=t;if(c===null||!i&&h===null||i&&s===null||S0(t)){t.initialInputs??=[],t.initialInputs.push(null);return}let v=null,w=0;for(;w<c.length;){let I=c[w];if(I===0){w+=4;continue}else if(I===5){w+=2;continue}else if(typeof I=="number")break;if(!i&&h.hasOwnProperty(I)){let N=h[I];for(let B of N)if(B===r){v??=[],v.push(I,c[w+1]);break}}else if(i&&s.hasOwnProperty(I)){let N=s[I];for(let B=0;B<N.length;B+=2)if(N[B]===r){v??=[],v.push(N[B+1],c[w+1]);break}}w+=2}t.initialInputs??=[],t.initialInputs.push(v)}function $R(t,r,i,c,h){t.data[c]=h;let s=h.factory||(h.factory=Al(h.type,!0)),v=new jd(s,jl(h),ug,null);t.blueprint[c]=v,i[c]=v,HR(t,r,c,NS(t,i,h.hostVars,E0),h)}function HR(t,r,i,c,h){let s=h.hostBindings;if(s){let v=t.hostBindingOpCodes;v===null&&(v=t.hostBindingOpCodes=[]);let w=~r.index;qR(v)!=w&&v.push(w),v.push(i,c,s)}}function qR(t){let r=t.length;for(;r>0;){let i=t[--r];if(typeof i=="number"&&i<0)return i}return 0}function ZR(t,r,i){if(i){if(r.exportAs)for(let c=0;c<r.exportAs.length;c++)i[r.exportAs[c]]=t;jl(r)&&(i[""]=t)}}function WR(t,r,i){t.flags|=1,t.directiveStart=r,t.directiveEnd=r+i,t.providerIndexes=r}function sE(t,r,i,c,h,s,v,w){let I=r[Mt],N=I.consts,B=Ad(N,v),L=nE(I,t,i,c,B);return s&&jR(I,r,L,Ad(N,w),h),L.mergedAttrs=v0(L.mergedAttrs,L.attrs),L.attrs!==null&&Xm(L,L.attrs,!1),L.mergedAttrs!==null&&Xm(L,L.mergedAttrs,!0),I.queries!==null&&I.queries.elementStart(I,L),L}function aE(t,r){nA(t,r),Iv(r)&&t.queries.elementEnd(r)}function XR(t,r,i,c,h,s){let v=r.consts,w=Ad(v,h),I=nE(r,t,i,c,w);if(I.mergedAttrs=v0(I.mergedAttrs,I.attrs),s!=null){let N=Ad(v,s);I.localNames=[];for(let B=0;B<N.length;B+=2)I.localNames.push(N[B],-1)}return I.attrs!==null&&Xm(I,I.attrs,!1),I.mergedAttrs!==null&&Xm(I,I.mergedAttrs,!0),r.queries!==null&&r.queries.elementStart(r,I),I}var l0=Symbol("BINDING");var Ym=class extends qd{ngModule;constructor(r){super(),this.ngModule=r}resolveComponentFactory(r){let i=La(r);return new Su(i,this.ngModule)}};function YR(t){return Object.keys(t).map(r=>{let[i,c,h]=t[r],s={propName:i,templateName:r,isSignal:(c&ag.SignalBased)!==0};return h&&(s.transform=h),s})}function KR(t){return Object.keys(t).map(r=>({propName:t[r],templateName:r}))}function QR(t,r,i){let c=r instanceof Sr?r:r?.injector;return c&&t.getStandaloneInjector!==null&&(c=t.getStandaloneInjector(c)||c),c?new a0(i,c):i}function JR(t){let r=t.get(Gl,null);if(r===null)throw new at(407,!1);let i=t.get(iE,null),c=t.get(Na,null);return{rendererFactory:r,sanitizer:i,changeDetectionScheduler:c,ngReflect:!1}}function ek(t,r){let i=(t.selectors[0][0]||"div").toLowerCase();return PS(r,i,i==="svg"?tM:i==="math"?nM:null)}var Su=class extends cg{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=YR(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=KR(this.componentDef.outputs),this.cachedOutputs}constructor(r,i){super(),this.componentDef=r,this.ngModule=i,this.componentType=r.type,this.selector=FA(r.selectors),this.ngContentSelectors=r.ngContentSelectors??[],this.isBoundToModule=!!i}create(r,i,c,h,s,v){mn(22);let w=Ut(null);try{let I=this.componentDef,N=tk(c,I,v,s),B=QR(I,h||this.ngModule,r),L=JR(B),ie=L.rendererFactory.createRenderer(null,I),H=c?sR(ie,c,I.encapsulation,B):ek(I,ie),me=v?.some($M)||s?.some(Ae=>typeof Ae!="function"&&Ae.bindings.some($M)),Ee=I0(null,N,null,512|kS(I),null,null,L,ie,B,null,SS(H,B,!0));Ee[uo]=H,Om(Ee);let Me=null;try{let Ae=sE(uo,Ee,2,"#host",()=>N.directiveRegistry,!0,0);H&&(AS(ie,H,Ae),Bd(H,Ee)),BS(N,Ee,Ae),IS(N,Ae,Ee),aE(N,Ae),i!==void 0&&rk(Ae,this.ngContentSelectors,i),Me=ks(Ae.index,Ee),Ee[Pi]=Me[Pi],D0(N,Ee,null)}catch(Ae){throw Me!==null&&Jv(Me),Jv(Ee),Ae}finally{mn(23),Fm()}return new Km(this.componentType,Ee,!!me)}finally{Ut(w)}}};function tk(t,r,i,c){let h=t?["ng-version","20.1.7"]:zA(r.selectors[0]),s=null,v=null,w=0;if(i)for(let B of i)w+=B[l0].requiredVars,B.create&&(B.targetIdx=0,(s??=[]).push(B)),B.update&&(B.targetIdx=0,(v??=[]).push(B));if(c)for(let B=0;B<c.length;B++){let L=c[B];if(typeof L!="function")for(let ie of L.bindings){w+=ie[l0].requiredVars;let H=B+1;ie.create&&(ie.targetIdx=H,(s??=[]).push(ie)),ie.update&&(ie.targetIdx=H,(v??=[]).push(ie))}}let I=[r];if(c)for(let B of c){let L=typeof B=="function"?B:B.type,ie=bv(L);I.push(ie)}return RS(0,null,nk(s,v),1,w,I,null,null,null,[h],null)}function nk(t,r){return!t&&!r?null:i=>{if(i&1&&t)for(let c of t)c.create();if(i&2&&r)for(let c of r)c.update()}}function $M(t){let r=t[l0].kind;return r==="input"||r==="twoWay"}var Km=class extends rE{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(r,i,c){super(),this._rootLView=i,this._hasInputBindings=c,this._tNode=Cv(i[Mt],uo),this.location=Iu(this._tNode,i),this.instance=ks(this._tNode.index,i)[Pi],this.hostView=this.changeDetectorRef=new Ba(i,void 0),this.componentType=r}setInput(r,i){this._hasInputBindings;let c=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(r)&&Object.is(this.previousInputValues.get(r),i))return;let h=this._rootLView,s=$S(c,h[Mt],h,r,i);this.previousInputValues.set(r,i);let v=ks(c.index,h);eE(v,1)}get injector(){return new Vl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(r){this.hostView.onDestroy(r)}};function rk(t,r,i){let c=t.projection=[];for(let h=0;h<r.length;h++){let s=i[h];c.push(s!=null&&s.length?Array.from(s):null)}}var Cu=(()=>{class t{static __NG_ELEMENT_ID__=ik}return t})();function ik(){let t=fo();return cE(t,Nr())}var ok=Cu,lE=class extends ok{_lContainer;_hostTNode;_hostLView;constructor(r,i,c){super(),this._lContainer=r,this._hostTNode=i,this._hostLView=c}get element(){return Iu(this._hostTNode,this._hostLView)}get injector(){return new Vl(this._hostTNode,this._hostLView)}get parentInjector(){let r=x0(this._hostTNode,this._hostLView);if(sS(r)){let i=Hm(r,this._hostLView),c=$m(r),h=i[Mt].data[c+8];return new Vl(h,i)}else return new Vl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(r){let i=HM(this._lContainer);return i!==null&&i[r]||null}get length(){return this._lContainer.length-Hr}createEmbeddedView(r,i,c){let h,s;typeof c=="number"?h=c:c!=null&&(h=c.index,s=c.injector);let v=BM(this._lContainer,r.ssrId),w=r.createEmbeddedViewImpl(i||{},s,v);return this.insertImpl(w,h,zM(this._hostTNode,v)),w}createComponent(r,i,c,h,s,v,w){let I=r&&!KD(r),N;if(I)N=i;else{let Me=i||{};N=Me.index,c=Me.injector,h=Me.projectableNodes,s=Me.environmentInjector||Me.ngModuleRef,v=Me.directives,w=Me.bindings}let B=I?r:new Su(La(r)),L=c||this.parentInjector;if(!s&&B.ngModule==null){let Ae=(I?L:this.parentInjector).get(Sr,null);Ae&&(s=Ae)}let ie=La(B.componentType??{}),H=BM(this._lContainer,ie?.id??null),me=H?.firstChild??null,Ee=B.create(L,h,me,s,v,w);return this.insertImpl(Ee.hostView,N,zM(this._hostTNode,H)),Ee}insert(r,i){return this.insertImpl(r,i,!0)}insertImpl(r,i,c){let h=r._lView;if(iM(h)){let w=this.indexOf(r);if(w!==-1)this.detach(w);else{let I=h[pr],N=new lE(I,I[Hi],I[pr]);N.detach(N.indexOf(r))}}let s=this._adjustIndex(i),v=this._lContainer;return RR(v,h,s,c),r.attachToViewContainerRef(),_v(Yv(v),s,r),r}move(r,i){return this.insert(r,i)}indexOf(r){let i=HM(this._lContainer);return i!==null?i.indexOf(r):-1}remove(r){let i=this._adjustIndex(r,-1),c=o0(this._lContainer,i);c&&(Md(Yv(this._lContainer),i),FS(c[Mt],c))}detach(r){let i=this._adjustIndex(r,-1),c=o0(this._lContainer,i);return c&&Md(Yv(this._lContainer),i)!=null?new Ba(c):null}_adjustIndex(r,i=0){return r??this.length+i}};function HM(t){return t[Dd]}function Yv(t){return t[Dd]||(t[Dd]=[])}function cE(t,r){let i,c=r[t.index];return ho(c)?i=c:(i=AR(c,r,null,t),r[t.index]=i,LS(r,i)),ak(i,r,t,c),new lE(i,t,r)}function sk(t,r){let i=t[qi],c=i.createComment(""),h=za(r,t),s=i.parentNode(h);return Wm(i,s,c,i.nextSibling(h),!1),c}var ak=lk;function lk(t,r,i,c){if(t[Fa])return;let h;i.type&8?h=Zo(c):h=sk(r,i),t[Fa]=h}var c0=class t{queryList;matches=null;constructor(r){this.queryList=r}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},u0=class t{queries;constructor(r=[]){this.queries=r}createEmbeddedView(r){let i=r.queries;if(i!==null){let c=r.contentQueries!==null?r.contentQueries[0]:i.length,h=[];for(let s=0;s<c;s++){let v=i.getByIndex(s),w=this.queries[v.indexInDeclarationView];h.push(w.clone())}return new t(h)}return null}insertView(r){this.dirtyQueriesWithMatches(r)}detachView(r){this.dirtyQueriesWithMatches(r)}finishViewCreation(r){this.dirtyQueriesWithMatches(r)}dirtyQueriesWithMatches(r){for(let i=0;i<this.queries.length;i++)k0(r,i).matches!==null&&this.queries[i].setDirty()}},h0=class{flags;read;predicate;constructor(r,i,c=null){this.flags=i,this.read=c,typeof r=="string"?this.predicate=gk(r):this.predicate=r}},d0=class t{queries;constructor(r=[]){this.queries=r}elementStart(r,i){for(let c=0;c<this.queries.length;c++)this.queries[c].elementStart(r,i)}elementEnd(r){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(r)}embeddedTView(r){let i=null;for(let c=0;c<this.length;c++){let h=i!==null?i.length:0,s=this.getByIndex(c).embeddedTView(r,h);s&&(s.indexInDeclarationView=c,i!==null?i.push(s):i=[s])}return i!==null?new t(i):null}template(r,i){for(let c=0;c<this.queries.length;c++)this.queries[c].template(r,i)}getByIndex(r){return this.queries[r]}get length(){return this.queries.length}track(r){this.queries.push(r)}},f0=class t{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(r,i=-1){this.metadata=r,this._declarationNodeIndex=i}elementStart(r,i){this.isApplyingToNode(i)&&this.matchTNode(r,i)}elementEnd(r){this._declarationNodeIndex===r.index&&(this._appliesToNextNode=!1)}template(r,i){this.elementStart(r,i)}embeddedTView(r,i){return this.isApplyingToNode(r)?(this.crossesNgTemplate=!0,this.addMatch(-r.index,i),new t(this.metadata)):null}isApplyingToNode(r){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let i=this._declarationNodeIndex,c=r.parent;for(;c!==null&&c.type&8&&c.index!==i;)c=c.parent;return i===(c!==null?c.index:-1)}return this._appliesToNextNode}matchTNode(r,i){let c=this.metadata.predicate;if(Array.isArray(c))for(let h=0;h<c.length;h++){let s=c[h];this.matchTNodeWithReadOption(r,i,ck(i,s)),this.matchTNodeWithReadOption(r,i,Um(i,r,s,!1,!1))}else c===Vd?i.type&4&&this.matchTNodeWithReadOption(r,i,-1):this.matchTNodeWithReadOption(r,i,Um(i,r,c,!1,!1))}matchTNodeWithReadOption(r,i,c){if(c!==null){let h=this.metadata.read;if(h!==null)if(h===Hd||h===Cu||h===Vd&&i.type&4)this.addMatch(i.index,-2);else{let s=Um(i,r,h,!1,!1);s!==null&&this.addMatch(i.index,s)}else this.addMatch(i.index,c)}}addMatch(r,i){this.matches===null?this.matches=[r,i]:this.matches.push(r,i)}};function ck(t,r){let i=t.localNames;if(i!==null){for(let c=0;c<i.length;c+=2)if(i[c]===r)return i[c+1]}return null}function uk(t,r){return t.type&11?Iu(t,r):t.type&4?R0(t,r):null}function hk(t,r,i,c){return i===-1?uk(r,t):i===-2?dk(t,r,c):qm(t,t[Mt],i,r)}function dk(t,r,i){if(i===Hd)return Iu(r,t);if(i===Vd)return R0(r,t);if(i===Cu)return cE(r,t)}function uE(t,r,i,c){let h=r[qo].queries[c];if(h.matches===null){let s=t.data,v=i.matches,w=[];for(let I=0;v!==null&&I<v.length;I+=2){let N=v[I];if(N<0)w.push(null);else{let B=s[N];w.push(hk(r,B,v[I+1],i.metadata.read))}}h.matches=w}return h.matches}function p0(t,r,i,c){let h=t.queries.getByIndex(i),s=h.matches;if(s!==null){let v=uE(t,r,h,i);for(let w=0;w<s.length;w+=2){let I=s[w];if(I>0)c.push(v[w/2]);else{let N=s[w+1],B=r[-I];for(let L=Hr;L<B.length;L++){let ie=B[L];ie[Oa]===ie[pr]&&p0(ie[Mt],ie,N,c)}if(B[zl]!==null){let L=B[zl];for(let ie=0;ie<L.length;ie++){let H=L[ie];p0(H[Mt],H,N,c)}}}}}return c}function fk(t,r){return t[qo].queries[r].queryList}function pk(t,r,i){let c=new Zm((i&4)===4);return lM(t,r,c,c.destroy),(r[qo]??=new u0).queries.push(new c0(c))-1}function mk(t,r,i){let c=Rm();return c.firstCreatePass&&(_k(c,new h0(t,r,i),-1),(r&2)===2&&(c.staticViewQueries=!0)),pk(c,Nr(),r)}function gk(t){return t.split(",").map(r=>r.trim())}function _k(t,r,i){t.queries===null&&(t.queries=new d0),t.queries.track(new f0(r,i))}function k0(t,r){return t.queries.getByIndex(r)}function yk(t,r){let i=t[Mt],c=k0(i,r);return c.crossesNgTemplate?p0(i,t,r,[]):uE(i,t,c,r)}var qM=new Set;function hg(t){qM.has(t)||(qM.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}var Eu=class{},dg=class{};var Qm=class extends Eu{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Ym(this);constructor(r,i,c,h=!0){super(),this.ngModuleType=r,this._parent=i;let s=xv(r);this._bootstrapComponents=TS(s.bootstrap),this._r3Injector=Gv(r,i,[{provide:Eu,useValue:this},{provide:qd,useValue:this.componentFactoryResolver},...c],Ra(r),new Set(["environment"])),h&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let r=this._r3Injector;!r.destroyed&&r.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(r){this.destroyCbs.push(r)}},Jm=class extends dg{moduleType;constructor(r){super(),this.moduleType=r}create(r){return new Qm(this.moduleType,r,[])}};var Gd=class extends Eu{injector;componentFactoryResolver=new Ym(this);instance=null;constructor(r){super();let i=new kl([...r.providers,{provide:Eu,useValue:this},{provide:qd,useValue:this.componentFactoryResolver}],r.parent||Ed(),r.debugName,new Set(["environment"]));this.injector=i,r.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(r){this.injector.onDestroy(r)}};function Zd(t,r,i=null){return new Gd({providers:t,parent:r,debugName:i,runEnvironmentInitializers:!0}).injector}var vk=(()=>{class t{_injector;cachedInjectors=new Map;constructor(i){this._injector=i}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){let c=wv(!1,i.type),h=c.length>0?Zd([c],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,h)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(let i of this.cachedInjectors.values())i!==null&&i.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=lt({token:t,providedIn:"environment",factory:()=>new t(It(Sr))})}return t})();function Hl(t){return ng(()=>{let r=hE(t),i=un(Je({},r),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===b0.OnPush,directiveDefs:null,pipeDefs:null,dependencies:r.standalone&&t.dependencies||null,getStandaloneInjector:r.standalone?h=>h.get(vk).getOrCreateStandaloneInjector(i):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Ls.Emulated,styles:t.styles||Rl,_:null,schemas:t.schemas||null,tView:null,id:""});r.standalone&&hg("NgStandalone"),dE(i);let c=t.dependencies;return i.directiveDefs=ZM(c,xk),i.pipeDefs=ZM(c,Zw),i.id=Mk(i),i})}function xk(t){return La(t)||bv(t)}function bk(t,r){if(t==null)return Ll;let i={};for(let c in t)if(t.hasOwnProperty(c)){let h=t[c],s,v,w,I;Array.isArray(h)?(w=h[0],s=h[1],v=h[2]??s,I=h[3]||null):(s=h,v=h,w=ag.None,I=null),i[s]=[c,w,I],r[s]=v}return i}function wk(t){if(t==null)return Ll;let r={};for(let i in t)t.hasOwnProperty(i)&&(r[t[i]]=i);return r}function N0(t){return ng(()=>{let r=hE(t);return dE(r),r})}function hE(t){let r={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:r,inputConfig:t.inputs||Ll,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||Rl,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:bk(t.inputs,r),outputs:wk(t.outputs),debugInfo:null}}function dE(t){t.features?.forEach(r=>r(t))}function ZM(t,r){return t?()=>{let i=typeof t=="function"?t():t,c=[];for(let h of i){let s=r(h);s!==null&&c.push(s)}return c}:null}function Mk(t){let r=0,i=typeof t.consts=="function"?"":t.consts,c=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,i,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let s of c.join("|"))r=Math.imul(31,r)+s.charCodeAt(0)<<0;return r+=2147483648,"c"+r}var L0=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(L0||{}),Wd=new pt(""),fE=!1,m0=class extends hr{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(r=!1){super(),this.__isAsync=r,Jw()&&(this.destroyRef=He(Ul,{optional:!0})??void 0,this.pendingTasks=He(Ns,{optional:!0})??void 0)}emit(r){let i=Ut(null);try{super.next(r)}finally{Ut(i)}}subscribe(r,i,c){let h=r,s=i||(()=>null),v=c;if(r&&typeof r=="object"){let I=r;h=I.next?.bind(I),s=I.error?.bind(I),v=I.complete?.bind(I)}this.__isAsync&&(s=this.wrapInTimeout(s),h&&(h=this.wrapInTimeout(h)),v&&(v=this.wrapInTimeout(v)));let w=super.subscribe({next:h,error:s,complete:v});return r instanceof Wn&&r.add(w),w}wrapInTimeout(r){return i=>{let c=this.pendingTasks?.add();setTimeout(()=>{try{r(i)}finally{c!==void 0&&this.pendingTasks?.remove(c)}})}}},qr=m0;function pE(t){let r,i;function c(){t=Od;try{i!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(i),r!==void 0&&clearTimeout(r)}catch{}}return r=setTimeout(()=>{t(),c()}),typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(()=>{t(),c()})),()=>c()}function WM(t){return queueMicrotask(()=>t()),()=>{t=Od}}var O0="isAngularZone",eg=O0+"_ID",Sk=0,rr=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new qr(!1);onMicrotaskEmpty=new qr(!1);onStable=new qr(!1);onError=new qr(!1);constructor(r){let{enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:c=!1,shouldCoalesceRunChangeDetection:h=!1,scheduleInRootZone:s=fE}=r;if(typeof Zone>"u")throw new at(908,!1);Zone.assertZonePatched();let v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!h&&c,v.shouldCoalesceRunChangeDetection=h,v.callbackScheduled=!1,v.scheduleInRootZone=s,Tk(v)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(O0)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new at(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new at(909,!1)}run(r,i,c){return this._inner.run(r,i,c)}runTask(r,i,c,h){let s=this._inner,v=s.scheduleEventTask("NgZoneEvent: "+h,r,Ek,Od,Od);try{return s.runTask(v,i,c)}finally{s.cancelTask(v)}}runGuarded(r,i,c){return this._inner.runGuarded(r,i,c)}runOutsideAngular(r){return this._outer.run(r)}},Ek={};function F0(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Ik(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function r(){pE(()=>{t.callbackScheduled=!1,g0(t),t.isCheckStableRunning=!0,F0(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{r()}):t._outer.run(()=>{r()}),g0(t)}function Tk(t){let r=()=>{Ik(t)},i=Sk++;t._inner=t._inner.fork({name:"angular",properties:{[O0]:!0,[eg]:i,[eg+i]:!0},onInvokeTask:(c,h,s,v,w,I)=>{if(Ck(I))return c.invokeTask(s,v,w,I);try{return XM(t),c.invokeTask(s,v,w,I)}finally{(t.shouldCoalesceEventChangeDetection&&v.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&r(),YM(t)}},onInvoke:(c,h,s,v,w,I,N)=>{try{return XM(t),c.invoke(s,v,w,I,N)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!Pk(I)&&r(),YM(t)}},onHasTask:(c,h,s,v)=>{c.hasTask(s,v),h===s&&(v.change=="microTask"?(t._hasPendingMicrotasks=v.microTask,g0(t),F0(t)):v.change=="macroTask"&&(t.hasPendingMacrotasks=v.macroTask))},onHandleError:(c,h,s,v)=>(c.handleError(s,v),t.runOutsideAngular(()=>t.onError.emit(v)),!1)})}function g0(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function XM(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function YM(t){t._nesting--,F0(t)}var $d=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new qr;onMicrotaskEmpty=new qr;onStable=new qr;onError=new qr;run(r,i,c){return r.apply(i,c)}runGuarded(r,i,c){return r.apply(i,c)}runOutsideAngular(r){return r()}runTask(r,i,c,h){return r.apply(i,c)}};function Ck(t){return mE(t,"__ignore_ng_zone__")}function Pk(t){return mE(t,"__scheduler_tick__")}function mE(t,r){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[r]===!0}var gE=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=lt({token:t,providedIn:"root",factory:()=>new t})}return t})();var z0=(()=>{class t{log(i){console.log(i)}warn(i){console.warn(i)}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var j0=new pt("");function Xd(t){return!!t&&typeof t.then=="function"}function _E(t){return!!t&&typeof t.subscribe=="function"}var yE=new pt("");var B0=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((i,c)=>{this.resolve=i,this.reject=c});appInits=He(yE,{optional:!0})??[];injector=He($o);constructor(){}runInitializers(){if(this.initialized)return;let i=[];for(let h of this.appInits){let s=$r(this.injector,h);if(Xd(s))i.push(s);else if(_E(s)){let v=new Promise((w,I)=>{s.subscribe({complete:w,error:I})});i.push(v)}}let c=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{c()}).catch(h=>{this.reject(h)}),i.length===0&&c(),this.initialized=!0}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),fg=new pt("");function vE(){Ry(()=>{let t="";throw new at(600,t)})}function xE(t){return t.isBoundToModule}var Dk=10;var ql=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=He(po);afterRenderManager=He(gE);zonelessEnabled=He(Ld);rootEffectScheduler=He(qv);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new hr;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=He(Ns);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Bt(i=>!i))}constructor(){He(Wd,{optional:!0})}whenStable(){let i;return new Promise(c=>{i=this.isStable.subscribe({next:h=>{h&&c()}})}).finally(()=>{i.unsubscribe()})}_injector=He(Sr);_rendererFactory=null;get injector(){return this._injector}bootstrap(i,c){return this.bootstrapImpl(i,c)}bootstrapImpl(i,c,h=$o.NULL){return this._injector.get(rr).run(()=>{mn(10);let v=i instanceof cg;if(!this._injector.get(B0).done){let me="";throw new at(405,me)}let I;v?I=i:I=this._injector.get(qd).resolveComponentFactory(i),this.componentTypes.push(I.componentType);let N=xE(I)?void 0:this._injector.get(Eu),B=c||I.selector,L=I.create(h,[],B,N),ie=L.location.nativeElement,H=L.injector.get(j0,null);return H?.registerApplication(ie),L.onDestroy(()=>{this.detachView(L.hostView),zd(this.components,L),H?.unregisterApplication(ie)}),this._loadComponent(L),mn(11,L),L})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){mn(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(L0.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new at(101,!1);let i=Ut(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Ut(i),this.afterTick.next(),mn(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Gl,null,{optional:!0}));let i=0;for(;this.dirtyFlags!==0&&i++<Dk;)mn(14),this.synchronizeOnce(),mn(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let i=!1;if(this.dirtyFlags&7){let c=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:h}of this.allViews){if(!c&&!Rd(h))continue;let s=c&&!this.zonelessEnabled?0:1;A0(h,s),i=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}i||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:i})=>Rd(i))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(i){let c=i;this._views.push(c),c.attachToAppRef(this)}detachView(i){let c=i;zd(this._views,c),c.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView);try{this.tick()}catch(h){this.internalErrorHandler(h)}this.components.push(i),this._injector.get(fg,[]).forEach(h=>h(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>zd(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new at(406,!1);let i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function zd(t,r){let i=t.indexOf(r);i>-1&&t.splice(i,1)}function KM(t,r,i,c,h){$S(r,t,i,h?"class":"style",c)}function U0(t,r,i,c){let h=Nr(),s=h[Mt],v=t+uo,w=s.firstCreatePass?sE(v,h,2,r,dR,hM(),i,c):s.data[v];if(VS(w,h,t,r,bE),Tv(w)){let I=h[Mt];BS(I,h,w),IS(I,w,h)}return c!=null&&US(h,w),U0}function V0(){let t=Rm(),r=fo(),i=GS(r);return t.firstCreatePass&&aE(t,i),kv(i)&&Nv(),Rv(),i.classesWithoutHost!=null&&iA(i)&&KM(t,i,Nr(),i.classesWithoutHost,!0),i.stylesWithoutHost!=null&&oA(i)&&KM(t,i,Nr(),i.stylesWithoutHost,!1),V0}function Pu(t,r,i,c){return U0(t,r,i,c),V0(),Pu}function G0(t,r,i,c){let h=Nr(),s=h[Mt],v=t+uo,w=s.firstCreatePass?XR(v,s,2,r,i,c):s.data[v];return VS(w,h,t,r,bE),c!=null&&US(h,w),G0}function $0(){let t=fo(),r=GS(t);return kv(r)&&Nv(),Rv(),$0}function pg(t,r,i,c){return G0(t,r,i,c),$0(),pg}var bE=(t,r,i,c,h)=>(IM(!0),PS(r[qi],c,MM()));var Yd="en-US";var Ak=Yd;function wE(t){typeof t=="string"&&(Ak=t.toLowerCase().replace(/_/g,"-"))}function H0(t,r,i){mk(t,r,i)}function q0(t){let r=Nr(),i=Rm(),c=Bv();Lm(c+1);let h=k0(i,c);if(t.dirty&&rM(r)===((h.metadata.flags&2)===2)){if(h.matches===null)t.reset([]);else{let s=yk(r,c);t.reset(s,vA),t.notifyOnChanges()}return!0}return!1}function Z0(){return fk(Nr(),Bv())}var tg=class{ngModuleFactory;componentFactories;constructor(r,i){this.ngModuleFactory=r,this.componentFactories=i}},W0=(()=>{class t{compileModuleSync(i){return new Jm(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){let c=this.compileModuleSync(i),h=xv(i),s=TS(h.declarations).reduce((v,w)=>{let I=La(w);return I&&v.push(new Su(I)),v},[]);return new tg(c,s)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Rk=(()=>{class t{zone=He(rr);changeDetectionScheduler=He(Na);applicationRef=He(ql);applicationErrorHandler=He(po);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(i){this.applicationErrorHandler(i)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function ME({ngZoneFactory:t,ignoreChangesOutsideZone:r,scheduleInRootZone:i}){return t??=()=>new rr(un(Je({},SE()),{scheduleInRootZone:i})),[{provide:rr,useFactory:t},{provide:Ds,multi:!0,useFactory:()=>{let c=He(Rk,{optional:!0});return()=>c.initialize()}},{provide:Ds,multi:!0,useFactory:()=>{let c=He(kk);return()=>{c.initialize()}}},r===!0?{provide:Hv,useValue:!0}:[],{provide:zm,useValue:i??fE},{provide:po,useFactory:()=>{let c=He(rr),h=He(Sr),s;return v=>{c.runOutsideAngular(()=>{h.destroyed&&!s?setTimeout(()=>{throw v}):(s??=h.get(Ho),s.handleError(v))})}}}]}function SE(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var kk=(()=>{class t{subscription=new Wn;initialized=!1;zone=He(rr);pendingTasks=He(Ns);initialize(){if(this.initialized)return;this.initialized=!0;let i=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(i=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{rr.assertNotInAngularZone(),queueMicrotask(()=>{i!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(i),i=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{rr.assertInAngularZone(),i??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var X0=(()=>{class t{applicationErrorHandler=He(po);appRef=He(ql);taskService=He(Ns);ngZone=He(rr);zonelessEnabled=He(Ld);tracing=He(Wd,{optional:!0});disableScheduling=He(Hv,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Wn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(eg):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(He(zm,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof $d||!this.zoneIsDefined)}notify(i){if(!this.zonelessEnabled&&i===5)return;let c=!1;switch(i){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,c=!0;break}case 12:{this.appRef.dirtyFlags|=16,c=!0;break}case 13:{this.appRef.dirtyFlags|=2,c=!0;break}case 11:{c=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(c))return;let h=this.useMicrotaskScheduler?WM:pE;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>h(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>h(()=>this.tick()))}shouldScheduleTick(i){return!(this.disableScheduling&&!i||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(eg+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let i=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(c){this.taskService.remove(i),this.applicationErrorHandler(c)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,WM(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(i)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let i=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(i)}}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Y0(){return hg("NgZoneless"),Ol([{provide:Na,useExisting:X0},{provide:rr,useClass:$d},{provide:Ld,useValue:!0},{provide:zm,useValue:!1},[]])}function Nk(){return typeof $localize<"u"&&$localize.locale||Yd}var K0=new pt("",{providedIn:"root",factory:()=>He(K0,{optional:!0,skipSelf:!0})||Nk()});var CE=Symbol("InputSignalNode#UNSET"),Gk=un(Je({},Ny),{transformFn:void 0,applyValueToInputSignal(t,r){ky(t,r)}});function PE(t,r){let i=Object.create(Gk);i.value=t,i.transformFn=r?.transform;function c(){if(Cy(i),i.value===CE){let h=null;throw new at(-950,h)}return i.value}return c[Zp]=i,c}var $k=new pt("");$k.__NG_ELEMENT_ID__=t=>{let r=fo();if(r===null)throw new at(204,!1);if(r.type&2)return r.value;if(t&8)return null;throw new at(204,!1)};function EE(t,r){return PE(t,r)}function Hk(t){return PE(CE,t)}var DE=(EE.required=Hk,EE);var Q0=new pt(""),qk=new pt("");function Kd(t){return!t.moduleRef}function Zk(t){let r=Kd(t)?t.r3Injector:t.moduleRef.injector,i=r.get(rr);return i.run(()=>{Kd(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let c=r.get(po),h;if(i.runOutsideAngular(()=>{h=i.onError.subscribe({next:c})}),Kd(t)){let s=()=>r.destroy(),v=t.platformInjector.get(Q0);v.add(s),r.onDestroy(()=>{h.unsubscribe(),v.delete(s)})}else{let s=()=>t.moduleRef.destroy(),v=t.platformInjector.get(Q0);v.add(s),t.moduleRef.onDestroy(()=>{zd(t.allPlatformModules,t.moduleRef),h.unsubscribe(),v.delete(s)})}return Xk(c,i,()=>{let s=r.get(Ns),v=s.add(),w=r.get(B0);return w.runInitializers(),w.donePromise.then(()=>{let I=r.get(K0,Yd);if(wE(I||Yd),!r.get(qk,!0))return Kd(t)?r.get(ql):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(Kd(t)){let B=r.get(ql);return t.rootComponent!==void 0&&B.bootstrap(t.rootComponent),B}else return Wk?.(t.moduleRef,t.allPlatformModules),t.moduleRef}).finally(()=>void s.remove(v))})})}var Wk;function Xk(t,r,i){try{let c=i();return Xd(c)?c.catch(h=>{throw r.runOutsideAngular(()=>t(h)),h}):c}catch(c){throw r.runOutsideAngular(()=>t(c)),c}}var mg=null;function Yk(t=[],r){return $o.create({name:r,providers:[{provide:Sd,useValue:"platform"},{provide:Q0,useValue:new Set([()=>mg=null])},...t]})}function Kk(t=[]){if(mg)return mg;let r=Yk(t);return mg=r,vE(),Qk(r),r}function Qk(t){let r=t.get(og,null);$r(t,()=>{r?.forEach(i=>i())})}var AE=(()=>{class t{static __NG_ELEMENT_ID__=Jk}return t})();function Jk(t){return eN(fo(),Nr(),(t&16)===16)}function eN(t,r,i){if(xu(t)&&!i){let c=ks(t.index,r);return new Ba(c,c)}else if(t.type&175){let c=r[Zi];return new Ba(c,r)}return null}function RE(t){mn(8);try{let{rootComponent:r,appProviders:i,platformProviders:c}=t,h=Kk(c),s=[ME({}),{provide:Na,useExisting:X0},TM,...i||[]],v=new Gd({providers:s,parent:h,debugName:"",runEnvironmentInitializers:!1});return Zk({r3Injector:v.injector,platformInjector:h,rootComponent:r})}catch(r){return Promise.reject(r)}finally{mn(9)}}var LE=null;function Fs(){return LE}function J0(t){LE??=t}var Qd=class{},ex=(()=>{class t{historyGo(i){throw new Error("")}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>He(OE),providedIn:"platform"})}return t})();var OE=(()=>{class t extends ex{_location;_history;_doc=He(mr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Fs().getBaseHref(this._doc)}onPopState(i){let c=Fs().getGlobalEventTarget(this._doc,"window");return c.addEventListener("popstate",i,!1),()=>c.removeEventListener("popstate",i)}onHashChange(i){let c=Fs().getGlobalEventTarget(this._doc,"window");return c.addEventListener("hashchange",i,!1),()=>c.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,c,h){this._history.pushState(i,c,h)}replaceState(i,c,h){this._history.replaceState(i,c,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function FE(t,r){return t?r?t.endsWith("/")?r.startsWith("/")?t+r.slice(1):t+r:r.startsWith("/")?t+r:`${t}/${r}`:t:r}function kE(t){let r=t.search(/#|\?|$/);return t[r-1]==="/"?t.slice(0,r-1)+t.slice(r):t}function Ua(t){return t&&t[0]!=="?"?`?${t}`:t}var gg=(()=>{class t{historyGo(i){throw new Error("")}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>He(jE),providedIn:"root"})}return t})(),zE=new pt(""),jE=(()=>{class t extends gg{_platformLocation;_baseHref;_removeListenerFns=[];constructor(i,c){super(),this._platformLocation=i,this._baseHref=c??this._platformLocation.getBaseHrefFromDOM()??He(mr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return FE(this._baseHref,i)}path(i=!1){let c=this._platformLocation.pathname+Ua(this._platformLocation.search),h=this._platformLocation.hash;return h&&i?`${c}${h}`:c}pushState(i,c,h,s){let v=this.prepareExternalUrl(h+Ua(s));this._platformLocation.pushState(i,c,v)}replaceState(i,c,h,s){let v=this.prepareExternalUrl(h+Ua(s));this._platformLocation.replaceState(i,c,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static \u0275fac=function(c){return new(c||t)(It(ex),It(zE,8))};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Du=(()=>{class t{_subject=new hr;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(i){this._locationStrategy=i;let c=this._locationStrategy.getBaseHref();this._basePath=rN(kE(NE(c))),this._locationStrategy.onPopState(h=>{this._subject.next({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,c=""){return this.path()==this.normalize(i+Ua(c))}normalize(i){return t.stripTrailingSlash(nN(this._basePath,NE(i)))}prepareExternalUrl(i){return i&&i[0]!=="/"&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,c="",h=null){this._locationStrategy.pushState(h,"",i,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Ua(c)),h)}replaceState(i,c="",h=null){this._locationStrategy.replaceState(h,"",i,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Ua(c)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription??=this.subscribe(c=>{this._notifyUrlChangeListeners(c.url,c.state)}),()=>{let c=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(c,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",c){this._urlChangeListeners.forEach(h=>h(i,c))}subscribe(i,c,h){return this._subject.subscribe({next:i,error:c??void 0,complete:h??void 0})}static normalizeQueryParams=Ua;static joinWithSlash=FE;static stripTrailingSlash=kE;static \u0275fac=function(c){return new(c||t)(It(gg))};static \u0275prov=lt({token:t,factory:()=>tN(),providedIn:"root"})}return t})();function tN(){return new Du(It(gg))}function nN(t,r){if(!t||!r.startsWith(t))return r;let i=r.substring(t.length);return i===""||["/",";","?","#"].includes(i[0])?i:r}function NE(t){return t.replace(/\/index.html$/,"")}function rN(t){if(new RegExp("^(https?:)?//").test(t)){let[,i]=t.split(/\/\/[^\/]+/);return i}return t}function tx(t,r){r=encodeURIComponent(r);for(let i of t.split(";")){let c=i.indexOf("="),[h,s]=c==-1?[i,""]:[i.slice(0,c),i.slice(c+1)];if(h.trim()===r)return decodeURIComponent(s)}return null}var Jd=class{};var BE="browser";var yg=new pt(""),sx=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(i,c){this._zone=c,i.forEach(h=>{h.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,c,h,s){return this._findPluginFor(c).addEventListener(i,c,h,s)}getZone(){return this._zone}_findPluginFor(i){let c=this._eventNameToPlugin.get(i);if(c)return c;if(c=this._plugins.find(s=>s.supports(i)),!c)throw new at(5101,!1);return this._eventNameToPlugin.set(i,c),c}static \u0275fac=function(c){return new(c||t)(It(yg),It(rr))};static \u0275prov=lt({token:t,factory:t.\u0275fac})}return t})(),ef=class{_doc;constructor(r){this._doc=r}manager},nx="ng-app-id";function UE(t){for(let r of t)r.remove()}function VE(t,r){let i=r.createElement("style");return i.textContent=t,i}function iN(t,r,i,c){let h=t.head?.querySelectorAll(`style[${nx}="${r}"],link[${nx}="${r}"]`);if(h)for(let s of h)s.removeAttribute(nx),s instanceof HTMLLinkElement?c.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&i.set(s.textContent,{usage:0,elements:[s]})}function ix(t,r){let i=r.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("href",t),i}var ax=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(i,c,h,s={}){this.doc=i,this.appId=c,this.nonce=h,iN(i,c,this.inline,this.external),this.hosts.add(i.head)}addStyles(i,c){for(let h of i)this.addUsage(h,this.inline,VE);c?.forEach(h=>this.addUsage(h,this.external,ix))}removeStyles(i,c){for(let h of i)this.removeUsage(h,this.inline);c?.forEach(h=>this.removeUsage(h,this.external))}addUsage(i,c,h){let s=c.get(i);s?s.usage++:c.set(i,{usage:1,elements:[...this.hosts].map(v=>this.addElement(v,h(i,this.doc)))})}removeUsage(i,c){let h=c.get(i);h&&(h.usage--,h.usage<=0&&(UE(h.elements),c.delete(i)))}ngOnDestroy(){for(let[,{elements:i}]of[...this.inline,...this.external])UE(i);this.hosts.clear()}addHost(i){this.hosts.add(i);for(let[c,{elements:h}]of this.inline)h.push(this.addElement(i,VE(c,this.doc)));for(let[c,{elements:h}]of this.external)h.push(this.addElement(i,ix(c,this.doc)))}removeHost(i){this.hosts.delete(i)}addElement(i,c){return this.nonce&&c.setAttribute("nonce",this.nonce),i.appendChild(c)}static \u0275fac=function(c){return new(c||t)(It(mr),It(ig),It(sg,8),It(Tu))};static \u0275prov=lt({token:t,factory:t.\u0275fac})}return t})(),rx={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},lx=/%COMP%/g;var $E="%COMP%",oN=`_nghost-${$E}`,sN=`_ngcontent-${$E}`,aN=!0,lN=new pt("",{providedIn:"root",factory:()=>aN});function cN(t){return sN.replace(lx,t)}function uN(t){return oN.replace(lx,t)}function HE(t,r){return r.map(i=>i.replace(lx,t))}var cx=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(i,c,h,s,v,w,I,N=null,B=null){this.eventManager=i,this.sharedStylesHost=c,this.appId=h,this.removeStylesOnCompDestroy=s,this.doc=v,this.platformId=w,this.ngZone=I,this.nonce=N,this.tracingService=B,this.platformIsServer=!1,this.defaultRenderer=new tf(i,v,I,this.platformIsServer,this.tracingService)}createRenderer(i,c){if(!i||!c)return this.defaultRenderer;let h=this.getOrCreateRenderer(i,c);return h instanceof _g?h.applyToHost(i):h instanceof nf&&h.applyStyles(),h}getOrCreateRenderer(i,c){let h=this.rendererByCompId,s=h.get(c.id);if(!s){let v=this.doc,w=this.ngZone,I=this.eventManager,N=this.sharedStylesHost,B=this.removeStylesOnCompDestroy,L=this.platformIsServer,ie=this.tracingService;switch(c.encapsulation){case Ls.Emulated:s=new _g(I,N,c,this.appId,B,v,w,L,ie);break;case Ls.ShadowDom:return new ox(I,N,i,c,v,w,this.nonce,L,ie);default:s=new nf(I,N,c,B,v,w,L,ie);break}h.set(c.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(i){this.rendererByCompId.delete(i)}static \u0275fac=function(c){return new(c||t)(It(sx),It(ax),It(ig),It(lN),It(mr),It(Tu),It(rr),It(sg),It(Wd,8))};static \u0275prov=lt({token:t,factory:t.\u0275fac})}return t})(),tf=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(r,i,c,h,s){this.eventManager=r,this.doc=i,this.ngZone=c,this.platformIsServer=h,this.tracingService=s}destroy(){}destroyNode=null;createElement(r,i){return i?this.doc.createElementNS(rx[i]||i,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,i){(GE(r)?r.content:r).appendChild(i)}insertBefore(r,i,c){r&&(GE(r)?r.content:r).insertBefore(i,c)}removeChild(r,i){i.remove()}selectRootElement(r,i){let c=typeof r=="string"?this.doc.querySelector(r):r;if(!c)throw new at(-5104,!1);return i||(c.textContent=""),c}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,i,c,h){if(h){i=h+":"+i;let s=rx[h];s?r.setAttributeNS(s,i,c):r.setAttribute(i,c)}else r.setAttribute(i,c)}removeAttribute(r,i,c){if(c){let h=rx[c];h?r.removeAttributeNS(h,i):r.removeAttribute(`${c}:${i}`)}else r.removeAttribute(i)}addClass(r,i){r.classList.add(i)}removeClass(r,i){r.classList.remove(i)}setStyle(r,i,c,h){h&($l.DashCase|$l.Important)?r.style.setProperty(i,c,h&$l.Important?"important":""):r.style[i]=c}removeStyle(r,i,c){c&$l.DashCase?r.style.removeProperty(i):r.style[i]=""}setProperty(r,i,c){r!=null&&(r[i]=c)}setValue(r,i){r.nodeValue=i}listen(r,i,c,h){if(typeof r=="string"&&(r=Fs().getGlobalEventTarget(this.doc,r),!r))throw new at(5102,!1);let s=this.decoratePreventDefault(c);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(r,i,s)),this.eventManager.addEventListener(r,i,s,h)}decoratePreventDefault(r){return i=>{if(i==="__ngUnwrap__")return r;r(i)===!1&&i.preventDefault()}}};function GE(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var ox=class extends tf{sharedStylesHost;hostEl;shadowRoot;constructor(r,i,c,h,s,v,w,I,N){super(r,s,v,I,N),this.sharedStylesHost=i,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let B=h.styles;B=HE(h.id,B);for(let ie of B){let H=document.createElement("style");w&&H.setAttribute("nonce",w),H.textContent=ie,this.shadowRoot.appendChild(H)}let L=h.getExternalStyles?.();if(L)for(let ie of L){let H=ix(ie,s);w&&H.setAttribute("nonce",w),this.shadowRoot.appendChild(H)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,i){return super.appendChild(this.nodeOrShadowRoot(r),i)}insertBefore(r,i,c){return super.insertBefore(this.nodeOrShadowRoot(r),i,c)}removeChild(r,i){return super.removeChild(null,i)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},nf=class extends tf{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(r,i,c,h,s,v,w,I,N){super(r,s,v,w,I),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=h;let B=c.styles;this.styles=N?HE(N,B):B,this.styleUrls=c.getExternalStyles?.(N)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},_g=class extends nf{contentAttr;hostAttr;constructor(r,i,c,h,s,v,w,I,N){let B=h+"-"+c.id;super(r,i,c,s,v,w,I,N,B),this.contentAttr=cN(B),this.hostAttr=uN(B)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,i){let c=super.createElement(r,i);return super.setAttribute(c,this.contentAttr,""),c}};var vg=class t extends Qd{supportsDOMEvents=!0;static makeCurrent(){J0(new t)}onAndCancel(r,i,c,h){return r.addEventListener(i,c,h),()=>{r.removeEventListener(i,c,h)}}dispatchEvent(r,i){r.dispatchEvent(i)}remove(r){r.remove()}createElement(r,i){return i=i||this.getDefaultDocument(),i.createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,i){return i==="window"?window:i==="document"?r:i==="body"?r.body:null}getBaseHref(r){let i=hN();return i==null?null:dN(i)}resetBaseElement(){rf=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return tx(document.cookie,r)}},rf=null;function hN(){return rf=rf||document.head.querySelector("base"),rf?rf.getAttribute("href"):null}function dN(t){return new URL(t,document.baseURI).pathname}var fN=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac})}return t})(),ZE=(()=>{class t extends ef{constructor(i){super(i)}supports(i){return!0}addEventListener(i,c,h,s){return i.addEventListener(c,h,s),()=>this.removeEventListener(i,c,h,s)}removeEventListener(i,c,h,s){return i.removeEventListener(c,h,s)}static \u0275fac=function(c){return new(c||t)(It(mr))};static \u0275prov=lt({token:t,factory:t.\u0275fac})}return t})(),qE=["alt","control","meta","shift"],pN={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},mN={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},WE=(()=>{class t extends ef{constructor(i){super(i)}supports(i){return t.parseEventName(i)!=null}addEventListener(i,c,h,s){let v=t.parseEventName(c),w=t.eventCallback(v.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Fs().onAndCancel(i,v.domEventName,w,s))}static parseEventName(i){let c=i.toLowerCase().split("."),h=c.shift();if(c.length===0||!(h==="keydown"||h==="keyup"))return null;let s=t._normalizeKey(c.pop()),v="",w=c.indexOf("code");if(w>-1&&(c.splice(w,1),v="code."),qE.forEach(N=>{let B=c.indexOf(N);B>-1&&(c.splice(B,1),v+=N+".")}),v+=s,c.length!=0||s.length===0)return null;let I={};return I.domEventName=h,I.fullKey=v,I}static matchEventFullKeyCode(i,c){let h=pN[i.key]||i.key,s="";return c.indexOf("code.")>-1&&(h=i.code,s="code."),h==null||!h?!1:(h=h.toLowerCase(),h===" "?h="space":h==="."&&(h="dot"),qE.forEach(v=>{if(v!==h){let w=mN[v];w(i)&&(s+=v+".")}}),s+=h,s===c)}static eventCallback(i,c,h){return s=>{t.matchEventFullKeyCode(s,i)&&h.runGuarded(()=>c(s))}}static _normalizeKey(i){return i==="esc"?"escape":i}static \u0275fac=function(c){return new(c||t)(It(mr))};static \u0275prov=lt({token:t,factory:t.\u0275fac})}return t})();function ux(t,r){let i=Je({rootComponent:t},gN(r));return RE(i)}function gN(t){return{appProviders:[...bN,...t?.providers??[]],platformProviders:xN}}function _N(){vg.makeCurrent()}function yN(){return new Ho}function vN(){return w0(document),document}var xN=[{provide:Tu,useValue:BE},{provide:og,useValue:_N,multi:!0},{provide:mr,useFactory:vN}];var bN=[{provide:Sd,useValue:"root"},{provide:Ho,useFactory:yN},{provide:yg,useClass:ZE,multi:!0,deps:[mr]},{provide:yg,useClass:WE,multi:!0,deps:[mr]},cx,ax,sx,{provide:Gl,useExisting:cx},{provide:Jd,useClass:fN},[]];var XE=(()=>{class t{_doc;constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static \u0275fac=function(c){return new(c||t)(It(mr))};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var At="primary",_f=Symbol("RouteTitle"),mx=class{params;constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){let i=this.params[r];return Array.isArray(i)?i[0]:i}return null}getAll(r){if(this.has(r)){let i=this.params[r];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}};function Ou(t){return new mx(t)}function MN(t,r,i){let c=i.path.split("/");if(c.length>t.length||i.pathMatch==="full"&&(r.hasChildren()||c.length<t.length))return null;let h={};for(let s=0;s<c.length;s++){let v=c[s],w=t[s];if(v[0]===":")h[v.substring(1)]=w;else if(v!==w.path)return null}return{consumed:t.slice(0,c.length),posParams:h}}function SN(t,r){if(t.length!==r.length)return!1;for(let i=0;i<t.length;++i)if(!Xo(t[i],r[i]))return!1;return!0}function Xo(t,r){let i=t?gx(t):void 0,c=r?gx(r):void 0;if(!i||!c||i.length!=c.length)return!1;let h;for(let s=0;s<i.length;s++)if(h=i[s],!rI(t[h],r[h]))return!1;return!0}function gx(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function rI(t,r){if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return!1;let i=[...t].sort(),c=[...r].sort();return i.every((h,s)=>c[s]===h)}else return t===r}function iI(t){return t.length>0?t[t.length-1]:null}function Bs(t){return $y(t)?t:Xd(t)?Xn(Promise.resolve(t)):gt(t)}var EN={exact:sI,subset:aI},oI={exact:IN,subset:TN,ignored:()=>!0};function YE(t,r,i){return EN[i.paths](t.root,r.root,i.matrixParams)&&oI[i.queryParams](t.queryParams,r.queryParams)&&!(i.fragment==="exact"&&t.fragment!==r.fragment)}function IN(t,r){return Xo(t,r)}function sI(t,r,i){if(!Wl(t.segments,r.segments)||!wg(t.segments,r.segments,i)||t.numberOfChildren!==r.numberOfChildren)return!1;for(let c in r.children)if(!t.children[c]||!sI(t.children[c],r.children[c],i))return!1;return!0}function TN(t,r){return Object.keys(r).length<=Object.keys(t).length&&Object.keys(r).every(i=>rI(t[i],r[i]))}function aI(t,r,i){return lI(t,r,r.segments,i)}function lI(t,r,i,c){if(t.segments.length>i.length){let h=t.segments.slice(0,i.length);return!(!Wl(h,i)||r.hasChildren()||!wg(h,i,c))}else if(t.segments.length===i.length){if(!Wl(t.segments,i)||!wg(t.segments,i,c))return!1;for(let h in r.children)if(!t.children[h]||!aI(t.children[h],r.children[h],c))return!1;return!0}else{let h=i.slice(0,t.segments.length),s=i.slice(t.segments.length);return!Wl(t.segments,h)||!wg(t.segments,h,c)||!t.children[At]?!1:lI(t.children[At],r,s,c)}}function wg(t,r,i){return r.every((c,h)=>oI[i](t[h].parameters,c.parameters))}var js=class{root;queryParams;fragment;_queryParamMap;constructor(r=new Jt([],{}),i={},c=null){this.root=r,this.queryParams=i,this.fragment=c}get queryParamMap(){return this._queryParamMap??=Ou(this.queryParams),this._queryParamMap}toString(){return DN.serialize(this)}},Jt=class{segments;children;parent=null;constructor(r,i){this.segments=r,this.children=i,Object.values(i).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Mg(this)}},Zl=class{path;parameters;_parameterMap;constructor(r,i){this.path=r,this.parameters=i}get parameterMap(){return this._parameterMap??=Ou(this.parameters),this._parameterMap}toString(){return uI(this)}};function CN(t,r){return Wl(t,r)&&t.every((i,c)=>Xo(i.parameters,r[c].parameters))}function Wl(t,r){return t.length!==r.length?!1:t.every((i,c)=>i.path===r[c].path)}function PN(t,r){let i=[];return Object.entries(t.children).forEach(([c,h])=>{c===At&&(i=i.concat(r(h,c)))}),Object.entries(t.children).forEach(([c,h])=>{c!==At&&(i=i.concat(r(h,c)))}),i}var Lg=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>new Fu,providedIn:"root"})}return t})(),Fu=class{parse(r){let i=new yx(r);return new js(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(r){let i=`/${of(r.root,!0)}`,c=kN(r.queryParams),h=typeof r.fragment=="string"?`#${AN(r.fragment)}`:"";return`${i}${c}${h}`}},DN=new Fu;function Mg(t){return t.segments.map(r=>uI(r)).join("/")}function of(t,r){if(!t.hasChildren())return Mg(t);if(r){let i=t.children[At]?of(t.children[At],!1):"",c=[];return Object.entries(t.children).forEach(([h,s])=>{h!==At&&c.push(`${h}:${of(s,!1)}`)}),c.length>0?`${i}(${c.join("//")})`:i}else{let i=PN(t,(c,h)=>h===At?[of(t.children[At],!1)]:[`${h}:${of(c,!1)}`]);return Object.keys(t.children).length===1&&t.children[At]!=null?`${Mg(t)}/${i[0]}`:`${Mg(t)}/(${i.join("//")})`}}function cI(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function xg(t){return cI(t).replace(/%3B/gi,";")}function AN(t){return encodeURI(t)}function _x(t){return cI(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Sg(t){return decodeURIComponent(t)}function KE(t){return Sg(t.replace(/\+/g,"%20"))}function uI(t){return`${_x(t.path)}${RN(t.parameters)}`}function RN(t){return Object.entries(t).map(([r,i])=>`;${_x(r)}=${_x(i)}`).join("")}function kN(t){let r=Object.entries(t).map(([i,c])=>Array.isArray(c)?c.map(h=>`${xg(i)}=${xg(h)}`).join("&"):`${xg(i)}=${xg(c)}`).filter(i=>i);return r.length?`?${r.join("&")}`:""}var NN=/^[^\/()?;#]+/;function hx(t){let r=t.match(NN);return r?r[0]:""}var LN=/^[^\/()?;=#]+/;function ON(t){let r=t.match(LN);return r?r[0]:""}var FN=/^[^=?&#]+/;function zN(t){let r=t.match(FN);return r?r[0]:""}var jN=/^[^&#]+/;function BN(t){let r=t.match(jN);return r?r[0]:""}var yx=class{url;remaining;constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Jt([],{}):new Jt([],this.parseChildren())}parseQueryParams(){let r={};if(this.consumeOptional("?"))do this.parseQueryParam(r);while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(r.length>0||Object.keys(i).length>0)&&(c[At]=new Jt(r,i)),c}parseSegment(){let r=hx(this.remaining);if(r===""&&this.peekStartsWith(";"))throw new at(4009,!1);return this.capture(r),new Zl(Sg(r),this.parseMatrixParams())}parseMatrixParams(){let r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){let i=ON(this.remaining);if(!i)return;this.capture(i);let c="";if(this.consumeOptional("=")){let h=hx(this.remaining);h&&(c=h,this.capture(c))}r[Sg(i)]=Sg(c)}parseQueryParam(r){let i=zN(this.remaining);if(!i)return;this.capture(i);let c="";if(this.consumeOptional("=")){let v=BN(this.remaining);v&&(c=v,this.capture(c))}let h=KE(i),s=KE(c);if(r.hasOwnProperty(h)){let v=r[h];Array.isArray(v)||(v=[v],r[h]=v),v.push(s)}else r[h]=s}parseParens(r){let i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=hx(this.remaining),h=this.remaining[c.length];if(h!=="/"&&h!==")"&&h!==";")throw new at(4010,!1);let s;c.indexOf(":")>-1?(s=c.slice(0,c.indexOf(":")),this.capture(s),this.capture(":")):r&&(s=At);let v=this.parseChildren();i[s]=Object.keys(v).length===1?v[At]:new Jt([],v),this.consumeOptional("//")}return i}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return this.peekStartsWith(r)?(this.remaining=this.remaining.substring(r.length),!0):!1}capture(r){if(!this.consumeOptional(r))throw new at(4011,!1)}};function hI(t){return t.segments.length>0?new Jt([],{[At]:t}):t}function dI(t){let r={};for(let[c,h]of Object.entries(t.children)){let s=dI(h);if(c===At&&s.segments.length===0&&s.hasChildren())for(let[v,w]of Object.entries(s.children))r[v]=w;else(s.segments.length>0||s.hasChildren())&&(r[c]=s)}let i=new Jt(t.segments,r);return UN(i)}function UN(t){if(t.numberOfChildren===1&&t.children[At]){let r=t.children[At];return new Jt(t.segments.concat(r.segments),r.children)}return t}function zu(t){return t instanceof js}function VN(t,r,i=null,c=null){let h=fI(t);return pI(h,r,i,c)}function fI(t){let r;function i(s){let v={};for(let I of s.children){let N=i(I);v[I.outlet]=N}let w=new Jt(s.url,v);return s===t&&(r=w),w}let c=i(t.root),h=hI(c);return r??h}function pI(t,r,i,c){let h=t;for(;h.parent;)h=h.parent;if(r.length===0)return dx(h,h,h,i,c);let s=GN(r);if(s.toRoot())return dx(h,h,new Jt([],{}),i,c);let v=$N(s,h,t),w=v.processChildren?af(v.segmentGroup,v.index,s.commands):gI(v.segmentGroup,v.index,s.commands);return dx(h,v.segmentGroup,w,i,c)}function Eg(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function uf(t){return typeof t=="object"&&t!=null&&t.outlets}function dx(t,r,i,c,h){let s={};c&&Object.entries(c).forEach(([I,N])=>{s[I]=Array.isArray(N)?N.map(B=>`${B}`):`${N}`});let v;t===r?v=i:v=mI(t,r,i);let w=hI(dI(v));return new js(w,s,h)}function mI(t,r,i){let c={};return Object.entries(t.children).forEach(([h,s])=>{s===r?c[h]=i:c[h]=mI(s,r,i)}),new Jt(t.segments,c)}var Ig=class{isAbsolute;numberOfDoubleDots;commands;constructor(r,i,c){if(this.isAbsolute=r,this.numberOfDoubleDots=i,this.commands=c,r&&c.length>0&&Eg(c[0]))throw new at(4003,!1);let h=c.find(uf);if(h&&h!==iI(c))throw new at(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function GN(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new Ig(!0,0,t);let r=0,i=!1,c=t.reduce((h,s,v)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let w={};return Object.entries(s.outlets).forEach(([I,N])=>{w[I]=typeof N=="string"?N.split("/"):N}),[...h,{outlets:w}]}if(s.segmentPath)return[...h,s.segmentPath]}return typeof s!="string"?[...h,s]:v===0?(s.split("/").forEach((w,I)=>{I==0&&w==="."||(I==0&&w===""?i=!0:w===".."?r++:w!=""&&h.push(w))}),h):[...h,s]},[]);return new Ig(i,r,c)}var ku=class{segmentGroup;processChildren;index;constructor(r,i,c){this.segmentGroup=r,this.processChildren=i,this.index=c}};function $N(t,r,i){if(t.isAbsolute)return new ku(r,!0,0);if(!i)return new ku(r,!1,NaN);if(i.parent===null)return new ku(i,!0,0);let c=Eg(t.commands[0])?0:1,h=i.segments.length-1+c;return HN(i,h,t.numberOfDoubleDots)}function HN(t,r,i){let c=t,h=r,s=i;for(;s>h;){if(s-=h,c=c.parent,!c)throw new at(4005,!1);h=c.segments.length}return new ku(c,!1,h-s)}function qN(t){return uf(t[0])?t[0].outlets:{[At]:t}}function gI(t,r,i){if(t??=new Jt([],{}),t.segments.length===0&&t.hasChildren())return af(t,r,i);let c=ZN(t,r,i),h=i.slice(c.commandIndex);if(c.match&&c.pathIndex<t.segments.length){let s=new Jt(t.segments.slice(0,c.pathIndex),{});return s.children[At]=new Jt(t.segments.slice(c.pathIndex),t.children),af(s,0,h)}else return c.match&&h.length===0?new Jt(t.segments,{}):c.match&&!t.hasChildren()?vx(t,r,i):c.match?af(t,0,h):vx(t,r,i)}function af(t,r,i){if(i.length===0)return new Jt(t.segments,{});{let c=qN(i),h={};if(Object.keys(c).some(s=>s!==At)&&t.children[At]&&t.numberOfChildren===1&&t.children[At].segments.length===0){let s=af(t.children[At],r,i);return new Jt(t.segments,s.children)}return Object.entries(c).forEach(([s,v])=>{typeof v=="string"&&(v=[v]),v!==null&&(h[s]=gI(t.children[s],r,v))}),Object.entries(t.children).forEach(([s,v])=>{c[s]===void 0&&(h[s]=v)}),new Jt(t.segments,h)}}function ZN(t,r,i){let c=0,h=r,s={match:!1,pathIndex:0,commandIndex:0};for(;h<t.segments.length;){if(c>=i.length)return s;let v=t.segments[h],w=i[c];if(uf(w))break;let I=`${w}`,N=c<i.length-1?i[c+1]:null;if(h>0&&I===void 0)break;if(I&&N&&typeof N=="object"&&N.outlets===void 0){if(!JE(I,N,v))return s;c+=2}else{if(!JE(I,{},v))return s;c++}h++}return{match:!0,pathIndex:h,commandIndex:c}}function vx(t,r,i){let c=t.segments.slice(0,r),h=0;for(;h<i.length;){let s=i[h];if(uf(s)){let I=WN(s.outlets);return new Jt(c,I)}if(h===0&&Eg(i[0])){let I=t.segments[r];c.push(new Zl(I.path,QE(i[0]))),h++;continue}let v=uf(s)?s.outlets[At]:`${s}`,w=h<i.length-1?i[h+1]:null;v&&w&&Eg(w)?(c.push(new Zl(v,QE(w))),h+=2):(c.push(new Zl(v,{})),h++)}return new Jt(c,{})}function WN(t){let r={};return Object.entries(t).forEach(([i,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(r[i]=vx(new Jt([],{}),0,c))}),r}function QE(t){let r={};return Object.entries(t).forEach(([i,c])=>r[i]=`${c}`),r}function JE(t,r,i){return t==i.path&&Xo(r,i.parameters)}var lf="imperative",Er=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(Er||{}),Wi=class{id;url;constructor(r,i){this.id=r,this.url=i}},ju=class extends Wi{type=Er.NavigationStart;navigationTrigger;restoredState;constructor(r,i,c="imperative",h=null){super(r,i),this.navigationTrigger=c,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Va=class extends Wi{urlAfterRedirects;type=Er.NavigationEnd;constructor(r,i,c){super(r,i),this.urlAfterRedirects=c}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ii=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t[t.Aborted=4]="Aborted",t}(ii||{}),Tg=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(Tg||{}),zs=class extends Wi{reason;code;type=Er.NavigationCancel;constructor(r,i,c,h){super(r,i),this.reason=c,this.code=h}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Ga=class extends Wi{reason;code;type=Er.NavigationSkipped;constructor(r,i,c,h){super(r,i),this.reason=c,this.code=h}},hf=class extends Wi{error;target;type=Er.NavigationError;constructor(r,i,c,h){super(r,i),this.error=c,this.target=h}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Cg=class extends Wi{urlAfterRedirects;state;type=Er.RoutesRecognized;constructor(r,i,c,h){super(r,i),this.urlAfterRedirects=c,this.state=h}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},xx=class extends Wi{urlAfterRedirects;state;type=Er.GuardsCheckStart;constructor(r,i,c,h){super(r,i),this.urlAfterRedirects=c,this.state=h}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},bx=class extends Wi{urlAfterRedirects;state;shouldActivate;type=Er.GuardsCheckEnd;constructor(r,i,c,h,s){super(r,i),this.urlAfterRedirects=c,this.state=h,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},wx=class extends Wi{urlAfterRedirects;state;type=Er.ResolveStart;constructor(r,i,c,h){super(r,i),this.urlAfterRedirects=c,this.state=h}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Mx=class extends Wi{urlAfterRedirects;state;type=Er.ResolveEnd;constructor(r,i,c,h){super(r,i),this.urlAfterRedirects=c,this.state=h}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Sx=class{route;type=Er.RouteConfigLoadStart;constructor(r){this.route=r}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Ex=class{route;type=Er.RouteConfigLoadEnd;constructor(r){this.route=r}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Ix=class{snapshot;type=Er.ChildActivationStart;constructor(r){this.snapshot=r}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Tx=class{snapshot;type=Er.ChildActivationEnd;constructor(r){this.snapshot=r}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Cx=class{snapshot;type=Er.ActivationStart;constructor(r){this.snapshot=r}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Px=class{snapshot;type=Er.ActivationEnd;constructor(r){this.snapshot=r}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var df=class{},Bu=class{url;navigationBehaviorOptions;constructor(r,i){this.url=r,this.navigationBehaviorOptions=i}};function XN(t){return!(t instanceof df)&&!(t instanceof Bu)}function YN(t,r){return t.providers&&!t._injector&&(t._injector=Zd(t.providers,r,`Route: ${t.path}`)),t._injector??r}function go(t){return t.outlet||At}function KN(t,r){let i=t.filter(c=>go(c)===r);return i.push(...t.filter(c=>go(c)!==r)),i}function Vu(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let r=t.parent;r;r=r.parent){let i=r.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}var Dx=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Vu(this.route?.snapshot)??this.rootInjector}constructor(r){this.rootInjector=r,this.children=new yf(this.rootInjector)}},yf=(()=>{class t{rootInjector;contexts=new Map;constructor(i){this.rootInjector=i}onChildOutletCreated(i,c){let h=this.getOrCreateContext(i);h.outlet=c,this.contexts.set(i,h)}onChildOutletDestroyed(i){let c=this.getContext(i);c&&(c.outlet=null,c.attachRef=null)}onOutletDeactivated(){let i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let c=this.getContext(i);return c||(c=new Dx(this.rootInjector),this.contexts.set(i,c)),c}getContext(i){return this.contexts.get(i)||null}static \u0275fac=function(c){return new(c||t)(It(Sr))};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Pg=class{_root;constructor(r){this._root=r}get root(){return this._root.value}parent(r){let i=this.pathFromRoot(r);return i.length>1?i[i.length-2]:null}children(r){let i=Ax(r,this._root);return i?i.children.map(c=>c.value):[]}firstChild(r){let i=Ax(r,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(r){let i=Rx(r,this._root);return i.length<2?[]:i[i.length-2].children.map(h=>h.value).filter(h=>h!==r)}pathFromRoot(r){return Rx(r,this._root).map(i=>i.value)}};function Ax(t,r){if(t===r.value)return r;for(let i of r.children){let c=Ax(t,i);if(c)return c}return null}function Rx(t,r){if(t===r.value)return[r];for(let i of r.children){let c=Rx(t,i);if(c.length)return c.unshift(r),c}return[]}var Ai=class{value;children;constructor(r,i){this.value=r,this.children=i}toString(){return`TreeNode(${this.value})`}};function Ru(t){let r={};return t&&t.children.forEach(i=>r[i.value.outlet]=i),r}var Dg=class extends Pg{snapshot;constructor(r,i){super(r),this.snapshot=i,Ux(this,r)}toString(){return this.snapshot.toString()}};function _I(t){let r=QN(t),i=new Mr([new Zl("",{})]),c=new Mr({}),h=new Mr({}),s=new Mr({}),v=new Mr(""),w=new Xl(i,c,s,v,h,At,t,r.root);return w.snapshot=r.root,new Dg(new Ai(w,[]),r)}function QN(t){let r={},i={},c={},h="",s=new Nu([],r,c,h,i,At,t,null,{});return new Rg("",new Ai(s,[]))}var Xl=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(r,i,c,h,s,v,w,I){this.urlSubject=r,this.paramsSubject=i,this.queryParamsSubject=c,this.fragmentSubject=h,this.dataSubject=s,this.outlet=v,this.component=w,this._futureSnapshot=I,this.title=this.dataSubject?.pipe(Bt(N=>N[_f]))??gt(void 0),this.url=r,this.params=i,this.queryParams=c,this.fragment=h,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Bt(r=>Ou(r))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Bt(r=>Ou(r))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Ag(t,r,i="emptyOnly"){let c,{routeConfig:h}=t;return r!==null&&(i==="always"||h?.path===""||!r.component&&!r.routeConfig?.loadComponent)?c={params:Je(Je({},r.params),t.params),data:Je(Je({},r.data),t.data),resolve:Je(Je(Je(Je({},t.data),r.data),h?.data),t._resolvedData)}:c={params:Je({},t.params),data:Je({},t.data),resolve:Je(Je({},t.data),t._resolvedData??{})},h&&vI(h)&&(c.resolve[_f]=h.title),c}var Nu=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[_f]}constructor(r,i,c,h,s,v,w,I,N){this.url=r,this.params=i,this.queryParams=c,this.fragment=h,this.data=s,this.outlet=v,this.component=w,this.routeConfig=I,this._resolve=N}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ou(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ou(this.queryParams),this._queryParamMap}toString(){let r=this.url.map(c=>c.toString()).join("/"),i=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${r}', path:'${i}')`}},Rg=class extends Pg{url;constructor(r,i){super(i),this.url=r,Ux(this,i)}toString(){return yI(this._root)}};function Ux(t,r){r.value._routerState=t,r.children.forEach(i=>Ux(t,i))}function yI(t){let r=t.children.length>0?` { ${t.children.map(yI).join(", ")} } `:"";return`${t.value}${r}`}function fx(t){if(t.snapshot){let r=t.snapshot,i=t._futureSnapshot;t.snapshot=i,Xo(r.queryParams,i.queryParams)||t.queryParamsSubject.next(i.queryParams),r.fragment!==i.fragment&&t.fragmentSubject.next(i.fragment),Xo(r.params,i.params)||t.paramsSubject.next(i.params),SN(r.url,i.url)||t.urlSubject.next(i.url),Xo(r.data,i.data)||t.dataSubject.next(i.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function kx(t,r){let i=Xo(t.params,r.params)&&CN(t.url,r.url),c=!t.parent!=!r.parent;return i&&!c&&(!t.parent||kx(t.parent,r.parent))}function vI(t){return typeof t.title=="string"||t.title===null}var JN=new pt(""),xI=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=At;activateEvents=new qr;deactivateEvents=new qr;attachEvents=new qr;detachEvents=new qr;routerOutletData=DE(void 0);parentContexts=He(yf);location=He(Cu);changeDetector=He(AE);inputBinder=He(Og,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(i){if(i.name){let{firstChange:c,previousValue:h}=i.name;if(c)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new at(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new at(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new at(4012,!1);this.location.detach();let i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,c){this.activated=i,this._activatedRoute=c,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){let i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,c){if(this.isActivated)throw new at(4013,!1);this._activatedRoute=i;let h=this.location,v=i.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,I=new Nx(i,w,h.injector,this.routerOutletData);this.activated=h.createComponent(v,{index:h.length,injector:I,environmentInjector:c}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(c){return new(c||t)};static \u0275dir=N0({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[y0]})}return t})(),Nx=class{route;childContexts;parent;outletData;constructor(r,i,c,h){this.route=r,this.childContexts=i,this.parent=c,this.outletData=h}get(r,i){return r===Xl?this.route:r===yf?this.childContexts:r===JN?this.outletData:this.parent.get(r,i)}},Og=new pt("");var bI=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275cmp=Hl({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(c,h){c&1&&Pu(0,"router-outlet")},dependencies:[xI],encapsulation:2})}return t})();function Vx(t){let r=t.children&&t.children.map(Vx),i=r?un(Je({},t),{children:r}):Je({},t);return!i.component&&!i.loadComponent&&(r||i.loadChildren)&&i.outlet&&i.outlet!==At&&(i.component=bI),i}function eL(t,r,i){let c=ff(t,r._root,i?i._root:void 0);return new Dg(c,r)}function ff(t,r,i){if(i&&t.shouldReuseRoute(r.value,i.value.snapshot)){let c=i.value;c._futureSnapshot=r.value;let h=tL(t,r,i);return new Ai(c,h)}else{if(t.shouldAttach(r.value)){let s=t.retrieve(r.value);if(s!==null){let v=s.route;return v.value._futureSnapshot=r.value,v.children=r.children.map(w=>ff(t,w)),v}}let c=nL(r.value),h=r.children.map(s=>ff(t,s));return new Ai(c,h)}}function tL(t,r,i){return r.children.map(c=>{for(let h of i.children)if(t.shouldReuseRoute(c.value,h.value.snapshot))return ff(t,c,h);return ff(t,c)})}function nL(t){return new Xl(new Mr(t.url),new Mr(t.params),new Mr(t.queryParams),new Mr(t.fragment),new Mr(t.data),t.outlet,t.component,t)}var pf=class{redirectTo;navigationBehaviorOptions;constructor(r,i){this.redirectTo=r,this.navigationBehaviorOptions=i}},wI="ngNavigationCancelingError";function kg(t,r){let{redirectTo:i,navigationBehaviorOptions:c}=zu(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,h=MI(!1,ii.Redirect);return h.url=i,h.navigationBehaviorOptions=c,h}function MI(t,r){let i=new Error(`NavigationCancelingError: ${t||""}`);return i[wI]=!0,i.cancellationCode=r,i}function rL(t){return SI(t)&&zu(t.url)}function SI(t){return!!t&&t[wI]}var iL=(t,r,i,c)=>Bt(h=>(new Lx(r,h.targetRouterState,h.currentRouterState,i,c).activate(t),h)),Lx=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(r,i,c,h,s){this.routeReuseStrategy=r,this.futureState=i,this.currState=c,this.forwardEvent=h,this.inputBindingEnabled=s}activate(r){let i=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,c,r),fx(this.futureState.root),this.activateChildRoutes(i,c,r)}deactivateChildRoutes(r,i,c){let h=Ru(i);r.children.forEach(s=>{let v=s.value.outlet;this.deactivateRoutes(s,h[v],c),delete h[v]}),Object.values(h).forEach(s=>{this.deactivateRouteAndItsChildren(s,c)})}deactivateRoutes(r,i,c){let h=r.value,s=i?i.value:null;if(h===s)if(h.component){let v=c.getContext(h.outlet);v&&this.deactivateChildRoutes(r,i,v.children)}else this.deactivateChildRoutes(r,i,c);else s&&this.deactivateRouteAndItsChildren(i,c)}deactivateRouteAndItsChildren(r,i){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,i):this.deactivateRouteAndOutlet(r,i)}detachAndStoreRouteSubtree(r,i){let c=i.getContext(r.value.outlet),h=c&&r.value.component?c.children:i,s=Ru(r);for(let v of Object.values(s))this.deactivateRouteAndItsChildren(v,h);if(c&&c.outlet){let v=c.outlet.detach(),w=c.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:v,route:r,contexts:w})}}deactivateRouteAndOutlet(r,i){let c=i.getContext(r.value.outlet),h=c&&r.value.component?c.children:i,s=Ru(r);for(let v of Object.values(s))this.deactivateRouteAndItsChildren(v,h);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(r,i,c){let h=Ru(i);r.children.forEach(s=>{this.activateRoutes(s,h[s.value.outlet],c),this.forwardEvent(new Px(s.value.snapshot))}),r.children.length&&this.forwardEvent(new Tx(r.value.snapshot))}activateRoutes(r,i,c){let h=r.value,s=i?i.value:null;if(fx(h),h===s)if(h.component){let v=c.getOrCreateContext(h.outlet);this.activateChildRoutes(r,i,v.children)}else this.activateChildRoutes(r,i,c);else if(h.component){let v=c.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){let w=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),v.children.onOutletReAttached(w.contexts),v.attachRef=w.componentRef,v.route=w.route.value,v.outlet&&v.outlet.attach(w.componentRef,w.route.value),fx(w.route.value),this.activateChildRoutes(r,null,v.children)}else v.attachRef=null,v.route=h,v.outlet&&v.outlet.activateWith(h,v.injector),this.activateChildRoutes(r,null,v.children)}else this.activateChildRoutes(r,null,c)}},Ng=class{path;route;constructor(r){this.path=r,this.route=this.path[this.path.length-1]}},Lu=class{component;route;constructor(r,i){this.component=r,this.route=i}};function oL(t,r,i){let c=t._root,h=r?r._root:null;return sf(c,h,i,[c.value])}function sL(t){let r=t.routeConfig?t.routeConfig.canActivateChild:null;return!r||r.length===0?null:{node:t,guards:r}}function Gu(t,r){let i=Symbol(),c=r.get(t,i);return c===i?typeof t=="function"&&!lv(t)?t:r.get(t):c}function sf(t,r,i,c,h={canDeactivateChecks:[],canActivateChecks:[]}){let s=Ru(r);return t.children.forEach(v=>{aL(v,s[v.value.outlet],i,c.concat([v.value]),h),delete s[v.value.outlet]}),Object.entries(s).forEach(([v,w])=>cf(w,i.getContext(v),h)),h}function aL(t,r,i,c,h={canDeactivateChecks:[],canActivateChecks:[]}){let s=t.value,v=r?r.value:null,w=i?i.getContext(t.value.outlet):null;if(v&&s.routeConfig===v.routeConfig){let I=lL(v,s,s.routeConfig.runGuardsAndResolvers);I?h.canActivateChecks.push(new Ng(c)):(s.data=v.data,s._resolvedData=v._resolvedData),s.component?sf(t,r,w?w.children:null,c,h):sf(t,r,i,c,h),I&&w&&w.outlet&&w.outlet.isActivated&&h.canDeactivateChecks.push(new Lu(w.outlet.component,v))}else v&&cf(r,w,h),h.canActivateChecks.push(new Ng(c)),s.component?sf(t,null,w?w.children:null,c,h):sf(t,null,i,c,h);return h}function lL(t,r,i){if(typeof i=="function")return i(t,r);switch(i){case"pathParamsChange":return!Wl(t.url,r.url);case"pathParamsOrQueryParamsChange":return!Wl(t.url,r.url)||!Xo(t.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!kx(t,r)||!Xo(t.queryParams,r.queryParams);case"paramsChange":default:return!kx(t,r)}}function cf(t,r,i){let c=Ru(t),h=t.value;Object.entries(c).forEach(([s,v])=>{h.component?r?cf(v,r.children.getContext(s),i):cf(v,null,i):cf(v,r,i)}),h.component?r&&r.outlet&&r.outlet.isActivated?i.canDeactivateChecks.push(new Lu(r.outlet.component,h)):i.canDeactivateChecks.push(new Lu(null,h)):i.canDeactivateChecks.push(new Lu(null,h))}function vf(t){return typeof t=="function"}function cL(t){return typeof t=="boolean"}function uL(t){return t&&vf(t.canLoad)}function hL(t){return t&&vf(t.canActivate)}function dL(t){return t&&vf(t.canActivateChild)}function fL(t){return t&&vf(t.canDeactivate)}function pL(t){return t&&vf(t.canMatch)}function EI(t){return t instanceof Is||t?.name==="EmptyError"}var bg=Symbol("INITIAL_VALUE");function Uu(){return ni(t=>mm(t.map(r=>r.pipe(Ts(1),Zy(bg)))).pipe(Bt(r=>{for(let i of r)if(i!==!0){if(i===bg)return bg;if(i===!1||mL(i))return i}return!0}),Gi(r=>r!==bg),Ts(1)))}function mL(t){return zu(t)||t instanceof pf}function gL(t,r){return nr(i=>{let{targetSnapshot:c,currentSnapshot:h,guards:{canActivateChecks:s,canDeactivateChecks:v}}=i;return v.length===0&&s.length===0?gt(un(Je({},i),{guardsResult:!0})):_L(v,c,h,t).pipe(nr(w=>w&&cL(w)?yL(c,s,t,r):gt(w)),Bt(w=>un(Je({},i),{guardsResult:w})))})}function _L(t,r,i,c){return Xn(t).pipe(nr(h=>ML(h.component,h.route,i,r,c)),Cs(h=>h!==!0,!0))}function yL(t,r,i,c){return Xn(r).pipe(pu(h=>fu(xL(h.route.parent,c),vL(h.route,c),wL(t,h.path,i),bL(t,h.route,i))),Cs(h=>h!==!0,!0))}function vL(t,r){return t!==null&&r&&r(new Cx(t)),gt(!0)}function xL(t,r){return t!==null&&r&&r(new Ix(t)),gt(!0)}function bL(t,r,i){let c=r.routeConfig?r.routeConfig.canActivate:null;if(!c||c.length===0)return gt(!0);let h=c.map(s=>gd(()=>{let v=Vu(r)??i,w=Gu(s,v),I=hL(w)?w.canActivate(r,t):$r(v,()=>w(r,t));return Bs(I).pipe(Cs())}));return gt(h).pipe(Uu())}function wL(t,r,i){let c=r[r.length-1],s=r.slice(0,r.length-1).reverse().map(v=>sL(v)).filter(v=>v!==null).map(v=>gd(()=>{let w=v.guards.map(I=>{let N=Vu(v.node)??i,B=Gu(I,N),L=dL(B)?B.canActivateChild(c,t):$r(N,()=>B(c,t));return Bs(L).pipe(Cs())});return gt(w).pipe(Uu())}));return gt(s).pipe(Uu())}function ML(t,r,i,c,h){let s=r&&r.routeConfig?r.routeConfig.canDeactivate:null;if(!s||s.length===0)return gt(!0);let v=s.map(w=>{let I=Vu(r)??h,N=Gu(w,I),B=fL(N)?N.canDeactivate(t,r,i,c):$r(I,()=>N(t,r,i,c));return Bs(B).pipe(Cs())});return gt(v).pipe(Uu())}function SL(t,r,i,c){let h=r.canLoad;if(h===void 0||h.length===0)return gt(!0);let s=h.map(v=>{let w=Gu(v,t),I=uL(w)?w.canLoad(r,i):$r(t,()=>w(r,i));return Bs(I)});return gt(s).pipe(Uu(),II(c))}function II(t){return By(fr(r=>{if(typeof r!="boolean")throw kg(t,r)}),Bt(r=>r===!0))}function EL(t,r,i,c){let h=r.canMatch;if(!h||h.length===0)return gt(!0);let s=h.map(v=>{let w=Gu(v,t),I=pL(w)?w.canMatch(r,i):$r(t,()=>w(r,i));return Bs(I)});return gt(s).pipe(Uu(),II(c))}var mf=class{segmentGroup;constructor(r){this.segmentGroup=r||null}},gf=class extends Error{urlTree;constructor(r){super(),this.urlTree=r}};function Au(t){return du(new mf(t))}function IL(t){return du(new at(4e3,!1))}function TL(t){return du(MI(!1,ii.GuardRejected))}var Ox=class{urlSerializer;urlTree;constructor(r,i){this.urlSerializer=r,this.urlTree=i}lineralizeSegments(r,i){let c=[],h=i.root;for(;;){if(c=c.concat(h.segments),h.numberOfChildren===0)return gt(c);if(h.numberOfChildren>1||!h.children[At])return IL(`${r.redirectTo}`);h=h.children[At]}}applyRedirectCommands(r,i,c,h,s){return CL(i,h,s).pipe(Bt(v=>{if(v instanceof js)throw new gf(v);let w=this.applyRedirectCreateUrlTree(v,this.urlSerializer.parse(v),r,c);if(v[0]==="/")throw new gf(w);return w}))}applyRedirectCreateUrlTree(r,i,c,h){let s=this.createSegmentGroup(r,i.root,c,h);return new js(s,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(r,i){let c={};return Object.entries(r).forEach(([h,s])=>{if(typeof s=="string"&&s[0]===":"){let w=s.substring(1);c[h]=i[w]}else c[h]=s}),c}createSegmentGroup(r,i,c,h){let s=this.createSegments(r,i.segments,c,h),v={};return Object.entries(i.children).forEach(([w,I])=>{v[w]=this.createSegmentGroup(r,I,c,h)}),new Jt(s,v)}createSegments(r,i,c,h){return i.map(s=>s.path[0]===":"?this.findPosParam(r,s,h):this.findOrReturn(s,c))}findPosParam(r,i,c){let h=c[i.path.substring(1)];if(!h)throw new at(4001,!1);return h}findOrReturn(r,i){let c=0;for(let h of i){if(h.path===r.path)return i.splice(c),h;c++}return r}};function CL(t,r,i){if(typeof t=="string")return gt(t);let c=t,{queryParams:h,fragment:s,routeConfig:v,url:w,outlet:I,params:N,data:B,title:L}=r;return Bs($r(i,()=>c({params:N,data:B,queryParams:h,fragment:s,routeConfig:v,url:w,outlet:I,title:L})))}var Fx={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function PL(t,r,i,c,h){let s=TI(t,r,i);return s.matched?(c=YN(r,c),EL(c,r,i,h).pipe(Bt(v=>v===!0?s:Je({},Fx)))):gt(s)}function TI(t,r,i){if(r.path==="**")return DL(i);if(r.path==="")return r.pathMatch==="full"&&(t.hasChildren()||i.length>0)?Je({},Fx):{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};let h=(r.matcher||MN)(i,t,r);if(!h)return Je({},Fx);let s={};Object.entries(h.posParams??{}).forEach(([w,I])=>{s[w]=I.path});let v=h.consumed.length>0?Je(Je({},s),h.consumed[h.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:h.consumed,remainingSegments:i.slice(h.consumed.length),parameters:v,positionalParamSegments:h.posParams??{}}}function DL(t){return{matched:!0,parameters:t.length>0?iI(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function eI(t,r,i,c){return i.length>0&&kL(t,i,c)?{segmentGroup:new Jt(r,RL(c,new Jt(i,t.children))),slicedSegments:[]}:i.length===0&&NL(t,i,c)?{segmentGroup:new Jt(t.segments,AL(t,i,c,t.children)),slicedSegments:i}:{segmentGroup:new Jt(t.segments,t.children),slicedSegments:i}}function AL(t,r,i,c){let h={};for(let s of i)if(Fg(t,r,s)&&!c[go(s)]){let v=new Jt([],{});h[go(s)]=v}return Je(Je({},c),h)}function RL(t,r){let i={};i[At]=r;for(let c of t)if(c.path===""&&go(c)!==At){let h=new Jt([],{});i[go(c)]=h}return i}function kL(t,r,i){return i.some(c=>Fg(t,r,c)&&go(c)!==At)}function NL(t,r,i){return i.some(c=>Fg(t,r,c))}function Fg(t,r,i){return(t.hasChildren()||r.length>0)&&i.pathMatch==="full"?!1:i.path===""}function LL(t,r,i){return r.length===0&&!t.children[i]}var zx=class{};function OL(t,r,i,c,h,s,v="emptyOnly"){return new jx(t,r,i,c,h,v,s).recognize()}var FL=31,jx=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(r,i,c,h,s,v,w){this.injector=r,this.configLoader=i,this.rootComponentType=c,this.config=h,this.urlTree=s,this.paramsInheritanceStrategy=v,this.urlSerializer=w,this.applyRedirects=new Ox(this.urlSerializer,this.urlTree)}noMatchError(r){return new at(4002,`'${r.segmentGroup}'`)}recognize(){let r=eI(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(r).pipe(Bt(({children:i,rootSnapshot:c})=>{let h=new Ai(c,i),s=new Rg("",h),v=VN(c,[],this.urlTree.queryParams,this.urlTree.fragment);return v.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(v),{state:s,tree:v}}))}match(r){let i=new Nu([],Object.freeze({}),Object.freeze(Je({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),At,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,r,At,i).pipe(Bt(c=>({children:c,rootSnapshot:i})),Da(c=>{if(c instanceof gf)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof mf?this.noMatchError(c):c}))}processSegmentGroup(r,i,c,h,s){return c.segments.length===0&&c.hasChildren()?this.processChildren(r,i,c,s):this.processSegment(r,i,c,c.segments,h,!0,s).pipe(Bt(v=>v instanceof Ai?[v]:[]))}processChildren(r,i,c,h){let s=[];for(let v of Object.keys(c.children))v==="primary"?s.unshift(v):s.push(v);return Xn(s).pipe(pu(v=>{let w=c.children[v],I=KN(i,v);return this.processSegmentGroup(r,I,w,v,h)}),qy((v,w)=>(v.push(...w),v)),Aa(null),Hy(),nr(v=>{if(v===null)return Au(c);let w=CI(v);return zL(w),gt(w)}))}processSegment(r,i,c,h,s,v,w){return Xn(i).pipe(pu(I=>this.processSegmentAgainstRoute(I._injector??r,i,I,c,h,s,v,w).pipe(Da(N=>{if(N instanceof mf)return gt(null);throw N}))),Cs(I=>!!I),Da(I=>{if(EI(I))return LL(c,h,s)?gt(new zx):Au(c);throw I}))}processSegmentAgainstRoute(r,i,c,h,s,v,w,I){return go(c)!==v&&(v===At||!Fg(h,s,c))?Au(h):c.redirectTo===void 0?this.matchSegmentAgainstRoute(r,h,c,s,v,I):this.allowRedirects&&w?this.expandSegmentAgainstRouteUsingRedirect(r,h,i,c,s,v,I):Au(h)}expandSegmentAgainstRouteUsingRedirect(r,i,c,h,s,v,w){let{matched:I,parameters:N,consumedSegments:B,positionalParamSegments:L,remainingSegments:ie}=TI(i,h,s);if(!I)return Au(i);typeof h.redirectTo=="string"&&h.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>FL&&(this.allowRedirects=!1));let H=new Nu(s,N,Object.freeze(Je({},this.urlTree.queryParams)),this.urlTree.fragment,tI(h),go(h),h.component??h._loadedComponent??null,h,nI(h)),me=Ag(H,w,this.paramsInheritanceStrategy);return H.params=Object.freeze(me.params),H.data=Object.freeze(me.data),this.applyRedirects.applyRedirectCommands(B,h.redirectTo,L,H,r).pipe(ni(Me=>this.applyRedirects.lineralizeSegments(h,Me)),nr(Me=>this.processSegment(r,c,i,Me.concat(ie),v,!1,w)))}matchSegmentAgainstRoute(r,i,c,h,s,v){let w=PL(i,c,h,r,this.urlSerializer);return c.path==="**"&&(i.children={}),w.pipe(ni(I=>I.matched?(r=c._injector??r,this.getChildConfig(r,c,h).pipe(ni(({routes:N})=>{let B=c._loadedInjector??r,{parameters:L,consumedSegments:ie,remainingSegments:H}=I,me=new Nu(ie,L,Object.freeze(Je({},this.urlTree.queryParams)),this.urlTree.fragment,tI(c),go(c),c.component??c._loadedComponent??null,c,nI(c)),Ee=Ag(me,v,this.paramsInheritanceStrategy);me.params=Object.freeze(Ee.params),me.data=Object.freeze(Ee.data);let{segmentGroup:Me,slicedSegments:Ae}=eI(i,ie,H,N);if(Ae.length===0&&Me.hasChildren())return this.processChildren(B,N,Me,me).pipe(Bt(it=>new Ai(me,it)));if(N.length===0&&Ae.length===0)return gt(new Ai(me,[]));let We=go(c)===s;return this.processSegment(B,N,Me,Ae,We?At:s,!0,me).pipe(Bt(it=>new Ai(me,it instanceof Ai?[it]:[])))}))):Au(i)))}getChildConfig(r,i,c){return i.children?gt({routes:i.children,injector:r}):i.loadChildren?i._loadedRoutes!==void 0?gt({routes:i._loadedRoutes,injector:i._loadedInjector}):SL(r,i,c,this.urlSerializer).pipe(nr(h=>h?this.configLoader.loadChildren(r,i).pipe(fr(s=>{i._loadedRoutes=s.routes,i._loadedInjector=s.injector})):TL(i))):gt({routes:[],injector:r})}};function zL(t){t.sort((r,i)=>r.value.outlet===At?-1:i.value.outlet===At?1:r.value.outlet.localeCompare(i.value.outlet))}function jL(t){let r=t.value.routeConfig;return r&&r.path===""}function CI(t){let r=[],i=new Set;for(let c of t){if(!jL(c)){r.push(c);continue}let h=r.find(s=>c.value.routeConfig===s.value.routeConfig);h!==void 0?(h.children.push(...c.children),i.add(h)):r.push(c)}for(let c of i){let h=CI(c.children);r.push(new Ai(c.value,h))}return r.filter(c=>!i.has(c))}function tI(t){return t.data||{}}function nI(t){return t.resolve||{}}function BL(t,r,i,c,h,s){return nr(v=>OL(t,r,i,c,v.extractedUrl,h,s).pipe(Bt(({state:w,tree:I})=>un(Je({},v),{targetSnapshot:w,urlAfterRedirects:I}))))}function UL(t,r){return nr(i=>{let{targetSnapshot:c,guards:{canActivateChecks:h}}=i;if(!h.length)return gt(i);let s=new Set(h.map(I=>I.route)),v=new Set;for(let I of s)if(!v.has(I))for(let N of PI(I))v.add(N);let w=0;return Xn(v).pipe(pu(I=>s.has(I)?VL(I,c,t,r):(I.data=Ag(I,I.parent,t).resolve,gt(void 0))),fr(()=>w++),mu(1),nr(I=>w===v.size?gt(i):ei))})}function PI(t){let r=t.children.map(i=>PI(i)).flat();return[t,...r]}function VL(t,r,i,c){let h=t.routeConfig,s=t._resolve;return h?.title!==void 0&&!vI(h)&&(s[_f]=h.title),gd(()=>(t.data=Ag(t,t.parent,i).resolve,GL(s,t,r,c).pipe(Bt(v=>(t._resolvedData=v,t.data=Je(Je({},t.data),v),null)))))}function GL(t,r,i,c){let h=gx(t);if(h.length===0)return gt({});let s={};return Xn(h).pipe(nr(v=>$L(t[v],r,i,c).pipe(Cs(),fr(w=>{if(w instanceof pf)throw kg(new Fu,w);s[v]=w}))),mu(1),Bt(()=>s),Da(v=>EI(v)?ei:du(v)))}function $L(t,r,i,c){let h=Vu(r)??c,s=Gu(t,h),v=s.resolve?s.resolve(r,i):$r(h,()=>s(r,i));return Bs(v)}function px(t){return ni(r=>{let i=t(r);return i?Xn(i).pipe(Bt(()=>r)):gt(r)})}var DI=(()=>{class t{buildTitle(i){let c,h=i.root;for(;h!==void 0;)c=this.getResolvedTitleForRoute(h)??c,h=h.children.find(s=>s.outlet===At);return c}getResolvedTitleForRoute(i){return i.data[_f]}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>He(HL),providedIn:"root"})}return t})(),HL=(()=>{class t extends DI{title;constructor(i){super(),this.title=i}updateTitle(i){let c=this.buildTitle(i);c!==void 0&&this.title.setTitle(c)}static \u0275fac=function(c){return new(c||t)(It(XE))};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),zg=new pt("",{providedIn:"root",factory:()=>({})}),jg=new pt(""),AI=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=He(W0);loadComponent(i,c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return gt(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let h=Bs($r(i,()=>c.loadComponent())).pipe(Bt(RI),ni(kI),fr(v=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=v}),_d(()=>{this.componentLoaders.delete(c)})),s=new hu(h,()=>new hr).pipe(uu());return this.componentLoaders.set(c,s),s}loadChildren(i,c){if(this.childrenLoaders.get(c))return this.childrenLoaders.get(c);if(c._loadedRoutes)return gt({routes:c._loadedRoutes,injector:c._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(c);let s=qL(c,this.compiler,i,this.onLoadEndListener).pipe(_d(()=>{this.childrenLoaders.delete(c)})),v=new hu(s,()=>new hr).pipe(uu());return this.childrenLoaders.set(c,v),v}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function qL(t,r,i,c){return Bs($r(i,()=>t.loadChildren())).pipe(Bt(RI),ni(kI),nr(h=>h instanceof dg||Array.isArray(h)?gt(h):Xn(r.compileModuleAsync(h))),Bt(h=>{c&&c(t);let s,v,w=!1;return Array.isArray(h)?(v=h,w=!0):(s=h.create(i).injector,v=s.get(jg,[],{optional:!0,self:!0}).flat()),{routes:v.map(Vx),injector:s}}))}function ZL(t){return t&&typeof t=="object"&&"default"in t}function RI(t){return ZL(t)?t.default:t}function kI(t){return gt(t)}var Gx=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>He(WL),providedIn:"root"})}return t})(),WL=(()=>{class t{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,c){return i}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),NI=new pt("");var LI=new pt(""),OI=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new hr;transitionAbortWithErrorSubject=new hr;configLoader=He(AI);environmentInjector=He(Sr);destroyRef=He(Ul);urlSerializer=He(Lg);rootContexts=He(yf);location=He(Du);inputBindingEnabled=He(Og,{optional:!0})!==null;titleStrategy=He(DI);options=He(zg,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=He(Gx);createViewTransition=He(NI,{optional:!0});navigationErrorHandler=He(LI,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>gt(void 0);rootComponentType=null;destroyed=!1;constructor(){let i=h=>this.events.next(new Sx(h)),c=h=>this.events.next(new Ex(h));this.configLoader.onLoadEndListener=c,this.configLoader.onLoadStartListener=i,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(i){let c=++this.navigationId;this.transitions?.next(un(Je({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:c}))}setupNavigations(i){return this.transitions=new Mr(null),this.transitions.pipe(Gi(c=>c!==null),ni(c=>{let h=!1;return gt(c).pipe(ni(s=>{if(this.navigationId>c.id)return this.cancelNavigationTransition(c,"",ii.SupersededByNewNavigation),ei;this.currentTransition=c,this.currentNavigation={id:s.id,initialUrl:s.rawUrl,extractedUrl:s.extractedUrl,targetBrowserUrl:typeof s.extras.browserUrl=="string"?this.urlSerializer.parse(s.extras.browserUrl):s.extras.browserUrl,trigger:s.source,extras:s.extras,previousNavigation:this.lastSuccessfulNavigation?un(Je({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>s.abortController.abort()};let v=!i.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),w=s.extras.onSameUrlNavigation??i.onSameUrlNavigation;if(!v&&w!=="reload"){let I="";return this.events.next(new Ga(s.id,this.urlSerializer.serialize(s.rawUrl),I,Tg.IgnoredSameUrlNavigation)),s.resolve(!1),ei}if(this.urlHandlingStrategy.shouldProcessUrl(s.rawUrl))return gt(s).pipe(ni(I=>(this.events.next(new ju(I.id,this.urlSerializer.serialize(I.extractedUrl),I.source,I.restoredState)),I.id!==this.navigationId?ei:Promise.resolve(I))),BL(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,this.paramsInheritanceStrategy),fr(I=>{c.targetSnapshot=I.targetSnapshot,c.urlAfterRedirects=I.urlAfterRedirects,this.currentNavigation=un(Je({},this.currentNavigation),{finalUrl:I.urlAfterRedirects});let N=new Cg(I.id,this.urlSerializer.serialize(I.extractedUrl),this.urlSerializer.serialize(I.urlAfterRedirects),I.targetSnapshot);this.events.next(N)}));if(v&&this.urlHandlingStrategy.shouldProcessUrl(s.currentRawUrl)){let{id:I,extractedUrl:N,source:B,restoredState:L,extras:ie}=s,H=new ju(I,this.urlSerializer.serialize(N),B,L);this.events.next(H);let me=_I(this.rootComponentType).snapshot;return this.currentTransition=c=un(Je({},s),{targetSnapshot:me,urlAfterRedirects:N,extras:un(Je({},ie),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=N,gt(c)}else{let I="";return this.events.next(new Ga(s.id,this.urlSerializer.serialize(s.extractedUrl),I,Tg.IgnoredByUrlHandlingStrategy)),s.resolve(!1),ei}}),fr(s=>{let v=new xx(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(v)}),Bt(s=>(this.currentTransition=c=un(Je({},s),{guards:oL(s.targetSnapshot,s.currentSnapshot,this.rootContexts)}),c)),gL(this.environmentInjector,s=>this.events.next(s)),fr(s=>{if(c.guardsResult=s.guardsResult,s.guardsResult&&typeof s.guardsResult!="boolean")throw kg(this.urlSerializer,s.guardsResult);let v=new bx(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot,!!s.guardsResult);this.events.next(v)}),Gi(s=>s.guardsResult?!0:(this.cancelNavigationTransition(s,"",ii.GuardRejected),!1)),px(s=>{if(s.guards.canActivateChecks.length!==0)return gt(s).pipe(fr(v=>{let w=new wx(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot);this.events.next(w)}),ni(v=>{let w=!1;return gt(v).pipe(UL(this.paramsInheritanceStrategy,this.environmentInjector),fr({next:()=>w=!0,complete:()=>{w||this.cancelNavigationTransition(v,"",ii.NoDataFromResolver)}}))}),fr(v=>{let w=new Mx(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot);this.events.next(w)}))}),px(s=>{let v=w=>{let I=[];if(w.routeConfig?.loadComponent&&!w.routeConfig._loadedComponent){let N=Vu(w)??this.environmentInjector;I.push(this.configLoader.loadComponent(N,w.routeConfig).pipe(fr(B=>{w.component=B}),Bt(()=>{})))}for(let N of w.children)I.push(...v(N));return I};return mm(v(s.targetSnapshot.root)).pipe(Aa(null),Ts(1))}),px(()=>this.afterPreactivation()),ni(()=>{let{currentSnapshot:s,targetSnapshot:v}=c,w=this.createViewTransition?.(this.environmentInjector,s.root,v.root);return w?Xn(w).pipe(Bt(()=>c)):gt(c)}),Bt(s=>{let v=eL(i.routeReuseStrategy,s.targetSnapshot,s.currentRouterState);return this.currentTransition=c=un(Je({},s),{targetRouterState:v}),this.currentNavigation.targetRouterState=v,c}),fr(()=>{this.events.next(new df)}),iL(this.rootContexts,i.routeReuseStrategy,s=>this.events.next(s),this.inputBindingEnabled),Ts(1),_m(new Vt(s=>{let v=c.abortController.signal,w=()=>s.next();return v.addEventListener("abort",w),()=>v.removeEventListener("abort",w)}).pipe(Gi(()=>!h&&!c.targetRouterState),fr(()=>{this.cancelNavigationTransition(c,c.abortController.signal.reason+"",ii.Aborted)}))),fr({next:s=>{h=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Va(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects))),this.titleStrategy?.updateTitle(s.targetRouterState.snapshot),s.resolve(!0)},complete:()=>{h=!0}}),_m(this.transitionAbortWithErrorSubject.pipe(fr(s=>{throw s}))),_d(()=>{h||this.cancelNavigationTransition(c,"",ii.SupersededByNewNavigation),this.currentTransition?.id===c.id&&(this.currentNavigation=null,this.currentTransition=null)}),Da(s=>{if(this.destroyed)return c.resolve(!1),ei;if(h=!0,SI(s))this.events.next(new zs(c.id,this.urlSerializer.serialize(c.extractedUrl),s.message,s.cancellationCode)),rL(s)?this.events.next(new Bu(s.url,s.navigationBehaviorOptions)):c.resolve(!1);else{let v=new hf(c.id,this.urlSerializer.serialize(c.extractedUrl),s,c.targetSnapshot??void 0);try{let w=$r(this.environmentInjector,()=>this.navigationErrorHandler?.(v));if(w instanceof pf){let{message:I,cancellationCode:N}=kg(this.urlSerializer,w);this.events.next(new zs(c.id,this.urlSerializer.serialize(c.extractedUrl),I,N)),this.events.next(new Bu(w.redirectTo,w.navigationBehaviorOptions))}else throw this.events.next(v),s}catch(w){this.options.resolveNavigationPromiseOnError?c.resolve(!1):c.reject(w)}}return ei}))}))}cancelNavigationTransition(i,c,h){let s=new zs(i.id,this.urlSerializer.serialize(i.extractedUrl),c,h);this.events.next(s),i.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let i=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),c=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return i.toString()!==c?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function XL(t){return t!==lf}var YL=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>He(KL),providedIn:"root"})}return t})(),Bx=class{shouldDetach(r){return!1}store(r,i){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,i){return r.routeConfig===i.routeConfig}},KL=(()=>{class t extends Bx{static \u0275fac=(()=>{let i;return function(h){return(i||(i=rg(t)))(h||t)}})();static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),FI=(()=>{class t{urlSerializer=He(Lg);options=He(zg,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=He(Du);urlHandlingStrategy=He(Gx);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new js;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:i,initialUrl:c,targetBrowserUrl:h}){let s=i!==void 0?this.urlHandlingStrategy.merge(i,c):c,v=h??s;return v instanceof js?this.urlSerializer.serialize(v):v}commitTransition({targetRouterState:i,finalUrl:c,initialUrl:h}){c&&i?(this.currentUrlTree=c,this.rawUrlTree=this.urlHandlingStrategy.merge(c,h),this.routerState=i):this.rawUrlTree=h}routerState=_I(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:i}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i??this.rawUrlTree)}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:()=>He(QL),providedIn:"root"})}return t})(),QL=(()=>{class t extends FI{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(i){return this.location.subscribe(c=>{c.type==="popstate"&&setTimeout(()=>{i(c.url,c.state,"popstate")})})}handleRouterEvent(i,c){i instanceof ju?this.updateStateMemento():i instanceof Ga?this.commitTransition(c):i instanceof Cg?this.urlUpdateStrategy==="eager"&&(c.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(c),c)):i instanceof df?(this.commitTransition(c),this.urlUpdateStrategy==="deferred"&&!c.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(c),c)):i instanceof zs&&i.code!==ii.SupersededByNewNavigation&&i.code!==ii.Redirect?this.restoreHistory(c):i instanceof hf?this.restoreHistory(c,!0):i instanceof Va&&(this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId)}setBrowserUrl(i,{extras:c,id:h}){let{replaceUrl:s,state:v}=c;if(this.location.isCurrentPathEqualTo(i)||s){let w=this.browserPageId,I=Je(Je({},v),this.generateNgRouterState(h,w));this.location.replaceState(i,"",I)}else{let w=Je(Je({},v),this.generateNgRouterState(h,this.browserPageId+1));this.location.go(i,"",w)}}restoreHistory(i,c=!1){if(this.canceledNavigationResolution==="computed"){let h=this.browserPageId,s=this.currentPageId-h;s!==0?this.location.historyGo(s):this.getCurrentUrlTree()===i.finalUrl&&s===0&&(this.resetInternalState(i),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(c&&this.resetInternalState(i),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,c){return this.canceledNavigationResolution==="computed"?{navigationId:i,\u0275routerPageId:c}:{navigationId:i}}static \u0275fac=(()=>{let i;return function(h){return(i||(i=rg(t)))(h||t)}})();static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function zI(t,r){t.events.pipe(Gi(i=>i instanceof Va||i instanceof zs||i instanceof hf||i instanceof Ga),Bt(i=>i instanceof Va||i instanceof Ga?0:(i instanceof zs?i.code===ii.Redirect||i.code===ii.SupersededByNewNavigation:!1)?2:1),Gi(i=>i!==2),Ts(1)).subscribe(()=>{r()})}var JL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},eO={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},$x=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=He(z0);stateManager=He(FI);options=He(zg,{optional:!0})||{};pendingTasks=He(Ns);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=He(OI);urlSerializer=He(Lg);location=He(Du);urlHandlingStrategy=He(Gx);injector=He(Sr);_events=new hr;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=He(YL);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=He(jg,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!He(Og,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:i=>{this.console.warn(i)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Wn;subscribeToNavigationEvents(){let i=this.navigationTransitions.events.subscribe(c=>{try{let h=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(h!==null&&s!==null){if(this.stateManager.handleRouterEvent(c,s),c instanceof zs&&c.code!==ii.Redirect&&c.code!==ii.SupersededByNewNavigation)this.navigated=!0;else if(c instanceof Va)this.navigated=!0;else if(c instanceof Bu){let v=c.navigationBehaviorOptions,w=this.urlHandlingStrategy.merge(c.url,h.currentRawUrl),I=Je({browserUrl:h.extras.browserUrl,info:h.extras.info,skipLocationChange:h.extras.skipLocationChange,replaceUrl:h.extras.replaceUrl||this.urlUpdateStrategy==="eager"||XL(h.source)},v);this.scheduleNavigation(w,lf,null,I,{resolve:h.resolve,reject:h.reject,promise:h.promise})}}XN(c)&&this._events.next(c)}catch(h){this.navigationTransitions.transitionAbortWithErrorSubject.next(h)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),lf,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((i,c,h)=>{this.navigateToSyncWithBrowser(i,h,c)})}navigateToSyncWithBrowser(i,c,h){let s={replaceUrl:!0},v=h?.navigationId?h:null;if(h){let I=Je({},h);delete I.navigationId,delete I.\u0275routerPageId,Object.keys(I).length!==0&&(s.state=I)}let w=this.parseUrl(i);this.scheduleNavigation(w,c,v,s).catch(I=>{this.disposed||this.injector.get(po)(I)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(Vx),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,c={}){let{relativeTo:h,queryParams:s,fragment:v,queryParamsHandling:w,preserveFragment:I}=c,N=I?this.currentUrlTree.fragment:v,B=null;switch(w??this.options.defaultQueryParamsHandling){case"merge":B=Je(Je({},this.currentUrlTree.queryParams),s);break;case"preserve":B=this.currentUrlTree.queryParams;break;default:B=s||null}B!==null&&(B=this.removeEmptyProps(B));let L;try{let ie=h?h.snapshot:this.routerState.snapshot.root;L=fI(ie)}catch{(typeof i[0]!="string"||i[0][0]!=="/")&&(i=[]),L=this.currentUrlTree.root}return pI(L,i,B,N??null)}navigateByUrl(i,c={skipLocationChange:!1}){let h=zu(i)?i:this.parseUrl(i),s=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(s,lf,null,c)}navigate(i,c={skipLocationChange:!1}){return tO(i),this.navigateByUrl(this.createUrlTree(i,c),c)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){try{return this.urlSerializer.parse(i)}catch{return this.urlSerializer.parse("/")}}isActive(i,c){let h;if(c===!0?h=Je({},JL):c===!1?h=Je({},eO):h=c,zu(i))return YE(this.currentUrlTree,i,h);let s=this.parseUrl(i);return YE(this.currentUrlTree,s,h)}removeEmptyProps(i){return Object.entries(i).reduce((c,[h,s])=>(s!=null&&(c[h]=s),c),{})}scheduleNavigation(i,c,h,s,v){if(this.disposed)return Promise.resolve(!1);let w,I,N;v?(w=v.resolve,I=v.reject,N=v.promise):N=new Promise((L,ie)=>{w=L,I=ie});let B=this.pendingTasks.add();return zI(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(B))}),this.navigationTransitions.handleNavigationRequest({source:c,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:i,extras:s,resolve:w,reject:I,promise:N,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),N.catch(L=>Promise.reject(L))}static \u0275fac=function(c){return new(c||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function tO(t){for(let r=0;r<t.length;r++)if(t[r]==null)throw new at(4008,!1)}var nO=new pt("");function Hx(t,...r){return Ol([{provide:jg,multi:!0,useValue:t},[],{provide:Xl,useFactory:rO,deps:[$x]},{provide:fg,multi:!0,useFactory:iO},r.map(i=>i.\u0275providers)])}function rO(t){return t.routerState.root}function iO(){let t=He($o);return r=>{let i=t.get(ql);if(r!==i.components[0])return;let c=t.get($x),h=t.get(oO);t.get(sO)===1&&c.initialNavigation(),t.get(aO,null,{optional:!0})?.setUpPreloading(),t.get(nO,null,{optional:!0})?.init(),c.resetRootComponentType(i.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}var oO=new pt("",{factory:()=>new hr}),sO=new pt("",{providedIn:"root",factory:()=>1});var aO=new pt("");var jI=[];var BI={providers:[$v(),Y0(),Hx(jI)]};var rh=FP(VI());function GI(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var r=1;r<=60;++r)t("EPSG:"+(32600+r),"+proj=utm +zone="+r+" +datum=WGS84 +units=m"),t("EPSG:"+(32700+r),"+proj=utm +zone="+r+" +south +datum=WGS84 +units=m");t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var _o=1,yo=2,Us=3,$I=4,xf=5,Wx=6378137,HI=6356752314e-3,Xx=.0066943799901413165,Yl=484813681109536e-20,Pe=Math.PI/2,qI=.16666666666666666,ZI=.04722222222222222,WI=.022156084656084655,ze=1e-10,Rn=.017453292519943295,oi=57.29577951308232,Ft=Math.PI/4,$a=Math.PI*2,Sn=3.14159265359;var si={};si.greenwich=0;si.lisbon=-9.131906111111;si.paris=2.337229166667;si.bogota=-74.080916666667;si.madrid=-3.687938888889;si.rome=12.452333333333;si.bern=7.439583333333;si.jakarta=106.807719444444;si.ferro=-17.666666666667;si.brussels=4.367975;si.stockholm=18.058277777778;si.athens=23.7163375;si.oslo=10.722916666667;var XI=si;var YI={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var KI=/[\s_\-\/\(\)]/g;function Ri(t,r){if(t[r])return t[r];for(var i=Object.keys(t),c=r.toLowerCase().replace(KI,""),h=-1,s,v;++h<i.length;)if(s=i[h],v=s.toLowerCase().replace(KI,""),v===c)return t[s]}function bf(t){var r={},i=t.split("+").map(function(w){return w.trim()}).filter(function(w){return w}).reduce(function(w,I){var N=I.split("=");return N.push(!0),w[N[0].toLowerCase()]=N[1],w},{}),c,h,s,v={proj:"projName",datum:"datumCode",rf:function(w){r.rf=parseFloat(w)},lat_0:function(w){r.lat0=w*Rn},lat_1:function(w){r.lat1=w*Rn},lat_2:function(w){r.lat2=w*Rn},lat_ts:function(w){r.lat_ts=w*Rn},lon_0:function(w){r.long0=w*Rn},lon_1:function(w){r.long1=w*Rn},lon_2:function(w){r.long2=w*Rn},alpha:function(w){r.alpha=parseFloat(w)*Rn},gamma:function(w){r.rectified_grid_angle=parseFloat(w)*Rn},lonc:function(w){r.longc=w*Rn},x_0:function(w){r.x0=parseFloat(w)},y_0:function(w){r.y0=parseFloat(w)},k_0:function(w){r.k0=parseFloat(w)},k:function(w){r.k0=parseFloat(w)},a:function(w){r.a=parseFloat(w)},b:function(w){r.b=parseFloat(w)},r:function(w){r.a=r.b=parseFloat(w)},r_a:function(){r.R_A=!0},zone:function(w){r.zone=parseInt(w,10)},south:function(){r.utmSouth=!0},towgs84:function(w){r.datum_params=w.split(",").map(function(I){return parseFloat(I)})},to_meter:function(w){r.to_meter=parseFloat(w)},units:function(w){r.units=w;var I=Ri(YI,w);I&&(r.to_meter=I.to_meter)},from_greenwich:function(w){r.from_greenwich=w*Rn},pm:function(w){var I=Ri(XI,w);r.from_greenwich=(I||parseFloat(w))*Rn},nadgrids:function(w){w==="@null"?r.datumCode="none":r.nadgrids=w},axis:function(w){var I="ewnsud";w.length===3&&I.indexOf(w.substr(0,1))!==-1&&I.indexOf(w.substr(1,1))!==-1&&I.indexOf(w.substr(2,1))!==-1&&(r.axis=w)},approx:function(){r.approx=!0}};for(c in i)h=i[c],c in v?(s=v[c],typeof s=="function"?s(h):r[s]=h):r[c]=h;return typeof r.datumCode=="string"&&r.datumCode!=="WGS84"&&(r.datumCode=r.datumCode.toLowerCase()),r}var Yx=class{static getId(r){let i=r.find(c=>Array.isArray(c)&&c[0]==="ID");return i&&i.length>=3?{authority:i[1],code:parseInt(i[2],10)}:null}static convertUnit(r,i="unit"){if(!r||r.length<3)return{type:i,name:"unknown",conversion_factor:null};let c=r[1],h=parseFloat(r[2])||null,s=r.find(w=>Array.isArray(w)&&w[0]==="ID"),v=s?{authority:s[1],code:parseInt(s[2],10)}:null;return{type:i,name:c,conversion_factor:h,id:v}}static convertAxis(r){let i=r[1]||"Unknown",c,h=i.match(/^\((.)\)$/);if(h){let N=h[1].toUpperCase();if(N==="E")c="east";else if(N==="N")c="north";else if(N==="U")c="up";else throw new Error(`Unknown axis abbreviation: ${N}`)}else c=r[2]?r[2].toLowerCase():"unknown";let s=r.find(N=>Array.isArray(N)&&N[0]==="ORDER"),v=s?parseInt(s[1],10):null,w=r.find(N=>Array.isArray(N)&&(N[0]==="LENGTHUNIT"||N[0]==="ANGLEUNIT"||N[0]==="SCALEUNIT")),I=this.convertUnit(w);return{name:i,direction:c,unit:I,order:v}}static extractAxes(r){return r.filter(i=>Array.isArray(i)&&i[0]==="AXIS").map(i=>this.convertAxis(i)).sort((i,c)=>(i.order||0)-(c.order||0))}static convert(r,i={}){switch(r[0]){case"PROJCRS":i.type="ProjectedCRS",i.name=r[1],i.base_crs=r.find(H=>Array.isArray(H)&&H[0]==="BASEGEOGCRS")?this.convert(r.find(H=>Array.isArray(H)&&H[0]==="BASEGEOGCRS")):null,i.conversion=r.find(H=>Array.isArray(H)&&H[0]==="CONVERSION")?this.convert(r.find(H=>Array.isArray(H)&&H[0]==="CONVERSION")):null;let c=r.find(H=>Array.isArray(H)&&H[0]==="CS");c&&(i.coordinate_system={type:c[1],axis:this.extractAxes(r)});let h=r.find(H=>Array.isArray(H)&&H[0]==="LENGTHUNIT");if(h){let H=this.convertUnit(h);i.coordinate_system.unit=H}i.id=this.getId(r);break;case"BASEGEOGCRS":case"GEOGCRS":i.type="GeographicCRS",i.name=r[1];let s=r.find(H=>Array.isArray(H)&&(H[0]==="DATUM"||H[0]==="ENSEMBLE"));if(s){let H=this.convert(s);s[0]==="ENSEMBLE"?i.datum_ensemble=H:i.datum=H;let me=r.find(Ee=>Array.isArray(Ee)&&Ee[0]==="PRIMEM");me&&me[1]!=="Greenwich"&&(H.prime_meridian={name:me[1],longitude:parseFloat(me[2])})}i.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(r)},i.id=this.getId(r);break;case"DATUM":i.type="GeodeticReferenceFrame",i.name=r[1],i.ellipsoid=r.find(H=>Array.isArray(H)&&H[0]==="ELLIPSOID")?this.convert(r.find(H=>Array.isArray(H)&&H[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":i.type="DatumEnsemble",i.name=r[1],i.members=r.filter(H=>Array.isArray(H)&&H[0]==="MEMBER").map(H=>({type:"DatumEnsembleMember",name:H[1],id:this.getId(H)}));let v=r.find(H=>Array.isArray(H)&&H[0]==="ENSEMBLEACCURACY");v&&(i.accuracy=parseFloat(v[1]));let w=r.find(H=>Array.isArray(H)&&H[0]==="ELLIPSOID");w&&(i.ellipsoid=this.convert(w)),i.id=this.getId(r);break;case"ELLIPSOID":i.type="Ellipsoid",i.name=r[1],i.semi_major_axis=parseFloat(r[2]),i.inverse_flattening=parseFloat(r[3]);let I=r.find(H=>Array.isArray(H)&&H[0]==="LENGTHUNIT")?this.convert(r.find(H=>Array.isArray(H)&&H[0]==="LENGTHUNIT"),i):null;break;case"CONVERSION":i.type="Conversion",i.name=r[1],i.method=r.find(H=>Array.isArray(H)&&H[0]==="METHOD")?this.convert(r.find(H=>Array.isArray(H)&&H[0]==="METHOD")):null,i.parameters=r.filter(H=>Array.isArray(H)&&H[0]==="PARAMETER").map(H=>this.convert(H));break;case"METHOD":i.type="Method",i.name=r[1],i.id=this.getId(r);break;case"PARAMETER":i.type="Parameter",i.name=r[1],i.value=parseFloat(r[2]),i.unit=this.convertUnit(r.find(H=>Array.isArray(H)&&(H[0]==="LENGTHUNIT"||H[0]==="ANGLEUNIT"||H[0]==="SCALEUNIT"))),i.id=this.getId(r);break;case"BOUNDCRS":i.type="BoundCRS";let N=r.find(H=>Array.isArray(H)&&H[0]==="SOURCECRS");if(N){let H=N.find(me=>Array.isArray(me));i.source_crs=H?this.convert(H):null}let B=r.find(H=>Array.isArray(H)&&H[0]==="TARGETCRS");if(B){let H=B.find(me=>Array.isArray(me));i.target_crs=H?this.convert(H):null}let L=r.find(H=>Array.isArray(H)&&H[0]==="ABRIDGEDTRANSFORMATION");L?i.transformation=this.convert(L):i.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(i.type="Transformation",i.name=r[1],i.method=r.find(H=>Array.isArray(H)&&H[0]==="METHOD")?this.convert(r.find(H=>Array.isArray(H)&&H[0]==="METHOD")):null,i.parameters=r.filter(H=>Array.isArray(H)&&(H[0]==="PARAMETER"||H[0]==="PARAMETERFILE")).map(H=>{if(H[0]==="PARAMETER")return this.convert(H);if(H[0]==="PARAMETERFILE")return{name:H[1],value:H[2],id:{authority:"EPSG",code:8656}}}),i.parameters.length===7){let H=i.parameters[6];H.name==="Scale difference"&&(H.value=Math.round((H.value-1)*1e12)/1e6)}i.id=this.getId(r);break;case"AXIS":i.coordinate_system||(i.coordinate_system={type:"unspecified",axis:[]}),i.coordinate_system.axis.push(this.convertAxis(r));break;case"LENGTHUNIT":let ie=this.convertUnit(r,"LinearUnit");i.coordinate_system&&i.coordinate_system.axis&&i.coordinate_system.axis.forEach(H=>{H.unit||(H.unit=ie)}),ie.conversion_factor&&ie.conversion_factor!==1&&i.semi_major_axis&&(i.semi_major_axis={value:i.semi_major_axis,unit:ie});break;default:i.keyword=r[0];break}return i}},Bg=Yx;var Kx=class extends Bg{static convert(r,i={}){return super.convert(r,i),i.coordinate_system&&i.coordinate_system.subtype==="Cartesian"&&delete i.coordinate_system,i.usage&&delete i.usage,i}},QI=Kx;var Qx=class extends Bg{static convert(r,i={}){super.convert(r,i);let c=r.find(s=>Array.isArray(s)&&s[0]==="CS");c&&(i.coordinate_system={subtype:c[1],axis:this.extractAxes(r)});let h=r.find(s=>Array.isArray(s)&&s[0]==="USAGE");if(h){let s=h.find(I=>Array.isArray(I)&&I[0]==="SCOPE"),v=h.find(I=>Array.isArray(I)&&I[0]==="AREA"),w=h.find(I=>Array.isArray(I)&&I[0]==="BBOX");i.usage={},s&&(i.usage.scope=s[1]),v&&(i.usage.area=v[1]),w&&(i.usage.bbox=w.slice(1))}return i}},JI=Qx;function cO(t){return t.find(r=>Array.isArray(r)&&r[0]==="USAGE")?"2019":(t.find(r=>Array.isArray(r)&&r[0]==="CS")||t[0]==="BOUNDCRS"||t[0]==="PROJCRS"||t[0]==="GEOGCRS","2015")}function eT(t){return(cO(t)==="2019"?JI:QI).convert(t)}function tT(t){let r=t.toUpperCase();return r.includes("PROJCRS")||r.includes("GEOGCRS")||r.includes("BOUNDCRS")||r.includes("VERTCRS")||r.includes("LENGTHUNIT")||r.includes("ANGLEUNIT")||r.includes("SCALEUNIT")?"WKT2":(r.includes("PROJCS")||r.includes("GEOGCS")||r.includes("LOCAL_CS")||r.includes("VERT_CS")||r.includes("UNIT"),"WKT1")}var nT=fO,wf=1,rT=2,iT=3,Ug=4,oT=5,Jx=-1,uO=/\s/,hO=/[A-Za-z]/,dO=/[A-Za-z84_]/,Vg=/[,\]]/,sT=/[\d\.E\-\+]/;function Vs(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=wf}Vs.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==Ug)for(;uO.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case wf:return this.neutral(t);case rT:return this.keyword(t);case Ug:return this.quoted(t);case oT:return this.afterquote(t);case iT:return this.number(t);case Jx:return}};Vs.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=Ug;return}if(Vg.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)};Vs.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=wf;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=wf,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Jx);return}};Vs.prototype.number=function(t){if(sT.test(t)){this.word+=t;return}if(Vg.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)};Vs.prototype.quoted=function(t){if(t==='"'){this.state=oT;return}this.word+=t};Vs.prototype.keyword=function(t){if(dO.test(t)){this.word+=t;return}if(t==="["){var r=[];r.push(this.word),this.level++,this.root===null?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=wf;return}if(Vg.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)};Vs.prototype.neutral=function(t){if(hO.test(t)){this.word=t,this.state=rT;return}if(t==='"'){this.word="",this.state=Ug;return}if(sT.test(t)){this.word=t,this.state=iT;return}if(Vg.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)};Vs.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Jx)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function fO(t){var r=new Vs(t);return r.output()}function eb(t,r,i){Array.isArray(r)&&(i.unshift(r),r=null);var c=r?{}:t,h=i.reduce(function(s,v){return Kl(v,s),s},c);r&&(t[r]=h)}function Kl(t,r){if(!Array.isArray(t)){r[t]=!0;return}var i=t.shift();if(i==="PARAMETER"&&(i=t.shift()),t.length===1){if(Array.isArray(t[0])){r[i]={},Kl(t[0],r[i]);return}r[i]=t[0];return}if(!t.length){r[i]=!0;return}if(i==="TOWGS84"){r[i]=t;return}if(i==="AXIS"){i in r||(r[i]=[]),r[i].push(t);return}Array.isArray(i)||(r[i]={});var c;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[i]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&Kl(t[2],r[i]);return;case"SPHEROID":case"ELLIPSOID":r[i]={name:t[0],a:t[1],rf:t[2]},t.length===4&&Kl(t[3],r[i]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":t[0]=["name",t[0]],eb(r,i,t);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":t[0]=["name",t[0]],eb(r,i,t),r[i].type=i;return;default:for(c=-1;++c<t.length;)if(!Array.isArray(t[c]))return Kl(t,r[i]);return eb(r,i,t)}}var pO=.017453292519943295;function Xi(t){return t*pO}function Gg(t){let r=(t.projName||"").toLowerCase().replace(/_/g," ");!t.long0&&t.longc&&(r==="albers conic equal area"||r==="lambert azimuthal equal area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(r==="stereographic south pole"||r==="polar stereographic (variant b)")?(t.lat0=Xi(t.lat1>0?90:-90),t.lat_ts=t.lat1,delete t.lat1):!t.lat_ts&&t.lat0&&(r==="polar stereographic"||r==="polar stereographic (variant a)")&&(t.lat_ts=t.lat0,t.lat0=Xi(t.lat0>0?90:-90),delete t.lat1)}function aT(t){let r={units:null,to_meter:void 0};return typeof t=="string"?(r.units=t.toLowerCase(),r.units==="metre"&&(r.units="meter"),r.units==="meter"&&(r.to_meter=1)):t&&t.name&&(r.units=t.name.toLowerCase(),r.units==="metre"&&(r.units="meter"),r.to_meter=t.conversion_factor),r}function lT(t){return typeof t=="object"?t.value*t.unit.conversion_factor:t}function cT(t,r){t.ellipsoid.radius?(r.a=t.ellipsoid.radius,r.rf=0):(r.a=lT(t.ellipsoid.semi_major_axis),t.ellipsoid.inverse_flattening!==void 0?r.rf=t.ellipsoid.inverse_flattening:t.ellipsoid.semi_major_axis!==void 0&&t.ellipsoid.semi_minor_axis!==void 0&&(r.rf=r.a/(r.a-lT(t.ellipsoid.semi_minor_axis))))}function Mf(t,r={}){return!t||typeof t!="object"?t:t.type==="BoundCRS"?(Mf(t.source_crs,r),t.transformation&&(t.transformation.method&&t.transformation.method.name==="NTv2"?r.nadgrids=t.transformation.parameters[0].value:r.datum_params=t.transformation.parameters.map(i=>i.value)),r):(Object.keys(t).forEach(i=>{let c=t[i];if(c!==null)switch(i){case"name":if(r.srsCode)break;r.name=c,r.srsCode=c;break;case"type":c==="GeographicCRS"?r.projName="longlat":c==="ProjectedCRS"&&t.conversion&&t.conversion.method&&(r.projName=t.conversion.method.name);break;case"datum":case"datum_ensemble":c.ellipsoid&&(r.ellps=c.ellipsoid.name,cT(c,r)),c.prime_meridian&&(r.from_greenwich=c.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":r.ellps=c.name,cT(c,r);break;case"prime_meridian":r.long0=(c.longitude||0)*Math.PI/180;break;case"coordinate_system":if(c.axis){if(r.axis=c.axis.map(h=>{let s=h.direction;if(s==="east")return"e";if(s==="north")return"n";if(s==="west")return"w";if(s==="south")return"s";throw new Error(`Unknown axis direction: ${s}`)}).join("")+"u",c.unit){let{units:h,to_meter:s}=aT(c.unit);r.units=h,r.to_meter=s}else if(c.axis[0]&&c.axis[0].unit){let{units:h,to_meter:s}=aT(c.axis[0].unit);r.units=h,r.to_meter=s}}break;case"id":c.authority&&c.code&&(r.title=c.authority+":"+c.code);break;case"conversion":c.method&&c.method.name&&(r.projName=c.method.name),c.parameters&&c.parameters.forEach(h=>{let s=h.name.toLowerCase().replace(/\s+/g,"_"),v=h.value;h.unit&&h.unit.conversion_factor?r[s]=v*h.unit.conversion_factor:h.unit==="degree"?r[s]=v*Math.PI/180:r[s]=v});break;case"unit":c.name&&(r.units=c.name.toLowerCase(),r.units==="metre"&&(r.units="meter")),c.conversion_factor&&(r.to_meter=c.conversion_factor);break;case"base_crs":Mf(c,r),r.datumCode=c.id?c.id.authority+"_"+c.id.code:c.name;break;default:break}}),r.latitude_of_false_origin!==void 0&&(r.lat0=r.latitude_of_false_origin),r.longitude_of_false_origin!==void 0&&(r.long0=r.longitude_of_false_origin),r.latitude_of_standard_parallel!==void 0&&(r.lat0=r.latitude_of_standard_parallel,r.lat1=r.latitude_of_standard_parallel),r.latitude_of_1st_standard_parallel!==void 0&&(r.lat1=r.latitude_of_1st_standard_parallel),r.latitude_of_2nd_standard_parallel!==void 0&&(r.lat2=r.latitude_of_2nd_standard_parallel),r.latitude_of_projection_centre!==void 0&&(r.lat0=r.latitude_of_projection_centre),r.longitude_of_projection_centre!==void 0&&(r.longc=r.longitude_of_projection_centre),r.easting_at_false_origin!==void 0&&(r.x0=r.easting_at_false_origin),r.northing_at_false_origin!==void 0&&(r.y0=r.northing_at_false_origin),r.latitude_of_natural_origin!==void 0&&(r.lat0=r.latitude_of_natural_origin),r.longitude_of_natural_origin!==void 0&&(r.long0=r.longitude_of_natural_origin),r.longitude_of_origin!==void 0&&(r.long0=r.longitude_of_origin),r.false_easting!==void 0&&(r.x0=r.false_easting),r.easting_at_projection_centre&&(r.x0=r.easting_at_projection_centre),r.false_northing!==void 0&&(r.y0=r.false_northing),r.northing_at_projection_centre&&(r.y0=r.northing_at_projection_centre),r.standard_parallel_1!==void 0&&(r.lat1=r.standard_parallel_1),r.standard_parallel_2!==void 0&&(r.lat2=r.standard_parallel_2),r.scale_factor_at_natural_origin!==void 0&&(r.k0=r.scale_factor_at_natural_origin),r.scale_factor_at_projection_centre!==void 0&&(r.k0=r.scale_factor_at_projection_centre),r.scale_factor_on_pseudo_standard_parallel!==void 0&&(r.k0=r.scale_factor_on_pseudo_standard_parallel),r.azimuth!==void 0&&(r.alpha=r.azimuth),r.azimuth_at_projection_centre!==void 0&&(r.alpha=r.azimuth_at_projection_centre),r.angle_from_rectified_to_skew_grid&&(r.rectified_grid_angle=r.angle_from_rectified_to_skew_grid),Gg(r),r)}var mO=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function gO(t,r){var i=r[0],c=r[1];!(i in t)&&c in t&&(t[i]=t[c],r.length===3&&(t[i]=r[2](t[i])))}function uT(t){for(var r=Object.keys(t),i=0,c=r.length;i<c;++i){var h=r[i];mO.indexOf(h)!==-1&&_O(t[h]),typeof t[h]=="object"&&uT(t[h])}}function _O(t){if(t.AUTHORITY){var r=Object.keys(t.AUTHORITY)[0];r&&r in t.AUTHORITY&&(t.title=r+":"+t.AUTHORITY[r])}if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var i="",c=0,h=t.AXIS.length;c<h;++c){var s=[t.AXIS[c][0].toLowerCase(),t.AXIS[c][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?i+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?i+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?i+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(i+="w")}i.length===2&&(i+="u"),i.length===3&&(t.axis=i)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var v=t.GEOGCS;t.type==="GEOGCS"&&(v=t),v&&(v.DATUM?t.datumCode=v.DATUM.name.toLowerCase():t.datumCode=v.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),t.datumCode==="new_zealand_1949"&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode==="belge_1972"&&(t.datumCode="rnb72"),v.DATUM&&v.DATUM.SPHEROID&&(t.ellps=v.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=v.DATUM.SPHEROID.a,t.rf=parseFloat(v.DATUM.SPHEROID.rf,10)),v.DATUM&&v.DATUM.TOWGS84&&(t.datum_params=v.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),t.rectified_grid_angle&&(t.rectified_grid_angle=Xi(t.rectified_grid_angle));function w(B){var L=t.to_meter||1;return B*L}var I=function(B){return gO(t,B)},N=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Xi],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Xi],["x0","false_easting",w],["y0","false_northing",w],["long0","central_meridian",Xi],["lat0","latitude_of_origin",Xi],["lat0","standard_parallel_1",Xi],["lat1","standard_parallel_1",Xi],["lat2","standard_parallel_2",Xi],["azimuth","Azimuth"],["alpha","azimuth",Xi],["srsCode","name"]];N.forEach(I),Gg(t)}function Sf(t){if(typeof t=="object")return Mf(t);let r=tT(t);var i=nT(t);if(r==="WKT2"){let s=eT(i);return Mf(s)}var c=i[0],h={};return Kl(i,h),uT(h),h[c]}function Yi(t){var r=this;if(arguments.length===2){var i=arguments[1];typeof i=="string"?i.charAt(0)==="+"?Yi[t]=bf(arguments[1]):Yi[t]=Sf(arguments[1]):Yi[t]=i}else if(arguments.length===1){if(Array.isArray(t))return t.map(function(c){return Array.isArray(c)?Yi.apply(r,c):Yi(c)});if(typeof t=="string"){if(t in Yi)return Yi[t]}else"EPSG"in t?Yi["EPSG:"+t.EPSG]=t:"ESRI"in t?Yi["ESRI:"+t.ESRI]=t:"IAU2000"in t?Yi["IAU2000:"+t.IAU2000]=t:console.log(t);return}}GI(Yi);var $u=Yi;function yO(t){return typeof t=="string"}function vO(t){return t in $u}function xO(t){return t.indexOf("+")!==0&&t.indexOf("[")!==-1||typeof t=="object"&&!("srsCode"in t)}var bO=["3857","900913","3785","102113"];function wO(t){var r=Ri(t,"authority");if(r){var i=Ri(r,"epsg");return i&&bO.indexOf(i)>-1}}function MO(t){var r=Ri(t,"extension");if(r)return Ri(r,"proj4")}function SO(t){return t[0]==="+"}function EO(t){if(yO(t)){if(vO(t))return $u[t];if(xO(t)){var r=Sf(t);if(wO(r))return $u["EPSG:3857"];var i=MO(r);return i?bf(i):r}if(SO(t))return bf(t)}else return"projName"in t?t:Sf(t)}var hT=EO;function tb(t,r){t=t||{};var i,c;if(!r)return t;for(c in r)i=r[c],i!==void 0&&(t[c]=i);return t}function Lr(t,r,i){var c=t*r;return i/Math.sqrt(1-c*c)}function Yo(t){return t<0?-1:1}function Fe(t){return Math.abs(t)<=Sn?t:t-Yo(t)*$a}function Zr(t,r,i){var c=t*i,h=.5*t;return c=Math.pow((1-c)/(1+c),h),Math.tan(.5*(Pe-r))/c}function Gs(t,r){for(var i=.5*t,c,h,s=Pe-2*Math.atan(r),v=0;v<=15;v++)if(c=t*Math.sin(s),h=Pe-2*Math.atan(r*Math.pow((1-c)/(1+c),i))-s,s+=h,Math.abs(h)<=1e-10)return s;return-9999}function IO(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Lr(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function TO(t){var r=t.x,i=t.y;if(i*oi>90&&i*oi<-90&&r*oi>180&&r*oi<-180)return null;var c,h;if(Math.abs(Math.abs(i)-Pe)<=ze)return null;if(this.sphere)c=this.x0+this.a*this.k0*Fe(r-this.long0),h=this.y0+this.a*this.k0*Math.log(Math.tan(Ft+.5*i));else{var s=Math.sin(i),v=Zr(this.e,i,s);c=this.x0+this.a*this.k0*Fe(r-this.long0),h=this.y0-this.a*this.k0*Math.log(v)}return t.x=c,t.y=h,t}function CO(t){var r=t.x-this.x0,i=t.y-this.y0,c,h;if(this.sphere)h=Pe-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var s=Math.exp(-i/(this.a*this.k0));if(h=Gs(this.e,s),h===-9999)return null}return c=Fe(this.long0+r/(this.a*this.k0)),t.x=c,t.y=h,t}var PO=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"],dT={init:IO,forward:TO,inverse:CO,names:PO};function DO(){}function fT(t){return t}var AO=["longlat","identity"],pT={init:DO,forward:fT,inverse:fT,names:AO};var RO=[dT,pT],Ql={},Hu=[];function mT(t,r){var i=Hu.length;return t.names?(Hu[i]=t,t.names.forEach(function(c){Ql[c.toLowerCase()]=i}),this):(console.log(r),!0)}function nb(t){return t.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function kO(t){if(!t)return!1;var r=t.toLowerCase();if(typeof Ql[r]<"u"&&Hu[Ql[r]]||(r=nb(r),r in Ql&&Hu[Ql[r]]))return Hu[Ql[r]]}function NO(){RO.forEach(mT)}var gT={start:NO,add:mT,get:kO};var LO={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},rb=LO;var OO=rb.WGS84;function _T(t,r,i,c){var h=t*t,s=r*r,v=(h-s)/h,w=0;c?(t*=1-v*(qI+v*(ZI+v*WI)),h=t*t,v=0):w=Math.sqrt(v);var I=(h-s)/s;return{es:v,e:w,ep2:I}}function yT(t,r,i,c,h){if(!t){var s=Ri(rb,c);s||(s=OO),t=s.a,r=s.b,i=s.rf}return i&&!r&&(r=(1-1/i)*t),(i===0||Math.abs(t-r)<ze)&&(h=!0,r=t),{a:t,b:r,rf:i,sphere:h}}var Hg={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(vT in Hg)$g=Hg[vT],$g.datumName&&(Hg[$g.datumName]=$g);var $g,vT,xT=Hg;function FO(t,r,i,c,h,s,v){var w={};return t===void 0||t==="none"?w.datum_type=xf:w.datum_type=$I,r&&(w.datum_params=r.map(parseFloat),(w.datum_params[0]!==0||w.datum_params[1]!==0||w.datum_params[2]!==0)&&(w.datum_type=_o),w.datum_params.length>3&&(w.datum_params[3]!==0||w.datum_params[4]!==0||w.datum_params[5]!==0||w.datum_params[6]!==0)&&(w.datum_type=yo,w.datum_params[3]*=Yl,w.datum_params[4]*=Yl,w.datum_params[5]*=Yl,w.datum_params[6]=w.datum_params[6]/1e6+1)),v&&(w.datum_type=Us,w.grids=v),w.a=i,w.b=c,w.es=h,w.ep2=s,w}var bT=FO;var ob={};function sb(t,r,i){return r instanceof ArrayBuffer?zO(t,r,i):{ready:jO(t,r)}}function zO(t,r,i){var c=!0;i!==void 0&&i.includeErrorFields===!1&&(c=!1);var h=new DataView(r),s=UO(h),v=VO(h,s),w=GO(h,v,s,c),I={header:v,subgrids:w};return ob[t]=I,I}async function jO(t,r){for(var i=[],c=await r.getImageCount(),h=c-1;h>=0;h--){var s=await r.getImage(h),v=await s.readRasters(),w=v,I=[s.getWidth(),s.getHeight()],N=s.getBoundingBox().map(wT),B=[s.fileDirectory.ModelPixelScale[0],s.fileDirectory.ModelPixelScale[1]].map(wT),L=N[0]+(I[0]-1)*B[0],ie=N[3]-(I[1]-1)*B[1],H=w[0],me=w[1],Ee=[];for(let We=I[1]-1;We>=0;We--)for(let it=I[0]-1;it>=0;it--){var Me=We*I[0]+it;Ee.push([-Ha(me[Me]),Ha(H[Me])])}i.push({del:B,lim:I,ll:[-L,ie],cvs:Ee})}var Ae={header:{nSubgrids:c},subgrids:i};return ob[t]=Ae,Ae}function MT(t){if(t===void 0)return null;var r=t.split(",");return r.map(BO)}function BO(t){if(t.length===0)return null;var r=t[0]==="@";return r&&(t=t.slice(1)),t==="null"?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:t,mandatory:!r,grid:ob[t]||null,isNull:!1}}function wT(t){return t*Math.PI/180}function Ha(t){return t/3600*Math.PI/180}function UO(t){var r=t.getInt32(8,!1);return r===11?!1:(r=t.getInt32(8,!0),r!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function VO(t,r){return{nFields:t.getInt32(8,r),nSubgridFields:t.getInt32(24,r),nSubgrids:t.getInt32(40,r),shiftType:ib(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,r),fromSemiMinorAxis:t.getFloat64(136,r),toSemiMajorAxis:t.getFloat64(152,r),toSemiMinorAxis:t.getFloat64(168,r)}}function ib(t,r,i){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(r,i)))}function GO(t,r,i,c){for(var h=176,s=[],v=0;v<r.nSubgrids;v++){var w=HO(t,h,i),I=qO(t,h,w,i,c),N=Math.round(1+(w.upperLongitude-w.lowerLongitude)/w.longitudeInterval),B=Math.round(1+(w.upperLatitude-w.lowerLatitude)/w.latitudeInterval);s.push({ll:[Ha(w.lowerLongitude),Ha(w.lowerLatitude)],del:[Ha(w.longitudeInterval),Ha(w.latitudeInterval)],lim:[N,B],count:w.gridNodeCount,cvs:$O(I)});var L=16;c===!1&&(L=8),h+=176+w.gridNodeCount*L}return s}function $O(t){return t.map(function(r){return[Ha(r.longitudeShift),Ha(r.latitudeShift)]})}function HO(t,r,i){return{name:ib(t,r+8,r+16).trim(),parent:ib(t,r+24,r+24+8).trim(),lowerLatitude:t.getFloat64(r+72,i),upperLatitude:t.getFloat64(r+88,i),lowerLongitude:t.getFloat64(r+104,i),upperLongitude:t.getFloat64(r+120,i),latitudeInterval:t.getFloat64(r+136,i),longitudeInterval:t.getFloat64(r+152,i),gridNodeCount:t.getInt32(r+168,i)}}function qO(t,r,i,c,h){var s=r+176,v=16;h===!1&&(v=8);for(var w=[],I=0;I<i.gridNodeCount;I++){var N={latitudeShift:t.getFloat32(s+I*v,c),longitudeShift:t.getFloat32(s+I*v+4,c)};h!==!1&&(N.latitudeAccuracy=t.getFloat32(s+I*v+8,c),N.longitudeAccuracy=t.getFloat32(s+I*v+12,c)),w.push(N)}return w}function qu(t,r){if(!(this instanceof qu))return new qu(t);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,r=r||function(N){if(N)throw N};var i=hT(t);if(typeof i!="object"){r("Could not parse to valid json: "+t);return}var c=qu.projections.get(i.projName);if(!c){r("Could not get projection name from: "+t);return}if(i.datumCode&&i.datumCode!=="none"){var h=Ri(xT,i.datumCode);h&&(i.datum_params=i.datum_params||(h.towgs84?h.towgs84.split(","):null),i.ellps=h.ellipse,i.datumName=h.datumName?h.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var s=yT(i.a,i.b,i.rf,i.ellps,i.sphere),v=_T(s.a,s.b,s.rf,i.R_A),w=MT(i.nadgrids),I=i.datum||bT(i.datumCode,i.datum_params,s.a,s.b,v.es,v.ep2,w);tb(this,i),tb(this,c),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=v.es,this.e=v.e,this.ep2=v.ep2,this.datum=I,"init"in this&&typeof this.init=="function"&&this.init(),r(null,this)}qu.projections=gT;qu.projections.start();var $s=qu;function ST(t,r){return t.datum_type!==r.datum_type||t.a!==r.a||Math.abs(t.es-r.es)>5e-11?!1:t.datum_type===_o?t.datum_params[0]===r.datum_params[0]&&t.datum_params[1]===r.datum_params[1]&&t.datum_params[2]===r.datum_params[2]:t.datum_type===yo?t.datum_params[0]===r.datum_params[0]&&t.datum_params[1]===r.datum_params[1]&&t.datum_params[2]===r.datum_params[2]&&t.datum_params[3]===r.datum_params[3]&&t.datum_params[4]===r.datum_params[4]&&t.datum_params[5]===r.datum_params[5]&&t.datum_params[6]===r.datum_params[6]:!0}function qg(t,r,i){var c=t.x,h=t.y,s=t.z?t.z:0,v,w,I,N;if(h<-Pe&&h>-1.001*Pe)h=-Pe;else if(h>Pe&&h<1.001*Pe)h=Pe;else{if(h<-Pe)return{x:-1/0,y:-1/0,z:t.z};if(h>Pe)return{x:1/0,y:1/0,z:t.z}}return c>Math.PI&&(c-=2*Math.PI),w=Math.sin(h),N=Math.cos(h),I=w*w,v=i/Math.sqrt(1-r*I),{x:(v+s)*N*Math.cos(c),y:(v+s)*N*Math.sin(c),z:(v*(1-r)+s)*w}}function Zg(t,r,i,c){var h=1e-12,s=h*h,v=30,w,I,N,B,L,ie,H,me,Ee,Me,Ae,We,it,_t=t.x,Ct=t.y,Nt=t.z?t.z:0,Gt,Xt,tn;if(w=Math.sqrt(_t*_t+Ct*Ct),I=Math.sqrt(_t*_t+Ct*Ct+Nt*Nt),w/i<h){if(Gt=0,I/i<h)return Xt=Pe,tn=-c,{x:t.x,y:t.y,z:t.z}}else Gt=Math.atan2(Ct,_t);N=Nt/I,B=w/I,L=1/Math.sqrt(1-r*(2-r)*B*B),me=B*(1-r)*L,Ee=N*L,it=0;do it++,H=i/Math.sqrt(1-r*Ee*Ee),tn=w*me+Nt*Ee-H*(1-r*Ee*Ee),ie=r*H/(H+tn),L=1/Math.sqrt(1-ie*(2-ie)*B*B),Me=B*(1-ie)*L,Ae=N*L,We=Ae*me-Me*Ee,me=Me,Ee=Ae;while(We*We>s&&it<v);return Xt=Math.atan(Ae/Math.abs(Me)),{x:Gt,y:Xt,z:tn}}function ET(t,r,i){if(r===_o)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(r===yo){var c=i[0],h=i[1],s=i[2],v=i[3],w=i[4],I=i[5],N=i[6];return{x:N*(t.x-I*t.y+w*t.z)+c,y:N*(I*t.x+t.y-v*t.z)+h,z:N*(-w*t.x+v*t.y+t.z)+s}}}function IT(t,r,i){if(r===_o)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(r===yo){var c=i[0],h=i[1],s=i[2],v=i[3],w=i[4],I=i[5],N=i[6],B=(t.x-c)/N,L=(t.y-h)/N,ie=(t.z-s)/N;return{x:B+I*L-w*ie,y:-I*B+L+v*ie,z:w*B-v*L+ie}}}function Wg(t){return t===_o||t===yo}function PT(t,r,i){if(ST(t,r)||t.datum_type===xf||r.datum_type===xf)return i;var c=t.a,h=t.es;if(t.datum_type===Us){var s=TT(t,!1,i);if(s!==0)return;c=Wx,h=Xx}var v=r.a,w=r.b,I=r.es;if(r.datum_type===Us&&(v=Wx,w=HI,I=Xx),h===I&&c===v&&!Wg(t.datum_type)&&!Wg(r.datum_type))return i;if(i=qg(i,h,c),Wg(t.datum_type)&&(i=ET(i,t.datum_type,t.datum_params)),Wg(r.datum_type)&&(i=IT(i,r.datum_type,r.datum_params)),i=Zg(i,I,v,w),r.datum_type===Us){var N=TT(r,!0,i);if(N!==0)return}return i}function TT(t,r,i){if(t.grids===null||t.grids.length===0)return console.log("Grid shift grids not found"),-1;var c={x:-i.x,y:i.y},h={x:Number.NaN,y:Number.NaN},s=[];e:for(var v=0;v<t.grids.length;v++){var w=t.grids[v];if(s.push(w.name),w.isNull){h=c;break}if(w.grid===null){if(w.mandatory)return console.log("Unable to find mandatory grid '"+w.name+"'"),-1;continue}for(var I=w.grid.subgrids,N=0,B=I.length;N<B;N++){var L=I[N],ie=(Math.abs(L.del[1])+Math.abs(L.del[0]))/1e4,H=L.ll[0]-ie,me=L.ll[1]-ie,Ee=L.ll[0]+(L.lim[0]-1)*L.del[0]+ie,Me=L.ll[1]+(L.lim[1]-1)*L.del[1]+ie;if(!(me>c.y||H>c.x||Me<c.y||Ee<c.x)&&(h=ZO(c,r,L),!isNaN(h.x)))break e}}return isNaN(h.x)?(console.log("Failed to find a grid shift table for location '"+-c.x*oi+" "+c.y*oi+" tried: '"+s+"'"),-1):(i.x=-h.x,i.y=h.y,0)}function ZO(t,r,i){var c={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return c;var h={x:t.x,y:t.y};h.x-=i.ll[0],h.y-=i.ll[1],h.x=Fe(h.x-Math.PI)+Math.PI;var s=CT(h,i);if(r){if(isNaN(s.x))return c;s.x=h.x-s.x,s.y=h.y-s.y;var v=9,w=1e-12,I,N;do{if(N=CT(s,i),isNaN(N.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}I={x:h.x-(N.x+s.x),y:h.y-(N.y+s.y)},s.x+=I.x,s.y+=I.y}while(v--&&Math.abs(I.x)>w&&Math.abs(I.y)>w);if(v<0)return console.log("Inverse grid shift iterator failed to converge."),c;c.x=Fe(s.x+i.ll[0]),c.y=s.y+i.ll[1]}else isNaN(s.x)||(c.x=t.x+s.x,c.y=t.y+s.y);return c}function CT(t,r){var i={x:t.x/r.del[0],y:t.y/r.del[1]},c={x:Math.floor(i.x),y:Math.floor(i.y)},h={x:i.x-1*c.x,y:i.y-1*c.y},s={x:Number.NaN,y:Number.NaN},v;if(c.x<0||c.x>=r.lim[0]||c.y<0||c.y>=r.lim[1])return s;v=c.y*r.lim[0]+c.x;var w={x:r.cvs[v][0],y:r.cvs[v][1]};v++;var I={x:r.cvs[v][0],y:r.cvs[v][1]};v+=r.lim[0];var N={x:r.cvs[v][0],y:r.cvs[v][1]};v--;var B={x:r.cvs[v][0],y:r.cvs[v][1]},L=h.x*h.y,ie=h.x*(1-h.y),H=(1-h.x)*(1-h.y),me=(1-h.x)*h.y;return s.x=H*w.x+ie*I.x+me*B.x+L*N.x,s.y=H*w.y+ie*I.y+me*B.y+L*N.y,s}function ab(t,r,i){var c=i.x,h=i.y,s=i.z||0,v,w,I,N={};for(I=0;I<3;I++)if(!(r&&I===2&&i.z===void 0))switch(I===0?(v=c,"ew".indexOf(t.axis[I])!==-1?w="x":w="y"):I===1?(v=h,"ns".indexOf(t.axis[I])!==-1?w="y":w="x"):(v=s,w="z"),t.axis[I]){case"e":N[w]=v;break;case"w":N[w]=-v;break;case"n":N[w]=v;break;case"s":N[w]=-v;break;case"u":i[w]!==void 0&&(N.z=v);break;case"d":i[w]!==void 0&&(N.z=-v);break;default:return null}return N}function Xg(t){var r={x:t[0],y:t[1]};return t.length>2&&(r.z=t[2]),t.length>3&&(r.m=t[3]),r}function AT(t){DT(t.x),DT(t.y)}function DT(t){if(typeof Number.isFinite=="function"){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if(typeof t!="number"||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function WO(t,r){return(t.datum.datum_type===_o||t.datum.datum_type===yo||t.datum.datum_type===Us)&&r.datumCode!=="WGS84"||(r.datum.datum_type===_o||r.datum.datum_type===yo||r.datum.datum_type===Us)&&t.datumCode!=="WGS84"}function Jl(t,r,i,c){var h;Array.isArray(i)?i=Xg(i):i={x:i.x,y:i.y,z:i.z,m:i.m};var s=i.z!==void 0;if(AT(i),t.datum&&r.datum&&WO(t,r)&&(h=new $s("WGS84"),i=Jl(t,h,i,c),t=h),c&&t.axis!=="enu"&&(i=ab(t,!1,i)),t.projName==="longlat")i={x:i.x*Rn,y:i.y*Rn,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),i=t.inverse(i),!i)return;if(t.from_greenwich&&(i.x+=t.from_greenwich),i=PT(t.datum,r.datum,i),!!i)return i=i,r.from_greenwich&&(i={x:i.x-r.from_greenwich,y:i.y,z:i.z||0}),r.projName==="longlat"?i={x:i.x*oi,y:i.y*oi,z:i.z||0}:(i=r.forward(i),r.to_meter&&(i={x:i.x/r.to_meter,y:i.y/r.to_meter,z:i.z||0})),c&&r.axis!=="enu"?ab(r,!0,i):(i&&!s&&delete i.z,i)}var RT=$s("WGS84");function lb(t,r,i,c){var h,s,v;return Array.isArray(i)?(h=Jl(t,r,i,c)||{x:NaN,y:NaN},i.length>2?typeof t.name<"u"&&t.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"?typeof h.z=="number"?[h.x,h.y,h.z].concat(i.slice(3)):[h.x,h.y,i[2]].concat(i.slice(3)):[h.x,h.y].concat(i.slice(2)):[h.x,h.y]):(s=Jl(t,r,i,c),v=Object.keys(i),v.length===2||v.forEach(function(w){if(typeof t.name<"u"&&t.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"){if(w==="x"||w==="y"||w==="z")return}else if(w==="x"||w==="y")return;s[w]=i[w]}),s)}function Yg(t){return t instanceof $s?t:typeof t=="object"&&"oProj"in t?t.oProj:$s(t)}function XO(t,r,i){var c,h,s=!1,v;return typeof r>"u"?(h=Yg(t),c=RT,s=!0):(typeof r.x<"u"||Array.isArray(r))&&(i=r,h=Yg(t),c=RT,s=!0),c||(c=Yg(t)),h||(h=Yg(r)),i?lb(c,h,i):(v={forward:function(w,I){return lb(c,h,w,I)},inverse:function(w,I){return lb(h,c,w,I)}},s&&(v.oProj=h),v)}var kT=XO;var NT=6,OT="AJSAJS",FT="AFAFAF",Zu=65,ai=73,Ki=79,Ef=86,If=90,zT={forward:ub,inverse:YO,toPoint:hb};function ub(t,r){return r=r||5,JO(KO({lat:t[1],lon:t[0]}),r)}function YO(t){var r=db(BT(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function hb(t){var r=db(BT(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function cb(t){return t*(Math.PI/180)}function LT(t){return 180*(t/Math.PI)}function KO(t){var r=t.lat,i=t.lon,c=6378137,h=.00669438,s=.9996,v,w,I,N,B,L,ie,H=cb(r),me=cb(i),Ee,Me;Me=Math.floor((i+180)/6)+1,i===180&&(Me=60),r>=56&&r<64&&i>=3&&i<12&&(Me=32),r>=72&&r<84&&(i>=0&&i<9?Me=31:i>=9&&i<21?Me=33:i>=21&&i<33?Me=35:i>=33&&i<42&&(Me=37)),v=(Me-1)*6-180+3,Ee=cb(v),w=h/(1-h),I=c/Math.sqrt(1-h*Math.sin(H)*Math.sin(H)),N=Math.tan(H)*Math.tan(H),B=w*Math.cos(H)*Math.cos(H),L=Math.cos(H)*(me-Ee),ie=c*((1-h/4-3*h*h/64-5*h*h*h/256)*H-(3*h/8+3*h*h/32+45*h*h*h/1024)*Math.sin(2*H)+(15*h*h/256+45*h*h*h/1024)*Math.sin(4*H)-35*h*h*h/3072*Math.sin(6*H));var Ae=s*I*(L+(1-N+B)*L*L*L/6+(5-18*N+N*N+72*B-58*w)*L*L*L*L*L/120)+5e5,We=s*(ie+I*Math.tan(H)*(L*L/2+(5-N+9*B+4*B*B)*L*L*L*L/24+(61-58*N+N*N+600*B-330*w)*L*L*L*L*L*L/720));return r<0&&(We+=1e7),{northing:Math.round(We),easting:Math.round(Ae),zoneNumber:Me,zoneLetter:QO(r)}}function db(t){var r=t.northing,i=t.easting,c=t.zoneLetter,h=t.zoneNumber;if(h<0||h>60)return null;var s=.9996,v=6378137,w=.00669438,I,N=(1-Math.sqrt(1-w))/(1+Math.sqrt(1-w)),B,L,ie,H,me,Ee,Me,Ae,We,it=i-5e5,_t=r;c<"N"&&(_t-=1e7),Me=(h-1)*6-180+3,I=w/(1-w),Ee=_t/s,Ae=Ee/(v*(1-w/4-3*w*w/64-5*w*w*w/256)),We=Ae+(3*N/2-27*N*N*N/32)*Math.sin(2*Ae)+(21*N*N/16-55*N*N*N*N/32)*Math.sin(4*Ae)+151*N*N*N/96*Math.sin(6*Ae),B=v/Math.sqrt(1-w*Math.sin(We)*Math.sin(We)),L=Math.tan(We)*Math.tan(We),ie=I*Math.cos(We)*Math.cos(We),H=v*(1-w)/Math.pow(1-w*Math.sin(We)*Math.sin(We),1.5),me=it/(B*s);var Ct=We-B*Math.tan(We)/H*(me*me/2-(5+3*L+10*ie-4*ie*ie-9*I)*me*me*me*me/24+(61+90*L+298*ie+45*L*L-252*I-3*ie*ie)*me*me*me*me*me*me/720);Ct=LT(Ct);var Nt=(me-(1+2*L+ie)*me*me*me/6+(5-2*ie+28*L-3*ie*ie+8*I+24*L*L)*me*me*me*me*me/120)/Math.cos(We);Nt=Me+LT(Nt);var Gt;if(t.accuracy){var Xt=db({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});Gt={top:Xt.lat,right:Xt.lon,bottom:Ct,left:Nt}}else Gt={lat:Ct,lon:Nt};return Gt}function QO(t){var r="Z";return 84>=t&&t>=72?r="X":72>t&&t>=64?r="W":64>t&&t>=56?r="V":56>t&&t>=48?r="U":48>t&&t>=40?r="T":40>t&&t>=32?r="S":32>t&&t>=24?r="R":24>t&&t>=16?r="Q":16>t&&t>=8?r="P":8>t&&t>=0?r="N":0>t&&t>=-8?r="M":-8>t&&t>=-16?r="L":-16>t&&t>=-24?r="K":-24>t&&t>=-32?r="J":-32>t&&t>=-40?r="H":-40>t&&t>=-48?r="G":-48>t&&t>=-56?r="F":-56>t&&t>=-64?r="E":-64>t&&t>=-72?r="D":-72>t&&t>=-80&&(r="C"),r}function JO(t,r){var i="00000"+t.easting,c="00000"+t.northing;return t.zoneNumber+t.zoneLetter+e4(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,r)+c.substr(c.length-5,r)}function e4(t,r,i){var c=jT(i),h=Math.floor(t/1e5),s=Math.floor(r/1e5)%20;return t4(h,s,c)}function jT(t){var r=t%NT;return r===0&&(r=NT),r}function t4(t,r,i){var c=i-1,h=OT.charCodeAt(c),s=FT.charCodeAt(c),v=h+t-1,w=s+r,I=!1;v>If&&(v=v-If+Zu-1,I=!0),(v===ai||h<ai&&v>ai||(v>ai||h<ai)&&I)&&v++,(v===Ki||h<Ki&&v>Ki||(v>Ki||h<Ki)&&I)&&(v++,v===ai&&v++),v>If&&(v=v-If+Zu-1),w>Ef?(w=w-Ef+Zu-1,I=!0):I=!1,(w===ai||s<ai&&w>ai||(w>ai||s<ai)&&I)&&w++,(w===Ki||s<Ki&&w>Ki||(w>Ki||s<Ki)&&I)&&(w++,w===ai&&w++),w>Ef&&(w=w-Ef+Zu-1);var N=String.fromCharCode(v)+String.fromCharCode(w);return N}function BT(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var r=t.length,i=null,c="",h,s=0;!/[A-Z]/.test(h=t.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+t;c+=h,s++}var v=parseInt(c,10);if(s===0||s+3>r)throw"MGRSPoint bad conversion from: "+t;var w=t.charAt(s++);if(w<="A"||w==="B"||w==="Y"||w>="Z"||w==="I"||w==="O")throw"MGRSPoint zone letter "+w+" not handled: "+t;i=t.substring(s,s+=2);for(var I=jT(v),N=n4(i.charAt(0),I),B=r4(i.charAt(1),I);B<i4(w);)B+=2e6;var L=r-s;if(L%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var ie=L/2,H=0,me=0,Ee,Me,Ae,We,it;return ie>0&&(Ee=1e5/Math.pow(10,ie),Me=t.substring(s,s+ie),H=parseFloat(Me)*Ee,Ae=t.substring(s+ie),me=parseFloat(Ae)*Ee),We=H+N,it=me+B,{easting:We,northing:it,zoneLetter:w,zoneNumber:v,accuracy:Ee}}function n4(t,r){for(var i=OT.charCodeAt(r-1),c=1e5,h=!1;i!==t.charCodeAt(0);){if(i++,i===ai&&i++,i===Ki&&i++,i>If){if(h)throw"Bad character: "+t;i=Zu,h=!0}c+=1e5}return c}function r4(t,r){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=FT.charCodeAt(r-1),c=0,h=!1;i!==t.charCodeAt(0);){if(i++,i===ai&&i++,i===Ki&&i++,i>Ef){if(h)throw"Bad character: "+t;i=Zu,h=!0}c+=1e5}return c}function i4(t){var r;switch(t){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+t}function Wu(t,r,i){if(!(this instanceof Wu))return new Wu(t,r,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if(typeof t=="object")this.x=t.x,this.y=t.y,this.z=t.z||0;else if(typeof t=="string"&&typeof r>"u"){var c=t.split(",");this.x=parseFloat(c[0]),this.y=parseFloat(c[1]),this.z=parseFloat(c[2])||0}else this.x=t,this.y=r,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Wu.fromMGRS=function(t){return new Wu(hb(t))};Wu.prototype.toMGRS=function(t){return ub([this.x,this.y],t)};var UT=Wu;var o4=1,s4=.25,VT=.046875,GT=.01953125,$T=.01068115234375,a4=.75,l4=.46875,c4=.013020833333333334,u4=.007120768229166667,h4=.3645833333333333,d4=.005696614583333333,f4=.3076171875;function Xu(t){var r=[];r[0]=o4-t*(s4+t*(VT+t*(GT+t*$T))),r[1]=t*(a4-t*(VT+t*(GT+t*$T)));var i=t*t;return r[2]=i*(l4-t*(c4+t*u4)),i*=t,r[3]=i*(h4-t*d4),r[4]=i*t*f4,r}function Ko(t,r,i,c){return i*=r,r*=r,c[0]*t-i*(c[1]+r*(c[2]+r*(c[3]+r*c[4])))}var p4=20;function Yu(t,r,i){for(var c=1/(1-r),h=t,s=p4;s;--s){var v=Math.sin(h),w=1-r*v*v;if(w=(Ko(h,v,Math.cos(h),i)-t)*(w*Math.sqrt(w))*c,h-=w,Math.abs(w)<ze)return h}return h}function m4(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Xu(this.es),this.ml0=Ko(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function g4(t){var r=t.x,i=t.y,c=Fe(r-this.long0),h,s,v,w=Math.sin(i),I=Math.cos(i);if(this.es){var B=I*c,L=Math.pow(B,2),ie=this.ep2*Math.pow(I,2),H=Math.pow(ie,2),me=Math.abs(I)>ze?Math.tan(i):0,Ee=Math.pow(me,2),Me=Math.pow(Ee,2);h=1-this.es*Math.pow(w,2),B=B/Math.sqrt(h);var Ae=Ko(i,w,I,this.en);s=this.a*(this.k0*B*(1+L/6*(1-Ee+ie+L/20*(5-18*Ee+Me+14*ie-58*Ee*ie+L/42*(61+179*Me-Me*Ee-479*Ee)))))+this.x0,v=this.a*(this.k0*(Ae-this.ml0+w*c*B/2*(1+L/12*(5-Ee+9*ie+4*H+L/30*(61+Me-58*Ee+270*ie-330*Ee*ie+L/56*(1385+543*Me-Me*Ee-3111*Ee))))))+this.y0}else{var N=I*Math.sin(c);if(Math.abs(Math.abs(N)-1)<ze)return 93;if(s=.5*this.a*this.k0*Math.log((1+N)/(1-N))+this.x0,v=I*Math.cos(c)/Math.sqrt(1-Math.pow(N,2)),N=Math.abs(v),N>=1){if(N-1>ze)return 93;v=0}else v=Math.acos(v);i<0&&(v=-v),v=this.a*this.k0*(v-this.lat0)+this.y0}return t.x=s,t.y=v,t}function _4(t){var r,i,c,h,s=(t.x-this.x0)*(1/this.a),v=(t.y-this.y0)*(1/this.a);if(this.es)if(r=this.ml0+v/this.k0,i=Yu(r,this.es,this.en),Math.abs(i)<Pe){var L=Math.sin(i),ie=Math.cos(i),H=Math.abs(ie)>ze?Math.tan(i):0,me=this.ep2*Math.pow(ie,2),Ee=Math.pow(me,2),Me=Math.pow(H,2),Ae=Math.pow(Me,2);r=1-this.es*Math.pow(L,2);var We=s*Math.sqrt(r)/this.k0,it=Math.pow(We,2);r=r*H,c=i-r*it/(1-this.es)*.5*(1-it/12*(5+3*Me-9*me*Me+me-4*Ee-it/30*(61+90*Me-252*me*Me+45*Ae+46*me-it/56*(1385+3633*Me+4095*Ae+1574*Ae*Me)))),h=Fe(this.long0+We*(1-it/6*(1+2*Me+me-it/20*(5+28*Me+24*Ae+8*me*Me+6*me-it/42*(61+662*Me+1320*Ae+720*Ae*Me))))/ie)}else c=Pe*Yo(v),h=0;else{var w=Math.exp(s/this.k0),I=.5*(w-1/w),N=this.lat0+v/this.k0,B=Math.cos(N);r=Math.sqrt((1-Math.pow(B,2))/(1+Math.pow(I,2))),c=Math.asin(r),v<0&&(c=-c),I===0&&B===0?h=0:h=Fe(Math.atan2(I,B)+this.long0)}return t.x=h,t.y=c,t}var y4=["Fast_Transverse_Mercator","Fast Transverse Mercator"],Ku={init:m4,forward:g4,inverse:_4,names:y4};function Kg(t){var r=Math.exp(t);return r=(r-1/r)/2,r}function Yn(t,r){t=Math.abs(t),r=Math.abs(r);var i=Math.max(t,r),c=Math.min(t,r)/(i||1);return i*Math.sqrt(1+Math.pow(c,2))}function HT(t){var r=1+t,i=r-1;return i===0?t:t*Math.log(r)/i}function qT(t){var r=Math.abs(t);return r=HT(r*(1+r/(Yn(1,r)+1))),t<0?-r:r}function Qg(t,r){for(var i=2*Math.cos(2*r),c=t.length-1,h=t[c],s=0,v;--c>=0;)v=-s+i*h+t[c],s=h,h=v;return r+v*Math.sin(2*r)}function ZT(t,r){for(var i=2*Math.cos(r),c=t.length-1,h=t[c],s=0,v;--c>=0;)v=-s+i*h+t[c],s=h,h=v;return Math.sin(r)*v}function WT(t){var r=Math.exp(t);return r=(r+1/r)/2,r}function fb(t,r,i){for(var c=Math.sin(r),h=Math.cos(r),s=Kg(i),v=WT(i),w=2*h*v,I=-2*c*s,N=t.length-1,B=t[N],L=0,ie=0,H=0,me,Ee;--N>=0;)me=ie,Ee=L,ie=B,L=H,B=-me+w*ie-I*L+t[N],H=-Ee+I*ie+w*L;return w=c*v,I=h*s,[w*B-I*H,w*H+I*B]}function v4(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ku.init.apply(this),this.forward=Ku.forward,this.inverse=Ku.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),r=t/(2-t),i=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+r*(-2854/675)))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))),i=i*r,this.cgb[1]=i*(7/3+r*(-8/5+r*(-227/45+r*(2704/315+r*(2323/945))))),this.cbg[1]=i*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),i=i*r,this.cgb[2]=i*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),this.cbg[2]=i*(-26/15+r*(34/21+r*(8/5+r*(-12686/2835)))),i=i*r,this.cgb[3]=i*(4279/630+r*(-332/35+r*(-399572/14175))),this.cbg[3]=i*(1237/630+r*(-12/5+r*(-24832/14175))),i=i*r,this.cgb[4]=i*(4174/315+r*(-144838/6237)),this.cbg[4]=i*(-734/315+r*(109598/31185)),i=i*r,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),this.utg[1]=i*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),this.gtu[1]=i*(13/48+r*(-3/5+r*(557/1440+r*(281/630+r*(-1983433/1935360))))),i=i*r,this.utg[2]=i*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),this.gtu[2]=i*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),i=i*r,this.utg[3]=i*(-4397/161280+r*(11/504+r*(830251/7257600))),this.gtu[3]=i*(49561/161280+r*(-179/168+r*(6601661/7257600))),i=i*r,this.utg[4]=i*(-4583/161280+r*(108847/3991680)),this.gtu[4]=i*(34729/80640+r*(-3418889/1995840)),i=i*r,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=i*(212378941/319334400);var c=Qg(this.cbg,this.lat0);this.Zb=-this.Qn*(c+ZT(this.gtu,2*c))}function x4(t){var r=Fe(t.x-this.long0),i=t.y;i=Qg(this.cbg,i);var c=Math.sin(i),h=Math.cos(i),s=Math.sin(r),v=Math.cos(r);i=Math.atan2(c,v*h),r=Math.atan2(s*h,Yn(c,h*v)),r=qT(Math.tan(r));var w=fb(this.gtu,2*i,2*r);i=i+w[0],r=r+w[1];var I,N;return Math.abs(r)<=2.623395162778?(I=this.a*(this.Qn*r)+this.x0,N=this.a*(this.Qn*i+this.Zb)+this.y0):(I=1/0,N=1/0),t.x=I,t.y=N,t}function b4(t){var r=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,r=r/this.Qn;var c,h;if(Math.abs(r)<=2.623395162778){var s=fb(this.utg,2*i,2*r);i=i+s[0],r=r+s[1],r=Math.atan(Kg(r));var v=Math.sin(i),w=Math.cos(i),I=Math.sin(r),N=Math.cos(r);i=Math.atan2(v*N,Yn(I,N*w)),r=Math.atan2(I,N*w),c=Fe(r+this.long0),h=Qg(this.cgb,i)}else c=1/0,h=1/0;return t.x=c,t.y=h,t}var w4=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"],Qu={init:v4,forward:x4,inverse:b4,names:w4};function XT(t,r){if(t===void 0){if(t=Math.floor((Fe(r)+Math.PI)*30/Math.PI)+1,t<0)return 0;if(t>60)return 60}return t}var M4="etmerc";function S4(){var t=XT(this.zone,this.long0);if(t===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Rn,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Qu.init.apply(this),this.forward=Qu.forward,this.inverse=Qu.inverse}var E4=["Universal Transverse Mercator System","utm"],YT={init:S4,names:E4,dependsOn:M4};function Jg(t,r){return Math.pow((1-t)/(1+t),r)}var I4=20;function T4(){var t=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Ft)/(Math.pow(Math.tan(.5*this.lat0+Ft),this.C)*Jg(this.e*t,this.ratexp))}function C4(t){var r=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+Ft),this.C)*Jg(this.e*Math.sin(i),this.ratexp))-Pe,t.x=this.C*r,t}function P4(t){for(var r=1e-14,i=t.x/this.C,c=t.y,h=Math.pow(Math.tan(.5*c+Ft)/this.K,1/this.C),s=I4;s>0&&(c=2*Math.atan(h*Jg(this.e*Math.sin(t.y),-.5*this.e))-Pe,!(Math.abs(c-t.y)<r));--s)t.y=c;return s?(t.x=i,t.y=c,t):null}var D4=["gauss"],e_={init:T4,forward:C4,inverse:P4,names:D4};function A4(){e_.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function R4(t){var r,i,c,h;return t.x=Fe(t.x-this.long0),e_.forward.apply(this,[t]),r=Math.sin(t.y),i=Math.cos(t.y),c=Math.cos(t.x),h=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*i*c),t.x=h*i*Math.sin(t.x),t.y=h*(this.cosc0*r-this.sinc0*i*c),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function k4(t){var r,i,c,h,s;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,s=Yn(t.x,t.y)){var v=2*Math.atan2(s,this.R2);r=Math.sin(v),i=Math.cos(v),h=Math.asin(i*this.sinc0+t.y*r*this.cosc0/s),c=Math.atan2(t.x*r,s*this.cosc0*i-t.y*this.sinc0*r)}else h=this.phic0,c=0;return t.x=c,t.y=h,e_.inverse.apply(this,[t]),t.x=Fe(t.x+this.long0),t}var N4=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"],KT={init:A4,forward:R4,inverse:k4,names:N4};function pb(t,r,i){return r*=i,Math.tan(.5*(Pe+t))*Math.pow((1-r)/(1+r),.5*i)}function L4(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ze&&(this.k0=.5*(1+Yo(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=ze&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ze&&Math.abs(Math.cos(this.lat_ts))>ze&&(this.k0=.5*this.cons*Lr(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Zr(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Lr(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(pb(this.lat0,this.sinlat0,this.e))-Pe,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function O4(t){var r=t.x,i=t.y,c=Math.sin(i),h=Math.cos(i),s,v,w,I,N,B,L=Fe(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=ze&&Math.abs(i+this.lat0)<=ze?(t.x=NaN,t.y=NaN,t):this.sphere?(s=2*this.k0/(1+this.sinlat0*c+this.coslat0*h*Math.cos(L)),t.x=this.a*s*h*Math.sin(L)+this.x0,t.y=this.a*s*(this.coslat0*c-this.sinlat0*h*Math.cos(L))+this.y0,t):(v=2*Math.atan(pb(i,c,this.e))-Pe,I=Math.cos(v),w=Math.sin(v),Math.abs(this.coslat0)<=ze?(N=Zr(this.e,i*this.con,this.con*c),B=2*this.a*this.k0*N/this.cons,t.x=this.x0+B*Math.sin(r-this.long0),t.y=this.y0-this.con*B*Math.cos(r-this.long0),t):(Math.abs(this.sinlat0)<ze?(s=2*this.a*this.k0/(1+I*Math.cos(L)),t.y=s*w):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*w+this.cosX0*I*Math.cos(L))),t.y=s*(this.cosX0*w-this.sinX0*I*Math.cos(L))+this.y0),t.x=s*I*Math.sin(L)+this.x0,t))}function F4(t){t.x-=this.x0,t.y-=this.y0;var r,i,c,h,s,v=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var w=2*Math.atan(v/(2*this.a*this.k0));return r=this.long0,i=this.lat0,v<=ze?(t.x=r,t.y=i,t):(i=Math.asin(Math.cos(w)*this.sinlat0+t.y*Math.sin(w)*this.coslat0/v),Math.abs(this.coslat0)<ze?this.lat0>0?r=Fe(this.long0+Math.atan2(t.x,-1*t.y)):r=Fe(this.long0+Math.atan2(t.x,t.y)):r=Fe(this.long0+Math.atan2(t.x*Math.sin(w),v*this.coslat0*Math.cos(w)-t.y*this.sinlat0*Math.sin(w))),t.x=r,t.y=i,t)}else if(Math.abs(this.coslat0)<=ze){if(v<=ze)return i=this.lat0,r=this.long0,t.x=r,t.y=i,t;t.x*=this.con,t.y*=this.con,c=v*this.cons/(2*this.a*this.k0),i=this.con*Gs(this.e,c),r=this.con*Fe(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else h=2*Math.atan(v*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,v<=ze?s=this.X0:(s=Math.asin(Math.cos(h)*this.sinX0+t.y*Math.sin(h)*this.cosX0/v),r=Fe(this.long0+Math.atan2(t.x*Math.sin(h),v*this.cosX0*Math.cos(h)-t.y*this.sinX0*Math.sin(h)))),i=-1*Gs(this.e,Math.tan(.5*(Pe+s)));return t.x=r,t.y=i,t}var z4=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"],QT={init:L4,forward:O4,inverse:F4,names:z4,ssfn_:pb};function j4(){var t=this.lat0;this.lambda0=this.long0;var r=Math.sin(t),i=this.a,c=this.rf,h=1/c,s=2*h-Math.pow(h,2),v=this.e=Math.sqrt(s);this.R=this.k0*i*Math.sqrt(1-s)/(1-s*Math.pow(r,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(r/this.alpha);var w=Math.log(Math.tan(Math.PI/4+this.b0/2)),I=Math.log(Math.tan(Math.PI/4+t/2)),N=Math.log((1+v*r)/(1-v*r));this.K=w-this.alpha*I+this.alpha*v/2*N}function B4(t){var r=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),c=-this.alpha*(r+i)+this.K,h=2*(Math.atan(Math.exp(c))-Math.PI/4),s=this.alpha*(t.x-this.lambda0),v=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(h)+Math.cos(this.b0)*Math.cos(s))),w=Math.asin(Math.cos(this.b0)*Math.sin(h)-Math.sin(this.b0)*Math.cos(h)*Math.cos(s));return t.y=this.R/2*Math.log((1+Math.sin(w))/(1-Math.sin(w)))+this.y0,t.x=this.R*v+this.x0,t}function U4(t){for(var r=t.x-this.x0,i=t.y-this.y0,c=r/this.R,h=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(h)+Math.sin(this.b0)*Math.cos(h)*Math.cos(c)),v=Math.atan(Math.sin(c)/(Math.cos(this.b0)*Math.cos(c)-Math.sin(this.b0)*Math.tan(h))),w=this.lambda0+v/this.alpha,I=0,N=s,B=-1e3,L=0;Math.abs(N-B)>1e-7;){if(++L>20)return;I=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(N))/2)),B=N,N=2*Math.atan(Math.exp(I))-Math.PI/2}return t.x=w,t.y=N,t}var V4=["somerc"],JT={init:j4,forward:B4,inverse:U4,names:V4};var Ju=1e-7;function G4(t){var r=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],i=typeof t.projName=="object"?Object.keys(t.projName)[0]:t.projName;return"no_uoff"in t||"no_off"in t||r.indexOf(i)!==-1||r.indexOf(nb(i))!==-1}function $4(){var t,r,i,c,h,s,v,w,I,N,B=0,L,ie=0,H=0,me=0,Ee=0,Me=0,Ae=0;this.no_off=G4(this),this.no_rot="no_rot"in this;var We=!1;"alpha"in this&&(We=!0);var it=!1;if("rectified_grid_angle"in this&&(it=!0),We&&(Ae=this.alpha),it&&(B=this.rectified_grid_angle),We||it)ie=this.longc;else if(H=this.long1,Ee=this.lat1,me=this.long2,Me=this.lat2,Math.abs(Ee-Me)<=Ju||(t=Math.abs(Ee))<=Ju||Math.abs(t-Pe)<=Ju||Math.abs(Math.abs(this.lat0)-Pe)<=Ju||Math.abs(Math.abs(Me)-Pe)<=Ju)throw new Error;var _t=1-this.es;r=Math.sqrt(_t),Math.abs(this.lat0)>ze?(w=Math.sin(this.lat0),i=Math.cos(this.lat0),t=1-this.es*w*w,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/_t),this.A=this.B*this.k0*r/t,c=this.B*r/(i*Math.sqrt(t)),h=c*c-1,h<=0?h=0:(h=Math.sqrt(h),this.lat0<0&&(h=-h)),this.E=h+=c,this.E*=Math.pow(Zr(this.e,this.lat0,w),this.B)):(this.B=1/r,this.A=this.k0,this.E=c=h=1),We||it?(We?(L=Math.asin(Math.sin(Ae)/c),it||(B=Ae)):(L=B,Ae=Math.asin(c*Math.sin(L))),this.lam0=ie-Math.asin(.5*(h-1/h)*Math.tan(L))/this.B):(s=Math.pow(Zr(this.e,Ee,Math.sin(Ee)),this.B),v=Math.pow(Zr(this.e,Me,Math.sin(Me)),this.B),h=this.E/s,I=(v-s)/(v+s),N=this.E*this.E,N=(N-v*s)/(N+v*s),t=H-me,t<-Math.PI?me-=$a:t>Math.PI&&(me+=$a),this.lam0=Fe(.5*(H+me)-Math.atan(N*Math.tan(.5*this.B*(H-me))/I)/this.B),L=Math.atan(2*Math.sin(this.B*Fe(H-this.lam0))/(h-1/h)),B=Ae=Math.asin(c*Math.sin(L))),this.singam=Math.sin(L),this.cosgam=Math.cos(L),this.sinrot=Math.sin(B),this.cosrot=Math.cos(B),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(c*c-1)/Math.cos(Ae))),this.lat0<0&&(this.u_0=-this.u_0)),h=.5*L,this.v_pole_n=this.ArB*Math.log(Math.tan(Ft-h)),this.v_pole_s=this.ArB*Math.log(Math.tan(Ft+h))}function H4(t){var r={},i,c,h,s,v,w,I,N;if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Pe)>ze){if(v=this.E/Math.pow(Zr(this.e,t.y,Math.sin(t.y)),this.B),w=1/v,i=.5*(v-w),c=.5*(v+w),s=Math.sin(this.B*t.x),h=(i*this.singam-s*this.cosgam)/c,Math.abs(Math.abs(h)-1)<ze)throw new Error;N=.5*this.ArB*Math.log((1-h)/(1+h)),w=Math.cos(this.B*t.x),Math.abs(w)<Ju?I=this.A*t.x:I=this.ArB*Math.atan2(i*this.cosgam+s*this.singam,w)}else N=t.y>0?this.v_pole_n:this.v_pole_s,I=this.ArB*t.y;return this.no_rot?(r.x=I,r.y=N):(I-=this.u_0,r.x=N*this.cosrot+I*this.sinrot,r.y=I*this.cosrot-N*this.sinrot),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function q4(t){var r,i,c,h,s,v,w,I={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(i=t.y,r=t.x):(i=t.x*this.cosrot-t.y*this.sinrot,r=t.y*this.cosrot+t.x*this.sinrot+this.u_0),c=Math.exp(-this.BrA*i),h=.5*(c-1/c),s=.5*(c+1/c),v=Math.sin(this.BrA*r),w=(v*this.cosgam+h*this.singam)/s,Math.abs(Math.abs(w)-1)<ze)I.x=0,I.y=w<0?-Pe:Pe;else{if(I.y=this.E/Math.sqrt((1+w)/(1-w)),I.y=Gs(this.e,Math.pow(I.y,1/this.B)),I.y===1/0)throw new Error;I.x=-this.rB*Math.atan2(h*this.cosgam-v*this.singam,Math.cos(this.BrA*r))}return I.x+=this.lam0,I}var Z4=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"],eC={init:$4,forward:H4,inverse:q4,names:Z4};function W4(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<ze)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var r=Math.sin(this.lat1),i=Math.cos(this.lat1),c=Lr(this.e,r,i),h=Zr(this.e,this.lat1,r),s=Math.sin(this.lat2),v=Math.cos(this.lat2),w=Lr(this.e,s,v),I=Zr(this.e,this.lat2,s),N=Math.abs(Math.abs(this.lat0)-Pe)<ze?0:Zr(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>ze?this.ns=Math.log(c/w)/Math.log(h/I):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=c/(this.ns*Math.pow(h,this.ns)),this.rh=this.a*this.f0*Math.pow(N,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function X4(t){var r=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=ze&&(i=Yo(i)*(Pe-2*ze));var c=Math.abs(Math.abs(i)-Pe),h,s;if(c>ze)h=Zr(this.e,i,Math.sin(i)),s=this.a*this.f0*Math.pow(h,this.ns);else{if(c=i*this.ns,c<=0)return null;s=0}var v=this.ns*Fe(r-this.long0);return t.x=this.k0*(s*Math.sin(v))+this.x0,t.y=this.k0*(this.rh-s*Math.cos(v))+this.y0,t}function Y4(t){var r,i,c,h,s,v=(t.x-this.x0)/this.k0,w=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(v*v+w*w),i=1):(r=-Math.sqrt(v*v+w*w),i=-1);var I=0;if(r!==0&&(I=Math.atan2(i*v,i*w)),r!==0||this.ns>0){if(i=1/this.ns,c=Math.pow(r/(this.a*this.f0),i),h=Gs(this.e,c),h===-9999)return null}else h=-Pe;return s=Fe(I/this.ns+this.long0),t.x=s,t.y=h,t}var K4=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"],tC={init:W4,forward:X4,inverse:Y4,names:K4};function Q4(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function J4(t){var r,i,c,h,s,v,w,I=t.x,N=t.y,B=Fe(I-this.long0);return r=Math.pow((1+this.e*Math.sin(N))/(1-this.e*Math.sin(N)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(N/2+this.s45),this.alfa)/r)-this.s45),c=-B*this.alfa,h=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(c)),s=Math.asin(Math.cos(i)*Math.sin(c)/Math.cos(h)),v=this.n*s,w=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(h/2+this.s45),this.n),t.y=w*Math.cos(v)/1,t.x=w*Math.sin(v)/1,this.czech||(t.y*=-1,t.x*=-1),t}function e3(t){var r,i,c,h,s,v,w,I,N=t.x;t.x=t.y,t.y=N,this.czech||(t.y*=-1,t.x*=-1),v=Math.sqrt(t.x*t.x+t.y*t.y),s=Math.atan2(t.y,t.x),h=s/Math.sin(this.s0),c=2*(Math.atan(Math.pow(this.ro0/v,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(c)-Math.sin(this.ad)*Math.cos(c)*Math.cos(h)),i=Math.asin(Math.cos(c)*Math.sin(h)/Math.cos(r)),t.x=this.long0-i/this.alfa,w=r,I=0;var B=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(w))/(1-this.e*Math.sin(w)),this.e/2))-this.s45),Math.abs(w-t.y)<1e-10&&(I=1),w=t.y,B+=1;while(I===0&&B<15);return B>=15?null:t}var t3=["Krovak","krovak"],nC={init:Q4,forward:J4,inverse:e3,names:t3};function ir(t,r,i,c,h){return t*h-r*Math.sin(2*h)+i*Math.sin(4*h)-c*Math.sin(6*h)}function Hs(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function qs(t){return .375*t*(1+.25*t*(1+.46875*t))}function Zs(t){return .05859375*t*t*(1+.75*t)}function Ws(t){return t*t*t*(35/3072)}function Tf(t,r,i){var c=r*i;return t/Math.sqrt(1-c*c)}function li(t){return Math.abs(t)<Pe?t:t-Yo(t)*Math.PI}function ec(t,r,i,c,h){var s,v;s=t/r;for(var w=0;w<15;w++)if(v=(t-(r*s-i*Math.sin(2*s)+c*Math.sin(4*s)-h*Math.sin(6*s)))/(r-2*i*Math.cos(2*s)+4*c*Math.cos(4*s)-6*h*Math.cos(6*s)),s+=v,Math.abs(v)<=1e-10)return s;return NaN}function n3(){this.sphere||(this.e0=Hs(this.es),this.e1=qs(this.es),this.e2=Zs(this.es),this.e3=Ws(this.es),this.ml0=this.a*ir(this.e0,this.e1,this.e2,this.e3,this.lat0))}function r3(t){var r,i,c=t.x,h=t.y;if(c=Fe(c-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(h)*Math.sin(c)),i=this.a*(Math.atan2(Math.tan(h),Math.cos(c))-this.lat0);else{var s=Math.sin(h),v=Math.cos(h),w=Tf(this.a,this.e,s),I=Math.tan(h)*Math.tan(h),N=c*Math.cos(h),B=N*N,L=this.es*v*v/(1-this.es),ie=this.a*ir(this.e0,this.e1,this.e2,this.e3,h);r=w*N*(1-B*I*(1/6-(8-I+8*L)*B/120)),i=ie-this.ml0+w*s/v*B*(.5+(5-I+6*L)*B/24)}return t.x=r+this.x0,t.y=i+this.y0,t}function i3(t){t.x-=this.x0,t.y-=this.y0;var r=t.x/this.a,i=t.y/this.a,c,h;if(this.sphere){var s=i+this.lat0;c=Math.asin(Math.sin(s)*Math.cos(r)),h=Math.atan2(Math.tan(r),Math.cos(s))}else{var v=this.ml0/this.a+i,w=ec(v,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(w)-Pe)<=ze)return t.x=this.long0,t.y=Pe,i<0&&(t.y*=-1),t;var I=Tf(this.a,this.e,Math.sin(w)),N=I*I*I/this.a/this.a*(1-this.es),B=Math.pow(Math.tan(w),2),L=r*this.a/I,ie=L*L;c=w-I*Math.tan(w)/N*L*L*(.5-(1+3*B)*L*L/24),h=L*(1-ie*(B/3+(1+3*B)*B*ie/15))/Math.cos(w)}return t.x=Fe(h+this.long0),t.y=li(c),t}var o3=["Cassini","Cassini_Soldner","cass"],rC={init:n3,forward:r3,inverse:i3,names:o3};function vo(t,r){var i;return t>1e-7?(i=t*r,(1-t*t)*(r/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*r}var mb=1,gb=2,_b=3,t_=4;function s3(){var t=Math.abs(this.lat0);if(Math.abs(t-Pe)<ze?this.mode=this.lat0<0?mb:gb:Math.abs(t)<ze?this.mode=_b:this.mode=t_,this.es>0){var r;switch(this.qp=vo(this.e,1),this.mmf=.5/(1-this.es),this.apa=m3(this.es),this.mode){case gb:this.dd=1;break;case mb:this.dd=1;break;case _b:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case t_:this.rq=Math.sqrt(.5*this.qp),r=Math.sin(this.lat0),this.sinb1=vo(this.e,r)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*r*r)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===t_&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function a3(t){var r,i,c,h,s,v,w,I,N,B,L=t.x,ie=t.y;if(L=Fe(L-this.long0),this.sphere){if(s=Math.sin(ie),B=Math.cos(ie),c=Math.cos(L),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+B*c:1+this.sinph0*s+this.cosph0*B*c,i<=ze)return null;i=Math.sqrt(2/i),r=i*B*Math.sin(L),i*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*B*c}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),Math.abs(ie+this.lat0)<ze)return null;i=Ft-ie*.5,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),r=i*Math.sin(L),i*=c}}else{switch(w=0,I=0,N=0,c=Math.cos(L),h=Math.sin(L),s=Math.sin(ie),v=vo(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(w=v/this.qp,I=Math.sqrt(1-w*w)),this.mode){case this.OBLIQ:N=1+this.sinb1*w+this.cosb1*I*c;break;case this.EQUIT:N=1+I*c;break;case this.N_POLE:N=Pe+ie,v=this.qp-v;break;case this.S_POLE:N=ie-Pe,v=this.qp+v;break}if(Math.abs(N)<ze)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:N=Math.sqrt(2/N),this.mode===this.OBLIQ?i=this.ymf*N*(this.cosb1*w-this.sinb1*I*c):i=(N=Math.sqrt(2/(1+I*c)))*w*this.ymf,r=this.xmf*N*I*h;break;case this.N_POLE:case this.S_POLE:v>=0?(r=(N=Math.sqrt(v))*h,i=c*(this.mode===this.S_POLE?N:-N)):r=i=0;break}}return t.x=this.a*r+this.x0,t.y=this.a*i+this.y0,t}function l3(t){t.x-=this.x0,t.y-=this.y0;var r=t.x/this.a,i=t.y/this.a,c,h,s,v,w,I,N;if(this.sphere){var B=0,L,ie=0;if(L=Math.sqrt(r*r+i*i),h=L*.5,h>1)return null;switch(h=2*Math.asin(h),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(ie=Math.sin(h),B=Math.cos(h)),this.mode){case this.EQUIT:h=Math.abs(L)<=ze?0:Math.asin(i*ie/L),r*=ie,i=B*L;break;case this.OBLIQ:h=Math.abs(L)<=ze?this.lat0:Math.asin(B*this.sinph0+i*ie*this.cosph0/L),r*=ie*this.cosph0,i=(B-Math.sin(h)*this.sinph0)*L;break;case this.N_POLE:i=-i,h=Pe-h;break;case this.S_POLE:h-=Pe;break}c=i===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(r,i)}else{if(N=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r/=this.dd,i*=this.dd,I=Math.sqrt(r*r+i*i),I<ze)return t.x=this.long0,t.y=this.lat0,t;v=2*Math.asin(.5*I/this.rq),s=Math.cos(v),r*=v=Math.sin(v),this.mode===this.OBLIQ?(N=s*this.sinb1+i*v*this.cosb1/I,w=this.qp*N,i=I*this.cosb1*s-i*this.sinb1*v):(N=i*v/I,w=this.qp*N,i=I*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),w=r*r+i*i,!w)return t.x=this.long0,t.y=this.lat0,t;N=1-w/this.qp,this.mode===this.S_POLE&&(N=-N)}c=Math.atan2(r,i),h=g3(Math.asin(N),this.apa)}return t.x=Fe(this.long0+c),t.y=h,t}var c3=.3333333333333333,u3=.17222222222222222,h3=.10257936507936508,d3=.06388888888888888,f3=.0664021164021164,p3=.016415012942191543;function m3(t){var r,i=[];return i[0]=t*c3,r=t*t,i[0]+=r*u3,i[1]=r*d3,r*=t,i[0]+=r*h3,i[1]+=r*f3,i[2]=r*p3,i}function g3(t,r){var i=t+t;return t+r[0]*Math.sin(i)+r[1]*Math.sin(i+i)+r[2]*Math.sin(i+i+i)}var _3=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],iC={init:s3,forward:a3,inverse:l3,names:_3,S_POLE:mb,N_POLE:gb,EQUIT:_b,OBLIQ:t_};function ci(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function y3(){Math.abs(this.lat1+this.lat2)<ze||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Lr(this.e3,this.sin_po,this.cos_po),this.qs1=vo(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Lr(this.e3,this.sin_po,this.cos_po),this.qs2=vo(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=vo(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>ze?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function v3(t){var r=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var c=vo(this.e3,this.sin_phi),h=this.a*Math.sqrt(this.c-this.ns0*c)/this.ns0,s=this.ns0*Fe(r-this.long0),v=h*Math.sin(s)+this.x0,w=this.rh-h*Math.cos(s)+this.y0;return t.x=v,t.y=w,t}function x3(t){var r,i,c,h,s,v;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),c=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),c=-1),h=0,r!==0&&(h=Math.atan2(c*t.x,c*t.y)),c=r*this.ns0/this.a,this.sphere?v=Math.asin((this.c-c*c)/(2*this.ns0)):(i=(this.c-c*c)/this.ns0,v=this.phi1z(this.e3,i)),s=Fe(h/this.ns0+this.long0),t.x=s,t.y=v,t}function b3(t,r){var i,c,h,s,v,w=ci(.5*r);if(t<ze)return w;for(var I=t*t,N=1;N<=25;N++)if(i=Math.sin(w),c=Math.cos(w),h=t*i,s=1-h*h,v=.5*s*s/c*(r/(1-I)-i/s+.5/t*Math.log((1-h)/(1+h))),w=w+v,Math.abs(v)<=1e-7)return w;return null}var w3=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"],oC={init:y3,forward:v3,inverse:x3,names:w3,phi1z:b3};function M3(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function S3(t){var r,i,c,h,s,v,w,I,N=t.x,B=t.y;return c=Fe(N-this.long0),r=Math.sin(B),i=Math.cos(B),h=Math.cos(c),v=this.sin_p14*r+this.cos_p14*i*h,s=1,v>0||Math.abs(v)<=ze?(w=this.x0+this.a*s*i*Math.sin(c)/v,I=this.y0+this.a*s*(this.cos_p14*r-this.sin_p14*i*h)/v):(w=this.x0+this.infinity_dist*i*Math.sin(c),I=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*i*h)),t.x=w,t.y=I,t}function E3(t){var r,i,c,h,s,v;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(r=Math.sqrt(t.x*t.x+t.y*t.y))?(h=Math.atan2(r,this.rc),i=Math.sin(h),c=Math.cos(h),v=ci(c*this.sin_p14+t.y*i*this.cos_p14/r),s=Math.atan2(t.x*i,r*this.cos_p14*c-t.y*this.sin_p14*i),s=Fe(this.long0+s)):(v=this.phic0,s=0),t.x=s,t.y=v,t}var I3=["gnom"],sC={init:M3,forward:S3,inverse:E3,names:I3};function aC(t,r){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(r)-i)<1e-6)return r<0?-1*Pe:Pe;for(var c=Math.asin(.5*r),h,s,v,w,I=0;I<30;I++)if(s=Math.sin(c),v=Math.cos(c),w=t*s,h=Math.pow(1-w*w,2)/(2*v)*(r/(1-t*t)-s/(1-w*w)+.5/t*Math.log((1-w)/(1+w))),c+=h,Math.abs(h)<=1e-10)return c;return NaN}function T3(){this.sphere||(this.k0=Lr(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function C3(t){var r=t.x,i=t.y,c,h,s=Fe(r-this.long0);if(this.sphere)c=this.x0+this.a*s*Math.cos(this.lat_ts),h=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var v=vo(this.e,Math.sin(i));c=this.x0+this.a*this.k0*s,h=this.y0+this.a*v*.5/this.k0}return t.x=c,t.y=h,t}function P3(t){t.x-=this.x0,t.y-=this.y0;var r,i;return this.sphere?(r=Fe(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=aC(this.e,2*t.y*this.k0/this.a),r=Fe(this.long0+t.x/(this.a*this.k0))),t.x=r,t.y=i,t}var D3=["cea"],lC={init:T3,forward:C3,inverse:P3,names:D3};function A3(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function R3(t){var r=t.x,i=t.y,c=Fe(r-this.long0),h=li(i-this.lat0);return t.x=this.x0+this.a*c*this.rc,t.y=this.y0+this.a*h,t}function k3(t){var r=t.x,i=t.y;return t.x=Fe(this.long0+(r-this.x0)/(this.a*this.rc)),t.y=li(this.lat0+(i-this.y0)/this.a),t}var N3=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"],cC={init:A3,forward:R3,inverse:k3,names:N3};var uC=20;function L3(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Hs(this.es),this.e1=qs(this.es),this.e2=Zs(this.es),this.e3=Ws(this.es),this.ml0=this.a*ir(this.e0,this.e1,this.e2,this.e3,this.lat0)}function O3(t){var r=t.x,i=t.y,c,h,s,v=Fe(r-this.long0);if(s=v*Math.sin(i),this.sphere)Math.abs(i)<=ze?(c=this.a*v,h=-1*this.a*this.lat0):(c=this.a*Math.sin(s)/Math.tan(i),h=this.a*(li(i-this.lat0)+(1-Math.cos(s))/Math.tan(i)));else if(Math.abs(i)<=ze)c=this.a*v,h=-1*this.ml0;else{var w=Tf(this.a,this.e,Math.sin(i))/Math.tan(i);c=w*Math.sin(s),h=this.a*ir(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+w*(1-Math.cos(s))}return t.x=c+this.x0,t.y=h+this.y0,t}function F3(t){var r,i,c,h,s,v,w,I,N;if(c=t.x-this.x0,h=t.y-this.y0,this.sphere)if(Math.abs(h+this.a*this.lat0)<=ze)r=Fe(c/this.a+this.long0),i=0;else{v=this.lat0+h/this.a,w=c*c/this.a/this.a+v*v,I=v;var B;for(s=uC;s;--s)if(B=Math.tan(I),N=-1*(v*(I*B+1)-I-.5*(I*I+w)*B)/((I-v)/B-1),I+=N,Math.abs(N)<=ze){i=I;break}r=Fe(this.long0+Math.asin(c*Math.tan(I)/this.a)/Math.sin(i))}else if(Math.abs(h+this.ml0)<=ze)i=0,r=Fe(this.long0+c/this.a);else{v=(this.ml0+h)/this.a,w=c*c/this.a/this.a+v*v,I=v;var L,ie,H,me,Ee;for(s=uC;s;--s)if(Ee=this.e*Math.sin(I),L=Math.sqrt(1-Ee*Ee)*Math.tan(I),ie=this.a*ir(this.e0,this.e1,this.e2,this.e3,I),H=this.e0-2*this.e1*Math.cos(2*I)+4*this.e2*Math.cos(4*I)-6*this.e3*Math.cos(6*I),me=ie/this.a,N=(v*(L*me+1)-me-.5*L*(me*me+w))/(this.es*Math.sin(2*I)*(me*me+w-2*v*me)/(4*L)+(v-me)*(L*H-2/Math.sin(2*I))-H),I-=N,Math.abs(N)<=ze){i=I;break}L=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),r=Fe(this.long0+Math.asin(c*L/this.a)/Math.sin(i))}return t.x=r,t.y=i,t}var z3=["Polyconic","American_Polyconic","poly"],hC={init:L3,forward:O3,inverse:F3,names:z3};function j3(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function B3(t){var r,i=t.x,c=t.y,h=c-this.lat0,s=i-this.long0,v=h/Yl*1e-5,w=s,I=1,N=0;for(r=1;r<=10;r++)I=I*v,N=N+this.A[r]*I;var B=N,L=w,ie=1,H=0,me,Ee,Me=0,Ae=0;for(r=1;r<=6;r++)me=ie*B-H*L,Ee=H*B+ie*L,ie=me,H=Ee,Me=Me+this.B_re[r]*ie-this.B_im[r]*H,Ae=Ae+this.B_im[r]*ie+this.B_re[r]*H;return t.x=Ae*this.a+this.x0,t.y=Me*this.a+this.y0,t}function U3(t){var r,i=t.x,c=t.y,h=i-this.x0,s=c-this.y0,v=s/this.a,w=h/this.a,I=1,N=0,B,L,ie=0,H=0;for(r=1;r<=6;r++)B=I*v-N*w,L=N*v+I*w,I=B,N=L,ie=ie+this.C_re[r]*I-this.C_im[r]*N,H=H+this.C_im[r]*I+this.C_re[r]*N;for(var me=0;me<this.iterations;me++){var Ee=ie,Me=H,Ae,We,it=v,_t=w;for(r=2;r<=6;r++)Ae=Ee*ie-Me*H,We=Me*ie+Ee*H,Ee=Ae,Me=We,it=it+(r-1)*(this.B_re[r]*Ee-this.B_im[r]*Me),_t=_t+(r-1)*(this.B_im[r]*Ee+this.B_re[r]*Me);Ee=1,Me=0;var Ct=this.B_re[1],Nt=this.B_im[1];for(r=2;r<=6;r++)Ae=Ee*ie-Me*H,We=Me*ie+Ee*H,Ee=Ae,Me=We,Ct=Ct+r*(this.B_re[r]*Ee-this.B_im[r]*Me),Nt=Nt+r*(this.B_im[r]*Ee+this.B_re[r]*Me);var Gt=Ct*Ct+Nt*Nt;ie=(it*Ct+_t*Nt)/Gt,H=(_t*Ct-it*Nt)/Gt}var Xt=ie,tn=H,kn=1,xn=0;for(r=1;r<=9;r++)kn=kn*Xt,xn=xn+this.D[r]*kn;var Wr=this.lat0+xn*Yl*1e5,Ir=this.long0+tn;return t.x=Ir,t.y=Wr,t}var V3=["New_Zealand_Map_Grid","nzmg"],dC={init:j3,forward:B3,inverse:U3,names:V3};function G3(){}function $3(t){var r=t.x,i=t.y,c=Fe(r-this.long0),h=this.x0+this.a*c,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=h,t.y=s,t}function H3(t){t.x-=this.x0,t.y-=this.y0;var r=Fe(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=r,t.y=i,t}var q3=["Miller_Cylindrical","mill"],fC={init:G3,forward:$3,inverse:H3,names:q3};var Z3=20;function W3(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Xu(this.es)}function X3(t){var r,i,c=t.x,h=t.y;if(c=Fe(c-this.long0),this.sphere){if(!this.m)h=this.n!==1?Math.asin(this.n*Math.sin(h)):h;else for(var s=this.n*Math.sin(h),v=Z3;v;--v){var w=(this.m*h+Math.sin(h)-s)/(this.m+Math.cos(h));if(h-=w,Math.abs(w)<ze)break}r=this.a*this.C_x*c*(this.m+Math.cos(h)),i=this.a*this.C_y*h}else{var I=Math.sin(h),N=Math.cos(h);i=this.a*Ko(h,I,N,this.en),r=this.a*c*N/Math.sqrt(1-this.es*I*I)}return t.x=r,t.y=i,t}function Y3(t){var r,i,c,h;return t.x-=this.x0,c=t.x/this.a,t.y-=this.y0,r=t.y/this.a,this.sphere?(r/=this.C_y,c=c/(this.C_x*(this.m+Math.cos(r))),this.m?r=ci((this.m*r+Math.sin(r))/this.n):this.n!==1&&(r=ci(Math.sin(r)/this.n)),c=Fe(c+this.long0),r=li(r)):(r=Yu(t.y/this.a,this.es,this.en),h=Math.abs(r),h<Pe?(h=Math.sin(r),i=this.long0+t.x*Math.sqrt(1-this.es*h*h)/(this.a*Math.cos(r)),c=Fe(i)):h-ze<Pe&&(c=this.long0)),t.x=c,t.y=r,t}var K3=["Sinusoidal","sinu"],pC={init:W3,forward:X3,inverse:Y3,names:K3};function Q3(){}function J3(t){for(var r=t.x,i=t.y,c=Fe(r-this.long0),h=i,s=Math.PI*Math.sin(i);;){var v=-(h+Math.sin(h)-s)/(1+Math.cos(h));if(h+=v,Math.abs(v)<ze)break}h/=2,Math.PI/2-Math.abs(i)<ze&&(c=0);var w=.900316316158*this.a*c*Math.cos(h)+this.x0,I=1.4142135623731*this.a*Math.sin(h)+this.y0;return t.x=w,t.y=I,t}function eF(t){var r,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),r=Math.asin(i);var c=Fe(this.long0+t.x/(.900316316158*this.a*Math.cos(r)));c<-Math.PI&&(c=-Math.PI),c>Math.PI&&(c=Math.PI),i=(2*r+Math.sin(2*r))/Math.PI,Math.abs(i)>1&&(i=1);var h=Math.asin(i);return t.x=c,t.y=h,t}var tF=["Mollweide","moll"],mC={init:Q3,forward:J3,inverse:eF,names:tF};function nF(){Math.abs(this.lat1+this.lat2)<ze||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Hs(this.es),this.e1=qs(this.es),this.e2=Zs(this.es),this.e3=Ws(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=Lr(this.e,this.sin_phi,this.cos_phi),this.ml1=ir(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<ze?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=Lr(this.e,this.sin_phi,this.cos_phi),this.ml2=ir(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ir(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function rF(t){var r=t.x,i=t.y,c;if(this.sphere)c=this.a*(this.g-i);else{var h=ir(this.e0,this.e1,this.e2,this.e3,i);c=this.a*(this.g-h)}var s=this.ns*Fe(r-this.long0),v=this.x0+c*Math.sin(s),w=this.y0+this.rh-c*Math.cos(s);return t.x=v,t.y=w,t}function iF(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var r,i,c,h;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1);var s=0;if(i!==0&&(s=Math.atan2(r*t.x,r*t.y)),this.sphere)return h=Fe(this.long0+s/this.ns),c=li(this.g-i/this.a),t.x=h,t.y=c,t;var v=this.g-i/this.a;return c=ec(v,this.e0,this.e1,this.e2,this.e3),h=Fe(this.long0+s/this.ns),t.x=h,t.y=c,t}var oF=["Equidistant_Conic","eqdc"],gC={init:nF,forward:rF,inverse:iF,names:oF};function sF(){this.R=this.a}function aF(t){var r=t.x,i=t.y,c=Fe(r-this.long0),h,s;Math.abs(i)<=ze&&(h=this.x0+this.R*c,s=this.y0);var v=ci(2*Math.abs(i/Math.PI));(Math.abs(c)<=ze||Math.abs(Math.abs(i)-Pe)<=ze)&&(h=this.x0,i>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*v):s=this.y0+Math.PI*this.R*-Math.tan(.5*v));var w=.5*Math.abs(Math.PI/c-c/Math.PI),I=w*w,N=Math.sin(v),B=Math.cos(v),L=B/(N+B-1),ie=L*L,H=L*(2/N-1),me=H*H,Ee=Math.PI*this.R*(w*(L-me)+Math.sqrt(I*(L-me)*(L-me)-(me+I)*(ie-me)))/(me+I);c<0&&(Ee=-Ee),h=this.x0+Ee;var Me=I+L;return Ee=Math.PI*this.R*(H*Me-w*Math.sqrt((me+I)*(I+1)-Me*Me))/(me+I),i>=0?s=this.y0+Ee:s=this.y0-Ee,t.x=h,t.y=s,t}function lF(t){var r,i,c,h,s,v,w,I,N,B,L,ie,H;return t.x-=this.x0,t.y-=this.y0,L=Math.PI*this.R,c=t.x/L,h=t.y/L,s=c*c+h*h,v=-Math.abs(h)*(1+s),w=v-2*h*h+c*c,I=-2*v+1+2*h*h+s*s,H=h*h/I+(2*w*w*w/I/I/I-9*v*w/I/I)/27,N=(v-w*w/3/I)/I,B=2*Math.sqrt(-N/3),L=3*H/N/B,Math.abs(L)>1&&(L>=0?L=1:L=-1),ie=Math.acos(L)/3,t.y>=0?i=(-B*Math.cos(ie+Math.PI/3)-w/3/I)*Math.PI:i=-(-B*Math.cos(ie+Math.PI/3)-w/3/I)*Math.PI,Math.abs(c)<ze?r=this.long0:r=Fe(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(c*c-h*h)+s*s))/2/c),t.x=r,t.y=i,t}var cF=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"],_C={init:sF,forward:aF,inverse:lF,names:cF};function yC(t,r,i,c,h,s){let v=c-r,w=Math.atan((1-s)*Math.tan(t)),I=Math.atan((1-s)*Math.tan(i)),N=Math.sin(w),B=Math.cos(w),L=Math.sin(I),ie=Math.cos(I),H=v,me,Ee=100,Me,Ae,We,it,_t,Ct,Nt,Gt,Xt,tn,kn,xn,Wr,Ir;do{if(Me=Math.sin(H),Ae=Math.cos(H),We=Math.sqrt(ie*Me*(ie*Me)+(B*L-N*ie*Ae)*(B*L-N*ie*Ae)),We===0)return{azi1:0,s12:0};it=N*L+B*ie*Ae,_t=Math.atan2(We,it),Ct=B*ie*Me/We,Nt=1-Ct*Ct,Gt=Nt!==0?it-2*N*L/Nt:0,Xt=s/16*Nt*(4+s*(4-3*Nt)),me=H,H=v+(1-Xt)*s*Ct*(_t+Xt*We*(Gt+Xt*it*(-1+2*Gt*Gt)))}while(Math.abs(H-me)>1e-12&&--Ee>0);return Ee===0?{azi1:NaN,s12:NaN}:(tn=Nt*(h*h-h*(1-s)*(h*(1-s)))/(h*(1-s)*(h*(1-s))),kn=1+tn/16384*(4096+tn*(-768+tn*(320-175*tn))),xn=tn/1024*(256+tn*(-128+tn*(74-47*tn))),Wr=xn*We*(Gt+xn/4*(it*(-1+2*Gt*Gt)-xn/6*Gt*(-3+4*We*We)*(-3+4*Gt*Gt))),Ir=h*(1-s)*kn*(_t-Wr),{azi1:Math.atan2(ie*Me,B*L-N*ie*Ae),s12:Ir})}function vC(t,r,i,c,h,s){let v=Math.atan((1-s)*Math.tan(t)),w=Math.sin(v),I=Math.cos(v),N=Math.sin(i),B=Math.cos(i),L=Math.atan2(w,I*B),ie=I*N,H=1-ie*ie,me=H*(h*h-h*(1-s)*(h*(1-s)))/(h*(1-s)*(h*(1-s))),Ee=1+me/16384*(4096+me*(-768+me*(320-175*me))),Me=me/1024*(256+me*(-128+me*(74-47*me))),Ae=c/(h*(1-s)*Ee),We,it=100,_t,Ct,Nt,Gt;do _t=Math.cos(2*L+Ae),Ct=Math.sin(Ae),Nt=Math.cos(Ae),Gt=Me*Ct*(_t+Me/4*(Nt*(-1+2*_t*_t)-Me/6*_t*(-3+4*Ct*Ct)*(-3+4*_t*_t))),We=Ae,Ae=c/(h*(1-s)*Ee)+Gt;while(Math.abs(Ae-We)>1e-12&&--it>0);if(it===0)return{lat2:NaN,lon2:NaN};let Xt=w*Ct-I*Nt*B,tn=Math.atan2(w*Nt+I*Ct*B,(1-s)*Math.sqrt(ie*ie+Xt*Xt)),kn=Math.atan2(Ct*N,I*Nt-w*Ct*B),xn=s/16*H*(4+s*(4-3*H)),Wr=kn-(1-xn)*s*ie*(Ae+xn*Ct*(_t+xn*Nt*(-1+2*_t*_t))),Ir=r+Wr;return{lat2:tn,lon2:Ir}}function uF(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function hF(t){var r=t.x,i=t.y,c=Math.sin(t.y),h=Math.cos(t.y),s=Fe(r-this.long0),v,w,I,N,B,L,ie,H,me,Ee,Me;return this.sphere?Math.abs(this.sin_p12-1)<=ze?(t.x=this.x0+this.a*(Pe-i)*Math.sin(s),t.y=this.y0-this.a*(Pe-i)*Math.cos(s),t):Math.abs(this.sin_p12+1)<=ze?(t.x=this.x0+this.a*(Pe+i)*Math.sin(s),t.y=this.y0+this.a*(Pe+i)*Math.cos(s),t):(me=this.sin_p12*c+this.cos_p12*h*Math.cos(s),ie=Math.acos(me),H=ie?ie/Math.sin(ie):1,t.x=this.x0+this.a*H*h*Math.sin(s),t.y=this.y0+this.a*H*(this.cos_p12*c-this.sin_p12*h*Math.cos(s)),t):(v=Hs(this.es),w=qs(this.es),I=Zs(this.es),N=Ws(this.es),Math.abs(this.sin_p12-1)<=ze?(B=this.a*ir(v,w,I,N,Pe),L=this.a*ir(v,w,I,N,i),t.x=this.x0+(B-L)*Math.sin(s),t.y=this.y0-(B-L)*Math.cos(s),t):Math.abs(this.sin_p12+1)<=ze?(B=this.a*ir(v,w,I,N,Pe),L=this.a*ir(v,w,I,N,i),t.x=this.x0+(B+L)*Math.sin(s),t.y=this.y0+(B+L)*Math.cos(s),t):Math.abs(r)<ze&&Math.abs(i-this.lat0)<ze?(t.x=t.y=0,t):(Ee=yC(this.lat0,this.long0,i,r,this.a,this.f),Me=Ee.azi1,t.x=Ee.s12*Math.sin(Me),t.y=Ee.s12*Math.cos(Me),t))}function dF(t){t.x-=this.x0,t.y-=this.y0;var r,i,c,h,s,v,w,I,N,B,L,ie,H,me,Ee,Me;return this.sphere?(r=Math.sqrt(t.x*t.x+t.y*t.y),r>2*Pe*this.a?void 0:(i=r/this.a,c=Math.sin(i),h=Math.cos(i),s=this.long0,Math.abs(r)<=ze?v=this.lat0:(v=ci(h*this.sin_p12+t.y*c*this.cos_p12/r),w=Math.abs(this.lat0)-Pe,Math.abs(w)<=ze?this.lat0>=0?s=Fe(this.long0+Math.atan2(t.x,-t.y)):s=Fe(this.long0-Math.atan2(-t.x,t.y)):s=Fe(this.long0+Math.atan2(t.x*c,r*this.cos_p12*h-t.y*this.sin_p12*c))),t.x=s,t.y=v,t)):(I=Hs(this.es),N=qs(this.es),B=Zs(this.es),L=Ws(this.es),Math.abs(this.sin_p12-1)<=ze?(ie=this.a*ir(I,N,B,L,Pe),r=Math.sqrt(t.x*t.x+t.y*t.y),H=ie-r,v=ec(H/this.a,I,N,B,L),s=Fe(this.long0+Math.atan2(t.x,-1*t.y)),t.x=s,t.y=v,t):Math.abs(this.sin_p12+1)<=ze?(ie=this.a*ir(I,N,B,L,Pe),r=Math.sqrt(t.x*t.x+t.y*t.y),H=r-ie,v=ec(H/this.a,I,N,B,L),s=Fe(this.long0+Math.atan2(t.x,t.y)),t.x=s,t.y=v,t):(me=Math.atan2(t.x,t.y),Ee=Math.sqrt(t.x*t.x+t.y*t.y),Me=vC(this.lat0,this.long0,me,Ee,this.a,this.f),t.x=Me.lon2,t.y=Me.lat2,t))}var fF=["Azimuthal_Equidistant","aeqd"],xC={init:uF,forward:hF,inverse:dF,names:fF};function pF(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function mF(t){var r,i,c,h,s,v,w,I,N=t.x,B=t.y;return c=Fe(N-this.long0),r=Math.sin(B),i=Math.cos(B),h=Math.cos(c),v=this.sin_p14*r+this.cos_p14*i*h,s=1,(v>0||Math.abs(v)<=ze)&&(w=this.a*s*i*Math.sin(c),I=this.y0+this.a*s*(this.cos_p14*r-this.sin_p14*i*h)),t.x=w,t.y=I,t}function gF(t){var r,i,c,h,s,v,w;return t.x-=this.x0,t.y-=this.y0,r=Math.sqrt(t.x*t.x+t.y*t.y),i=ci(r/this.a),c=Math.sin(i),h=Math.cos(i),v=this.long0,Math.abs(r)<=ze?(w=this.lat0,t.x=v,t.y=w,t):(w=ci(h*this.sin_p14+t.y*c*this.cos_p14/r),s=Math.abs(this.lat0)-Pe,Math.abs(s)<=ze?(this.lat0>=0?v=Fe(this.long0+Math.atan2(t.x,-t.y)):v=Fe(this.long0-Math.atan2(-t.x,t.y)),t.x=v,t.y=w,t):(v=Fe(this.long0+Math.atan2(t.x*c,r*this.cos_p14*h-t.y*this.sin_p14*c)),t.x=v,t.y=w,t))}var _F=["ortho"],bC={init:pF,forward:mF,inverse:gF,names:_F};var En={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},en={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function yF(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Pe-Ft/2?this.face=En.TOP:this.lat0<=-(Pe-Ft/2)?this.face=En.BOTTOM:Math.abs(this.long0)<=Ft?this.face=En.FRONT:Math.abs(this.long0)<=Pe+Ft?this.face=this.long0>0?En.RIGHT:En.LEFT:this.face=En.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function vF(t){var r={x:0,y:0},i,c,h,s,v,w,I={value:0};if(t.x-=this.long0,this.es!==0?i=Math.atan(this.one_minus_f_squared*Math.tan(t.y)):i=t.y,c=t.x,this.face===En.TOP)s=Pe-i,c>=Ft&&c<=Pe+Ft?(I.value=en.AREA_0,h=c-Pe):c>Pe+Ft||c<=-(Pe+Ft)?(I.value=en.AREA_1,h=c>0?c-Sn:c+Sn):c>-(Pe+Ft)&&c<=-Ft?(I.value=en.AREA_2,h=c+Pe):(I.value=en.AREA_3,h=c);else if(this.face===En.BOTTOM)s=Pe+i,c>=Ft&&c<=Pe+Ft?(I.value=en.AREA_0,h=-c+Pe):c<Ft&&c>=-Ft?(I.value=en.AREA_1,h=-c):c<-Ft&&c>=-(Pe+Ft)?(I.value=en.AREA_2,h=-c-Pe):(I.value=en.AREA_3,h=c>0?-c+Sn:-c-Sn);else{var N,B,L,ie,H,me,Ee;this.face===En.RIGHT?c=eh(c,+Pe):this.face===En.BACK?c=eh(c,+Sn):this.face===En.LEFT&&(c=eh(c,-Pe)),ie=Math.sin(i),H=Math.cos(i),me=Math.sin(c),Ee=Math.cos(c),N=H*Ee,B=H*me,L=ie,this.face===En.FRONT?(s=Math.acos(N),h=n_(s,L,B,I)):this.face===En.RIGHT?(s=Math.acos(B),h=n_(s,L,-N,I)):this.face===En.BACK?(s=Math.acos(-N),h=n_(s,L,-B,I)):this.face===En.LEFT?(s=Math.acos(-B),h=n_(s,L,N,I)):(s=h=0,I.value=en.AREA_0)}return w=Math.atan(12/Sn*(h+Math.acos(Math.sin(h)*Math.cos(Ft))-Pe)),v=Math.sqrt((1-Math.cos(s))/(Math.cos(w)*Math.cos(w))/(1-Math.cos(Math.atan(1/Math.cos(h))))),I.value===en.AREA_1?w+=Pe:I.value===en.AREA_2?w+=Sn:I.value===en.AREA_3&&(w+=1.5*Sn),r.x=v*Math.cos(w),r.y=v*Math.sin(w),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,t.x=r.x,t.y=r.y,t}function xF(t){var r={lam:0,phi:0},i,c,h,s,v,w,I,N,B,L={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,c=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),i=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?L.value=en.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(L.value=en.AREA_1,i-=Pe):t.x<0&&-t.x>=Math.abs(t.y)?(L.value=en.AREA_2,i=i<0?i+Sn:i-Sn):(L.value=en.AREA_3,i+=Pe),B=Sn/12*Math.tan(i),v=Math.sin(B)/(Math.cos(B)-1/Math.sqrt(2)),w=Math.atan(v),h=Math.cos(i),s=Math.tan(c),I=1-h*h*s*s*(1-Math.cos(Math.atan(1/Math.cos(w)))),I<-1?I=-1:I>1&&(I=1),this.face===En.TOP)N=Math.acos(I),r.phi=Pe-N,L.value===en.AREA_0?r.lam=w+Pe:L.value===en.AREA_1?r.lam=w<0?w+Sn:w-Sn:L.value===en.AREA_2?r.lam=w-Pe:r.lam=w;else if(this.face===En.BOTTOM)N=Math.acos(I),r.phi=N-Pe,L.value===en.AREA_0?r.lam=-w+Pe:L.value===en.AREA_1?r.lam=-w:L.value===en.AREA_2?r.lam=-w-Pe:r.lam=w<0?-w-Sn:-w+Sn;else{var ie,H,me;ie=I,B=ie*ie,B>=1?me=0:me=Math.sqrt(1-B)*Math.sin(w),B+=me*me,B>=1?H=0:H=Math.sqrt(1-B),L.value===en.AREA_1?(B=H,H=-me,me=B):L.value===en.AREA_2?(H=-H,me=-me):L.value===en.AREA_3&&(B=H,H=me,me=-B),this.face===En.RIGHT?(B=ie,ie=-H,H=B):this.face===En.BACK?(ie=-ie,H=-H):this.face===En.LEFT&&(B=ie,ie=H,H=-B),r.phi=Math.acos(-me)-Pe,r.lam=Math.atan2(H,ie),this.face===En.RIGHT?r.lam=eh(r.lam,-Pe):this.face===En.BACK?r.lam=eh(r.lam,-Sn):this.face===En.LEFT&&(r.lam=eh(r.lam,+Pe))}if(this.es!==0){var Ee,Me,Ae;Ee=r.phi<0?1:0,Me=Math.tan(r.phi),Ae=this.b/Math.sqrt(Me*Me+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-Ae*Ae)/(this.one_minus_f*Ae)),Ee&&(r.phi=-r.phi)}return r.lam+=this.long0,t.x=r.lam,t.y=r.phi,t}function n_(t,r,i,c){var h;return t<ze?(c.value=en.AREA_0,h=0):(h=Math.atan2(r,i),Math.abs(h)<=Ft?c.value=en.AREA_0:h>Ft&&h<=Pe+Ft?(c.value=en.AREA_1,h-=Pe):h>Pe+Ft||h<=-(Pe+Ft)?(c.value=en.AREA_2,h=h>=0?h-Sn:h+Sn):(c.value=en.AREA_3,h+=Pe)),h}function eh(t,r){var i=t+r;return i<-Sn?i+=$a:i>+Sn&&(i-=$a),i}var bF=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"],wC={init:yF,forward:vF,inverse:xF,names:bF};var yb=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Cf=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],MC=.8487,SC=1.3523,EC=oi/5,wF=1/EC,th=18,r_=function(t,r){return t[0]+r*(t[1]+r*(t[2]+r*t[3]))},MF=function(t,r){return t[1]+r*(2*t[2]+r*3*t[3])};function SF(t,r,i,c){for(var h=r;c;--c){var s=t(h);if(h-=s,Math.abs(s)<i)break}return h}function EF(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function IF(t){var r=Fe(t.x-this.long0),i=Math.abs(t.y),c=Math.floor(i*EC);c<0?c=0:c>=th&&(c=th-1),i=oi*(i-wF*c);var h={x:r_(yb[c],i)*r,y:r_(Cf[c],i)};return t.y<0&&(h.y=-h.y),h.x=h.x*this.a*MC+this.x0,h.y=h.y*this.a*SC+this.y0,h}function TF(t){var r={x:(t.x-this.x0)/(this.a*MC),y:Math.abs(t.y-this.y0)/(this.a*SC)};if(r.y>=1)r.x/=yb[th][0],r.y=t.y<0?-Pe:Pe;else{var i=Math.floor(r.y*th);for(i<0?i=0:i>=th&&(i=th-1);;)if(Cf[i][0]>r.y)--i;else if(Cf[i+1][0]<=r.y)++i;else break;var c=Cf[i],h=5*(r.y-c[0])/(Cf[i+1][0]-c[0]);h=SF(function(s){return(r_(c,s)-r.y)/MF(c,s)},h,ze,100),r.x/=r_(yb[i],h),r.y=(5*i+h)*Rn,t.y<0&&(r.y=-r.y)}return r.x=Fe(r.x+this.long0),r}var CF=["Robinson","robin"],IC={init:EF,forward:IF,inverse:TF,names:CF};function PF(){this.name="geocent"}function DF(t){var r=qg(t,this.es,this.a);return r}function AF(t){var r=Zg(t,this.es,this.a,this.b);return r}var RF=["Geocentric","geocentric","geocent","Geocent"],TC={init:PF,forward:DF,inverse:AF,names:RF};var Or={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Pf={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function kF(){if(Object.keys(Pf).forEach((function(i){if(typeof this[i]>"u")this[i]=Pf[i].def;else{if(Pf[i].num&&isNaN(this[i]))throw new Error("Invalid parameter value, must be numeric "+i+" = "+this[i]);Pf[i].num&&(this[i]=parseFloat(this[i]))}Pf[i].degrees&&(this[i]=this[i]*Rn)}).bind(this)),Math.abs(Math.abs(this.lat0)-Pe)<ze?this.mode=this.lat0<0?Or.S_POLE:Or.N_POLE:Math.abs(this.lat0)<ze?this.mode=Or.EQUIT:(this.mode=Or.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(t),this.sw=Math.sin(t)}function NF(t){t.x-=this.long0;var r=Math.sin(t.y),i=Math.cos(t.y),c=Math.cos(t.x),h,s;switch(this.mode){case Or.OBLIQ:s=this.sinph0*r+this.cosph0*i*c;break;case Or.EQUIT:s=i*c;break;case Or.S_POLE:s=-r;break;case Or.N_POLE:s=r;break}switch(s=this.pn1/(this.p-s),h=s*i*Math.sin(t.x),this.mode){case Or.OBLIQ:s*=this.cosph0*r-this.sinph0*i*c;break;case Or.EQUIT:s*=r;break;case Or.N_POLE:s*=-(i*c);break;case Or.S_POLE:s*=i*c;break}var v,w;return v=s*this.cg+h*this.sg,w=1/(v*this.sw*this.h1+this.cw),h=(h*this.cg-s*this.sg)*this.cw*w,s=v*w,t.x=h*this.a,t.y=s*this.a,t}function LF(t){t.x/=this.a,t.y/=this.a;var r={x:t.x,y:t.y},i,c,h;h=1/(this.pn1-t.y*this.sw),i=this.pn1*t.x*h,c=this.pn1*t.y*this.cw*h,t.x=i*this.cg+c*this.sg,t.y=c*this.cg-i*this.sg;var s=Yn(t.x,t.y);if(Math.abs(s)<ze)r.x=0,r.y=t.y;else{var v,w;switch(w=1-s*s*this.pfact,w=(this.p-Math.sqrt(w))/(this.pn1/s+s/this.pn1),v=Math.sqrt(1-w*w),this.mode){case Or.OBLIQ:r.y=Math.asin(v*this.sinph0+t.y*w*this.cosph0/s),t.y=(v-this.sinph0*Math.sin(r.y))*s,t.x*=w*this.cosph0;break;case Or.EQUIT:r.y=Math.asin(t.y*w/s),t.y=v*s,t.x*=w;break;case Or.N_POLE:r.y=Math.asin(v),t.y=-t.y;break;case Or.S_POLE:r.y=-Math.asin(v);break}r.x=Math.atan2(t.x,t.y)}return t.x=r.x+this.long0,t.y=r.y,t}var OF=["Tilted_Perspective","tpers"],CC={init:kF,forward:NF,inverse:LF,names:OF};function FF(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var t=1-this.es,r=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=r,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function zF(t){var r=t.x,i=t.y,c,h,s,v;if(r=r-this.long0,this.shape==="ellipse"){i=Math.atan(this.radius_p2*Math.tan(i));var w=this.radius_p/Yn(this.radius_p*Math.cos(i),Math.sin(i));if(h=w*Math.cos(r)*Math.cos(i),s=w*Math.sin(r)*Math.cos(i),v=w*Math.sin(i),(this.radius_g-h)*h-s*s-v*v*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;c=this.radius_g-h,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/Yn(v,c)),t.y=this.radius_g_1*Math.atan(v/c)):(t.x=this.radius_g_1*Math.atan(s/c),t.y=this.radius_g_1*Math.atan(v/Yn(s,c)))}else this.shape==="sphere"&&(c=Math.cos(i),h=Math.cos(r)*c,s=Math.sin(r)*c,v=Math.sin(i),c=this.radius_g-h,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/Yn(v,c)),t.y=this.radius_g_1*Math.atan(v/c)):(t.x=this.radius_g_1*Math.atan(s/c),t.y=this.radius_g_1*Math.atan(v/Yn(s,c))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function jF(t){var r=-1,i=0,c=0,h,s,v,w;if(t.x=t.x/this.a,t.y=t.y/this.a,this.shape==="ellipse"){this.flip_axis?(c=Math.tan(t.y/this.radius_g_1),i=Math.tan(t.x/this.radius_g_1)*Yn(1,c)):(i=Math.tan(t.x/this.radius_g_1),c=Math.tan(t.y/this.radius_g_1)*Yn(1,i));var I=c/this.radius_p;if(h=i*i+I*I+r*r,s=2*this.radius_g*r,v=s*s-4*h*this.C,v<0)return t.x=Number.NaN,t.y=Number.NaN,t;w=(-s-Math.sqrt(v))/(2*h),r=this.radius_g+w*r,i*=w,c*=w,t.x=Math.atan2(i,r),t.y=Math.atan(c*Math.cos(t.x)/r),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if(this.shape==="sphere"){if(this.flip_axis?(c=Math.tan(t.y/this.radius_g_1),i=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+c*c)):(i=Math.tan(t.x/this.radius_g_1),c=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+i*i)),h=i*i+c*c+r*r,s=2*this.radius_g*r,v=s*s-4*h*this.C,v<0)return t.x=Number.NaN,t.y=Number.NaN,t;w=(-s-Math.sqrt(v))/(2*h),r=this.radius_g+w*r,i*=w,c*=w,t.x=Math.atan2(i,r),t.y=Math.atan(c*Math.cos(t.x)/r)}return t.x=t.x+this.long0,t}var BF=["Geostationary Satellite View","Geostationary_Satellite","geos"],PC={init:FF,forward:zF,inverse:jF,names:BF};var Df=1.340264,Af=-.081106,Rf=893e-6,kf=.003796,i_=Math.sqrt(3)/2;function UF(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function VF(t){var r=Fe(t.x-this.long0),i=t.y,c=Math.asin(i_*Math.sin(i)),h=c*c,s=h*h*h;return t.x=r*Math.cos(c)/(i_*(Df+3*Af*h+s*(7*Rf+9*kf*h))),t.y=c*(Df+Af*h+s*(Rf+kf*h)),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function GF(t){t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a;var r=1e-9,i=12,c=t.y,h,s,v,w,I,N;for(N=0;N<i&&(h=c*c,s=h*h*h,v=c*(Df+Af*h+s*(Rf+kf*h))-t.y,w=Df+3*Af*h+s*(7*Rf+9*kf*h),c-=I=v/w,!(Math.abs(I)<r));++N);return h=c*c,s=h*h*h,t.x=i_*t.x*(Df+3*Af*h+s*(7*Rf+9*kf*h))/Math.cos(c),t.y=Math.asin(Math.sin(c)/i_),t.x=Fe(t.x+this.long0),t}var $F=["eqearth","Equal Earth","Equal_Earth"],DC={init:UF,forward:VF,inverse:GF,names:$F};var Nf=1e-10;function HF(){var t;if(this.phi1=this.lat1,Math.abs(this.phi1)<Nf)throw new Error;this.es?(this.en=Xu(this.es),this.m1=Ko(this.phi1,this.am1=Math.sin(this.phi1),t=Math.cos(this.phi1),this.en),this.am1=t/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=ZF,this.forward=qF):(Math.abs(this.phi1)+Nf>=Pe?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=XF,this.forward=WF)}function qF(t){var r=Fe(t.x-(this.long0||0)),i=t.y,c,h,s;return c=this.am1+this.m1-Ko(i,h=Math.sin(i),s=Math.cos(i),this.en),h=s*r/(c*Math.sqrt(1-this.es*h*h)),t.x=c*Math.sin(h),t.y=this.am1-c*Math.cos(h),t.x=this.a*t.x+(this.x0||0),t.y=this.a*t.y+(this.y0||0),t}function ZF(t){t.x=(t.x-(this.x0||0))/this.a,t.y=(t.y-(this.y0||0))/this.a;var r,i,c,h;if(i=Yn(t.x,t.y=this.am1-t.y),h=Yu(this.am1+this.m1-i,this.es,this.en),(r=Math.abs(h))<Pe)r=Math.sin(h),c=i*Math.atan2(t.x,t.y)*Math.sqrt(1-this.es*r*r)/Math.cos(h);else if(Math.abs(r-Pe)<=Nf)c=0;else throw new Error;return t.x=Fe(c+(this.long0||0)),t.y=li(h),t}function WF(t){var r=Fe(t.x-(this.long0||0)),i=t.y,c,h;return h=this.cphi1+this.phi1-i,Math.abs(h)>Nf?(t.x=h*Math.sin(c=r*Math.cos(i)/h),t.y=this.cphi1-h*Math.cos(c)):t.x=t.y=0,t.x=this.a*t.x+(this.x0||0),t.y=this.a*t.y+(this.y0||0),t}function XF(t){t.x=(t.x-(this.x0||0))/this.a,t.y=(t.y-(this.y0||0))/this.a;var r,i,c=Yn(t.x,t.y=this.cphi1-t.y);if(i=this.cphi1+this.phi1-c,Math.abs(i)>Pe)throw new Error;return Math.abs(Math.abs(i)-Pe)<=Nf?r=0:r=c*Math.atan2(t.x,t.y)/Math.cos(i),t.x=Fe(r+(this.long0||0)),t.y=li(i),t}var YF=["bonne","Bonne (Werner lat_1=90)"],AC={init:HF,names:YF};function RC(t){t.Proj.projections.add(Ku),t.Proj.projections.add(Qu),t.Proj.projections.add(YT),t.Proj.projections.add(KT),t.Proj.projections.add(QT),t.Proj.projections.add(JT),t.Proj.projections.add(eC),t.Proj.projections.add(tC),t.Proj.projections.add(nC),t.Proj.projections.add(rC),t.Proj.projections.add(iC),t.Proj.projections.add(oC),t.Proj.projections.add(sC),t.Proj.projections.add(lC),t.Proj.projections.add(cC),t.Proj.projections.add(hC),t.Proj.projections.add(dC),t.Proj.projections.add(fC),t.Proj.projections.add(pC),t.Proj.projections.add(mC),t.Proj.projections.add(gC),t.Proj.projections.add(_C),t.Proj.projections.add(xC),t.Proj.projections.add(bC),t.Proj.projections.add(wC),t.Proj.projections.add(IC),t.Proj.projections.add(TC),t.Proj.projections.add(CC),t.Proj.projections.add(PC),t.Proj.projections.add(DC),t.Proj.projections.add(AC)}var kC=Object.assign(kT,{defaultDatum:"WGS84",Proj:$s,WGS84:new $s("WGS84"),Point:UT,toPoint:Xg,defs:$u,nadgrid:sb,transform:Jl,mgrs:zT,version:"__VERSION__"});RC(kC);var nh=kC;var o_=class t{STANDARD_CRS="EPSG:3857";constructor(){nh.defs("EPSG:4326","+proj=longlat +datum=WGS84 +no_defs"),nh.defs("EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"),nh.defs("EPSG:22175","+proj=tmerc +lat_0=0 +lon_0=-57 +k=1 +x_0=5500000 +y_0=0 +ellps=GRS80 +units=m +no_defs")}KNOWN_CRS={"EPSG:3857":{epsg:"EPSG:3857",name:"Web Mercator",isWebMercator:!0},"EPSG:4326":{epsg:"EPSG:4326",name:"WGS84 Geographic",isWebMercator:!1},"EPSG:22183":{epsg:"EPSG:22183",name:"POSGAR 98 / Argentina 3",isWebMercator:!1},"EPSG:5343":{epsg:"EPSG:5343",name:"POSGAR 2007 / Argentina 3",isWebMercator:!1}};getStandardCRS(){return this.STANDARD_CRS}isWebMercatorCompatible(r){if(!r)return!0;let i=this.KNOWN_CRS[r.toUpperCase()];return i?i.isWebMercator:!1}getCRSInfo(r){return r?this.KNOWN_CRS[r.toUpperCase()]||null:this.KNOWN_CRS[this.STANDARD_CRS]}extractFirstCoordinate(r){if(!r||!r.coordinates)return null;switch(r.type){case"Point":return r.coordinates;case"LineString":case"MultiPoint":return r.coordinates[0];case"Polygon":case"MultiLineString":return r.coordinates[0][0];case"MultiPolygon":return r.coordinates[0][0][0];default:return null}}detectCRSFromCoordinates(r,i){return Math.abs(r)>180&&Math.abs(i)>90?"EPSG:3857":r>=-75&&r<=-53&&i>=-55&&i<=-21?"EPSG:4326":r>1e6&&r<8e6&&i>1e6&&i<8e6?"EPSG:22183":"EPSG:4326"}async transformGeoJSON(r,i,c="EPSG:4326"){if(i?.toUpperCase()===c?.toUpperCase())return(await fetch(r)).json();try{let s=await(await fetch(r)).json();try{let v=this.extractFirstCoordinate(s.features?.[0]?.geometry);if(v){let w=nh(i,c,v)}}catch{}return this.transformGeoJSONCoordinates(s,i,c)}catch(h){throw console.error(`Error transformando GeoJSON de ${i} a ${c}:`,h),h}}transformGeoJSONCoordinates(r,i,c){let h=JSON.parse(JSON.stringify(r));return h.features&&h.features.forEach(s=>{s.geometry&&this.transformGeometry(s.geometry,i,c)}),h.crs&&(c==="EPSG:4326"?delete h.crs:h.crs={type:"name",properties:{name:`urn:ogc:def:crs:${c}`}}),h}transformGeometry(r,i,c){if(r.coordinates)switch(r.type){case"Point":r.coordinates=this.transformCoordinate(r.coordinates,i,c);break;case"LineString":case"MultiPoint":r.coordinates=r.coordinates.map(h=>this.transformCoordinate(h,i,c));break;case"Polygon":case"MultiLineString":r.coordinates=r.coordinates.map(h=>h.map(s=>this.transformCoordinate(s,i,c)));break;case"MultiPolygon":r.coordinates=r.coordinates.map(h=>h.map(s=>s.map(v=>this.transformCoordinate(v,i,c))));break}}transformCoordinate(r,i,c){try{let h=r;return i==="EPSG:22175"&&(h=[-Math.abs(r[0]),-Math.abs(r[1])]),nh(i,c,h)}catch(h){return console.warn(`Error transformando coordenada de ${i} a ${c}:`,h),r}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})};var s_=class t{constructor(r){this.coordinateSystemService=r}getAvailableLayers(){return this.layerMetadata.filter(r=>r.enabled)}getDefaultLayer(){return this.layerMetadata[0].id}getSources(){return{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:'\xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},esriWorldImagery:{type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Tiles \xA9 Esri \u2014 Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},googleSatellite:{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"],tileSize:256,maxzoom:21,attribution:"\xA9 Google Maps"},argenMap:{type:"raster",tiles:["https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/{z}/{x}/{y}.png"],tileSize:256,maxzoom:21,attribution:"\xA9 IGN Argentina",scheme:"tms"},googleMaps:{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}"],tileSize:256,maxzoom:21,attribution:"\xA9 Google Maps"},googleHybrid:{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}"],tileSize:256,maxzoom:21,attribution:"\xA9 Google Maps"},esriTransportation:{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"\xA9 Esri"},comisarias:{type:"geojson",data:"assets/json/comisarias.geojson"},escuelas:{type:"geojson",data:"assets/json/escuelas.geojson"},partidos:{type:"geojson",data:"assets/json/partidos.geojson"},hidro:{type:"geojson",data:"assets/json/hidro.geojson"},localidades:{type:"geojson",data:"assets/json/localidades.geojson"},provincias:{type:"geojson",data:"assets/json/provincias.geojson"},rutas:{type:"geojson",data:"assets/json/rutas.geojson"}}}getLayers(){return[{id:"osm-tiles",type:"raster",source:"osm"},{id:"esri-satellite-tiles",type:"raster",source:"esriWorldImagery",layout:{visibility:"none"}},{id:"google-satellite-tiles",type:"raster",source:"googleSatellite",layout:{visibility:"none"}},{id:"argenmap-tiles",type:"raster",source:"argenMap",layout:{visibility:"none"}},{id:"google-maps-tiles",type:"raster",source:"googleMaps",layout:{visibility:"none"}},{id:"google-hybrid-tiles",type:"raster",source:"googleHybrid",layout:{visibility:"none"}},{id:"esri-transportation-tiles",type:"raster",source:"esriTransportation",layout:{visibility:"none"}},{id:"comisarias",type:"circle",source:"comisarias",layout:{visibility:"none"},paint:{"circle-radius":6,"circle-color":"#00b300","circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"escuelas",type:"circle",source:"escuelas",layout:{visibility:"none"},paint:{"circle-radius":6,"circle-color":"#b37400ff","circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"partidos",type:"fill",source:"partidos",layout:{visibility:"none"},paint:{"fill-color":"#3388ff","fill-opacity":.3,"fill-outline-color":"#2255aa"}},{id:"hidro",type:"line",source:"hidro",layout:{visibility:"none"},paint:{"line-color":"#0000ff","line-width":2}},{id:"localidades",type:"circle",source:"localidades",layout:{visibility:"none"},paint:{"circle-radius":6,"circle-color":"rgba(44, 187, 0, 1)"}},{id:"provincias",type:"fill",source:"provincias",layout:{visibility:"none"},paint:{"fill-color":"#3388ff","fill-opacity":.3,"fill-outline-color":"#aa2276ff"}},{id:"rutas",type:"line",source:"rutas",layout:{visibility:"none"},paint:{"line-color":"#ff0000","line-width":2}}]}layerMetadata=[{id:"osm-tiles",sourceId:"osm",displayName:"OpenStreetMap",enabled:!0},{id:"esri-satellite-tiles",sourceId:"esriWorldImagery",displayName:"Sat\xE9lite (Esri)",enabled:!0},{id:"argenmap-tiles",sourceId:"argenMap",displayName:"ArgenMap (IGN)",enabled:!0},{id:"google-maps-tiles",sourceId:"googleMaps",displayName:"Google Maps",enabled:!0},{id:"google-hybrid-tiles",sourceId:"googleHybrid",displayName:"Google H\xEDbrido",enabled:!0},{id:"google-satellite-tiles",sourceId:"googleSatellite",displayName:"Google Sat\xE9lite",enabled:!0},{id:"esri-transportation-tiles",sourceId:"esriTransportation",displayName:"Esri Transporte",enabled:!0}];overlayMetadata=[{id:"comisarias",sourceId:"comisarias",displayName:"Comisar\xEDas",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"escuelas",sourceId:"escuelas",displayName:"Escuelas",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"partidos",sourceId:"partidos",displayName:"Partidos",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"hidro",sourceId:"hidro",displayName:"Hidrograf\xEDa",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"localidades",sourceId:"localidades",displayName:"Localidades",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"provincias",sourceId:"provincias",displayName:"Provincias",enabled:!0,visible:!1,crs:"EPSG:4326"},{id:"rutas",sourceId:"rutas",displayName:"Rutas",enabled:!0,visible:!1,crs:"EPSG:4326"}];getAvailableOverlays(){return this.overlayMetadata.filter(r=>r.enabled)}getMapStyle(){return{version:8,sources:this.getSources(),layers:this.getLayers()}}static \u0275fac=function(i){return new(i||t)(It(o_))};static \u0275prov=lt({token:t,factory:t.\u0275fac,providedIn:"root"})};var JF=["mapContainer"],a_=class t{constructor(r){this.layersService=r}mapContainer;map;currentLayerId="";availableLayers=[];availableOverlays=[];ngOnInit(){this.availableLayers=this.layersService.getAvailableLayers(),this.availableOverlays=this.layersService.getAvailableOverlays(),this.currentLayerId=this.layersService.getDefaultLayer(),this.initializeMap()}async initializeMap(){let r=this.layersService.getMapStyle();this.map=new rh.Map({container:this.mapContainer.nativeElement,style:r,center:[-58.3816,-34.6037],zoom:5}),this.map.addControl(new rh.NavigationControl({visualizePitch:!0}),"top-right"),this.map.on("click",v=>{let w=this.availableOverlays.filter(ie=>this.map.getLayoutProperty(ie.id,"visibility")==="visible").map(ie=>ie.id);if(w.length===0)return;let I=this.map.queryRenderedFeatures(v.point,{layers:w});if(!I.length)return;let B=I[0].properties,L="<table>";for(let ie in B)L+=`<tr><th style="text-align:left; padding-right:8px;">${ie}</th><td>${B[ie]}</td></tr>`;L+="</table>",new rh.Popup().setLngLat(v.lngLat).setHTML(L).addTo(this.map)});let i=this,c,h,s={onAdd(){let v=document.createElement("div");v.className="maplibregl-ctrl maplibregl-ctrl-group";let w=document.createElement("select");if(w.title="Seleccionar capa base",w.setAttribute("aria-label","Seleccionar capa base"),i.availableLayers.map(N=>({value:N.id,text:N.displayName})).forEach(N=>{let B=document.createElement("option");B.value=N.value,B.textContent=N.text,B.selected=N.value===i.currentLayerId,w.appendChild(B)}),w.style.width="auto",w.style.minWidth="140px",w.style.padding="4px 8px",w.style.fontSize="12px",w.style.border="none",w.style.background="white",w.style.cursor="pointer",w.addEventListener("change",()=>{let N=w.value;i.switchToLayer(N)}),v.appendChild(w),i.availableOverlays.length>0){let N=document.createElement("div");N.style.marginTop="8px",N.style.padding="4px 8px",N.style.background="white",N.style.borderTop="1px solid #ccc";let B=document.createElement("div");B.textContent="Capas superpuestas:",B.style.fontSize="11px",B.style.fontWeight="bold",B.style.marginBottom="4px",N.appendChild(B),i.availableOverlays.forEach(L=>{let ie=document.createElement("div");ie.style.display="flex",ie.style.alignItems="center",ie.style.marginBottom="2px";let H=document.createElement("input");H.type="checkbox",H.id=`overlay-${L.id}`,H.checked=L.visible,H.style.marginRight="6px";let me=document.createElement("label");me.setAttribute("for",`overlay-${L.id}`),me.textContent=L.displayName,me.style.fontSize="11px",me.style.cursor="pointer",H.addEventListener("change",()=>{i.toggleOverlay(L.id,H.checked)}),ie.appendChild(H),ie.appendChild(me),N.appendChild(ie)}),v.appendChild(N)}return c=v,h=w,v},onRemove(){c&&c.parentNode&&c.parentNode.removeChild(c),c=void 0,h=void 0}};this.map.addControl(s,"top-left")}switchToLayer(r){this.map&&(this.availableLayers.forEach(i=>{this.map.setLayoutProperty(i.id,"visibility","none")}),this.map.setLayoutProperty(r,"visibility","visible"),this.currentLayerId=r)}toggleOverlay(r,i){if(!this.map)return;this.map.setLayoutProperty(r,"visibility",i?"visible":"none");let c=this.availableOverlays.find(h=>h.id===r);c&&(c.visible=i)}ngOnDestroy(){this.map?.remove()}static \u0275fac=function(i){return new(i||t)(ug(s_))};static \u0275cmp=Hl({type:t,selectors:[["app-mapa"]],viewQuery:function(i,c){if(i&1&&H0(JF,7),i&2){let h;q0(h=Z0())&&(c.mapContainer=h.first)}},decls:2,vars:0,consts:[["mapContainer",""],[1,"map-container"]],template:function(i,c){i&1&&pg(0,"div",1,0)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}.map-container[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .maplibregl-popup-content{background:#23272f;color:#fff;border-radius:10px;font-size:1.1em;box-shadow:0 2px 12px #00000040;padding:16px 20px;max-width:740px;min-width:420px;overflow-x:auto;word-break:break-word}[_nghost-%COMP%]     .maplibregl-popup-tip{border-top-color:#23272f!important}[_nghost-%COMP%]     .maplibregl-popup-content table{width:100%;border-collapse:collapse}[_nghost-%COMP%]     .maplibregl-popup-content th, [_nghost-%COMP%]     .maplibregl-popup-content td{padding:4px 8px;border-bottom:1px solid #444}[_nghost-%COMP%]     .maplibregl-popup-content th{font-weight:700;color:#90caf9;background:transparent}[_nghost-%COMP%]     .maplibregl-popup-content tr:last-child td{border-bottom:none}"]})};var l_=class t{title="mapLibre";static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Hl({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(i,c){i&1&&Pu(0,"app-mapa")},dependencies:[a_],encapsulation:2})};ux(l_,BI).catch(t=>console.error(t));
